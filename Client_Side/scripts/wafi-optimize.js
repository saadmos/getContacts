/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Native/Rest.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * @module			Native *//* JSLint Declarations *//*global WAF*//** * The Rest module is part of the Core and Native composite modules * and implements the classes for connecting to the Wakanda through Rest. * * @class WAF.core.restConnect */WAF.core.restConnect = {};/** * httpMethods * * @static * @property httpMethods * @type Object **/WAF.core.restConnect.httpMethods = {	_post		: 'POST',	_get		: 'GET',	_put		: 'PUT',	_delete		: 'DELETE'};/** * restActions * * @static * @property restActions * @type Object **/WAF.core.restConnect.restActions = {	_retrieve	: 'retrieve',	_create		: 'create',	_update		: 'update',	_delete		: 'delete'};/** * queryOptions * * @static * @property queryOptions * @type Object **/WAF.core.restConnect.queryOptions = {	_expand		: '$expand',	_orderby	: '$orderby',	_skip		: '$skip',	_top		: '$top',	_filter		: '$filter'};/** * filterOperators * * @static * @property filterOperators * @type Object **/WAF.core.restConnect.filterOperators = {	_equal					: 'eq',	_notequal				: 'neq',	_greaterthan			: 'gt',	_greaterthanorequal		: 'gteq',	_lessthan				: 'lt',	_lessthanorequal		: 'lteq',	_logicaland				: 'and',	_logicalor				: 'or',	_logicalnot				: 'not'};/** * filterArithmeticOperators * * @static * @property filterArithmeticOperators * @type Object **/WAF.core.restConnect.filterArithmeticOperators = {	_add		: 'add',	_sub		: 'sub',	_mul		: 'mul',	_div		: 'div',	_mod		: 'mod'};/** * defaultService * * @static * @property defaultService * @type String * @default "rest" **/WAF.core.restConnect.defaultService = "rest";WAF.core.restConnect.baseURL = "";/** * standardErrors * * @static * @property standardErrors * @type Object **/WAF.core.restConnect.standardErrors = {	_hostnamemissing		: {key:"1",string:"The hostname is missing."},	_servicemissing			: {key:"2",string:"The service is missing."},	_httpmethodundefined	: {key:"3",string:"The HTTP method is undefined."},	_wronghttpmethod		: {key:"4",string:"The HTTP method get doesn't support POST data."}};/** * getXMLHttpRequest * * @static * @method getXMLHttpRequest * @return XMLHttpRequest **/WAF.core.restConnect.getXMLHttpRequest = function (){    var http_request = false;    if (window.XMLHttpRequest) { // Mozilla, Safari,...        http_request = new XMLHttpRequest();    } else if (window.ActiveXObject) { // IE    /*@cc_on    	@if (@_jscript_version >= 5)	        try {	            http_request = new ActiveXObject("Msxml2.XMLHTTP");	        } catch (e) {	            try {	                http_request = new ActiveXObject("Microsoft.XMLHTTP");	            } catch (e) {}	        }        @end   	@*/    }	return http_request;}; /**  * This class creates a new instance of restRequest  *  * @class WAF.core.restConnect.restRequest  *  * @constructor  * @param {Object} connectionMode  */WAF.core.restConnect.restRequest = function(connectionMode){    /**     * connectionMode     *     * @property connectionMode     * @type Object     **/	this.connectionMode = connectionMode;    /**     * fullURL     *     * @property fullURL     * @type String|null     * @default null     **/	this.fullURL = null;    /**     * httpMethod     *     * @property httpMethod     * @type String     * @default "GET"     **/	this.httpMethod = WAF.core.restConnect.httpMethods._get;    /**     * hostname     *     * @property hostname     * @type String     * @default ""     **/	this.hostname = "";    /**     * app     *     * @property app     * @type String     * @default ""     **/	this.app = WAF.config.pattern;    /**     * service     *     * @property service     * @type String     * @default "rest"     **/	this.service = WAF.core.restConnect.defaultService;    /**     * resource     *     * @property resource     * @type String     * @default ""     **/	this.resource = "";    /**     * attributesRequested     *     * @property attributesRequested     * @type String|undefined     * @default undefined     **/	this.attributesRequested = undefined;    /**     * keys     *     * @property keys     * @type Array     * @default []     **/	this.keys = [];	// Query String    /**     * expand     *     * @property expand     * @type Array     * @default []     **/	this.expand = [];    /**     * orderby     *     * @property orderby     * @type Array     * @default []     **/	this.orderby = [];    /**     * skip     *     * @property skip     * @type Number|null     * @default null     **/	this.skip = null;    /**     * top     *     * @property top     * @type Number|null     * @default null     **/	this.top = null;    /**     * filter     *     * @property filter     * @type String|null     * @default null     **/	this.filter = null;    /**     * method     *     * @property method     * @type String|null     * @default null     **/	this.method = null;    /**     * metadata     *     * @property metadata     * @type Object|null     * @default null     **/	this.metadata = null;    /**     * handler     *     * @property handler     * @type Function|null     * @default null     **/	this.handler = null;    /**     * postdata     *     * @property postdata     * @type String|null     * @default null     **/	this.postdata = null;    /**     * queryPlan     *     * @property queryPlan     * @type Object|null     * @default null     **/	this.queryPlan = null;	this.progressInfo = null;    /**     * distinct     *     * @property distinct     * @type Boolean     * @default false     **/	this.distinct = false;    /**     * refreshOnly     *     * @property refreshOnly     * @type Boolean     * @default false     **/	this.refreshOnly = false;    /**     * error     *     * @property error     * @type Object     * @default {key:0, string:""}     **/	this.error = {		key: 0,		string: ""	};    /**     * orderByArgsToString     *     * @method orderByArgsToString     * @return String     **/	this.orderByArgsToString = function()	{		var retString = "";		if (typeof this.orderby === 'string')		{			return this.orderby;		}		if (this.orderby.length > 0)		{			retString = this.orderby[0];		}		for (var i = 1; i < this.orderby.length; i++)		{			retString += "," + this.orderby[i];		}		return retString;	};    /**     * send the request     *     * @method go     * @return Boolean     **/	this.go = function(options)	{		var handler = this.handler;		// Build the url:		var url = WAF.core.restConnect.baseURL + "/";		// app (optional):		if (this.app != null)		{			url += this.app + "/";		}		// service:		if (this.service !== "")		{			url += this.service + "/";		}		else		{			this.error = WAF.core.restConnect.standardErrors._servicemissing;			return false;		}		// resource (optional):		if (this.resource !== "")		{			url += this.resource + "/";			// resource key (optional):			if (this.keys.length > 0)			{				url += "(";				for (var i = 0; i < this.keys.length; i++)				{					url += this.keys[i];					if (i < this.keys.length - 1)					{						url += ",";					}				}				url += ")";			}		}		var deja$ = false;		if (this.dataURI)		{			url = this.dataURI;			deja$ = (url.indexOf("?") !== -1);			if (!deja$)				url += "/";		}		var needToAddQuaestionMark = !deja$;		if (this.attributesRequested != undefined)		{			if (this.attributesRequested.length > 0)			{				url += this.attributesRequested[0];				for (var i = 1; i < this.attributesRequested.length; i++)				{					url += "," + this.attributesRequested[i];				}			}			url += "/";		}		// Build the queryString:		// --		var queryString = "";		// $skip and $top		if (this.skip)		{			queryString += (!deja$ ? "$skip=" : "&$skip=") + this.skip;			deja$ = true;		}		if (this.top)		{			queryString += (!deja$ ? "$top=" : "&$top=") + this.top;			deja$ = true;		}		// $filter		if (this.filter)		{			queryString += (!deja$ ? "$filter=" : "&$filter=") + encodeURIComponent("'"+this.filter+"'");			deja$ = true;		}		// $params		if (this.params)		{			queryString += (!deja$ ? "$params=" : "&$params=") + encodeURIComponent("'"+JSON.stringify(this.params)+"'");			deja$ = true;		}		// $method		if (this.method)		{			queryString += (!deja$ ? "$method=" : "&$method=") + this.method;			deja$ = true;		}		// $asArray		if (this.asArray)		{			queryString += (!deja$ ? "$asArray=" : "&$asArray=") + "true";			deja$ = true;		}		// $metadata		if (this.metadata)		{			queryString += (!deja$ ? "$metadata=" : "&$metadata=") + this.metadata;			deja$ = true;		}		// $distinct		if (this.distinct)		{			queryString += (!deja$ ? "$distinct=" : "&$distinct=") + this.distinct;			deja$ = true;		}		// $findKey		if (this.findKey != null)		{			queryString += (!deja$ ? "$findKey=" : "&$findKey=")+encodeURIComponent(""+this.findKey);			deja$ = true;		}		if (this.queryPlan)		{			queryString += (!deja$ ? "$queryplan=true&querypath=true" : "&$queryplan=true&querypath=true")			deja$ = true;		}		if (this.progressInfo)		{			queryString += (!deja$ ? "$progressinfo=" : "&$progressinfo=") + encodeURIComponent(this.progressInfo);			deja$ = true;		}		if (this.timeout)		{			queryString += (!deja$ ? "$timeout=" : "&$timeout=") + this.timeout;			deja$ = true;		}		if (this.savedQueryString) {			//queryString += (!deja$ ? "$savedfilter=" : "&$savedfilter=") + this.savedQueryString;			queryString += (!deja$ ? "$savedfilter=" : "&$savedfilter=") + encodeURIComponent("'"+this.savedQueryString+"'");			deja$ = true;		}		if (this.savedOrderby) {			queryString += (!deja$ ? "$savedorderby=" : "&$savedorderby=") + this.savedOrderby;			deja$ = true;		}		// $refresh		if (this.refreshOnly)		{			queryString+=(!deja$?"$refresh=":"&$refresh=")+this.refreshOnly;			deja$=true;		}		// $atOnce		if (this.atOnce)		{			queryString+=(!deja$?"$atOnce=":"&$atOnce=")+this.atOnce;			deja$=true;		}		// $removeFromSet		if (this.removeAtPos != null)		{			queryString+=(!deja$?"$removeFromSet=":"&$removeFromSet=")+this.removeAtPos;			deja$=true;		}		// $addToSet		if (this.addToSet != null)		{			queryString+=(!deja$?"$addToSet=":"&$addToSet=")+encodeURIComponent("'"+JSON.stringify(this.addToSet)+"'");			deja$=true;		}		// $fromSel		if (this.fromSelection != null)		{			queryString+=(!deja$?"$fromSel=":"&$fromSel=")+encodeURIComponent("'"+JSON.stringify(this.fromSelection)+"'");			deja$=true;		}		// $keepSel		if (this.keepSelection != null)		{			queryString+=(!deja$?"$keepSel=":"&$keepSel=")+encodeURIComponent("'"+JSON.stringify(this.keepSelection)+"'");			deja$=true;		}		// $orderby		if (this.orderby)		{			if (this.orderby.length)			{				if (!deja$)				{					queryString += "$orderby=" + this.orderByArgsToString();				}				else				{					queryString += "&$orderby=" + this.orderByArgsToString();				}				deja$ = true;			}		}		// $expand		if (this.attributesExpanded != undefined)		{			if (this.attributesExpanded.length > 0)			{				var expandString = "";				if (!deja$)				{					queryString += "$expand=";				}				else				{					queryString += "&$expand=";				}				deja$ = true;				for (var i = 0; i < this.attributesExpanded.length; i++)				{					if (expandString === "")					{						expandString += this.attributesExpanded[i];					}					else					{						expandString += "," + this.attributesExpanded[i];					}				}				queryString += expandString;			}		}		if (this.autoExpand != null && this.autoExpand != "")		{			if (!deja$)				{					queryString += "$expand=";				}				else				{					queryString += "&$expand=";				}				deja$ = true;				queryString += this.autoExpand;		}		if (this.autoSubExpand != null && this.autoSubExpand != "")		{			if (!deja$)				{					queryString += "$subExpand=";				}				else				{					queryString += "&$subExpand=";				}				deja$ = true;				queryString += this.autoSubExpand;		}		// Adds queryString to url		if (queryString !== "")		{			if (needToAddQuaestionMark)				url += "?";			url += queryString;		}		var command = "";		// hostname		if (this.httpMethod !== "")		{			command = this.httpMethod;		}		else		{			this.error = WAF.core.restConnect.httpMethods._get;		}		if ((this.postdata) && (command == WAF.core.restConnect.httpMethods._get))		{			this.error = WAF.core.restConnect.standardErrors._wronghttpmethod;			return false;		}		this.http_request = WAF.core.restConnect.getXMLHttpRequest();		if (!this.http_request)		{			return;		}		this.http_request.parent = this;		if (options && options.generateRESTRequestOnly)		{			return url;		}		else		{			if (handler != null)			{				this.http_request.onreadystatechange = function()				{					handler(this.parent);				};			}			try			{				if (this.fullURL)				{					url = this.fullURL;				}				this.http_request.open(command, url, this.connectionMode);				if (this.postdata)				{					this.http_request.setRequestHeader('Content-Type', 'application/json');				}				this.http_request.setRequestHeader('If-Modified-Since', 'Thu, 1 Jan 1970 00:00:00 GMT'); // due to IE9 caching XHR				this.http_request.setRequestHeader('Cache-Control', 'no-cache'); // due to IE9 caching XHR				this.http_request.send(this.postdata);				if (!this.connectionMode)				{					handler(this.http_request);				}				return true;			} catch (e)			{	            // TODO log the error	            return true;				//alert(e);			}		}		return false;	};};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Utils/Timers.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/** * @module Utils *//** * The Timers module is part of the Core and Utils composite * modules and implements 2 functions to time code execution. * * @class WAF.utils.timer */// Old global "private" container for timersWAF._private.globals.timers = [];(function (timers) {    /**     * This private variable stores starting date of each timers     *     * @private     * @property timers     * @type Array     */    timers = timers || [];    WAF.utils.timer = {        /**         * Start a timer identified by an id parameter         *         * @static         * @method start         * @param {String|Number} id Required.         */        start : function (id) {            if (timers[id] !== undefined) {                timers[id].start = new Date().getTime();            } else {                timers[id] = {                    start   : new Date().getTime(),                    duration: null                };            }        },        /**         * Get the time spent since a timer was started with this id         *         * @static         * @method getValue         * @param {String|Number} id Required.         * @return {Number|Null}         */        getValue : function (id) {            if (timers[id] !== undefined) {                return new Date().getTime() - timers[id].start;            } else {                return null;            }        }    };}(WAF._private.globals.timers));/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Utils/DebugTools.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * @module Utils **//** * The Debug module is part of the Core and Utils composite modules and implements various functions for debugging purposes. * * @class			WAF.utils.debug */WAF.utils.debug = {    /**     * console     *     * @class			WAF.utils.debug.console     */	console		: {        /**         * log the message to the console of the browser is the debugMode is set to true         *         * @static         * @method log         * @param {String} string         **/		log: function(string){			if (WAF.config.debugMode) {				if (typeof console  != "undefined") {					if (console.log) {						console.log(string);					}				}			}		},        /**         * show the object in the console of the browser is the debugMode is set to true         *         * @static         * @method dir         * @param {String} object         **/		dir: function(object){			if (WAF.config.debugMode) {				if (typeof console != "undefined") {					if (console.dir) {						console.dir(object);					}				}			}		}	}};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Utils/Environment.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * @module Utils **/// NOTE: It would be nice if we could remove this obsolet detection/** * User-agent environment * * @class WAF.utils.environment **/WAF.utils.environment = {};/** * User-agent environment detection * * @static * @method browserDetect **/WAF.utils.environment.browserDetect = function(){    var ua = navigator.userAgent;    /**     * User-agent environment     *     * @class WAF.utils.environment.browser     **/	WAF.utils.environment.browser = {};    /**     * Internet Explorer     *     * @static     * @property ie     * @type Boolean     **/    WAF.utils.environment.browser.ie = false;    /**     * Internet Explorer 6     *     * @static     * @property ie6     * @type Boolean     **/    WAF.utils.environment.browser.ie6 = false;    /**     * Internet Explorer 7     *     * @static     * @property ie7     * @type Boolean     **/    WAF.utils.environment.browser.ie7 = false;    /**     * Gecko     *     * @static     * @property gecko     * @type Boolean     **/    WAF.utils.environment.browser.gecko = false;    /**     * Safari     *     * @static     * @property safari     * @type Boolean     **/    WAF.utils.environment.browser.safari = false;    /**     * Safari 2     *     * @static     * @property safari2     * @type Boolean     **/    WAF.utils.environment.browser.safari2 = false;    /**     * Safari 3     *     * @static     * @property safari3     * @type Boolean     **/    WAF.utils.environment.browser.safari3 = false;    /**     * Firefox 3     *     * @static     * @property firefox3     * @type Boolean     **/    WAF.utils.environment.browser.firefox3 = false;    if (ua.indexOf('Firefox/3') >= 0) {		WAF.utils.environment.browser.firefox3 = true;	}	else {		if (ua.indexOf("MSIE") >= 0) {			WAF.utils.environment.browser.ie = true;			if (ua.indexOf("MSIE 7") >= 0) {				WAF.utils.environment.browser.ie7 = true;			}			if (ua.indexOf("MSIE 6") >= 0) {				WAF.utils.environment.browser.ie6 = true;			}		}		else {			if (ua.indexOf("iPhone") >= 0) {				WAF.utils.environment.browser.iphone = true;				WAF.utils.environment.browser.safari = true;			}			else {				if (ua.indexOf("WebKit") >= 0) {					WAF.utils.environment.browser.safari = true;					if (ua.indexOf("Version/3") >= 0) {						WAF.utils.environment.browser.safari3 = true;					}					else {						WAF.utils.environment.browser.safari2 = true;					}				}				else {					if (ua.indexOf("Gecko") >= 0) {						WAF.utils.environment.browser.gecko = true;					}				}			}		}	}}WAF.utils.environment.browserDetect();/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Utils/Strings.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** *  @module Utils */ String.prototype.capitalize = function(){	if (this.length > 1)	{		return this[0].toUpperCase()+this.substring(1).toLowerCase();	}	else		return this.toUpperCase();}String.prototype.capitalizeEachWord = function(){	var result = this.split(" ");        for (var i = 0, nbElems = result.length; i < nbElems; i++)	{		var elem = result[i];		if ( (typeof elem == "string") || (elem instanceof String) )			result[i] = elem.capitalize();	}	return result.join(" ");}/** * @class WAF.utils **/WAF.utils.getBoolValue = function(text){	if (text == null)		return false;	else	{		if (typeof text == 'string')		{			if (text.toLowerCase() == 'true')				return true;			else				return false;		}		else			return text;	}}/** * getBrowserLang * * @static * @method getBrowserLang * @return {String} **/WAF.utils.getBrowserLang = function(){	var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || 'us').substr(0, 2).toLowerCase();	return lang;};WAF.utils.formatString = function(value, options){	var result;	if (options == null || value == null)	{		result = value;	}	else	{		if (typeof options === 'string')			options = { format: options};		switch (options.format)		{			case 'U':				result = value.toUpperCase();				break;			case 'l':				result = value.toLowerCase();				break;			case 'C':				result = value.capitalize();				break;			case 'c':				result = value.capitalizeEachWord();				break;			default:				result = value;		}	}	return result;}/** * formatDate * * @static * @method formatDate * @param {String} value * @param {Object} xoptions * @return {String} **/WAF.utils.formatDate = function(value, xoptions){	if (xoptions == null)	{		xoptions = { format: "" };	}	var options = { format: xoptions.format, locale: xoptions.locale };	if (options.locale == null)		options.locale = WAF.utils.getBrowserLang();	var settings = null;	if (options.locale != null)	{		if (options.locale == "us" || options.locale == "en")			options.locale = '';		settings = $.datepicker.regional[options.locale];		if (settings != null) {			if ((options.format == null || options.format == "") && settings.dateFormat != null)				options.format = settings.dateFormat;		}	}	if (options.format == null || options.format == "")	{		options.format = "mm/dd/yy";	}	return $.datepicker.formatDate(options.format, value, settings)};/** * formatNumber * * @static * @method formatNumber * @param {Number} value * @param {Object} xoptions * @return {String} **/WAF.utils.formatNumber = function(value, xoptions){	function FormatData(dec, group, neg)	{		this.dec = dec;		this.group = group;		this.neg = neg;	};	function formatCodes(locale)	{		var dec = ".";		var group = ",";		var neg = "-";		if (locale == "us" ||             locale == "ae" ||             locale == "eg" ||             locale == "il" ||             locale == "jp" ||             locale == "sk" ||             locale == "th" ||             locale == "cn" ||             locale == "hk" ||             locale == "tw" ||             locale == "au" ||             locale == "ca" ||             locale == "gb" ||             locale == "in"            )		{			dec = ".";			group = ",";		}		else if (locale == "de" ||             locale == "vn" ||             locale == "es" ||             locale == "dk" ||             locale == "at" ||             locale == "gr" ||             locale == "br"            )		{			dec = ",";			group = ".";		}		else if (locale == "cz" ||              locale == "fr" ||             locale == "fi" ||             locale == "ru" ||             locale == "se"            )		{			group = " ";			dec = ",";		}		else if (locale == "ch")		{			group = "'";			dec = ".";		}		return new FormatData(dec, group, neg);	};	if (xoptions == null)	{		xoptions = { format: "" };	}	var options = { format: xoptions.format, locale: xoptions.locale };	if (options.locale == null)		options.locale = WAF.utils.getBrowserLang();	var returnString = String(value);	if (options.format == null || options.format == "")		return returnString;	else	{		var formatData = formatCodes(options.locale.toLowerCase());		var dec = formatData.dec;		var group = formatData.group;		var neg = formatData.neg;		var validFormat = "0#-,.";		var prefix = "";		var negativeInFront = false;		for (var i = 0; i < options.format.length; i++)		{			if (validFormat.indexOf(options.format.charAt(i)) == -1)				prefix = prefix + options.format.charAt(i);			else if (i == 0 && options.format.charAt(i) == '-')			{				negativeInFront = true;				continue;			}			else				break;		}		var suffix = "";		for (var i = options.format.length - 1; i >= 0; i--)		{			if (validFormat.indexOf(options.format.charAt(i)) == -1)				suffix = options.format.charAt(i) + suffix;			else				break;		}		options.format = options.format.substring(prefix.length);		options.format = options.format.substring(0, options.format.length - suffix.length);		var number = value;		if (suffix == "%")			number = number * 100;		var returnString = "";		var decimalValue = number % 1;		if (options.format.indexOf(".") > -1)		{			var decimalPortion = dec;			var decimalFormat = options.format.substring(options.format.lastIndexOf(".") + 1);			var decimalString = new String(decimalValue.toFixed(decimalFormat.length));			decimalString = decimalString.substring(decimalString.lastIndexOf(".") + 1);			for (var i = 0; i < decimalFormat.length; i++)			{				if (decimalFormat.charAt(i) == '#' && decimalString.charAt(i) != '0')				{					decimalPortion += decimalString.charAt(i);					break;				}				else if (decimalFormat.charAt(i) == "0")				{					decimalPortion += decimalString.charAt(i);				}			}			if (decimalPortion != dec)				returnString += decimalPortion;		}		else			number = Math.round(number);		var ones = Math.floor(number);		if (number < 0)			ones = Math.ceil(number);		var onePortion = "";		if (ones == 0)		{			onePortion = "0";		}		else		{			var onesFormat = "";			if (options.format.indexOf(".") == -1)				onesFormat = options.format;			else				onesFormat = options.format.substring(0, options.format.indexOf("."));			var oneText = new String(ones);			var groupLength = 9999;			if (onesFormat.lastIndexOf(",") != -1)				groupLength = onesFormat.length - onesFormat.lastIndexOf(",") - 1;			var groupCount = 0;			for (var i = oneText.length - 1; i > -1; i--)			{				onePortion = oneText.charAt(i) + onePortion;				groupCount++;				if (groupCount == groupLength && i != 0)				{					onePortion = group + onePortion;					groupCount = 0;				}			}		}		returnString = onePortion + returnString;		if (number < 0 && negativeInFront && prefix.length > 0)		{			returnString = returnString.substring(1);			prefix = neg + prefix;		}		returnString = prefix + returnString + suffix;		return returnString;	}};/** * String util * * @class WAF.utils.string **/WAF.utils.string = {	/**	 * replace	 *     * @static     * @method replace	 * @param {String} sString	 * @param {String} sReplaceThis	 * @param {String} sWithThis	 * @return {String}	 */	replace : function (sString, sReplaceThis, sWithThis) {		if ((sReplaceThis !== "") && (sReplaceThis !== sWithThis)) {			var counter = 0;			var start = 0;			var before = "";			var after = "";			while (counter<sString.length) {				start = sString.indexOf(sReplaceThis, counter);				if (start == -1){					break;				} else {					before = sString.substr(0, start);					after = sString.substr(start + sReplaceThis.length, sString.length);					sString = before + sWithThis + after;					counter = before.length + sWithThis.length;				}			}		}		return sString;	}};WAF.utils.init = function(){	var lang = WAF.utils.getBrowserLang();	var dateOptions = $.datepicker.regional[lang];	if (dateOptions != null)	{		$.datepicker.setDefaults(dateOptions);		WAF.utils.dateInputFormat = dateOptions.dateFormat || "m/d/yy";	}	else		WAF.utils.dateInputFormat = "m/d/yy";}// WARNING: HTMLEncode is created in the global scope/*HTMLEncode - Encode HTML special characters.Copyright (c) 2006 Thomas Peri, http://www.tumuski.com/Permission is hereby granted, free of charge, to any person obtaining acopy of this software and associated documentation files (the"Software"), to deal in the Software without restriction, includingwithout limitation the rights to use, copy, modify, merge, publish,distribute, sublicense, and/or sell copies of the Software, and topermit persons to whom the Software is furnished to do so, subject tothe following conditions:The Software shall be used for Good, not Evil.The above copyright notice and this permission notice shall be includedin all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESSOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OFMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANYCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THESOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.*//** * HTML-Encode the supplied input * * Parameters: * * (String)  source    The text to be encoded. * * (boolean) display   The output is intended for display. * *                     If true: *                     * Tabs will be expanded to the number of spaces *                       indicated by the 'tabs' argument. *                     * Line breaks will be converted to <br />. * *                     If false: *                     * Tabs and linebreaks get turned into &#____; *                       entities just like all other control characters. * * (integer) tabs      The number of spaces to expand tabs to.  (Ignored *                     when the 'display' parameter evaluates to false.) * * v 0.3 - January 4, 2006 */function htmlEncode(source, display, tabs){	function special(source)	{		var result = '';		for (var i = 0; i < source.length; i++)		{			var c = source.charAt(i);			if (c < ' ' || c > '~')			{				c = '&#' + c.charCodeAt() + ';';			}			result += c;		}		return result;	}	function format(source)	{		// Use only integer part of tabs, and default to 4		tabs = (tabs >= 0) ? Math.floor(tabs) : 4;		// split along line breaks		var lines = source.split(/\r\n|\r|\n/);		// expand tabs		for (var i = 0; i < lines.length; i++)		{			var line = lines[i];			var newLine = '';			for (var p = 0; p < line.length; p++)			{				var c = line.charAt(p);				if (c === '\t')				{					var spaces = tabs - (newLine.length % tabs);					for (var s = 0; s < spaces; s++)					{						newLine += ' ';					}				}				else				{					newLine += c;				}			}			// If a line starts or ends with a space, it evaporates in html			// unless it's an nbsp.			newLine = newLine.replace(/(^ )|( $)/g, '&nbsp;');			lines[i] = newLine;		}		// re-join lines		var result = lines.join('<br />');		// break up contiguous blocks of spaces with non-breaking spaces		result = result.replace(/  /g, ' &nbsp;');		// tada!		return result;	}	var result = source;	// ampersands (&)	result = result.replace(/\&/g,'&amp;');	// less-thans (<)	result = result.replace(/\</g,'&lt;');	// greater-thans (>)	result = result.replace(/\>/g,'&gt;');	if (display)	{		// format for display		result = format(result);	}	else	{		// Replace quotes if it isn't for display,		// since it's probably going in an html attribute.		result = result.replace(new RegExp('"','g'), '&quot;');	}	// special characters	result = special(result);	// tada!	return result;}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Core/Utils/Dates.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/// WARNING : ISOToDate is published to the global scopefunction ISOToDate(string){	var dd = new Date();	dd.setISO(string);	return dd;}Date.prototype.setISO = function (string) {    var regexp = "([0-9]{4})(-([0-9]{2})(-([0-9]{2})" +        "(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?" +        "(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";    var d = string.match(new RegExp(regexp));    var offset = 0;    var date = new Date(d[1], 0, 1);    if (d[3]) { date.setMonth(d[3] - 1); }    if (d[5]) { date.setDate(d[5]); }    if (d[7]) { date.setHours(d[7]); }    if (d[8]) { date.setMinutes(d[8]); }    if (d[10]) { date.setSeconds(d[10]); }    if (d[12]) { date.setMilliseconds(Number("0." + d[12]) * 1000); }    if (d[14]) {        offset = (Number(d[16]) * 60) + Number(d[17]);        offset *= ((d[15] == '-') ? 1 : -1);    }    offset -= date.getTimezoneOffset();    time = (Number(date) + (offset * 60 * 1000));    this.setTime(Number(time));}Date.prototype.toISO = function (format, offset) {    /* accepted values for the format [1-6]:     1 Year:       YYYY (eg 1997)     2 Year and month:       YYYY-MM (eg 1997-07)     3 Complete date:       YYYY-MM-DD (eg 1997-07-16)     4 Complete date plus hours and minutes:       YYYY-MM-DDThh:mmTZD (eg 1997-07-16T19:20+01:00)     5 Complete date plus hours, minutes and seconds:       YYYY-MM-DDThh:mm:ssTZD (eg 1997-07-16T19:20:30+01:00)     6 Complete date plus hours, minutes, seconds and a decimal       fraction of a second       YYYY-MM-DDThh:mm:ss.sTZD (eg 1997-07-16T19:20:30.45+01:00)    */    if (!format) { var format = 6; }    if (!offset) {        var offset = 'Z';        var date = this;    } else {        var d = offset.match(/([-+])([0-9]{2}):([0-9]{2})/);        var offsetnum = (Number(d[2]) * 60) + Number(d[3]);        offsetnum *= ((d[1] == '-') ? -1 : 1);        var date = new Date(Number(Number(this) + (offsetnum * 60000)));    }    var zeropad = function (num) { return ((num < 10) ? '0' : '') + num; }    var str = "";    str += date.getUTCFullYear();    if (format > 1) { str += "-" + zeropad(date.getUTCMonth() + 1); }    if (format > 2) { str += "-" + zeropad(date.getUTCDate()); }    if (format > 3) {        str += "T" + zeropad(date.getUTCHours()) +               ":" + zeropad(date.getUTCMinutes());    }    if (format > 5) {        var secs = Number(date.getUTCSeconds() + "." +                   ((date.getUTCMilliseconds() < 100) ? '0' : '') +                   zeropad(date.getUTCMilliseconds()));        str += ":" + zeropad(secs);    } else if (format > 4) { str += ":" + zeropad(date.getUTCSeconds()); }    if (format > 3) { str += offset; }    return str;};Date.prototype.isValid = function(){	return !isNaN(this.getTime());}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/DataProvider/Data-Provider.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//*WAF.dataProvider = {};*/WAF.callHandler = function(withError, errorInfo, event, options, userData){	var result = null;	event.userData = userData;  	if (withError)	{		var onError = options.onError;		event.error = errorInfo;		if (onError != null)			result = onError(event);	}	else	{		var onsuccess = options.onSuccess;		if (onsuccess != null)			result = onsuccess(event);	}	return result;}WAF.getRequestResult = function(request){	var response = request.http_request.responseText;	var result;	if (response == null)		result = {  __ERROR:[{errCode:-1}]};	else	{		try		{			result = JSON.parse(response);		}		catch (e)		{			result = {  __ERROR:[e]};		}	}	return result;}WAF.tools = {};WAF.tools.optionMatchers = [		"onSuccess",		"onError",		"atTheEnd",		"sync",		"autoExpand",		"autoSubExpand",		"catalog",		"queryString",		"skip",		"top",		"position",		"orderby",		"orderBy",		"params",		"queryPlan",		"queryPath",		"pageSize",		"filterSet",		"progressInfo",		"progressBar",		"delay",		"delayInfo",		"method",		"first",		"limit",		"userData",		"addToSet",		"atOnce",		"refreshOnly",		"keepOldCollectionOnError",		"isMethodResult",		"prefetchedData",		"callWithGet",		"generateRESTRequestOnly",		"forceReload",		"doNotAlterElemPos",		"overrideStamp",		"queryParams",		"createEmptyCollection"	];WAF.tools.isOptionParam = function(param){	var result = false;	if (param != null)	{		if (typeof param === 'object')		{			var op = WAF.tools.optionMatchers;			var len = op.length;			for (var i = 0; i < len && !result; ++i)			{				var s = op[i];				if (s in param)				{					result = true;					break;				}			}		}	}	return result;}WAF.tools.handleArgs = function(args, startingFrom, handleOptions){	var alreadyOptions = false;	handleOptions = handleOptions || {};	startingFrom = startingFrom || 0;	var noUserData = handleOptions.noUserData || false;	var with3funcs = handleOptions.with3funcs || false;	var queryParams = handleOptions.queryParams || false;	var res = { options: {}, userData: null};	var p;	var nbparam = args.length;	var nextparam = startingFrom;	if (nextparam < nbparam)	{		p = args[nextparam];		if (typeof p === 'function')		{			res.options.onSuccess = p;			++nextparam;			if (nextparam < nbparam)			{				p = args[nextparam];				if (typeof p === 'function')				{					res.options.onError = p;					++nextparam;					if (nextparam < nbparam)					{						p = args[nextparam];						if (with3funcs && typeof p === 'function')						{							res.options.atTheEnd = p;							++nextparam;						}					}				}			}			if (res.options.onError == null)				res.options.onError = res.options.onSuccess;		}	}	var params = null;	if (queryParams) {		params = [];	}	do	{		if (nextparam < nbparam)		{			p = args[nextparam];			if (!alreadyOptions && WAF.tools.isOptionParam(p))			{				alreadyOptions = true;				++nextparam;				var oldoptions = res.options				res.options = p;				if (oldoptions.onSuccess != null)					res.options.onSuccess = oldoptions.onSuccess;				if (oldoptions.onError != null)					res.options.onError = oldoptions.onError;				if (oldoptions.atTheEnd != null)					res.options.atTheEnd = oldoptions.atTheEnd;				if (!queryParams)				{					if (nextparam < nbparam && !noUserData)					{						res.userData = args[nextparam];						++nextparam;					}				}			}			else			{				if (queryParams)				{					if (typeof p === "object" && !(p instanceof Date) && !(p instanceof Array))					{						//cont = false;						res.userData = p;						++nextparam;					}					else					{						params.push(p);						++nextparam;					}				}			}		}	} while (queryParams && (nextparam < nbparam));	if (res.options.userData != null && res.userData == null)		res.userData = res.options.userData;	if (queryParams) {		res.options.params = res.options.params || params;	}	res.nextParam = nextparam;	return res;}// ----------------------------------------- Cache Manager -------------------------------------------------------WAF.EntityCache = function(options){	// options.timeOut   in milliseconds	// options.maxEntities	options = options || {};	var cache = this;	this.maxEntities = options.maxEntities || 300;	this.timeOut = options.timeOut || 5 * 60 * 1000; // 5 min	this.entitiesByKey = {};	this.nbEntries = 0;	this.curStamp = 0;	this.clear = WAF.EntityCache.clear;	this.setEntry = WAF.EntityCache.setEntry;	this.makeRoomFor = WAF.EntityCache.makeRoomFor;	this.getCacheInfo = WAF.EntityCache.getCacheInfo;	this.getNextStamp = WAF.EntityCache.getNextStamp;	this.replaceCachedEntity = WAF.EntityCache.replaceCachedEntity;	this.removeCachedEntity = WAF.EntityCache.removeCachedEntity;	this.setSize = WAF.EntityCache.setSize;}WAF.EntityCache.getNextStamp = function(){	var cache = this;	cache.curStamp++;	return cache.curStamp;}WAF.EntityCache.clear = function(nbToClear){	var cache = this;	if (nbToClear == null || nbToClear >= cache.nbEntries)	{		cache.entitiesByKey = {};		cache.nbEntries = 0;	}	else	{		var all = [];		var map = cache.entitiesByKey;		for (var e in map)		{			all.push(map[e]);		}		all.sort(function(e1,e2)		{			return e1.timeStamp > e2.timeStamp ? 1 : -1;  // reverse order , older first		});		var nbelem = nbToClear;		if (nbelem > all.length)			nbelem = all.length;		var nbEntries = cache.nbEntries;		for (var i = 0; i < nbelem; i++)		{			var entry = all[i];			delete map[entry.key];			--nbEntries;		}		cache.nbEntries = nbEntries;		delete all; // just to speed up garbage collector on some implementations	}}WAF.EntityCache.makeRoomFor = function(nbEntities){	var cache = this;	if (cache.maxEntities < (nbEntities * 2))		cache.maxEntities = nbEntities * 2;	var remain = cache.maxEntities - cache.nbEntries;	if (remain < nbEntities)	{		cache.clear(nbEntities-remain);	}}WAF.EntityCache.setEntry = function(key, rawEntity, timeStamp, options){	var cache = this;	var map = cache.entitiesByKey;	var elem = map[key];	if (elem == null)	{		if (cache.nbEntries >= cache.maxEntities)		{			cache.clear(Math.round(cache.nbEntries / 3));		}		cache.nbEntries++;	}	var newStamp = cache.getNextStamp();	map[key] = { key:key, timeStamp:timeStamp, rawEntity:rawEntity, stamp:newStamp };	return newStamp;}WAF.EntityCache.getCacheInfo = function(key){	var cache = this;	var elem = cache.entitiesByKey[key];	return elem; // may be null}WAF.EntityCache.replaceCachedEntity = function(key, rawEntity){	var cache = this;	var elem = cache.entitiesByKey[key];	if (elem != null)	{		elem.timeStamp = new Date();		elem.rawEntity = rawEntity;		elem.stamp = cache.getNextStamp();	}}WAF.EntityCache.removeCachedEntity = function(key){	var cache = this;	var elem = cache.entitiesByKey[key];	if (elem != null)	{		delete cache.entitiesByKey[key];	}}WAF.EntityCache.setSize = function(nbEntries){	if (nbEntries == null || nbEntries < 300)		nbEntries = 300;	this.maxEntities = nbEntries;}// ----------------------------------------- DataStore -----------------------------------------------------------WAF.DataStore = function(options, userData){	// options.catalog Array of datastore class names or string like "class1,class2,..." or null for all	// options.onSuccess when catalog is loaded	// options.onError if errors	// options.userData	options = options || {};	userData = userData;	var dataStore = this;	this._private =	{		owner: this,		dataClasses: {},		//dataClassesBySingleName: {},		dataClassesByCollectionName: {},		ready: false,		getCatalog: WAF.DataStore.getCatalog	};	this.getDataClass = WAF.DataStore.getDataClass;	this.getDataClasses = WAF.DataStore.getDataClasses;	dataStore._private.getCatalog(options, userData);}WAF.DataStore.getDataClass = function(name){	var priv = this._private;	var dataClass = priv.dataClasses[name];	if (dataClass == null)		dataClass = priv.dataClassesByCollectionName[name];		/*	if (dataClass == null)		dataClass = priv.dataClassesBySingleName[name];		*/	return dataClass;}WAF.DataStore.getDataClasses = function(){	var priv = this._private;	return priv.dataClasses;}WAF.DataStore.resolveRelatedAttribute = function(){	// this est un attribut de datastore class	if (!this.resolved)	{		var dataStore = this.owner.getDataStore();		this.relatedClass = dataStore.getDataClass(this.type);		this.resolved = true;	}}WAF.DataStore.getRelatedClassAttribute = function(){	this.resolve();	return this.relatedClass;}WAF.DataStore.handleFuncResult = function(request, methodref, dataClass){	var fullResult = WAF.getRequestResult(request);	if (fullResult.__ERROR == null)	{		if (fullResult.__entityModel != null)		{			dataClass = dataClass.getDataStore().getDataClass(fullResult.__entityModel);		}		if (fullResult.__KEY != null)		{			var entity = new WAF.Entity(dataClass, fullResult);			fullResult = { result: entity};		}		else if (fullResult.__ENTITIES != null)		{			var entityCollection = new WAF.EntityCollection(dataClass, null,			{				prefetchedData: fullResult,				isMethodResult: true			});			fullResult = { result: entityCollection};		}	}	return fullResult;}WAF.DataStore.funcCaller = function(methodref, from, params, options){	var result = null;	options = options || {};	var oktogo = true;	var sync = options.sync || false;	var callWithGet = methodref.callWithGet || options.callWithGet || false;	var generateRESTRequestOnly = options.generateRESTRequestOnly || false;    var request = new WAF.core.restConnect.restRequest(!sync);    //request.app = "";	if (callWithGet)		request.httpMethod = WAF.core.restConnect.httpMethods._get;	else    	request.httpMethod = WAF.core.restConnect.httpMethods._post;	var entity = null;	var dataClass = null;	var entityCollection = null;	var jsonargs = JSON.stringify(params);	if (callWithGet)		request.params = params;	else    	request.postdata = jsonargs;	if (methodref.applyTo == "entity")	{		entity = from;		dataClass = entity.getDataClass();		request.attributesRequested = [ methodref.name ];		request.resource = dataClass.getName() + '(';		var key = entity.getKey();		if (key != null)			request.resource += key;		request.resource += ')';	}	else if (methodref.applyTo == "entityCollection")	{		entityCollection = from;		dataClass = entityCollection.getDataClass();		if (entityCollection._private.dataURI != null)			request.dataURI = entityCollection._private.dataURI + "/" + methodref.name;		else		{			request.attributesRequested = [ methodref.name ];			request.resource = dataClass.getName();            request.filter = sel.queryString;		}		entityCollection._private.updateOptions(options);	}	else if (methodref.applyTo == "general")	{		request.resource = methodref.nameSpace;		request.attributesRequested = [ methodref.name ];	}	else	{		dataClass = from;        request.attributesRequested = [ methodref.name ];        request.resource = dataClass.getName();	}	var pageSize = options.pageSize || 40;	request.top = pageSize;	request.method = "entityset";	request.timeout = 300;	request.addToSet = options.addToSet;	if (options.autoExpand != null)	{		request.autoExpand = options.autoExpand;	}	//var autoExpand = ???	//request.autoExpand = priv.autoExpand;	if (!sync)	{		request.handler = function()		{			if (request.http_request.readyState != 4)			{	        	return;	    	}			var fullResult = WAF.DataStore.handleFuncResult(request, methodref, dataClass);			var event = {result: fullResult.result};			var err = fullResult.__ERROR;			var userData = options.userData || null;			event.XHR = request.http_request;			WAF.callHandler(err != null, err, event, options, userData);		}	}	if (generateRESTRequestOnly)		result = request.go({generateRESTRequestOnly:true});	else	{		request.go();		if (sync)		{			if (request.http_request.readyState != 4)			{				throw {	                    error : 401	            };			}			else			{				var fullResult = WAF.DataStore.handleFuncResult(request, methodref, dataClass);				if (fullResult.__ERROR != null)	            {	                throw (fullResult.__ERROR);	            }	            else	            {	                result = fullResult.result;	            }			}		}	}	return result;}WAF.DataStore.callMethod = function(options){	var result = null;	var em = this;	var methodRef = em._private.dataClassMethodRefs[options.method];	if (methodRef != null)	{		var myargs = [];		if (options.arguments != null)		{			myargs = options.arguments;		}		else		{	        for (var i = 1,nb = arguments.length; i < nb; i++) // The first one is skipped.	        {	            myargs.push(arguments[i]);	        }		}		result = WAF.DataStore.funcCaller(methodRef, em, myargs, options);	}	return result;}WAF.DataStore.makeFuncCaller = function(methodRef){	var methodref = methodRef;	var func = function()	{		var options;		var alreadyParsedOptions = false;		var myargs = [];        for (var i = 0 ,nb = arguments.length; i < nb; i++)        {			var p = arguments[i];			if (!alreadyParsedOptions && WAF.tools.isOptionParam(p)) {				options = p;				alreadyParsedOptions = true;			}			else				myargs.push(p);        }		var xoptions = options || {};		if (xoptions.onSuccess === undefined && xoptions.onError === undefined && xoptions.generateRESTRequestOnly === undefined)		{			xoptions.sync = true;		}		return WAF.DataStore.funcCaller(methodref, this, myargs, xoptions);	}	return func;}WAF.DataStore.getCatalog = function(options, userData){	// this est un DataStore.private	// options.catalog Array of datastore class names or string like "class1,class2,..." or null for all	// options.onSuccess when catalog is loaded	// options.onError if errors	var priv = this;	var dataStore = this.owner;	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var catResource = "$all";	if (options.catalog != null)	{		if (typeof(options.catalog) == 'string')			catResource = options.catalog;		else			catResource = options.catalog.join(",");	};	catResource = "$catalog/"+catResource;	var request = new WAF.core.restConnect.restRequest(true);    //request.app = "";    //request.resource = "$catalog/$all";	request.resource = catResource;	 request.handler = function()	 {        if (request.http_request.readyState != 4) {            return;        }        var error = false;		var entitiesList;		var err = null;        try        {			var result = WAF.getRequestResult(request);			entitiesList = result.dataClasses;			if (entitiesList == null)				entitiesList = [];			if (result.__ERROR != null)			{				error = true;				err = result.__ERROR;			}		}		catch (e)		{			entitiesList = [];			error = true;			err = e;		}		for (var i = 0, nb = entitiesList.length; i < nb; i++)		{			var dataClassInfo = entitiesList[i];			var emName = dataClassInfo.name;			//var singleName = dataClassInfo.singleEntityName;			var collectionName = dataClassInfo.collectionName;			var dataClass = new WAF.DataClass(dataClassInfo, dataStore);			priv.dataClasses[emName] = dataClass;			/*			if (singleName != null)				priv.dataClassesBySingleName[singleName] = dataClass;				*/			if (collectionName != null)				priv.dataClassesByCollectionName[collectionName] = dataClass;			dataStore[emName] = dataClass;		}        priv.ready = true;		var event = { dataStore: dataStore};		event.XHR = request.http_request;		WAF.callHandler(error, err, event, options, userData);    };    var errorFlag = request.go();}WAF.DataClass = function(dataClassInfo, dataStore){	var dataClass = this;	/*	if (dataClassInfo.singleEntityName)		dataClass.singleEntityName = dataClassInfo.singleEntityName;		*/	dataClass._private = {		className: dataClassInfo.name,		collectionName: dataClassInfo.collectionName,		attributesByName: {},		entityMethods: {},		entityCollectionMethods: {},		//dataClassMethods: {},		entityMethodRefs: {},		entityCollectionMethodRefs: {},		dataClassMethodRefs: {},		owner: dataClass,		dataStore: dataStore,		cache: new WAF.EntityCache(),		defaultTopSize : dataClassInfo.defaultTopSize,		getEntityByURIOrKey: WAF.DataClass.getEntityByURIOrKey	};	var priv = dataClass._private;	var attsByName = priv.attributesByName;	var dataClassMethodRefs = priv.dataClassMethodRefs;	var entityCollectionMethodRefs = priv.entityCollectionMethodRefs;	var entityMethodRefs = priv.entityMethodRefs;	var entityCollectionMethods = priv.entityCollectionMethods;	var entityMethods = priv.entityMethods;	var attributes = dataClassInfo.attributes;	var methods = dataClassInfo.methods;	priv.methods = methods;	if (attributes != null)	{		for (var j = 0, nbatt = attributes.length; j < nbatt; j++)		{			var att = attributes[j];			att.owner = dataClass;			attsByName[att.name] = att;			if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias" || att.kind == "composition")			{				att.simple = true;				att.related = false;				if (att.type == "image" || att.type == "blob")					att.simple = false;			}			else			{				att.simple = false;				att.related = true;				att.resolved = false;				att.relatedOne = (att.kind == "relatedEntity");				att.resolve = WAF.DataStore.resolveRelatedAttribute;				att.getRelatedClass = WAF.DataStore.getRelatedClassAttribute;				att.relatedClass = null;			}			dataClass[att.name] = att;		}	}	priv.attributes = attributes;	var methlist = methods;	if (methlist != null)	{		for (var j = 0, nbmethod = methlist.length; j < nbmethod; j++)		{			var methodRef = methlist[j];			if (methodRef.applyTo == "entity")			{				entityMethodRefs[methodRef.name] = methodRef;				entityMethods[methodRef.name] = WAF.DataStore.makeFuncCaller(methodRef);			}			else if (methodRef.applyTo == "entityCollection")			{				entityCollectionMethodRefs[methodRef.name] = methodRef;				entityCollectionMethods[methodRef.name] = WAF.DataStore.makeFuncCaller(methodRef);			}			else			{				dataClassMethodRefs[methodRef.name] = methodRef;				dataClass[methodRef.name] = WAF.DataStore.makeFuncCaller(methodRef);			}		}	}	return this;}// private functionWAF.DataClass.getEntityByURIOrKey = function(key, dataURI, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 2);	userData = resOp.userData;	options = resOp.options;	var priv = this; // dataClass._private;	var dataClass = priv.owner;	var request = new WAF.core.restConnect.restRequest(true);	if (dataURI != null)	{		request.fullURL = dataURI;	}	else	{		request.resource = dataClass.getName()+ "("+key+")";	}	request.autoExpand = options.autoExpand;	request.autoSubExpand = options.autoSubExpand;	request.handler = function()	{		if (request.http_request.readyState != 4) {            return;        }		var error = false;		var err = null;		var result = WAF.getRequestResult(request);		if (result.__ERROR != null)		{			error = true;			err = result.__ERROR;		}		var entity = null;		if (!error)		{			entity = new WAF.Entity(dataClass, result);			var key = entity.getKey();			var cache = dataClass.getCache();			var cacheInfo = cache.getCacheInfo(key);			if (cacheInfo == null)			{				var timeStamp = new Date();				cache.setEntry(key, result, timeStamp);			}			else			{				cache.replaceCachedEntity(key, result);			}		}		var event = {entity:entity};		event.XHR = request.http_request;		WAF.callHandler(error, err, event, options, userData);	}	 var errorFlag = request.go();}// public functionsWAF.DataClass.getName = function(){	return this._private.className;}WAF.DataClass.getCollectionName = function(){	return this._private.collectionName;}WAF.DataClass.getDefaultTopSize = function(){	return this._private.defaultTopSize;}WAF.DataClass.getDataStore = function(){	return this._private.dataStore;}WAF.DataClass.getCache = function(){	return this._private.cache;}WAF.DataClass.setCacheSize = function(nbEntries){	var cache = this._private.cache;	cache.setSize(nbEntries);}WAF.DataClass.getCacheSize = function(){	var cache = this._private.cache;	return cache.maxEntities;}WAF.DataClass.clearCache = function(){	var cache = this._private.cache;	cache.clear();}WAF.DataClass.getAttributeByName = function(attName){	var dataClass = this;	return dataClass._private.attributesByName[attName];}WAF.DataClass.getAttributes = function(){	var dataClass = this;	return dataClass._private.attributes;}WAF.DataClass.getMethodList = function(){	var dataClass = this;	return dataClass._private.methods;}WAF.DataClass.newEntity = function(){	var entity = new WAF.Entity(this);	return entity;}WAF.DataClass.getEntity = function(key, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var dataClass = this;	var cache = dataClass.getCache();	var cacheInfo;	if (options.forceReload)		cacheInfo = null;	else		cacheInfo = cache.getCacheInfo(key);	if (cacheInfo == null || cacheInfo.rawEntity == null)	{		dataClass._private.getEntityByURIOrKey(key, null, options, userData);	}	else	{		var entity = new WAF.Entity(dataClass, cacheInfo.rawEntity);		var event = { entity: entity};		var result = WAF.callHandler(false, null, event, options, userData);		if (typeof result == "boolean")		{			if (!result)			{				if (options != null)					options.mustStopLoop = true;			}		}	}}WAF.DataClass.newCollection = function(collectionReference, options, userData){	if (collectionReference == null)	{		var collection = new WAF.EntityCollection(this, null, {createEmptyCollection: true});		return collection;	}	else	{		var resOp = WAF.tools.handleArgs(arguments, 1);		userData = resOp.userData;		options = resOp.options;		options.dataURI = collectionReference.dataURI;		options.pageSize = options.pageSize || collectionReference.pageSize;		options.autoExpand = options.autoExpand || collectionReference.autoExpand;		options.savedQuery = collectionReference.savedQuery || null;		options.savedOrderby = collectionReference.savedOrderby || null;		var collection = new WAF.EntityCollection(this, null, options, userData);		return collection;	}}WAF.DataClass.getEntityByURI = function(dataURI, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var dataClass = this;	dataClass._private.getEntityByURIOrKey(null, dataURI, options, userData);}WAF.DataClass.distinctValues = function(attributeName, options, userData){	// attributeName : attribute to get values from	// options.queryString : query to filter values	// options.onSuccess : handler, array is received in event.result	// options.skip : start result array from 'skip'	// options.top : max length of result array	// options.onError : handler when error occured	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	//var attributeName = options.attributeName;	var queryString = options.queryString;	var skip = options.skip;	var top = options.top;	var dataClass = this;	var request = new WAF.core.restConnect.restRequest(true);	//request.app = "";	request.resource = dataClass.getName();	//request.filter = '"'+queryString+'"';	request.filter = queryString;	request.skip = skip;	request.top = top;	request.options = {		objectRef: this,		first: skip,		top: top	};	if (attributeName != null)	{		request.attributesRequested = [attributeName];	}	request.distinct = true;	request.addToSet = options.addToSet;	request.handler = function(){		if (request.http_request.readyState != 4) {			return;		}		var rawResult = WAF.getRequestResult(request);		var withError = false;		var err = null;		if (rawResult.__ERROR != null)		{			err = rawResult.__ERROR;			withError = true;			for (var ierr = 0; ierr < rawResult.__ERROR.length; ierr++)			{				var rawerr = rawResult.__ERROR[ierr];				if (rawerr.options == null)				{					rawerr.options = { };				}				rawerr.options.position = first;			}		}		var event = { result: rawResult, distinctValues: rawResult, XHR: request.http_request};		WAF.callHandler(withError, err, event, options, userData);	}	request.go();}WAF.DataClass.query = function(queryString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1, {queryParams:true});	userData = resOp.userData;	options = resOp.options;	var dataClass = this;	var entityCollection = new WAF.EntityCollection(dataClass, queryString, options, userData)	return entityCollection;}WAF.DataClass.allEntities = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	return this.query("", options, userData);}WAF.DataClass.find = function(queryString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1, {queryParams:true});	userData = resOp.userData;	options = resOp.options;	var dataClass = this;	var priv = this._private;	var request = new WAF.core.restConnect.restRequest(true);	request.resource = dataClass.getName();	request.autoExpand = options.autoExpand;	request.filter = queryString;	request.top = 1;	request.orderby = options.orderby;	request.params = options.params;	request.handler = function()	{		if (request.http_request.readyState != 4) {            return;        }		var error = false;		var err = null;		var result = WAF.getRequestResult(request);		if (result.__ERROR != null)		{			error = true;			err = result.__ERROR;		}		var entity = null;		if (!error && result.__ENTITIES != null && result.__ENTITIES.length > 0)		{			entity = new WAF.Entity(dataClass, result.__ENTITIES[0]);		}		var event = {entity:entity, XHR: request.http_request};		WAF.callHandler(error, err, event, options, userData);	}	 var errorFlag = request.go();}// --------------------------------- Selections ---------------------------------------------------WAF.EntityCollectionPage = function(start, length){	var page = this;	this.start = start;	this.length = length;	this.entityKeys = [];  // each elem is { key, stamp }}WAF.EntityCollection = function(dataClass, queryString, options, userData){	// queryString : a query in Wakanda Query Language	// options.orderby : string   contains attribute name separated by a comma	// options.filterSet : query will be filtered inside that entity set	// options.queryPlan : boolean	// options.queryPath : boolean	// options.pageSize : number  default page size (how many rows) to fetch data from server	// options.progressInfo : string  identifier of a progress indicator to create on the server	// options.autoExpand: string  contain the list of attributes to expand (separated by a comma)	// options.dataURI : may contain a predefined URI to a resource like http://server.com/rest/dataClass(key)	//					 or like http://server.com/rest/dataClass(key)/relatedManyAttribute?$expand=relatedManyAttribute	// options.isMethodResult : boolean true if the entity set is the result of a method call	// in that case!			// options.savedPostdata : parameters to function call			// options.savedResource : rest path to method call	// options.prefetchedData : may contain the first part of the set	if (queryString == "''" || queryString == "")		queryString = null;	var resOp = WAF.tools.handleArgs(arguments, 2);	userData = resOp.userData;	options = resOp.options;	var dejaSet = options.filterSet;	var savedQuery;	if (dejaSet != null)	{		savedQuery = dejaSet._private.savedQuery;		if (savedQuery != null)		{			if (queryString != null)				savedQuery = "(" + savedQuery+") and "+queryString;		}		else			saveQuery = queryString;	}	else savedQuery = queryString;	if (savedQuery == null)		savedQuery = options.savedQuery || null;	if (options.orderby == null && options.orderBy != null)		options.orderby = options.orderBy;	var savedOrderby = options.orderby || null;	if (savedOrderby == null)		savedOrderby = options.savedOrderby || null;	var pageSize = options.pageSize || 40;	var entityCollection = this;	this._private =	{		ready: false,		owner: this,		queryString: queryString,		savedQuery: savedQuery,		orderby: savedOrderby,		savedOrderby: savedOrderby,		dataURI: options.dataURI,		pageSize: pageSize,		withQueryPlan: options.queryPlan,		withQueryPath: options.queryPath,		progressInfo: options.progressInfo,		params: options.params,		dataClass: dataClass,		methodRefs: dataClass._private.entityCollectionMethodRefs,		methods: dataClass._private.entityCollectionMethods,		autoExpand: options.autoExpand,		autoSubExpand: options.autoSubExpand,		isMethodResult: options.isMethodResult,		isARelatedEntityCollection: options.isARelatedEntityCollection,		loadedElemsLength: 0,		addedElems: [],		//savedPostdata: options.savedPostdata,		//savedResource: options.savedResource,		curPendingStamp: 0,		pendingRequests: {}, // map of { start, length }  key is pendingStamp		pages: [], // an array of EntityCollectionPage		insertPage: WAF.EntityCollection.insertPage,		findPage: WAF.EntityCollection.findPage,		invalidPage: WAF.EntityCollection.invalidPage,		getKeyByPos: WAF.EntityCollection.getKeyByPos,		manageData: WAF.EntityCollection.manageData,		fetchData: WAF.EntityCollection.fetchData,		addPendingRequest: WAF.EntityCollection.addPendingRequest,		clearPendingRequest: WAF.EntityCollection.clearPendingRequest,		isPagePending: WAF.EntityCollection.isPagePending,		gotEntity: WAF.EntityCollection.gotEntity,		updateOptions: WAF.EntityCollection.updateOptions	};	var priv = this._private;	var methods = priv.methods;	for (var e in methods)	{		entityCollection[e] = methods[e];	}	this.length = 0;	options.init = true;	if (options.createEmptyCollection)	{		priv.ready = true;		queryString = "*";	}	else	{		if (options.dataURI != null && options.dataURI == "*")		{			priv.ready = true;		}		else if (options.prefetchedData != null)		{			entityCollection._private.manageData(options.prefetchedData, true);		}		else		{			if (queryString == null && priv.savedQuery == null)				priv.savedQuery = '$all';			entityCollection._private.fetchData(0, pageSize, options, userData);		}	}	return entityCollection;}					// EntityCollection PagesWAF.EntityCollection.insertPage = function(page){	var priv = this;	var pages = priv.pages;	var nbpages = pages.length;	if (nbpages == 0)		pages.push(page);	else	{		var posToInsert = -1;		for (var i = 0; i < nbpages; i++)		{			var xpage = pages[i];			if (xpage.start > page.start)			{				posToInsert = i;				break;			}		}		if (posToInsert == -1)			pages.push(page);		else			pages.splice(posToInsert,0, page);	}}WAF.EntityCollection.findPage = function(pos){	var priv = this;	var pages = priv.pages;	var nbpages = pages.length;	var low = 0;	var high = nbpages;	while (high>low)	{		var middle = Math.floor((high-low)/2) + low;		var page = pages[middle];		if (page.start <= pos && (page.start+page.length>pos))			return middle;		else		{			if (pos < page.start)			{				high = middle;			}			else			{				low = middle+1;			}		}	}	return -1;}WAF.EntityCollection.invalidPage = function(pos){	var priv = this;	var pagePos = priv.findPage(pos);	if (pagePos != -1)		priv.pages.splice(pagePos, 1);}WAF.EntityCollection.getKeyByPos = function(pos){	var result = null;	var priv = this;	var pagePos = priv.findPage(pos);	if (pagePos != -1)	{		var page = priv.pages[pagePos];		var keyElem = page.entityKeys[pos-page.start];		result = keyElem.key;	}	return result;}				// EntityCollection Pending RequestsWAF.EntityCollection.addPendingRequest = function(start, length){	var priv = this;	priv.curPendingStamp++;	priv.pendingRequests[priv.curPendingStamp] = { start:start, length:length };	return priv.curPendingStamp;}WAF.EntityCollection.clearPendingRequest = function(pendingStamp){	var priv = this;	delete priv.pendingRequests[pendingStamp];}WAF.EntityCollection.isPagePending = function(pos){	var priv = this;	for (var e in priv.pendingRequests)	{		var pendingRequest = priv.pendingRequests[e];		if ( (pendingRequest.start <= pos) && (pendingRequest.start+pendingRequest.length > pos))			return true;	}	return false;}				// fetching DataWAF.EntityCollection.manageData = function(rawResult, init){	var priv = this;	var entityCollection = this.owner;	var dataClass = entityCollection.getDataClass();	var cache = dataClass.getCache();	init = init || false;	if (init)	{		entityCollection.length = rawResult.__COUNT;		priv.ready = true;		priv.loadedElemsLength = entityCollection.length;		priv.dataURI = rawResult.__ENTITYSET;		if (priv.autoSubExpand != null)		{			priv.autoExpand = priv.autoSubExpand;			priv.autoSubExpand = null;		}	}	var nbEnts = rawResult.__SENT;	var first = rawResult.__FIRST;	cache.makeRoomFor(nbEnts);	var arr = rawResult.__ENTITIES;	var timeStamp = new Date();	var page = new WAF.EntityCollectionPage(first, nbEnts);	for (var i = 0; i < nbEnts; i++)	{		var rawEntity = arr[i];		var stamp = cache.setEntry(rawEntity.__KEY, rawEntity, timeStamp);		page.entityKeys.push({key:rawEntity.__KEY, stamp:stamp});	}	priv.insertPage(page);}WAF.EntityCollection.fetchData = function(skip, top, options, userData){	// private function	var resOp = WAF.tools.handleArgs(arguments, 2);	userData = resOp.userData;	options = resOp.options;	var dejaSet = options.filterSet;	var init = options.init || false;	var priv = this;	var entityCollection = this.owner;	var dataClass = entityCollection.getDataClass();	var cache = dataClass.getCache();	var pendingStamp = priv.addPendingRequest(skip, top);    var request = new WAF.core.restConnect.restRequest(true);    request.entityCollection = entityCollection;    //request.app = "";    request.resource = priv.dataClass.getName();	if (dejaSet != null)	{		if (dejaSet._private.dataURI != null)		{			request.dataURI = dejaSet._private.dataURI;			request.filter = priv.queryString;		}		else			request.filter = priv.savedQuery;	}	else    	request.filter = priv.queryString;    request.top = top;	request.skip = skip;	request.attributesRequested = null;	request.attributesExpanded = null;	request.autoExpand = priv.autoExpand;	request.autoSubExpand = priv.autoSubExpand;	request.params = priv.params;	if (options.fromSelection)	{		request.fromSelection = options.fromSelection;	}	if (init)	{		request.removeAtPos = options.removeAtPos;		request.addToSet = options.addToSet;		var sel = request.fromSelection;		if (sel != null)		{			request.fromSelection = sel.prepareToSend();		}	}	request.queryPlan = priv.withQueryPlan;	request.progressInfo = priv.progressInfo;	if (priv.isARelatedEntityCollection)		request.method = "subentityset";	else		request.method = "entityset";	request.timeout = options.timeout || 300;	request.savedOrderby = priv.savedOrderby;	request.savedQueryString = priv.savedQuery;	request.dataURI = request.dataURI || priv.dataURI;	if (request.dataURI && (dejaSet == null))		request.filter = null;	request.orderby = options.orderby;	request.keepSelection = options.keepSelection;	request.handler = function(){	    if (request.http_request.readyState != 4) {	        return;	    }		priv.clearPendingRequest(pendingStamp);	    var rawResult = WAF.getRequestResult(request);	    var event = { entityCollection: entityCollection, result:entityCollection, XHR: request.http_request };		var withError = rawResult.__ERROR != null;		if (!withError)		{			if (rawResult.__transformedSelection != null)				event.transformedSelection = rawResult.__transformedSelection;			priv.manageData(rawResult, init)		}		/*		if (!withError && init)		{			entityCollection.length = rawResult.__COUNT;			priv.ready = true;			priv.dataURI = rawResult.__ENTITYSET;		}		if (!withError)		{			var nbEnts = rawResult.__SENT;			var first = rawResult.__FIRST;			cache.makeRoomFor(nbEnts);			var arr = rawResult.__ENTITIES;			var timeStamp = new Date();			var page = new WAF.EntityCollectionPage(first, nbEnts);			for (var i = 0; i < nbEnts; i++)			{				var rawEntity = arr[i];				var stamp = cache.setEntry(rawEntity.__KEY, rawEntity, timeStamp);				page.entityKeys.push({key:rawEntity.__KEY, stamp:stamp});			}			priv.insertPage(page);		}		*/		WAF.callHandler(withError, rawResult.__ERROR, event, options, userData);	};	var errorFlag = request.go();}WAF.EntityCollection.updateOptions = function(options){	var priv = this;	if (priv.addedElems.length > 0)	{		var addedKeys = [];		for (var i = 0, nbelem = priv.addedElems.length; i< nbelem; i++)		{			var e = priv.addedElems[i];			var key = null;			if (e != null && e.getKey)				key = e.getKey();			if (key != null)				addedKeys.push(key);		}		if (addedKeys.length > 0)		{			options.addToSet = addedKeys;		}	}}// end of private functionsWAF.EntityCollection.getDataClass = function() // returns the datastore class of the set{	var entityCollection = this;	return entityCollection._private.dataClass;}WAF.EntityCollection.getReference = function() // returns an object to rebuild the selection later, even in another page{	var result = null;	var entityCollection = this;	var priv = entityCollection._private;	if (priv.dataURI != null)	{		result = { dataURI: priv.dataURI};		if (priv.savedQuery != null)			result.savedQuery = priv.savedQuery;		if (priv.savedOrderby != null)			result.savedOrderby = priv.savedOrderby;		if (priv.pageSize != null)			result.pageSize = priv.pageSize;		if (priv.autoExpand != null)			result.autoExpand = priv.autoExpand;	}	return result;}WAF.EntityCollection.query = function(queryString, options, userData){	// does a query within an existing set, same options as an datastore class query	var resOp = WAF.tools.handleArgs(arguments, 1, {queryParams:true});	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	options.filterSet = entityCollection;	var dataClass = entityCollection.getDataClass();	options.pageSize = options.pageSize || entityCollection._private.pageSize;	options.autoExpand = options.autoExpand || entityCollection._private.autoExpand;	entityCollection._private.updateOptions(options);	var subEntityCollection = new WAF.EntityCollection(dataClass, queryString, options, userData)	return subEntityCollection;}WAF.EntityCollection.orderBy = function(orderByString, options, userData){	// sorts an existing set, same options as an datastore class query	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	options.orderby = orderByString;	var priv = entityCollection._private;	options.dataURI = priv.dataURI;	var dataClass = entityCollection.getDataClass();	options.pageSize = options.pageSize || priv.pageSize;	options.autoExpand = options.autoExpand || priv.autoExpand;	priv.updateOptions(options);	options.savedQuery = priv.savedQuery || null;	var subEntityCollection = new WAF.EntityCollection(dataClass, null, options, userData)	return subEntityCollection;}WAF.EntityCollection.getEntity = function(pos, options, userData, doNotFetch){	var executed = false;	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	if (resOp.nextParam < arguments.length)	{		doNotFetch = arguments[resOp.nextParam] || false;	}	else		doNotFetch = false;	var entityCollection = this;	var priv = entityCollection._private;	var dataClass = entityCollection.getDataClass();	if (pos >= priv.loadedElemsLength )	{		var newevent = {entityCollection: entityCollection, position:pos};		var subpos = pos - priv.loadedElemsLength;		if (subpos < priv.addedElems.length)		{			newevent.entity = priv.addedElems[subpos];			WAF.callHandler(false, null, newevent, options, userData);		}		else			WAF.callHandler(true, [{error : 501, message:"wrong position in entityCollection"}], newevent, options, userData);	}	else	{		var okfetch = false;		var key = priv.getKeyByPos(pos);		if (key == null && !doNotFetch)		{			if (priv.isPagePending(pos))			{				setTimeout(function()				{					entityCollection.getEntity(pos, options, userData)				}, 100);			}			else				okfetch = true;		}		if (key != null)		{			var cache = dataClass.getCache();			var cacheInfo = cache.getCacheInfo(key);			if (cacheInfo != null)			{				executed = true;				priv.gotEntity(cacheInfo, options, userData, pos);			}			else			{				okfetch = true;				key = null;				priv.invalidPage(pos);			}		}		if (doNotFetch)			okfetch = false;		if (key == null && okfetch)		{			var delay, delayInfo;			if (options != null)			{				delay = options.delay;				delayInfo = options.delayInfo;			}			else			{				delay = null;				delayInfo = null;			}			if (delay != null && delay != 0 && delayInfo != null)			{				//console.log("delayed getEntity at pos: "+pos);				var delayReq = delayInfo.findMatchingPendingRequest(pos);				if (delayReq == null)				{					var posbefore = pos-20;					if (posbefore < 0)						posbefore = 0;					delayReq = delayInfo.addPendingRequest(0, posbefore, pos+priv.pageSize-1);					//console.log("new delayReq from "+posbefore+" to "+(pos+priv.pageSize-1));					delayReq.addFetchRequest(pos, options, userData);					//console.log("addFetchRequest at pos: "+pos);					var requestid = setTimeout(function() {						//console.log("end timeout for request from "+delayReq.top+" to "+delayReq.bottom+ " current visible is "+delayInfo.top+" to "+delayInfo.bottom);						if (delayReq.matchRange(delayInfo.top,delayInfo.bottom))						{							//console.log("matched range: fetching data ");							priv.fetchData(delayReq.top, (delayReq.bottom-delayReq.top)+1, {								onSuccess: function(event)								{									delayReq.pendingFetch.forEach(function(fetchItem)									{										if (fetchItem.pos >= delayInfo.top && fetchItem.pos <= delayInfo.bottom)										{											key = priv.getKeyByPos(fetchItem.pos);											cache = dataClass.getCache();											var cacheInfo = cache.getCacheInfo(key);											if (cacheInfo != null)											{												priv.gotEntity(cacheInfo, fetchItem.options, fetchItem.userData, fetchItem.pos);											}											else											{												priv.gotEntity(null, fetchItem.options, fetchItem.userData);											}										}									});									delayInfo.removePendingRequest(delayReq);								},								onError: function(event)								{									delayReq.pendingFetch.forEach(function(fetchItem)									{										if (fetchItem.pos >= delayInfo.top && fetchItem.pos <= delayInfo.bottom)										{											var newevent = {entityCollection: entityCollection, position:fetchItem.pos, entity:null};											WAF.callHandler(true, event.error, newevent, fetchItem.options, fetchItem.userData);										}									});									delayInfo.removePendingRequest(delayReq);								}							});						}						else							delayInfo.removePendingRequest(delayReq);					}, delay);					delayReq.setRequestID(requestid);				}				else				{					delayReq.addFetchRequest(pos, options, userData);					//console.log("addFetchRequest at pos: "+pos);				}			}			else			{				priv.fetchData(pos, priv.pageSize, {					onSuccess: function(event)					{						key = priv.getKeyByPos(pos);						cache = dataClass.getCache();						var cacheInfo = cache.getCacheInfo(key);						if (cacheInfo != null)						{							priv.gotEntity(cacheInfo, options, userData, pos);						}						else						{							priv.gotEntity(null, options, userData);						}					},					onError: function(event)					{						var newevent = {entityCollection: entityCollection, position:pos, entity:null};						WAF.callHandler(true, event.error, newevent, options, userData);					}				});			}		}	}	return executed;}WAF.EntityCollection.gotEntity = function(cacheInfo, options, userData, position){	var priv = this;	var entityCollection = priv.owner;	var entity;	if (cacheInfo != null)		entity = new WAF.Entity(entityCollection.getDataClass(), cacheInfo.rawEntity);	else		entity = null;	var event = { entityCollection: entityCollection, entity: entity, position: position };	WAF.callHandler(false, null, event, options, userData);}WAF.EntityCollection.callMethod = function(options){	var entityCollection = this;	var methodRef = entityCollection._private.methodRefs[options.method];	if (methodRef != null)	{		var myargs = [];		if (options.arguments != null)		{			myargs = options.arguments;		}		else		{	        for (var i = 1,nb = arguments.length; i < nb; i++) // The first one is skipped.	        {	            myargs.push(arguments[i]);	        }		}		return WAF.DataStore.funcCaller(methodRef, entityCollection, myargs, options);	}}WAF.EntityCollection.parseForEach = function(options, parseData){	var executed = true;	var entityCollection = parseData.entityCollection;	var priv = entityCollection._private;	var stop = false;	while (executed && parseData.curelem < parseData.limit && !stop)	{		executed = entityCollection.getEntity(parseData.curelem, options, parseData.userData, true);		if (options != null && options.mustStopLoop)			stop = true;		else		{			if (executed)				parseData.curelem++;			else			{				entityCollection.getEntity(parseData.curelem,				{					onSuccess: function(event)					{						WAF.EntityCollection.parseForEach(options, parseData)					},					onError: function(event)					{						WAF.callHandler(true, event.error, event, options, parseData.userData);					}				}, parseData);			}		}	}	if (executed)	{		if (options.atTheEnd != null)		{			var event = { entityCollection: entityCollection, userData: parseData.userData};			options.atTheEnd(event);		}	}	return executed;}WAF.EntityCollection.forEach = function(options, userData){	// options.onSuccess : function called for each entity	// options.onError :	// options.atTheEnd : function called at the end of the forEach	var entityCollection = this;	var priv = entityCollection._private;	var resOp = WAF.tools.handleArgs(arguments, 0, { with3funcs: true });	userData = resOp.userData;	options = resOp.options;	var parseInfo = {						curelem : options.first || 0,						limit : options.limit || entityCollection.length,						userData: userData,						entityCollection: entityCollection					};	WAF.EntityCollection.parseForEach(options, parseInfo);}WAF.EntityCollection.add = function(entity){	if (entity != null)	{		this._private.addedElems.push(entity);		this.length++;	}}WAF.EntityCollection.toArray = function(attributeList, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	priv.updateOptions(options);	var request = new WAF.core.restConnect.restRequest(true);    request.entityCollection = entityCollection;    request.resource = priv.dataClass.getName();    request.top = options.top || null;	request.skip = options.skip || null;	request.params = priv.params;	request.addToSet = options.addToSet;	request.progressInfo = options.progressInfo || priv.progressInfo;	request.savedOrderby = priv.savedOrderby;	request.savedQueryString = priv.savedQuery;	request.dataURI = priv.dataURI;	request.orderby = options.orderby;	request.autoExpand = attributeList;	request.asArray = true;	request.handler = function(){	    if (request.http_request.readyState != 4) {	        return;	    }	    var rawResult = WAF.getRequestResult(request);	    var event = { entityCollection: entityCollection, result:rawResult, XHR: request.http_request };		var withError = rawResult.__ERROR != null;		WAF.callHandler(withError, rawResult.__ERROR, event, options, userData);	};	var errorFlag = request.go();}WAF.EntityCollection.distinctValues = function(attributeName, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	priv.updateOptions(options);	var request = new WAF.core.restConnect.restRequest(true);    request.entityCollection = entityCollection;    request.resource = priv.dataClass.getName(); 	request.addToSet = options.addToSet;	request.top = options.top || null;	request.skip = options.skip || null;	request.params = priv.params;	request.progressInfo = options.progressInfo || priv.progressInfo;	request.savedOrderby = priv.savedOrderby;	request.savedQueryString = priv.savedQuery;	request.dataURI = priv.dataURI;	request.distinct = true;	if (attributeName != null)	{		request.attributesRequested = [attributeName];	}	request.handler = function(){		if (request.http_request.readyState != 4) {			return;		}	    var rawResult = WAF.getRequestResult(request);	    var event = { entityCollection: entityCollection, distincValues:rawResult, result:rawResult, XHR: request.http_request };		var withError = rawResult.__ERROR != null;		WAF.callHandler(withError, rawResult.__ERROR, event, options, userData);	}	var errorFlag = request.go();}WAF.EntityCollection.findKey = function(key, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	priv.updateOptions(options);	var request = new WAF.core.restConnect.restRequest(true);    request.entityCollection = entityCollection;    request.resource = priv.dataClass.getName(); 	request.addToSet = options.addToSet;	request.top = options.top || null;	request.skip = options.skip || null;	request.params = priv.params;	request.progressInfo = options.progressInfo || priv.progressInfo;	request.savedOrderby = priv.savedOrderby;	request.savedQueryString = priv.savedQuery;	request.dataURI = priv.dataURI;	if (key instanceof Date)		key = key.toISO();	request.findKey = key;	request.handler = function(){		if (request.http_request.readyState != 4) {			return;		}	    var rawResult = WAF.getRequestResult(request);	    var event = { entityCollection: entityCollection, result:rawResult.result, XHR: request.http_request };		var withError = rawResult.__ERROR != null;		WAF.callHandler(withError, rawResult.__ERROR, event, options, userData);	}	var errorFlag = request.go();}WAF.EntityCollection.removeEntity = function(posInSet, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	options.dataURI = priv.dataURI;	var dataClass = entityCollection.getDataClass();	if (posInSet >= priv.loadedElemsLength && posInSet < entityCollection.length) {		var subpos = posInSet - priv.loadedElemsLength;		var entity = priv.addedElems[subpos];		var resev = { entityCollection: entityCollection, result:entityCollection};		if (entity == null || entity.getKey() == null) {			priv.addedElems.splice(subpos, 1);			entityCollection.length--;			WAF.callHandler(false, null, resev, options, userData);		}		else {			entity.remove({				onSuccess: function(ev){					priv.addedElems.splice(subpos, 1);					entityCollection.length--;					WAF.callHandler(false, null, resev, options, userData);				},				onError: function(ev){					WAF.callHandler(true, ev.error, resev, options, userData);				}			});		}	}	else {		options.pageSize = options.pageSize || priv.pageSize;		options.autoExpand = options.autoExpand || priv.autoExpand;		priv.updateOptions(options);		options.removeAtPos = posInSet;		options.savedQuery = priv.savedQuery || null;		options.savedOrderby = priv.savedOrderby || null;		var newEntityCollection = new WAF.EntityCollection(dataClass, null, options, userData)		return newEntityCollection;	}}WAF.EntityCollection.removeAllEntities = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	priv.updateOptions(options);	var request = new WAF.core.restConnect.restRequest(true);    request.entityCollection = entityCollection;    request.resource = priv.dataClass.getName(); 	request.addToSet = options.addToSet;	request.params = priv.params;	request.progressInfo = options.progressInfo || priv.progressInfo;	request.savedOrderby = priv.savedOrderby;	request.savedQueryString = priv.savedQuery;	request.dataURI = priv.dataURI;	request.method = "delete";	request.atOnce = options.atOnce;	request.handler = function(){		if (request.http_request.readyState != 4) {			return;		}	    var rawResult = WAF.getRequestResult(request);	    var event = { entityCollection: entityCollection, XHR: request.http_request };		var withError = rawResult.__ERROR != null;		WAF.callHandler(withError, rawResult.__ERROR, event, options, userData);	}	var errorFlag = request.go();}WAF.EntityCollection.buildFromSelection = function(selection, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this;	var priv = entityCollection._private;	var dataClass = entityCollection.getDataClass();	options.pageSize = options.pageSize || priv.pageSize;	options.autoExpand = options.autoExpand || priv.autoExpand;	priv.updateOptions(options);	options.filterSet = entityCollection;	//options.fromCollection = entityCollection;	options.fromSelection = selection;	options.savedQuery = priv.savedQuery || null;	options.savedOrderby = priv.savedOrderby || null;	var subEntityCollection = new WAF.EntityCollection(dataClass, null, options, userData);	return subEntityCollection;}// ------------------------------------ Entity -------------------------------------------------------------------				// Entity Attribute SimpleWAF.EntityAttributeSimple = function(entity, rawVal, att){	this.owner = entity;	if (att.type == "date" && typeof(rawVal) == "string")		this.value = ISOToDate(rawVal);	else		this.value = rawVal;	this.touched = false;	this.att = att;	this.getValue = WAF.EntityAttributeSimple.getValue;	this.setValue =  WAF.EntityAttributeSimple.setValue;	this.touch = WAF.EntityAttributeSimple.touch;	this.isTouched = WAF.EntityAttributeSimple.isTouched;	this.clearTouched = WAF.EntityAttributeSimple.clearTouched;	this.getOldValue = WAF.EntityAttributeSimple.getOldValue;	this.setRawValue = WAF.EntityAttributeSimple.setRawValue;	this.getRawValue = WAF.EntityAttributeSimple.getRawValue;}WAF.EntityAttributeSimple.getValue = function(){	return this.value;}WAF.EntityAttributeSimple.setValue = function(val){	if (this.oldValue === undefined)		this.oldValue = this.value;	this.value = val;	this.touch();}WAF.EntityAttributeSimple.touch = function(){	this.touched = true;	this.owner.touch();}WAF.EntityAttributeSimple.clearTouched = function(){	this.touched = false;}WAF.EntityAttributeSimple.isTouched = function(){	return this.touched;}WAF.EntityAttributeSimple.getOldValue = function(){	if (this.oldValue === undefined)		return this.getValue();	else		return this.oldValue;}WAF.EntityAttributeSimple.setRawValue = function(rawVal){	if (this.att.type == "date" && typeof(rawVal) == "string")		this.value = ISOToDate(rawVal);	else		this.value = rawVal;	delete this.oldValue;}WAF.EntityAttributeSimple.getRawValue = function(){	var result = this.value;	if (result != null && this.att.type == "date")	{		result = result.toISO();	}	return result;}				// Entity Attribute Related EntityWAF.EntityAttributeRelated = function(entity, rawVal, att){	WAF.EntityAttributeSimple.call(this, entity, rawVal, att);	if (rawVal != null)	{		if (rawVal.__deferred != null)		{			this.relEntity = null;			this.dataURI = rawVal.__deferred.uri;			this.relKey = rawVal.__deferred.__KEY;		}		else		{			var relClass = att.getRelatedClass();			if (relClass == null)			{				this.relEntity = null;				this.dataURI = null;				this.relKey = null;			}			else			{				this.relEntity = new WAF.Entity(relClass, rawVal);				this.dataURI = null;				this.relKey = null;			}		}	}	else	{		this.relEntity = null;		this.dataURI = null;		this.relKey = null;	}	this.setValue = WAF.EntityAttributeRelated.setValue;	this.getValue = WAF.EntityAttributeRelated.getValue;	this.load = this.getValue; // an alias	this.setRawValue = WAF.EntityAttributeRelated.setRawValue;	this.getRawValue = WAF.EntityAttributeRelated.getRawValue;	this.getOldValue = WAF.EntityAttributeRelated.getOldValue;}WAF.EntityAttributeRelated.getOldValue = function(){	if (this.oldValue === undefined)		return this.getValue();	else		return this.oldValue;}WAF.EntityAttributeRelated.getValue = function(options, userData){	if (options == null) // in that case we just want the related entity if it was already loaded		return this.relEntity;	else	{		var resOp = WAF.tools.handleArgs(arguments, 0);		userData = resOp.userData;		options = resOp.options;		var val = this;		var event = { entity: null };		if (val.relEntity == null)		{			if (val.dataURI == null && val.relKey == null)			{				WAF.callHandler(false, null, event, options, userData)			}			else			{				var relClass = val.att.getRelatedClass();				if (relClass == null)				{					WAF.callHandler(false, null, event, options, userData)				}				else				{					if (val.relKey != null)					{						relClass.getEntity(val.relKey,						{							onSuccess:function(event)							{								val.relEntity = event.entity;								WAF.callHandler(false, null, event, options, userData);							},							onError:function(event)							{								WAF.callHandler(true, event.error, event, options, userData);							},							autoExpand: options.autoExpand						});					}					else					{						relClass.getEntityByURI(val.dataURI,						{							onSuccess:function(event)							{								val.relEntity = event.entity;								WAF.callHandler(false, null, event, options, userData);							},							onError:function(event)							{								WAF.callHandler(true, event.error, event, options, userData);							},							autoExpand: options.autoExpand						});					}				}			}		}		else		{			event.entity = val.relEntity;			WAF.callHandler(false, null, event, options, userData)		}	}}WAF.EntityAttributeRelated.setValue = function(relatedEntity){	if (this.oldValue === undefined)		this.oldValue = this.relEntity;	this.relEntity = relatedEntity;	this.touched = true;	this.owner.touch();	this.dataURI = null;	if (relatedEntity == null)		this.relKey = null;	else		this.relKey = relatedEntity.getKey();}WAF.EntityAttributeRelated.setRawValue = function(rawVal){	if (rawVal != null)	{		if (rawVal.__deferred != null)		{			this.relEntity = null;			this.dataURI = rawVal.__deferred.uri;			this.relKey = rawVal.__deferred.__KEY;		}		else		{			var relClass = this.att.getRelatedClass();			if (relClass == null)			{				this.relEntity = null;				this.dataURI = null;				this.relKey = null;			}			else			{				this.relEntity = new WAF.Entity(relClass, rawVal);				this.dataURI = null;				this.relKey = null;			}		}	}	else	{		this.relEntity = null;		this.dataURI = null;		this.relKey = null;	}	delete this.oldValue;}WAF.EntityAttributeRelated.getRawValue = function(){	var result = this.relEntity;	if (result != null)	{		var key = result.getKey();		if (key != null)		{			result = { __KEY: key };		}		else			result = result._private.getRESTFormat();	}	return result;}				// Entity Attribute Related Entities (selection)WAF.EntityAttributeRelatedSet = function(entity, rawVal, att){	WAF.EntityAttributeSimple.call(this, entity, rawVal, att);	if (rawVal != null)	{		if (rawVal.__deferred != null)		{			this.relEntityCollection = null;			this.dataURI = rawVal.__deferred.uri;		}		else		{			var relClass = att.getRelatedClass();			if (relClass == null)			{				this.relEntityCollection = null;				this.dataURI = null;			}			else			{				this.relEntityCollection = new WAF.EntityCollection(relClass, null, { prefetchedData: rawVal });				this.dataURI = this.relEntityCollection._private.dataURI;			}		}	}	else	{		this.relEntityCollection = null;		this.dataURI = null;	}	this.setValue = WAF.EntityAttributeRelatedSet.setValue;	this.getValue = WAF.EntityAttributeRelatedSet.getValue;	this.setRawValue = WAF.EntityAttributeRelatedSet.setRawValue;}WAF.EntityAttributeRelatedSet.setRawValue = function(rawVal){	if (rawVal != null)	{		if (this.dataURI != null && rawVal.__deferred == this.dataURI)		{			// nothing to do in that case		}		else		{			if (rawVal.__deferred != null)			{				this.relEntityCollection = null;				this.dataURI = rawVal.__deferred.uri;			}			else			{				var relClass = this.att.getRelatedClass();				if (relClass == null)				{					this.relEntityCollection = null;					this.dataURI = null;				}				else				{					this.relEntityCollection = new WAF.EntityCollection(relClass, null, { prefetchedData: rawVal });					this.dataURI = this.relEntityCollection._private.dataURI;				}			}		}	}	else	{		this.relEntityCollection = null;		this.dataURI = null;	}}WAF.EntityAttributeRelatedSet.getValue = function(options, userData){	if (options == null) // in that case we just want the related entity set if it was already computed		return this.relEntityCollection;	else	{		var resOp = WAF.tools.handleArgs(arguments, 0);		userData = resOp.userData;		options = resOp.options;		var relSet = null;		var val = this;		var event = { entityCollection : null };		if (this.relEntityCollection != null)		{			relSet = this.relEntityCollection;			if (relSet._private.ready)			{				event.entityCollection = relSet;				WAF.callHandler(false, null, event, options, userData);			}			else			{				var funcToCall = function()				{					if (relSet._private.ready)					{						event.entityCollection = relSet;						WAF.callHandler(false, null, event, options, userData);					}					else setTimeout(funcToCall, 100);				}				setTimeout(funcToCall, 100);			}		}		else		{			var relClass = this.att.getRelatedClass();			if (relClass == null)			{				WAF.callHandler(true, { error: 601, errorMessage:"wrong entityCollection reference"}, event, options, userData);			}			else			{				if (this.dataURI == null)					this.dataURI = "*";				options.isARelatedEntityCollection = true;				options.dataURI = this.dataURI;				this.relEntityCollection = new WAF.EntityCollection(relClass, null, options, userData);				relSet = this.relEntityCollection;			}		}		return relSet;	}}// ----------------------------------------------------------------				// EntityWAF.Entity = function(dataClass, rawData, options){	var entity = this;	this._private = {		touched: false,		isNew: true,		dataClass: dataClass,		owner: this,		values: {},		methodRefs: dataClass._private.entityMethodRefs,		methods: dataClass._private.entityMethods,		getRESTFormat: WAF.Entity.getRESTFormat	}	var priv = this._private;	var methods = priv.methods;	for (var e in methods)	{		entity[e] = methods[e];	}	this.touch = WAF.Entity.touch;	this.getDataClass = WAF.Entity.getDataClass;	this.getKey = WAF.Entity.getKey;	this.getStamp = WAF.Entity.getStamp;	this.callMethod = WAF.Entity.callMethod;	this.isNew = WAF.Entity.isNew;	this.isTouched = WAF.Entity.isTouched;	this.save = WAF.Entity.save;	this.remove = WAF.Entity.remove;	this.serverRefresh = WAF.Entity.serverRefresh;	if (rawData == null)	{		this._private.key = null;		this._private.stamp = 0;		this._private.isNew = true;	}	else	{		this._private.key = rawData.__KEY;		this._private.stamp = rawData.__STAMP;		this._private.isNew = false;	}	var values = entity._private.values;	options = options || {};	var attsByName = dataClass._private.attributesByName;	for (var e in attsByName)	{		var att = attsByName[e];	//	var val = (rawData == null) ? null :  rawData[e] || null;		var val = (rawData == null) ? null : (rawData[e] == null ? null : rawData[e]);		var valAtt;		if (!att.related)		{			valAtt = new WAF.EntityAttributeSimple(entity, val, att);		}		else		{			if (att.relatedOne)				valAtt = new WAF.EntityAttributeRelated(entity, val, att);			else				valAtt = new WAF.EntityAttributeRelatedSet(entity, val, att);		}		values[e] = valAtt;		entity[e] = valAtt;	}}WAF.Entity.getRESTFormat = function(overrideStamp) // private function{	var priv = this;	var entity = this.owner;	var result = {};	var key = entity.getKey();	if (key != null)	{		result.__KEY = key;		result.__STAMP = entity.getStamp();		if (overrideStamp)			result.__STAMP = -result.__STAMP;	}	for (var e in priv.values)	{		var valAtt = priv.values[e];		if (valAtt.isTouched())		{			result[e] = valAtt.getRawValue();		}	}	return result;}WAF.Entity.touch = function(){	this._private.touched = true;}WAF.Entity.getDataClass = function(){	return this._private.dataClass;}WAF.Entity.getKey = function(){	return this._private.key;}WAF.Entity.getStamp = function(){	return this._private.stamp;}WAF.Entity.callMethod = function(options){	var entity = this;	var methodRef = entity._private.methodRefs[options.method];	if (methodRef != null)	{		var myargs = [];		if (options.arguments != null)		{			myargs = options.arguments;		}		else		{	        for (var i = 1,nb = arguments.length; i < nb; i++) // The first one is skipped.	        {	            myargs.push(arguments[i]);	        }		}		return WAF.DataStore.funcCaller(methodRef, entity, myargs, options);	}}WAF.Entity.isNew = function(){	return this._private.isNew;}WAF.Entity.isTouched = function(){	return this._private.touched;}WAF.Entity.serverRefresh = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	options.refreshOnly = true;	this.save(options, userData);}WAF.Entity.remove = function(options, userData){	var entity = this;	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var dataClass = entity.getDataClass();	var dataClassName = dataClass.getName();	var key = entity.getKey();	var request = new WAF.core.restConnect.restRequest(true);	request.resource = dataClassName+"("+key+")";	request.method = "delete";	request.handler = function()	{		if (request.http_request.readyState != 4) {            return;        }		var error = false;		var err = null;		var result = WAF.getRequestResult(request);		if (result.__ERROR != null)		{			error = true;			err = result.__ERROR;		}		else		{			dataClass.getCache().removeCachedEntity(key);		}		var event = {entity:entity};		WAF.callHandler(error, err, event, options, userData);	}	 var errorFlag = request.go();}WAF.Entity.save = function(options, userData){	var entity = this;	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var dataClass = entity.getDataClass();	var dataClassName = dataClass.getName();	var refreshOnly = options.refreshOnly;	if (refreshOnly == null)	{		refreshOnly = false;	}	var request = new WAF.core.restConnect.restRequest(true);	//request.app = "";	request.resource = dataClassName;	var key = entity.getKey();	if (key == null)	{		// request.method = "create";		// request.httpMethod = WAF.core.restConnect.httpMethods._put;		request.method = "update";		request.httpMethod = WAF.core.restConnect.httpMethods._post;	} else	{		request.method = "update";		request.httpMethod = WAF.core.restConnect.httpMethods._post;	}	request.postdata = '{ "__ENTITIES": [' + JSON.stringify(entity._private.getRESTFormat(options.overrideStamp)) + ']}';	request.refreshOnly = refreshOnly;	if (options.autoExpand != null)		request.autoExpand = options.autoExpand;	/*	var attList = this.getAttributes(undefined, ['image']);	if (!refreshOnly)	{		for (var i = 0, nb = attList.length; i < nb; i++)		{			var att = attList[i];			if (att.kind == "storage" || att.kind == "alias" || att.kind == "calculated")			{				var attName = att.name;				var entAtt = this.getAttribute(attName);				if (entAtt != null)				{					entAtt.oldValue = entAtt.value;				}			}		}	}	*/	request.handler = function(){		if (request.http_request.readyState != 4)		{			return;		}		var rawResult = WAF.getRequestResult(request);		var event = { entity: entity, rawResult: rawResult, XHR: request.http_request};		var rawResult = JSON.parse(request.http_request.responseText);		var withError = false;		var err = null;		if (rawResult)		{			if (rawResult.__ENTITIES)			{				if (rawResult.__ENTITIES[0])				{					var rawResultRec = rawResult.__ENTITIES[0];					if (rawResultRec.__ERROR)					{						err = rawResultRec.__ERROR;						withError = true;					} else					{						var oldKEY = key;						var newKEY = rawResultRec.__KEY;						if (!refreshOnly)						{							if (newKEY != null)							{								entity._private.key = newKEY;							}							entity._private.stamp = rawResultRec.__STAMP;						}						var attsByName = dataClass._private.attributesByName;						for (var e in attsByName)						{							var att = attsByName[e];							var val =  rawResultRec[e];							if (val === undefined)								val = null;							var valAtt = entity[e];							if (valAtt == null)							{								if (!att.related)								{									valAtt = new WAF.EntityAttributeSimple(entity, val, att);								} else								{									if (att.relatedOne)										valAtt = new WAF.EntityAttributeRelated(entity, val, att);									else										valAtt = new WAF.EntityAttributeRelatedSet(entity, val, att);								}								//values[e] = valAtt;								entity[e] = valAtt;							}							else							{								valAtt.setRawValue(val);								if (!refreshOnly)									valAtt.clearTouched();							}						}						dataClass.getCache().replaceCachedEntity(newKEY, rawResultRec);						if (!refreshOnly)						{							entity._private.touched = false;							entity._private.isNew = false;						}					}				}			}		}		WAF.callHandler(withError, err, event, options, userData);	};	var errorFlag = request.go();}// initialize class prototypes;// EntityCollectionWAF.EntityCollection.prototype.getDataClass = WAF.EntityCollection.getDataClass;WAF.EntityCollection.prototype.query = WAF.EntityCollection.query;WAF.EntityCollection.prototype.getEntity = WAF.EntityCollection.getEntity;WAF.EntityCollection.prototype.callMethod = WAF.EntityCollection.callMethod;WAF.EntityCollection.prototype.each = WAF.EntityCollection.forEach;WAF.EntityCollection.prototype.forEach = WAF.EntityCollection.forEach;WAF.EntityCollection.prototype.add = WAF.EntityCollection.add;WAF.EntityCollection.prototype.orderBy = WAF.EntityCollection.orderBy;WAF.EntityCollection.prototype.toArray = WAF.EntityCollection.toArray;WAF.EntityCollection.prototype.distinctValues = WAF.EntityCollection.distinctValues;WAF.EntityCollection.prototype.findKey = WAF.EntityCollection.findKey;WAF.EntityCollection.prototype.removeEntity = WAF.EntityCollection.removeEntity;WAF.EntityCollection.prototype.removeAllEntities = WAF.EntityCollection.removeAllEntities;WAF.EntityCollection.prototype.buildFromSelection = WAF.EntityCollection.buildFromSelection;WAF.EntityCollection.prototype.getReference = WAF.EntityCollection.getReference;// DataClassWAF.DataClass.prototype.distinctValues = WAF.DataClass.distinctValues;WAF.DataClass.prototype.all = WAF.DataClass.allEntities;WAF.DataClass.prototype.allEntities = WAF.DataClass.allEntities;WAF.DataClass.prototype.query = WAF.DataClass.query;WAF.DataClass.prototype.find = WAF.DataClass.find;WAF.DataClass.prototype.getAttributeByName = WAF.DataClass.getAttributeByName;WAF.DataClass.prototype.getAttributes = WAF.DataClass.getAttributes;WAF.DataClass.prototype.getMethodList = WAF.DataClass.getMethodList;WAF.DataClass.prototype.getCache = WAF.DataClass.getCache;WAF.DataClass.prototype.getCacheSize = WAF.DataClass.getCacheSize;WAF.DataClass.prototype.setCacheSize = WAF.DataClass.setCacheSize;WAF.DataClass.prototype.clearCache = WAF.DataClass.clearCache;WAF.DataClass.prototype.newEntity = WAF.DataClass.newEntity;WAF.DataClass.prototype.getEntity = WAF.DataClass.getEntity;WAF.DataClass.prototype.getEntityByURI = WAF.DataClass.getEntityByURI;WAF.DataClass.prototype.getDataStore = WAF.DataClass.getDataStore;WAF.DataClass.prototype.getCollectionName = WAF.DataClass.getCollectionName;WAF.DataClass.prototype.getDefaultTopSize = WAF.DataClass.getDefaultTopSize;WAF.DataClass.prototype.getName = WAF.DataClass.getName;WAF.DataClass.prototype.newCollection = WAF.DataClass.newCollectionWAF.DataClass.prototype.callMethod = WAF.DataStore.callMethod;WAF.directory = WAF.directory || {};WAF.directory.login = WAF.DataStore.makeFuncCaller({ name: "login", applyTo: "general", nameSpace: "$directory"});WAF.directory.loginByPassword = WAF.directory.login;WAF.directory.logout = WAF.DataStore.makeFuncCaller({ name: "logout", applyTo: "general", nameSpace: "$directory"});WAF.directory.loginByKey = WAF.DataStore.makeFuncCaller({ name: "loginByKey", applyTo: "general", nameSpace: "$directory"});WAF.directory.currentUser = WAF.DataStore.makeFuncCaller({ name: "currentUser", applyTo: "general", nameSpace: "$directory"});WAF.directory.currentUserBelongsTo = WAF.DataStore.makeFuncCaller({ name: "currentUserBelongsTo", applyTo: "general", nameSpace: "$directory"});WAF.dsExport = WAF.dsExport || {};WAF.dsExport.exportData = WAF.DataStore.makeFuncCaller({ name: "exportData", applyTo: "general", nameSpace: "$impexp"});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/DataSource/Data-Source.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. *//** * The DataSource API provides an easy way to link data together. * * The DataSource API relies on EntityCollections. An EntityCollection is not the datastore class, * but a representation of the current selection, as created by the latest query on the EM. * Working with a datasource means in effect working with the current element of said selection. * * Each DataSource has its own EntityCollection. * * @module DataSource * **/// ----------------------------------------------------------------------------------------------// model for javascript variable datasource/* templateModel = { property1 : { name : "property1", type : "number  or  string  or  boolean  or  date  or  long", // optionnaly maxValue : number, minValue : number, pattern  : someString, minLength: number, maxLength: number, fixedLength : number, } property2 : ...... } data-source-type = "scalar"  or   "object"  or  "array" if "scalar" data-dataType : "string or number or ..." else data-attributes = "att1Name:att1Type, att2Name:att2Type, ..."; *//* // Call of the API functions func(necessaryParam1, necessaryParam2, ..., parameterBlock, userData) userData will be passed within event.data // Parameters block (parameterBlock) for the differents methods: parameterBlock { onSuccess	: function(event) onError	: function(event) sync		: boolean dispatcherID	: string dispatcherType	: string } Used Events: event { eventKind : string (par exemple "currentElement", "fullSet", "cancelElement", "onAttributeChange") dataSource : DataSource dispatcherID: string dispatcherType: string listenerID: string listenerType: string userData: any kind of object // pour un attributeChange attribute: DataSourceAttribute attributeName: string } */// ----------------------------------------------------------------------------------------------WAF.DataSourceEmSimpleAttribute = function(emAtt, source){	this.name = emAtt.name;	this.kind = (typeof emAtt.kind == "string") ? emAtt.kind : "storage";	this.owner = source;	this.simple = emAtt.type != 'image';	this.dataClassAtt = emAtt;	this.type = emAtt.type;	this.isVarAtt = false;	this.isFirstLevel = true;	// methods: see code after the constructor definition	this.getValue = WAF.DataSourceEmSimpleAttribute.getValue;	this.setValue = WAF.DataSourceEmSimpleAttribute.setValue;	this.validate = WAF.DataSourceEmSimpleAttribute.validate;	this.getOldValue = WAF.DataSourceEmSimpleAttribute.getOldValue;	this.getValueForInput = WAF.DataSourceEmSimpleAttribute.getValueForInput;	this.normalize = WAF.DataSourceEmSimpleAttribute.normalize;	this.dispatch = WAF.DataSourceEmSimpleAttribute.dispatch;	this.addListener = WAF.DataSourceEmSimpleAttribute.addListener;};WAF.DataSourceEmSimpleAttribute.getValue = function(){	var entity = this.owner.getCurrentElement();	if (entity == null) {		return null;	}	else {		return entity[this.name].value;	}};WAF.DataSourceEmSimpleAttribute.setValue = function(value, options){	options = options;	var entity = this.owner.getCurrentElement();	if (entity == null) {		// nothing to do		// MAY EXPECT AN EXCEPTION	}	else {		if (this.owner[this.name] !== value) {			this.owner[this.name] = value;			entity[this.name].setValue(value);			this.dispatch(options);		}	}};WAF.DataSourceEmSimpleAttribute.validate = function(value){	var entity = this.owner.getCurrentElement();	if (entity == null) {		return {			valid: true,			messages: []		};	}	else {		return this.owner._private._validateAttribute(this.name, value);	}};WAF.DataSourceEmSimpleAttribute.getOldValue = function(){	var entity = this.owner.getCurrentElement();	if (entity == null) {		return null;	}	else {		return entity[this.name].getOldValue();	}};WAF.DataSourceEmSimpleAttribute.getValueForInput = function(){	var value = this.getValue();	if (value == null) {		value = "";	}	else {		if (this.type == "date") {			value = WAF.utils.formatDate(value);		}		else {			value = "" + value;		}	}	return value;};WAF.DataSourceEmSimpleAttribute.normalize = function(value){	var result = value;	switch (this.type) {		case "string":			if (typeof value != "string") {				result = "" + value;			}			break;		case "number":		case "float":			if (typeof value == "string") {				if (value == "")					result = null;				else {					result = parseFloat(value);					if (isNaN(result))						result = null;				}			}			break;		case "boolean":			if (typeof value != "boolean") {				result = Boolean(value);			}			break;		case "date":			if (typeof value == "string") {				if (value == "")					result = null;				else {					///result = new Date(value); // Warning! Doesn't work on all engines with ISO String.					result = $.fn.DatePickerParse(value, WAF.utils.dateInputFormat);				}			}			break;		case "long":		case "byte":		case "word":		case "long64":			if (typeof(value) == "string") {				if (value == "")					result = null;				else {					result = parseInt(value, 10);					if (isNaN(result))						result = null;				}			}			break;	}	return result;};WAF.DataSourceEmSimpleAttribute.addListener = function(eventHandler, options, userData){	options = options || {};	options.attributeName = this.name;	options.attribute = this;	userData = userData;	return this.owner.addListener("onAttributeChange", eventHandler, options, userData);};WAF.DataSourceEmSimpleAttribute.dispatch = function(options){	if (options == null) {		options = {};	}	options.attribute = this;	options.attributeName = this.name;	this.owner.dispatch("onAttributeChange", options);};// ----------------------------------------------------------------------------------------------WAF.DataSourceEmRelatedAttribute = function(emAtt, source){	WAF.DataSourceEmSimpleAttribute.call(this, emAtt, source);	this.simple = false;	/*	 this.getValue = WAF.DataSourceEmSimpleAttribute.getValue;	 this.setValue = WAF.DataSourceEmSimpleAttribute.setValue;	 this.validate = WAF.DataSourceEmSimpleAttribute.validate;	 this.getOldValue = WAF.DataSourceEmSimpleAttribute.getOldValue;	 this.getValueForInput = WAF.DataSourceEmSimpleAttribute.getValueForInput;	 this.normalize = WAF.DataSourceEmSimpleAttribute.normalize;	 */};// ----------------------------------------------------------------------------------------------WAF.DataSourceEmDeepSimpleAttribute = function(emAtt, source, fullPath){	WAF.DataSourceEmSimpleAttribute.call(this, emAtt, source);	this.isFirstLevel = false;	this.name = fullPath;	this.readOnly = true;	this.getValue = WAF.DataSourceEmDeepSimpleAttribute.getValue;	this.getOldValue = WAF.DataSourceEmDeepSimpleAttribute.getOldValue;	/*	 this.setValue = WAF.DataSourceEmSimpleAttribute.setValue;	 this.validate = WAF.DataSourceEmSimpleAttribute.validate;	 this.getOldValue = WAF.DataSourceEmSimpleAttribute.getOldValue;	 this.getValueForInput = WAF.DataSourceEmSimpleAttribute.getValueForInput;	 this.normalize = WAF.DataSourceEmSimpleAttribute.normalize;	 */};WAF.DataSourceEmDeepSimpleAttribute.getValue = function(){	return this.owner.getAttributeValue(this.name)};WAF.DataSourceEmDeepSimpleAttribute.getOldValue = function(){	return this.owner.getOldAttributeValue(this.name)};// ----------------------------------------------------------------------------------------------WAF.DataSourceEmDeepRelatedAttribute = function(emAtt, source, fullPath){	WAF.DataSourceEmRelatedAttribute.call(this, emAtt, source);	this.isFirstLevel = false;	this.name = fullPath;	this.readOnly = true;	this.getValue = WAF.DataSourceEmDeepRelatedAttribute.getValue;	/*	 this.setValue = WAF.DataSourceEmSimpleAttribute.setValue;	 this.validate = WAF.DataSourceEmSimpleAttribute.validate;	 this.getOldValue = WAF.DataSourceEmSimpleAttribute.getOldValue;	 this.getValueForInput = WAF.DataSourceEmSimpleAttribute.getValueForInput;	 this.normalize = WAF.DataSourceEmSimpleAttribute.normalize;	 */};WAF.DataSourceEmDeepRelatedAttribute.getValue = function(){	return this.owner.getAttributeValue(this.name)};// ----------------------------------------------------------------------------------------------WAF.DataSourceVarAttribute = function(varAtt, source){	WAF.DataSourceEmSimpleAttribute.call(this, varAtt, source);	this.isVarAtt = true;	this.savedValue = null;	// methods: see code after the constructor definition	this.getValue = WAF.DataSourceVarAttribute.getValue;	this.setValue = WAF.DataSourceVarAttribute.setValue;	this.getOldValue = WAF.DataSourceVarAttribute.getOldValue;};WAF.DataSourceVarAttribute.getValue = function(){	var jsobj = this.owner.getCurrentElement();	if (jsobj == null) {		return null;	}	else {		return jsobj[this.name];	}};WAF.DataSourceVarAttribute.setValue = function(value, options){	options = options;	var jsobj = this.owner.getCurrentElement();	if (jsobj == null) {		// nothing to do	}	else {		if (this.owner[this.name] !== value) {			this.savedValue = value;			this.owner[this.name] = value;			jsobj[this.name] = value;			this.dispatch(options);		}	}};WAF.DataSourceVarAttribute.getOldValue = function(){	var jsobj = this.owner.getCurrentElement();	if (jsobj == null) {		return null;	}	else {		return this.savedValue;	}};// ------------------------------------------------------------------------------------------------------------WAF.DataSourceEmRelatedAttributeValue = function(emAtt, source){	this.owner = source;	this.emAtt = emAtt;	this.name = emAtt.name;	// methods: see code after the constructor definition	this.set = WAF.DataSourceEmRelatedAttributeValue.set;	this.load = WAF.DataSourceEmRelatedAttributeValue.load;};WAF.DataSourceEmRelatedAttributeValue.set = function(subsource, options){	var currentEntity = this.owner._private.currentEntity;	if (currentEntity != null) {		var subentity = null;		if (subsource != null) {			if (subsource instanceof WAF.Entity)				subentity = subsource;			else				subentity = subsource.getCurrentElement();		}		currentEntity[this.name].setValue(subentity);		var sourceAtt = this.owner.getAttribute(this.name);		if (sourceAtt != null) {			sourceAtt.dispatch(options);		}	}};WAF.DataSourceEmRelatedAttributeValue.load = function(options, userData){	var currentEntity = this.owner._private.currentEntity;	if (currentEntity != null) {		currentEntity[this.name].getValue(options, userData);	}};// ------------------------------------------------------------------------------------------------------------WAF.DataSourceListener = function(eventKind, eventHandler, config, userData){	if (WAF.DataSourceListener.prototype.currentID == null)		WAF.DataSourceListener.prototype.currentID = 1;	else		++WAF.DataSourceListener.prototype.currentID;	this.ID = WAF.DataSourceListener.prototype.currentID;	this.eventKind = eventKind;	this.eventHandler = eventHandler;	if (config == null) {		config = {};	}	this.id = config.listenerID;	this.listenerType = config.listenerType;	this.userData = userData;	if (config.attributeName != null) {		this.attributeName = config.attributeName;		this.attribute = config.attribute;	}	if (config.subID != null) {		this.subID = config.subID;	}};// ------------------------------------------------------------------------------------------------------------WAF.DataSource = function(config){	this._private = {		// private members		id: config.id,		atts: {},		currentElemPos: 0,		isNewElem: false,		listeners: [],		sourceType: "",		owner: this,		selCanBeModified: true,		oneElementOnly: false,		selIsRelatedonFirstLevel: false,		sel: new WAF.Selection('single'),		// private functions		_validateAttribute: WAF.DataSource._validateAttribute	};	this.length = 0;	// --------------------------------------------------------------------------	// API functions of a DataSource	this.getCurrentElement = WAF.DataSource.getCurrentElement;	this.getElement = WAF.DataSource.getElement;	this.getPosition = WAF.DataSource.getPosition;	this.isNewElement = WAF.DataSource.isNewElement;	this.getAttribute = WAF.DataSource.getAttribute;	//this.changedCurrentEntityAttribute = WAF.DataSource.changedCurrentEntityAttribute;	this.select = WAF.DataSource.select;	this.selectPrevious = WAF.DataSource.selectPrevious;	this.selectNext = WAF.DataSource.selectNext;	this.serverRefresh = WAF.DataSource.serverRefresh;	this.addListener = WAF.DataSource.addListener;	this.removeListener = WAF.DataSource.removeListener;	this.removeAllListeners = WAF.DataSource.removeAllListeners;	this.dispatch = WAF.DataSource.dispatch;	this.autoDispatch = WAF.DataSource.autoDispatch;	this.getID = WAF.DataSource.getID;	this.declareDependencies = WAF.DataSource.declareDependencies;	this.setDisplayLimits = WAF.DataSource.setDisplayLimits;	this.getSelection = WAF.DataSource.getSelection;	// API functions overridden in DataSource subclasses	/*	 this.getCurrentElement;	 this.getDataClass;	 this.getClassAttributeByName;	 this.autoDispatch;	 this.addNewElement;	 this.save;	 this.removeCurrent;	 this.resolveSource;	 this.mustResolveOnFirstLevel;	 this.getClassTitle;	 this.getAttributeNames;	 this.getElement(pos, options);	 this.sync(options);	 */};// private functions used for an instance of a DataSourceWAF.DataSource.makeFuncCaller = function(methodRef, source){	var methodref = methodRef;	var xsource = source;	var func = function()	{		var options;		var alreadyParsedOptions = false;		var myargs = [];        for (var i = 0 ,nb = arguments.length; i < nb; i++)        {			var p = arguments[i];			if (!alreadyParsedOptions && WAF.tools.isOptionParam(p)) {				options = p;				alreadyParsedOptions = true;			}			else				myargs.push(p);        }		var xoptions = options || {};		if (xoptions.onSuccess === undefined && xoptions.onError === undefined && xoptions.generateRESTRequestOnly === undefined)		{			xoptions.sync = true;		}		if (xoptions.arguments == null)			xoptions.arguments = myargs;		if (xoptions.autoExpand == null)			xoptions.autoExpand = xsource._private._getAutoExpand();		xoptions.method = methodref.name;		return xsource.callMethod(xoptions);	}	/*	var func = function(options){		var start = 1;		var xoptions = options || {};		if (xoptions.onSuccess === undefined && xoptions.onError === undefined && xoptions.generateRESTRequestOnly === undefined) {			xoptions = {				sync: true			};			start = 0;		}		if (xoptions.arguments == null) {			var myargs = [];			for (var i = start, nb = arguments.length; i < nb; i++) // The first one is skipped when async			{				myargs.push(arguments[i]);			}			xoptions.arguments = myargs;		}		xoptions.method = methodref.name;		return xsource.callMethod(xoptions);	}	*/	return func;}WAF.DataSource.addFuncHandler = function(methodref, source){	methodref.funcCaller = function funcCaller(){		var oktogo = true;		var request = new WAF.core.restConnect.restRequest(false);		//request.app = "";		request.httpMethod = WAF.core.restConnect.httpMethods._post;		var myargs = [];		for (var i = 0, nb = arguments.length; i < nb; i++) {			myargs.push(arguments[i]);		}		var jsonargs = JSON.stringify(myargs);		request.postdata = jsonargs;		if (methodref.applyTo == "dataClass") {			request.attributesRequested = [];			request.attributesRequested.push(methodref.name);			request.resource = source._private.dataClassName;		}		else if (methodref.applyTo == "entityCollection") {			oktogo = false;			var sel = source._private.entityCollection;			if (sel != null) {				if (sel._private.dataURI != null) {					oktogo = true;					request.dataURI = sel._private.dataURI + "/" + methodref.name;				}				else {					request.attributesRequested = [];					request.attributesRequested.push(methodref.name);					request.resource = source._private.dataClassName;					request.filter = sel.queryString;					oktogo = true;				}			}		}		else if (methodref.applyTo == "entity") {			oktogo = false;			var entity = source._private.currentEntity;			if (entity != null) {				request.attributesRequested = [];				request.attributesRequested.push(methodref.name);				oktogo = true;				request.resource = source._private.dataClassName + '(';				var key = entity.getKey();				if (key != null)					request.resource += key;				request.resource += ')';			}		}		var result = null;		if (oktogo) {			request.go();			if (request.http_request.readyState == 4) {				var fullresult = JSON.parse(request.http_request.responseText);				if (fullresult != null) {					if (fullresult.__ERROR != null) {						throw (fullresult.__ERROR);					}					else {						result = fullresult.result;					}				}				else {					throw {						error: 400					};				}			}			else {				// throw an exception when readyState not yet 4 ??				throw {					error: 401				};			}		}		else {			throw {				error: 402			};		}		return result;	};};WAF.DataSource._validateAttribute = function(attName, curValue){	var result = {		valid: true,		messages: []	};	var message = "";	// var em = this.dataClass;	//var att = em.getAttributeByName(attName);	var sourceAtt = this.owner.getAttribute(attName);	var att = null;	if (sourceAtt != null) {		att = sourceAtt.dataClassAtt;	}	if (att != null) {		if (att.maxValue != null) {			if (curValue > att.maxValue) {				result.valid = false;				message = attName + " must not exceed " + att.maxValue;				result.messages.push(message);			}		}		if (att.minValue != null) {			if (curValue < att.minValue) {				result.valid = false;				message = attName + " must not be less than " + att.minValue;				result.messages.push(message);			}		}		if (att.pattern != null) {			try {				if (curValue.match(att.pattern) == null) {					result.valid = false;					message = attName + " is not well formed";					result.messages.push(message);				}			}			catch (e) {			}		}		if (att.minLength != null) {			try {				if (curValue.length < att.minLength) {					result.valid = false;					message = attName + " must be at least " + att.minLength + " characters long";					result.messages.push(message);				}			}			catch (e) {			}		}		if (att.maxLength != null) {			try {				if (curValue.length > att.maxLength) {					result.valid = false;					message = attName + " must be less than " + att.maxLength + " characters long";					result.messages.push(message);				}			}			catch (e) {			}		}	}	return result;};// ----------------------------------------------------------------------------------------------------------------------// API functions used for an instance of a DataSourceWAF.DataSource.getCurrentElement = function(){	throw new Error('getCurrentElement not implemented');};WAF.DataSource.getElement = function(pos, options, userData){	throw new Error('getElement not implemented');};WAF.DataSource.getPosition = function(){	var result = -1;	var curelem = this.getCurrentElement();	if (curelem != null) {		result = this._private.currentElemPos;	}	return result;};WAF.DataSource.isNewElement = function(){	return this._private.isNewElem;};WAF.DataSource.getAttribute = function(attName){	var result = this._private.atts[attName];	return result;};WAF.DataSource.select = function(pos, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	this._private._setCurrentElementByPos(pos, options, userData);};WAF.DataSource.selectPrevious = function(options, userData){	if (this._private.currentElemPos > 0) {		var resOp = WAF.tools.handleArgs(arguments, 0);		userData = resOp.userData;		options = resOp.options;		this._private._setCurrentElementByPos(this._private.currentElemPos - 1, options, userData);	}};WAF.DataSource.selectNext = function(options, userData){	if (!this._private.oneElementOnly && (this._private.currentElemPos < (this.length - 1))) {		var resOp = WAF.tools.handleArgs(arguments, 0);		userData = resOp.userData;		options = resOp.options;		this._private._setCurrentElementByPos(this._private.currentElemPos + 1, options, userData);	}};WAF.DataSource.serverRefresh = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var dataSource = this;	if (options.forceReload) {		var dataClass = this.getDataClass();		var curEntity = this.getCurrentElement();		if (curEntity != null) {			var key = curEntity.getKey();			if (key == null) {				dataSource.newEntity(options);				var ev = {					entity: dataSource.getCurrentElemet()				};				WAF.callHandler(false, null, ev, options, userData);			}			else {				dataClass.getEntity(key, {					forceReload: true,					autoExpand: dataSource._private._getAutoExpand(),					onSuccess: function(event){						options.doNotAlterElemPos = true;						dataSource.setCurrentEntity(event.entity, options);						WAF.callHandler(false, null, event, options, userData);					}				});			}		}	}	else {		options.refreshOnly = true;		this.save(options, userData);	}};WAF.DataSource.addListener = function(eventKind, eventHandler, config, userData){	config = config;	userData = userData;	var listener = new WAF.DataSourceListener(eventKind, eventHandler, config, userData);	this._private.listeners.push(listener);	return listener.ID;};WAF.DataSource.removeListener = function(params){	params = params || {};	var id = params.ID;	var listeners = this._private.listeners;	var found = -1;	for (var i = 0, nb = listeners.length; i < nb; i++) {		if (listeners[i].ID == id) {			found = i;			break;		}	}	if (found != -1)		listeners.splice(found, 1);};WAF.DataSource.removeAllListeners = function(params){	this._private.listeners = [];};WAF.DataSource.autoDispatch = function(options){	throw new Error('autoDispatch not implemented');}WAF.DataSource.dispatch = function(eventKind, options){	options = options || {};	var dispatchSubID = options.subID;	var dispatcherInitiator = options.dispatcherID;	var attName = options.attributeName;	var checkAttName = false;	var match;	if (eventKind == "onAttributeChange") {		checkAttName = true;	}	if (!options.stopDispatch) {		for (var i = 0; i < this._private.listeners.length; i++) {			var listener = this._private.listeners[i];			if (dispatcherInitiator == null || dispatcherInitiator != listener.id) {				var okDispatch = false;				switch (listener.eventKind) {					case 'all':						okDispatch = true;						break;					case 'onBeforeCurrentElementChange':						if (eventKind == 'onBeforeCurrentElementChange') {							okDispatch = true;						}						break;					case 'onElementSaved':						if (eventKind == 'onElementSaved') {							okDispatch = true;						}						break;					case 'onCollectionChange':						if (eventKind == 'onCollectionChange') {							okDispatch = true;						}						break;					case 'onCurrentElementChange':						if (eventKind == 'onCollectionChange' || eventKind == 'onCurrentElementChange') {							okDispatch = true;						}						break;					case 'onAttributeChange':						if (eventKind == 'onCollectionChange' || eventKind == 'onCurrentElementChange') {							okDispatch = true;						}						else {							if (eventKind == "onAttributeChange" && attName == listener.attributeName) {								okDispatch = true;							}						}						break;				}				if (okDispatch) {					if (dispatchSubID != null || listener.subID != null) {						// enable dispatch to many widgets						if (dispatchSubID) {							match = dispatchSubID.match(listener.subID);							if (match && match.length >= 1 && match[0]) {								okDispatch = true;							}							else {								okDispatch = false;							}						}						else {							okDispatch = (listener.subID === dispatchSubID);						}					}				}				if (okDispatch) {					var dispatchEvent = {						dataSource: this,						eventKind: eventKind,						listenerID: listener.id,						listenerType: listener.listenerType,						dispatcherID: dispatcherInitiator,						dispatcherType: options.dispatcherType,						data: listener.userData,						userData: listener.userData,						eventData: options.userData || null,						dispatcherOptions: options,						subID: listener.subID || null					};					if (options.transformedSelection != null)						dispatchEvent.transformedSelection = options.transformedSelection;					if (checkAttName) {						dispatchEvent.attributeName = attName;						dispatchEvent.attribute = this.getAttribute(attName);					}					if (eventKind == 'onElementSaved') {						dispatchEvent.entity = options.entity;						dispatchEvent.position = options.position;						dispatchEvent.element = options.element;					}					listener.eventHandler(dispatchEvent);				}			}		}	}};WAF.DataSource.getID = function(){	return this._private.id;};WAF.DataSource.declareDependencies = function(dependencies, options){	// nothing to do in base class}WAF.DataSource.setDisplayLimits = function(ID, top, bottom){	// nothing to do in base class}WAF.DataSource.getSelection = function(){	return this._private.sel;}// end of API functions used for an instance of a DataSource// ----------------------------------------------------------------------------------------------------------------------WAF.delayRequest = function(requestID, top, bottom){	this.requestID = requestID;	this.top = top;	this.bottom = bottom;	this.pendingFetch = [];	return this;}WAF.delayRequest.prototype.matchRange = function(top, bottom){	return ((top >= this.top && top <= this.bottom) || (bottom >= this.top && bottom <= this.bottom));}WAF.delayRequest.prototype.match = function(pos){	return (pos >= this.top && pos <= this.bottom);}WAF.delayRequest.prototype.addFetchRequest = function(pos, options, userData){	this.pendingFetch.push({		pos: pos,		options: options,		userData: userData	});}WAF.delayRequest.prototype.setRequestID = function(requestID){	this.requestID = requestID;}// -------------------------------------------------------------WAF.DelayInfoForDataSource = function(ID, top, bottom, config){	this.ID = ID;	this.top = top;	this.bottom = bottom;	this.pendingRequests = [];	return this;}WAF.DelayInfoForDataSource.prototype.setLimits = function(top, bottom){	this.top = top;	this.bottom = bottom;}WAF.DelayInfoForDataSource.prototype.addPendingRequest = function(requestID, top, bottom){	var req = new WAF.delayRequest(requestID, top, bottom);	this.pendingRequests.push(req);	return req;}WAF.DelayInfoForDataSource.prototype.removePendingRequest = function(delayReq){	var requestID = delayReq.requestID;	var reqs = this.pendingRequests;	var found = -1;	for (var i = 0, nb = reqs.length; i < nb; i++) {		if (reqs[i].requestID == requestID) {			found = i;			break;		}	}	if (found != -1)		reqs.splice(found, 1);}WAF.DelayInfoForDataSource.prototype.findMatchingPendingRequest = function(pos){	var result = null;	this.pendingRequests.forEach(function(req){		if (req.match(pos)) {			result = req;		}	});	return result;}// -------------------------------------------------------------WAF.DataSourceEm = function(config){	WAF.DataSource.call(this, config);	var priv = this._private;	priv.dataClass = null;	priv.otherSource = null;	priv.otherAttribute = null;	priv.dataClassName = "";	priv.currentEntity = null;	priv.entityCollection = null;	priv.autoExpand = {};	priv.methods = {};	priv.delayInfos = {};	// private functions	priv._updateValues = WAF.DataSourceEm._updateValues;	priv._gotEntity = WAF.DataSourceEm._gotEntity;	priv._gotEntityCollection = WAF.DataSourceEm._gotEntityCollection;	priv._setCurrentElementByPos = WAF.DataSourceEm._setCurrentElementByPos;	priv._Init = WAF.DataSourceEm._Init;	priv._addAttributeDependency = WAF.DataSourceEm._addAttributeDependency;	priv._getAutoExpand = WAF.DataSourceEm._getAutoExpand;	priv._mixOptions = WAF.DataSourceEm._mixOptions;	// --------------------------------------------------------------------------	// API functions of a DataSource	this.getCurrentElement = WAF.DataSourceEm.getCurrentElement;	this.getDataClass = WAF.DataSourceEm.getDataClass;	this.getClassAttributeByName = WAF.DataSourceEm.getClassAttributeByName;	this.getAttribute = WAF.DataSourceEm.getAttribute; // overwritten	this.autoDispatch = WAF.DataSourceEm.autoDispatch;	this.setEntityCollection = WAF.DataSourceEm.setEntityCollection;	this.addNewElement = WAF.DataSourceEm.addNewElement;	this.addEntity = WAF.DataSourceEm.addEntity;	this.save = WAF.DataSourceEm.save;	this.removeCurrent = WAF.DataSourceEm.removeCurrent;	this.distinctValues = WAF.DataSourceEm.distinctValues;	this.selectByKey = WAF.DataSourceEm.selectByKey;	this.toArray = WAF.DataSourceEm.toArray;	this.getEntityCollection = WAF.DataSourceEm.getEntityCollection;	this.setCurrentEntity = WAF.DataSourceEm.setCurrentEntity;	this.newEntity = WAF.DataSourceEm.newEntity;	this.all = WAF.DataSourceEm.allEntities;	this.allEntities = WAF.DataSourceEm.allEntities;	this.noEntities = WAF.DataSourceEm.noEntities;	this.query = WAF.DataSourceEm.query;	this.filterQuery = WAF.DataSourceEm.filterQuery;	this.orderBy = WAF.DataSourceEm.orderBy;	this.resolveSource = WAF.DataSourceEm.resolveSource;	this.mustResolveOnFirstLevel = WAF.DataSourceEm.mustResolveOnFirstLevel;	this.getClassTitle = WAF.DataSourceEm.getClassTitle;	this.getAttributeNames = WAF.DataSourceEm.getAttributeNames;	this.getElement = WAF.DataSourceEm.getElement;	this.sync = WAF.DataSourceEm.sync;	this.getAttributeValue = WAF.DataSourceEm.getAttributeValue;	this.getOldAttributeValue = WAF.DataSourceEm.getOldAttributeValue;	this.declareDependencies = WAF.DataSourceEm.declareDependencies;	this.callMethod = WAF.DataSourceEm.callMethod;	this.buildFromSelection = WAF.DataSourceEm.buildFromSelection;	this.setDisplayLimits = WAF.DataSourceEm.setDisplayLimits;	this._private._Init(config);};/* ************************ */// private functionsWAF.DataSourceEm._Init = function(config){	var owner = this.owner;	var okInited = false;	// resolution de la source	this.dataClassName = config.binding;	this.initialQuery = true;	this.initialQueryStr = '';	this.initialOrderBy = '';	if (config["data-autoLoad"] != null) {		if (config["data-autoLoad"] === "false" || config["data-autoLoad"] === "0" || config["data-autoLoad"] === false) {			this.initialQuery = false;		}	}	if (config["data-initialQueryString"] != null) {		this.initialQueryStr = config["data-initialQueryString"]; // Should check config["data-initial-queryString"] is valid	}	if (config["data-initialOrderBy"] != null) {		this.initialOrderBy = config["data-initialOrderBy"]; // Should check config["data-initial-queryString"] is valid	}	var decompName = this.dataClassName.split('.');	if (decompName.length == 1) {		this.sourceType = "dataClass";		this.dataClass = WAF.ds.getDataClass(this.dataClassName);	}	else {		var sourceName = decompName[0];		var attName = decompName[1];		var otherSource = WAF.source[sourceName];		if (otherSource == null) {			this.sourceType = "invalid";		}		else {			var em = otherSource._private.dataClass;			if (em != null) {				var att = em.getAttributeByName(attName);				if (att != null) {					this.dataClass = WAF.ds.getDataClass(att.type);					this.dataClassName = att.type;					this.otherSource = otherSource;					this.otherAttribute = att;					if (att.kind == "relatedEntity") {						this.sourceType = "relatedEntity";					}					else {						if (att.kind == "relatedEntities") {							this.sourceType = "relatedEntities";							if (att.reversePath) {								var foreignKey = att.path;								if (foreignKey != null)									foreignKey = this.dataClass.getAttributeByName(foreignKey);								if (foreignKey != null) {									this.selIsRelatedonFirstLevel = true;									this.foreignKeyAttribute = foreignKey;								}							}						}						else {							this.sourceType = "invalid";						}					}					if (this.sourceType != "invalid") {						otherSource.getAttribute(att.name).addListener(WAF.DataSourceEm._resolveEventHandler, { // options							listnerID: config.id,							listnerType: 'datasource'						}, { // userData							source: owner						});					}				}				else {					this.sourceType = "invalid";				}			}			else {				this.sourceType = "invalid";			}		}	}	okInited = this.sourceType != "invalid";	if (!okInited) {		this.needForInit = config;	}	var em = this.dataClass;	if (em != null) {		var methlist = em.getMethodList();		if (methlist != null) {			for (var i = 0, nb = methlist.length; i < nb; i++) {				var methodRef = methlist[i];				WAF.DataSource.addFuncHandler(methodRef, owner);				owner[methodRef.name] = WAF.DataSource.makeFuncCaller(methodRef, owner);				this.methods[methodRef.name] = methodRef;			}		}		var attlist = em.getAttributes();		if (attlist != null) {			for (var i = 0, nb = attlist.length; i < nb; i++) {				var att = attlist[i];				if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {					var curValue = null;					if (this.currentEntity != null) {						curValue = this.currentEntity[att.name].getValue();					}					var sourceAtt = new WAF.DataSourceEmSimpleAttribute(att, owner);					owner[att.name] = curValue;					this.atts[att.name] = sourceAtt;					if (att.maxValue != null) {						att.maxValue = sourceAtt.normalize(att.maxValue);					}					if (att.minValue != null) {						att.minValue = sourceAtt.normalize(att.minValue);					}					if (att.minLength != null && typeof(att.minLength) == "string") {						att.minLength = parseInt(att.minLength, 10);					}					if (att.maxLength != null && typeof(att.maxLength) == "string") {						att.maxLength = parseInt(att.maxLength, 10);					}					if (att.fixedLength != null && typeof(att.fixedLength) == "string") {						att.fixedLength = parseInt(att.fixedLength, 10);					}				}				else {					var sourceAtt = new WAF.DataSourceEmRelatedAttribute(att, owner);					this.atts[att.name] = sourceAtt;					if (att.kind == "relatedEntity") {						owner[att.name] = new WAF.DataSourceEmRelatedAttributeValue(att, owner);					}				}			}		}	}	if (okInited) {		delete this.needForInit;		this.selCanBeModified = this.sourceType == "dataClass";		this.oneElementOnly = this.sourceType == "relatedEntity";		if (!this.selCanBeModified) {			delete owner.setEntityCollection;			delete owner.noEntities;			delete owner.query;		}		if (this.oneElementOnly) {			delete owner.setEntityCollection;			delete owner.noEntities;			delete owner.addNewElement;			delete owner.addEntity;			//delete owner.setCurrentEntity;			delete owner.newEntity;			delete owner.query;			delete owner.removeCurrent;			delete owner.distinctValues;			delete owner.getEntityCollection;			delete owner.selectNext;			delete owner.select;			delete owner.selectPrevious;		}	}	return okInited;};WAF.DataSourceEm._resolveEventHandler = function(event){	event.data.source.resolveSource({		dispatcherID: event.dispatcherID	});};WAF.DataSourceEm._updateValues = function(){	for (var i in this.atts) {		var sourceAtt = this.atts[i];		if ((sourceAtt.simple || sourceAtt.type === "image") && sourceAtt.isFirstLevel) {			if (this.currentEntity == null) {				this.owner[sourceAtt.name] = null;			}			else {				this.owner[sourceAtt.name] = this.currentEntity[sourceAtt.name].getValue();			}		}	}};WAF.DataSourceEm._gotEntity = function(event){	var datas = event.userData;	var options = datas.options || {};	var source = datas.dataSource;	if (source._private.currentEntity != null) {		source.dispatch('onBeforeCurrentElementChange', options);	}	source._private.currentElemPos = datas.entityPos;	source._private.isNewElem = false;	source._private.currentEntity = event.entity;	source._private._updateValues();	if (datas.mustPublish) {		source.dispatch('onCurrentElementChange', options);	}	var onSuccess = options.onSuccess;	var onError = options.onError;	var dsEvent = {		dataSource: source,		data: datas.userData,		userData: datas.userData,		XHR: event.XHR || null	};	if (event.error != null && event.error.length > 0) {		if (onError != null) {			dsEvent.error = event.error;			onError(dsEvent);		}	}	else {		if (onSuccess != null) {			onSuccess(dsEvent);		}	}};WAF.DataSourceEm._gotEntityCollection = function(event){	var datas = event.userData;	var options = datas.options || {};	var source = datas.dataSource;	if (event.error != null && options.keepOldCollectionOnError) {		var onError = options.onError;		if (onError != null) {			var dsEvent = {				dataSource: source,				data: datas.userData,				userData: datas.userData,				XHR: event.XHR || null,				error: event.error			};			onError(dsEvent);		}	}	else {		if (source._private.currentEntity != null)			source.dispatch('onBeforeCurrentElementChange', options);		source._private.currentEntity = null;		source._private.entityCollection = event.entityCollection;		var newcurpos = 0;		var transsel = null;		if (event.transformedSelection != null) {			transsel = new WAF.Selection(event.transformedSelection);			source._private.sel = transsel;			newcurpos = transsel.getFirst();			options.transformedSelection = transsel;		}		else {			source._private.sel.reset();		}		source.length = source._private.entityCollection.length;		if (datas.curPos != null && datas.curPos >= 0) {			if (datas.curPos >= source.length)				source._private.currentElemPos = source.length - 1;			else				source._private.currentElemPos = datas.curPos;		}		else			source._private.currentElemPos = newcurpos;		source._private.isNewElem = false;		if (options.progressBar != null) {			options.progressBar.stopListening();		}		if (source._private.entityCollection.length == 0) {			source._private.currentEntity = null;			source._private._updateValues();			if (datas.mustPublish) {				source.dispatch('onCollectionChange', options);			}			var onSuccess = options.onSuccess;			var onError = options.onError;			var dsEvent = {				dataSource: source,				data: datas.userData,				XHR: event.XHR || null,				userData: datas.userData			};			if (event.error != null && event.error.length > 0) {				dsEvent.error = event.error;				if (onError != null)					onError(dsEvent);			}			else {				if (onSuccess != null)					onSuccess(dsEvent);			}		}		else {			if (datas.mustPublish) {				source.dispatch('onCollectionChange', options);			}			datas.entityPos = source._private.currentElemPos;			source._private.entityCollection.getEntity(source._private.currentElemPos, {				onSuccess: source._private._gotEntity,				onError: source._private._gotEntity			}, datas);		}	}};WAF.DataSourceEm._setCurrentElementByPos = function(pos, options, userData){	options = options || {};	userData = userData;	var onSuccess = options.onSuccess;	var onError = options.onError;	var dsEvent = {		dataSource: this.owner,		data: userData,		userData: userData	};	if ((this.owner.getPosition() == pos) || (this.oneElementOnly)) {		if (onSuccess != null) {			onSuccess(dsEvent);		}	}	else {		ok = false;		if (this.entityCollection != null) {			if (pos >= 0 && pos < this.entityCollection.length) {				ok = true;				//this.currentElemPos = pos;				var delayinfo = null;				if (options.delayID != null)					delayinfo = this.delayInfos[options.delayID];				this.entityCollection.getEntity(pos, {					onSuccess: this._gotEntity,					onError: this._gotEntity,					delay: options.delay || null,					delayInfo: delayinfo				}, {					dataSource: this.owner,					mustPublish: true,					options: options,					userData: userData,					entityPos: pos				});			}		}		if (!ok) {			if (this.currentEntity != null)				this.owner.dispatch('onBeforeCurrentElementChange', options);			this.currentEntity = null;			this.currentElemPos = 0;			this._updateValues();			this.owner.dispatch('onCurrentElementChange', options);		}	}};WAF.DataSourceEm._addAttributeDependency = function(attributePath, options){	var root = this.autoExpand;	var em = this.dataClass;	options = options || {};	var path = attributePath.split(".");	var nb = path.length;	for (var i = 0; i < nb; i++) {		var attName = path[i];		var att = em.getAttributeByName(attName);		if (att != null) {			if (att.kind == 'relatedEntity' || ((att.kind == 'relatedEntities' || att.kind == 'composition') && options.allow1ToN)) {				if (root[attName] == null) {					root[attName] = {};				}				root = root[attName];				var subEm = WAF.ds.getDataClass(att.type);				if (subEm == null) {					break;				}				else {					em = subEm;				}			}			else {				break;			}		}	}}WAF.DataSourceEm._getAutoExpand = function(){	function getOneLevel(root, rootpath, deja){		var res = deja		for (e in root) {			if (res != "")				res += ",";			res += (rootpath + e);			res = getOneLevel(root[e], rootpath + e + ".", res);		}		return res;	}	var s = getOneLevel(this.autoExpand, "", "");	return s;}WAF.DataSourceEm._mixOptions = function(inOptions, outOptions){	outOptions = outOptions || {};	if (inOptions) {		if (inOptions.orderBy != null)			outOptions.orderBy = inOptions.orderBy;		if (inOptions.queryPlan != null)			outOptions.queryPlan = inOptions.queryPlan;		if (inOptions.queryPath != null)			outOptions.queryPath = inOptions.queryPath;		if (inOptions.autoExpand != null)			outOptions.autoExpand = inOptions.autoExpand;		if (inOptions.params != null)			outOptions.params = inOptions.params;		if (inOptions.pageSize != null)			outOptions.pageSize = inOptions.pageSize;		if (inOptions.keepSelection != null)			outOptions.keepSelection = inOptions.keepSelection;		if (inOptions.keepOldCollectionOnError != null)			outOptions.keepOldCollectionOnError = inOptions.keepOldCollectionOnError;		if (inOptions.fromSelection != null)			outOptions.fromSelection = inOptions.fromSelection;		if (inOptions.progressInfo != null)			outOptions.progressInfo = inOptions.progressInfo;		else {			if (inOptions.progressBar != null) {				if (typeof(inOptions.progressBar) == 'string')					outOptions.progressBar = WAF.widgets[inOptions.progressBar];				else					outOptions.progressBar = inOptions.progressBar;				inOptions.progressBar = outOptions.progressBar;			}			if (outOptions.progressBar != null) {				var newprogress = outOptions.progressBar.id + "_" + Math.random() + "_" + new Date().toString();				outOptions.progressBar.setProgressInfo(newprogress);				outOptions.progressInfo = newprogress;				outOptions.progressBar.startListening();			}		}	}	return outOptions;}/* ************************ */// public API/* DESCRIBED ON DATASOURCE CLASS */WAF.DataSourceEm.getCurrentElement = function(){	return this._private.currentEntity;};WAF.DataSourceEm.getDataClass = function(){	return this._private.dataClass;};WAF.DataSourceEm.getClassAttributeByName = function(attName){	var attpath = attName.split(".");	var result;	if (attpath.length == 1)		result = this._private.dataClass.getAttributeByName(attName);	else {		result = null;		var root = this._private.dataClass;		for (var i = 0; i < attpath.length; i++) {			var s = attpath[i];			result = root.getAttributeByName(s);			if (result == null)				break;			else if (result.kind != "composition" && result.kind != "relatedEntities" && result.kind != "relatedEntity") {				break;			}			else {				root = WAF.ds.getDataClass(result.type);				if (root == null) {					result = null;					break;				}			}		}	}	return result;};WAF.DataSourceEm.getAttribute = function(attName){	var result;	var path = attName.split(".");	if (path.length == 1)		result = this._private.atts[attName];	else {		result = this._private.atts[attName];		if (result == null) {			var root = this._private.dataClass;			for (var i = 0, nb = path.length - 1; i < nb; i++) {				var s = path[i];				var att = root.getAttributeByName(s);				if (att != null && att.kind == 'relatedEntity') {					root = WAF.ds.getDataClass(att.type);				}				else					root = null;				if (root == null)					break;			}			if (root != null) {				var s = path[nb];				var att = root.getAttributeByName(s);				if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {					var sourceAtt = new WAF.DataSourceEmDeepSimpleAttribute(att, this, attName);					this._private.atts[attName] = sourceAtt;					result = sourceAtt;				}				else {					var sourceAtt = new WAF.DataSourceEmDeepRelatedAttribute(att, this, attName);					this._private.atts[attName] = sourceAtt;					/*					 if (att.kind == "relatedEntity")					 {					 this[attName] = new WAF.DataSourceEmRelatedAttributeValue(att, owner);					 }					 */					result = sourceAtt;				}			}			if (result != null)				this.declareDependencies(attName);		}	}	return result;};/* DESCRIBED ON DATASOURCE CLASS */WAF.DataSourceEm.autoDispatch = function(options){	var entity = this.getCurrentElement();	if (entity != null) {		for (var i in this._private.atts) {			var sourceAtt = this._private.atts[i];			if (sourceAtt.simple && sourceAtt.isFirstLevel) {				var curValue = this[sourceAtt.name];				var oldvalue = entity[sourceAtt.name].value;				if (oldvalue !== curValue) {					entity[sourceAtt.name].setValue(curValue);					sourceAtt.dispatch(options);				}			}		}	}};WAF.DataSourceEm.addNewElement = function(options){	options = options;	var priv = this._private;	var otherEntity = null;	if (priv.selIsRelatedonFirstLevel) {		otherEntity = priv.otherSource._private.currentEntity;	}	if (priv.selCanBeModified || (priv.selIsRelatedonFirstLevel && otherEntity != null)) {		if (priv.currentEntity != null) {			this.dispatch('onBeforeCurrentElementChange', options);		}		priv._updateValues();		priv.currentEntity = new WAF.Entity(priv.dataClass);		if (priv.selIsRelatedonFirstLevel) {			var fkeyname = priv.foreignKeyAttribute.name;			this[fkeyname].set(priv.otherSource);		}		priv.entityCollection.add(priv.currentEntity);		priv.isNewElem = true;		this.length = priv.entityCollection.length;		priv.currentElemPos = priv.entityCollection.length - 1;		priv._updateValues();		this.dispatch('onCollectionChange', options);		//this.dispatch('onCurrentElementChange', options);	}};WAF.DataSourceEm.setEntityCollection = function(newEntityCollection, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	if (this._private.selCanBeModified) {		if (this._private.currentEntity != null) {			this.dispatch('onBeforeCurrentElementChange', options);		}		this._private.entityCollection = newEntityCollection;		if (this._private.entityCollection === undefined) {			var tagadabreak = 1;		}		if (newEntityCollection != null) {			this.length = newEntityCollection.length;		}		else {			this.length = 0;		}		this._private.currentEntity = null;		this._private._updateValues();		this._private.currentElemPos = 0;		this.dispatch('onCollectionChange', options);		if (this._private.entityCollection != null && this._private.entityCollection.length > 0) {			this._private.entityCollection.getEntity(this._private.currentElemPos, {				onSuccess: this._private._gotEntity,				onError: this._private._gotEntity			}, {				dataSource: this,				mustPublish: true,				options: options,				userData: userData,				entityPos: 0			});		}		else {			this.dispatch('onCurrentElementChange', options);		}	}};WAF.DataSourceEm.addEntity = function(entity, options){	var priv = this._private;	options = options	var otherEntity = null;	if (priv.selIsRelatedonFirstLevel) {		otherEntity = priv.otherSource._private.currentEntity;	}	if (priv.selCanBeModified || (priv.selIsRelatedonFirstLevel && otherEntity != null)) {		if (priv.currentEntity != null) {			this.dispatch('onBeforeCurrentElementChange', options);		}		priv._updateValues();		priv.currentEntity = entity;		if (priv.selIsRelatedonFirstLevel) {			var fkeyname = priv.foreignKeyAttribute.name;			this[fkeyname].set(priv.otherSource);		}		priv.entityCollection.add(priv.currentEntity);		priv.isNewElem = true;		this.length = priv.entityCollection.length;		priv.currentElemPos = priv.entityCollection.length - 1;		this.dispatch('onCollectionChange', options);		//this.dispatch('onCurrentElementChange', options);		priv._updateValues();	}};WAF.DataSourceEm.save = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var onSuccess = options.onSuccess;	var refreshOnly = options.refreshOnly;	if (refreshOnly == null) {		refreshOnly = false;	}	var entity = this.getCurrentElement();	var curElemPos = this.getPosition();	this.autoDispatch({		stopDispatch: true	});	if (entity != null) {		var dsEvent = {			dataSource: this,			data: userData,			userData: userData		};		var onError = options.onError;		if (refreshOnly || entity.isTouched()) {			var source = this;			var onSave = function(event){				dsEvent.XHR = event.XHR;				event.userData.options.entity = entity;				event.userData.options.position = curElemPos;				event.userData.options.element = WAF.DataSourceEm.makeElement(source, entity);				event.userData.obj.dispatch('onElementSaved', event.userData.options);				if (source._private.currentEntity != null && entity.getKey() == source._private.currentEntity.getKey()) {					source._private._updateValues();					event.userData.obj.dispatch('onCurrentElementChange', event.userData.options);				}				if (event.error != null && event.error.length > 0) {					dsEvent.error = event.error;					if (onError != null)						onError(dsEvent);				}				else {					if (onSuccess != null)						onSuccess(dsEvent);				}			};			entity.save({				onSuccess: onSave,				onError: onSave,				refreshOnly: refreshOnly,				overrideStamp: options.overrideStamp || false,				autoExpand: this._private._getAutoExpand()			}, {				obj: this,				options: options,				userData: userData,				refreshOnly: refreshOnly			});		}		else {			if (onSuccess != null)				onSuccess(dsEvent);		}	}	else {		if (onSuccess != null)			onSuccess(dsEvent);	}};WAF.DataSourceEm.removeCurrent = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	if (options.keepOldCollectionOnError == null)		options.keepOldCollectionOnError = true;	var entityCollection = this.getEntityCollection();	var curPos = this._private.currentElemPos;	if (curPos >= 0 && entityCollection != null && curPos < entityCollection.length) {		var xoptions = {			onSuccess: this._private._gotEntityCollection,			onError: this._private._gotEntityCollection,			persistOnServer: true,			pageSize: 40,			autoExpand: this._private._getAutoExpand()		};		var datas = {			type: 'getEntityCollection',			dataSource: this,			mustPublish: true,			options: options,			userData: userData,			curPos: curPos		};		xoptions = this._private._mixOptions(options, xoptions);		entityCollection.removeEntity(curPos, xoptions, datas);	}};WAF.DataSourceEm.distinctValues = function(attributeName, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	this.getEntityCollection().distinctValues(attributeName, options, userData);};WAF.DataSourceEm.selectByKey = function(key, options, userData){	var dataSource = this;	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	function selectByKeyHandler(event){		event.dataSource = dataSource;		if (event.error == null) {			dataSource.select(event.result, options, userData);		}		else			WAF.callHandler(true, event.error, event, options, userData);	}	this.getEntityCollection().findKey(key, selectByKeyHandler);}WAF.DataSourceEm.toArray = function(attributeList, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var eSet = this.getEntityCollection();	if (eSet != null)		eSet.toArray(attributeList, options, userData);};WAF.DataSourceEm.getEntityCollection = function(){	var result = null;	if (this._private.entityCollection != null) {		result = this._private.entityCollection;	}	return result;};WAF.DataSourceEm.setCurrentEntity = function(entity, options){	options = options || {};	if (this._private.currentEntity != null) {		this.dispatch('onBeforeCurrentElementChange', options);	}	if (!options.doNotAlterElemPos)		this._private.currentElemPos = -1;	this._private.currentEntity = entity;	this._private.isNewElem = false;	this._private._updateValues();	this.dispatch('onCurrentElementChange', options);};WAF.DataSourceEm.newEntity = function(options){	options = options;	if (this._private.currentEntity != null) {		this.dispatch('onBeforeCurrentElementChange', options);	}	this._private.currentElemPos = -1;	this._private.currentEntity = new WAF.Entity(this._private.dataClass);	this._private.isNewElem = true;	this._private._updateValues();	this.dispatch('onCurrentElementChange', options);};WAF.DataSourceEm.query = function(queryString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1, {		queryParams: true	});	userData = resOp.userData;	options = resOp.options;	var xoptions = {		onSuccess: this._private._gotEntityCollection,		onError: this._private._gotEntityCollection,		persistOnServer: true,		pageSize: 40,		autoExpand: this._private._getAutoExpand()	};	var datas = {		type: 'getEntityCollection',		dataSource: this,		mustPublish: true,		options: options,		userData: userData	};	xoptions = this._private._mixOptions(options, xoptions);	this._private.dataClass.query(queryString, xoptions, datas);};WAF.DataSourceEm.filterQuery = function(queryString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1, {		queryParams: true	});	userData = resOp.userData;	options = resOp.options;	var xoptions = {		onSuccess: this._private._gotEntityCollection,		onError: this._private._gotEntityCollection,		persistOnServer: true,		pageSize: 40,		autoExpand: this._private._getAutoExpand(),		filterSet: this._private.entityCollection	};	var datas = {		type: 'getEntityCollection',		dataSource: this,		mustPublish: true,		options: options,		userData: userData	};	xoptions = this._private._mixOptions(options, xoptions);	this._private.dataClass.query(queryString, xoptions, datas);};WAF.DataSourceEm.allEntities = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	this.query("", options, userData);}WAF.DataSourceEm.noEntities = function(){	if (this._private.entityCollection.length > 0) {		this.setEntityCollection(this._private.dataClass.newCollection());	}}WAF.DataSourceEm.orderBy = function(orderByString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var sel = this.getSelection();	if (sel != null && options.keepSelection === undefined)		options.keepSelection = sel.prepareToSend();	var entityCollection = this._private.entityCollection;	if (entityCollection != null) {		var xoptions = {			onSuccess: this._private._gotEntityCollection,			onError: this._private._gotEntityCollection,			persistOnServer: true,			pageSize: 40,			//keepOldCollectionOnError: true,			autoExpand: this._private._getAutoExpand()		};		xoptions = this._private._mixOptions(options, xoptions);		var datas = {			type: 'getEntityCollection',			dataSource: this,			mustPublish: true,			options: options,			userData: userData		};		entityCollection.orderBy(orderByString, xoptions, datas);	}};WAF.DataSourceEm.buildFromSelection = function(selection, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var entityCollection = this._private.entityCollection;	if (entityCollection != null) {		var xoptions = {			onSuccess: this._private._gotEntityCollection,			onError: this._private._gotEntityCollection,			persistOnServer: true,			pageSize: 40,			autoExpand: this._private._getAutoExpand()		};		xoptions = this._private._mixOptions(options, xoptions);		var datas = {			type: 'buildFromSelection',			dataSource: this,			mustPublish: true,			options: options,			userData: userData		};		return entityCollection.buildFromSelection(selection, xoptions, datas);	}}WAF.DataSourceEm.resolveSource = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	switch (this._private.sourceType) {		case "dataClass":			this._private.currentElemPos = 0;			if (this._private.initialQuery) {				var qStr = this._private.initialQueryStr ? this._private.initialQueryStr : '', orderByStr = '', mainOptions = {					pageSize: this._private.dataClass.getDefaultTopSize() || 40,					onSuccess: this._private._gotEntityCollection,					onError: this._private._gotEntityCollection,					persistOnServer: true,					autoExpand: this._private._getAutoExpand()				}, specialOptions, theUserData = {					type: "getEntityCollection",					mustPublish: true,					dataSource: this,					options: options,					userData: userData				};				// We add the orderBy statement only if the query string is not ''				if (this._private.initialOrderBy !== '') {					orderByStr = this._private.initialOrderBy;					if (qStr !== '') {						qStr += ' order by ' + orderByStr;					}				}				// Query string not empty, or empty query string with no order by				if (qStr !== '' || orderByStr === '') {					this._private.entityCollection = this._private.dataClass.query(qStr, mainOptions, theUserData);				}				else {					// Empty query string with orderBy. We first query all entities, then orderBy					// (but in the future, we should be able to send a special query. For example					// ...query('* order by ...') or ...query('ALL order by ...')					function _queryCallbackForOrderBy(e){						e.entityCollection.orderBy(orderByStr, mainOptions, theUserData);					}					specialOptions = {						pageSize: 40,						onSuccess: _queryCallbackForOrderBy,						onError: _queryCallbackForOrderBy,						persistOnServer: true,						autoExpand: this._private._getAutoExpand()					};					this._private.entityCollection = this._private.dataClass.query('', specialOptions, theUserData);				}			/*			 this._private.entityCollection = this._private.dataClass.query(			 '',			 {			 pageSize: 40,			 onSuccess: this._private._gotEntityCollection,			 onError: this._private._gotEntityCollection,			 persistOnServer: true,			 autoExpand: this._private._getAutoExpand()			 },			 {			 type: "getEntityCollection",			 mustPublish: true,			 dataSource: this,			 options: options,			 userData: userData			 }			 );			 */			}			else {				this._private.entityCollection = this._private.dataClass.newCollection();				this._private.currentEntity = null;				this._private._updateValues();				this.dispatch('onCollectionChange', options);				var onSuccess = options.onSuccess;				var dsEvent = {					dataSource: this,					data: userData,					userData: userData				};				if (onSuccess != null)					onSuccess(dsEvent);			}			break;		case "relatedEntities":			var otherEntity = this._private.otherSource._private.currentEntity;			if (otherEntity == null) {				if (this._private.currentEntity != null) {					this.dispatch('onBeforeCurrentElementChange', options);				}				this._private.entityCollection = null;				this._private.currentEntity = null;				this._private._updateValues();				this._private.currentElemPos = 0;				this.length = 0;				this.dispatch('onCollectionChange', options);				var onSuccess = options.onSuccess;				var dsEvent = {					dataSource: this,					data: userData,					userData: userData				};				if (onSuccess != null)					onSuccess(dsEvent);			}			else {				var otherAtt = otherEntity[this._private.otherAttribute.name];				if (otherAtt == null) {					if (this._private.currentEntity != null) {						this.dispatch('onBeforeCurrentElementChange', options);					}					this._private.entityCollection = null;					this._private.currentEntity = null;					this._private._updateValues();					this._private.currentElemPos = 0;					this.length = 0;				}				else {					this._private.entityCollection = otherAtt.getValue({						onSuccess: this._private._gotEntityCollection,						onError: this._private._gotEntityCollection,						autoSubExpand: this._private._getAutoExpand()					}, {						type: 'getEntityCollection',						dataSource: this,						mustPublish: true,						options: options,						userData: userData					});					if (this._private.entityCollection === undefined) {						var tagadabreak = 1;					}				}			}			break;		case "relatedEntity":			this._private.entityCollection = null;			this._private.currentElemPos = 0;			var otherEntity = this._private.otherSource._private.currentEntity;			if (otherEntity == null) {				if (this._private.currentEntity != null) {					this.dispatch('onBeforeCurrentElementChange', options);				}				this._private.currentEntity = null;				this._private._updateValues();				this.dispatch('onCurrentElementChange', options);			}			else {				var otherAtt = otherEntity[this._private.otherAttribute.name];				if (otherAtt == null) {					if (this._private.currentEntity != null) {						this.dispatch('onBeforeCurrentElementChange', options);					}					this.length = 0;					this._private.currentEntity = null;					this._private._updateValues();					this.dispatch('onCurrentElementChange', options);				}				else {					this.length = 1;					otherAtt.getValue({						onSuccess: this._private._gotEntity,						onError: this._private._gotEntity,						autoSubExpand: this._private._getAutoExpand()					}, {						type: 'getEntity',						dataSource: this,						mustPublish: true,						options: options,						userData: userData,						entityPos: 0					});				}			}			break;	}};WAF.DataSourceEm.mustResolveOnFirstLevel = function(){	return (this._private.sourceType == 'dataClass');};WAF.DataSourceEm.getClassTitle = function(){	if (this._private.dataClass == null) {		return "";	}	else {		return this._private.dataClass.getName();	}};WAF.DataSourceEm.getAttributeNames = function(){	var attlist = [];	var atts = this._private.dataClass.getAttributes();	if (atts != null) {		for (var i = 0, nb = atts.length; i < nb; i++) {			attlist.push(atts[i].name);		}	}	return attlist;};WAF.DataSourceEm.makeElement = function(source, entity){	var elem = {		_private: {}	};	var atts = source._private.atts;	for (var e in atts) {		var xatt = atts[e];		var kind = xatt.kind;		if (xatt.isFirstLevel && (kind == "storage" || kind == "calculated" || kind == "alias"))			elem[e] =  entity == null ? null : entity[e].getValue();	}	elem._private.dataClass = source._private.dataClass;	elem._private.currentEntity = entity;	elem.getAttributeValue = source.getAttributeValue;	return elem;}WAF.DataSourceEm.getElement = function(pos, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var successHandler = options.onSuccess;	var event = {		element: null,		position: pos,		dataSource: this	};	if (userData != null) {		event.data = userData;		event.userData = userData;	}	if ((this.getPosition() == pos) || (this._private.oneElementOnly)) {		if (successHandler != null) {			var elem = WAF.DataSourceEm.makeElement(this, this._private.currentEntity);			event.element = elem;			successHandler(event);		}	}	else {		var ok = false;		var entityCollection = this._private.entityCollection		if (entityCollection != null) {			if (pos >= 0 && pos < entityCollection.length) {				ok = true;				var gotEntityCollection = function(dataProviderEvent){					var source = dataProviderEvent.userData.dataSource;					var entity = dataProviderEvent.entity;					if (dataProviderEvent.error != null && dataProviderEvent.error.length > 0) {						event.error = dataProviderEvent.error;						if (options.onError != null) {							options.onError(event);						}					}					else {						var elem = WAF.DataSourceEm.makeElement(source, entity);						event.element = elem;						successHandler(event);					}				}				var delayinfo = null;				if (options.delayID != null)					delayinfo = this._private.delayInfos[options.delayID];				entityCollection.getEntity(pos, {					onSuccess: gotEntityCollection,					onError: gotEntityCollection,					delay: options.delay || null,					delayInfo: delayinfo				}, {					dataSource: this				});			}		}		if (!ok) {			if (successHandler != null) {				successHandler(event);			}		}	}};WAF.DataSourceEm.getAttributeValue = function(attributePath, options){	options = options || {};	var result = null;	var em = null;	var entity = null;	if (this._private != null) {		var em = this._private.dataClass;		var entity = this._private.currentEntity;	}	if (entity != null) {		var path = attributePath.split(".");		if (path.length == 1) {			result = this[attributePath];		}		else {			var nb = path.length;			for (var i = 0; i < nb; i++) {				var attName = path[i];				var att = em.getAttributeByName(attName);				if (att != null) {					var attEnt = entity[attName];					if (attEnt == null) {						result = null;						break;					}					else {						if (att.kind == 'relatedEntity') {							var subEm = WAF.ds.getDataClass(att.type);							if (subEm == null) {								result = null;								break;							}							else {								em = subEm;								result = attEnt.getValue();								if (result == null)									break;								entity = result;							}						}						else if (att.kind == 'relatedEntities' || att.kind == 'composition') {							result = null;							break;						}						else {							result = attEnt.getValue();						}					}				}			}		}	}	return result;}WAF.DataSourceEm.getOldAttributeValue = function(attributePath, options){	options = options || {};	var result = null;	var em = null;	var entity = null;	if (this._private != null) {		var em = this._private.dataClass;		var entity = this._private.currentEntity;	}	if (entity != null) {		var path = attributePath.split(".");		if (false && path.length == 1) {			result = this[attributePath];		}		else {			var nb = path.length;			for (var i = 0; i < nb; i++) {				var attName = path[i];				var att = em.getAttributeByName(attName);				if (att != null) {					var attEnt = entity[attName];					if (attEnt == null) {						result = null;						break;					}					else {						if (att.kind == 'relatedEntity') {							var subEm = WAF.ds.getDataClass(att.type);							if (subEm == null) {								result = null;								break;							}							else {								em = subEm;								result = attEnt.getOldValue();								if (result == null)									break;								entity = result;							}						}						else if (att.kind == 'relatedEntities' || att.kind == 'composition') {							result = null;							break;						}						else {							result = attEnt.getOldValue();						}					}				}			}		}	}	return result;}WAF.DataSourceEm.declareDependencies = function(dependencies, options){	options = options;	if (typeof(dependencies) != "string") {		for (var i = 0, nb = dependencies.length; i < nb; i++) {			this._private._addAttributeDependency(dependencies[i], options)		}	}	else {		this._private._addAttributeDependency(dependencies, options);	}}WAF.DataSourceEm.callMethod = function(options){	var source = this;	var result = null;	var sync = options.sync || false;	var okToCall = false;	var methodRef = null;	if (options.method != null)		methodRef = this._private.methods[options.method];	if (options.arguments == null) {		var myargs = [];		for (var i = 1, nb = arguments.length; i < nb; i++) // The first one is skipped.		{			myargs.push(arguments[i]);		}		options.arguments = myargs;	}	if (methodRef != null) {		if (methodRef.applyTo == "dataClass") {			var dataClass = source.getDataClass();			if (dataClass != null) {				okToCall = true;				result = dataClass.callMethod(options);			}		}		else if (methodRef.applyTo == "entityCollection") {			var entityCollection = source.getEntityCollection();			if (entityCollection != null) {				okToCall = true;				result = entityCollection.callMethod(options);			}		}		else if (methodRef.applyTo == "entity") {			var entity = source.getCurrentElement();			if (entity != null) {				okToCall = true;				result = entity.callMethod(options);			}		}	}	return result;}WAF.DataSourceEm.setDisplayLimits = function(ID, top, bottom){	//console.log("limit top = "+top+" , bottom = "+bottom);	var priv = this._private;	var delayinfo = priv.delayInfos[ID];	if (delayinfo == null) {		delayinfo = new WAF.DelayInfoForDataSource(ID, top, bottom);		priv.delayInfos[ID] = delayinfo;	}	else {		delayinfo.setLimits(top, bottom);	}}// ----------------------------------------------------------------------------------------------------------------------WAF.DataSourceVar = function(config){	WAF.DataSource.call(this, config);	this._private.sourceType = "array";	this._private.varName = "";	this._private.dataClass = null;	this._private.singleElem = false;	this._private.currentElem = null;	// private functions	this._private._updateValues = WAF.DataSourceVar._updateValues;	this._private._getFullSet = WAF.DataSourceVar._getFullSet;	this._private._setCurrentElementByPos = WAF.DataSourceVar._setCurrentElementByPos;	this._private._Init = WAF.DataSourceVar._Init;	// API functions of a DataSource	this.getCurrentElement = WAF.DataSourceVar.getCurrentElement;	this.getDataClass = WAF.DataSourceVar.getDataClass;	this.getClassAttributeByName = WAF.DataSourceVar.getClassAttributeByName;	this.autoDispatch = WAF.DataSourceVar.autoDispatch;	this.addNewElement = WAF.DataSourceVar.addNewElement;	this.save = WAF.DataSourceVar.save;	this.removeCurrent = WAF.DataSourceVar.removeCurrent;	this.orderBy = WAF.DataSourceVar.orderBy;	this.resolveSource = WAF.DataSourceVar.resolveSource;	this.mustResolveOnFirstLevel = WAF.DataSourceVar.mustResolveOnFirstLevel;	this.getClassTitle = WAF.DataSourceVar.getClassTitle;	this.getAttributeNames = WAF.DataSourceVar.getAttributeNames;	this.getElement = WAF.DataSourceVar.getElement;	this.getAttributeValue = WAF.DataSourceVar.getAttributeValue;	this.getOldAttributeValue = WAF.DataSourceVar.getOldAttributeValue;	this.sync = WAF.DataSourceVar.sync;	this._private._Init(config);};/* ************************ */// private functionsWAF.DataSourceVar._Init = function(config){	// specific code for DataSourceVar	var owner = this.owner;	this.varName = config.binding;	if (config.id == null || config.id == "") {		config.id = this.varName + "Source";	}	var sourceType = config['data-source-type'];	if (sourceType == null) {		sourceType = "array";	}	this.sourceType = sourceType;	var dataClass;	var attNameList = null;	if (sourceType == "scalar") {		var dataType = config["data-dataType"];		if (dataType == null) {			dataType = "string";		}		dataClass = {};		dataClass[this.varName] = {			name: this.varName,			type: dataType		}		this.dataClass = dataClass;		this.varName = "window";	}	else {		if (config.dataClass != null) {			this.dataClass = config.dataClass;		}		else {			var dataClassAtts = config['data-attributes'];			if (dataClassAtts != null) {				dataClass = {};				attNameList = [];				var attlist = dataClassAtts.split(",");				for (var i = 0; i < attlist.length; i++) {					var s = attlist[i];					var decomp = s.split(":");					if (decomp[0] != "") {						var type = "string";						if (decomp.length > 1) {							type = decomp[1];						}						var att = {							name: decomp[0],							type: type,							kind: "storage"						};						attNameList.push(decomp[0]);						dataClass[att.name] = att;					}				}				this.dataClass = dataClass;			}		}	}	var mustBuildList = attNameList == null;	dataClass = this.dataClass;	if (dataClass != null) {		if (mustBuildList) {			attNameList = [];		}		for (var i in dataClass) {			var dataClassAtt = dataClass[i];			if (dataClassAtt.kind == null) {				dataClassAtt.kind = "storage";			}			this.atts[dataClassAtt.name] = new WAF.DataSourceVarAttribute(dataClassAtt, owner);			if (mustBuildList) {				attNameList.push(dataClassAtt.name);			}		}	}	this.attNameList = attNameList;	this.selCanBeModified = this.sourceType == "array";	this.oneElementOnly = this.sourceType != "array";	if (!this.selCanBeModified) {		delete owner.addNewElement;	}	if (this.oneElementOnly) {		delete owner.addNewElement;		delete owner.selectNext;		delete owner.select;		delete owner.selectPrevious;		delete owner.removeCurrent;		delete owner.orderBy;	}	return true;}WAF.DataSourceVar._getFullSet = function(){	var res = null;	if (!this.oneElementOnly) {		res = window[this.varName];		if (res == null) {			res = [];			window[this.varName] = res;		}	}	return res;};WAF.DataSourceVar._updateValues = function(){	var curelem = this.owner.getCurrentElement();	for (var i in this.atts) {		var sourceAtt = this.atts[i];		if (sourceAtt.simple) {			if (curelem == null) {				this.owner[sourceAtt.name] = null;				sourceAtt.savedValue = null;			}			else {				this.owner[sourceAtt.name] = curelem[sourceAtt.name];				sourceAtt.savedValue = curelem[sourceAtt.name];			}		}	}};WAF.DataSourceVar._setCurrentElementByPos = function(pos, options, userData){	options = options || {};	userData = userData;	var onSuccess = options.onSuccess;	var onError = options.onError;	var dsEvent = {		dataSource: this.owner,		data: userData,		userData: userData	};	if ((this.owner.getPosition() == pos) || (this.oneElementOnly)) {		if (onSuccess != null) {			onSuccess(dsEvent);		}	}	else {		ok = false;		var arr = this._getFullSet();		if (arr != null) {			if (pos >= 0 && pos < arr.length) {				ok = true;				if (this.currentElem != null)					this.owner.dispatch('onBeforeCurrentElementChange', options);				this.currentElemPos = pos;				this.currentElem = arr[pos];				if (this.currentElem == null) {					this.currentElem = {};					arr[pos] = this.currentElem;				}				this._updateValues();				this.owner.dispatch('onCurrentElementChange', options);				if (onSuccess != null) {					onSuccess(dsEvent);				}			}		}		if (!ok) {			if (this.currentElem != null) {				this.owner.dispatch('onBeforeCurrentElementChange', options);			}			this.currentElem = null;			this.currentElemPos = 0;			this._updateValues();			this.owner.dispatch('onCurrentElementChange', options);		}	}};/* ************************ */// public API/* DESCRIBED ON DATASOURCE CLASS */WAF.DataSourceVar.getCurrentElement = function(){	return this._private.currentElem;};WAF.DataSourceVar.getDataClass = function(){	return this._private.dataClass;};WAF.DataSourceVar.getClassAttributeByName = function(attName){	var result = this._private.dataClass[attName];	return result;};/* DESCRIBED ON DATASOURCE CLASS */WAF.DataSourceVar.autoDispatch = function(options){	options = options;	var curElem = this.getCurrentElement();	if (curElem != null) {		for (varname in this._private.atts) {			var sourceAtt = this._private.atts[varname];			var curValue = curElem == null ? null : curElem[sourceAtt.name];			if (sourceAtt.savedValue !== curValue) {				sourceAtt.savedValue = curValue;				sourceAtt.dispatch(options);				//this.changedCurrentEntityAttribute(sourceAtt.name, subscriberID);			}		}	}};WAF.DataSourceVar.addNewElement = function(options){	options = options;	if (this._private.selCanBeModified) {		var curObj = this.getCurrentElement();		if (curObj != null) {			this.dispatch('onBeforeCurrentElementChange', options);		}		this._private._updateValues();		this._private.currentElem = {};		var arr = this._private._getFullSet();		arr.push(this._private.currentElem);		this.length = arr.length;		this._private.isNewElem = true;		this._private.currentElemPos = arr.length - 1;		this._private._updateValues();		this.dispatch('onCollectionChange', options);		//this.dispatch('onCurrentElementChange', options);	}};WAF.DataSourceVar.save = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	this.autoDispatch({		stopDispatch: true	});	var dsEvent = {		dataSource: this,		data: userData,		userData: userData	};	var onSuccess = options.onSuccess;	if (onSuccess != null)		onSuccess(dsEvent);	/*	 var entity = this.getCurrentElement();	 if (entity != null)	 {	 if (onSuccess != null)	 {	 onSuccess(dsEvent);	 }	 }	 else	 {	 if (onSuccess != null)	 onSuccess(dsEvent);	 }	 */};WAF.DataSourceVar.removeCurrent = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	var curObj = this.getCurrentElement();	if ((curObj != null) && !this._private.oneElementOnly) {		var pos = this.getPosition();		var arr = this._private._getFullSet();		if (arr != null) {			if (pos >= 0 && pos < arr.length) {				arr.splice(pos, 1);				this._private.currentElem = null;				this._private.currentElemPos = -1;				var dsEvent = {					dataSource: this,					data: userData,					userData: userData				};				var stop = false;				if (options.onSuccess != null)					stop = options.onSuccess(dsEvent);				if (!stop) {					if (pos >= arr.length)						pos = arr.length - 1;					this.length = arr.length;					this.select(pos);				}			}		}	}};WAF.DataSourceVar.orderBy = function(orderByString, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var dataSource = this;	var priv = this._private;	var arr = priv._getFullSet();	if (arr != null) {		var atts = orderByString.split(",");		var attributes = [];		atts.forEach(function(item){			var ascending = true;			var subatts = item.split(" ");			if (subatts.length > 1) {				ascending = subatts[1].toLowerCase() != "desc";			}			attributes.push({				name: subatts[0],				ascending: ascending			});		});		arr.sort(function(e1, e2){			var result = 0;			for (var i = 0; i < attributes.length && result == 0; ++i) {				att = attributes[i];				var v1 = e1[att.name];				var v2 = e2[att.name];				if (v1 != v2) {					if (att.ascending) {						if (v1 < v2)							result = -1;						else							result = 1;					}					else {						if (v1 < v2)							result = 1;						else							result = -1;					}				}			}			return result;		});		priv.currentElem = null;		priv.currentElemPos = -1;		dataSource.length = arr.length;		dataSource.dispatch('onCollectionChange', options);		if (arr.length > 0) {			dataSource.select(0);		}		var dsEvent = {			dataSource: this,			data: userData,			userData: userData		};		if (options.onSuccess != null)			options.onSuccess(dsEvent);	}	var sel = this.getSelection();	if (sel != null && options.keepSelection === undefined)		options.keepSelection = sel.prepareToSend();	var entityCollection = this._private.entityCollection;	if (entityCollection != null) {		var xoptions = {			onSuccess: this._private._gotEntityCollection,			onError: this._private._gotEntityCollection,			persistOnServer: true,			pageSize: 40,			//keepOldCollectionOnError: true,			autoExpand: this._private._getAutoExpand()		};		xoptions = this._private._mixOptions(options, xoptions);		var datas = {			type: 'getEntityCollection',			dataSource: this,			mustPublish: true,			options: options,			userData: userData		};		entityCollection.orderBy(orderByString, xoptions, datas);	}};WAF.DataSourceVar.resolveSource = function(options, userData){	var resOp = WAF.tools.handleArgs(arguments, 0);	userData = resOp.userData;	options = resOp.options;	switch (this._private.sourceType) {		case 'scalar':		case 'object':			this.length = 1;			this._private.currentElem = window[this._private.varName];			this._private.currentElemPos = 0;			this.dispatch('onCurrentElementChange', options);			this._private._updateValues();			break;		case 'array':			var arr = this._private._getFullSet();			this._private.currentElem = null;			this._private.currentElemPos = -1;			if (arr != null) {				this.length = arr.length;				this.dispatch('onCollectionChange', options);				if (arr.length > 0) {					this.select(0);				}			}			break;	}};WAF.DataSourceVar.mustResolveOnFirstLevel = function(){	return true;};WAF.DataSourceVar.getClassTitle = function(){	return this._private.varName;};WAF.DataSourceVar.getAttributeNames = function(){	return this._private.attNameList;};WAF.DataSourceVar.getElement = function(pos, options, userData){	var resOp = WAF.tools.handleArgs(arguments, 1);	userData = resOp.userData;	options = resOp.options;	var successHandler = options.onSuccess;	var event = {		element: null,		position: pos	};	if (userData != null) {		event.data = userData;		event.userData = userData;	}	if ((this.getPosition() == pos) || (this._private.oneElementOnly)) {		if (successHandler != null) {			var elem = {};			var atts = this._private.atts;			for (var e in atts) {				elem[e] = this[e];			}			elem._private = {};			elem._private.currentElem = elem;			elem.getAttributeValue = this.getAttributeValue;			event.element = elem;			successHandler(event);		}	}	else {		ok = false;		var arr = this._private._getFullSet();		if (arr != null) {			if (pos >= 0 && pos < arr.length) {				ok = true;				var posElem = arr[pos];				if (posElem != null) {					var elem = {};					var atts = this._private.atts;					for (var e in atts) {						elem[e] = posElem[e];					}					elem.getAttributeValue = this.getAttributeValue;					elem._private = {};					elem._private.currentElem = elem;					event.element = elem;				}				successHandler(event);			}		}		if (!ok) {			if (successHandler != null) {				successHandler(event);			}		}	}};WAF.DataSourceVar.getOldAttributeValue = function(attributePath, options){	return this.getAttributeValue(attributePath, options || null);}WAF.DataSourceVar.getAttributeValue = function(attributePath, options){	options = options || {};	var result = null;	var elem = null;	if (this._private != null) {		var elem = this._private.currentElem;	}	if (elem != null) {		var path = attributePath.split(".");		var nb = path.length;		for (var i = 0; i < nb; i++) {			var attName = path[i];			var subelem = elem[attName];			if (subelem == null)				break;			else {				result = subelem;				elem = subelem;			}		}	}	return result;}WAF.DataSourceVar.sync = function(options){	options = options;	if (this._private.oneElementOnly) {		this.length = 1;		this._private.currentElem = window[this._private.varName];		this._private.currentElemPos = 0;		this.dispatch('onCurrentElementChange', options);		this._private._updateValues();	}	else {		var curpos = this._private.currentElemPos;		var arr = this._private._getFullSet();		if (arr != null) {			this.length = arr.length;			if (curpos < 0) {				curpos = 0;			}			if (curpos >= arr.length) {				curpos = arr.length - 1;			}			this._private.currentElemPos = curpos;			this._private.currentElem = arr[curpos];			if (this._private.currentElem == null) {				this._private.currentElem = {};				arr[curpos] = this._private.currentElem;			}			this._private._updateValues();			this.dispatch('onCollectionChange', options);			//this.dispatch('onCurrentElementChange', options);		}	}};// ----------------------------------------------------------------------------------------------------------WAF.dataSource = {	list: {},	create: function(params){		var dataSourceType = params['data-source-type'];		// old code to remove		var binding = params.binding;		if (binding != null && binding.indexOf('#') == 0) {			dataSourceType = "scalar";			params['data-source-type'] = dataSourceType;			binding = binding.substring(1);			params.binding = binding;		}		// end of old code		if (dataSourceType == "scalar" || dataSourceType == "object" || dataSourceType == "array") {			WAF.source[params.id] = new WAF.DataSourceVar(params);		}		else {			WAF.source[params.id] = new WAF.DataSourceEm(params);		}		WAF.dataSource.list[params.id] = WAF.source[params.id];		return WAF.source[params.id];	},	destroy: function(source){		var id = source._private.id;		// SHOULD WE DELETE EVENT HANDLERS ?		delete WAF.source[id];		delete WAF.dataSource.list[id];	},	solveBinding: function(binding){		var sourceName;		var attName = "";		var dataSource = null;		var sourceAtt = null;		var dataClassAtt = null;		var decomp = binding.split(".");		if (decomp.length == 2) {			sourceName = decomp[0];			attName = decomp[1];			dataSource = WAF.source[sourceName];		}		else if (decomp.length > 2) {			sourceName = decomp[0];			attName = decomp.slice(1).join(".");			dataSource = WAF.source[sourceName];		}		else {			sourceName = binding;			dataSource = WAF.source[sourceName];		}		if (dataSource != null) {			if (attName == "") {				for (var e in dataSource._private.atts) {					sourceAtt = dataSource._private.atts[e];					attName = sourceAtt.name;					break; // on prend le premier				}			}			else {				//sourceAtt = dataSource._private.atts[attName];				sourceAtt = dataSource.getAttribute(attName);			}			if (sourceAtt != null) {				dataClassAtt = dataSource.getClassAttributeByName(attName);			}		}		return {			dataSource: dataSource,			sourceName: sourceName,			sourceAtt: sourceAtt,			attName: attName,			dataClassAtt: dataClassAtt		}	},	fullyInitAllSources: function(){		var cont = true;		while (cont) {			cont = false;			var list = this.list;			for (var e in list) {				var source = list[e];				if (source._private.needForInit != null) {					if (source._private._Init(source._private.needForInit)) {						cont = true;					}				}			}		}	}}/* (function() { var interfaceItem; for (interfaceItem in WAF.datasource) { WAF.DataSource[interfaceItem] = WAF.datasource[interfaceItem]; } }()); *//*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/DataSource/Selection.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/// ================== <Selection>// All numbers are supposed to be >= 0WAF.Selection = function WafSelection(inMode, singleRow){	var		_mode		= 'multiple', // 'single', 'none'			_rows		= [], // array of number of selected rows			_ranges		= [], // array of {start: nn, ens: nn}			_butRows	= [], // array of numbers of excluded rows			// Quick accessors			_isModeMultiple	= true,			_isModeSingle	= false,			_isModeNone		= false;	// ========================== <private>	// Utility, internal. Returns true if inNum is in the range *and* not in _butRows	function _isInRanges(inNum)	{		var el;		if(arguments.length > 0)		{			for(var i = 0, max = _ranges.length; i < max; ++i)			{				el = _ranges[i];				if( inNum >= el.start && inNum <= el.end )				{					return _butRows.indexOf(inNum) < 0;				}			}		}		return false;	}	function _realignParam(inP, inValue)	{		if(typeof inP === 'undefined' || inP === null)		{			return inValue;		}		return inP;	}	function _removeNullsFromArray(inArray)	{		var idx = -1;		if(inArray.length > 0)		{			do {				idx = inArray.indexOf(null);				if(idx > -1) {					inArray.splice(idx, 1);				}			} while(idx > -1);		}	}	function _cleanupArrays()	{		var idx = -1, temp, el, elNext, newStart, newEnd, ok, max, val;		_removeNullsFromArray(_butRows);		_removeNullsFromArray(_rows);		max = _ranges.length;		if(max > 1)		{			_ranges.sort( function(a, b) {				return a.start - b.start;			});			temp = [];			idx = 0;			do {				if(idx < max) {					el = _ranges[idx];				}				newStart = el.start;				newEnd = el.end;				ok = true;				do {					++idx;					if(idx < max) {						elNext = _ranges[idx];					} else {						elNext = null;					}					if(elNext !== null && elNext.start <= newEnd) {						newEnd = newEnd > elNext.end ? newEnd : elNext.end;					} else {						ok = false;						--idx;					}				} while(ok && idx < max && elNext !== null);				temp.push({start: newStart, end: newEnd} );				++idx;			} while(idx < max);			_ranges = temp;		}		// Remove rows that are already in the ranges		if( _ranges.length > 0)		{			for(var i = 0, max = _rows.length; i < max; ++i)			{				val = _rows[i];				for(var j = 0, maxR = _ranges.length; j < maxR; ++j)				{					el = _ranges[ j ];					if( val >= el.start && val <= el.end )					{						_rows[i] = null;					}				}			}			_removeNullsFromArray(_rows);		}	}	function _clearArrays()	{		_rows = [];	 	_ranges = [];	 	_butRows = [];	}	// ========================== </private>	// =====================================	 this.prepareToSend = function()	 {	 	_cleanupArrays();	 	var result = {			_mode: _isModeSingle ? "single" : "multiple",			_rows: _rows,			_ranges: _ranges,			_butRows:_butRows		};		return result;	 }	// =====================================	 this.getMode = function()	 {	 	return _mode;	 }	 this.isModeMultiple = function()	 {	 	return _isModeMultiple;	 }	 this.isModeSingle = function()	 {	 	return _isModeSingle;	 }	 this.isModeNone = function()	 {	 	return _isModeNone;	 }	// =====================================	 this.reset = function(inMode)	 {	 	if(typeof inMode !== 'string') {	 		inMode = _mode;	 	}	 	_isModeMultiple = false;	 	_isModeSingle = false;	 	_isModeNone = false;	 	switch(inMode)	 	{	 	case 'single':	 		_isModeSingle = true;	 		_mode = inMode;	 		break;	 	case 'none':	 		_isModeNone = false;	 		_mode = inMode;	 		break;	 	default:	 		_isModeMultiple = true;	 		_mode = 'multiple';	 		break;	 	}	 	_clearArrays();	 	return this;	 }	// =====================================	 this.isSelected = function(inNum)	 {	 	if(!_isModeNone && arguments.length > 0)	 	{			if(_isModeSingle)			{				if(_rows.length > 0) {					return _rows[0] === inNum;				}			}			else			{				if(_rows.indexOf(inNum) > -1) {					return _butRows.indexOf(inNum) < 0;				}				return _isInRanges(inNum);			}		}	 	return false;	 }	// =====================================	 this.select = function(inNum, inAddToSel)	 {	 	var idx;	 	if(!_isModeNone && arguments.length > 0 && inNum >= 0)	 	{			if(_isModeSingle)			{				_rows[0] = inNum;			}			else if(!inAddToSel) // falsy			{				_clearArrays();				_rows[0] = inNum;			}			else			{				idx = _butRows.indexOf(inNum);				if(idx > -1)				{					_butRows[idx] = null;				}				if(!_isInRanges(inNum) && _rows.indexOf(inNum) < 0)				{					_rows.push(inNum);				}			}	 	}	 	return this;	 }	// =====================================	this.selectRange = function(inFirst, inLast, inAddToSel)	{		var count, butCount, idx, val;		if(!_isModeNone)		{			if(!inAddToSel) {				_clearArrays();			}			if(inFirst >= 0 && inLast >= 0)			{				if(inFirst > inLast)				{					val = inFirst;					inLast = inFirst;					inLast = val;				}				if(_isModeSingle)				{					_rows[0] = inFirst;				}				else				{					count = inLast - inFirst + 1;					butCount = _butRows.length;					_ranges.push( {start: inFirst, end: inLast} );					if(count < butCount)					{						for(var i = inFirst; i <= inLast; ++i)						{							idx = _butRows.indexOf(i);							if(idx > -1) {								_butRows[i] = null;							}						}					}					else					{						for(var i = 0; i < butCount; ++i)						{							val = _butRows[i];							if(val >= inFirst && val <= inLast) {								_butRows[i] = null;							}						}					}				}			}		}		return this;	}	// =====================================	 this.toggle = function(inNum)	 {	 	var idxBut = -1, idxRow = -1, doSel;	 	if(!_isModeNone && arguments.length > 0 && inNum >= 0)	 	{	 		if(_isModeSingle)			{				if(_rows.length > 0) {					_rows = [];				} else {					_rows[0] = inNum;				}			}			else			{				idxRow = _rows.indexOf(inNum);				idxBut = _butRows.indexOf(inNum);				if(idxBut > -1)				{					_butRows[idxBut] = null;					if(idxRow < 0) {						_rows.push(inNum);					}				}				else				{					doSel = true;					if(idxRow > -1) {						_rows[idxRow] = null;						doSel = false;					}					if( _isInRanges(inNum) ) {						_butRows.push(inNum);						doSel = false;					}					if(doSel) {						_rows.push(inNum);					}				}			}	 	}	 	return this;	 }	// =====================================	this.countSelected = function()	{		var count = 0, el;		if(_isModeNone)		{		}		else if(_isModeSingle)		{			if(_rows.length > 0) {				count = 1;			}		}		else		{			_cleanupArrays();			count = _rows.length;			for(var i = 0, max = _ranges.length; i < max; ++i)			{				el = _ranges[i];				count += el.end - el.start + 1;			}			count -= _butRows.length;		}		return count;	}	// =====================================	this.getSelectedRows = function()	{		var result = [], el, idx, curIdx;		if(_isModeNone)		{		}		else if(_isModeSingle)		{			if(_rows.length > 0) {				result[0] = _rows[0];			}		}		else		{			_cleanupArrays();			idx = 0;			for(var i = 0, max = _rows.length; i < max; ++i)			{				result[idx++] = _rows[i]; // faster than result.push(i)			}			for(var i = 0, maxRanges = _ranges.length; i < maxRanges; ++i)			{				el = _ranges[i];				for(var j = el.start, max = el.end; j <= max; ++j)				{					result[idx++] = j;				}			}			for(var i = 0, max = _butRows.length; i < max; ++i)			{				curIdx = result.indexOf(_butRows[i]);				if(curIdx > -1) {					result[curIdx] = null;				}			}			_removeNullsFromArray(result);		}		return result;	}	// =====================================	this.setSelectedRows = function(rowNumbers)	{		_clearArrays();		var result = -1, el, idx, curIdx;		if(_isModeNone)		{		}		else if(_isModeSingle)		{			if(rowNumbers.length > 0) {				result = rowNumbers[0];				_rows.push(result);			}		}		else		{			rowNumbers.sort(function(e1,e2)			{				if (e1 == e2)					return 0;				else if (e1 < e2)					return -1;				else return 1;			});			var startRange = null;			var previousNum = null;			function loopThrough(rownum)			{				if (startRange == null)				{					startRange = rownum;				}				else				{					if ((previousNum+1) !== rownum)					{						var endRange = previousNum;						if (endRange === startRange)						{							_rows.push(startRange);						}						else						{							_ranges.push({start: startRange, end: endRange});						}						startRange = rownum;					}					else					{						// nothing to do					}				}				previousNum = rownum;			}			if (rowNumbers.length > 0) {				result = rowNumbers[0];			}			rowNumbers.forEach(loopThrough);			loopThrough(null);		}		return result;	}	// =====================================	this.getFirst = function()	{		var firstsingle = -1;		var firstrange = -1;		if (_rows.length > 0)			firstsingle = _rows[0];		if (_ranges.length > 0)			firstrange = _ranges[0].start;		if (firstsingle == -1)			if (firstrange == -1)				return 0;			else				return firstrange;		else		{			if (firstrange == -1)				return firstsingle;			else			{				if (firstsingle > firstrange)					return firstrange;				else					return firstsingle;			}		}	}	this.getNext = function()	{	}	// =====================================	this.buildFromObject = function(obj)	{		this.reset(obj.mode)		if (obj.rows != null)			_rows = obj.rows;		if (obj.butRows != null)			_butRows = obj.butRows;		if (obj.ranges != null)			_ranges = obj.ranges;	}	// =====================================	this.toString = function()	{		return this.getSelectedRows().join();	}	// =====================================	// =====================================	// First init	if (typeof inMode == "object" && inMode.mode != null )		this.buildFromObject(inMode);	else		this.reset(inMode);	if (singleRow != null)		_rows.push(singleRow);}// ================== </Selection>/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/DataSource/ErrorHandling.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.ErrorManager = {	defaultErrorDiv: null,	dialogAlreadyOpened: false};WAF.ErrorManager.displayError = function(event, div){	function handleOneError(err)	{		if (err.message != null)		{			html += '<tr class="waf-error-div-table-row">';			html += '<td class="waf-error-div-table-message">';			html += err.message;			html += '</td>';			html += '<td class="waf-error-div-table-errnum">';			if (err.errCode != null)				html += err.errCode;			html += '</td>';			html += '<td class="waf-error-div-table-component">';			if (err.componentSignature != null)				html += err.componentSignature;			html += '</td>';			html += '</tr>';		}	}	var isInDialog = false;	var html = "";	if (div == null)	{		div = this.getDefaultErrorDiv();		isInDialog = true;	}	var error = event.error;	if (error == null)	{		div.html("");		if (isInDialog)		{			div.dialog("close");		}	}	else	{		div.addClass("waf-error-div");		div.addClass("waf-widget");		html += '<div class="waf-error-div-body waf-widget-body">';		if (event.message != null)		{			html += '<div class="waf-error-div-message-outside">';			html += '<div class="waf-error-div-message-inside">';			html += event.message;			html += '</div>';			html += '</div>';		}		html += '<table class="waf-error-div-table">';		html += '<tbody class="waf-error-div-table-body">';		if (error.length == null)			error = [error];		error.forEach(handleOneError);		html += '</tbody>';		html += '</table>';		html += '</div>';		div.html(html);		if (isInDialog)		{			if (!this.dialogAlreadyOpened)			{				this.dialogAlreadyOpened = true;				div.dialog();				var dataTheme = $("body").data("theme");				if (dataTheme != null)				{					div.dialog("widget").addClass(dataTheme);					div.addClass(dataTheme);				}			}			else				div.dialog("open");		}	}}WAF.ErrorManager.getDefaultErrorDiv = function(){	if (this.defaultErrorDiv == null)	{		this.defaultErrorDiv = $('<div class="waf-error-div waf-widget"></div>').appendTo($('body'));		//this.defaultErrorDiv.dialog("option", "autoOpen", false);	}	return this.defaultErrorDiv;}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/rpc/Rpc.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * @module Rpc *///// "use strict";if (typeof WAF === 'undefined') {    var WAF = {};}if (typeof WAF.classes === 'undefined') {    WAF.classes = {};}if (typeof WAF.config === 'undefined') {    WAF.config = {};}WAF._private = WAF._private || {};WAF._private.globals = WAF._private.globals || {};WAF._private.globals.root = this;/** * The Rpc class * * @class WAF.classes.Rpc * * @constructor * @param {Object} config parameters */WAF.classes.Rpc = function (config) {    config = config || {};    if (typeof config !== 'object') {        config = {};    }    // {String} url url to call the services    config.urlservice = config.urlservice || '/rpc/';    // {String} messagetype type of the message (json, xml, ...)    // ! only json for now    config.messagetype = config.messagetype || 'json';    // {Object} catalog service description    config.catalog = config.catalog || null;    // {Boolean} iscrossdomains enable cross domains calls    // ! not yet implemented    if (config.iscrossdomains === undefined) {        config.iscrossdomains = true;    }    // {Array} list of all methods to add    config.methods   = config.methods   || [];    // {String} namespace to create    config.namespace = config.namespace || '';    // {Booean} messageValidation is the parameters type/number checked    if (typeof config.messageValidation === 'undefined') {        config.messageValidation = false;    }    /**     * Add client check on message on the service     * (use of service description)     *     * @property messageValidation     * @type Boolean     * @default true     */    this.messageValidation = config.messageValidation;    /**     * List of the RPC methods     *     * @property serviceName     * @type Array     * @default ['getCalalog']     */    this.serviceName = ['getCalalog'];    /**     * RPC service description of the methods     *     * @property serviceDescription     * @type Object     */    this.serviceDescription = {        'getCatalog': {            'description' : 'Get the list of the methods',            'type'        : 'method',            'returns'     : 'string',            'params'      : [{                'type'        : 'object',                'name'        : '*',                'description' : 'Parameter'            }]        }    };    /**     * Get the catalog of the function     *     * @method getCatalog     * @param {Object} params parameters     * @return {Object}     */    this.getCatalog = function (params) {        var        serviceDescription = {},        parameters = [],        functionName = '',        i = 0,        isInList = false,        serviceLength = 0;        params = params || {};        if (typeof params === 'string') {            parameters.push(params);            params = parameters;        }        serviceDescription = this.call({            'name'     : 'getCatalog',            'arguments': [params]        });        try {            serviceDescription = JSON.parse(serviceDescription);        } catch (e) {            throw WAF.rpc.ErrorFactory.createError({                code    : '-32603',                message : e.description || e.message            });        }        if (typeof serviceDescription === 'object') {            // add the methods in the list            for (functionName in serviceDescription)  {                if (typeof(serviceDescription[functionName]) !== 'string') {                    isInList = false;                    serviceLength = this.serviceName.length;                    for (i = 0; i < serviceLength; i += 1) {                        if (this.serviceName[i] === functionName) {                            isInList = true;                            break;                        }                    }                    if (!isInList) {                        this.serviceName.push(functionName);                        this.serviceDescription[functionName] = serviceDescription[functionName];                    }                }            }        }        else {            serviceDescription = {};        }        return serviceDescription;    };    /**     * Set the catalog of the function     *     * @method setCatalog     * @param {Object} serviceDescription description of the service     */    this.setCatalog = function (serviceDescription) {        var        functionName = '',        i = 0,        isInList = false,        serviceLength = 0;        if (typeof serviceDescription === 'object') {            // add the methods in the list            for (functionName in serviceDescription)  {                if (typeof(serviceDescription[functionName]) !== 'string') {                    isInList = false;                    serviceLength = this.serviceName.length;                    for (i = 0; i < serviceLength; i += 1) {                        if (this.serviceName[i] === functionName) {                            isInList = true;                            break;                        }                    }                    if (!isInList) {                        this.serviceName.push(functionName);                        this.serviceDescription[functionName] = serviceDescription[functionName];                    }                }            }        } else {            serviceDescription = {};        }    };    /**     * Create the interface     *     *     * @method getInterfaces     * @param {proxyConfig} params parameters     * @return {WAF.classes.Proxy}     */    this.getInterfaces = function (params) {        var        proxy = {},        proxyConfig = {},        methods = [],        i = 0,        namespace = '';        // params        params = params || {};        params.conf      = params.conf      || null;        params.methods   = params.methods   || config.methods;        params.namespace = params.namespace || config.namespace;        // clean parameter        for (i = 0; i < methods.length; i++) {            methods[i] = methods[i].replace(/^\s+|\s+$/g, '');        }        // set the config for the proxy        proxyConfig.urlservice        = config.urlservice;        proxyConfig.messagetype       = config.messagetype;        proxyConfig.messagevalidation = this.messageValidation;        if (params.conf) {            for (namespace in params.conf)  {                if (params.conf.hasOwnProperty(namespace)) {                    proxyConfig.namespace   = namespace;                    proxyConfig.methods     = params.conf[namespace];                    proxyConfig.description = this.getCatalog(params.conf[namespace]);                    proxy = WAF.rpc.ProxyFactory.createProxy(proxyConfig);                }            }        } else {            proxyConfig.namespace   = params.namespace;            proxyConfig.methods     = params.methods;            proxyConfig.description = this.getCatalog(proxyConfig.methods);            proxy = WAF.rpc.ProxyFactory.createProxy(proxyConfig);        }        return proxy;    };    /**     * Call to a rpc function     *     *     * @method call     * @throws {RpcError}     * @param {Object} params parameters     * @return {Object} result     */    this.call = function (params) {        var        request = {},        message = {},        i = 0,        result = null,        serviceDescription = {},        argumentsLength = arguments.length,        wrpc = WAF.rpc;        params = params || {};        if (typeof params === 'string') {            if (argumentsLength > 0) {                params.name = arguments[0];                params.arguments = [];                for (i = 1; i < argumentsLength; i += 1) {                    params.arguments.push(arguments[i]);                }            }        }        // {String} name name of the function        params.name  = params.name || '';        // {Array} parameters parameters of the function        params.parameters  = params.parameters || [];        // {Array} arguments arguments of the function        params.arguments  = params.arguments || [];        if (this.messageValidation) {            // check method name            if ((!this.serviceDescription[params.name]) && (params.name !== 'getCatalog')) {                this.getCatalog(params.name);                if (!this.serviceDescription[params.name]) {                    throw wrpc.ErrorFactory.createError({                        code    : '-32601',                        message : 'method ' + params.name + ' not found'                    });                }            }            serviceDescription = this.serviceDescription[params.name];            // check parameters            if (params.arguments.length !== serviceDescription.params.length) {                throw wrpc.ErrorFactory.createError({                    code    : '-32603',                    message : 'wrong number of parameters (' + params.arguments.length + ' instead of ' + serviceDescription.params.length + ')'                });            }            for (i = 0; i < argumentsLength; i += 1) {                if (serviceDescription.params[i].type !== undefined && (typeof params.arguments[i]) !== serviceDescription.params[i].type) {                    throw wrpc.ErrorFactory.createError({                        code    : '-32603',                        message : 'wrong type for parameter ' + params.arguments[i] + ' (' + (typeof params.arguments[i]) + ' instead of ' + serviceDescription.params[i].type + ')'                    });                }            }        }        request = wrpc.RequestFactory.createRequest({            url         : config.urlservice,            isasync     : false,            messagetype : config.messagetype        });        request.init();        message = wrpc.MessageFactory.createMessage({            name        : params.name,            arguments   : params.arguments,            messagetype : config.messagetype        });        message = JSON.stringify(message);        result =  request.send({            message : message        });        if (result !== undefined) {            if (result !== null && result.error !== undefined) {                if (result.error.data) {                    throw wrpc.ErrorFactory.createError({                        code    : result.error.code,                        message : result.error.message,                        data    : result.error.data                    });                } else {                    throw wrpc.ErrorFactory.createError({                        code    : result.error.code,                        message : result.error.message                    });                }            } else {                if (this.messageValidation) {                    if ((typeof result !== serviceDescription.returns) && (typeof serviceDescription.returns !== 'undefined') && (serviceDescription.length !== 0)) {                        throw wrpc.ErrorFactory.createError({                            code    : '-32602',                            message : 'invalid return type (' + typeof result + ' instead of ' + serviceDescription.returns + ')'                        });                    } else {                        return result;                    }                }                else {                    return result;                }            }        } else {            return true;        }    };    /**     * Asynchronous Call to a rpc function     *     *     * @method callAsync     * @param {Object} params Required. parameters     * @return {WAF.classes.Rpc.request|WAF.classes.Rpc} handler to the request     */    this.callAsync = function (params) {        var request = {},        message = "",        serviceDescription = {},        i = 0,        handler = null,        argumentsLength = arguments.length,        wrpc = WAF.rpc;        params  = params || {};        if (typeof params === 'function') {            if (argumentsLength > 1) {                params.onsuccess = arguments[0];                params.name = '';                if (typeof arguments[1] === 'string') {                    params.name = arguments[1];                }                params.arguments = [];                for (i = 2; i < argumentsLength; i += 1) {                    params.arguments.push(arguments[i]);                }            }        }        // {String} name name of the function        params.name  = params.name || '';        // {Array} arguments arguments of the function        params.arguments  = params.arguments || [];        // {Function} onsuccess function to call when a result come (optional, only for async mode)        params.onsuccess  = params.onsuccess || null;        // {Function} onerror function to call when a result come (optional, only for async mode)        params.onerror  = params.onerror || null;        // allow onError/onerror & onSuccess/onsuccess        if (typeof params.onSuccess !== 'undefined') {            params.onsuccess = params.onSuccess;        }        if (typeof params.onError !== 'undefined') {            params.onerror = params.onError;        }        if (this.messageValidation) {            // check method name            if ((!this.serviceDescription[params.name]) && (params.name !== 'getCatalog')) {                this.getCatalog(params.name);                if (!this.serviceDescription[params.name]) {                    throw wrpc.ErrorFactory.createError({                        code    : '-32601',                        message : 'method ' + params.name + ' not found'                    });                }            }            serviceDescription = this.serviceDescription[params.name];            // check parameters            if (params.arguments.length !== serviceDescription.params.length) {                throw wrpc.ErrorFactory.createError({                    code    : '-32603',                    message : 'wrong number of parameters (' + params.arguments.length + ' instead of ' + serviceDescription.params.length + ')'                });            }            argumentsLength = params.arguments.length;            for (i = 0; i < argumentsLength; i += 1) {                if (serviceDescription.params[i].type !== undefined && typeof(params.arguments[i]) !== serviceDescription.params[i].type) {                    throw wrpc.ErrorFactory.createError({                        code    : '-32603',                        message : 'wrong type for parameter ' + params.arguments[i] + ' (' + typeof(params.arguments[i]) + ' instead of ' + serviceDescription.params[i].type + ')'                    });                }            }        }        request = wrpc.RequestFactory.createRequest({            url         : config.urlservice,            messagetype : config.messagetype        });        request.init();        message = wrpc.MessageFactory.createMessage({            name        : params.name,            arguments   : params.arguments,            messagetype : config.messagetype        });        message = JSON.stringify(message);        if (this.messageValidation) {            handler = request.send({                message    : message,                onsuccess  : params.onsuccess,                onerror    : params.onerror,                returntype : serviceDescription.returns            });        } else {            handler = request.send({                message    : message,                onsuccess  : params.onsuccess,                onerror    : params.onerror            });        }        return handler;    };    if (config.catalog) {        this.setCatalog(config.catalog);        this.messageValidation = false;    }    if (config.namespace || config.methods.length > 0) {        this.getInterfaces();    }    return this;};WAF.classes.Rpc.request = {    /**     * RPC Request Interface     *     *     * @class WAF.classes.Rpc.request.Request     *     * @constructor     */    Request : function () {        /**         * Initialisation of the request         *         * @method init         */        this.init = function () {};        /**         * Send the message         *         * @method send         */        this.send = function () {};        /**         * Abort the request         *         * @method abort         */        this.abort = function () {};    },    /**     * HTTP Request     *     *     * @class WAF.classes.Rpc.request.HttpRequest     * @extends WAF.classes.Rpc.request.Request     *     * @constructor     * @param {Object} [config] parameters     */    HttpRequest : function (config) {        // Handler to the correct XmlHttpRequest object        var        xmlHttpRequest = {},        acceptType = '',        contentType = '';        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} url url to call        config.url = config.url || '';        // {Boolean} isasync true if asynchronous mode        if (config.isasync === undefined) {            config.isasync = true;        }        // {Boolean} ispost true if POST mode        if (config.ispost === undefined) {            config.ispost = true;        }        // {Boolean} ispost true if POST mode        config.messagetype = config.messagetype || 'text';        /**         * Initialisation of the request         *         * @method init         */        this.init = function () {            var            httpRequest = {};            if (WAF._private.globals.root.XMLHttpRequest) {                httpRequest = new XMLHttpRequest();                if (httpRequest.overrideMimeType) {                    httpRequest.overrideMimeType('text/javascript');                }            } else if (WAF._private.globals.root.ActiveXObject) {                try {                    httpRequest = new ActiveXObject('Msxml2.XMLHTTP');                } catch (e1) {                    try {                        httpRequest = new ActiveXObject('Microsoft.XMLHTTP');                    } catch (e2) {                    }                }            }            xmlHttpRequest = httpRequest;            switch (config.messagetype) {                case 'json':                    contentType = 'application/json-rpc; charset=utf-8';                    acceptType = 'application/json-rpc';                    break;                case 'xml':                    contentType = 'application/xml; charset=utf-8';                    acceptType = 'application/xml';                    break;                default:                    contentType = 'text/plain; charset=utf-8';                    acceptType = 'text/plain';                    break;            }        };        /**         * Send the data         *         * @method send         * @throws {WAF.Rpc.InvalidParamsError|WAF.Rpc.InternalError|WAF.Rpc.ServerError}         * @param {Object} params parameters         * @return {Object|Undefined} the result if in a synchonous mode         */        this.send = function (params) {            var            oResponse = {},            method = 'POST',            xhr = xmlHttpRequest;            params = params || {};            if (typeof params !== 'object') {                params = {};            }            // {String} message message to send            params.message = params.message || ' ';            // {Function} onsuccess handler to call when get the result (optional)            params.onsuccess = params.onsuccess || function () {};            // {Function} onerror handler to call when get the result (optional)            params.onerror = params.onerror || function () {};            // {String} returntype type of the result, for type checking (optional)            params.returntype = params.returntype || '';            if (!config.ispost) {                method = 'GET';            }            xhr.open(method, config.url, config.isasync);            xhr.setRequestHeader('Content-Type', contentType);            xhr.setRequestHeader('Accept', acceptType);            try {                xhr.send(params.message);            } catch (e) {                if (!config.isasync) {                    throw WAF.rpc.ErrorFactory.createError({                        code    : '-32100',                        message : e.description || e.message                    });                } else{                    params.onerror({                        code    : '-32100',                        message : 'Server not responding'                    });                }            }            if (!config.isasync) {                if (xhr.readyState === 4) {                    if (xhr.status === 200 || xhr.status === 500) {                        oResponse = xhr.responseText.replace(/^\s+|\s+$/g, '');                        if (oResponse !== null) {                            try {                                oResponse = JSON.parse(oResponse);                            } catch (e) {                                throw WAF.rpc.ErrorFactory.createError({                                    code    : '-32603',                                    message : e.description || e.message                                });                            }                            if (oResponse.result !== undefined) {                                return oResponse.result;                            } else if (oResponse.error !== undefined) {                                // throw an error                                if (oResponse.error) {                                    if (oResponse.error.data) {                                        throw WAF.rpc.ErrorFactory.createError({                                            code    : oResponse.error.code,                                            message : oResponse.error.message,                                            data    : oResponse.error.data                                        });                                    } else {                                        throw WAF.rpc.ErrorFactory.createError({                                            code    : oResponse.error.code,                                            message : oResponse.error.message                                        });                                    }                                } else {                                    throw WAF.rpc.ErrorFactory.createError({                                        code    : '-32603',                                        message : 'Message contains invalid response'                                    });                                }                            } else {                                return null;                            }                        } else {                            return null;                        }                    }                }            } else {                xhr.onreadystatechange = function () {                    if (xhr.readyState === 4) {                        if (xhr.status === 200 || xhr.status === 500) {                            oResponse = xhr.responseText.replace(/^\s+|\s+$/g, '');                            if (oResponse !== null) {                                try {                                    oResponse = JSON.parse(oResponse);                                } catch (e) {                                    throw WAF.rpc.ErrorFactory.createError({                                        code    : '-32603',                                        message : e.description || e.message                                    });                                }                                if (oResponse.result !== undefined) {                                    oResponse = oResponse.result;                                    if (params.returntype) {                                        if ((typeof oResponse !== params.returntype) && (typeof params.returntype !== 'undefined') && (params.returntype.length !== 0)) {                                            params.onerror({                                                code    : '-32602',                                                message : 'invalid return type (' + typeof oResponse + ' instead of ' + params.returntype + ')'                                            });                                        } else {                                            params.onsuccess(oResponse);                                        }                                    } else {                                        params.onsuccess(oResponse);                                    }                                } else {                                    params.onerror(oResponse.error);                                }                            }                        }                    }                };            }            return undefined;        };        /**         * Abort the request         *         * @method abort         */        this.abort = function () {            xhr.abort();        };    },    /**     * Script Tag Request (for JSON-P)     *     * @class WAF.classes.Rpc.request.ScriptTagRequest     * @extends WAF.classes.Rpc.request.Request     *     * @constructor     * @param {Object} config parameters     */    ScriptTagRequest : function (config) {        config = config || {};        /**         * Initialisation of the request         *         * @method init         */        this.init = function () {        // TO IMPLEMENTS        };        /**         * Send the data         *         * @method send         */        this.send = function () {        // TO IMPLEMENTS        };        /**         * Abort the request         *         * @method abort         */        this.abort = function () {        // TO IMPLEMENTS        };    }};/* * RPC Message */WAF.classes.Rpc.message = {    /**     * XML message Object     *     * @class WAF.classes.Rpc.message.XmlMessage     *     * @constructor     * @param {Object} config parameters     */    XmlMessage : function (config) {    // TO IMPLEMENTS    },    /**     * JSON message     *     * @class WAF.classes.Rpc.message.JsonMessage     *     * @constructor     * @param {Object} config parameters     */    JsonMessage : function (config) {        var tabArgs = [],        i = 0,        max = 0,        arg = '',        args = {},        message = {},        argumentsLength = 0;        // config        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} name name of the function to call        config.name = config.name || '';        // {Object} arguments arguments to send to the client        config.arguments = config.arguments || {};        // {Array} parameters parameters to send to the client        config.parameters = config.parameters || [];        // {String} body body of the method        config.body = config.body || '';        /**         * Create a unique id for the transaction         *         * @private         * @method generateId         * @return {Number} a unique id         */        function generateId() {            var            id = new Date();            id = parseInt(Math.random() * id.getTime(), 10);            return id;        }        // force correct type        if (config.arguments.length !== undefined) {            argumentsLength = config.arguments.length;            for (i = 0; i < argumentsLength; i += 1) {                arg = config.arguments[i];                tabArgs.push(arg);            }            args = tabArgs;        } else {            args = config.arguments;        }        if (config.body.length === 0) { // basic rpc call            message =  {                jsonrpc : '2.0',                id      : generateId(),                method  : config.name,                params  : args            };        } else { // rpc call with code to execute            message =  {                jsonrpc : '2.0-wakanda',                id      : generateId(),                method  : {                    keys   : config.parameters,                    source : config.body                },                params  : args            };        }        return message;    }};WAF.classes.Rpc.error = {    /**     * Error Mehod Not Found     *     * @class WAF.classes.Rpc.error.MethodNotFoundError     *     * @constructor     * @param {Object} [config]     */    MethodNotFoundError : function (config) {        var        error = {};        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} message message of the error        config.message = config.message || '';        // {String} info more informations about the error        config.data = config.data || '';        // {String} code code of the error        config.code = config.code || '-1';        /**         * @property name         * @type String         * @default "MethodNotFoundError"         */        /**         * @property message         * @type String         */        /**         * @property description         * @type String         */        if (config.data) {            error =  {                name        : 'MethodNotFoundError',                message     : config.message,                description : config.data,                code        : config.code            };        } else {            error =  {                name    : 'MethodNotFoundError',                message : config.message,                code    : config.code            };        }        return error;    },    /**     * Error Server     *     * @class WAF.classes.Rpc.error.ServerError     *     * @constructor     * @param {Object} [config]     */    ServerError : function (config) {        var error = {};        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} message message of the error        config.message = config.message || '';        // {String} info more informations about the error        config.data = config.data || '';        // {String} code code of the error        config.code = config.code || '-1';        if (config.data) {            error =  {                name        : 'ServerError',                message     : config.message,                description : config.data,                code        : config.code            };        } else {            error =  {                name    : 'ServerError',                message : config.message,                code    : config.code            };        }        return error;    },    /**     * Invalid Params Error     *     * @class WAF.classes.Rpc.error.InvalidParamsError     */    InvalidParamsError : function (config) {        var error = {};        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} message message of the error        config.message = config.message || '';        // {String} info more informations about the error        config.data = config.data || '';        // {String} code code of the error        config.code = config.code || '-1';        /**         * @property name         * @type String         * @default "InvalidParamsError"         */        /**         * @property message         * @type String         */        /**         * @property description         * @type String         */        if (config.data) {            error =  {                name        : 'InvalidParamsError',                message     : config.message,                description : config.data,                code        : config.code            };        } else {            error =  {                name    : 'InvalidParamsError',                message : config.message,                code    : config.code            };        }        return error;    },    /**     * Internal Error     *     * @class WAF.classes.Rpc.error.InternalError     */    InternalError : function (config) {        var error;        config = config || {};        if (typeof config !== 'object') {            config = {};        }        // {String} message message of the error        config.message = config.message || '';        // {String} data more informations about the error        config.data = config.data || '';        // {String} code code of the error        config.code = config.code || '-1';        /**         * @property name         * @type String         * @default "InternalError"         */        /**         * @property message         * @type String         */        /**         * @property description         * @type String         */        if (config.data) {            error =  {                name        : 'InternalError',                message     : config.message,                description : config.data,                code        : config.code            };        } else {            error =  {                name    : 'InternalError',                message : config.message,                code    : config.code            };        }        return error;    }};/** * rpc * * @class WAF.rpc */WAF.rpc = {    /**     * transactions     *     * @static     * @property transactions     * @type Object     * @default {}     **/    transactions: {},    /**     * Call to a rpc function     *     * @static     * @method call     * @param {Object} params parameters     * @return {Object} result     */    call : function (params) {        var rpc = null,        wrpc = WAF.rpc,        i = 0,        argumentsLength = arguments.length,        parameters = {};        params.urlservice = params.urlservice || '/rpc/';        if (typeof params === 'string') {            if (argumentsLength > 0) {                parameters.name = arguments[0];                parameters.arguments = [];                for (i = 1; i < argumentsLength; i += 1) {                    parameters.arguments.push(arguments[i]);                }            }            parameters.urlservice = parameters.urlservice || '/rpc/';            params = parameters;        }        if (wrpc.transactions[params.urlservice]) {            rpc = wrpc.transactions[params.urlservice];        } else {            rpc = new WAF.classes.Rpc(params);            wrpc.transactions[params.urlservice] = rpc;        }        return rpc.call(params);    },    /**     * Call to a rpc function     *     * @static     * @method callAsync     * @param {Object} params parameters     * @return {WAF.classes.request} result     */    callAsync : function (params) {        var        rpc = null,        wrpc = WAF.rpc,        argumentsLength = arguments.length,        parameters = {},        i = 0;        params.urlservice = params.urlservice || '/rpc/';        if (typeof params === 'function') {            if (argumentsLength > 1) {                parameters.onsuccess = arguments[0];                parameters.name = '';                if (typeof arguments[1] === 'string') {                    parameters.name = arguments[1];                }                parameters.arguments = [];                for (i = 2; i < argumentsLength; i += 1) {                    parameters.arguments.push(arguments[i]);                }            }            parameters.urlservice = parameters.urlservice || '/rpc/';            params = parameters;        }        if (wrpc.transactions[params.urlservice]) {            rpc = wrpc.transactions[params.urlservice];        } else {            rpc = new WAF.classes.Rpc(params);            wrpc.transactions[params.urlservice] = rpc;        }        return rpc.callAsync(params);    },    ProxyFactory : {        /**         * createProxy         *         * @class WAF.rpc.ProxyFactory.createProxy         *         * @constructor         * @param {Object} params         **/        createProxy : function (params) {            var method = '',            i = 0,            remoteproxy = {},            functionName = '',            argumentsParamsLength = 0,            root = WAF._private.globals.root;            params = params || {};            if (typeof params !== 'object') {                params = {};            }            // {Object} description description of the interface in JSON SCHEMA            params.description = params.description || {};            // {String} urlservice url of the RPC service            params.urlservice = params.urlservice || {};            // {String} requesttype type of the request            params.requesttype = params.requesttype || 'ajax';            // {String} messagetype type of the message            params.messagetype = params.messagetype || 'json';            // {String} namespace namespace of the methods            params.namespace = params.namespace || '';            // {Array} methods list of methods to implement            params.methods = params.methods || [];            // {Boolean} messagevalidation check message            if (typeof params.messagevalidation === 'undefined') {                params.messagevalidation = true;            }            /**             * Create a interface with synchronous call to the rpc service             *             *             * @private             * @method implementsInterfaceSync             * @param {String} name name of the function             * @param {Object} parameters parameters             */            function implementsInterfaceSync(name, parameters) {                parameters = parameters || {};                if (typeof parameters !== 'object') {                    parameters = {};                }                // {String} name name of the method to create                name = name || '';                // {String} description description of the service                parameters.description = parameters.description || '';                // {String} type type of the service                parameters.type        = parameters.type || '';                // {String} returns type of the result (if any)                parameters.returns     = parameters.returns || [];                // {String} params parameters of the method                parameters.params      = parameters.params || [];                return function () {                    var                    result = '',                    message = {},                    request = {},                    i = 0,                    argumentsLength = 0,                    wrpc = WAF.rpc;                    if (params.messagevalidation) {                        // check parameters                        if (arguments.length !== parameters.params.length) {                            throw wrpc.ErrorFactory.createError({                                code    : '-32603',                                message : 'wrong number of parameters (' + arguments.length + ' instead of ' + parameters.params.length + ')'                            });                        }                        argumentsLength = arguments.length;                        for (i = 0; i < argumentsLength; i += 1) {                            if (parameters.params[i].type !== undefined && typeof(arguments[i]) !== parameters.params[i].type) {                                throw wrpc.ErrorFactory.createError({                                    code    : '-32603',                                    message : 'wrong type for parameter ' + arguments[i] + ' (' + typeof(arguments[i]) + ' instead of ' + parameters.params[i].type + ')'                                });                            }                        }                    }                    request = wrpc.RequestFactory.createRequest({                        url         : params.urlservice,                        isasync     : false,                        messagetype : params.messagetype                    });                    request.init();                    message = wrpc.MessageFactory.createMessage({                        name        : name,                        arguments   : arguments,                        messagetype : params.messagetype                    });                    message = JSON.stringify(message);                    result = request.send({                        'message' : message                    });                    if (result !== undefined) {                        if ((result !== null) && (result.error !== undefined)) {                            if (result.error.data) {                                throw wrpc.ErrorFactory.createError({                                    code    : result.error.code,                                    message : result.error.message,                                    data    : result.error.data                                });                            } else {                                throw wrpc.ErrorFactory.createError({                                    code    : result.error.code,                                    message : result.error.message                                });                            }                        } else {                            if (params.messagevalidation) {                                if ((typeof result !== parameters.returns) && (typeof parameters.returns !== 'undefined') && (parameters.returns.length !== 0)) {                                    throw wrpc.ErrorFactory.createError({                                        code    : '-32602',                                        message : 'invalid return type (' + typeof result + ' instead of ' + parameters.returns + ')'                                    });                                } else {                                    return result;                                }                            } else {                                return result;                            }                        }                    } else {                        return true;                    }                };            }            /**             * Create a interface with synchronous call to the rpc service             *             * @private             * @method implementsInterfaceAsync             * @param {String} name name of the function             * @param {Object} parameters parameters             */            function implementsInterfaceAsync (name, parameters) {                parameters = parameters || {};                if (typeof parameters !== 'object') {                    parameters = {};                }                // {String} name name of the method to create                name = name || '';                // {String} description description of the service                parameters.description = parameters.description || '';                // {String} type type of the service                parameters.type        = parameters.type || '';                // {String} returns type of the result (if any)                parameters.returns     = parameters.returns || '';                // {String} params parameters of the method                parameters.params      = parameters.params || [];                return function () {                    var message = {},                    request = {},                    i = 0,                    nbOptionalParams = 0,                    tabArguments = [],                    argumentsLength = 0,                    wrpc = WAF.rpc,                    tabArgs= [],                    error = {},                    isError = false;                    // cast params in array                    if (arguments[0].params) {                        if (arguments[0].params.constructor !== Array) {                            tabArgs.push(arguments[0].params);                            arguments[0].params = tabArgs;                        }                        argumentsLength = arguments[0].params.length;                    }                    // allow onError/onerror & onSuccess/onsuccess                    if (typeof arguments[0].onSuccess !== 'undefined') {                        arguments[0].onsuccess = arguments[0].onSuccess;                    }                    if (typeof arguments[0].onError !== 'undefined') {                        arguments[0].onerror = arguments[0].onError;                    }                    if (params.messagevalidation) {                        // check parameters                        if (arguments[0].onsuccess || arguments[0].onerror || (typeof arguments[0] === 'function')) {                            nbOptionalParams += 1;                        }                        if (arguments[0].params) {                            if (argumentsLength !== parameters.params.length) {                                error = wrpc.ErrorFactory.createError({                                    code    : '-32603',                                    message : 'wrong number of parameters (' + argumentsLength + ' instead of ' + parameters.params.length + ')'                                });                                if (arguments[0].onerror) {                                    arguments[0].onerror(error);                                    isError = true;                                } else {                                    throw error;                                }                            }                            if (!isError) {                                for (i = 0; i < argumentsLength; i += 1) {                                    if (parameters.params[i].type !== undefined && typeof(arguments[0].params[i]) !== parameters.params[i].type) {                                        error = wrpc.ErrorFactory.createError({                                            code    : '-32603',                                            message : 'wrong type for parameter ' + arguments[0].params[i] + ' (' + typeof(arguments[0].params[i]) + ' instead of ' + parameters.params[i].type + ')'                                        });                                        if (arguments[0].onerror) {                                            arguments[0].onerror(error);                                            isError = true;                                            break;                                        } else {                                            throw error;                                        }                                    }                                }                            }                        } else {                            if ((arguments.length - nbOptionalParams) !== parameters.params.length) {                                error = wrpc.ErrorFactory.createError({                                    code    : '-32603',                                    message : 'wrong number of parameters (' + arguments.length + ' instead of ' + parameters.params.length + ')'                                });                                if (arguments[0].onerror) {                                    arguments[0].onerror(error);                                    isError = true;                                } else {                                    throw error;                                }                            }                            if (!isError) {                                argumentsLength = arguments.length - nbOptionalParams;                                for (i = 0; i < argumentsLength; i += 1) {                                    if (parameters.params[i].type !== undefined && typeof(arguments[i + nbOptionalParams]) !== parameters.params[i].type) {                                        error = wrpc.ErrorFactory.createError({                                            code    : '-32603',                                            message : 'wrong type for parameter ' + arguments[i + nbOptionalParams] + ' (' + typeof(arguments[i + nbOptionalParams]) + ' instead of ' + parameters.params[i].type + ')'                                        });                                        if (arguments[0].onerror) {                                            arguments[0].onerror(error);                                            isError = true                                        } else {                                            throw error;                                        }                                    }                                }                            }                        }                    }                    if (!isError) {                        request = wrpc.RequestFactory.createRequest({                            url         : params.urlservice,                            messagetype : params.messagetype                        });                        request.init();                        if (typeof arguments[0] === 'function') {                            arguments[0].onsuccess = arguments[0];                        }                        if (arguments[0].onsuccess || arguments[0].onerror || arguments[0].params) {                            if (arguments[0].params && arguments.length === 1) {                                message = wrpc.MessageFactory.createMessage({                                    name        : name,                                    arguments   : arguments[0].params,                                    messagetype : params.messagetype                                });                            } else {                                argumentsLength = arguments.length;                                for (i = 0; i < argumentsLength; i += 1) {                                    tabArguments[i - 1] = arguments[i];                                }                                message = wrpc.MessageFactory.createMessage({                                    name        : name,                                    arguments   : tabArguments,                                    messagetype : params.messagetype                                });                            }                            message = JSON.stringify(message);                            if (params.messagevalidation) {                                request.send({                                    message    : message,                                    onsuccess  : arguments[0].onsuccess,                                    onerror    : arguments[0].onerror,                                    returntype : parameters.returns                                });                            } else {                                request.send({                                    message   : message,                                    onsuccess : arguments[0].onsuccess,                                    onerror   : arguments[0].onerror                                });                            }                        } else {                            message = wrpc.MessageFactory.createMessage({                                name        : name,                                arguments   : arguments,                                messagetype : params.messagetype                            });                            message = JSON.stringify(message);                            if (params.messagevalidation) {                                request.send({                                    message    : message,                                    returntype : parameters.returns                                });                            } else {                                request.send({                                    message    : message,                                    returntype : parameters.returns                                });                            }                        }                        return request;                    }                };            }            if (params.namespace) {                if (typeof root[params.namespace] === 'undefined') {                    root[params.namespace] = {};                }                remoteproxy = root[params.namespace];            } else {                remoteproxy = root;            }            if (params.messagevalidation) {                // implementation of the methods                for (functionName in params.description )  {                    if (typeof(params.description[functionName]) !== 'string') {                        remoteproxy[functionName] = implementsInterfaceSync(functionName, params.description[functionName]);                        remoteproxy[functionName + 'Async'] = implementsInterfaceAsync(functionName, params.description[functionName]);                    }                }            } else {                // case specified methods name (we create only proxies on demands)                if (params.methods.length > 0) {                    argumentsParamsLength = params.methods.length;                    for (i = 0; i < argumentsParamsLength; i += 1) {                        functionName = params.methods[i];                        remoteproxy[functionName] = implementsInterfaceSync(functionName);                        remoteproxy[functionName + 'Async'] = implementsInterfaceAsync(functionName);                    }                } else {                    for (functionName in params.description )  {                        if (typeof(params.description[functionName]) !== 'string') {                            remoteproxy[functionName] = implementsInterfaceSync(functionName, params.description[functionName]);                            remoteproxy[functionName + 'Async'] = implementsInterfaceAsync(functionName, params.description[functionName]);                        }                    }                }            }            return remoteproxy;        }    },    /**     * Error Factory     *     * @class WAF.rpc.ErrorFactory     */    ErrorFactory : {        /**         * Create an error         *         * @static         * @method createError         * @param {Object} params         */        createError : function (params) {            var error = WAF.classes.Rpc.error;            params = params || {};            if (typeof params !== 'object') {                params = {};            }            // {String} code code of the error            params.code = params.code || '-1';            switch (params.code) {                case '-32601':                    return new error.MethodNotFoundError(params);                case '-32602':                    return new error.InvalidParamsError(params);                case '-32603':                    return new error.InternalError(params);                default:                    return new error.ServerError(params);            }        }    },    /**     * Message Factory     *     * @class WAF.rpc.MessageFactory     */    MessageFactory : {        /**         * Create a message         *         * @static         * @method createMessage         * @param {Object} params parameters         */        createMessage : function (params) {            var message = WAF.classes.Rpc.message;            params = params || {};            if (typeof params !== 'object') {                params = {};            }            // {String} type type of the message            params.messagetype = params.messagetype || 'json';            switch (params.messateType) {                case 'json':                    return new message.JsonMessage(params);                case 'xml':                    return new message.XmlMessage(params);                default:                    return new message.JsonMessage(params);            }        }    },    /**     * Request Factory     *     * @class WAF.rpc.RequestFactory     */    RequestFactory : {        /**         * Create a request         *         * @static         * @method createRequest         * @param {Object} params parameters         */        createRequest : function (params) {            var request = WAF.classes.Rpc.request;            params = params || {};            if (typeof params !== 'object') {                params = {};            }            // {String} type type of the request            params.type = params.type || 'http';            switch (params.type) {                case 'http':                    return new request.HttpRequest(params);                case 'jsonp':                    return new request.ScriptTagRequest(params);                default:                    return new request.HttpRequest(params);            }        }    }};// load meta parameters(function (WAF) {    var rpc = null,    methods = [],    namespace  = '',    messageValidation = false;    if (WAF.config) {        if (WAF.config.rpc) {            messageValidation = WAF.config.rpc.validation;            if (typeof messageValidation === 'undefined') {                messageValidation = false;            }            rpc = new WAF.classes.Rpc({                messageValidation: messageValidation            });            if (typeof WAF.config.rpc === 'string') {                try {                    rpc.getInterfaces({                        conf: JSON.parse(WAF.config.rpc.replace(/'/g, '\"'))                    });                } catch (e) {}            } else {                methods = WAF.config.rpc.methods || WAF.config.rpc.module;                namespace = WAF.config.rpc.namespace;                if (methods && methods.length > 0) {                    rpc.getInterfaces({                        methods  : methods.split(','),                        namespace: namespace                    });                } else {                    if (namespace && namespace.length > 0) {                        rpc.getInterfaces({                            namespace: namespace                        });                    }                }            }        }    }}(WAF));/*** Require a commonJS mocule defined on the server** @static* @method require* @param {String} modulePath path to the module* @return {Object} module with methods*/WAF.require = function (modulePath) {    var namespace = 'module-' + modulePath.replace(/\//g,'-');    $.ajax({        async   : false,        dataType: 'script',        cache   : 'false',        url     : 'rpc-proxy/' + modulePath + '?namespace=' + namespace    })    if (typeof window[namespace] !== 'undefined') {        return window[namespace];    } else {        return null;    }}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/taglib.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Core Element of WAF Framework * * @author			erwan carriou * @date			march 2010 * @version			0.9 * * @note */// DATASOURCEWAF.addWidget({    type       : 'dataSource',    lib        : 'WAF',    description: 'Source',    category   : 'Data Source',    img        : '../icons/dataSource.png',    tag        : 'meta',    attributes : [    {        name       : 'data-source',        description: 'Source',        category   : 'General'    },    {        name        : 'data-source-type',        description : 'Kind of source',        tooltip     : 'array, object, scalar, dataClass',        defaultValue: 'dataClass',        visibility  : 'hidden',        type        : 'dropdown',        options     : ['array', 'object', 'scalar', 'dataClass'],        category    : 'General'    },    {        name	    : 'data-dataType',        description : 'Variable Type',        defaultValue: 'string',        type        : 'dropdown',        options     : [{            key     : 'string',            value   : 'String'        },{            key     : 'number',            value   : 'Number'        },{            key     : 'boolean',            value   : 'Boolean'        },{            key     : 'object',            value   : 'Object'        },{            key     : 'date',            value   : 'Date'        }],        tooltip     : 'if source kind is scalar, then is used :  number, string, date, ...',        category   : 'General'    },    {        name	   : 'data-attributes',        description: 'Attributes',        visibility : 'hidden',        tooltip    : 'property1:type1, property2:type2, ....  par ex  name:string,salary:number',        category   : 'General'    },    {        name        : 'data-autoLoad',        defaultValue: 'true',        type        : 'checkbox',        description : 'Initial Query'    },    {        name        : 'data-initialQueryString',        defaultValue: '',        description : 'Initial Query String'    },    {        name        : 'data-initialOrderBy',        defaultValue: '',        description : 'Initial Order By'    },    {        name        : 'name',        defaultValue: 'WAF.config.datasources',        visibility  : 'hidden'    },    {        name        : 'content',        defaultValue: '',        visibility  : 'hidden'    }    ],    style: [,    {        name        : 'width',        defaultValue: '1px'    },    {        name        : 'height',        defaultValue: '1px'    }],    events: [	/*    {        name       : 'onAttributeChange',        description: 'On Change',        category   : 'Datasource Events'    },	*/    {        name       : 'onBeforeCurrentElementChange',        description: 'On Before Current Element Change',        category   : 'Datasource Events'    },    {        name       : 'onCurrentElementChange',        description: 'On Current Element Change',        category   : 'Datasource Events'    },    {        name       : 'onElementSaved',        description: 'On Element Saved',        category   : 'Datasource Events'    },    {        name       : 'onCollectionChange',        description: 'On Collection Change',        category   : 'Datasource Events'    }    ],    onInit   : function (config) {        config['binding'] = config['data-source'];        if (config['data-autoLoad'] === null) {            config['data-autoLoad'] = 'true';        }        return WAF.dataSource.create(config);    },    onDesign : function (config, designer, tag, catalog, isResize) {}});// DOCUMENTWAF.addWidget({    type        : 'document',    lib         : 'WAF',    description : 'Document',    category    : 'Hidden',    img         : '../icons/document.png',    tag         : 'div',    attributes  : [    {        name       : 'id',        visibility : 'hidden'    },    {        name       : 'data-title',        description: 'Title'    },    {        name        : 'data-platform',        description : 'Target',        category    : 'Platform',        type        : 'dropdown',        options     : [        {            key: 'desktop',            value: 'Desktop'        },        {            key: 'auto',            value: 'Automatic'        },        {            key: 'smartphone',            value: 'Smartphone'        },        {            key: 'tablet',            value: 'Tablet'        }        ],        defaultValue: 'desktop',        ready: function() {            this.formPanel.hide();        }    },    {        name            : 'data-viewport-width',        description     : 'Width',        category        : 'Viewport',        type            : 'textefield',        defaultValue    : 'device-width',        autocomplete    : ["device-width", "320", "768"],        onchange: function() {            manageViewportMetaTag("width", this.htmlObject[0].value);        },        ready: function() {            $(this.formPanel._htmlObject).find(".actions").click(function(){                (D.prop_section_Viewport_isOpen) ? D.prop_section_Viewport_isOpen = false : D.prop_section_Viewport_isOpen = true;            })            if (D.prop_section_Viewport_isOpen === undefined || !D.prop_section_Viewport_isOpen) {                $(this.formPanel._htmlObject).removeClass("selected");                D.prop_section_Viewport_isOpen = false;            }            if (!D.env.platform || D.env.platform === "desktop") {                this.formPanel.hide();            }        }    },    {        name            : 'data-viewport-height',        description     : 'Height',        category        : 'Viewport',        type            : 'textefield',        defaultValue    : '',        autocomplete    : ["device-height", "480", "1024"],        onchange: function() {            manageViewportMetaTag("height", this.htmlObject[0].value);        }    },    {        name            : 'data-viewport-initial-scale',        description     : 'Initial Scale',        category        : 'Viewport',        type            : 'textefield',        defaultValue    : '1.0',        style       : {            width : '50px'        },        onchange: function() {            manageViewportMetaTag("initial-scale", this.htmlObject[0].value);        }    },    {        name            : 'data-viewport-maximum-scale',        description     : 'Maximum Scale',        category        : 'Viewport',        type            : 'textefield',        defaultValue    : '1.0',        style       : {            width : '50px'        },        onchange: function() {            manageViewportMetaTag("maximum-scale", this.htmlObject[0].value);        }    },    {        name            : 'data-viewport-minimum-scale',        description     : 'Minimum Scale',        category        : 'Viewport',        type            : 'textefield',        defaultValue    : '1.0',        style       : {            width : '50px'        },        onchange: function() {            manageViewportMetaTag("minimum-scale", this.htmlObject[0].value);        }    },    {        name            : 'data-viewport-user-scalable',        description     : 'User Scalable',        category        : 'Viewport',        type            : 'checkbox',        defaultValue    : true,        onclick: function() {            manageViewportMetaTag("user-scalable", this.htmlObject[0].checked);        }    },    {        name            : 'data-apple-meta-tags-web-app',        description     : 'Web App Capable',        category        : 'iOs Meta Tags',        type            : 'checkbox',        defaultValue    : false,        onclick: function() {            var tabMeta = Designer.env.document.getElementsByAttribute('meta', 'name', 'apple-mobile-web-app-capable'),            meta = {},            tabLine = null,            retLine = null;            if (tabMeta.length === 0) {                tabLine = Designer.env.document.createTextNode('\t\t');                Designer.env.document.head.appendChild(tabLine);                meta = Designer.env.document.createElement('meta');                meta.setAttribute('name', 'apple-mobile-web-app-capable');                meta.setAttribute('content', "yes");                Designer.env.document.head.appendChild(meta);                retLine = Designer.env.document.createTextNode('\n');                Designer.env.document.head.appendChild(retLine);            } else {                meta = tabMeta[0];                if (!this.htmlObject[0].checked) {                    Designer.env.platform = meta.setAttribute('content', "no");                } else {                    Designer.env.platform = meta.setAttribute('content', "yes");                }            }            Designer.studio.setDirty();        },        ready: function() {            if (!D.env.platform || D.env.platform === "desktop") {                this.formPanel.hide();            } else {                $(this.formPanel._htmlObject).find(".actions").click(function(){                    (D.prop_section_iosTag_isOpen) ? D.prop_section_iosTag_isOpen = false : D.prop_section_iosTag_isOpen = true;                })                if (D.prop_section_iosTag_isOpen === undefined || !D.prop_section_iosTag_isOpen) {                    $(this.formPanel._htmlObject).removeClass("selected");                    D.prop_section_iosTag_isOpen = false;                }            }        }    },    {        name            : 'data-apple-meta-tags-tel',        description     : 'Format Detection',        category        : 'iOs Meta Tags',        type            : 'checkbox',        defaultValue    : true,        onclick: function() {            var tabMeta = Designer.env.document.getElementsByAttribute('meta', 'name', 'format-detection'),            meta = {},            tabLine = null,            retLine = null;            if (tabMeta.length === 0) {                tabLine = Designer.env.document.createTextNode('\t\t');                Designer.env.document.head.appendChild(tabLine);                meta = Designer.env.document.createElement('meta');                meta.setAttribute('name', 'format-detection');                meta.setAttribute('content', "telephone=no");                Designer.env.document.head.appendChild(meta);                retLine = Designer.env.document.createTextNode('\n');                Designer.env.document.head.appendChild(retLine);            } else {                meta = tabMeta[0];                if (!this.htmlObject[0].checked) {                    Designer.env.platform = meta.setAttribute('content', "telephone=no");                } else {                    Designer.env.platform = meta.setAttribute('content', "telephone=yes");                }            }            Designer.studio.setDirty();        }    },    {        name        : 'data-apple-meta-tags-status-bar',        description : 'Status Bar Style',        category    : 'iOs Meta Tags',        type        : 'dropdown',        options     : [        {            key: 'default',            value: 'Default'        },        {            key: 'black',            value: 'Black'        },        {            key: 'black-translucent',            value: 'Black Translucent'        }        ],        onchange: function() {            var tabMeta = Designer.env.document.getElementsByAttribute('meta', 'name', 'apple-mobile-web-app-status-bar-style'),            meta = {},            tabLine = null,            retLine = null,            newValue = this.htmlObject[0].value;            if (tabMeta.length === 0) {                tabLine = Designer.env.document.createTextNode('\t\t');                Designer.env.document.head.appendChild(tabLine);                meta = Designer.env.document.createElement('meta');                meta.setAttribute('name', 'apple-mobile-web-app-status-bar-style');                meta.setAttribute('content', newValue);                Designer.env.document.head.appendChild(meta);                retLine = Designer.env.document.createTextNode('\n');                Designer.env.document.head.appendChild(retLine);            } else {                meta = tabMeta[0];                Designer.env.platform = meta.setAttribute('content', newValue);            }            Designer.studio.setDirty();        },        defaultValue: 'default'    },    {        name        : 'data-workspace-device',        description : 'Device',        type        : 'combo',        reloadTag   : true,        ready         : function() {            var            i,            tag,            json,            device;            tag     = this.data.tag;            json    = Designer.resources.device;            device  = tag.getAttribute('data-workspace-device').getValue();            if (!Designer.isNewPage()) {                this.addOption('custom', 'Custom');            } else {                this._input.attr('disabled', 'disabled');                this._input.autocomplete('disable');            }            for (i in json) {                this.addOption(i, i);            }            this.select(device ? device : 'custom');            //just remove scrollbar if needed            if (D.isMobile) {                $("#waf-body").css("overflow", "hidden");            }        //this._parent.parent().hide();        },        onchange    : function () {            var            tag,            data,            info,            value,            width,            sizes,            height;            data    = this.getData();            value   = this.getValue();            tag     = data.tag;            info    = D.util.getWorkspaceInfo(value, tag.getAttribute('data-workspace-orientation').getValue());            tag.getAttribute('data-workspace-height').setValue(String(info.height));            tag.getAttribute('data-workspace-width').setValue(String(info.width));            $('#textInput-data-workspace-width').val(info.width);            $('#textInput-data-workspace-height').val(info.height);            $('#select-data-workspace-orientation').val(info.orientation);            if (value === "custom") {                $("#textInput-data-workspace-width").get()[0].disabled = false;                $("#textInput-data-workspace-height").get()[0].disabled = false;                $("#select-data-workspace-orientation").closest("tr").hide();            } else {                $("#textInput-data-workspace-width").get()[0].disabled = true;                $("#textInput-data-workspace-height").get()[0].disabled = true;                $("#select-data-workspace-orientation").closest("tr").show();            }            //manage scrollbar            if (D.isMobile) {                $("#waf-body").css("overflow", "hidden");            } else {                $("#waf-body").css("overflow", "auto");            }            tag.domUpdate();        },        category    : 'Workspace'    },    {        name        : 'data-workspace-orientation',        description : 'Orientation',        type        : 'select',        reloadTag   : true,        options     : [{            key     : 'portrait',            value   : 'Portrait'        },{            key     : 'landscape',            value   : 'Landscape'        }],        category    : 'Workspace',        ready       : function() {            var            tag,            attr,            data,            device,            deviceVal;            data        = this.data;            tag         = data.tag;            attr        = tag.getAttribute('data-workspace-orientation');            deviceVal   = tag.getAttribute('data-workspace-device').getValue();            if (deviceVal) {                device      = Designer.resources.device[deviceVal];            }            if (!attr.getValue() && device) {                attr.setValue(device.defaultOrientation);            }            if (deviceVal === "custom") {                this.getHtmlObject().closest("tr").hide();            }        },        beforechange: function () {            var            tag,            info,            data,            width,            height,            oldValue,            newValue;            data        = this.data;            tag         = data.tag;            info    = D.util.getWorkspaceInfo(tag.getAttribute('data-workspace-device').getValue(), this.getValue());            tag.getAttribute('data-workspace-height').setValue(String(info.height));            tag.getAttribute('data-workspace-width').setValue(String(info.width));            $('#textInput-data-workspace-width').val(info.width);            $('#textInput-data-workspace-height').val(info.height);           /* if (Designer.isNewPage()) {                if (info.orientation == 'landscape') {                    // set background image                    $("#yui-gen7 .yui-layout-bd").css('background-image', 'url("/Resources/Web Components/GUIDesigner/images/' + Designer.env.workspace.backgroundImageLandscape + '") !important');                    $("#yui-gen7 .yui-layout-bd").css('background-repeat', 'no-repeat !important');                    $("#yui-gen7 .yui-layout-bd").css('background-color', '#EEEEEE !important');                    $("#yui-gen7 .yui-layout-bd").css('background-position', 'center center !important');                } else {                    // set background image                    $("#yui-gen7 .yui-layout-bd").css('background-image', 'url("/Resources/Web Components/GUIDesigner/images/' + Designer.env.workspace.backgroundImagePortrait  + '") !important');                    $("#yui-gen7 .yui-layout-bd").css('background-repeat', 'no-repeat !important');                    $("#yui-gen7 .yui-layout-bd").css('background-color', '#EEEEEE !important');                    //$("#yui-gen7 .yui-layout-bd").css('background-position', 'center center !important');                }            }*/            tag.domUpdate();        }    },    {        name        : 'data-workspace-width',        description : 'Width',        reloadTag   : true,        style       : {            width : '50px'        },        category    : 'Workspace',        onblur      : function(){            var            tag,            data,            info,            width,            height,            device,            deviceInfo,            orientation;            data        = this.data;            tag         = data.tag;            width       = this.getValue();            height      = tag.getAttribute('data-workspace-height').getValue();            device      = tag.getAttribute('data-workspace-device').getValue();            orientation = tag.getAttribute('data-workspace-orientation').getValue();            info        = D.util.getWorkspaceInfo(device,orientation);            if (width != info.width || height != info.height) {                waForm.components.get('combo-data-workspace-device').select('custom');            }        },        ready : function(){            var data    = this.data,            tag     = data.tag,            device  = tag.getAttribute('data-workspace-device').getValue();            if (device != "custom") {                this.getHtmlObject()[0].disabled = true;            }        }    },    {        name        : 'data-workspace-height',        description : 'Height',        reloadTag   : true,        style       : {            width : '50px'        },        category    : 'Workspace',        ready : function(){            var data    = this.data,            tag     = data.tag,            device  = tag.getAttribute('data-workspace-device').getValue();            if (device != "custom") {                this.getHtmlObject()[0].disabled = true;            }        }    },    {        name        : 'data-texture-header',        defaultValue: '',        visibility  : 'hidden',        description : 'Header Texture'    },    {        name        : 'data-texture-footer',        defaultValue: '',        visibility  : 'hidden',        description : 'Footer Texture'    },    {        name        : 'class',        description : 'Css class'    },    {        name        : 'data-group',        defaultValue: '',        visibility  : 'hidden',        description : 'Group'    }    ],    events      : [    {        name       : 'onLoad',        description: 'On Load',        category   : 'UI Events'    }],    style       : [    {        name        : 'z-index',        defaultValue: '0'    },    {        name        : 'width',        defaultValue: '0px'    },    {        name        : 'height',        defaultValue: '0px'    }],    properties: {        style: {            theme       : {                'orange'    : false,                'blue'      : false,                'inherited' : false,                'roundy'    : false            },            fClass      : true,            text        : false,            background  : true,            border      : false,            sizePosition: false,            label       : false        }    },    onInit   : function (config) {        var        i;        // Hide displayed submenus        if (WAF.PLATFORM.isTouch) {            $(document).bind('touchstart', function(){                if (event.target.nodeName == "HTML") {                    $('.waf-menuItem .waf-menuBar').fadeOut(200, function(){                        $('.waf-menuItem').not('.waf-tabView-tab').removeClass('waf-state-selected').removeClass('waf-state-active').removeClass('waf-state-hover');                    });                }            });        } else {            $(document).bind('click', function(){                $('.waf-menuItem .waf-menuBar').fadeOut(200);                $('.waf-menuItem').not('.waf-tabView-tab').removeClass('waf-state-selected');            });        }        /*         * For Display block on oldest pages         */        $('body').css('display', 'block');        for (i in WAF.widget.themes) {            $('body').removeClass(WAF.widget.themes[i].key);        }    },    onDesign : function (config, designer, tag, catalog, isResize) {        var        i,        body,        info,        width,        height,        device,        bgElement,        marginTop,        marginLeft,        widthValue,        orientation,        heightValue,        bgElementLayout,        workspace = Designer.env.workspace;        body        = $('#waf-body');        bgElement   = $('#yui-gen7');        device      = tag.getAttribute('data-workspace-device').getValue();        if (!Designer.isNewPage()) {            if (!device) {                if (Designer.env.platform == 'smartphone') {                    device      = "Apple iPhone";                    orientation = Designer.resources.device[device].defaultOrientation;                    widthValue  = Designer.resources.device[device].width;                    heightValue = Designer.resources.device[device].height;                } else if ( Designer.env.platform == 'tablet') {                    device      = "Apple iPad";                    orientation = Designer.resources.device[device].defaultOrientation;                    widthValue  = Designer.resources.device[device].height;                    heightValue = Designer.resources.device[device].width;                }                tag.getAttribute('data-workspace-device').setValue(device);                tag.getAttribute('data-workspace-orientation').setValue(orientation);                tag.getAttribute('data-workspace-width').setValue(widthValue);                tag.getAttribute('data-workspace-height').setValue(heightValue);            } else {                orientation = tag.getAttribute('data-workspace-orientation').getValue();                widthValue  = tag.getAttribute('data-workspace-width').getValue();                heightValue = tag.getAttribute('data-workspace-height').getValue();            }        } else {            orientation = tag.getAttribute('data-workspace-orientation').getValue();            widthValue  = tag.getAttribute('data-workspace-width').getValue();            heightValue = tag.getAttribute('data-workspace-height').getValue();        }        info        = D.util.getWorkspaceInfo(device, orientation);        width       = !widthValue   || widthValue == 'auto' ? null : parseInt(widthValue);        height      = !heightValue  || heightValue == 'auto' ? null : parseInt(heightValue);        if (width) {            marginLeft = ($('#yui-gen6').width()/2) - width/2;        } else {            width       = '100%';            marginLeft  = 'auto';        }        if (height) {            marginTop = ($('#yui-gen6').height()/2) - height/2;        } else {            height      = '100%';            marginTop   = 'auto';        }        if (marginLeft < 0) {            marginLeft = 0;        }        if (marginTop < 0) {            marginTop = 0;        }        body.css({            'height'        : height,            'width'         : width,            'margin-top'    : marginTop,            'margin-left'   : marginLeft,			'z-index'		: 0        });        if (width != tag._tmpWidth || height != tag._tmpHeight) {            Designer.resizeConstraintsWidgets();        }        tag._tmpWidth   = width;        tag._tmpHeight  = height;        bgElementLayout = bgElement.children('.yui-layout-bd');        /*         * Add background device         */        switch (device.toLowerCase()) {            case 'ipad':            case 'tablet':                if (info.orientation == 'landscape') {                    bgElementLayout.css('background-position', (marginLeft-301) + 'px ' + (marginTop-260) + 'px');                } else {                    bgElementLayout.css('background-position', (marginLeft-180) + 'px ' + (marginTop-240) + 'px');                }                break;            case 'iphone':            case 'smartphone':                if (info.orientation == 'landscape') {                    bgElementLayout.css('background-position', (marginLeft-209) + 'px ' + (marginTop-108) + 'px');                } else {                    bgElementLayout.css('background-position', (marginLeft-108) + 'px ' + (marginTop-208) + 'px');                }                break;            default:                /*bgElement.removeClass('studio-workspace-ipad');                bgElement.removeClass('studio-workspace-iphone');*/                break;        }        if (info.orientation == 'landscape') {            /*bgElement.addClass('studio-workspace-landscape');            bgElement.removeClass('studio-workspace-portrait');*/            bgElementLayout.css('background-image', 'url("/Resources/Web Components/GUIDesigner/images/' + workspace.backgroundImageLandscape + '")');        } else {            /*bgElement.addClass('studio-workspace-portrait');            bgElement.removeClass('studio-workspace-landscape');*/             bgElementLayout.css('background-image', 'url("/Resources/Web Components/GUIDesigner/images/' + workspace.backgroundImagePortrait + '")');        }    },    onCreate : function (tag, param) {        /*         * Widget custom on file drop event         */        $(tag).bind('onFileDrop', function(e, data){            var            tag,            ext,            tmp,            reg,            path,            image,            mouseX,            mouseY,            cleanPath,            newTag;            tag     = this;            path    = data.path.cropedPath;            mouseX  = data.mouse.mouseX;            mouseY  = data.mouse.mouseY;            ext     = data.file.extension.toLowerCase();            switch(ext) {                /*                 * Case of image                 */                case 'png':                case 'jpg':                case 'jpeg':                case 'gif':                case 'ico':                    tmp = document.createElement('img');                    tmp.setAttribute('src', data.path.fullPath);                    document.body.appendChild(tmp);                    tmp.onload = function() {                        var                        posX,                        posY,                        image;                        posX = mouseX - (this.width /2);                        posY = mouseY - (this.width /2);                        /*                         * Create image widget                         */                        image = D.createTag({                            type        : 'image',                            left        : posX,                            top         : posY,                            parent      : tag,                            silentMode  : true,                            width       : this.width,                            height      : this.height                        });                        image.getAttribute('data-src').setValue(path);                        image.setCurrent();                        image.onDesign(true);                        image.domUpdate();                        D.tag.refreshPanels();                        /*                         * Remove temporary image                         */                        $(this).remove();                    }                    break;                default:                    /*                     * Case of component                     */                    if(path.indexOf('.' + Designer.constants.extension.webcomponent) > -1) {                        newTag = D.createTag({                            type        : 'component',                            left        : mouseX,                            top         : mouseY,                            width       : 200,                            height      : 200,                            parent      : tag,                            silentMode  : true                        });                        cleanPath   = path.split('WebFolder')[path.split('WebFolder').length - 1];                        reg         = new RegExp('\\\\', 'g');                        cleanPath   = cleanPath.replace(reg, '/');                        if (cleanPath.substring(cleanPath.length - 1, cleanPath.length) == '/') {                            cleanPath = cleanPath.substring(0, cleanPath.length - 1);                        }                        if (cleanPath.substring(0, 1) == '/') {                            cleanPath = cleanPath.replace('/','');                        }                        newTag.getAttribute('data-path').setValue('/' + cleanPath);                    }                    /*                     * Case of link                     */                    else {                        newTag = D.createTag({                            type        : 'richText',                            left        : mouseX,                            top         : mouseY,                            parent      : tag,                            silentMode  : true                        });                        newTag.getAttribute('data-link').setValue(path);                        newTag.getAttribute('data-text').setValue(path);                    }                    newTag.setCurrent();                    newTag.onDesign(true);                    newTag.domUpdate();                    D.tag.refreshPanels();                    break;            }        });    }});// HTML TAGWAF.addWidget({    type        : 'htmlTag',    lib         : 'html',    description : 'tag html',    category    : 'Hidden',    img         : '../icons/htmlTag.png',    tag         : '',    attributes  : [],    events      : [],    style       : [    {        name        : 'z-index',        defaultValue: '0'    },    {        name        : 'background-color',        defaultValue: '#FFFFFF'    },    {        name        : 'width',        defaultValue: '0px'    },    {        name        : 'height',        defaultValue: '0px'    }],    properties: {        style: {            theme       : false,            fClass      : false,            text        : false,            background  : false,            border      : false,            sizePosition: false,            label       : false        }    },    onInit   : function (config) {},    onDesign : function (config, designer, tag, catalog, isResize) {}});/** * manage the viewport tag content for mobile pages * @method manageViewportMetaTag * @param {object} valueName * @param {object} newValue */function manageViewportMetaTag( valueName, newValue) {    var tabMeta         = Designer.env.document.getElementsByAttribute('meta', 'name', 'viewport'),    meta            = {},    tabLine         = null,    retLine         = null,    element         = {},    doc             = D.getCurrent(),    contentValue    = "";    //get current values    element["width"]            = doc.getAttribute("data-viewport-width").getValue(),    element["height"]           = doc.getAttribute("data-viewport-height").getValue();    element["initial-scale"]    = doc.getAttribute("data-viewport-initial-scale").getValue();    element["minimum-scale"]    = doc.getAttribute("data-viewport-minimum-scale").getValue();    element["maximum-scale"]    = doc.getAttribute("data-viewport-maximum-scale").getValue();    element["user-scalable"]    = doc.getAttribute("data-viewport-user-scalable").getValue();    if (valueName === "user-scalable") {        if (newValue) {            newValue = "yes";        } else {            newValue = "no";        }    }    //set new value for the given element    element[valueName] = newValue;    //rebuild the content string from stored values & new value    $.each(element, function(index, value) {        if (value != null && value + 0 != "0") {            if (contentValue != "" && value != "yes") {                contentValue = contentValue + ",";            }            if (value != "yes") {                contentValue = contentValue + " " + index + " = " + value;            }        }    });    //manage the tag    if (tabMeta.length === 0) {        tabLine = Designer.env.document.createTextNode('\t\t');        Designer.env.document.head.appendChild(tabLine);        meta = Designer.env.document.createElement('meta');        meta.setAttribute('name', 'viewport');        meta.setAttribute('content', contentValue);        Designer.env.document.head.appendChild(meta);        retLine = Designer.env.document.createTextNode('\n');        Designer.env.document.head.appendChild(retLine);    } else {        meta = tabMeta[0];        Designer.env.platform = meta.setAttribute('content', contentValue);    }    Designer.studio.setDirty();}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/tags.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * The engine that converts static HTML tags into dynamic Widgets * * @module Tags * * @author			The Wakanda Team * @date			march 2010 * @version			0.1 *//** * Tags namespace * * @class WAF.tags */WAF.tags = {    /**     * Parse the document to find Wakanda Widget and Datasource markup and create them     *     * @static     * @method createView     */    createView: function createView() {        var tabDataSources = [],        tabDom = [],        i = 0,        source = {},        nbComponent = -1,        nbDataSource = -1,        dataSourceList = [],        privateData = {},        domobj = [];        $.datepicker.setDefaults($.datepicker.regional['']);        // create first the data source        tabDataSources = $('[data-type=dataSource]');        for (i = 0, nbDataSource = tabDataSources.length; i < nbDataSource; i++) {            domobj = tabDataSources[i];            this.createComponent(domobj, true);        }        dataSourceList = WAF.dataSource.list;        // if some sources depends from others, need a second pass        WAF.dataSource.fullyInitAllSources();        // then the widgets        tabDom = $('[data-type]');        for (i = 0, nbComponent = tabDom.length; i < nbComponent; i++) {            domobj = tabDom[i];            this.createComponent(domobj, false);            if (false) {                // catch the error if there is a pb with the dataSource                try {                    this.createComponent(domobj, false);                } catch (e) {                    // TODO change alert on a kind of Error                    if (typeof console !== 'undefined' && 'log' in console) {                        console.log('There is an error with the tag of id ' + domobj.id, e);                    } else {                        alert('You have an error with the tag of id ' + domobj.id + '\r\nerror: ' + e.message);                    }                }            }        }        // resolve the source        for (var e in dataSourceList)  {            source = dataSourceList[e];            privateData = source._private;            if (source.mustResolveOnFirstLevel()) {                source.resolveSource();                if (false) {                    // catch the error if there is a pb with the dataSource                    try {                        source.resolveSource();                    } catch (e) {                        // TODO change alert on a kind of Error                        if (typeof console !== 'undefined' && 'log' in console) {                            console.log('There is an error with the datasource of id ' + privateData.id, e);                        } else {                            alert('There is an error with the datasource of id ' + privateData.id + '\r\nerror: ' + e.message);                        }                    }                }            }        }    },    /**     * Create the widget or the datasource from the DOM     *     * @static     * @method createComponent     * @param {Object} domObj DOM object     * @param {Boolean} isDataSource true if the component a dataSource (false by default)     * @return {WAF.Widget|WAF.DataSource|Null}     **/    createComponent: function createComponent(domObj, isDataSource) {        var lib = '',        type = '',        nbAttributes = {},        attributeName = '',        i = 0,        definition = null,        config = {},        elt = {},        eltStyle = {},        value = '',        component = null,        widget = WAF.config.widget,        sID = '';        if (isDataSource === undefined || isDataSource === null) {            isDataSource = false;        }        // create the factory        lib = domObj.getAttribute('data-lib');        lib = lib || 'WAF';        // find the component definition        // and create the component        type = domObj.getAttribute('data-type');        type = type || '';        if (!isDataSource && type !== 'dataSource') {            // initializing columns names and attributes            if (domObj.getAttribute('data-column-name')) {                config['data-column-name'] = domObj.getAttribute('data-column-name');            }            if (domObj.getAttribute('data-column-attribute')) {                config['data-column-attribute'] = domObj.getAttribute('data-column-attribute');            }            if (domObj.getAttribute('data-column-width')) {                config['data-column-width'] = domObj.getAttribute('data-column-width');            }            if (widget[lib] && widget[lib][type]) {                definition = widget[lib][type];                // create the config                for (i = 0, nbAttributes = definition.attributes.length; i < nbAttributes; i++) {                    attributeName = definition.attributes[i].name;                    value = domObj.getAttribute(attributeName);                    if (value && value.replace) {                        value = value.replace(/&quot;/g, '"');                    }                    config[attributeName] = value;                }                // force getting the mandatory attribute                attributeName = 'id';                config[attributeName] = domObj.getAttribute(attributeName);                attributeName = 'data-type';                config[attributeName] = domObj.getAttribute(attributeName);                attributeName = 'data-lib';                config[attributeName] = domObj.getAttribute(attributeName);                attributeName = 'data-hideonload';                config[attributeName] = domObj.getAttribute(attributeName);                // creation of the component                component = definition.onInit(config);                elt = document.getElementById(config.id);                if (elt) {                    eltStyle = elt.style;                    if (eltStyle.borderWidth && config['data-type'].match(new RegExp('(^button$)|(^textField$)'))) {                        eltStyle.width = parseInt(eltStyle.width, 10) + (parseInt(eltStyle.borderWidth, 10) * 2) + 'px';                        eltStyle.height = parseInt(eltStyle.height, 10) + (parseInt(eltStyle.borderWidth, 10) * 2) + 'px';                    }                }                return component;            }        } else {            if (isDataSource && type === 'dataSource') {                definition = widget['WAF']['dataSource'];                // create the config                nbAttributes = definition.attributes.length;                for (i = 0; i < nbAttributes; i++) {                    attributeName = definition.attributes[i].name;                    config[attributeName] = domObj.getAttribute(attributeName);                }                // force getting the mandatory attribute                sID = domObj.getAttribute('data-id');                if (sID == null || sID == '') {                    attributeName = 'id';                    config[attributeName] = domObj.getAttribute(attributeName);                } else {                    config.id = sID;                }                attributeName = 'data-type';                config[attributeName] = domObj.getAttribute(attributeName);                attributeName = 'data-lib';                config[attributeName] = domObj.getAttribute(attributeName);                // creation of the component                component = definition.onInit(config);                // creation of the variable if dataSource variable                if (config['data-source-type'] == 'scalar') {                    switch (config['data-dataType']) {                        case 'number':                            if (typeof window[config.id] === 'undefined') {                                window[config.id] = 0;                            }                            break;                        case 'boolean':                            if (typeof window[config.id] === 'undefined') {                                window[config.id] = false;                            }                            break;                        case 'object':                            if (typeof window[config.id] === 'undefined') {                                window[config.id] = {};                            }                            break;                        case 'date':                            if (typeof window[config.id] === 'undefined') {                                window[config.id] = new Date();                            }                            break;                        default:                            if (typeof window[config.id] === 'undefined') {                                window[config.id] = '';                            }                            break;                    }                    return component;                }                if (config['data-source-type'] == 'object') {                    if (typeof window[config.id] === 'undefined') {                        window[config.id] = {};                    }                    return component;                }                if (config['data-source-type'] == 'array') {                    if (typeof window[config.id] === 'undefined') {                        window[config.id] = [];                    }                    return component;                }                if (config['data-source-type'] == 'date') {                    if (typeof window[config.id] === 'undefined') {                        window[config.id] = new Date();                    }                    return component;                }                return component;            }        }        return null;    },    /**     * Create the widget or the datasource from a framgment     *     * @static     * @method generate     * @param {String} id id of the element where to integrate the fragment     * @param {Boolean} includeItself do we have to genrate from the DOM id itself     * (otherwise it is from its children)     **/    generate : function generate(id, includeItself) {        var tabDom = [],        domobj = null,        domId = '',        domDataType = '',        domDataScope = '',        i = 0,        nbDom = 0,        container = $$(id),        source = null,        internalSources = {},        nbComponent = 0,        privateData = '',        position = 0,        tabDomBindings = [],        lstDomBindings = {},        binding = {},        dataSourceNameGlobalList = {},        components = [],        compManager = WAF.loader.componentsManager,        nbComponents = 0,        component = null;        if (typeof includeItself === 'undefined') {            includeItself = true;        }        var tabDomFirst = $('#' + id + '[data-type]');        tabDom = $('#' + id + ' [data-type]');        if (tabDomFirst.length != 0 && includeItself) {            tabDom.push(tabDomFirst[0]);        }        nbComponent = tabDom.length;        // create first the data source        for (i = 0; i < nbComponent; i++) {            domobj = tabDom[i];            domId = domobj.getAttribute('data-id');            domDataType = domobj.getAttribute('data-type');            domDataScope = domobj.getAttribute('data-scope');            if (sources && typeof (sources[domId]) === 'undefined' && domDataType === 'dataSource') {                if (domDataScope == 'global') {                    dataSourceNameGlobalList[domId] = domId;                }                source = this.createComponent(domobj, true);                internalSources[domId] = source;            } else {                if (sources && typeof (sources[domId]) !== 'undefined' && domDataType === 'dataSource') {                    internalSources[domId] = sources[domId];                }            }        }        // if some sources depends from others, need a second pass        WAF.dataSource.fullyInitAllSources();        // check if components need to be loaded        components = $('#' + id + ' [data-type=component]');        nbComponents = components.length;        if (nbComponents > 0) {            for (i = 0; i < nbComponents; i++) {                component = components[i];                // check if we need to load                if (component.getAttribute('data-start-load') == null || component.getAttribute('data-start-load') == 'true') {                    // check if we have a valid path                    if (component.getAttribute('data-path') != null && component.getAttribute('data-path') != '') {                        compManager.add();                    }                }            }        }        // create then the widget        for (i = 0, nbComponent; i < nbComponent; i++) {            domobj = tabDom[i];            this.createComponent(domobj, false);        }        // check for datasource in use in widgets        tabDomBindings = $('#' + id + ' [data-binding]');        nbDom = tabDomBindings.length;        for (i = 0; i < nbDom; i++) {            binding = tabDomBindings[i].getAttribute('data-binding');            if (binding) {                binding = binding.split('.')[0];                lstDomBindings[binding] = binding;            }        }        // resolve the source        for (var e in internalSources)  {            source = internalSources[e];            privateData = source._private;            position = source.getPosition();            if (lstDomBindings[source.getID()]) {                // catch the error if there is a pb with the dataSource                try {                    if (position >= 0) {                        if (source.select) {                            if (position > 0) {                                source.select(0);                            } else {                                source.select(1);                            }                        }                        if (dataSourceNameGlobalList[e]) {                            source.resolveSource();                        }                        if (source.select) {                            source.select(position);                        }                    } else {                        source.resolveSource();                    }                } catch (e) {                    // TODO change alert on a kind of Error                    if (typeof console !== 'undefined' && 'log' in console) {                        console.log('There is an error with the datasource of id ' + privateData.id, e);                    } else {                        alert('There is an error with the datasource of id ' + privateData.id + '\r\nerror: ' + e.message);                    }                }            }        }        // resizable        if (container && container.resizable && $('#'+ id).data('resizable') == true) {            container.resizable(true);        }        // draggable        if (container && container.resizable && $('#'+ id).data('draggable') == true) {            container.draggable(true);        }        //modal        if ($('#'+ id).data('modal') == true) {            $('#'+ id).css('z-index', '99999');            $('#'+ id).parent().append('<div id="waf-component-fade"></div>');            $('#waf-component-fade').css({                'filter': 'alpha(opacity=50)'            }).fadeIn();        }    }};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/jquery/jquery.min.js*//*! jQuery v1.7.1 jquery.com | jquery.org/license */(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/jquery-ui/jquery-ui.min.js*//*! * jQuery UI 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI */(function(a,b){function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;if(!b.href||!g||f.nodeName.toLowerCase()!=="map")return!1;h=a("img[usemap=#"+g+"]")[0];return!!h&&d(h)}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}a.ui=a.ui||{};a.ui.version||(a.extend(a.ui,{version:"1.8.17",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function h(b,c,d,f){a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)});return c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){if(c===b)return g["inner"+d].call(this);return this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){if(typeof b!="number")return g["outer"+d].call(this,b);return this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!!d&&!!a.element[0].parentNode)for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;if(b[d]>0)return!0;b[d]=1,e=b[d]>0,b[d]=0;return e},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))})(jQuery);/*! * jQuery UI Widget 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Widget */(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}});return d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e;if(f&&e.charAt(0)==="_")return h;f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b){h=f;return!1}}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))});return h}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}this._setOptions(e);return this},_setOptions:function(b){var c=this;a.each(b,function(a,b){c._setOption(a,b)});return this},_setOption:function(a,b){this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);this.element.trigger(c,d);return!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);/*! * jQuery UI Mouse 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Mouse * * Depends: *	jquery.ui.widget.js */(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent")){a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation();return!1}}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted){b.preventDefault();return!0}}!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0;return!0}},_mouseMove:function(b){if(a.browser.msie&&!(document.documentMode>=9)&&!b.button)return this._mouseUp(b);if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b));return!this._mouseStarted},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b));return!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);/* * jQuery UI Position 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Position */(function(a,b){a.ui=a.ui||{};var c=/left|center|right/,d=/top|center|bottom/,e="center",f={},g=a.fn.position,h=a.fn.offset;a.fn.position=function(b){if(!b||!b.of)return g.apply(this,arguments);b=a.extend({},b);var h=a(b.of),i=h[0],j=(b.collision||"flip").split(" "),k=b.offset?b.offset.split(" "):[0,0],l,m,n;i.nodeType===9?(l=h.width(),m=h.height(),n={top:0,left:0}):i.setTimeout?(l=h.width(),m=h.height(),n={top:h.scrollTop(),left:h.scrollLeft()}):i.preventDefault?(b.at="left top",l=m=0,n={top:b.of.pageY,left:b.of.pageX}):(l=h.outerWidth(),m=h.outerHeight(),n=h.offset()),a.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=c.test(a[0])?a.concat([e]):d.test(a[0])?[e].concat(a):[e,e]),a[0]=c.test(a[0])?a[0]:e,a[1]=d.test(a[1])?a[1]:e,b[this]=a}),j.length===1&&(j[1]=j[0]),k[0]=parseInt(k[0],10)||0,k.length===1&&(k[1]=k[0]),k[1]=parseInt(k[1],10)||0,b.at[0]==="right"?n.left+=l:b.at[0]===e&&(n.left+=l/2),b.at[1]==="bottom"?n.top+=m:b.at[1]===e&&(n.top+=m/2),n.left+=k[0],n.top+=k[1];return this.each(function(){var c=a(this),d=c.outerWidth(),g=c.outerHeight(),h=parseInt(a.curCSS(this,"marginLeft",!0))||0,i=parseInt(a.curCSS(this,"marginTop",!0))||0,o=d+h+(parseInt(a.curCSS(this,"marginRight",!0))||0),p=g+i+(parseInt(a.curCSS(this,"marginBottom",!0))||0),q=a.extend({},n),r;b.my[0]==="right"?q.left-=d:b.my[0]===e&&(q.left-=d/2),b.my[1]==="bottom"?q.top-=g:b.my[1]===e&&(q.top-=g/2),f.fractions||(q.left=Math.round(q.left),q.top=Math.round(q.top)),r={left:q.left-h,top:q.top-i},a.each(["left","top"],function(c,e){a.ui.position[j[c]]&&a.ui.position[j[c]][e](q,{targetWidth:l,targetHeight:m,elemWidth:d,elemHeight:g,collisionPosition:r,collisionWidth:o,collisionHeight:p,offset:k,my:b.my,at:b.at})}),a.fn.bgiframe&&c.bgiframe(),c.offset(a.extend(q,{using:b.using}))})},a.ui.position={fit:{left:function(b,c){var d=a(window),e=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft();b.left=e>0?b.left-e:Math.max(b.left-c.collisionPosition.left,b.left)},top:function(b,c){var d=a(window),e=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop();b.top=e>0?b.top-e:Math.max(b.top-c.collisionPosition.top,b.top)}},flip:{left:function(b,c){if(c.at[0]!==e){var d=a(window),f=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft(),g=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,h=c.at[0]==="left"?c.targetWidth:-c.targetWidth,i=-2*c.offset[0];b.left+=c.collisionPosition.left<0?g+h+i:f>0?g+h+i:0}},top:function(b,c){if(c.at[1]!==e){var d=a(window),f=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop(),g=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,h=c.at[1]==="top"?c.targetHeight:-c.targetHeight,i=-2*c.offset[1];b.top+=c.collisionPosition.top<0?g+h+i:f>0?g+h+i:0}}}},a.offset.setOffset||(a.offset.setOffset=function(b,c){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),e=d.offset(),f=parseInt(a.curCSS(b,"top",!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,h={top:c.top-e.top+f,left:c.left-e.left+g};"using"in c?c.using.call(b,h):d.css(h)},a.fn.offset=function(b){var c=this[0];if(!c||!c.ownerDocument)return null;if(b)return this.each(function(){a.offset.setOffset(this,b)});return h.call(this)}),function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d,e,g,h,i;d=document.createElement(b?"div":"body"),g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},b&&jQuery.extend(g,{position:"absolute",left:"-1000px",top:"-1000px"});for(var j in g)d.style[j]=g[j];d.appendChild(c),e=b||document.documentElement,e.insertBefore(d,e.firstChild),c.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",h=a(c).offset(function(a,b){return b}).offset(),d.innerHTML="",e.removeChild(d),i=h.top+h.left+(b?2e3:0),f.fractions=i>21&&i<22}()})(jQuery);/* * jQuery UI Draggable 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Draggables * * Depends: *	jquery.ui.core.js *	jquery.ui.mouse.js *	jquery.ui.widget.js */(function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!!this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy();return this}},_mouseCapture:function(b){var c=this.options;if(this.helper||c.disabled||a(b.target).is(".ui-resizable-handle"))return!1;this.handle=this._getHandle(b);if(!this.handle)return!1;c.iframeFix&&a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")});return!0},_mouseStart:function(b){var c=this.options;this.helper=this._createHelper(b),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment();if(this._trigger("start",b)===!1){this._clear();return!1}this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b);return!0},_mouseDrag:function(b,c){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1){this._mouseUp({});return!1}this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,b);return!1},_mouseStop:function(b){var c=!1;a.ui.ddmanager&&!this.options.dropBehaviour&&(c=a.ui.ddmanager.drop(this,b)),this.dropped&&(c=this.dropped,this.dropped=!1);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return!1;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var d=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){d._trigger("stop",b)!==!1&&d._clear()})}else this._trigger("stop",b)!==!1&&this._clear();return!1},_mouseUp:function(b){this.options.iframeFix===!0&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b);return a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?!0:!1;a(this.options.handle,this.element).find("*").andSelf().each(function(){this==b.target&&(c=!0)});return c},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo),d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute");return d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[b.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,b.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(b.containment=="document"?0:a(window).scrollLeft())+a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b.containment=="document"?0:a(window).scrollTop())+(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&b.containment.constructor!=Array){var c=a(b.containment),d=c[0];if(!d)return;var e=c.offset(),f=a(d).css("overflow")!="hidden";this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else b.containment.constructor==Array&&(this.containment=b.containment)},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){var h;if(this.containment){if(this.relative_container){var i=this.relative_container.offset();h=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]}else h=this.containment;b.pageX-this.offset.click.left<h[0]&&(f=h[0]+this.offset.click.left),b.pageY-this.offset.click.top<h[1]&&(g=h[1]+this.offset.click.top),b.pageX-this.offset.click.left>h[2]&&(f=h[2]+this.offset.click.left),b.pageY-this.offset.click.top>h[3]&&(g=h[3]+this.offset.click.top)}if(c.grid){var j=c.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;g=h?j-this.offset.click.top<h[1]||j-this.offset.click.top>h[3]?j-this.offset.click.top<h[1]?j+c.grid[1]:j-c.grid[1]:j:j;var k=c.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX;f=h?k-this.offset.click.left<h[0]||k-this.offset.click.left>h[2]?k-this.offset.click.left<h[0]?k+c.grid[0]:k-c.grid[0]:k:k}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),b=="drag"&&(this.positionAbs=this._convertPositionTo("absolute"));return a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.extend(a.ui.draggable,{version:"1.8.17"}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("draggable"),e=this,f=function(b){var c=this.offset.click.top,d=this.offset.click.left,e=this.positionAbs.top,f=this.positionAbs.left,g=b.height,h=b.width,i=b.top,j=b.left;return a.ui.isOver(e+c,f+d,i,j,g,h)};a.each(d.sortables,function(f){this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c){var d=a("body"),e=a(this).data("draggable").options;d.css("cursor")&&(e._cursor=d.css("cursor")),d.css("cursor",e.cursor)},stop:function(b,c){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(b,c){var d=a(this).data("draggable");d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"&&(d.overflowOffset=d.scrollParent.offset())},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=!1;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!="x")d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed);if(!e.axis||e.axis!="y")d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed)}else{if(!e.axis||e.axis!="x")b.pageY-a(document).scrollTop()<e.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<e.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed));if(!e.axis||e.axis!="y")b.pageX-a(document).scrollLeft()<e.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<e.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed))}f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c){var d=a(this).data("draggable"),e=d.options;d.snapElements=[],a(e.snap.constructor!=String?e.snap.items||":data(draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,h=g+d.helperProportions.width,i=c.offset.top,j=i+d.helperProportions.height;for(var k=d.snapElements.length-1;k>=0;k--){var l=d.snapElements[k].left,m=l+d.snapElements[k].width,n=d.snapElements[k].top,o=n+d.snapElements[k].height;if(!(l-f<g&&g<m+f&&n-f<i&&i<o+f||l-f<g&&g<m+f&&n-f<j&&j<o+f||l-f<h&&h<m+f&&n-f<i&&i<o+f||l-f<h&&h<m+f&&n-f<j&&j<o+f)){d.snapElements[k].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=!1;continue}if(e.snapMode!="inner"){var p=Math.abs(n-j)<=f,q=Math.abs(o-i)<=f,r=Math.abs(l-h)<=f,s=Math.abs(m-g)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n-d.helperProportions.height,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m}).left-d.margins.left)}var t=p||q||r||s;if(e.snapMode!="outer"){var p=Math.abs(n-i)<=f,q=Math.abs(o-j)<=f,r=Math.abs(l-g)<=f,s=Math.abs(m-h)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o-d.helperProportions.height,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m-d.helperProportions.width}).left-d.margins.left)}!d.snapElements[k].snapping&&(p||q||r||s||t)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=p||q||r||s||t}}}),a.ui.plugin.add("draggable","stack",{start:function(b,c){var d=a(this).data("draggable").options,e=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!!e.length){var f=parseInt(e[0].style.zIndex)||0;a(e).each(function(a){this.style.zIndex=f+a}),this[0].style.zIndex=f+e.length}}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);/* * jQuery UI Droppable 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Droppables * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js *	jquery.ui.mouse.js *	jquery.ui.draggable.js */(function(a,b){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var b=this.options,c=b.accept;this.isover=0,this.isout=1,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];for(var c=0;c<b.length;c++)b[c]==this&&b.splice(c,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(b,c){b=="accept"&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;!!c&&(c.currentItem||c.element)[0]!=this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;!!c&&(c.currentItem||c.element)[0]!=this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current;if(!d||(d.currentItem||d.element)[0]==this.element[0])return!1;var e=!1;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"droppable");if(b.options.greedy&&!b.options.disabled&&b.options.scope==d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance)){e=!0;return!1}});if(e)return!1;if(this.accept.call(this.element[0],d.currentItem||d.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d));return this.element}return!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.extend(a.ui.droppable,{version:"1.8.17"}),a.ui.intersect=function(b,c,d){if(!c.offset)return!1;var e=(b.positionAbs||b.position.absolute).left,f=e+b.helperProportions.width,g=(b.positionAbs||b.position.absolute).top,h=g+b.helperProportions.height,i=c.offset.left,j=i+c.proportions.width,k=c.offset.top,l=k+c.proportions.height;switch(d){case"fit":return i<=e&&f<=j&&k<=g&&h<=l;case"intersect":return i<e+b.helperProportions.width/2&&f-b.helperProportions.width/2<j&&k<g+b.helperProportions.height/2&&h-b.helperProportions.height/2<l;case"pointer":var m=(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,n=(b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,o=a.ui.isOver(n,m,k,i,c.proportions.height,c.proportions.width);return o;case"touch":return(g>=k&&g<=l||h>=k&&h<=l||g<k&&h>l)&&(e>=i&&e<=j||f>=i&&f<=j||e<i&&f>j);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d=a.ui.ddmanager.droppables[b.options.scope]||[],e=c?c.type:null,f=(b.currentItem||b.element).find(":data(droppable)").andSelf();droppablesLoop:for(var g=0;g<d.length;g++){if(d[g].options.disabled||b&&!d[g].accept.call(d[g].element[0],b.currentItem||b.element))continue;for(var h=0;h<f.length;h++)if(f[h]==d[g].element[0]){d[g].proportions.height=0;continue droppablesLoop}d[g].visible=d[g].element.css("display")!="none";if(!d[g].visible)continue;e=="mousedown"&&d[g]._activate.call(d[g],c),d[g].offset=d[g].element.offset(),d[g].proportions={width:d[g].element[0].offsetWidth,height:d[g].element[0].offsetHeight}}},drop:function(b,c){var d=!1;a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){!this.options||(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,c)))});return d},dragStart:function(b,c){b.element.parents(":not(body,html)").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var d=a.ui.intersect(b,this,this.options.tolerance),e=!d&&this.isover==1?"isout":d&&this.isover==0?"isover":null;if(!e)return;var f;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");g.length&&(f=a.data(g[0],"droppable"),f.greedyChild=e=="isover"?1:0)}f&&e=="isover"&&(f.isover=0,f.isout=1,f._out.call(f,c)),this[e]=1,this[e=="isout"?"isover":"isout"]=0,this[e=="isover"?"_over":"_out"].call(this,c),f&&e=="isout"&&(f.isout=0,f.isover=1,f._over.call(f,c))}})},dragStop:function(b,c){b.element.parents(":not(body,html)").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}})(jQuery);/* * jQuery UI Resizable 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Resizables * * Depends: *	jquery.ui.core.js *	jquery.ui.mouse.js *	jquery.ui.widget.js */(function(a,b){a.widget("ui.resizable",a.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var b=this,c=this.options;this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!c.aspectRatio,aspectRatio:c.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:c.helper||c.ghost||c.animate?c.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&a.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(a('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=c.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var d=this.handles.split(",");this.handles={};for(var e=0;e<d.length;e++){var f=a.trim(d[e]),g="ui-resizable-"+f,h=a('<div class="ui-resizable-handle '+g+'"></div>');/sw|se|ne|nw/.test(f)&&h.css({zIndex:++c.zIndex}),"se"==f&&h.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[f]=".ui-resizable-"+f,this.element.append(h)}}this._renderAxis=function(b){b=b||this.element;for(var c in this.handles){this.handles[c].constructor==String&&(this.handles[c]=a(this.handles[c],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var d=a(this.handles[c],this.element),e=0;e=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth();var f=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join("");b.css(f,e),this._proportionallyResize()}if(!a(this.handles[c]).length)continue}},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!b.resizing){if(this.className)var a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=a&&a[1]?a[1]:"se"}}),c.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").hover(function(){c.disabled||(a(this).removeClass("ui-resizable-autohide"),b._handles.show())},function(){c.disabled||b.resizing||(a(this).addClass("ui-resizable-autohide"),b._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var b=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){b(this.element);var c=this.element;c.after(this.originalElement.css({position:c.css("position"),width:c.outerWidth(),height:c.outerHeight(),top:c.css("top"),left:c.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle),b(this.originalElement);return this},_mouseCapture:function(b){var c=!1;for(var d in this.handles)a(this.handles[d])[0]==b.target&&(c=!0);return!this.options.disabled&&c},_mouseStart:function(b){var d=this.options,e=this.element.position(),f=this.element;this.resizing=!0,this.documentScroll={top:a(document).scrollTop(),left:a(document).scrollLeft()},(f.is(".ui-draggable")||/absolute/.test(f.css("position")))&&f.css({position:"absolute",top:e.top,left:e.left}),a.browser.opera&&/relative/.test(f.css("position"))&&f.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy();var g=c(this.helper.css("left")),h=c(this.helper.css("top"));d.containment&&(g+=a(d.containment).scrollLeft()||0,h+=a(d.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:g,top:h},this.size=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalSize=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalPosition={left:g,top:h},this.sizeDiff={width:f.outerWidth()-f.width(),height:f.outerHeight()-f.height()},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio=typeof d.aspectRatio=="number"?d.aspectRatio:this.originalSize.width/this.originalSize.height||1;var i=a(".ui-resizable-"+this.axis).css("cursor");a("body").css("cursor",i=="auto"?this.axis+"-resize":i),f.addClass("ui-resizable-resizing"),this._propagate("start",b);return!0},_mouseDrag:function(b){var c=this.helper,d=this.options,e={},f=this,g=this.originalMousePosition,h=this.axis,i=b.pageX-g.left||0,j=b.pageY-g.top||0,k=this._change[h];if(!k)return!1;var l=k.apply(this,[b,i,j]),m=a.browser.msie&&a.browser.version<7,n=this.sizeDiff;this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)l=this._updateRatio(l,b);l=this._respectSize(l,b),this._propagate("resize",b),c.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",b,this.ui());return!1},_mouseStop:function(b){this.resizing=!1;var c=this.options,d=this;if(this._helper){var e=this._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:d.sizeDiff.height,h=f?0:d.sizeDiff.width,i={width:d.helper.width()-h,height:d.helper.height()-g},j=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,k=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;c.animate||this.element.css(a.extend(i,{top:k,left:j})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()}a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove();return!1},_updateVirtualBoundaries:function(a){var b=this.options,c,e,f,g,h;h={minWidth:d(b.minWidth)?b.minWidth:0,maxWidth:d(b.maxWidth)?b.maxWidth:Infinity,minHeight:d(b.minHeight)?b.minHeight:0,maxHeight:d(b.maxHeight)?b.maxHeight:Infinity};if(this._aspectRatio||a)c=h.minHeight*this.aspectRatio,f=h.minWidth/this.aspectRatio,e=h.maxHeight*this.aspectRatio,g=h.maxWidth/this.aspectRatio,c>h.minWidth&&(h.minWidth=c),f>h.minHeight&&(h.minHeight=f),e<h.maxWidth&&(h.maxWidth=e),g<h.maxHeight&&(h.maxHeight=g);this._vBoundaries=h},_updateCache:function(a){var b=this.options;this.offset=this.helper.offset(),d(a.left)&&(this.position.left=a.left),d(a.top)&&(this.position.top=a.top),d(a.height)&&(this.size.height=a.height),d(a.width)&&(this.size.width=a.width)},_updateRatio:function(a,b){var c=this.options,e=this.position,f=this.size,g=this.axis;d(a.height)?a.width=a.height*this.aspectRatio:d(a.width)&&(a.height=a.width/this.aspectRatio),g=="sw"&&(a.left=e.left+(f.width-a.width),a.top=null),g=="nw"&&(a.top=e.top+(f.height-a.height),a.left=e.left+(f.width-a.width));return a},_respectSize:function(a,b){var c=this.helper,e=this._vBoundaries,f=this._aspectRatio||b.shiftKey,g=this.axis,h=d(a.width)&&e.maxWidth&&e.maxWidth<a.width,i=d(a.height)&&e.maxHeight&&e.maxHeight<a.height,j=d(a.width)&&e.minWidth&&e.minWidth>a.width,k=d(a.height)&&e.minHeight&&e.minHeight>a.height;j&&(a.width=e.minWidth),k&&(a.height=e.minHeight),h&&(a.width=e.maxWidth),i&&(a.height=e.maxHeight);var l=this.originalPosition.left+this.originalSize.width,m=this.position.top+this.size.height,n=/sw|nw|w/.test(g),o=/nw|ne|n/.test(g);j&&n&&(a.left=l-e.minWidth),h&&n&&(a.left=l-e.maxWidth),k&&o&&(a.top=m-e.minHeight),i&&o&&(a.top=m-e.maxHeight);var p=!a.width&&!a.height;p&&!a.left&&a.top?a.top=null:p&&!a.top&&a.left&&(a.left=null);return a},_proportionallyResize:function(){var b=this.options;if(!!this._proportionallyResizeElements.length){var c=this.helper||this.element;for(var d=0;d<this._proportionallyResizeElements.length;d++){var e=this._proportionallyResizeElements[d];if(!this.borderDif){var f=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],g=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];this.borderDif=a.map(f,function(a,b){var c=parseInt(a,10)||0,d=parseInt(g[b],10)||0;return c+d})}if(a.browser.msie&&(!!a(c).is(":hidden")||!!a(c).parents(":hidden").length))continue;e.css({height:c.height()-this.borderDif[0]-this.borderDif[2]||0,width:c.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset();if(this._helper){this.helper=this.helper||a('<div style="overflow:hidden;"></div>');var d=a.browser.msie&&a.browser.version<7,e=d?1:0,f=d?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+f,height:this.element.outerHeight()+f,position:"absolute",left:this.elementOffset.left-e+"px",top:this.elementOffset.top-e+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(a,b,c){return{width:this.originalSize.width+b}},w:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{left:f.left+b,width:e.width-b}},n:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{top:f.top+c,height:e.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),b!="resize"&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.extend(a.ui.resizable,{version:"1.8.17"}),a.ui.plugin.add("resizable","alsoResize",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=function(b){a(b).each(function(){var b=a(this);b.data("resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10),position:b.css("position")})})};typeof e.alsoResize=="object"&&!e.alsoResize.parentNode?e.alsoResize.length?(e.alsoResize=e.alsoResize[0],f(e.alsoResize)):a.each(e.alsoResize,function(a){f(a)}):f(e.alsoResize)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,e){a(b).each(function(){var b=a(this),f=a(this).data("resizable-alsoresize"),g={},i=e&&e.length?e:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(i,function(a,b){var c=(f[b]||0)+(h[b]||0);c&&c>=0&&(g[b]=c||null)}),a.browser.opera&&/relative/.test(b.css("position"))&&(d._revertToRelativePosition=!0,b.css({position:"absolute",top:"auto",left:"auto"})),b.css(g)})};typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?a.each(e.alsoResize,function(a,b){i(a,b)}):i(e.alsoResize)},stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=function(b){a(b).each(function(){var b=a(this);b.css({position:b.data("resizable-alsoresize").position})})};d._revertToRelativePosition&&(d._revertToRelativePosition=!1,typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?a.each(e.alsoResize,function(a){f(a)}):f(e.alsoResize)),a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","animate",{stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d._proportionallyResizeElements,g=f.length&&/textarea/i.test(f[0].nodeName),h=g&&a.ui.hasScroll(f[0],"left")?0:d.sizeDiff.height,i=g?0:d.sizeDiff.width,j={width:d.size.width-i,height:d.size.height-h},k=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;d.element.animate(a.extend(j,l&&k?{top:l,left:k}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var c={width:parseInt(d.element.css("width"),10),height:parseInt(d.element.css("height"),10),top:parseInt(d.element.css("top"),10),left:parseInt(d.element.css("left"),10)};f&&f.length&&a(f[0]).css({width:c.width,height:c.height}),d._updateCache(c),d._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(b,d){var e=a(this).data("resizable"),f=e.options,g=e.element,h=f.containment,i=h instanceof a?h.get(0):/parent/.test(h)?g.parent().get(0):h;if(!!i){e.containerElement=a(i);if(/document/.test(h)||h==document)e.containerOffset={left:0,top:0},e.containerPosition={left:0,top:0},e.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight};else{var j=a(i),k=[];a(["Top","Right","Left","Bottom"]).each(function(a,b){k[a]=c(j.css("padding"+b))}),e.containerOffset=j.offset(),e.containerPosition=j.position(),e.containerSize={height:j.innerHeight()-k[3],width:j.innerWidth()-k[1]};var l=e.containerOffset,m=e.containerSize.height,n=e.containerSize.width,o=a.ui.hasScroll(i,"left")?i.scrollWidth:n,p=a.ui.hasScroll(i)?i.scrollHeight:m;e.parentData={element:i,left:l.left,top:l.top,width:o,height:p}}}},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.containerSize,g=d.containerOffset,h=d.size,i=d.position,j=d._aspectRatio||b.shiftKey,k={top:0,left:0},l=d.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(k=g),i.left<(d._helper?g.left:0)&&(d.size.width=d.size.width+(d._helper?d.position.left-g.left:d.position.left-k.left),j&&(d.size.height=d.size.width/e.aspectRatio),d.position.left=e.helper?g.left:0),i.top<(d._helper?g.top:0)&&(d.size.height=d.size.height+(d._helper?d.position.top-g.top:d.position.top),j&&(d.size.width=d.size.height*e.aspectRatio),d.position.top=d._helper?g.top:0),d.offset.left=d.parentData.left+d.position.left,d.offset.top=d.parentData.top+d.position.top;var m=Math.abs((d._helper?d.offset.left-k.left:d.offset.left-k.left)+d.sizeDiff.width),n=Math.abs((d._helper?d.offset.top-k.top:d.offset.top-g.top)+d.sizeDiff.height),o=d.containerElement.get(0)==d.element.parent().get(0),p=/relative|absolute/.test(d.containerElement.css("position"));o&&p&&(m-=d.parentData.left),m+d.size.width>=d.parentData.width&&(d.size.width=d.parentData.width-m,j&&(d.size.height=d.size.width/d.aspectRatio)),n+d.size.height>=d.parentData.height&&(d.size.height=d.parentData.height-n,j&&(d.size.width=d.size.height*d.aspectRatio))},stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.position,g=d.containerOffset,h=d.containerPosition,i=d.containerElement,j=a(d.helper),k=j.offset(),l=j.outerWidth()-d.sizeDiff.width,m=j.outerHeight()-d.sizeDiff.height;d._helper&&!e.animate&&/relative/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m}),d._helper&&!e.animate&&/static/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m})}}),a.ui.plugin.add("resizable","ghost",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size;d.ghost=d.originalElement.clone(),d.ghost.css({opacity:.25,display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof e.ghost=="string"?e.ghost:""),d.ghost.appendTo(d.helper)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.ghost.css({position:"relative",height:d.size.height,width:d.size.width})},stop:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.helper&&d.helper.get(0).removeChild(d.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size,g=d.originalSize,h=d.originalPosition,i=d.axis,j=e._aspectRatio||b.shiftKey;e.grid=typeof e.grid=="number"?[e.grid,e.grid]:e.grid;var k=Math.round((f.width-g.width)/(e.grid[0]||1))*(e.grid[0]||1),l=Math.round((f.height-g.height)/(e.grid[1]||1))*(e.grid[1]||1);/^(se|s|e)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l):/^(ne)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l):/^(sw)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.left=h.left-k):(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l,d.position.left=h.left-k)}});var c=function(a){return parseInt(a,10)||0},d=function(a){return!isNaN(parseInt(a,10))}})(jQuery);/* * jQuery UI Selectable 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Selectables * * Depends: *	jquery.ui.core.js *	jquery.ui.mouse.js *	jquery.ui.widget.js */(function(a,b){a.widget("ui.selectable",a.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var b=this;this.element.addClass("ui-selectable"),this.dragged=!1;var c;this.refresh=function(){c=a(b.options.filter,b.element[0]),c.addClass("ui-selectee"),c.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=c.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy();return this},_mouseStart:function(b){var c=this;this.opos=[b.pageX,b.pageY];if(!this.options.disabled){var d=this.options;this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.clientX,top:b.clientY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,!b.metaKey&&!b.ctrlKey&&(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().andSelf().each(function(){var d=a.data(this,"selectable-item");if(d){var e=!b.metaKey&&!b.ctrlKey||!d.$element.hasClass("ui-selected");d.$element.removeClass(e?"ui-unselecting":"ui-selected").addClass(e?"ui-selecting":"ui-unselecting"),d.unselecting=!e,d.selecting=e,d.selected=e,e?c._trigger("selecting",b,{selecting:d.element}):c._trigger("unselecting",b,{unselecting:d.element});return!1}})}},_mouseDrag:function(b){var c=this;this.dragged=!0;if(!this.options.disabled){var d=this.options,e=this.opos[0],f=this.opos[1],g=b.pageX,h=b.pageY;if(e>g){var i=g;g=e,e=i}if(f>h){var i=h;h=f,f=i}this.helper.css({left:e,top:f,width:g-e,height:h-f}),this.selectees.each(function(){var i=a.data(this,"selectable-item");if(!!i&&i.element!=c.element[0]){var j=!1;d.tolerance=="touch"?j=!(i.left>g||i.right<e||i.top>h||i.bottom<f):d.tolerance=="fit"&&(j=i.left>e&&i.right<g&&i.top>f&&i.bottom<h),j?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,c._trigger("selecting",b,{selecting:i.element}))):(i.selecting&&((b.metaKey||b.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),c._trigger("unselecting",b,{unselecting:i.element}))),i.selected&&!b.metaKey&&!b.ctrlKey&&!i.startselected&&(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,c._trigger("unselecting",b,{unselecting:i.element})))}});return!1}},_mouseStop:function(b){var c=this;this.dragged=!1;var d=this.options;a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove();return!1}}),a.extend(a.ui.selectable,{version:"1.8.17"})})(jQuery);/* * jQuery UI Sortable 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Sortables * * Depends: *	jquery.ui.core.js *	jquery.ui.mouse.js *	jquery.ui.widget.js */(function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this,g=a(b.target).parents().each(function(){if(a.data(this,d.widgetName+"-item")==f){e=a(this);return!1}});a.data(b.target,d.widgetName+"-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var h=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(h=!0)});if(!h)return!1}this.currentItem=e,this._removeCurrentsFromItems();return!0},_mouseStart:function(b,c,d){var e=this.options,f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!d)for(var g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",b,f._uiHash(this));a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b);return!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(!h)continue;if(g!=this.currentItem[0]&&this.placeholder[h==1?"next":"prev"]()[0]!=g&&!a.ui.contains(this.placeholder[0],g)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],g):!0)){this.direction=h==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f))this._rearrange(b,f);else break;this._trigger("change",b,this._uiHash());break}}this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(b,c){if(!!b){a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var d=this,e=d.placeholder.offset();d.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-d.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-d.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem));return this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"=");return d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")});return d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();if(!e)return!1;return this.floating?g&&g=="right"||f=="down"?2:1:f&&(f=="down"?2:1)},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&d||f=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){this._refreshItems(a),this.refreshPositions();return this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=this,d=[],e=[],f=this._connectWith();if(f&&b)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&e.push([a.isFunction(j.options.items)?j.options.items.call(j.element):a(j.options.items,j.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),j])}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var g=e.length-1;g>=0;g--)e[g][0].each(function(){d.push(this)});return a(d)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");for(var b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=this,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}}for(var g=e.length-1;g>=0;g--){var k=e[g][1],l=e[g][0];for(var i=0,m=l.length;i<m;i++){var n=a(l[i]);n.data(this.widgetName+"-item",k),c.push({item:n,instance:k,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance!=this.currentContainer&&this.currentContainer&&d.item[0]!=this.currentItem[0])continue;var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){var c=b||this,d=c.options;if(!d.placeholder||d.placeholder.constructor==String){var e=d.placeholder;d.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(e||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];e||(b.style.visibility="hidden");return b},update:function(a,b){if(!e||!!d.forcePlaceholderSize)b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),d.placeholder.update(c,c.placeholder)},_contactContainers:function(b){var c=null,d=null;for(var e=this.containers.length-1;e>=0;e--){if(a.ui.contains(this.currentItem[0],this.containers[e].element[0]))continue;if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.ui.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0)}if(!!c)if(this.containers.length===1)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else if(this.currentContainer!=this.containers[d]){var f=1e4,g=null,h=this.positionAbs[this.containers[d].floating?"left":"top"];for(var i=this.items.length-1;i>=0;i--){if(!a.ui.contains(this.containers[d].element[0],this.items[i].item[0]))continue;var j=this.items[i][this.containers[d].floating?"left":"top"];Math.abs(j-h)<f&&(f=Math.abs(j-h),g=this.items[i])}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(d[0].style.width==""||c.forceHelperSize)&&d.width(this.currentItem.width()),(d[0].style.height==""||c.forceHelperSize)&&d.height(this.currentItem.height());return d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition){this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top));if(c.grid){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var d=[],e=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&d.push(function(a){this._trigger("update",a,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||d.push(function(a){this._trigger("remove",a,this._uiHash())});for(var f=this.containers.length-1;f>=0;f--)a.ui.contains(this.containers[f].element[0],this.currentItem[0])&&!c&&(d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.containers[f])),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.containers[f])))}for(var f=this.containers.length-1;f>=0;f--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}this.fromOutside=!1;return!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.17"})})(jQuery);/* * jQuery UI Accordion 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Accordion * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js */(function(a,b){a.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var b=this,c=b.options;b.running=0,b.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix"),b.headers=b.element.find(c.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){c.disabled||a(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){c.disabled||a(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){c.disabled||a(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){c.disabled||a(this).removeClass("ui-state-focus")}),b.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(c.navigation){var d=b.element.find("a").filter(c.navigationFilter).eq(0);if(d.length){var e=d.closest(".ui-accordion-header");e.length?b.active=e:b.active=d.closest(".ui-accordion-content").prev()}}b.active=b._findActive(b.active||c.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),b.active.next().addClass("ui-accordion-content-active"),b._createIcons(),b.resize(),b.element.attr("role","tablist"),b.headers.attr("role","tab").bind("keydown.accordion",function(a){return b._keydown(a)}).next().attr("role","tabpanel"),b.headers.not(b.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide(),b.active.length?b.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):b.headers.eq(0).attr("tabIndex",0),a.browser.safari||b.headers.find("a").attr("tabIndex",-1),c.event&&b.headers.bind(c.event.split(" ").join(".accordion ")+".accordion",function(a){b._clickHandler.call(b,a,this),a.preventDefault()})},_createIcons:function(){var b=this.options;b.icons&&(a("<span></span>").addClass("ui-icon "+b.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(b.icons.header).toggleClass(b.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove(),this.element.removeClass("ui-accordion-icons")},destroy:function(){var b=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex"),this.headers.find("a").removeAttr("tabIndex"),this._destroyIcons();var c=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");(b.autoHeight||b.fillHeight)&&c.css("height","");return a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),b=="active"&&this.activate(c),b=="icons"&&(this._destroyIcons(),c&&this._createIcons()),b=="disabled"&&this.headers.add(this.headers.next())[c?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(b){if(!(this.options.disabled||b.altKey||b.ctrlKey)){var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._clickHandler({target:b.target},b.target),b.preventDefault()}if(f){a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus();return!1}return!0}},resize:function(){var b=this.options,c;if(b.fillSpace){if(a.browser.msie){var d=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}c=this.element.parent().height(),a.browser.msie&&this.element.parent().css("overflow",d),this.headers.each(function(){c-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")}else b.autoHeight&&(c=0,this.headers.next().each(function(){c=Math.max(c,a(this).height("").height())}).height(c));return this},activate:function(a){this.options.active=a;var b=this._findActive(a)[0];this._clickHandler({target:b},b);return this},_findActive:function(b){return b?typeof b=="number"?this.headers.filter(":eq("+b+")"):this.headers.not(this.headers.not(b)):b===!1?a([]):this.headers.filter(":eq(0)")},_clickHandler:function(b,c){var d=this.options;if(!d.disabled){if(!b.target){if(!d.collapsible)return;this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header),this.active.next().addClass("ui-accordion-content-active");var e=this.active.next(),f={options:d,newHeader:a([]),oldHeader:d.active,newContent:a([]),oldContent:e},g=this.active=a([]);this._toggle(g,e,f);return}var h=a(b.currentTarget||c),i=h[0]===this.active[0];d.active=d.collapsible&&i?!1:this.headers.index(h);if(this.running||!d.collapsible&&i)return;var j=this.active,g=h.next(),e=this.active.next(),f={options:d,newHeader:i&&d.collapsible?a([]):h,oldHeader:this.active,newContent:i&&d.collapsible?a([]):g,oldContent:e},k=this.headers.index(this.active[0])>this.headers.index(h[0]);this.active=i?a([]):h,this._toggle(g,e,f,i,k),j.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header),i||(h.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(d.icons.header).addClass(d.icons.headerSelected),h.next().addClass("ui-accordion-content-active"));return}},_toggle:function(b,c,d,e,f){var g=this,h=g.options;g.toShow=b,g.toHide=c,g.data=d;var i=function(){if(!!g)return g._completed.apply(g,arguments)};g._trigger("changestart",null,g.data),g.running=c.size()===0?b.size():c.size();if(h.animated){var j={};h.collapsible&&e?j={toShow:a([]),toHide:c,complete:i,down:f,autoHeight:h.autoHeight||h.fillSpace}:j={toShow:b,toHide:c,complete:i,down:f,autoHeight:h.autoHeight||h.fillSpace},h.proxied||(h.proxied=h.animated),h.proxiedDuration||(h.proxiedDuration=h.duration),h.animated=a.isFunction(h.proxied)?h.proxied(j):h.proxied,h.duration=a.isFunction(h.proxiedDuration)?h.proxiedDuration(j):h.proxiedDuration;var k=a.ui.accordion.animations,l=h.duration,m=h.animated;m&&!k[m]&&!a.easing[m]&&(m="slide"),k[m]||(k[m]=function(a){this.slide(a,{easing:m,duration:l||700})}),k[m](j)}else h.collapsible&&e?b.toggle():(c.hide(),b.show()),i(!0);c.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur(),b.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(a){this.running=a?0:--this.running;this.running||(this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data))}}),a.extend(a.ui.accordion,{version:"1.8.17",animations:{slide:function(b,c){b=a.extend({easing:"swing",duration:300},b,c);if(!b.toHide.size())b.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},b);else{if(!b.toShow.size()){b.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},b);return}var d=b.toShow.css("overflow"),e=0,f={},g={},h=["height","paddingTop","paddingBottom"],i,j=b.toShow;i=j[0].style.width,j.width(j.parent().width()-parseFloat(j.css("paddingLeft"))-parseFloat(j.css("paddingRight"))-(parseFloat(j.css("borderLeftWidth"))||0)-(parseFloat(j.css("borderRightWidth"))||0)),a.each(h,function(c,d){g[d]="hide";var e=(""+a.css(b.toShow[0],d)).match(/^([\d+-.]+)(.*)$/);f[d]={value:e[1],unit:e[2]||"px"}}),b.toShow.css({height:0,overflow:"hidden"}).show(),b.toHide.filter(":hidden").each(b.complete).end().filter(":visible").animate(g,{step:function(a,c){c.prop=="height"&&(e=c.end-c.start===0?0:(c.now-c.start)/(c.end-c.start)),b.toShow[0].style[c.prop]=e*f[c.prop].value+f[c.prop].unit},duration:b.duration,easing:b.easing,complete:function(){b.autoHeight||b.toShow.css("height",""),b.toShow.css({width:i,overflow:d}),b.complete()}})}},bounceslide:function(a){this.slide(a,{easing:a.down?"easeOutBounce":"swing",duration:a.down?1e3:200})}}})})(jQuery);/* * jQuery UI Autocomplete 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Autocomplete * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js *	jquery.ui.position.js */(function(a,b){var c=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var b=this,c=this.element[0].ownerDocument,d;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(c){if(!b.options.disabled&&!b.element.propAttr("readOnly")){d=!1;var e=a.ui.keyCode;switch(c.keyCode){case e.PAGE_UP:b._move("previousPage",c);break;case e.PAGE_DOWN:b._move("nextPage",c);break;case e.UP:b._move("previous",c),c.preventDefault();break;case e.DOWN:b._move("next",c),c.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:b.menu.active&&(d=!0,c.preventDefault());case e.TAB:if(!b.menu.active)return;b.menu.select(c);break;case e.ESCAPE:b.element.val(b.term),b.close(c);break;default:clearTimeout(b.searching),b.searching=setTimeout(function(){b.term!=b.element.val()&&(b.selectedItem=null,b.search(null,c))},b.options.delay)}}}).bind("keypress.autocomplete",function(a){d&&(d=!1,a.preventDefault())}).bind("focus.autocomplete",function(){b.options.disabled||(b.selectedItem=null,b.previous=b.element.val())}).bind("blur.autocomplete",function(a){b.options.disabled||(clearTimeout(b.searching),b.closing=setTimeout(function(){b.close(a),b._change(a)},150))}),this._initSource(),this.response=function(){return b._response.apply(b,arguments)},this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",c)[0]).mousedown(function(c){var d=b.menu.element[0];a(c.target).closest(".ui-menu-item").length||setTimeout(function(){a(document).one("mousedown",function(c){c.target!==b.element[0]&&c.target!==d&&!a.ui.contains(d,c.target)&&b.close()})},1),setTimeout(function(){clearTimeout(b.closing)},13)}).menu({focus:function(a,c){var d=c.item.data("item.autocomplete");!1!==b._trigger("focus",a,{item:d})&&/^key/.test(a.originalEvent.type)&&b.element.val(d.value)},selected:function(a,d){var e=d.item.data("item.autocomplete"),f=b.previous;b.element[0]!==c.activeElement&&(b.element.focus(),b.previous=f,setTimeout(function(){b.previous=f,b.selectedItem=e},1)),!1!==b._trigger("select",a,{item:e})&&b.element.val(e.value),b.term=b.element.val(),b.close(a),b.selectedItem=e},blur:function(a,c){b.menu.element.is(":visible")&&b.element.val()!==b.term&&b.element.val(b.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),a.fn.bgiframe&&this.menu.element.bgiframe(),b.beforeunloadHandler=function(){b.element.removeAttr("autocomplete")},a(window).bind("beforeunload",b.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),a(window).unbind("beforeunload",this.beforeunloadHandler),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),b==="source"&&this._initSource(),b==="appendTo"&&this.menu.element.appendTo(a(c||"body",this.element[0].ownerDocument)[0]),b==="disabled"&&c&&this.xhr&&this.xhr.abort()},_initSource:function(){var b=this,d,e;a.isArray(this.options.source)?(d=this.options.source,this.source=function(b,c){c(a.ui.autocomplete.filter(d,b.term))}):typeof this.options.source=="string"?(e=this.options.source,this.source=function(d,f){b.xhr&&b.xhr.abort(),b.xhr=a.ajax({url:e,data:d,dataType:"json",autocompleteRequest:++c,success:function(a,b){this.autocompleteRequest===c&&f(a)},error:function(){this.autocompleteRequest===c&&f([])}})}):this.source=this.options.source},search:function(a,b){a=a!=null?a:this.element.val(),this.term=this.element.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(this._trigger("search",b)!==!1)return this._search(a)},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:a},this.response)},_response:function(a){!this.options.disabled&&a&&a.length?(a=this._normalize(a),this._suggest(a),this._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(a){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",a))},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){if(b.length&&b[0].label&&b[0].value)return b;return a.map(b,function(b){if(typeof b=="string")return{label:b,value:b};return a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(b){var c=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(c,b),this.menu.deactivate(),this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new a.Event("mouseover"))},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItem(b,c)})},_renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append(a("<a></a>").text(c.label)).appendTo(b)},_move:function(a,b){if(!this.menu.element.is(":visible"))this.search(null,b);else{if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a)){this.element.val(this.term),this.menu.deactivate();return}this.menu[a](b)}},widget:function(){return this.menu.element}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}})})(jQuery),function(a){a.widget("ui.menu",{_create:function(){var b=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){!a(c.target).closest(".ui-menu-item a").length||(c.preventDefault(),b.select(c))}),this.refresh()},refresh:function(){var b=this,c=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");c.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(c){b.activate(c,a(this).parent())}).mouseleave(function(){b.deactivate()})},activate:function(a,b){this.deactivate();if(this.hasScroll()){var c=b.offset().top-this.element.offset().top,d=this.element.scrollTop(),e=this.element.height();c<0?this.element.scrollTop(d+c):c>=e&&this.element.scrollTop(d+c-e+b.height())}this.active=b.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",a,{item:b})},deactivate:function(){!this.active||(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(a){this.move("next",".ui-menu-item:first",a)},previous:function(a){this.move("prev",".ui-menu-item:last",a)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(a,b,c){if(!this.active)this.activate(c,this.element.children(b));else{var d=this.active[a+"All"](".ui-menu-item").eq(0);d.length?this.activate(c,d):this.activate(c,this.element.children(b))}},nextPage:function(b){if(this.hasScroll()){if(!this.active||this.last()){this.activate(b,this.element.children(".ui-menu-item:first"));return}var c=this.active.offset().top,d=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c-d+a(this).height();return b<10&&b>-10});e.length||(e=this.element.children(".ui-menu-item:last")),this.activate(b,e)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(b){if(this.hasScroll()){if(!this.active||this.first()){this.activate(b,this.element.children(".ui-menu-item:last"));return}var c=this.active.offset().top,d=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c+d-a(this).height();return b<10&&b>-10}),result.length||(result=this.element.children(".ui-menu-item:first")),this.activate(b,result)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(a){this._trigger("selected",a,{item:this.active})}})}(jQuery);/* * jQuery UI Button 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Button * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js */(function(a,b){var c,d,e,f,g="ui-button ui-widget ui-state-default ui-corner-all",h="ui-state-hover ui-state-active ",i="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",j=function(){var b=a(this).find(":ui-button");setTimeout(function(){b.button("refresh")},1)},k=function(b){var c=b.name,d=b.form,e=a([]);c&&(d?e=a(d).find("[name='"+c+"']"):e=a("[name='"+c+"']",b.ownerDocument).filter(function(){return!this.form}));return e};a.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",j),typeof this.options.disabled!="boolean"&&(this.options.disabled=this.element.propAttr("disabled")),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var b=this,h=this.options,i=this.type==="checkbox"||this.type==="radio",l="ui-state-hover"+(i?"":" ui-state-active"),m="ui-state-focus";h.label===null&&(h.label=this.buttonElement.html()),this.element.is(":disabled")&&(h.disabled=!0),this.buttonElement.addClass(g).attr("role","button").bind("mouseenter.button",function(){h.disabled||(a(this).addClass("ui-state-hover"),this===c&&a(this).addClass("ui-state-active"))}).bind("mouseleave.button",function(){h.disabled||a(this).removeClass(l)}).bind("click.button",function(a){h.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this.element.bind("focus.button",function(){b.buttonElement.addClass(m)}).bind("blur.button",function(){b.buttonElement.removeClass(m)}),i&&(this.element.bind("change.button",function(){f||b.refresh()}),this.buttonElement.bind("mousedown.button",function(a){h.disabled||(f=!1,d=a.pageX,e=a.pageY)}).bind("mouseup.button",function(a){!h.disabled&&(d!==a.pageX||e!==a.pageY)&&(f=!0)})),this.type==="checkbox"?this.buttonElement.bind("click.button",function(){if(h.disabled||f)return!1;a(this).toggleClass("ui-state-active"),b.buttonElement.attr("aria-pressed",b.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click.button",function(){if(h.disabled||f)return!1;a(this).addClass("ui-state-active"),b.buttonElement.attr("aria-pressed","true");var c=b.element[0];k(c).not(c).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){if(h.disabled)return!1;a(this).addClass("ui-state-active"),c=this,a(document).one("mouseup",function(){c=null})}).bind("mouseup.button",function(){if(h.disabled)return!1;a(this).removeClass("ui-state-active")}).bind("keydown.button",function(b){if(h.disabled)return!1;(b.keyCode==a.ui.keyCode.SPACE||b.keyCode==a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active")}).bind("keyup.button",function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",h.disabled),this._resetButton()},_determineButtonType:function(){this.element.is(":checkbox")?this.type="checkbox":this.element.is(":radio")?this.type="radio":this.element.is("input")?this.type="input":this.type="button";if(this.type==="checkbox"||this.type==="radio"){var a=this.element.parents().filter(":last"),b="label[for='"+this.element.attr("id")+"']";this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible");var c=this.element.is(":checked");c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",c)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(g+" "+h+" "+i).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments);b==="disabled"?c?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1):this._resetButton()},refresh:function(){var b=this.element.is(":disabled");b!==this.options.disabled&&this._setOption("disabled",b),this.type==="radio"?k(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var b=this.buttonElement.removeClass(i),c=a("<span></span>",this.element[0].ownerDocument).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",c))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}}),a.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(b,c){b==="disabled"&&this.buttons.button("option",b,c),a.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var b=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),a.Widget.prototype.destroy.call(this)}})})(jQuery);/* * jQuery UI Dialog 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Dialog * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js *  jquery.ui.button.js *	jquery.ui.draggable.js *	jquery.ui.mouse.js *	jquery.ui.position.js *	jquery.ui.resizable.js */(function(a,b){var c="ui-dialog ui-widget ui-widget-content ui-corner-all ",d={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},e={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},f=a.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0};a.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var b=this,d=b.options,e=d.title||"&#160;",f=a.ui.dialog.getTitleId(b.element),g=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass(c+d.dialogClass).css({zIndex:d.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(c){d.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(a){b.moveToTop(!1,a)}),h=b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(g),i=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(g),j=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){j.addClass("ui-state-hover")},function(){j.removeClass("ui-state-hover")}).focus(function(){j.addClass("ui-state-focus")}).blur(function(){j.removeClass("ui-state-focus")}).click(function(a){b.close(a);return!1}).appendTo(i),k=(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(d.closeText).appendTo(j),l=a("<span></span>").addClass("ui-dialog-title").attr("id",f).html(e).prependTo(i);a.isFunction(d.beforeclose)&&!a.isFunction(d.beforeClose)&&(d.beforeClose=d.beforeclose),i.find("*").add(i).disableSelection(),d.draggable&&a.fn.draggable&&b._makeDraggable(),d.resizable&&a.fn.resizable&&b._makeResizable(),b._createButtons(d.buttons),b._isOpen=!1,a.fn.bgiframe&&g.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var a=this;a.overlay&&a.overlay.destroy(),a.uiDialog.hide(),a.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),a.uiDialog.remove(),a.originalTitle&&a.element.attr("title",a.originalTitle);return a},widget:function(){return this.uiDialog},close:function(b){var c=this,d,e;if(!1!==c._trigger("beforeClose",b)){c.overlay&&c.overlay.destroy(),c.uiDialog.unbind("keypress.ui-dialog"),c._isOpen=!1,c.options.hide?c.uiDialog.hide(c.options.hide,function(){c._trigger("close",b)}):(c.uiDialog.hide(),c._trigger("close",b)),a.ui.dialog.overlay.resize(),c.options.modal&&(d=0,a(".ui-dialog").each(function(){this!==c.uiDialog[0]&&(e=a(this).css("z-index"),isNaN(e)||(d=Math.max(d,e)))}),a.ui.dialog.maxZ=d);return c}},isOpen:function(){return this._isOpen},moveToTop:function(b,c){var d=this,e=d.options,f;if(e.modal&&!b||!e.stack&&!e.modal)return d._trigger("focus",c);e.zIndex>a.ui.dialog.maxZ&&(a.ui.dialog.maxZ=e.zIndex),d.overlay&&(a.ui.dialog.maxZ+=1,d.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)),f={scrollTop:d.element.scrollTop(),scrollLeft:d.element.scrollLeft()},a.ui.dialog.maxZ+=1,d.uiDialog.css("z-index",a.ui.dialog.maxZ),d.element.attr(f),d._trigger("focus",c);return d},open:function(){if(!this._isOpen){var b=this,c=b.options,d=b.uiDialog;b.overlay=c.modal?new a.ui.dialog.overlay(b):null,b._size(),b._position(c.position),d.show(c.show),b.moveToTop(!0),c.modal&&d.bind("keydown.ui-dialog",function(b){if(b.keyCode===a.ui.keyCode.TAB){var c=a(":tabbable",this),d=c.filter(":first"),e=c.filter(":last");if(b.target===e[0]&&!b.shiftKey){d.focus(1);return!1}if(b.target===d[0]&&b.shiftKey){e.focus(1);return!1}}}),a(b.element.find(":tabbable").get().concat(d.find(".ui-dialog-buttonpane :tabbable").get().concat(d.get()))).eq(0).focus(),b._isOpen=!0,b._trigger("open");return b}},_createButtons:function(b){var c=this,d=!1,e=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),g=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);c.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof b=="object"&&b!==null&&a.each(b,function(){return!(d=!0)}),d&&(a.each(b,function(b,d){d=a.isFunction(d)?{click:d,text:b}:d;var e=a('<button type="button"></button>').click(function(){d.click.apply(c.element[0],arguments)}).appendTo(g);a.each(d,function(a,b){a!=="click"&&(a in f?e[a](b):e.attr(a,b))}),a.fn.button&&e.button()}),e.appendTo(c.uiDialog))},_makeDraggable:function(){function f(a){return{position:a.position,offset:a.offset}}var b=this,c=b.options,d=a(document),e;b.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,g){e=c.height==="auto"?"auto":a(this).height(),a(this).height(a(this).height()).addClass("ui-dialog-dragging"),b._trigger("dragStart",d,f(g))},drag:function(a,c){b._trigger("drag",a,f(c))},stop:function(g,h){c.position=[h.position.left-d.scrollLeft(),h.position.top-d.scrollTop()],a(this).removeClass("ui-dialog-dragging").height(e),b._trigger("dragStop",g,f(h)),a.ui.dialog.overlay.resize()}})},_makeResizable:function(c){function h(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}c=c===b?this.options.resizable:c;var d=this,e=d.options,f=d.uiDialog.css("position"),g=typeof c=="string"?c:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:d._minHeight(),handles:g,start:function(b,c){a(this).addClass("ui-dialog-resizing"),d._trigger("resizeStart",b,h(c))},resize:function(a,b){d._trigger("resize",a,h(b))},stop:function(b,c){a(this).removeClass("ui-dialog-resizing"),e.height=a(this).height(),e.width=a(this).width(),d._trigger("resizeStop",b,h(c)),a.ui.dialog.overlay.resize()}}).css("position",f).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return a.height==="auto"?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(b){var c=[],d=[0,0],e;if(b){if(typeof b=="string"||typeof b=="object"&&"0"in b)c=b.split?b.split(" "):[b[0],b[1]],c.length===1&&(c[1]=c[0]),a.each(["left","top"],function(a,b){+c[a]===c[a]&&(d[a]=c[a],c[a]=b)}),b={my:c.join(" "),at:c.join(" "),offset:d.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},b)),e||this.uiDialog.hide()},_setOptions:function(b){var c=this,f={},g=!1;a.each(b,function(a,b){c._setOption(a,b),a in d&&(g=!0),a in e&&(f[a]=b)}),g&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",f)},_setOption:function(b,d){var e=this,f=e.uiDialog;switch(b){case"beforeclose":b="beforeClose";break;case"buttons":e._createButtons(d);break;case"closeText":e.uiDialogTitlebarCloseText.text(""+d);break;case"dialogClass":f.removeClass(e.options.dialogClass).addClass(c+d);break;case"disabled":d?f.addClass("ui-dialog-disabled"):f.removeClass("ui-dialog-disabled");break;case"draggable":var g=f.is(":data(draggable)");g&&!d&&f.draggable("destroy"),!g&&d&&e._makeDraggable();break;case"position":e._position(d);break;case"resizable":var h=f.is(":data(resizable)");h&&!d&&f.resizable("destroy"),h&&typeof d=="string"&&f.resizable("option","handles",d),!h&&d!==!1&&e._makeResizable(d);break;case"title":a(".ui-dialog-title",e.uiDialogTitlebar).html(""+(d||"&#160;"))}a.Widget.prototype._setOption.apply(e,arguments)},_size:function(){var b=this.options,c,d,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),b.minWidth>b.width&&(b.width=b.minWidth),c=this.uiDialog.css({height:"auto",width:b.width}).height(),d=Math.max(0,b.minHeight-c);if(b.height==="auto")if(a.support.minHeight)this.element.css({minHeight:d,height:"auto"});else{this.uiDialog.show();var f=this.element.css("height","auto").height();e||this.uiDialog.hide(),this.element.height(Math.max(f,d))}else this.element.height(Math.max(b.height-c,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),a.extend(a.ui.dialog,{version:"1.8.17",uuid:0,maxZ:0,getTitleId:function(a){var b=a.attr("id");b||(this.uuid+=1,b=this.uuid);return"ui-dialog-title-"+b},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}}),a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(a){return a+".dialog-overlay"}).join(" "),create:function(b){this.instances.length===0&&(setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return!1})},1),a(document).bind("keydown.dialog-overlay",function(c){b.options.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}),a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize));var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});a.fn.bgiframe&&c.bgiframe(),this.instances.push(c);return c},destroy:function(b){var c=a.inArray(b,this.instances);c!=-1&&this.oldInstances.push(this.instances.splice(c,1)[0]),this.instances.length===0&&a([document,window]).unbind(".dialog-overlay"),b.remove();var d=0;a.each(this.instances,function(){d=Math.max(d,this.css("z-index"))}),this.maxZ=d},height:function(){var b,c;if(a.browser.msie&&a.browser.version<7){b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return b<c?a(window).height()+"px":b+"px"}return a(document).height()+"px"},width:function(){var b,c;if(a.browser.msie){b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return b<c?a(window).width()+"px":b+"px"}return a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)}),b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}}),a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);/* * jQuery UI Slider 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Slider * * Depends: *	jquery.ui.core.js *	jquery.ui.mouse.js *	jquery.ui.widget.js */(function(a,b){var c=5;a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=d.values&&d.values.length||1,h=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(d.disabled?" ui-slider-disabled ui-disabled":"")),this.range=a([]),d.range&&(d.range===!0&&(d.values||(d.values=[this._valueMin(),this._valueMin()]),d.values.length&&d.values.length!==2&&(d.values=[d.values[0],d.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(d.range==="min"||d.range==="max"?" ui-slider-range-"+d.range:"")));for(var i=e.length;i<g;i+=1)h.push(f);this.handles=e.add(a(h.join("")).appendTo(b.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){d.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){d.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")}),this.handles.each(function(b){a(this).data("index.ui-slider-handle",b)}),this.handles.keydown(function(d){var e=!0,f=a(this).data("index.ui-slider-handle"),g,h,i,j;if(!b.options.disabled){switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:e=!1;if(!b._keySliding){b._keySliding=!0,a(this).addClass("ui-state-active"),g=b._start(d,f);if(g===!1)return}}j=b.options.step,b.options.values&&b.options.values.length?h=i=b.values(f):h=i=b.value();switch(d.keyCode){case a.ui.keyCode.HOME:i=b._valueMin();break;case a.ui.keyCode.END:i=b._valueMax();break;case a.ui.keyCode.PAGE_UP:i=b._trimAlignValue(h+(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.PAGE_DOWN:i=b._trimAlignValue(h-(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(h===b._valueMax())return;i=b._trimAlignValue(h+j);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(h===b._valueMin())return;i=b._trimAlignValue(h-j)}b._slide(d,f,i);return e}}).keyup(function(c){var d=a(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,d),b._change(c,d),a(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy();return this},_mouseCapture:function(b){var c=this.options,d,e,f,g,h,i,j,k,l;if(c.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),d={x:b.pageX,y:b.pageY},e=this._normValueFromMouse(d),f=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(b){var c=Math.abs(e-h.values(b));f>c&&(f=c,g=a(this),i=b)}),c.range===!0&&this.values(1)===c.min&&(i+=1,g=a(this.handles[i])),j=this._start(b,i);if(j===!1)return!1;this._mouseSliding=!0,h._handleIndex=i,g.addClass("ui-state-active").focus(),k=g.offset(),l=!a(b.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:b.pageX-k.left-g.width()/2,top:b.pageY-k.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,i,e),this._animateOff=!0;return!0},_mouseStart:function(a){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);this._slide(a,this._handleIndex,c);return!1},_mouseStop:function(a){this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1;return!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;this.orientation==="horizontal"?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),this.orientation==="vertical"&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e;return this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());return this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),this.options.values.length===2&&this.options.range===!0&&(b===0&&c>d||b===1&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("change",a,c)}},value:function(a){if(arguments.length)this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0);else return this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b);else{if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();d=this.options.values,e=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()}},_setOption:function(b,c){var d,e=0;a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var a=this.options.value;a=this._trimAlignValue(a);return a},_values:function(a){var b,c,d;if(arguments.length){b=this.options.values[a],b=this._trimAlignValue(b);return b}c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;Math.abs(c)*2>=b&&(d+=c>0?b:-b);return parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b=this.options.range,c=this.options,d=this,e=this._animateOff?!1:c.animate,f,g={},h,i,j,k;this.options.values&&this.options.values.length?this.handles.each(function(b,i){f=(d.values(b)-d._valueMin())/(d._valueMax()-d._valueMin())*100,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",a(this).stop(1,1)[e?"animate":"css"](g,c.animate),d.options.range===!0&&(d.orientation==="horizontal"?(b===0&&d.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({width:f-h+"%"},{queue:!1,duration:c.animate})):(b===0&&d.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({height:f-h+"%"},{queue:!1,duration:c.animate}))),h=f}):(i=this.value(),j=this._valueMin(),k=this._valueMax(),f=k!==j?(i-j)/(k-j)*100:0,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](g,c.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},c.animate),b==="max"&&this.orientation==="horizontal"&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},c.animate),b==="max"&&this.orientation==="vertical"&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}}),a.extend(a.ui.slider,{version:"1.8.17"})})(jQuery);/* * jQuery UI Tabs 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Tabs * * Depends: *	jquery.ui.core.js *	jquery.ui.widget.js */(function(a,b){function f(){return++d}function e(){return++c}var c=0,d=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(a,b){if(a=="selected"){if(this.options.collapsible&&b==this.options.selected)return;this.select(b)}else this.options[a]=b,this._tabify()},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+e()},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+f());return a.cookie.apply(null,[b].concat(a.makeArray(arguments)))},_ui:function(a,b){return{tab:a,panel:b,index:this.anchors.index(a)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var b=a(this);b.html(b.data("label.tabs")).removeData("label.tabs")})},_tabify:function(c){function m(b,c){b.css("display",""),!a.support.opacity&&c.opacity&&b[0].style.removeAttribute("filter")}var d=this,e=this.options,f=/^#.+/;this.list=this.element.find("ol,ul").eq(0),this.lis=a(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return a("a",this)[0]}),this.panels=a([]),this.anchors.each(function(b,c){var g=a(c).attr("href"),h=g.split("#")[0],i;h&&(h===location.toString().split("#")[0]||(i=a("base")[0])&&h===i.href)&&(g=c.hash,c.href=g);if(f.test(g))d.panels=d.panels.add(d.element.find(d._sanitizeSelector(g)));else if(g&&g!=="#"){a.data(c,"href.tabs",g),a.data(c,"load.tabs",g.replace(/#.*$/,""));var j=d._tabId(c);c.href="#"+j;var k=d.element.find("#"+j);k.length||(k=a(e.panelTemplate).attr("id",j).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(d.panels[b-1]||d.list),k.data("destroy.tabs",!0)),d.panels=d.panels.add(k)}else e.disabled.push(b)}),c?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),e.selected===b?(location.hash&&this.anchors.each(function(a,b){if(b.hash==location.hash){e.selected=a;return!1}}),typeof e.selected!="number"&&e.cookie&&(e.selected=parseInt(d._cookie(),10)),typeof e.selected!="number"&&this.lis.filter(".ui-tabs-selected").length&&(e.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))),e.selected=e.selected||(this.lis.length?0:-1)):e.selected===null&&(e.selected=-1),e.selected=e.selected>=0&&this.anchors[e.selected]||e.selected<0?e.selected:0,e.disabled=a.unique(e.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(a,b){return d.lis.index(a)}))).sort(),a.inArray(e.selected,e.disabled)!=-1&&e.disabled.splice(a.inArray(e.selected,e.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),e.selected>=0&&this.anchors.length&&(d.element.find(d._sanitizeSelector(d.anchors[e.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(e.selected).addClass("ui-tabs-selected ui-state-active"),d.element.queue("tabs",function(){d._trigger("show",null,d._ui(d.anchors[e.selected],d.element.find(d._sanitizeSelector(d.anchors[e.selected].hash))[0]))}),this.load(e.selected)),a(window).bind("unload",function(){d.lis.add(d.anchors).unbind(".tabs"),d.lis=d.anchors=d.panels=null})):e.selected=this.lis.index(this.lis.filter(".ui-tabs-selected")),this.element[e.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible"),e.cookie&&this._cookie(e.selected,e.cookie);for(var g=0,h;h=this.lis[g];g++)a(h)[a.inArray(g,e.disabled)!=-1&&!a(h).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");e.cache===!1&&this.anchors.removeData("cache.tabs"),this.lis.add(this.anchors).unbind(".tabs");if(e.event!=="mouseover"){var i=function(a,b){b.is(":not(.ui-state-disabled)")&&b.addClass("ui-state-"+a)},j=function(a,b){b.removeClass("ui-state-"+a)};this.lis.bind("mouseover.tabs",function(){i("hover",a(this))}),this.lis.bind("mouseout.tabs",function(){j("hover",a(this))}),this.anchors.bind("focus.tabs",function(){i("focus",a(this).closest("li"))}),this.anchors.bind("blur.tabs",function(){j("focus",a(this).closest("li"))})}var k,l;e.fx&&(a.isArray(e.fx)?(k=e.fx[0],l=e.fx[1]):k=l=e.fx);var n=l?function(b,c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active"),c.hide().removeClass("ui-tabs-hide").animate(l,l.duration||"normal",function(){m(c,l),d._trigger("show",null,d._ui(b,c[0]))})}:function(b,c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active"),c.removeClass("ui-tabs-hide"),d._trigger("show",null,d._ui(b,c[0]))},o=k?function(a,b){b.animate(k,k.duration||"normal",function(){d.lis.removeClass("ui-tabs-selected ui-state-active"),b.addClass("ui-tabs-hide"),m(b,k),d.element.dequeue("tabs")})}:function(a,b,c){d.lis.removeClass("ui-tabs-selected ui-state-active"),b.addClass("ui-tabs-hide"),d.element.dequeue("tabs")};this.anchors.bind(e.event+".tabs",function(){var b=this,c=a(b).closest("li"),f=d.panels.filter(":not(.ui-tabs-hide)"),g=d.element.find(d._sanitizeSelector(b.hash));if(c.hasClass("ui-tabs-selected")&&!e.collapsible||c.hasClass("ui-state-disabled")||c.hasClass("ui-state-processing")||d.panels.filter(":animated").length||d._trigger("select",null,d._ui(this,g[0]))===!1){this.blur();return!1}e.selected=d.anchors.index(this),d.abort();if(e.collapsible){if(c.hasClass("ui-tabs-selected")){e.selected=-1,e.cookie&&d._cookie(e.selected,e.cookie),d.element.queue("tabs",function(){o(b,f)}).dequeue("tabs"),this.blur();return!1}if(!f.length){e.cookie&&d._cookie(e.selected,e.cookie),d.element.queue("tabs",function(){n(b,g)}),d.load(d.anchors.index(this)),this.blur();return!1}}e.cookie&&d._cookie(e.selected,e.cookie);if(g.length)f.length&&d.element.queue("tabs",function(){o(b,f)}),d.element.queue("tabs",function(){n(b,g)}),d.load(d.anchors.index(this));else throw"jQuery UI Tabs: Mismatching fragment identifier.";a.browser.msie&&this.blur()}),this.anchors.bind("click.tabs",function(){return!1})},_getIndex:function(a){typeof a=="string"&&(a=this.anchors.index(this.anchors.filter("[href$="+a+"]")));return a},destroy:function(){var b=this.options;this.abort(),this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.each(function(){var b=a.data(this,"href.tabs");b&&(this.href=b);var c=a(this).unbind(".tabs");a.each(["href","load","cache"],function(a,b){c.removeData(b+".tabs")})}),this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?a(this).remove():a(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "))}),b.cookie&&this._cookie(null,b.cookie);return this},add:function(c,d,e){e===b&&(e=this.anchors.length);var f=this,g=this.options,h=a(g.tabTemplate.replace(/#\{href\}/g,c).replace(/#\{label\}/g,d)),i=c.indexOf("#")?this._tabId(a("a",h)[0]):c.replace("#","");h.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var j=f.element.find("#"+i);j.length||(j=a(g.panelTemplate).attr("id",i).data("destroy.tabs",!0)),j.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),e>=this.lis.length?(h.appendTo(this.list),j.appendTo(this.list[0].parentNode)):(h.insertBefore(this.lis[e]),j.insertBefore(this.panels[e])),g.disabled=a.map(g.disabled,function(a,b){return a>=e?++a:a}),this._tabify(),this.anchors.length==1&&(g.selected=0,h.addClass("ui-tabs-selected ui-state-active"),j.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){f._trigger("show",null,f._ui(f.anchors[0],f.panels[0]))}),this.load(0)),this._trigger("add",null,this._ui(this.anchors[e],this.panels[e]));return this},remove:function(b){b=this._getIndex(b);var c=this.options,d=this.lis.eq(b).remove(),e=this.panels.eq(b).remove();d.hasClass("ui-tabs-selected")&&this.anchors.length>1&&this.select(b+(b+1<this.anchors.length?1:-1)),c.disabled=a.map(a.grep(c.disabled,function(a,c){return a!=b}),function(a,c){return a>=b?--a:a}),this._tabify(),this._trigger("remove",null,this._ui(d.find("a")[0],e[0]));return this},enable:function(b){b=this._getIndex(b);var c=this.options;if(a.inArray(b,c.disabled)!=-1){this.lis.eq(b).removeClass("ui-state-disabled"),c.disabled=a.grep(c.disabled,function(a,c){return a!=b}),this._trigger("enable",null,this._ui(this.anchors[b],this.panels[b]));return this}},disable:function(a){a=this._getIndex(a);var b=this,c=this.options;a!=c.selected&&(this.lis.eq(a).addClass("ui-state-disabled"),c.disabled.push(a),c.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[a],this.panels[a])));return this},select:function(a){a=this._getIndex(a);if(a==-1)if(this.options.collapsible&&this.options.selected!=-1)a=this.options.selected;else return this;this.anchors.eq(a).trigger(this.options.event+".tabs");return this},load:function(b){b=this._getIndex(b);var c=this,d=this.options,e=this.anchors.eq(b)[0],f=a.data(e,"load.tabs");this.abort();if(!f||this.element.queue("tabs").length!==0&&a.data(e,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(b).addClass("ui-state-processing");if(d.spinner){var g=a("span",e);g.data("label.tabs",g.html()).html(d.spinner)}this.xhr=a.ajax(a.extend({},d.ajaxOptions,{url:f,success:function(f,g){c.element.find(c._sanitizeSelector(e.hash)).html(f),c._cleanup(),d.cache&&a.data(e,"cache.tabs",!0),c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.success(f,g)}catch(h){}},error:function(a,f,g){c._cleanup(),c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.error(a,f,b,e)}catch(g){}}})),c.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]),this.panels.stop(!1,!0),this.element.queue("tabs",this.element.queue("tabs").splice(-2,2)),this.xhr&&(this.xhr.abort(),delete this.xhr),this._cleanup();return this},url:function(a,b){this.anchors.eq(a).removeData("cache.tabs").data("load.tabs",b);return this},length:function(){return this.anchors.length}}),a.extend(a.ui.tabs,{version:"1.8.17"}),a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(a,b){var c=this,d=this.options,e=c._rotate||(c._rotate=function(b){clearTimeout(c.rotation),c.rotation=setTimeout(function(){var a=d.selected;c.select(++a<c.anchors.length?a:0)},a),b&&b.stopPropagation()}),f=c._unrotate||(c._unrotate=b?function(a){t=d.selected,e()}:function(a){a.clientX&&c.rotate(null)});a?(this.element.bind("tabsshow",e),this.anchors.bind(d.event+".tabs",f),e()):(clearTimeout(c.rotation),this.element.unbind("tabsshow",e),this.anchors.unbind(d.event+".tabs",f),delete this._rotate,delete this._unrotate);return this}})})(jQuery);/* * jQuery UI Datepicker 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Datepicker * * Depends: *	jquery.ui.core.js */(function($,undefined){function isArray(a){return a&&($.browser.safari&&typeof a=="object"&&a.length||a.constructor&&a.constructor.toString().match(/\Array\(\)/))}function extendRemove(a,b){$.extend(a,b);for(var c in b)if(b[c]==null||b[c]==undefined)a[c]=b[c];return a}function bindHover(a){var b="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return a.bind("mouseout",function(a){var c=$(a.target).closest(b);!c.length||c.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(c){var d=$(c.target).closest(b);!$.datepicker._isDisabledDatepicker(instActive.inline?a.parent()[0]:instActive.input[0])&&!!d.length&&(d.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),d.addClass("ui-state-hover"),d.hasClass("ui-datepicker-prev")&&d.addClass("ui-datepicker-prev-hover"),d.hasClass("ui-datepicker-next")&&d.addClass("ui-datepicker-next-hover"))})}function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}$.extend($.ui,{datepicker:{version:"1.8.17"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){extendRemove(this._defaults,a||{});return this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(a,b){var c=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:c,input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:b?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(a,b){var c=$(a);b.append=$([]),b.trigger=$([]);c.hasClass(this.markerClassName)||(this._attachments(c,b),c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),this._autoSize(b),$.data(a,PROP_NAME,b),b.settings.disabled&&this._disableDatepicker(a))},_attachments:function(a,b){var c=this._get(b,"appendText"),d=this._get(b,"isRTL");b.append&&b.append.remove(),c&&(b.append=$('<span class="'+this._appendClass+'">'+c+"</span>"),a[d?"before":"after"](b.append)),a.unbind("focus",this._showDatepicker),b.trigger&&b.trigger.remove();var e=this._get(b,"showOn");(e=="focus"||e=="both")&&a.focus(this._showDatepicker);if(e=="button"||e=="both"){var f=this._get(b,"buttonText"),g=this._get(b,"buttonImage");b.trigger=$(this._get(b,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:g,alt:f,title:f}):$('<button type="button"></button>').addClass(this._triggerClass).html(g==""?f:$("<img/>").attr({src:g,alt:f,title:f}))),a[d?"before":"after"](b.trigger),b.trigger.click(function(){$.datepicker._datepickerShowing&&$.datepicker._lastInput==a[0]?$.datepicker._hideDatepicker():$.datepicker._showDatepicker(a[0]);return!1})}},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var d=function(a){var b=0,c=0;for(var d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};b.setMonth(d(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort"))),b.setDate(d(this._get(a,c.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,b){var c=$(a);c.hasClass(this.markerClassName)||(c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),$.data(a,PROP_NAME,b),this._setDate(b,this._getDefaultDate(b),!0),this._updateDatepicker(b),this._updateAlternate(b),b.settings.disabled&&this._disableDatepicker(a),b.dpDiv.css("display","block"))},_dialogDatepicker:function(a,b,c,d,e){var f=this._dialogInst;if(!f){this.uuid+=1;var g="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+g+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),f=this._dialogInst=this._newInst(this._dialogInput,!1),f.settings={},$.data(this._dialogInput[0],PROP_NAME,f)}extendRemove(f.settings,d||{}),b=b&&b.constructor==Date?this._formatDate(f,b):b,this._dialogInput.val(b),this._pos=e?e.length?e:[e.pageX,e.pageY]:null;if(!this._pos){var h=document.documentElement.clientWidth,i=document.documentElement.clientHeight,j=document.documentElement.scrollLeft||document.body.scrollLeft,k=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[h/2-100+j,i/2-150+k]}this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),f.settings.onSelect=c,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,f);return this},_destroyDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!!b.hasClass(this.markerClassName)){var d=a.nodeName.toLowerCase();$.removeData(a,PROP_NAME),d=="input"?(c.append.remove(),c.trigger.remove(),b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(d=="div"||d=="span")&&b.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!!b.hasClass(this.markerClassName)){var d=a.nodeName.toLowerCase();if(d=="input")a.disabled=!1,c.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(d=="div"||d=="span"){var e=b.children("."+this._inlineClass);e.children().removeClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(b){return b==a?null:b})}},_disableDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!!b.hasClass(this.markerClassName)){var d=a.nodeName.toLowerCase();if(d=="input")a.disabled=!0,c.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(d=="div"||d=="span"){var e=b.children("."+this._inlineClass);e.children().addClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(b){return b==a?null:b}),this._disabledInputs[this._disabledInputs.length]=a}},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_getInst:function(a){try{return $.data(a,PROP_NAME)}catch(b){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(a,b,c){var d=this._getInst(a);if(arguments.length==2&&typeof b=="string")return b=="defaults"?$.extend({},$.datepicker._defaults):d?b=="all"?$.extend({},d.settings):this._get(d,b):null;var e=b||{};typeof b=="string"&&(e={},e[b]=c);if(d){this._curInst==d&&this._hideDatepicker();var f=this._getDateDatepicker(a,!0),g=this._getMinMaxDate(d,"min"),h=this._getMinMaxDate(d,"max");extendRemove(d.settings,e),g!==null&&e.dateFormat!==undefined&&e.minDate===undefined&&(d.settings.minDate=this._formatDate(d,g)),h!==null&&e.dateFormat!==undefined&&e.maxDate===undefined&&(d.settings.maxDate=this._formatDate(d,h)),this._attachments($(a),d),this._autoSize(d),this._setDate(d,f),this._updateAlternate(d),this._updateDatepicker(d)}},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){var b=this._getInst(a);b&&this._updateDatepicker(b)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);c&&!c.inline&&this._setDateFromField(c,b);return c?this._getDate(c):null},_doKeyDown:function(a){var b=$.datepicker._getInst(a.target),c=!0,d=b.dpDiv.is(".ui-datepicker-rtl");b._keyEvent=!0;if($.datepicker._datepickerShowing)switch(a.keyCode){case 9:$.datepicker._hideDatepicker(),c=!1;break;case 13:var e=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",b.dpDiv);e[0]&&$.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,e[0]);var f=$.datepicker._get(b,"onSelect");if(f){var g=$.datepicker._formatDate(b);f.apply(b.input?b.input[0]:null,[g,b])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(a.target,a.ctrlKey?-$.datepicker._get(b,"stepBigMonths"):-$.datepicker._get(b,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(a.target,a.ctrlKey?+$.datepicker._get(b,"stepBigMonths"):+$.datepicker._get(b,"stepMonths"),"M");break;case 35:(a.ctrlKey||a.metaKey)&&$.datepicker._clearDate(a.target),c=a.ctrlKey||a.metaKey;break;case 36:(a.ctrlKey||a.metaKey)&&$.datepicker._gotoToday(a.target),c=a.ctrlKey||a.metaKey;break;case 37:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,d?1:-1,"D"),c=a.ctrlKey||a.metaKey,a.originalEvent.altKey&&$.datepicker._adjustDate(a.target,a.ctrlKey?-$.datepicker._get(b,"stepBigMonths"):-$.datepicker._get(b,"stepMonths"),"M");break;case 38:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,-7,"D"),c=a.ctrlKey||a.metaKey;break;case 39:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,d?-1:1,"D"),c=a.ctrlKey||a.metaKey,a.originalEvent.altKey&&$.datepicker._adjustDate(a.target,a.ctrlKey?+$.datepicker._get(b,"stepBigMonths"):+$.datepicker._get(b,"stepMonths"),"M");break;case 40:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,7,"D"),c=a.ctrlKey||a.metaKey;break;default:c=!1}else a.keyCode==36&&a.ctrlKey?$.datepicker._showDatepicker(this):c=!1;c&&(a.preventDefault(),a.stopPropagation())},_doKeyPress:function(a){var b=$.datepicker._getInst(a.target);if($.datepicker._get(b,"constrainInput")){var c=$.datepicker._possibleChars($.datepicker._get(b,"dateFormat")),d=String.fromCharCode(a.charCode==undefined?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||d<" "||!c||c.indexOf(d)>-1}},_doKeyUp:function(a){var b=$.datepicker._getInst(a.target);if(b.input.val()!=b.lastVal)try{var c=$.datepicker.parseDate($.datepicker._get(b,"dateFormat"),b.input?b.input.val():null,$.datepicker._getFormatConfig(b));c&&($.datepicker._setDateFromField(b),$.datepicker._updateAlternate(b),$.datepicker._updateDatepicker(b))}catch(a){$.datepicker.log(a)}return!0},_showDatepicker:function(a){a=a.target||a,a.nodeName.toLowerCase()!="input"&&(a=$("input",a.parentNode)[0]);if(!$.datepicker._isDisabledDatepicker(a)&&$.datepicker._lastInput!=a){var b=$.datepicker._getInst(a);$.datepicker._curInst&&$.datepicker._curInst!=b&&($.datepicker._curInst.dpDiv.stop(!0,!0),b&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var c=$.datepicker._get(b,"beforeShow"),d=c?c.apply(a,[a,b]):{};if(d===!1)return;extendRemove(b.settings,d),b.lastVal=null,$.datepicker._lastInput=a,$.datepicker._setDateFromField(b),$.datepicker._inDialog&&(a.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(a),$.datepicker._pos[1]+=a.offsetHeight);var e=!1;$(a).parents().each(function(){e|=$(this).css("position")=="fixed";return!e}),e&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var f={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null,b.dpDiv.empty(),b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(b),f=$.datepicker._checkOffset(b,f,e),b.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":e?"fixed":"absolute",display:"none",left:f.left+"px",top:f.top+"px"});if(!b.inline){var g=$.datepicker._get(b,"showAnim"),h=$.datepicker._get(b,"duration"),i=function(){var a=b.dpDiv.find("iframe.ui-datepicker-cover");if(!!a.length){var c=$.datepicker._getBorders(b.dpDiv);a.css({left:-c[0],top:-c[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex($(a).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[g]?b.dpDiv.show(g,$.datepicker._get(b,"showOptions"),h,i):b.dpDiv[g||"show"](g?h:null,i),(!g||!h)&&i(),b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus(),$.datepicker._curInst=b}}},_updateDatepicker:function(a){var b=this;b.maxRows=4;var c=$.datepicker._getBorders(a.dpDiv);instActive=a,a.dpDiv.empty().append(this._generateHTML(a));var d=a.dpDiv.find("iframe.ui-datepicker-cover");!d.length||d.css({left:-c[0],top:-c[1],width:a.dpDiv.outerWidth(),height:a.dpDiv.outerHeight()}),a.dpDiv.find("."+this._dayOverClass+" a").mouseover();var e=this._getNumberOfMonths(a),f=e[1],g=17;a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),f>1&&a.dpDiv.addClass("ui-datepicker-multi-"+f).css("width",g*f+"em"),a.dpDiv[(e[0]!=1||e[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),a==$.datepicker._curInst&&$.datepicker._datepickerShowing&&a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&a.input[0]!=document.activeElement&&a.input.focus();if(a.yearshtml){var h=a.yearshtml;setTimeout(function(){h===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml),h=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+$(document).scrollLeft(),i=document.documentElement.clientHeight+$(document).scrollTop();b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0);return b},_findPos:function(a){var b=this._getInst(a),c=this._get(b,"isRTL");while(a&&(a.type=="hidden"||a.nodeType!=1||$.expr.filters.hidden(a)))a=a[c?"previousSibling":"nextSibling"];var d=$(a).offset();return[d.left,d.top]},_hideDatepicker:function(a){var b=this._curInst;if(!(!b||a&&b!=$.data(a,PROP_NAME))&&this._datepickerShowing){var c=this._get(b,"showAnim"),d=this._get(b,"duration"),e=this,f=function(){$.datepicker._tidyDialog(b),e._curInst=null};$.effects&&$.effects[c]?b.dpDiv.hide(c,$.datepicker._get(b,"showOptions"),d,f):b.dpDiv[c=="slideDown"?"slideUp":c=="fadeIn"?"fadeOut":"hide"](c?d:null,f),c||f(),this._datepickerShowing=!1;var g=this._get(b,"onClose");g&&g.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(a){if(!!$.datepicker._curInst){var b=$(a.target),c=$.datepicker._getInst(b[0]);(b[0].id!=$.datepicker._mainDivId&&b.parents("#"+$.datepicker._mainDivId).length==0&&!b.hasClass($.datepicker.markerClassName)&&!b.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||b.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=c)&&$.datepicker._hideDatepicker()}},_adjustDate:function(a,b,c){var d=$(a),e=this._getInst(d[0]);this._isDisabledDatepicker(d[0])||(this._adjustInstDate(e,b+(c=="M"?this._get(e,"showCurrentAtPos"):0),c),this._updateDatepicker(e))},_gotoToday:function(a){var b=$(a),c=this._getInst(b[0]);if(this._get(c,"gotoCurrent")&&c.currentDay)c.selectedDay=c.currentDay,c.drawMonth=c.selectedMonth=c.currentMonth,c.drawYear=c.selectedYear=c.currentYear;else{var d=new Date;c.selectedDay=d.getDate(),c.drawMonth=c.selectedMonth=d.getMonth(),c.drawYear=c.selectedYear=d.getFullYear()}this._notifyChange(c),this._adjustDate(b)},_selectMonthYear:function(a,b,c){var d=$(a),e=this._getInst(d[0]);e["selected"+(c=="M"?"Month":"Year")]=e["draw"+(c=="M"?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10),this._notifyChange(e),this._adjustDate(d)},_selectDay:function(a,b,c,d){var e=$(a);if(!$(d).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(e[0])){var f=this._getInst(e[0]);f.selectedDay=f.currentDay=$("a",d).html(),f.selectedMonth=f.currentMonth=b,f.selectedYear=f.currentYear=c,this._selectDate(a,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear))}},_clearDate:function(a){var b=$(a),c=this._getInst(b[0]);this._selectDate(b,"")},_selectDate:function(a,b){var c=$(a),d=this._getInst(c[0]);b=b!=null?b:this._formatDate(d),d.input&&d.input.val(b),this._updateAlternate(d);var e=this._get(d,"onSelect");e?e.apply(d.input?d.input[0]:null,[b,d]):d.input&&d.input.trigger("change"),d.inline?this._updateDatepicker(d):(this._hideDatepicker(),this._lastInput=d.input[0],typeof d.input[0]!="object"&&d.input.focus(),this._lastInput=null)},_updateAlternate:function(a){var b=this._get(a,"altField");if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),d=this._getDate(a),e=this.formatDate(c,d,this._getFormatConfig(a));$(b).each(function(){$(this).val(e)})}},noWeekends:function(a){var b=a.getDay();return[b>0&&b<6,""]},iso8601Week:function(a){var b=new Date(a.getTime());b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();b.setMonth(0),b.setDate(1);return Math.floor(Math.round((c-b)/864e5)/7)+1},parseDate:function(a,b,c){if(a==null||b==null)throw"Invalid arguments";b=typeof b=="object"?b.toString():b+"";if(b=="")return null;var d=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff;d=typeof d!="string"?d:(new Date).getFullYear()%100+parseInt(d,10);var e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,g=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,h=(c?c.monthNames:null)||this._defaults.monthNames,i=-1,j=-1,k=-1,l=-1,m=!1,n=function(b){var c=s+1<a.length&&a.charAt(s+1)==b;c&&s++;return c},o=function(a){var c=n(a),d=a=="@"?14:a=="!"?20:a=="y"&&c?4:a=="o"?3:2,e=new RegExp("^\\d{1,"+d+"}"),f=b.substring(r).match(e);if(!f)throw"Missing number at position "+r;r+=f[0].length;return parseInt(f[0],10)},p=function(a,c,d){var e=$.map(n(a)?d:c,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)}),f=-1;$.each(e,function(a,c){var d=c[1];if(b.substr(r,d.length).toLowerCase()==d.toLowerCase()){f=c[0],r+=d.length;return!1}});if(f!=-1)return f+1;throw"Unknown name at position "+r},q=function(){if(b.charAt(r)!=a.charAt(s))throw"Unexpected literal at position "+r;r++},r=0;for(var s=0;s<a.length;s++)if(m)a.charAt(s)=="'"&&!n("'")?m=!1:q();else switch(a.charAt(s)){case"d":k=o("d");break;case"D":p("D",e,f);break;case"o":l=o("o");break;case"m":j=o("m");break;case"M":j=p("M",g,h);break;case"y":i=o("y");break;case"@":var t=new Date(o("@"));i=t.getFullYear(),j=t.getMonth()+1,k=t.getDate();break;case"!":var t=new Date((o("!")-this._ticksTo1970)/1e4);i=t.getFullYear(),j=t.getMonth()+1,k=t.getDate();break;case"'":n("'")?q():m=!0;break;default:q()}if(r<b.length)throw"Extra/unparsed characters found in date: "+b.substring(r);i==-1?i=(new Date).getFullYear():i<100&&(i+=(new Date).getFullYear()-(new Date).getFullYear()%100+(i<=d?0:-100));if(l>-1){j=1,k=l;for(;;){var u=this._getDaysInMonth(i,j-1);if(k<=u)break;j++,k-=u}}var t=this._daylightSavingAdjust(new Date(i,j-1,k));if(t.getFullYear()!=i||t.getMonth()+1!=j||t.getDate()!=k)throw"Invalid date";return t},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(a,b,c){if(!b)return"";var d=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,e=(c?c.dayNames:null)||this._defaults.dayNames,f=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,h=function(b){var c=m+1<a.length&&a.charAt(m+1)==b;c&&m++;return c},i=function(a,b,c){var d=""+b;if(h(a))while(d.length<c)d="0"+d;return d},j=function(a,b,c,d){return h(a)?d[b]:c[b]},k="",l=!1;if(b)for(var m=0;m<a.length;m++)if(l)a.charAt(m)=="'"&&!h("'")?l=!1:k+=a.charAt(m);else switch(a.charAt(m)){case"d":k+=i("d",b.getDate(),2);break;case"D":k+=j("D",b.getDay(),d,e);break;case"o":k+=i("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-(new Date(b.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":k+=i("m",b.getMonth()+1,2);break;case"M":k+=j("M",b.getMonth(),f,g);break;case"y":k+=h("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"@":k+=b.getTime();break;case"!":k+=b.getTime()*1e4+this._ticksTo1970;break;case"'":h("'")?k+="'":l=!0;break;default:k+=a.charAt(m)}return k},_possibleChars:function(a){var b="",c=!1,d=function(b){var c=e+1<a.length&&a.charAt(e+1)==b;c&&e++;return c};for(var e=0;e<a.length;e++)if(c)a.charAt(e)=="'"&&!d("'")?c=!1:b+=a.charAt(e);else switch(a.charAt(e)){case"d":case"m":case"y":case"@":b+="0123456789";break;case"D":case"M":return null;case"'":d("'")?b+="'":c=!0;break;default:b+=a.charAt(e)}return b},_get:function(a,b){return a.settings[b]!==undefined?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!=a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,e,f;e=f=this._getDefaultDate(a);var g=this._getFormatConfig(a);try{e=this.parseDate(c,d,g)||f}catch(h){this.log(h),d=b?"":d}a.selectedDay=e.getDate(),a.drawMonth=a.selectedMonth=e.getMonth(),a.drawYear=a.selectedYear=e.getFullYear(),a.currentDay=d?e.getDate():0,a.currentMonth=d?e.getMonth():0,a.currentYear=d?e.getFullYear():0,this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){var d=function(a){var b=new Date;b.setDate(b.getDate()+a);return b},e=function(b){try{return $.datepicker.parseDate($.datepicker._get(a,"dateFormat"),b,$.datepicker._getFormatConfig(a))}catch(c){}var d=(b.toLowerCase().match(/^c/)?$.datepicker._getDate(a):null)||new Date,e=d.getFullYear(),f=d.getMonth(),g=d.getDate(),h=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,i=h.exec(b);while(i){switch(i[2]||"d"){case"d":case"D":g+=parseInt(i[1],10);break;case"w":case"W":g+=parseInt(i[1],10)*7;break;case"m":case"M":f+=parseInt(i[1],10),g=Math.min(g,$.datepicker._getDaysInMonth(e,f));break;case"y":case"Y":e+=parseInt(i[1],10),g=Math.min(g,$.datepicker._getDaysInMonth(e,f))}i=h.exec(b)}return new Date(e,f,g)},f=b==null||b===""?c:typeof b=="string"?e(b):typeof b=="number"?isNaN(b)?c:d(b):new Date(b.getTime());f=f&&f.toString()=="Invalid Date"?c:f,f&&(f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0));return this._daylightSavingAdjust(f)},_daylightSavingAdjust:function(a){if(!a)return null;a.setHours(a.getHours()>12?a.getHours()+2:0);return a},_setDate:function(a,b,c){var d=!b,e=a.selectedMonth,f=a.selectedYear,g=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=g.getDate(),a.drawMonth=a.selectedMonth=a.currentMonth=g.getMonth(),a.drawYear=a.selectedYear=a.currentYear=g.getFullYear(),(e!=a.selectedMonth||f!=a.selectedYear)&&!c&&this._notifyChange(a),this._adjustInstDate(a),a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){var b=!a.currentYear||a.input&&a.input.val()==""?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return b},_generateHTML:function(a){var b=new Date;b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate()));var c=this._get(a,"isRTL"),d=this._get(a,"showButtonPanel"),e=this._get(a,"hideIfNoPrevNext"),f=this._get(a,"navigationAsDateFormat"),g=this._getNumberOfMonths(a),h=this._get(a,"showCurrentAtPos"),i=this._get(a,"stepMonths"),j=g[0]!=1||g[1]!=1,k=this._daylightSavingAdjust(a.currentDay?new Date(a.currentYear,a.currentMonth,a.currentDay):new Date(9999,9,9)),l=this._getMinMaxDate(a,"min"),m=this._getMinMaxDate(a,"max"),n=a.drawMonth-h,o=a.drawYear;n<0&&(n+=12,o--);if(m){var p=this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth()-g[0]*g[1]+1,m.getDate()));p=l&&p<l?l:p;while(this._daylightSavingAdjust(new Date(o,n,1))>p)n--,n<0&&(n=11,o--)}a.drawMonth=n,a.drawYear=o;var q=this._get(a,"prevText");q=f?this.formatDate(q,this._daylightSavingAdjust(new Date(o,n-i,1)),this._getFormatConfig(a)):q;var r=this._canAdjustMonth(a,-1,o,n)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+a.id+"', -"+i+", 'M');\""+' title="'+q+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+q+"</span></a>":e?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+q+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+q+"</span></a>",s=this._get(a,"nextText");s=f?this.formatDate(s,this._daylightSavingAdjust(new Date(o,n+i,1)),this._getFormatConfig(a)):s;var t=this._canAdjustMonth(a,1,o,n)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+a.id+"', +"+i+", 'M');\""+' title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":e?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>",u=this._get(a,"currentText"),v=this._get(a,"gotoCurrent")&&a.currentDay?k:b;u=f?this.formatDate(u,v,this._getFormatConfig(a)):u;var w=a.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(a,"closeText")+"</button>",x=d?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?w:"")+(this._isInRange(a,v)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+a.id+"');\""+">"+u+"</button>":"")+(c?"":w)+"</div>":"",y=parseInt(this._get(a,"firstDay"),10);y=isNaN(y)?0:y;var z=this._get(a,"showWeek"),A=this._get(a,"dayNames"),B=this._get(a,"dayNamesShort"),C=this._get(a,"dayNamesMin"),D=this._get(a,"monthNames"),E=this._get(a,"monthNamesShort"),F=this._get(a,"beforeShowDay"),G=this._get(a,"showOtherMonths"),H=this._get(a,"selectOtherMonths"),I=this._get(a,"calculateWeek")||this.iso8601Week,J=this._getDefaultDate(a),K="";for(var L=0;L<g[0];L++){var M="";this.maxRows=4;for(var N=0;N<g[1];N++){var O=this._daylightSavingAdjust(new Date(o,n,a.selectedDay)),P=" ui-corner-all",Q="";if(j){Q+='<div class="ui-datepicker-group';if(g[1]>1)switch(N){case 0:Q+=" ui-datepicker-group-first",P=" ui-corner-"+(c?"right":"left");break;case g[1]-1:Q+=" ui-datepicker-group-last",P=" ui-corner-"+(c?"left":"right");break;default:Q+=" ui-datepicker-group-middle",P=""}Q+='">'}Q+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+P+'">'+(/all|left/.test(P)&&L==0?c?t:r:"")+(/all|right/.test(P)&&L==0?c?r:t:"")+this._generateMonthYearHeader(a,n,o,l,m,L>0||N>0,D,E)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var R=z?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"";for(var S=0;S<7;S++){var T=(S+y)%7;R+="<th"+((S+y+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+A[T]+'">'+C[T]+"</span></th>"}Q+=R+"</tr></thead><tbody>";var U=this._getDaysInMonth(o,n);o==a.selectedYear&&n==a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,U));var V=(this._getFirstDayOfMonth(o,n)-y+7)%7,W=Math.ceil((V+U)/7),X=j?this.maxRows>W?this.maxRows:W:W;this.maxRows=X;var Y=this._daylightSavingAdjust(new Date(o,n,1-V));for(var Z=0;Z<X;Z++){Q+="<tr>";var _=z?'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(Y)+"</td>":"";for(var S=0;S<7;S++){var ba=F?F.apply(a.input?a.input[0]:null,[Y]):[!0,""],bb=Y.getMonth()!=n,bc=bb&&!H||!ba[0]||l&&Y<l||m&&Y>m;_+='<td class="'+((S+y+6)%7>=5?" ui-datepicker-week-end":"")+(bb?" ui-datepicker-other-month":"")+(Y.getTime()==O.getTime()&&n==a.selectedMonth&&a._keyEvent||J.getTime()==Y.getTime()&&J.getTime()==O.getTime()?" "+this._dayOverClass:"")+(bc?" "+this._unselectableClass+" ui-state-disabled":"")+(bb&&!G?"":" "+ba[1]+(Y.getTime()==k.getTime()?" "+this._currentClass:"")+(Y.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!bb||G)&&ba[2]?' title="'+ba[2]+'"':"")+(bc?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+a.id+"',"+Y.getMonth()+","+Y.getFullYear()+', this);return false;"')+">"+(bb&&!G?"&#xa0;":bc?'<span class="ui-state-default">'+Y.getDate()+"</span>":'<a class="ui-state-default'+(Y.getTime()==b.getTime()?" ui-state-highlight":"")+(Y.getTime()==k.getTime()?" ui-state-active":"")+(bb?" ui-priority-secondary":"")+'" href="#">'+Y.getDate()+"</a>")+"</td>",Y.setDate(Y.getDate()+1),Y=this._daylightSavingAdjust(Y)}Q+=_+"</tr>"}n++,n>11&&(n=0,o++),Q+="</tbody></table>"+(j?"</div>"+(g[0]>0&&N==g[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),M+=Q}K+=M}K+=x+($.browser.msie&&parseInt($.browser.version,10)<7&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),a._keyEvent=!1;return K},_generateMonthYearHeader:function(a,b,c,d,e,f,g,h){var i=this._get(a,"changeMonth"),j=this._get(a,"changeYear"),k=this._get(a,"showMonthAfterYear"),l='<div class="ui-datepicker-title">',m="";if(f||!i)m+='<span class="ui-datepicker-month">'+g[b]+"</span>";else{var n=d&&d.getFullYear()==c,o=e&&e.getFullYear()==c;m+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+a.id+"', this, 'M');\" "+">";for(var p=0;p<12;p++)(!n||p>=d.getMonth())&&(!o||p<=e.getMonth())&&(m+='<option value="'+p+'"'+(p==b?' selected="selected"':"")+">"+h[p]+"</option>");m+="</select>"}k||(l+=m+(f||!i||!j?"&#xa0;":""));if(!a.yearshtml){a.yearshtml="";if(f||!j)l+='<span class="ui-datepicker-year">'+c+"</span>";else{var q=this._get(a,"yearRange").split(":"),r=(new Date).getFullYear(),s=function(a){var b=a.match(/c[+-].*/)?c+parseInt(a.substring(1),10):a.match(/[+-].*/)?r+parseInt(a,10):parseInt(a,10);return isNaN(b)?r:b},t=s(q[0]),u=Math.max(t,s(q[1]||""));t=d?Math.max(t,d.getFullYear()):t,u=e?Math.min(u,e.getFullYear()):u,a.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+a.id+"', this, 'Y');\" "+">";for(;t<=u;t++)a.yearshtml+='<option value="'+t+'"'+(t==c?' selected="selected"':"")+">"+t+"</option>";a.yearshtml+="</select>",l+=a.yearshtml,a.yearshtml=null}}l+=this._get(a,"yearSuffix"),k&&(l+=(f||!i||!j?"&#xa0;":"")+m),l+="</div>";return l},_adjustInstDate:function(a,b,c){var d=a.drawYear+(c=="Y"?b:0),e=a.drawMonth+(c=="M"?b:0),f=Math.min(a.selectedDay,this._getDaysInMonth(d,e))+(c=="D"?b:0),g=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(d,e,f)));a.selectedDay=g.getDate(),a.drawMonth=a.selectedMonth=g.getMonth(),a.drawYear=a.selectedYear=g.getFullYear(),(c=="M"||c=="Y")&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),e=c&&b<c?c:b;e=d&&e>d?d:e;return e},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){var b=this._get(a,"numberOfMonths");return b==null?[1,1]:typeof b=="number"?[1,b]:b},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,d){var e=this._getNumberOfMonths(a),f=this._daylightSavingAdjust(new Date(c,d+(b<0?b:e[0]*e[1]),1));b<0&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth()));return this._isInRange(a,f)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!d||b.getTime()<=d.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");b=typeof b!="string"?b:(new Date).getFullYear()%100+parseInt(b,10);return{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);var e=b?typeof b=="object"?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),e,this._getFormatConfig(a))}}),$.fn.datepicker=function(a){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var b=Array.prototype.slice.call(arguments,1);if(typeof a=="string"&&(a=="isDisabled"||a=="getDate"||a=="widget"))return $.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this[0]].concat(b));if(a=="option"&&arguments.length==2&&typeof arguments[1]=="string")return $.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this[0]].concat(b));return this.each(function(){typeof a=="string"?$.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this].concat(b)):$.datepicker._attachDatepicker(this,a)})},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.8.17",window["DP_jQuery_"+dpuuid]=$})(jQuery);/* * jQuery UI Progressbar 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Progressbar * * Depends: *   jquery.ui.core.js *   jquery.ui.widget.js */(function(a,b){a.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove(),a.Widget.prototype.destroy.apply(this,arguments)},value:function(a){if(a===b)return this._value();this._setOption("value",a);return this},_setOption:function(b,c){b==="value"&&(this.options.value=c,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),a.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var a=this.options.value;typeof a!="number"&&(a=0);return Math.min(this.options.max,Math.max(this.min,a))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var a=this.value(),b=this._percentage();this.oldValue!==a&&(this.oldValue=a,this._trigger("change")),this.valueDiv.toggle(a>this.min).toggleClass("ui-corner-right",a===this.options.max).width(b.toFixed(0)+"%"),this.element.attr("aria-valuenow",a)}}),a.extend(a.ui.progressbar,{version:"1.8.17"})})(jQuery);/* * jQuery UI Effects 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/ */jQuery.effects||function(a,b){function l(b){if(!b||typeof b=="number"||a.fx.speeds[b])return!0;if(typeof b=="string"&&!a.effects[b])return!0;return!1}function k(b,c,d,e){typeof b=="object"&&(e=c,d=null,c=b,b=c.effect),a.isFunction(c)&&(e=c,d=null,c={});if(typeof c=="number"||a.fx.speeds[c])e=d,d=c,c={};a.isFunction(d)&&(e=d,d=null),c=c||{},d=d||c.duration,d=a.fx.off?0:typeof d=="number"?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,e=e||c.complete;return[b,c,d,e]}function j(a,b){var c={_:0},d;for(d in b)a[d]!=b[d]&&(c[d]=b[d]);return c}function i(b){var c,d;for(c in b)d=b[c],(d==null||a.isFunction(d)||c in g||/scrollbar/.test(c)||!/color/i.test(c)&&isNaN(parseFloat(d)))&&delete b[c];return b}function h(){var a=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,b={},c,d;if(a&&a.length&&a[0]&&a[a[0]]){var e=a.length;while(e--)c=a[e],typeof a[c]=="string"&&(d=c.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),b[d]=a[c])}else for(c in a)typeof a[c]=="string"&&(b[c]=a[c]);return b}function d(b,d){var e;do{e=a.curCSS(b,d);if(e!=""&&e!="transparent"||a.nodeName(b,"body"))break;d="backgroundColor"}while(b=b.parentNode);return c(e)}function c(b){var c;if(b&&b.constructor==Array&&b.length==3)return b;if(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))return[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)];if(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))return[parseFloat(c[1])*2.55,parseFloat(c[2])*2.55,parseFloat(c[3])*2.55];if(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)];if(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))return[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)];if(c=/rgba\(0, 0, 0, 0\)/.exec(b))return e.transparent;return e[a.trim(b).toLowerCase()]}a.effects={},a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(b,e){a.fx.step[e]=function(a){a.colorInit||(a.start=d(a.elem,e),a.end=c(a.end),a.colorInit=!0),a.elem.style[e]="rgb("+Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2],10),255),0)+")"}});var e={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},f=["add","remove","toggle"],g={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.effects.animateClass=function(b,c,d,e){a.isFunction(d)&&(e=d,d=null);return this.queue(function(){var g=a(this),k=g.attr("style")||" ",l=i(h.call(this)),m,n=g.attr("class");a.each(f,function(a,c){b[c]&&g[c+"Class"](b[c])}),m=i(h.call(this)),g.attr("class",n),g.animate(j(l,m),{queue:!1,duration:c,easing:d,complete:function(){a.each(f,function(a,c){b[c]&&g[c+"Class"](b[c])}),typeof g.attr("style")=="object"?(g.attr("style").cssText="",g.attr("style").cssText=k):g.attr("style",k),e&&e.apply(this,arguments),a.dequeue(this)}})})},a.fn.extend({_addClass:a.fn.addClass,addClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{add:b},c,d,e]):this._addClass(b)},_removeClass:a.fn.removeClass,removeClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{remove:b},c,d,e]):this._removeClass(b)},_toggleClass:a.fn.toggleClass,toggleClass:function(c,d,e,f,g){return typeof d=="boolean"||d===b?e?a.effects.animateClass.apply(this,[d?{add:c}:{remove:c},e,f,g]):this._toggleClass(c,d):a.effects.animateClass.apply(this,[{toggle:c},d,e,f])},switchClass:function(b,c,d,e,f){return a.effects.animateClass.apply(this,[{add:c,remove:b},d,e,f])}}),a.extend(a.effects,{version:"1.8.17",save:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.data("ec.storage."+b[c],a[0].style[b[c]])},restore:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.css(b[c],a.data("ec.storage."+b[c]))},setMode:function(a,b){b=="toggle"&&(b=a.is(":hidden")?"show":"hide");return b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e=document.activeElement;b.wrap(d),(b[0]===e||a.contains(b[0],e))&&a(e).focus(),d=b.parent(),b.css("position")=="static"?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));return d.css(c).show()},removeWrapper:function(b){var c,d=document.activeElement;if(b.parent().is(".ui-effects-wrapper")){c=b.parent().replaceWith(b),(b[0]===d||a.contains(b[0],d))&&a(d).focus();return c}return b},setTransition:function(b,c,d,e){e=e||{},a.each(c,function(a,c){unit=b.cssUnit(c),unit[0]>0&&(e[c]=unit[0]*d+unit[1])});return e}}),a.fn.extend({effect:function(b,c,d,e){var f=k.apply(this,arguments),g={options:f[1],duration:f[2],callback:f[3]},h=g.options.mode,i=a.effects[b];if(a.fx.off||!i)return h?this[h](g.duration,g.callback):this.each(function(){g.callback&&g.callback.call(this)});return i.call(this,g)},_show:a.fn.show,show:function(a){if(l(a))return this._show.apply(this,arguments);var b=k.apply(this,arguments);b[1].mode="show";return this.effect.apply(this,b)},_hide:a.fn.hide,hide:function(a){if(l(a))return this._hide.apply(this,arguments);var b=k.apply(this,arguments);b[1].mode="hide";return this.effect.apply(this,b)},__toggle:a.fn.toggle,toggle:function(b){if(l(b)||typeof b=="boolean"||a.isFunction(b))return this.__toggle.apply(this,arguments);var c=k.apply(this,arguments);c[1].mode="toggle";return this.effect.apply(this,c)},cssUnit:function(b){var c=this.css(b),d=[];a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])});return d}}),a.easing.jswing=a.easing.swing,a.extend(a.easing,{def:"easeOutQuad",swing:function(b,c,d,e,f){return a.easing[a.easing.def](b,c,d,e,f)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b+c;return-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b*b+c;return d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b*b*b+c;return-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b*b*b*b+c;return d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){if(b==0)return c;if(b==e)return c+d;if((b/=e/2)<1)return d/2*Math.pow(2,10*(b-1))+c;return d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){if((b/=e/2)<1)return-d/2*(Math.sqrt(1-b*b)-1)+c;return d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);if(b<1)return-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c;return h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,c,d,e,f,g){g==b&&(g=1.70158);return e*(c/=f)*c*((g+1)*c-g)+d},easeOutBack:function(a,c,d,e,f,g){g==b&&(g=1.70158);return e*((c=c/f-1)*c*((g+1)*c+g)+1)+d},easeInOutBack:function(a,c,d,e,f,g){g==b&&(g=1.70158);if((c/=f/2)<1)return e/2*c*c*(((g*=1.525)+1)*c-g)+d;return e/2*((c-=2)*c*(((g*=1.525)+1)*c+g)+2)+d},easeInBounce:function(b,c,d,e,f){return e-a.easing.easeOutBounce(b,f-c,0,e,f)+d},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(b,c,d,e,f){if(c<f/2)return a.easing.easeInBounce(b,c*2,0,e,f)*.5+d;return a.easing.easeOutBounce(b,c*2-f,0,e,f)*.5+e*.5+d}})}(jQuery);/* * jQuery UI Effects Blind 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Blind * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.blind=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"vertical";a.effects.save(c,d),c.show();var g=a.effects.createWrapper(c).css({overflow:"hidden"}),h=f=="vertical"?"height":"width",i=f=="vertical"?g.height():g.width();e=="show"&&g.css(h,0);var j={};j[h]=e=="show"?i:0,g.animate(j,b.duration,b.options.easing,function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);/* * jQuery UI Effects Bounce 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Bounce * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.bounce=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"effect"),f=b.options.direction||"up",g=b.options.distance||20,h=b.options.times||5,i=b.duration||250;/show|hide/.test(e)&&d.push("opacity"),a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var j=f=="up"||f=="down"?"top":"left",k=f=="up"||f=="left"?"pos":"neg",g=b.options.distance||(j=="top"?c.outerHeight({margin:!0})/3:c.outerWidth({margin:!0})/3);e=="show"&&c.css("opacity",0).css(j,k=="pos"?-g:g),e=="hide"&&(g=g/(h*2)),e!="hide"&&h--;if(e=="show"){var l={opacity:1};l[j]=(k=="pos"?"+=":"-=")+g,c.animate(l,i/2,b.options.easing),g=g/2,h--}for(var m=0;m<h;m++){var n={},p={};n[j]=(k=="pos"?"-=":"+=")+g,p[j]=(k=="pos"?"+=":"-=")+g,c.animate(n,i/2,b.options.easing).animate(p,i/2,b.options.easing),g=e=="hide"?g*2:g/2}if(e=="hide"){var l={opacity:0};l[j]=(k=="pos"?"-=":"+=")+g,c.animate(l,i/2,b.options.easing,function(){c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)})}else{var n={},p={};n[j]=(k=="pos"?"-=":"+=")+g,p[j]=(k=="pos"?"+=":"-=")+g,c.animate(n,i/2,b.options.easing).animate(p,i/2,b.options.easing,function(){a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)})}c.queue("fx",function(){c.dequeue()}),c.dequeue()})}})(jQuery);/* * jQuery UI Effects Clip 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Clip * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.clip=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","height","width"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"vertical";a.effects.save(c,d),c.show();var g=a.effects.createWrapper(c).css({overflow:"hidden"}),h=c[0].tagName=="IMG"?g:c,i={size:f=="vertical"?"height":"width",position:f=="vertical"?"top":"left"},j=f=="vertical"?h.height():h.width();e=="show"&&(h.css(i.size,0),h.css(i.position,j/2));var k={};k[i.size]=e=="show"?j:0,k[i.position]=e=="show"?0:j/2,h.animate(k,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Drop 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Drop * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.drop=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","opacity"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"left";a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var g=f=="up"||f=="down"?"top":"left",h=f=="up"||f=="left"?"pos":"neg",i=b.options.distance||(g=="top"?c.outerHeight({margin:!0})/2:c.outerWidth({margin:!0})/2);e=="show"&&c.css("opacity",0).css(g,h=="pos"?-i:i);var j={opacity:e=="show"?1:0};j[g]=(e=="show"?h=="pos"?"+=":"-=":h=="pos"?"-=":"+=")+i,c.animate(j,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Explode 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Explode * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.explode=function(b){return this.queue(function(){var c=b.options.pieces?Math.round(Math.sqrt(b.options.pieces)):3,d=b.options.pieces?Math.round(Math.sqrt(b.options.pieces)):3;b.options.mode=b.options.mode=="toggle"?a(this).is(":visible")?"hide":"show":b.options.mode;var e=a(this).show().css("visibility","hidden"),f=e.offset();f.top-=parseInt(e.css("marginTop"),10)||0,f.left-=parseInt(e.css("marginLeft"),10)||0;var g=e.outerWidth(!0),h=e.outerHeight(!0);for(var i=0;i<c;i++)for(var j=0;j<d;j++)e.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*(g/d),top:-i*(h/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:g/d,height:h/c,left:f.left+j*(g/d)+(b.options.mode=="show"?(j-Math.floor(d/2))*(g/d):0),top:f.top+i*(h/c)+(b.options.mode=="show"?(i-Math.floor(c/2))*(h/c):0),opacity:b.options.mode=="show"?0:1}).animate({left:f.left+j*(g/d)+(b.options.mode=="show"?0:(j-Math.floor(d/2))*(g/d)),top:f.top+i*(h/c)+(b.options.mode=="show"?0:(i-Math.floor(c/2))*(h/c)),opacity:b.options.mode=="show"?1:0},b.duration||500);setTimeout(function(){b.options.mode=="show"?e.css({visibility:"visible"}):e.css({visibility:"visible"}).hide(),b.callback&&b.callback.apply(e[0]),e.dequeue(),a("div.ui-effects-explode").remove()},b.duration||500)})}})(jQuery);/* * jQuery UI Effects Fade 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Fade * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.fade=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"hide");c.animate({opacity:d},{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Fold 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Fold * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.fold=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.size||15,g=!!b.options.horizFirst,h=b.duration?b.duration/2:a.fx.speeds._default/2;a.effects.save(c,d),c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"}),j=e=="show"!=g,k=j?["width","height"]:["height","width"],l=j?[i.width(),i.height()]:[i.height(),i.width()],m=/([0-9]+)%/.exec(f);m&&(f=parseInt(m[1],10)/100*l[e=="hide"?0:1]),e=="show"&&i.css(g?{height:0,width:f}:{height:f,width:0});var n={},p={};n[k[0]]=e=="show"?l[0]:f,p[k[1]]=e=="show"?l[1]:0,i.animate(n,h,b.options.easing).animate(p,h,b.options.easing,function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);/* * jQuery UI Effects Highlight 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Highlight * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.highlight=function(b){return this.queue(function(){var c=a(this),d=["backgroundImage","backgroundColor","opacity"],e=a.effects.setMode(c,b.options.mode||"show"),f={backgroundColor:c.css("backgroundColor")};e=="hide"&&(f.opacity=0),a.effects.save(c,d),c.show().css({backgroundImage:"none",backgroundColor:b.options.color||"#ffff99"}).animate(f,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),e=="show"&&!a.support.opacity&&this.style.removeAttribute("filter"),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Pulsate 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Pulsate * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.pulsate=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"show");times=(b.options.times||5)*2-1,duration=b.duration?b.duration/2:a.fx.speeds._default/2,isVisible=c.is(":visible"),animateTo=0,isVisible||(c.css("opacity",0).show(),animateTo=1),(d=="hide"&&isVisible||d=="show"&&!isVisible)&&times--;for(var e=0;e<times;e++)c.animate({opacity:animateTo},duration,b.options.easing),animateTo=(animateTo+1)%2;c.animate({opacity:animateTo},duration,b.options.easing,function(){animateTo==0&&c.hide(),b.callback&&b.callback.apply(this,arguments)}),c.queue("fx",function(){c.dequeue()}).dequeue()})}})(jQuery);/* * jQuery UI Effects Scale 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Scale * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.puff=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"hide"),e=parseInt(b.options.percent,10)||150,f=e/100,g={height:c.height(),width:c.width()};a.extend(b.options,{fade:!0,mode:d,percent:d=="hide"?e:100,from:d=="hide"?g:{height:g.height*f,width:g.width*f}}),c.effect("scale",b.options,b.duration,b.callback),c.dequeue()})},a.effects.scale=function(b){return this.queue(function(){var c=a(this),d=a.extend(!0,{},b.options),e=a.effects.setMode(c,b.options.mode||"effect"),f=parseInt(b.options.percent,10)||(parseInt(b.options.percent,10)==0?0:e=="hide"?0:100),g=b.options.direction||"both",h=b.options.origin;e!="effect"&&(d.origin=h||["middle","center"],d.restore=!0);var i={height:c.height(),width:c.width()};c.from=b.options.from||(e=="show"?{height:0,width:0}:i);var j={y:g!="horizontal"?f/100:1,x:g!="vertical"?f/100:1};c.to={height:i.height*j.y,width:i.width*j.x},b.options.fade&&(e=="show"&&(c.from.opacity=0,c.to.opacity=1),e=="hide"&&(c.from.opacity=1,c.to.opacity=0)),d.from=c.from,d.to=c.to,d.mode=e,c.effect("size",d,b.duration,b.callback),c.dequeue()})},a.effects.size=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","width","height","overflow","opacity"],e=["position","top","bottom","left","right","overflow","opacity"],f=["width","height","overflow"],g=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],i=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],j=a.effects.setMode(c,b.options.mode||"effect"),k=b.options.restore||!1,l=b.options.scale||"both",m=b.options.origin,n={height:c.height(),width:c.width()};c.from=b.options.from||n,c.to=b.options.to||n;if(m){var p=a.effects.getBaseline(m,n);c.from.top=(n.height-c.from.height)*p.y,c.from.left=(n.width-c.from.width)*p.x,c.to.top=(n.height-c.to.height)*p.y,c.to.left=(n.width-c.to.width)*p.x}var q={from:{y:c.from.height/n.height,x:c.from.width/n.width},to:{y:c.to.height/n.height,x:c.to.width/n.width}};if(l=="box"||l=="both")q.from.y!=q.to.y&&(d=d.concat(h),c.from=a.effects.setTransition(c,h,q.from.y,c.from),c.to=a.effects.setTransition(c,h,q.to.y,c.to)),q.from.x!=q.to.x&&(d=d.concat(i),c.from=a.effects.setTransition(c,i,q.from.x,c.from),c.to=a.effects.setTransition(c,i,q.to.x,c.to));(l=="content"||l=="both")&&q.from.y!=q.to.y&&(d=d.concat(g),c.from=a.effects.setTransition(c,g,q.from.y,c.from),c.to=a.effects.setTransition(c,g,q.to.y,c.to)),a.effects.save(c,k?d:e),c.show(),a.effects.createWrapper(c),c.css("overflow","hidden").css(c.from);if(l=="content"||l=="both")h=h.concat(["marginTop","marginBottom"]).concat(g),i=i.concat(["marginLeft","marginRight"]),f=d.concat(h).concat(i),c.find("*[width]").each(function(){child=a(this),k&&a.effects.save(child,f);var c={height:child.height(),width:child.width()};child.from={height:c.height*q.from.y,width:c.width*q.from.x},child.to={height:c.height*q.to.y,width:c.width*q.to.x},q.from.y!=q.to.y&&(child.from=a.effects.setTransition(child,h,q.from.y,child.from),child.to=a.effects.setTransition(child,h,q.to.y,child.to)),q.from.x!=q.to.x&&(child.from=a.effects.setTransition(child,i,q.from.x,child.from),child.to=a.effects.setTransition(child,i,q.to.x,child.to)),child.css(child.from),child.animate(child.to,b.duration,b.options.easing,function(){k&&a.effects.restore(child,f)})});c.animate(c.to,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){c.to.opacity===0&&c.css("opacity",c.from.opacity),j=="hide"&&c.hide(),a.effects.restore(c,k?d:e),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Shake 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Shake * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.shake=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"effect"),f=b.options.direction||"left",g=b.options.distance||20,h=b.options.times||3,i=b.duration||b.options.duration||140;a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var j=f=="up"||f=="down"?"top":"left",k=f=="up"||f=="left"?"pos":"neg",l={},m={},n={};l[j]=(k=="pos"?"-=":"+=")+g,m[j]=(k=="pos"?"+=":"-=")+g*2,n[j]=(k=="pos"?"-=":"+=")+g*2,c.animate(l,i,b.options.easing);for(var p=1;p<h;p++)c.animate(m,i,b.options.easing).animate(n,i,b.options.easing);c.animate(m,i,b.options.easing).animate(l,i/2,b.options.easing,function(){a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)}),c.queue("fx",function(){c.dequeue()}),c.dequeue()})}})(jQuery);/* * jQuery UI Effects Slide 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Slide * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.slide=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"show"),f=b.options.direction||"left";a.effects.save(c,d),c.show(),a.effects.createWrapper(c).css({overflow:"hidden"});var g=f=="up"||f=="down"?"top":"left",h=f=="up"||f=="left"?"pos":"neg",i=b.options.distance||(g=="top"?c.outerHeight({margin:!0}):c.outerWidth({margin:!0}));e=="show"&&c.css(g,h=="pos"?isNaN(i)?"-"+i:-i:i);var j={};j[g]=(e=="show"?h=="pos"?"+=":"-=":h=="pos"?"-=":"+=")+i,c.animate(j,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);/* * jQuery UI Effects Transfer 1.8.17 * * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about) * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * http://docs.jquery.com/UI/Effects/Transfer * * Depends: *	jquery.effects.core.js */(function(a,b){a.effects.transfer=function(b){return this.queue(function(){var c=a(this),d=a(b.options.to),e=d.offset(),f={top:e.top,left:e.left,height:d.innerHeight(),width:d.innerWidth()},g=c.offset(),h=a('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(b.options.className).css({top:g.top,left:g.left,height:c.innerHeight(),width:c.innerWidth(),position:"absolute"}).animate(f,b.duration,b.options.easing,function(){h.remove(),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/jquery-ui/jquery-ui-i18n.js*//* Afrikaans initialisation for the jQuery UI date picker plugin. *//* Written by Renier Pretorius. */jQuery(function($){	$.datepicker.regional['af'] = {		closeText: 'Selekteer',		prevText: 'Vorige',		nextText: 'Volgende',		currentText: 'Vandag',		monthNames: ['Januarie','Februarie','Maart','April','Mei','Junie',		'Julie','Augustus','September','Oktober','November','Desember'],		monthNamesShort: ['Jan', 'Feb', 'Mrt', 'Apr', 'Mei', 'Jun',		'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'],		dayNames: ['Sondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrydag', 'Saterdag'],		dayNamesShort: ['Son', 'Maa', 'Din', 'Woe', 'Don', 'Vry', 'Sat'],		dayNamesMin: ['So','Ma','Di','Wo','Do','Vr','Sa'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['af']);});/* Algerian Arabic Translation for jQuery UI date picker plugin. (can be used for Tunisia)*//* Mohamed Cherif BOUCHELAGHEM -- cherifbouchelaghem@yahoo.fr */jQuery(function($){	$.datepicker.regional['ar-DZ'] = {		closeText: '?????',		prevText: '&#x3c;??????',		nextText: '??????&#x3e;',		currentText: '?????',		monthNames: ['?????', '?????', '????', '?????', '???', '????',		'??????', '???', '??????','??????', '??????', '??????'],		monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],		dayNames: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		dayNamesShort: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		dayNamesMin: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		weekHeader: '?????',		dateFormat: 'dd/mm/yy',		firstDay: 6,  		isRTL: true,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ar-DZ']);});/* Arabic Translation for jQuery UI date picker plugin. *//* Khaled Alhourani -- me@khaledalhourani.com *//* NOTE: monthNames are the original months names and they are the Arabic names, not the new months name ?????? - ????? and there isn't any Arabic roots for these months */jQuery(function($){	$.datepicker.regional['ar'] = {		closeText: '?????',		prevText: '&#x3c;??????',		nextText: '??????&#x3e;',		currentText: '?????',		monthNames: ['????? ??????', '????', '????', '?????', '????', '??????',		'????', '??', '?????',	'????? ?????', '????? ??????', '????? ?????'],		monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],		dayNames: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		dayNamesShort: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		dayNamesMin: ['?????', '???????', '????????', '????????', '??????', '??????', '?????'],		weekHeader: '?????',		dateFormat: 'dd/mm/yy',		firstDay: 6,  		isRTL: true,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ar']);});/* Azerbaijani (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Jamil Najafov (necefov33@gmail.com). */jQuery(function($) {	$.datepicker.regional['az'] = {		closeText: 'Bagla',		prevText: '&#x3c;Geri',		nextText: 'Ir?li&#x3e;',		currentText: 'Bugn',		monthNames: ['Yanvar','Fevral','Mart','Aprel','May','Iyun',		'Iyul','Avqust','Sentyabr','Oktyabr','Noyabr','Dekabr'],		monthNamesShort: ['Yan','Fev','Mar','Apr','May','Iyun',		'Iyul','Avq','Sen','Okt','Noy','Dek'],		dayNames: ['Bazar','Bazar ert?si','?rs?nb? axsami','?rs?nb?','Cm? axsami','Cm?','S?nb?'],		dayNamesShort: ['B','Be','a','','Ca','C','S'],		dayNamesMin: ['B','B','','?','','C','S'],		weekHeader: 'Hf',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['az']);});/* Bulgarian initialisation for the jQuery UI date picker plugin. *//* Written by Stoyan Kyosev (http://svest.org). */jQuery(function($){    $.datepicker.regional['bg'] = {        closeText: '???????',        prevText: '&#x3c;?????',        nextText: '??????&#x3e;',		nextBigText: '&#x3e;&#x3e;',        currentText: '????',        monthNames: ['??????','????????','????','?????','???','???',        '???','??????','?????????','????????','???????','????????'],        monthNamesShort: ['???','???','???','???','???','???',        '???','???','???','???','???','???'],        dayNames: ['??????','??????????','???????','?????','?????????','?????','??????'],        dayNamesShort: ['???','???','???','???','???','???','???'],        dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: 'Wk',        dateFormat: 'dd.mm.yy',		firstDay: 1,        isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};    $.datepicker.setDefaults($.datepicker.regional['bg']);});/* Bosnian i18n for the jQuery UI date picker plugin. *//* Written by Kenan Konjo. */jQuery(function($){	$.datepicker.regional['bs'] = {		closeText: 'Zatvori',		prevText: '&#x3c;',		nextText: '&#x3e;',		currentText: 'Danas',		monthNames: ['Januar','Februar','Mart','April','Maj','Juni',		'Juli','August','Septembar','Oktobar','Novembar','Decembar'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',		'Jul','Aug','Sep','Okt','Nov','Dec'],		dayNames: ['Nedelja','Ponedeljak','Utorak','Srijeda','Cetvrtak','Petak','Subota'],		dayNamesShort: ['Ned','Pon','Uto','Sri','Cet','Pet','Sub'],		dayNamesMin: ['Ne','Po','Ut','Sr','Ce','Pe','Su'],		weekHeader: 'Wk',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['bs']);});/* Inicialitzaci en catal per a l'extenci 'calendar' per jQuery. *//* Writers: (joan.leon@gmail.com). */jQuery(function($){	$.datepicker.regional['ca'] = {		closeText: 'Tancar',		prevText: '&#x3c;Ant',		nextText: 'Seg&#x3e;',		currentText: 'Avui',		monthNames: ['Gener','Febrer','Mar&ccedil;','Abril','Maig','Juny',		'Juliol','Agost','Setembre','Octubre','Novembre','Desembre'],		monthNamesShort: ['Gen','Feb','Mar','Abr','Mai','Jun',		'Jul','Ago','Set','Oct','Nov','Des'],		dayNames: ['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'],		dayNamesShort: ['Dug','Dln','Dmt','Dmc','Djs','Dvn','Dsb'],		dayNamesMin: ['Dg','Dl','Dt','Dc','Dj','Dv','Ds'],		weekHeader: 'Sm',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ca']);});/* Czech initialisation for the jQuery UI date picker plugin. *//* Written by Tomas Muller (tomas@tomas-muller.net). */jQuery(function($){	$.datepicker.regional['cs'] = {		closeText: 'Zavrt',		prevText: '&#x3c;Drve',		nextText: 'Pozdeji&#x3e;',		currentText: 'Nyn',		monthNames: ['leden','nor','brezen','duben','kveten','cerven',        'cervenec','srpen','zr','rjen','listopad','prosinec'],		monthNamesShort: ['led','no','bre','dub','kve','cer',		'cvc','srp','zr','rj','lis','pro'],		dayNames: ['nedele', 'pondel', 'ter', 'streda', 'ctvrtek', 'ptek', 'sobota'],		dayNamesShort: ['ne', 'po', 't', 'st', 'ct', 'p', 'so'],		dayNamesMin: ['ne','po','t','st','ct','p','so'],		weekHeader: 'Td',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['cs']);});/* Welsh/UK initialisation for the jQuery UI date picker plugin. *//* Written by William Griffiths. */jQuery(function($){	$.datepicker.regional['cy-GB'] = {		closeText: 'Done',		prevText: 'Prev',		nextText: 'Next',		currentText: 'Today',		monthNames: ['Ionawr','Chwefror','Mawrth','Ebrill','Mai','Mehefin',		'Gorffennaf','Awst','Medi','Hydref','Tachwedd','Rhagfyr'],		monthNamesShort: ['Ion', 'Chw', 'Maw', 'Ebr', 'Mai', 'Meh',		'Gor', 'Aws', 'Med', 'Hyd', 'Tac', 'Rha'],		dayNames: ['Dydd Sul', 'Dydd Llun', 'Dydd Mawrth', 'Dydd Mercher', 'Dydd Iau', 'Dydd Gwener', 'Dydd Sadwrn'],		dayNamesShort: ['Sul', 'Llu', 'Maw', 'Mer', 'Iau', 'Gwe', 'Sad'],		dayNamesMin: ['Su','Ll','Ma','Me','Ia','Gw','Sa'],		weekHeader: 'Wy',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['cy-GB']);});/* Danish initialisation for the jQuery UI date picker plugin. *//* Written by Jan Christensen ( deletestuff@gmail.com). */jQuery(function($){    $.datepicker.regional['da'] = {		closeText: 'Luk',        prevText: '&#x3c;Forrige',		nextText: 'Nste&#x3e;',		currentText: 'Idag',        monthNames: ['Januar','Februar','Marts','April','Maj','Juni',        'Juli','August','September','Oktober','November','December'],        monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',        'Jul','Aug','Sep','Okt','Nov','Dec'],		dayNames: ['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],		dayNamesShort: ['Sn','Man','Tir','Ons','Tor','Fre','Lr'],		dayNamesMin: ['S','Ma','Ti','On','To','Fr','L'],		weekHeader: 'Uge',        dateFormat: 'dd-mm-yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};    $.datepicker.setDefaults($.datepicker.regional['da']);});/* German initialisation for the jQuery UI date picker plugin. *//* Written by Milian Wolff (mail@milianw.de). */jQuery(function($){	$.datepicker.regional['de'] = {		closeText: 'schlieen',		prevText: '&#x3c;zurck',		nextText: 'Vor&#x3e;',		currentText: 'heute',		monthNames: ['Januar','Februar','Mrz','April','Mai','Juni',		'Juli','August','September','Oktober','November','Dezember'],		monthNamesShort: ['Jan','Feb','Mr','Apr','Mai','Jun',		'Jul','Aug','Sep','Okt','Nov','Dez'],		dayNames: ['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'],		dayNamesShort: ['So','Mo','Di','Mi','Do','Fr','Sa'],		dayNamesMin: ['So','Mo','Di','Mi','Do','Fr','Sa'],		weekHeader: 'Wo',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['de']);});/* Greek (el) initialisation for the jQuery UI date picker plugin. *//* Written by Alex Cicovic (http://www.alexcicovic.com) */jQuery(function($){	$.datepicker.regional['el'] = {		closeText: '??e?s??',		prevText: '???????e???',		nextText: '?p?e???',		currentText: '?????? ???a?',		monthNames: ['?a????????','Fe????????','???t???','?p??????','?????','???????',		'???????','?????st??','Sept?????','??t?????','???????','?e??????'],		monthNamesShort: ['?a?','Fe','?a?','?p?','?a?','????',		'????','???','Sep','??t','??e','?e?'],		dayNames: ['????a??','?e?t??a','???t?','?et??t?','??pt?','?a?as?e??','S?at?'],		dayNamesShort: ['???','?e?','???','?et','?e','?a?','Sa'],		dayNamesMin: ['??','?e','??','?e','?e','?a','Sa'],		weekHeader: '?d',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['el']);});/* English/Australia initialisation for the jQuery UI date picker plugin. *//* Based on the en-GB initialisation. */jQuery(function($){	$.datepicker.regional['en-AU'] = {		closeText: 'Done',		prevText: 'Prev',		nextText: 'Next',		currentText: 'Today',		monthNames: ['January','February','March','April','May','June',		'July','August','September','October','November','December'],		monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',		'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],		dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],		dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],		dayNamesMin: ['Su','Mo','Tu','We','Th','Fr','Sa'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['en-AU']);});/* English/UK initialisation for the jQuery UI date picker plugin. *//* Written by Stuart. */jQuery(function($){	$.datepicker.regional['en-GB'] = {		closeText: 'Done',		prevText: 'Prev',		nextText: 'Next',		currentText: 'Today',		monthNames: ['January','February','March','April','May','June',		'July','August','September','October','November','December'],		monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',		'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],		dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],		dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],		dayNamesMin: ['Su','Mo','Tu','We','Th','Fr','Sa'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['en-GB']);});/* English/New Zealand initialisation for the jQuery UI date picker plugin. *//* Based on the en-GB initialisation. */jQuery(function($){	$.datepicker.regional['en-NZ'] = {		closeText: 'Done',		prevText: 'Prev',		nextText: 'Next',		currentText: 'Today',		monthNames: ['January','February','March','April','May','June',		'July','August','September','October','November','December'],		monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',		'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],		dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],		dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],		dayNamesMin: ['Su','Mo','Tu','We','Th','Fr','Sa'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['en-NZ']);});/* Esperanto initialisation for the jQuery UI date picker plugin. *//* Written by Olivier M. (olivierweb@ifrance.com). */jQuery(function($){	$.datepicker.regional['eo'] = {		closeText: 'Fermi',		prevText: '&lt;Anta',		nextText: 'Sekv&gt;',		currentText: 'Nuna',		monthNames: ['Januaro','Februaro','Marto','Aprilo','Majo','Junio',		'Julio','Augusto','Septembro','Oktobro','Novembro','Decembro'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',		'Jul','Aug','Sep','Okt','Nov','Dec'],		dayNames: ['Dimanco','Lundo','Mardo','Merkredo','Jaudo','Vendredo','Sabato'],		dayNamesShort: ['Dim','Lun','Mar','Mer','Jau','Ven','Sab'],		dayNamesMin: ['Di','Lu','Ma','Me','Ja','Ve','Sa'],		weekHeader: 'Sb',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['eo']);});/* Inicializacin en espaol para la extensin 'UI date picker' para jQuery. *//* Traducido por Vester (xvester@gmail.com). */jQuery(function($){	$.datepicker.regional['es'] = {		closeText: 'Cerrar',		prevText: '&#x3c;Ant',		nextText: 'Sig&#x3e;',		currentText: 'Hoy',		monthNames: ['Enero','Febrero','Marzo','Abril','Mayo','Junio',		'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],		monthNamesShort: ['Ene','Feb','Mar','Abr','May','Jun',		'Jul','Ago','Sep','Oct','Nov','Dic'],		dayNames: ['Domingo','Lunes','Martes','Mi&eacute;rcoles','Jueves','Viernes','S&aacute;bado'],		dayNamesShort: ['Dom','Lun','Mar','Mi&eacute;','Juv','Vie','S&aacute;b'],		dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','S&aacute;'],		weekHeader: 'Sm',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['es']);});/* Estonian initialisation for the jQuery UI date picker plugin. *//* Written by Mart Smermaa (mrts.pydev at gmail com). */jQuery(function($){	$.datepicker.regional['et'] = {		closeText: 'Sulge',		prevText: 'Eelnev',		nextText: 'Jrgnev',		currentText: 'Tna',		monthNames: ['Jaanuar','Veebruar','Mrts','Aprill','Mai','Juuni',		'Juuli','August','September','Oktoober','November','Detsember'],		monthNamesShort: ['Jaan', 'Veebr', 'Mrts', 'Apr', 'Mai', 'Juuni',		'Juuli', 'Aug', 'Sept', 'Okt', 'Nov', 'Dets'],		dayNames: ['Phapev', 'Esmaspev', 'Teisipev', 'Kolmapev', 'Neljapev', 'Reede', 'Laupev'],		dayNamesShort: ['Phap', 'Esmasp', 'Teisip', 'Kolmap', 'Neljap', 'Reede', 'Laup'],		dayNamesMin: ['P','E','T','K','N','R','L'],		weekHeader: 'Sm',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['et']);}); /* Euskarako oinarria 'UI date picker' jquery-ko extentsioarentzat *//* Karrikas-ek itzulia (karrikas@karrikas.com) */jQuery(function($){	$.datepicker.regional['eu'] = {		closeText: 'Egina',		prevText: '&#x3c;Aur',		nextText: 'Hur&#x3e;',		currentText: 'Gaur',		monthNames: ['Urtarrila','Otsaila','Martxoa','Apirila','Maiatza','Ekaina',		'Uztaila','Abuztua','Iraila','Urria','Azaroa','Abendua'],		monthNamesShort: ['Urt','Ots','Mar','Api','Mai','Eka',		'Uzt','Abu','Ira','Urr','Aza','Abe'],		dayNames: ['Igandea','Astelehena','Asteartea','Asteazkena','Osteguna','Ostirala','Larunbata'],		dayNamesShort: ['Iga','Ast','Ast','Ast','Ost','Ost','Lar'],		dayNamesMin: ['Ig','As','As','As','Os','Os','La'],		weekHeader: 'Wk',		dateFormat: 'yy/mm/dd',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['eu']);});/* Persian (Farsi) Translation for the jQuery UI date picker plugin. *//* Javad Mowlanezhad -- jmowla@gmail.com *//* Jalali calendar should supported soon! (Its implemented but I have to test it) */jQuery(function($) {	$.datepicker.regional['fa'] = {		closeText: '????',		prevText: '&#x3c;????',		nextText: '????&#x3e;',		currentText: '?????',		monthNames: ['???????','????????','?????','???','?????','??????',		'???','????','???','??','????','?????'],		monthNamesShort: ['1','2','3','4','5','6','7','8','9','10','11','12'],		dayNames: ['??????','??????','???????','????????','???????','????','????'],		dayNamesShort: ['?','?','?','?','?','?', '?'],		dayNamesMin: ['?','?','?','?','?','?', '?'],		weekHeader: '??',		dateFormat: 'yy/mm/dd',		firstDay: 6,		isRTL: true,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['fa']);});/* Finnish initialisation for the jQuery UI date picker plugin. *//* Written by Harri Kilpi? (harrikilpio@gmail.com). */jQuery(function($){    $.datepicker.regional['fi'] = {		closeText: 'Sulje',		prevText: '&laquo;Edellinen',		nextText: 'Seuraava&raquo;',		currentText: 'T&auml;n&auml;&auml;n',        monthNames: ['Tammikuu','Helmikuu','Maaliskuu','Huhtikuu','Toukokuu','Kes&auml;kuu',        'Hein&auml;kuu','Elokuu','Syyskuu','Lokakuu','Marraskuu','Joulukuu'],        monthNamesShort: ['Tammi','Helmi','Maalis','Huhti','Touko','Kes&auml;',        'Hein&auml;','Elo','Syys','Loka','Marras','Joulu'],		dayNamesShort: ['Su','Ma','Ti','Ke','To','Pe','Su'],		dayNames: ['Sunnuntai','Maanantai','Tiistai','Keskiviikko','Torstai','Perjantai','Lauantai'],		dayNamesMin: ['Su','Ma','Ti','Ke','To','Pe','La'],		weekHeader: 'Vk',        dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};    $.datepicker.setDefaults($.datepicker.regional['fi']);});/* Faroese initialisation for the jQuery UI date picker plugin *//* Written by Sverri Mohr Olsen, sverrimo@gmail.com */jQuery(function($){	$.datepicker.regional['fo'] = {		closeText: 'Lat aftur',		prevText: '&#x3c;Fyrra',		nextText: 'Nsta&#x3e;',		currentText: ' dag',		monthNames: ['Januar','Februar','Mars','Aprl','Mei','Juni',		'Juli','August','September','Oktober','November','Desember'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Mei','Jun',		'Jul','Aug','Sep','Okt','Nov','Des'],		dayNames: ['Sunnudagur','Mnadagur','Tsdagur','Mikudagur','Hsdagur','Frggjadagur','Leyardagur'],		dayNamesShort: ['Sun','Mn','Ts','Mik','Hs','Fr','Ley'],		dayNamesMin: ['Su','M','T','Mi','H','Fr','Le'],		weekHeader: 'Vk',		dateFormat: 'dd-mm-yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['fo']);});/* Swiss-French initialisation for the jQuery UI date picker plugin. *//* Written Martin Voelkle (martin.voelkle@e-tc.ch). */jQuery(function($){	$.datepicker.regional['fr-CH'] = {		closeText: 'Fermer',		prevText: '&#x3c;Prc',		nextText: 'Suiv&#x3e;',		currentText: 'Courant',		monthNames: ['Janvier','Fvrier','Mars','Avril','Mai','Juin',		'Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],		monthNamesShort: ['Jan','Fv','Mar','Avr','Mai','Jun',		'Jul','Ao','Sep','Oct','Nov','Dc'],		dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],		dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],		dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],		weekHeader: 'Sm',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['fr-CH']);});/* French initialisation for the jQuery UI date picker plugin. *//* Written by Keith Wood (kbwood{at}iinet.com.au),              Stphane Nahmani (sholby@sholby.net),              Stphane Raimbault <stephane.raimbault@gmail.com> */jQuery(function($){	$.datepicker.regional['fr'] = {		closeText: 'Fermer',		prevText: 'Prcdent',		nextText: 'Suivant',		currentText: 'Aujourd\'hui',		monthNames: ['Janvier','Fvrier','Mars','Avril','Mai','Juin',		'Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],		monthNamesShort: ['Janv.','Fvr.','Mars','Avril','Mai','Juin',		'Juil.','Aot','Sept.','Oct.','Nov.','Dc.'],		dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],		dayNamesShort: ['Dim.','Lun.','Mar.','Mer.','Jeu.','Ven.','Sam.'],		dayNamesMin: ['D','L','M','M','J','V','S'],		weekHeader: 'Sem.',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['fr']);});/* Galician localization for 'UI date picker' jQuery extension. *//* Translated by Jorge Barreiro <yortx.barry@gmail.com>. */jQuery(function($){	$.datepicker.regional['gl'] = {		closeText: 'Pechar',		prevText: '&#x3c;Ant',		nextText: 'Seg&#x3e;',		currentText: 'Hoxe',		monthNames: ['Xaneiro','Febreiro','Marzo','Abril','Maio','Xuo',		'Xullo','Agosto','Setembro','Outubro','Novembro','Decembro'],		monthNamesShort: ['Xan','Feb','Mar','Abr','Mai','Xu',		'Xul','Ago','Set','Out','Nov','Dec'],		dayNames: ['Domingo','Luns','Martes','M&eacute;rcores','Xoves','Venres','S&aacute;bado'],		dayNamesShort: ['Dom','Lun','Mar','M&eacute;r','Xov','Ven','S&aacute;b'],		dayNamesMin: ['Do','Lu','Ma','M&eacute;','Xo','Ve','S&aacute;'],		weekHeader: 'Sm',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['gl']);});/* Hebrew initialisation for the UI Datepicker extension. *//* Written by Amir Hardon (ahardon at gmail dot com). */jQuery(function($){	$.datepicker.regional['he'] = {		closeText: '????',		prevText: '&#x3c;?????',		nextText: '???&#x3e;',		currentText: '????',		monthNames: ['?????','??????','???','?????','???','????',		'????','??????','??????','???????','??????','?????'],		monthNamesShort: ['1','2','3','4','5','6',		'7','8','9','10','11','12'],		dayNames: ['?????','???','?????','?????','?????','????','???'],		dayNamesShort: ['?\'','?\'','?\'','?\'','?\'','?\'','???'],		dayNamesMin: ['?\'','?\'','?\'','?\'','?\'','?\'','???'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: true,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['he']);});/* Croatian i18n for the jQuery UI date picker plugin. *//* Written by Vjekoslav Nesek. */jQuery(function($){	$.datepicker.regional['hr'] = {		closeText: 'Zatvori',		prevText: '&#x3c;',		nextText: '&#x3e;',		currentText: 'Danas',		monthNames: ['Sijecanj','Veljaca','Oujak','Travanj','Svibanj','Lipanj',		'Srpanj','Kolovoz','Rujan','Listopad','Studeni','Prosinac'],		monthNamesShort: ['Sij','Velj','Ou','Tra','Svi','Lip',		'Srp','Kol','Ruj','Lis','Stu','Pro'],		dayNames: ['Nedjelja','Ponedjeljak','Utorak','Srijeda','Cetvrtak','Petak','Subota'],		dayNamesShort: ['Ned','Pon','Uto','Sri','Cet','Pet','Sub'],		dayNamesMin: ['Ne','Po','Ut','Sr','Ce','Pe','Su'],		weekHeader: 'Tje',		dateFormat: 'dd.mm.yy.',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['hr']);});/* Hungarian initialisation for the jQuery UI date picker plugin. *//* Written by Istvan Karaszi (jquery@spam.raszi.hu). */jQuery(function($){	$.datepicker.regional['hu'] = {		closeText: 'bezr',		prevText: 'vissza',		nextText: 'elore',		currentText: 'ma',		monthNames: ['Janur', 'Februr', 'Mrcius', 'prilis', 'Mjus', 'Jnius',		'Jlius', 'Augusztus', 'Szeptember', 'Oktber', 'November', 'December'],		monthNamesShort: ['Jan', 'Feb', 'Mr', 'pr', 'Mj', 'Jn',		'Jl', 'Aug', 'Szep', 'Okt', 'Nov', 'Dec'],		dayNames: ['Vasrnap', 'Htfo', 'Kedd', 'Szerda', 'Cstrtk', 'Pntek', 'Szombat'],		dayNamesShort: ['Vas', 'Ht', 'Ked', 'Sze', 'Cs', 'Pn', 'Szo'],		dayNamesMin: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],		weekHeader: 'Ht',		dateFormat: 'yy.mm.dd.',		firstDay: 1,		isRTL: false,		showMonthAfterYear: true,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['hu']);});/* Armenian(UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Levon Zakaryan (levon.zakaryan@gmail.com)*/jQuery(function($){	$.datepicker.regional['hy'] = {		closeText: '?????',		prevText: '&#x3c;???.',		nextText: '???.&#x3e;',		currentText: '?????',		monthNames: ['???????','???????','????','?????','?????','??????',		'??????','???????','?????????','?????????','????????','?????????'],		monthNamesShort: ['?????','????','????','???','?????','??????',		'????','???','???','???','???','???'],		dayNames: ['??????','?????????','?????????','??????????','?????????','??????','?????'],		dayNamesShort: ['???','???','???','???','???','????','???'],		dayNamesMin: ['???','???','???','???','???','????','???'],		weekHeader: '???',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['hy']);});/* Indonesian initialisation for the jQuery UI date picker plugin. *//* Written by Deden Fathurahman (dedenf@gmail.com). */jQuery(function($){	$.datepicker.regional['id'] = {		closeText: 'Tutup',		prevText: '&#x3c;mundur',		nextText: 'maju&#x3e;',		currentText: 'hari ini',		monthNames: ['Januari','Februari','Maret','April','Mei','Juni',		'Juli','Agustus','September','Oktober','Nopember','Desember'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Mei','Jun',		'Jul','Agus','Sep','Okt','Nop','Des'],		dayNames: ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],		dayNamesShort: ['Min','Sen','Sel','Rab','kam','Jum','Sab'],		dayNamesMin: ['Mg','Sn','Sl','Rb','Km','jm','Sb'],		weekHeader: 'Mg',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['id']);});/* Icelandic initialisation for the jQuery UI date picker plugin. *//* Written by Haukur H. Thorsson (haukur@eskill.is). */jQuery(function($){	$.datepicker.regional['is'] = {		closeText: 'Loka',		prevText: '&#x3c; Fyrri',		nextText: 'N&aelig;sti &#x3e;',		currentText: '&Iacute; dag',		monthNames: ['Jan&uacute;ar','Febr&uacute;ar','Mars','Apr&iacute;l','Ma&iacute','J&uacute;n&iacute;',		'J&uacute;l&iacute;','&Aacute;g&uacute;st','September','Okt&oacute;ber','N&oacute;vember','Desember'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Ma&iacute;','J&uacute;n',		'J&uacute;l','&Aacute;g&uacute;','Sep','Okt','N&oacute;v','Des'],		dayNames: ['Sunnudagur','M&aacute;nudagur','&THORN;ri&eth;judagur','Mi&eth;vikudagur','Fimmtudagur','F&ouml;studagur','Laugardagur'],		dayNamesShort: ['Sun','M&aacute;n','&THORN;ri','Mi&eth;','Fim','F&ouml;s','Lau'],		dayNamesMin: ['Su','M&aacute;','&THORN;r','Mi','Fi','F&ouml;','La'],		weekHeader: 'Vika',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['is']);});/* Italian initialisation for the jQuery UI date picker plugin. *//* Written by Antonello Pasella (antonello.pasella@gmail.com). */jQuery(function($){	$.datepicker.regional['it'] = {		closeText: 'Chiudi',		prevText: '&#x3c;Prec',		nextText: 'Succ&#x3e;',		currentText: 'Oggi',		monthNames: ['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno',			'Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],		monthNamesShort: ['Gen','Feb','Mar','Apr','Mag','Giu',			'Lug','Ago','Set','Ott','Nov','Dic'],		dayNames: ['Domenica','Luned&#236','Marted&#236','Mercoled&#236','Gioved&#236','Venerd&#236','Sabato'],		dayNamesShort: ['Dom','Lun','Mar','Mer','Gio','Ven','Sab'],		dayNamesMin: ['Do','Lu','Ma','Me','Gi','Ve','Sa'],		weekHeader: 'Sm',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['it']);});/* Japanese initialisation for the jQuery UI date picker plugin. *//* Written by Kentaro SATO (kentaro@ranvis.com). */jQuery(function($){	$.datepicker.regional['ja'] = {		closeText: '???',		prevText: '&#x3c;?',		nextText: '?&#x3e;',		currentText: '??',		monthNames: ['1?','2?','3?','4?','5?','6?',		'7?','8?','9?','10?','11?','12?'],		monthNamesShort: ['1?','2?','3?','4?','5?','6?',		'7?','8?','9?','10?','11?','12?'],		dayNames: ['???','???','???','???','???','???','???'],		dayNamesShort: ['?','?','?','?','?','?','?'],		dayNamesMin: ['?','?','?','?','?','?','?'],		weekHeader: '?',		dateFormat: 'yy/mm/dd',		firstDay: 0,		isRTL: false,		showMonthAfterYear: true,		yearSuffix: '?'};	$.datepicker.setDefaults($.datepicker.regional['ja']);});/* Kazakh (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Dmitriy Karasyov (dmitriy.karasyov@gmail.com). */jQuery(function($){	$.datepicker.regional['kk'] = {		closeText: '????',		prevText: '&#x3c;???????',		nextText: '??????&#x3e;',		currentText: '?????',		monthNames: ['??????','?????','??????','?????','?????','??????',		'?????','?????','????????','?????','??????','?????????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['????????','????????','????????','????????','????????','????','?????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '??',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['kk']);});/* Korean initialisation for the jQuery calendar extension. *//* Written by DaeKwon Kang (ncrash.dk@gmail.com). */jQuery(function($){	$.datepicker.regional['ko'] = {		closeText: '??',		prevText: '???',		nextText: '???',		currentText: '??',		monthNames: ['1?(JAN)','2?(FEB)','3?(MAR)','4?(APR)','5?(MAY)','6?(JUN)',		'7?(JUL)','8?(AUG)','9?(SEP)','10?(OCT)','11?(NOV)','12?(DEC)'],		monthNamesShort: ['1?(JAN)','2?(FEB)','3?(MAR)','4?(APR)','5?(MAY)','6?(JUN)',		'7?(JUL)','8?(AUG)','9?(SEP)','10?(OCT)','11?(NOV)','12?(DEC)'],		dayNames: ['?','?','?','?','?','?','?'],		dayNamesShort: ['?','?','?','?','?','?','?'],		dayNamesMin: ['?','?','?','?','?','?','?'],		weekHeader: 'Wk',		dateFormat: 'yy-mm-dd',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: '?'};	$.datepicker.setDefaults($.datepicker.regional['ko']);});/* Luxembourgish initialisation for the jQuery UI date picker plugin. *//* Written by Michel Weimerskirch <michel@weimerskirch.net> */jQuery(function($){	$.datepicker.regional['lb'] = {		closeText: 'Ferdeg',		prevText: 'Zrck',		nextText: 'Weider',		currentText: 'Haut',		monthNames: ['Januar','Februar','Merz','Abrll','Mee','Juni',		'Juli','August','September','Oktober','November','Dezember'],		monthNamesShort: ['Jan', 'Feb', 'Me', 'Abr', 'Mee', 'Jun',		'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],		dayNames: ['Sonndeg', 'Mindeg', 'Dnschdeg', 'Mttwoch', 'Donneschdeg', 'Freideg', 'Samschdeg'],		dayNamesShort: ['Son', 'Mi', 'Dn', 'Mt', 'Don', 'Fre', 'Sam'],		dayNamesMin: ['So','M','D','M','Do','Fr','Sa'],		weekHeader: 'W',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['lb']);});/* Lithuanian (UTF-8) initialisation for the jQuery UI date picker plugin. *//* @author Arturas Paleicikas <arturas@avalon.lt> */jQuery(function($){	$.datepicker.regional['lt'] = {		closeText: 'Udaryti',		prevText: '&#x3c;Atgal',		nextText: 'Pirmyn&#x3e;',		currentText: 'iandien',		monthNames: ['Sausis','Vasaris','Kovas','Balandis','Gegue','Birelis',		'Liepa','Rugpjutis','Rugsejis','Spalis','Lapkritis','Gruodis'],		monthNamesShort: ['Sau','Vas','Kov','Bal','Geg','Bir',		'Lie','Rugp','Rugs','Spa','Lap','Gru'],		dayNames: ['sekmadienis','pirmadienis','antradienis','treciadienis','ketvirtadienis','penktadienis','etadienis'],		dayNamesShort: ['sek','pir','ant','tre','ket','pen','e'],		dayNamesMin: ['Se','Pr','An','Tr','Ke','Pe','e'],		weekHeader: 'Wk',		dateFormat: 'yy-mm-dd',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['lt']);});/* Latvian (UTF-8) initialisation for the jQuery UI date picker plugin. *//* @author Arturas Paleicikas <arturas.paleicikas@metasite.net> */jQuery(function($){	$.datepicker.regional['lv'] = {		closeText: 'Aizvert',		prevText: 'Iepr',		nextText: 'Naka',		currentText: 'odien',		monthNames: ['Janvaris','Februaris','Marts','Aprilis','Maijs','Junijs',		'Julijs','Augusts','Septembris','Oktobris','Novembris','Decembris'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Mai','Jun',		'Jul','Aug','Sep','Okt','Nov','Dec'],		dayNames: ['svetdiena','pirmdiena','otrdiena','trediena','ceturtdiena','piektdiena','sestdiena'],		dayNamesShort: ['svt','prm','otr','tre','ctr','pkt','sst'],		dayNamesMin: ['Sv','Pr','Ot','Tr','Ct','Pk','Ss'],		weekHeader: 'Nav',		dateFormat: 'dd-mm-yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['lv']);});/* Macedonian i18n for the jQuery UI date picker plugin. *//* Written by Stojce Slavkovski. */jQuery(function($){	$.datepicker.regional['mk'] = {		closeText: '???????',		prevText: '&#x3C;',		nextText: '&#x3E;',		currentText: '?????',		monthNames: ['???????','????????','????','?????','???','????',		'????','??????','?????????','????????','???????','????????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['??????','??????????','???????','?????','????????','?????','??????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '???',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['mk']);});/* Malayalam (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Saji Nediyanchath (saji89@gmail.com). */jQuery(function($){	$.datepicker.regional['ml'] = {		closeText: '???',		prevText: '?????????',		nextText: '???????? ',		currentText: '?????',		monthNames: ['??????','?????????','?????????','????????','????','?????',		'????','????????','????????????','?????????','???????','????????'],		monthNamesShort: ['???', '????', '?????', '?????', '????', '?????',		'????', '??', '????', '?????', '???', '???'],		dayNames: ['??????', '????????', '?????', '??????', '??????', '??????', '???'],		dayNamesShort: ['???', '?????', '?????', '???', '??????', '??????', '???'],		dayNamesMin: ['??','??','??','??','????','??','?'],		weekHeader: '?',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ml']);});/* Malaysian initialisation for the jQuery UI date picker plugin. *//* Written by Mohd Nawawi Mohamad Jamili (nawawi@ronggeng.net). */jQuery(function($){	$.datepicker.regional['ms'] = {		closeText: 'Tutup',		prevText: '&#x3c;Sebelum',		nextText: 'Selepas&#x3e;',		currentText: 'hari ini',		monthNames: ['Januari','Februari','Mac','April','Mei','Jun',		'Julai','Ogos','September','Oktober','November','Disember'],		monthNamesShort: ['Jan','Feb','Mac','Apr','Mei','Jun',		'Jul','Ogo','Sep','Okt','Nov','Dis'],		dayNames: ['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'],		dayNamesShort: ['Aha','Isn','Sel','Rab','kha','Jum','Sab'],		dayNamesMin: ['Ah','Is','Se','Ra','Kh','Ju','Sa'],		weekHeader: 'Mg',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ms']);});/* Dutch (Belgium) initialisation for the jQuery UI date picker plugin. *//* David De Sloovere @DavidDeSloovere */jQuery(function($){	$.datepicker.regional['nl-BE'] = {		closeText: 'Sluiten',		prevText: '?',		nextText: '?',		currentText: 'Vandaag',		monthNames: ['januari', 'februari', 'maart', 'april', 'mei', 'juni',		'juli', 'augustus', 'september', 'oktober', 'november', 'december'],		monthNamesShort: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun',		'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],		dayNames: ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'],		dayNamesShort: ['zon', 'maa', 'din', 'woe', 'don', 'vri', 'zat'],		dayNamesMin: ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['nl-BE']);});/* Dutch (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Mathias Bynens <http://mathiasbynens.be/> */jQuery(function($){	$.datepicker.regional.nl = {		closeText: 'Sluiten',		prevText: '?',		nextText: '?',		currentText: 'Vandaag',		monthNames: ['januari', 'februari', 'maart', 'april', 'mei', 'juni',		'juli', 'augustus', 'september', 'oktober', 'november', 'december'],		monthNamesShort: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun',		'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],		dayNames: ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'],		dayNamesShort: ['zon', 'maa', 'din', 'woe', 'don', 'vri', 'zat'],		dayNamesMin: ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'],		weekHeader: 'Wk',		dateFormat: 'dd-mm-yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional.nl);});/* Norwegian initialisation for the jQuery UI date picker plugin. *//* Written by Naimdjon Takhirov (naimdjon@gmail.com). */jQuery(function($){  $.datepicker.regional['no'] = {    closeText: 'Lukk',    prevText: '&laquo;Forrige',    nextText: 'Neste&raquo;',    currentText: 'I dag',    monthNames: ['januar','februar','mars','april','mai','juni','juli','august','september','oktober','november','desember'],    monthNamesShort: ['jan','feb','mar','apr','mai','jun','jul','aug','sep','okt','nov','des'],    dayNamesShort: ['sn','man','tir','ons','tor','fre','lr'],    dayNames: ['sndag','mandag','tirsdag','onsdag','torsdag','fredag','lrdag'],    dayNamesMin: ['s','ma','ti','on','to','fr','l'],    weekHeader: 'Uke',    dateFormat: 'dd.mm.yy',    firstDay: 1,    isRTL: false,    showMonthAfterYear: false,    yearSuffix: ''  };  $.datepicker.setDefaults($.datepicker.regional['no']);});/* Polish initialisation for the jQuery UI date picker plugin. *//* Written by Jacek Wysocki (jacek.wysocki@gmail.com). */jQuery(function($){	$.datepicker.regional['pl'] = {		closeText: 'Zamknij',		prevText: '&#x3c;Poprzedni',		nextText: 'Nastepny&#x3e;',		currentText: 'Dzis',		monthNames: ['Styczen','Luty','Marzec','Kwiecien','Maj','Czerwiec',		'Lipiec','Sierpien','Wrzesien','Pazdziernik','Listopad','Grudzien'],		monthNamesShort: ['Sty','Lu','Mar','Kw','Maj','Cze',		'Lip','Sie','Wrz','Pa','Lis','Gru'],		dayNames: ['Niedziela','Poniedzialek','Wtorek','Sroda','Czwartek','Piatek','Sobota'],		dayNamesShort: ['Nie','Pn','Wt','Sr','Czw','Pt','So'],		dayNamesMin: ['N','Pn','Wt','Sr','Cz','Pt','So'],		weekHeader: 'Tydz',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['pl']);});/* Brazilian initialisation for the jQuery UI date picker plugin. *//* Written by Leonildo Costa Silva (leocsilva@gmail.com). */jQuery(function($){	$.datepicker.regional['pt-BR'] = {		closeText: 'Fechar',		prevText: '&#x3c;Anterior',		nextText: 'Pr&oacute;ximo&#x3e;',		currentText: 'Hoje',		monthNames: ['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho',		'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],		monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun',		'Jul','Ago','Set','Out','Nov','Dez'],		dayNames: ['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],		dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],		dayNamesMin: ['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],		weekHeader: 'Sm',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['pt-BR']);});/* Portuguese initialisation for the jQuery UI date picker plugin. */jQuery(function($){	$.datepicker.regional['pt'] = {		closeText: 'Fechar',		prevText: '&#x3c;Anterior',		nextText: 'Seguinte',		currentText: 'Hoje',		monthNames: ['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho',		'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],		monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun',		'Jul','Ago','Set','Out','Nov','Dez'],		dayNames: ['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],		dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],		dayNamesMin: ['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],		weekHeader: 'Sem',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['pt']);});/* Romansh initialisation for the jQuery UI date picker plugin. *//* Written by Yvonne Gienal (yvonne.gienal@educa.ch). */jQuery(function($){	$.datepicker.regional['rm'] = {		closeText: 'Serrar',		prevText: '&#x3c;Suandant',		nextText: 'Precedent&#x3e;',		currentText: 'Actual',		monthNames: ['Schaner','Favrer','Mars','Avrigl','Matg','Zercladur', 'Fanadur','Avust','Settember','October','November','December'],		monthNamesShort: ['Scha','Fev','Mar','Avr','Matg','Zer', 'Fan','Avu','Sett','Oct','Nov','Dec'],		dayNames: ['Dumengia','Glindesdi','Mardi','Mesemna','Gievgia','Venderdi','Sonda'],		dayNamesShort: ['Dum','Gli','Mar','Mes','Gie','Ven','Som'],		dayNamesMin: ['Du','Gl','Ma','Me','Gi','Ve','So'],		weekHeader: 'emna',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['rm']);});/* Romanian initialisation for the jQuery UI date picker plugin. * * Written by Edmond L. (ll_edmond@walla.com) * and Ionut G. Stan (ionut.g.stan@gmail.com) */jQuery(function($){	$.datepicker.regional['ro'] = {		closeText: 'nchide',		prevText: '&laquo; Luna precedenta',		nextText: 'Luna urmatoare &raquo;',		currentText: 'Azi',		monthNames: ['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie',		'Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'],		monthNamesShort: ['Ian', 'Feb', 'Mar', 'Apr', 'Mai', 'Iun',		'Iul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],		dayNames: ['Duminica', 'Luni', 'Marti', 'Miercuri', 'Joi', 'Vineri', 'Smbata'],		dayNamesShort: ['Dum', 'Lun', 'Mar', 'Mie', 'Joi', 'Vin', 'Sm'],		dayNamesMin: ['Du','Lu','Ma','Mi','Jo','Vi','S'],		weekHeader: 'Sapt',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ro']);});/* Russian (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Andrew Stromnov (stromnov@gmail.com). */jQuery(function($){	$.datepicker.regional['ru'] = {		closeText: '???????',		prevText: '&#x3c;????',		nextText: '????&#x3e;',		currentText: '???????',		monthNames: ['??????','???????','????','??????','???','????',		'????','??????','????????','???????','??????','???????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['???????????','???????????','???????','?????','???????','???????','???????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '???',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ru']);});/* Slovak initialisation for the jQuery UI date picker plugin. *//* Written by Vojtech Rinik (vojto@hmm.sk). */jQuery(function($){	$.datepicker.regional['sk'] = {		closeText: 'Zavriet',		prevText: '&#x3c;Predchdzajci',		nextText: 'Nasledujci&#x3e;',		currentText: 'Dnes',		monthNames: ['Janur','Februr','Marec','Aprl','Mj','Jn',		'Jl','August','September','Oktber','November','December'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Mj','Jn',		'Jl','Aug','Sep','Okt','Nov','Dec'],		dayNames: ['Nedela','Pondelok','Utorok','Streda','tvrtok','Piatok','Sobota'],		dayNamesShort: ['Ned','Pon','Uto','Str','tv','Pia','Sob'],		dayNamesMin: ['Ne','Po','Ut','St','t','Pia','So'],		weekHeader: 'Ty',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['sk']);});/* Slovenian initialisation for the jQuery UI date picker plugin. *//* Written by Jaka Jancar (jaka@kubje.org). *//* c = &#x10D;, s = &#x161; z = &#x17E; C = &#x10C; S = &#x160; Z = &#x17D; */jQuery(function($){	$.datepicker.regional['sl'] = {		closeText: 'Zapri',		prevText: '&lt;Prej&#x161;nji',		nextText: 'Naslednji&gt;',		currentText: 'Trenutni',		monthNames: ['Januar','Februar','Marec','April','Maj','Junij',		'Julij','Avgust','September','Oktober','November','December'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',		'Jul','Avg','Sep','Okt','Nov','Dec'],		dayNames: ['Nedelja','Ponedeljek','Torek','Sreda','&#x10C;etrtek','Petek','Sobota'],		dayNamesShort: ['Ned','Pon','Tor','Sre','&#x10C;et','Pet','Sob'],		dayNamesMin: ['Ne','Po','To','Sr','&#x10C;e','Pe','So'],		weekHeader: 'Teden',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['sl']);});/* Albanian initialisation for the jQuery UI date picker plugin. *//* Written by Flakron Bytyqi (flakron@gmail.com). */jQuery(function($){	$.datepicker.regional['sq'] = {		closeText: 'mbylle',		prevText: '&#x3c;mbrapa',		nextText: 'Prpara&#x3e;',		currentText: 'sot',		monthNames: ['Janar','Shkurt','Mars','Prill','Maj','Qershor',		'Korrik','Gusht','Shtator','Tetor','Nntor','Dhjetor'],		monthNamesShort: ['Jan','Shk','Mar','Pri','Maj','Qer',		'Kor','Gus','Sht','Tet','Nn','Dhj'],		dayNames: ['E Diel','E Hn','E Mart','E Mrkur','E Enjte','E Premte','E Shtune'],		dayNamesShort: ['Di','H','Ma','M','En','Pr','Sh'],		dayNamesMin: ['Di','H','Ma','M','En','Pr','Sh'],		weekHeader: 'Ja',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['sq']);});/* Serbian i18n for the jQuery UI date picker plugin. *//* Written by Dejan Dimic. */jQuery(function($){	$.datepicker.regional['sr-SR'] = {		closeText: 'Zatvori',		prevText: '&#x3c;',		nextText: '&#x3e;',		currentText: 'Danas',		monthNames: ['Januar','Februar','Mart','April','Maj','Jun',		'Jul','Avgust','Septembar','Oktobar','Novembar','Decembar'],		monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',		'Jul','Avg','Sep','Okt','Nov','Dec'],		dayNames: ['Nedelja','Ponedeljak','Utorak','Sreda','Cetvrtak','Petak','Subota'],		dayNamesShort: ['Ned','Pon','Uto','Sre','Cet','Pet','Sub'],		dayNamesMin: ['Ne','Po','Ut','Sr','Ce','Pe','Su'],		weekHeader: 'Sed',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['sr-SR']);});/* Serbian i18n for the jQuery UI date picker plugin. *//* Written by Dejan Dimic. */jQuery(function($){	$.datepicker.regional['sr'] = {		closeText: '???????',		prevText: '&#x3c;',		nextText: '&#x3e;',		currentText: '?????',		monthNames: ['??????','???????','????','?????','???','???',		'???','??????','?????????','???????','????????','????????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['??????','?????????','??????','?????','????????','?????','??????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '???',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['sr']);});/* Swedish initialisation for the jQuery UI date picker plugin. *//* Written by Anders Ekdahl ( anders@nomadiz.se). */jQuery(function($){    $.datepicker.regional['sv'] = {		closeText: 'Stng',        prevText: '&laquo;Frra',		nextText: 'Nsta&raquo;',		currentText: 'Idag',        monthNames: ['Januari','Februari','Mars','April','Maj','Juni',        'Juli','Augusti','September','Oktober','November','December'],        monthNamesShort: ['Jan','Feb','Mar','Apr','Maj','Jun',        'Jul','Aug','Sep','Okt','Nov','Dec'],		dayNamesShort: ['Sn','Mn','Tis','Ons','Tor','Fre','Lr'],		dayNames: ['Sndag','Mndag','Tisdag','Onsdag','Torsdag','Fredag','Lrdag'],		dayNamesMin: ['S','M','Ti','On','To','Fr','L'],		weekHeader: 'Ve',        dateFormat: 'yy-mm-dd',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};    $.datepicker.setDefaults($.datepicker.regional['sv']);});/* Tamil (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by S A Sureshkumar (saskumar@live.com). */jQuery(function($){	$.datepicker.regional['ta'] = {		closeText: '????',		prevText: '?????????',		nextText: '????????',		currentText: '?????',		monthNames: ['??','????','???????','????????','??????','???',		'???','????','?????????','??????','??????????','???????'],		monthNamesShort: ['??','????','???','????','????','???',		'???','??','???','???','????','????'],		dayNames: ['???????????????','????????????','???????????????','??????????','????????????','?????????????','??????????'],		dayNamesShort: ['??????','???????','????????','?????','???????','??????','???'],		dayNamesMin: ['??','??','??','??','??','??','?'],		weekHeader: '??',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['ta']);});/* Thai initialisation for the jQuery UI date picker plugin. *//* Written by pipo (pipo@sixhead.com). */jQuery(function($){	$.datepicker.regional['th'] = {		closeText: '???',		prevText: '&laquo;&nbsp;????',		nextText: '?????&nbsp;&raquo;',		currentText: '??????',		monthNames: ['??????','??????????','??????','??????','???????','????????',		'???????','???????','???????','??????','?????????','???????'],		monthNamesShort: ['?.?.','?.?.','??.?.','??.?.','?.?.','??.?.',		'?.?.','?.?.','?.?.','?.?.','?.?.','?.?.'],		dayNames: ['???????','??????','??????','???','????????','?????','?????'],		dayNamesShort: ['??.','?.','?.','?.','??.','?.','?.'],		dayNamesMin: ['??.','?.','?.','?.','??.','?.','?.'],		weekHeader: 'Wk',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['th']);});/* Tajiki (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Abdurahmon Saidov (saidovab@gmail.com). */jQuery(function($){	$.datepicker.regional['tj'] = {		closeText: '?????',		prevText: '&#x3c;????',		nextText: '???&#x3e;',		currentText: '?????',		monthNames: ['?????','??????','????','?????','???','???',		'???','??????','???????','??????','?????','??????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['???????','???????','???????','????????','?????????','?????','?????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '??',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['tj']);});/* Turkish initialisation for the jQuery UI date picker plugin. *//* Written by Izzet Emre Erkan (kara@karalamalar.net). */jQuery(function($){	$.datepicker.regional['tr'] = {		closeText: 'kapat',		prevText: '&#x3c;geri',		nextText: 'ileri&#x3e',		currentText: 'bugn',		monthNames: ['Ocak','Subat','Mart','Nisan','Mayis','Haziran',		'Temmuz','Agustos','Eyll','Ekim','Kasim','Aralik'],		monthNamesShort: ['Oca','Sub','Mar','Nis','May','Haz',		'Tem','Agu','Eyl','Eki','Kas','Ara'],		dayNames: ['Pazar','Pazartesi','Sali','arsamba','Persembe','Cuma','Cumartesi'],		dayNamesShort: ['Pz','Pt','Sa','a','Pe','Cu','Ct'],		dayNamesMin: ['Pz','Pt','Sa','a','Pe','Cu','Ct'],		weekHeader: 'Hf',		dateFormat: 'dd.mm.yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['tr']);});/* Ukrainian (UTF-8) initialisation for the jQuery UI date picker plugin. *//* Written by Maxim Drogobitskiy (maxdao@gmail.com). *//* Corrected by Igor Milla (igor.fsp.milla@gmail.com). */jQuery(function($){	$.datepicker.regional['uk'] = {		closeText: '???????',		prevText: '&#x3c;',		nextText: '&#x3e;',		currentText: '????????',		monthNames: ['??????','?????','????????','???????','???????','???????',		'??????','???????','????????','???????','????????','???????'],		monthNamesShort: ['???','???','???','???','???','???',		'???','???','???','???','???','???'],		dayNames: ['??????','?????????','????????','??????','??????','???????','??????'],		dayNamesShort: ['???','???','???','???','???','???','???'],		dayNamesMin: ['??','??','??','??','??','??','??'],		weekHeader: '???',		dateFormat: 'dd/mm/yy',		firstDay: 1,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['uk']);});/* Vietnamese initialisation for the jQuery UI date picker plugin. *//* Translated by Le Thanh Huy (lthanhhuy@cit.ctu.edu.vn). */jQuery(function($){	$.datepicker.regional['vi'] = {		closeText: 'ng',		prevText: '&#x3c;Tru?c',		nextText: 'Ti?p&#x3e;',		currentText: 'Hm nay',		monthNames: ['Thng M?t', 'Thng Hai', 'Thng Ba', 'Thng Tu', 'Thng Nam', 'Thng Su',		'Thng B?y', 'Thng Tm', 'Thng Chn', 'Thng Mu?i', 'Thng Mu?i M?t', 'Thng Mu?i Hai'],		monthNamesShort: ['Thng 1', 'Thng 2', 'Thng 3', 'Thng 4', 'Thng 5', 'Thng 6',		'Thng 7', 'Thng 8', 'Thng 9', 'Thng 10', 'Thng 11', 'Thng 12'],		dayNames: ['Ch? Nh?t', 'Th? Hai', 'Th? Ba', 'Th? Tu', 'Th? Nam', 'Th? Su', 'Th? B?y'],		dayNamesShort: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],		dayNamesMin: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],		weekHeader: 'Tu',		dateFormat: 'dd/mm/yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['vi']);});/* Chinese initialisation for the jQuery UI date picker plugin. *//* Written by Cloudream (cloudream@gmail.com). */jQuery(function($){	$.datepicker.regional['zh-CN'] = {		closeText: '??',		prevText: '&#x3c;??',		nextText: '??&#x3e;',		currentText: '??',		monthNames: ['??','??','??','??','??','??',		'??','??','??','??','???','???'],		monthNamesShort: ['?','?','?','?','?','?',		'?','?','?','?','??','??'],		dayNames: ['???','???','???','???','???','???','???'],		dayNamesShort: ['??','??','??','??','??','??','??'],		dayNamesMin: ['?','?','?','?','?','?','?'],		weekHeader: '?',		dateFormat: 'yy-mm-dd',		firstDay: 1,		isRTL: false,		showMonthAfterYear: true,		yearSuffix: '?'};	$.datepicker.setDefaults($.datepicker.regional['zh-CN']);});/* Chinese initialisation for the jQuery UI date picker plugin. *//* Written by SCCY (samuelcychan@gmail.com). */jQuery(function($){	$.datepicker.regional['zh-HK'] = {		closeText: '??',		prevText: '&#x3c;??',		nextText: '??&#x3e;',		currentText: '??',		monthNames: ['??','??','??','??','??','??',		'??','??','??','??','???','???'],		monthNamesShort: ['?','?','?','?','?','?',		'?','?','?','?','??','??'],		dayNames: ['???','???','???','???','???','???','???'],		dayNamesShort: ['??','??','??','??','??','??','??'],		dayNamesMin: ['?','?','?','?','?','?','?'],		weekHeader: '?',		dateFormat: 'dd-mm-yy',		firstDay: 0,		isRTL: false,		showMonthAfterYear: true,		yearSuffix: '?'};	$.datepicker.setDefaults($.datepicker.regional['zh-HK']);});/* Chinese initialisation for the jQuery UI date picker plugin. *//* Written by Ressol (ressol@gmail.com). */jQuery(function($){	$.datepicker.regional['zh-TW'] = {		closeText: '??',		prevText: '&#x3c;??',		nextText: '??&#x3e;',		currentText: '??',		monthNames: ['??','??','??','??','??','??',		'??','??','??','??','???','???'],		monthNamesShort: ['?','?','?','?','?','?',		'?','?','?','?','??','??'],		dayNames: ['???','???','???','???','???','???','???'],		dayNamesShort: ['??','??','??','??','??','??','??'],		dayNamesMin: ['?','?','?','?','?','?','?'],		weekHeader: '?',		dateFormat: 'yy/mm/dd',		firstDay: 1,		isRTL: false,		showMonthAfterYear: true,		yearSuffix: '?'};	$.datepicker.setDefaults($.datepicker.regional['zh-TW']);});/* Quick fix for Safari on Mac US and others. *//* Added by sebastien.courvoisier@4d.com. */jQuery(function($){	$.datepicker.regional['en-us'] = {		closeText: 'Done',		prevText: 'Prev',		nextText: 'Next',		currentText: 'Today',		monthNames: ['January','February','March','April','May','June',			'July','August','September','October','November','December'],		monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],		dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],		dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],		dayNamesMin: ['Su','Mo','Tu','We','Th','Fr','Sa'],		weekHeader: 'Wk',		dateFormat: 'mm/dd/yy',        firstDay: 0,		isRTL: false,		showMonthAfterYear: false,		yearSuffix: ''};	$.datepicker.setDefaults($.datepicker.regional['en-us']);});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/raphael/raphael-min.js*//* * Raphael 1.5.2 - JavaScript Vector Library * * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com) * Licensed under the MIT (http://raphaeljs.com/license.html) license. */(function(){function a(){if(a.is(arguments[0],G)){var b=arguments[0],d=bV[m](a,b.splice(0,3+a.is(b[0],E))),e=d.set();for(var g=0,h=b[w];g<h;g++){var i=b[g]||{};c[f](i.type)&&e[L](d[i.type]().attr(i))}return e}return bV[m](a,arguments)}a.version="1.5.2";var b=/[, ]+/,c={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},d=/\{(\d+)\}/g,e="prototype",f="hasOwnProperty",g=document,h=window,i={was:Object[e][f].call(h,"Raphael"),is:h.Raphael},j=function(){this.customAttributes={}},k,l="appendChild",m="apply",n="concat",o="createTouch"in g,p="",q=" ",r=String,s="split",t="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[s](q),u={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},v="join",w="length",x=r[e].toLowerCase,y=Math,z=y.max,A=y.min,B=y.abs,C=y.pow,D=y.PI,E="number",F="string",G="array",H="toString",I="fill",J=Object[e][H],K={},L="push",M=/^url\(['"]?([^\)]+?)['"]?\)$/i,N=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,O={"NaN":1,Infinity:1,"-Infinity":1},P=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Q=y.round,R="setAttribute",S=parseFloat,T=parseInt,U=" progid:DXImageTransform.Microsoft",V=r[e].toUpperCase,W={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:"10px \"Arial\"","font-family":"\"Arial\"","font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},X={along:"along",blur:E,"clip-rect":"csv",cx:E,cy:E,fill:"colour","fill-opacity":E,"font-size":E,height:E,opacity:E,path:"path",r:E,rotation:"csv",rx:E,ry:E,scale:"csv",stroke:"colour","stroke-opacity":E,"stroke-width":E,translation:"csv",width:E,x:E,y:E},Y="replace",Z=/^(from|to|\d+%?)$/,$=/\s*,\s*/,_={hs:1,rg:1},ba=/,?([achlmqrstvxz]),?/gi,bb=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,bc=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,bd=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,be=function(a,b){return a.key-b.key};a.type=h.SVGAngle||g.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(a.type=="VML"){var bf=g.createElement("div"),bg;bf.innerHTML="<v:shape adj=\"1\"/>";bg=bf.firstChild;bg.style.behavior="url(#default#VML)";if(!(bg&&typeof bg.adj=="object"))return a.type=null;bf=null}a.svg=!(a.vml=a.type=="VML");j[e]=a[e];k=j[e];a._id=0;a._oid=0;a.fn={};a.is=function(a,b){b=x.call(b);if(b=="finite")return!O[f](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||J.call(a).slice(8,-1).toLowerCase()==b};a.angle=function(b,c,d,e,f,g){{if(f==null){var h=b-d,i=c-e;if(!h&&!i)return 0;return((h<0)*180+y.atan(-i/-h)*180/D+360)%360}return a.angle(b,c,f,g)-a.angle(d,e,f,g)}};a.rad=function(a){return a%360*D/180};a.deg=function(a){return a*180/D%360};a.snapTo=function(b,c,d){d=a.is(d,"finite")?d:10;if(a.is(b,G)){var e=b.length;while(e--)if(B(b[e]-c)<=d)return b[e]}else{b=+b;var f=c%b;if(f<d)return c-f;if(f>b-d)return c-f+b}return c};function bh(){var a=[],b=0;for(;b<32;b++)a[b]=(~(~(y.random()*16)))[H](16);a[12]=4;a[16]=(a[16]&3|8)[H](16);return"r-"+a[v]("")}a.setWindow=function(a){h=a;g=h.document};var bi=function(b){if(a.vml){var c=/^\s+|\s+$/g,d;try{var e=new ActiveXObject("htmlfile");e.write("<body>");e.close();d=e.body}catch(a){d=createPopup().document.body}var f=d.createTextRange();bi=bm(function(a){try{d.style.color=r(a)[Y](c,p);var b=f.queryCommandValue("ForeColor");b=(b&255)<<16|b&65280|(b&16711680)>>>16;return"#"+("000000"+b[H](16)).slice(-6)}catch(a){return"none"}})}else{var h=g.createElement("i");h.title="Raphal Colour Picker";h.style.display="none";g.body[l](h);bi=bm(function(a){h.style.color=a;return g.defaultView.getComputedStyle(h,p).getPropertyValue("color")})}return bi(b)},bj=function(){return"hsb("+[this.h,this.s,this.b]+")"},bk=function(){return"hsl("+[this.h,this.s,this.l]+")"},bl=function(){return this.hex};a.hsb2rgb=function(b,c,d,e){if(a.is(b,"object")&&"h"in b&&"s"in b&&"b"in b){d=b.b;c=b.s;b=b.h;e=b.o}return a.hsl2rgb(b,c,d/2,e)};a.hsl2rgb=function(b,c,d,e){if(a.is(b,"object")&&"h"in b&&"s"in b&&"l"in b){d=b.l;c=b.s;b=b.h}if(b>1||c>1||d>1){b/=360;c/=100;d/=100}var f={},g=["r","g","b"],h,i,j,k,l,m;if(c){d<0.5?h=d*(1+c):h=d+c-d*c;i=2*d-h;for(var n=0;n<3;n++){j=b+1/3*-(n-1);j<0&&j++;j>1&&j--;j*6<1?f[g[n]]=i+(h-i)*6*j:j*2<1?f[g[n]]=h:j*3<2?f[g[n]]=i+(h-i)*(2/3-j)*6:f[g[n]]=i}}else f={r:d,g:d,b:d};f.r*=255;f.g*=255;f.b*=255;f.hex="#"+(16777216|f.b|f.g<<8|f.r<<16).toString(16).slice(1);a.is(e,"finite")&&(f.opacity=e);f.toString=bl;return f};a.rgb2hsb=function(b,c,d){if(c==null&&a.is(b,"object")&&"r"in b&&"g"in b&&"b"in b){d=b.b;c=b.g;b=b.r}if(c==null&&a.is(b,F)){var e=a.getRGB(b);b=e.r;c=e.g;d=e.b}if(b>1||c>1||d>1){b/=255;c/=255;d/=255}var f=z(b,c,d),g=A(b,c,d),h,i,j=f;{if(g==f)return{h:0,s:0,b:f,toString:bj};var k=f-g;i=k/f;b==f?h=(c-d)/k:c==f?h=2+(d-b)/k:h=4+(b-c)/k;h/=6;h<0&&h++;h>1&&h--}return{h:h,s:i,b:j,toString:bj}};a.rgb2hsl=function(b,c,d){if(c==null&&a.is(b,"object")&&"r"in b&&"g"in b&&"b"in b){d=b.b;c=b.g;b=b.r}if(c==null&&a.is(b,F)){var e=a.getRGB(b);b=e.r;c=e.g;d=e.b}if(b>1||c>1||d>1){b/=255;c/=255;d/=255}var f=z(b,c,d),g=A(b,c,d),h,i,j=(f+g)/2,k;if(g==f)k={h:0,s:0,l:j};else{var l=f-g;i=j<0.5?l/(f+g):l/(2-f-g);b==f?h=(c-d)/l:c==f?h=2+(d-b)/l:h=4+(b-c)/l;h/=6;h<0&&h++;h>1&&h--;k={h:h,s:i,l:j}}k.toString=bk;return k};a._path2string=function(){return this.join(",")[Y](ba,"$1")};function bm(a,b,c){function d(){var g=Array[e].slice.call(arguments,0),h=g[v]("?"),i=d.cache=d.cache||{},j=d.count=d.count||[];if(i[f](h))return c?c(i[h]):i[h];j[w]>=1000&&delete i[j.shift()];j[L](h);i[h]=a[m](b,g);return c?c(i[h]):i[h]}return d}a.getRGB=bm(function(b){if(!b||!(!((b=r(b)).indexOf("-")+1)))return{r:-1,g:-1,b:-1,hex:"none",error:1};if(b=="none")return{r:-1,g:-1,b:-1,hex:"none"};!(_[f](b.toLowerCase().substring(0,2))||b.charAt()=="#")&&(b=bi(b));var c,d,e,g,h,i,j,k=b.match(N);if(k){if(k[2]){g=T(k[2].substring(5),16);e=T(k[2].substring(3,5),16);d=T(k[2].substring(1,3),16)}if(k[3]){g=T((i=k[3].charAt(3))+i,16);e=T((i=k[3].charAt(2))+i,16);d=T((i=k[3].charAt(1))+i,16)}if(k[4]){j=k[4][s]($);d=S(j[0]);j[0].slice(-1)=="%"&&(d*=2.55);e=S(j[1]);j[1].slice(-1)=="%"&&(e*=2.55);g=S(j[2]);j[2].slice(-1)=="%"&&(g*=2.55);k[1].toLowerCase().slice(0,4)=="rgba"&&(h=S(j[3]));j[3]&&j[3].slice(-1)=="%"&&(h/=100)}if(k[5]){j=k[5][s]($);d=S(j[0]);j[0].slice(-1)=="%"&&(d*=2.55);e=S(j[1]);j[1].slice(-1)=="%"&&(e*=2.55);g=S(j[2]);j[2].slice(-1)=="%"&&(g*=2.55);(j[0].slice(-3)=="deg"||j[0].slice(-1)=="")&&(d/=360);k[1].toLowerCase().slice(0,4)=="hsba"&&(h=S(j[3]));j[3]&&j[3].slice(-1)=="%"&&(h/=100);return a.hsb2rgb(d,e,g,h)}if(k[6]){j=k[6][s]($);d=S(j[0]);j[0].slice(-1)=="%"&&(d*=2.55);e=S(j[1]);j[1].slice(-1)=="%"&&(e*=2.55);g=S(j[2]);j[2].slice(-1)=="%"&&(g*=2.55);(j[0].slice(-3)=="deg"||j[0].slice(-1)=="")&&(d/=360);k[1].toLowerCase().slice(0,4)=="hsla"&&(h=S(j[3]));j[3]&&j[3].slice(-1)=="%"&&(h/=100);return a.hsl2rgb(d,e,g,h)}k={r:d,g:e,b:g};k.hex="#"+(16777216|g|e<<8|d<<16).toString(16).slice(1);a.is(h,"finite")&&(k.opacity=h);return k}return{r:-1,g:-1,b:-1,hex:"none",error:1}},a);a.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75},c=this.hsb2rgb(b.h,b.s,b.b);b.h+=0.075;if(b.h>1){b.h=0;b.s-=0.2;b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})}return c.hex};a.getColor.reset=function(){delete this.start};a.parsePathString=bm(function(b){if(!b)return null;var c={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},d=[];a.is(b,G)&&a.is(b[0],G)&&(d=bo(b));d[w]||r(b)[Y](bb,function(a,b,e){var f=[],g=x.call(b);e[Y](bc,function(a,b){b&&f[L](+b)});if(g=="m"&&f[w]>2){d[L]([b][n](f.splice(0,2)));g="l";b=b=="m"?"l":"L"}while(f[w]>=c[g]){d[L]([b][n](f.splice(0,c[g])));if(!c[g])break}});d[H]=a._path2string;return d});a.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=C(j,3)*a+C(j,2)*3*i*c+j*3*i*i*e+C(i,3)*g,l=C(j,3)*b+C(j,2)*3*i*d+j*3*i*i*f+C(i,3)*h,m=a+2*i*(c-a)+i*i*(e-2*c+a),n=b+2*i*(d-b)+i*i*(f-2*d+b),o=c+2*i*(e-c)+i*i*(g-2*e+c),p=d+2*i*(f-d)+i*i*(h-2*f+d),q=(1-i)*a+i*c,r=(1-i)*b+i*d,s=(1-i)*e+i*g,t=(1-i)*f+i*h,u=90-y.atan((m-o)/(n-p))*180/D;(m>o||n<p)&&(u+=180);return{x:k,y:l,m:{x:m,y:n},n:{x:o,y:p},start:{x:q,y:r},end:{x:s,y:t},alpha:u}};var bn=bm(function(a){if(!a)return{x:0,y:0,width:0,height:0};a=bw(a);var b=0,c=0,d=[],e=[],f;for(var g=0,h=a[w];g<h;g++){f=a[g];if(f[0]=="M"){b=f[1];c=f[2];d[L](b);e[L](c)}else{var i=bv(b,c,f[1],f[2],f[3],f[4],f[5],f[6]);d=d[n](i.min.x,i.max.x);e=e[n](i.min.y,i.max.y);b=f[5];c=f[6]}}var j=A[m](0,d),k=A[m](0,e);return{x:j,y:k,width:z[m](0,d)-j,height:z[m](0,e)-k}}),bo=function(b){var c=[];if(!a.is(b,G)||!a.is(b&&b[0],G))b=a.parsePathString(b);for(var d=0,e=b[w];d<e;d++){c[d]=[];for(var f=0,g=b[d][w];f<g;f++)c[d][f]=b[d][f]}c[H]=a._path2string;return c},bp=bm(function(b){if(!a.is(b,G)||!a.is(b&&b[0],G))b=a.parsePathString(b);var c=[],d=0,e=0,f=0,g=0,h=0;if(b[0][0]=="M"){d=b[0][1];e=b[0][2];f=d;g=e;h++;c[L](["M",d,e])}for(var i=h,j=b[w];i<j;i++){var k=c[i]=[],l=b[i];if(l[0]!=x.call(l[0])){k[0]=x.call(l[0]);switch(k[0]){case"a":k[1]=l[1];k[2]=l[2];k[3]=l[3];k[4]=l[4];k[5]=l[5];k[6]=+(l[6]-d).toFixed(3);k[7]=+(l[7]-e).toFixed(3);break;case"v":k[1]=+(l[1]-e).toFixed(3);break;case"m":f=l[1];g=l[2];default:for(var m=1,n=l[w];m<n;m++)k[m]=+(l[m]-(m%2?d:e)).toFixed(3)}}else{k=c[i]=[];if(l[0]=="m"){f=l[1]+d;g=l[2]+e}for(var o=0,p=l[w];o<p;o++)c[i][o]=l[o]}var q=c[i][w];switch(c[i][0]){case"z":d=f;e=g;break;case"h":d+=+c[i][q-1];break;case"v":e+=+c[i][q-1];break;default:d+=+c[i][q-2];e+=+c[i][q-1]}}c[H]=a._path2string;return c},0,bo),bq=bm(function(b){if(!a.is(b,G)||!a.is(b&&b[0],G))b=a.parsePathString(b);var c=[],d=0,e=0,f=0,g=0,h=0;if(b[0][0]=="M"){d=+b[0][1];e=+b[0][2];f=d;g=e;h++;c[0]=["M",d,e]}for(var i=h,j=b[w];i<j;i++){var k=c[i]=[],l=b[i];if(l[0]!=V.call(l[0])){k[0]=V.call(l[0]);switch(k[0]){case"A":k[1]=l[1];k[2]=l[2];k[3]=l[3];k[4]=l[4];k[5]=l[5];k[6]=+(l[6]+d);k[7]=+(l[7]+e);break;case"V":k[1]=+l[1]+e;break;case"H":k[1]=+l[1]+d;break;case"M":f=+l[1]+d;g=+l[2]+e;default:for(var m=1,n=l[w];m<n;m++)k[m]=+l[m]+(m%2?d:e)}}else for(var o=0,p=l[w];o<p;o++)c[i][o]=l[o];switch(k[0]){case"Z":d=f;e=g;break;case"H":d=k[1];break;case"V":e=k[1];break;case"M":f=c[i][c[i][w]-2];g=c[i][c[i][w]-1];default:d=c[i][c[i][w]-2];e=c[i][c[i][w]-1]}}c[H]=a._path2string;return c},null,bo),br=function(a,b,c,d){return[a,b,c,d,c,d]},bs=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},bt=function(a,b,c,d,e,f,g,h,i,j){var k=D*120/180,l=D/180*(+e||0),m=[],o,p=bm(function(a,b,c){var d=a*y.cos(c)-b*y.sin(c),e=a*y.sin(c)+b*y.cos(c);return{x:d,y:e}});if(j){G=j[0];H=j[1];E=j[2];F=j[3]}else{o=p(a,b,-l);a=o.x;b=o.y;o=p(h,i,-l);h=o.x;i=o.y;var q=y.cos(D/180*e),r=y.sin(D/180*e),t=(a-h)/2,u=(b-i)/2,x=t*t/(c*c)+u*u/(d*d);if(x>1){x=y.sqrt(x);c=x*c;d=x*d}var z=c*c,A=d*d,C=(f==g?-1:1)*y.sqrt(B((z*A-z*u*u-A*t*t)/(z*u*u+A*t*t))),E=C*c*u/d+(a+h)/2,F=C*-d*t/c+(b+i)/2,G=y.asin(((b-F)/d).toFixed(9)),H=y.asin(((i-F)/d).toFixed(9));G=a<E?D-G:G;H=h<E?D-H:H;G<0&&(G=D*2+G);H<0&&(H=D*2+H);g&&G>H&&(G=G-D*2);!g&&H>G&&(H=H-D*2)}var I=H-G;if(B(I)>k){var J=H,K=h,L=i;H=G+k*(g&&H>G?1:-1);h=E+c*y.cos(H);i=F+d*y.sin(H);m=bt(h,i,c,d,e,0,g,K,L,[H,J,E,F])}I=H-G;var M=y.cos(G),N=y.sin(G),O=y.cos(H),P=y.sin(H),Q=y.tan(I/4),R=4/3*c*Q,S=4/3*d*Q,T=[a,b],U=[a+R*N,b-S*M],V=[h+R*P,i-S*O],W=[h,i];U[0]=2*T[0]-U[0];U[1]=2*T[1]-U[1];{if(j)return[U,V,W][n](m);m=[U,V,W][n](m)[v]()[s](",");var X=[];for(var Y=0,Z=m[w];Y<Z;Y++)X[Y]=Y%2?p(m[Y-1],m[Y],l).y:p(m[Y],m[Y+1],l).x;return X}},bu=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:C(j,3)*a+C(j,2)*3*i*c+j*3*i*i*e+C(i,3)*g,y:C(j,3)*b+C(j,2)*3*i*d+j*3*i*i*f+C(i,3)*h}},bv=bm(function(a,b,c,d,e,f,g,h){var i=e-2*c+a-(g-2*e+c),j=2*(c-a)-2*(e-c),k=a-c,l=(-j+y.sqrt(j*j-4*i*k))/2/i,n=(-j-y.sqrt(j*j-4*i*k))/2/i,o=[b,h],p=[a,g],q;B(l)>"1e12"&&(l=0.5);B(n)>"1e12"&&(n=0.5);if(l>0&&l<1){q=bu(a,b,c,d,e,f,g,h,l);p[L](q.x);o[L](q.y)}if(n>0&&n<1){q=bu(a,b,c,d,e,f,g,h,n);p[L](q.x);o[L](q.y)}i=f-2*d+b-(h-2*f+d);j=2*(d-b)-2*(f-d);k=b-d;l=(-j+y.sqrt(j*j-4*i*k))/2/i;n=(-j-y.sqrt(j*j-4*i*k))/2/i;B(l)>"1e12"&&(l=0.5);B(n)>"1e12"&&(n=0.5);if(l>0&&l<1){q=bu(a,b,c,d,e,f,g,h,l);p[L](q.x);o[L](q.y)}if(n>0&&n<1){q=bu(a,b,c,d,e,f,g,h,n);p[L](q.x);o[L](q.y)}return{min:{x:A[m](0,p),y:A[m](0,o)},max:{x:z[m](0,p),y:z[m](0,o)}}}),bw=bm(function(a,b){var c=bq(a),d=b&&bq(b),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g=function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null);switch(a[0]){case"M":b.X=a[1];b.Y=a[2];break;case"A":a=["C"][n](bt[m](0,[b.x,b.y][n](a.slice(1))));break;case"S":c=b.x+(b.x-(b.bx||b.x));d=b.y+(b.y-(b.by||b.y));a=["C",c,d][n](a.slice(1));break;case"T":b.qx=b.x+(b.x-(b.qx||b.x));b.qy=b.y+(b.y-(b.qy||b.y));a=["C"][n](bs(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1];b.qy=a[2];a=["C"][n](bs(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][n](br(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][n](br(b.x,b.y,a[1],b.y));break;case"V":a=["C"][n](br(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][n](br(b.x,b.y,b.X,b.Y));break}return a},h=function(a,b){if(a[b][w]>7){a[b].shift();var e=a[b];while(e[w])a.splice(b++,0,["C"][n](e.splice(0,6)));a.splice(b,1);k=z(c[w],d&&d[w]||0)}},i=function(a,b,e,f,g){if(a&&b&&a[g][0]=="M"&&b[g][0]!="M"){b.splice(g,0,["M",f.x,f.y]);e.bx=0;e.by=0;e.x=a[g][1];e.y=a[g][2];k=z(c[w],d&&d[w]||0)}};for(var j=0,k=z(c[w],d&&d[w]||0);j<k;j++){c[j]=g(c[j],e);h(c,j);d&&(d[j]=g(d[j],f));d&&h(d,j);i(c,d,e,f,j);i(d,c,f,e,j);var l=c[j],o=d&&d[j],p=l[w],q=d&&o[w];e.x=l[p-2];e.y=l[p-1];e.bx=S(l[p-4])||e.x;e.by=S(l[p-3])||e.y;f.bx=d&&(S(o[q-4])||f.x);f.by=d&&(S(o[q-3])||f.y);f.x=d&&o[q-2];f.y=d&&o[q-1]}return d?[c,d]:c},null,bo),bx=bm(function(b){var c=[];for(var d=0,e=b[w];d<e;d++){var f={},g=b[d].match(/^([^:]*):?([\d\.]*)/);f.color=a.getRGB(g[1]);if(f.color.error)return null;f.color=f.color.hex;g[2]&&(f.offset=g[2]+"%");c[L](f)}for(d=1,e=c[w]-1;d<e;d++){if(!c[d].offset){var h=S(c[d-1].offset||0),i=0;for(var j=d+1;j<e;j++){if(c[j].offset){i=c[j].offset;break}}if(!i){i=100;j=e}i=S(i);var k=(i-h)/(j-d+1);for(;d<j;d++){h+=k;c[d].offset=h+"%"}}}return c}),by=function(b,c,d,e){var f;if(a.is(b,F)||a.is(b,"object")){f=a.is(b,F)?g.getElementById(b):b;if(f.tagName)return c==null?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:c,height:d}}else return{container:1,x:b,y:c,width:d,height:e}},bz=function(a,b){var c=this;for(var d in b){if(b[f](d)&&!(d in a))switch(typeof b[d]){case"function":(function(b){a[d]=a===c?b:function(){return b[m](c,arguments)}})(b[d]);break;case"object":a[d]=a[d]||{};bz.call(this,a[d],b[d]);break;default:a[d]=b[d];break}}},bA=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)},bB=function(a,b){if(b.top===a)return;bA(a,b);a.next=null;a.prev=b.top;b.top.next=a;b.top=a},bC=function(a,b){if(b.bottom===a)return;bA(a,b);a.next=b.bottom;a.prev=null;b.bottom.prev=a;b.bottom=a},bD=function(a,b,c){bA(a,c);b==c.top&&(c.top=a);b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a},bE=function(a,b,c){bA(a,c);b==c.bottom&&(c.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b},bF=function(a){return function(){throw new Error("Raphal: you are calling to method "+a+" of removed object")}};a.pathToRelative=bp;if(a.svg){k.svgns="http://www.w3.org/2000/svg";k.xlink="http://www.w3.org/1999/xlink";Q=function(a){return+a+(~(~a)===a)*0.5};var bG=function(a,b){if(b)for(var c in b)b[f](c)&&a[R](c,r(b[c]));else{a=g.createElementNS(k.svgns,a);a.style.webkitTapHighlightColor="rgba(0,0,0,0)";return a}};a[H]=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var bH=function(a,b){var c=bG("path");b.canvas&&b.canvas[l](c);var d=new bN(c,b);d.type="path";bK(d,{fill:"none",stroke:"#000",path:a});return d},bI=function(a,b,c){var d="linear",e=0.5,f=0.5,h=a.style;b=r(b)[Y](bd,function(a,b,c){d="radial";if(b&&c){e=S(b);f=S(c);var g=(f>0.5)*2-1;C(e-0.5,2)+C(f-0.5,2)>0.25&&(f=y.sqrt(0.25-C(e-0.5,2))*g+0.5)&&f!=0.5&&(f=f.toFixed(5)-0.00001*g)}return p});b=b[s](/\s*\-\s*/);if(d=="linear"){var i=b.shift();i=-S(i);if(isNaN(i))return null;var j=[0,0,y.cos(i*D/180),y.sin(i*D/180)],k=1/(z(B(j[2]),B(j[3]))||1);j[2]*=k;j[3]*=k;if(j[2]<0){j[0]=-j[2];j[2]=0}if(j[3]<0){j[1]=-j[3];j[3]=0}}var m=bx(b);if(!m)return null;var n=a.getAttribute(I);n=n.match(/^url\(#(.*)\)$/);n&&c.defs.removeChild(g.getElementById(n[1]));var o=bG(d+"Gradient");o.id=bh();bG(o,d=="radial"?{fx:e,fy:f}:{x1:j[0],y1:j[1],x2:j[2],y2:j[3]});c.defs[l](o);for(var q=0,t=m[w];q<t;q++){var u=bG("stop");bG(u,{offset:m[q].offset?m[q].offset:q?"100%":"0%","stop-color":m[q].color||"#fff"});o[l](u)}bG(a,{fill:"url(#"+o.id+")",opacity:1,"fill-opacity":1});h.fill=p;h.opacity=1;h.fillOpacity=1;return 1},bJ=function(b){var c=b.getBBox();bG(b.pattern,{patternTransform:a.format("translate({0},{1})",c.x,c.y)})},bK=function(c,d){var e={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},h=c.node,i=c.attrs,j=c.rotate(),k=function(a,b){b=e[x.call(b)];if(b){var c=a.attrs["stroke-width"]||"1",f=({round:c,square:c,butt:0})[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],i=b[w];while(i--)g[i]=b[i]*c+(i%2?1:-1)*f;bG(h,{"stroke-dasharray":g[v](",")})}};d[f]("rotation")&&(j=d.rotation);var m=r(j)[s](b);if(m.length-1){m[1]=+m[1];m[2]=+m[2]}else m=null;S(j)&&c.rotate(0,true);for(var n in d){if(d[f](n)){if(!W[f](n))continue;var o=d[n];i[n]=o;switch(n){case"blur":c.blur(o);break;case"rotation":c.rotate(o,true);break;case"href":case"title":case"target":var t=h.parentNode;if(x.call(t.tagName)!="a"){var u=bG("a");t.insertBefore(u,h);u[l](h);t=u}n=="target"&&o=="blank"?t.setAttributeNS(c.paper.xlink,"show","new"):t.setAttributeNS(c.paper.xlink,n,o);break;case"cursor":h.style.cursor=o;break;case"clip-rect":var y=r(o)[s](b);if(y[w]==4){c.clip&&c.clip.parentNode.parentNode.removeChild(c.clip.parentNode);var z=bG("clipPath"),A=bG("rect");z.id=bh();bG(A,{x:y[0],y:y[1],width:y[2],height:y[3]});z[l](A);c.paper.defs[l](z);bG(h,{"clip-path":"url(#"+z.id+")"});c.clip=A}if(!o){var B=g.getElementById(h.getAttribute("clip-path")[Y](/(^url\(#|\)$)/g,p));B&&B.parentNode.removeChild(B);bG(h,{"clip-path":p});delete c.clip}break;case"path":c.type=="path"&&bG(h,{d:o?i.path=bq(o):"M0,0"});break;case"width":h[R](n,o);if(i.fx){n="x";o=i.x}else break;case"x":i.fx&&(o=-i.x-(i.width||0));case"rx":if(n=="rx"&&c.type=="rect")break;case"cx":m&&(n=="x"||n=="cx")&&(m[1]+=o-i[n]);h[R](n,o);c.pattern&&bJ(c);break;case"height":h[R](n,o);if(i.fy){n="y";o=i.y}else break;case"y":i.fy&&(o=-i.y-(i.height||0));case"ry":if(n=="ry"&&c.type=="rect")break;case"cy":m&&(n=="y"||n=="cy")&&(m[2]+=o-i[n]);h[R](n,o);c.pattern&&bJ(c);break;case"r":c.type=="rect"?bG(h,{rx:o,ry:o}):h[R](n,o);break;case"src":c.type=="image"&&h.setAttributeNS(c.paper.xlink,"href",o);break;case"stroke-width":h.style.strokeWidth=o;h[R](n,o);i["stroke-dasharray"]&&k(c,i["stroke-dasharray"]);break;case"stroke-dasharray":k(c,o);break;case"translation":var C=r(o)[s](b);C[0]=+C[0]||0;C[1]=+C[1]||0;if(m){m[1]+=C[0];m[2]+=C[1]}cz.call(c,C[0],C[1]);break;case"scale":C=r(o)[s](b);c.scale(+C[0]||1,+C[1]||+C[0]||1,isNaN(S(C[2]))?null:+C[2],isNaN(S(C[3]))?null:+C[3]);break;case I:var D=r(o).match(M);if(D){z=bG("pattern");var E=bG("image");z.id=bh();bG(z,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});bG(E,{x:0,y:0});E.setAttributeNS(c.paper.xlink,"href",D[1]);z[l](E);var F=g.createElement("img");F.style.cssText="position:absolute;left:-9999em;top-9999em";F.onload=function(){bG(z,{width:this.offsetWidth,height:this.offsetHeight});bG(E,{width:this.offsetWidth,height:this.offsetHeight});g.body.removeChild(this);c.paper.safari()};g.body[l](F);F.src=D[1];c.paper.defs[l](z);h.style.fill="url(#"+z.id+")";bG(h,{fill:"url(#"+z.id+")"});c.pattern=z;c.pattern&&bJ(c);break}var G=a.getRGB(o);if(G.error)if((({circle:1,ellipse:1})[f](c.type)||r(o).charAt()!="r")&&bI(h,o,c.paper)){i.gradient=o;i.fill="none";break}else{delete d.gradient;delete i.gradient;!a.is(i.opacity,"undefined")&&a.is(d.opacity,"undefined")&&bG(h,{opacity:i.opacity});!a.is(i["fill-opacity"],"undefined")&&a.is(d["fill-opacity"],"undefined")&&bG(h,{"fill-opacity":i["fill-opacity"]})}G[f]("opacity")&&bG(h,{"fill-opacity":G.opacity>1?G.opacity/100:G.opacity});case"stroke":G=a.getRGB(o);h[R](n,G.hex);n=="stroke"&&G[f]("opacity")&&bG(h,{"stroke-opacity":G.opacity>1?G.opacity/100:G.opacity});break;case"gradient":(({circle:1,ellipse:1})[f](c.type)||r(o).charAt()!="r")&&bI(h,o,c.paper);break;case"opacity":i.gradient&&!i[f]("stroke-opacity")&&bG(h,{"stroke-opacity":o>1?o/100:o});case"fill-opacity":if(i.gradient){var H=g.getElementById(h.getAttribute(I)[Y](/^url\(#|\)$/g,p));if(H){var J=H.getElementsByTagName("stop");J[J[w]-1][R]("stop-opacity",o)}break}default:n=="font-size"&&(o=T(o,10)+"px");var K=n[Y](/(\-.)/g,function(a){return V.call(a.substring(1))});h.style[K]=o;h[R](n,o);break}}}bM(c,d);m?c.rotate(m.join(q)):S(j)&&c.rotate(j,true)},bL=1.2,bM=function(b,c){if(b.type!="text"||!(c[f]("text")||c[f]("font")||c[f]("font-size")||c[f]("x")||c[f]("y")))return;var d=b.attrs,e=b.node,h=e.firstChild?T(g.defaultView.getComputedStyle(e.firstChild,p).getPropertyValue("font-size"),10):10;if(c[f]("text")){d.text=c.text;while(e.firstChild)e.removeChild(e.firstChild);var i=r(c.text)[s]("\n");for(var j=0,k=i[w];j<k;j++)if(i[j]){var m=bG("tspan");j&&bG(m,{dy:h*bL,x:d.x});m[l](g.createTextNode(i[j]));e[l](m)}}else{i=e.getElementsByTagName("tspan");for(j=0,k=i[w];j<k;j++)j&&bG(i[j],{dy:h*bL,x:d.x})}bG(e,{y:d.y});var n=b.getBBox(),o=d.y-(n.y+n.height/2);o&&a.is(o,"finite")&&bG(e,{y:d.y+o})},bN=function(b,c){var d=0,e=0;this[0]=b;this.id=a._oid++;this.node=b;b.raphael=this;this.paper=c;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!c.bottom&&(c.bottom=this);this.prev=c.top;c.top&&(c.top.next=this);c.top=this;this.next=null},bO=bN[e];bN[e].rotate=function(c,d,e){if(this.removed)return this;if(c==null){if(this._.rt.cx)return[this._.rt.deg,this._.rt.cx,this._.rt.cy][v](q);return this._.rt.deg}var f=this.getBBox();c=r(c)[s](b);if(c[w]-1){d=S(c[1]);e=S(c[2])}c=S(c[0]);d!=null&&d!==false?this._.rt.deg=c:this._.rt.deg+=c;e==null&&(d=null);this._.rt.cx=d;this._.rt.cy=e;d=d==null?f.x+f.width/2:d;e=e==null?f.y+f.height/2:e;if(this._.rt.deg){this.transformations[0]=a.format("rotate({0} {1} {2})",this._.rt.deg,d,e);this.clip&&bG(this.clip,{transform:a.format("rotate({0} {1} {2})",-this._.rt.deg,d,e)})}else{this.transformations[0]=p;this.clip&&bG(this.clip,{transform:p})}bG(this.node,{transform:this.transformations[v](q)});return this};bN[e].hide=function(){!this.removed&&(this.node.style.display="none");return this};bN[e].show=function(){!this.removed&&(this.node.style.display="");return this};bN[e].remove=function(){if(this.removed)return;bA(this,this.paper);this.node.parentNode.removeChild(this.node);for(var a in this)delete this[a];this.removed=true};bN[e].getBBox=function(){if(this.removed)return this;if(this.type=="path")return bn(this.attrs.path);if(this.node.style.display=="none"){this.show();var a=true}var b={};try{b=this.node.getBBox()}catch(a){}finally{b=b||{}}if(this.type=="text"){b={x:b.x,y:Infinity,width:0,height:0};for(var c=0,d=this.node.getNumberOfChars();c<d;c++){var e=this.node.getExtentOfChar(c);e.y<b.y&&(b.y=e.y);e.y+e.height-b.y>b.height&&(b.height=e.y+e.height-b.y);e.x+e.width-b.x>b.width&&(b.width=e.x+e.width-b.x)}}a&&this.hide();return b};bN[e].attr=function(b,c){if(this.removed)return this;if(b==null){var d={};for(var e in this.attrs)this.attrs[f](e)&&(d[e]=this.attrs[e]);this._.rt.deg&&(d.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(d.scale=this.scale());d.gradient&&d.fill=="none"&&(d.fill=d.gradient)&&delete d.gradient;return d}if(c==null&&a.is(b,F)){if(b=="translation")return cz.call(this);if(b=="rotation")return this.rotate();if(b=="scale")return this.scale();if(b==I&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;return this.attrs[b]}if(c==null&&a.is(b,G)){var g={};for(var h=0,i=b.length;h<i;h++)g[b[h]]=this.attr(b[h]);return g}if(c!=null){var j={};j[b]=c}else b!=null&&a.is(b,"object")&&(j=b);for(var k in this.paper.customAttributes)if(this.paper.customAttributes[f](k)&&j[f](k)&&a.is(this.paper.customAttributes[k],"function")){var l=this.paper.customAttributes[k].apply(this,[][n](j[k]));this.attrs[k]=j[k];for(var m in l)l[f](m)&&(j[m]=l[m])}bK(this,j);return this};bN[e].toFront=function(){if(this.removed)return this;this.node.parentNode[l](this.node);var a=this.paper;a.top!=this&&bB(this,a);return this};bN[e].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);bC(this,this.paper);var a=this.paper}return this};bN[e].insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode[l](this.node);bD(this,a,this.paper);return this};bN[e].insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;b.parentNode.insertBefore(this.node,b);bE(this,a,this.paper);return this};bN[e].blur=function(a){var b=this;if(+a!==0){var c=bG("filter"),d=bG("feGaussianBlur");b.attrs.blur=a;c.id=bh();bG(d,{stdDeviation:+a||1.5});c.appendChild(d);b.paper.defs.appendChild(c);b._blur=c;bG(b.node,{filter:"url(#"+c.id+")"})}else{if(b._blur){b._blur.parentNode.removeChild(b._blur);delete b._blur;delete b.attrs.blur}b.node.removeAttribute("filter")}};var bP=function(a,b,c,d){var e=bG("circle");a.canvas&&a.canvas[l](e);var f=new bN(e,a);f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"};f.type="circle";bG(e,f.attrs);return f},bQ=function(a,b,c,d,e,f){var g=bG("rect");a.canvas&&a.canvas[l](g);var h=new bN(g,a);h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"};h.type="rect";bG(g,h.attrs);return h},bR=function(a,b,c,d,e){var f=bG("ellipse");a.canvas&&a.canvas[l](f);var g=new bN(f,a);g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"};g.type="ellipse";bG(f,g.attrs);return g},bS=function(a,b,c,d,e,f){var g=bG("image");bG(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"});g.setAttributeNS(a.xlink,"href",b);a.canvas&&a.canvas[l](g);var h=new bN(g,a);h.attrs={x:c,y:d,width:e,height:f,src:b};h.type="image";return h},bT=function(a,b,c,d){var e=bG("text");bG(e,{x:b,y:c,"text-anchor":"middle"});a.canvas&&a.canvas[l](e);var f=new bN(e,a);f.attrs={x:b,y:c,"text-anchor":"middle",text:d,font:W.font,stroke:"none",fill:"#000"};f.type="text";bK(f,f.attrs);return f},bU=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas[R]("width",this.width);this.canvas[R]("height",this.height);return this},bV=function(){var b=by[m](0,arguments),c=b&&b.container,d=b.x,e=b.y,f=b.width,h=b.height;if(!c)throw new Error("SVG container not found.");var i=bG("svg");d=d||0;e=e||0;f=f||512;h=h||342;bG(i,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:f,height:h});if(c==1){i.style.cssText="position:absolute;left:"+d+"px;top:"+e+"px";g.body[l](i)}else c.firstChild?c.insertBefore(i,c.firstChild):c[l](i);c=new j;c.width=f;c.height=h;c.canvas=i;bz.call(c,c,a.fn);c.clear();return c};k.clear=function(){var a=this.canvas;while(a.firstChild)a.removeChild(a.firstChild);this.bottom=this.top=null;(this.desc=bG("desc"))[l](g.createTextNode("Created with Raphal"));a[l](this.desc);a[l](this.defs=bG("defs"))};k.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=bF(a)}}if(a.vml){var bW={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bX=/([clmz]),?([^clmz]*)/gi,bY=/ progid:\S+Blur\([^\)]+\)/g,bZ=/-?[^,\s-]+/g,b$=1000+q+1000,b_=10,ca={path:1,rect:1},cb=function(a){var b=/[ahqstv]/ig,c=bq;r(a).match(b)&&(c=bw);b=/[clmz]/g;if(c==bq&&!r(a).match(b)){var d=r(a)[Y](bX,function(a,b,c){var d=[],e=x.call(b)=="m",f=bW[b];c[Y](bZ,function(a){if(e&&d[w]==2){f+=d+bW[b=="m"?"l":"L"];d=[]}d[L](Q(a*b_))});return f+d});return d}var e=c(a),f,g;d=[];for(var h=0,i=e[w];h<i;h++){f=e[h];g=x.call(e[h][0]);g=="z"&&(g="x");for(var j=1,k=f[w];j<k;j++)g+=Q(f[j]*b_)+(j!=k-1?",":p);d[L](g)}return d[v](q)};a[H]=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version};bH=function(a,b){var c=cd("group");c.style.cssText="position:absolute;left:0;top:0;width:"+b.width+"px;height:"+b.height+"px";c.coordsize=b.coordsize;c.coordorigin=b.coordorigin;var d=cd("shape"),e=d.style;e.width=b.width+"px";e.height=b.height+"px";d.coordsize=b$;d.coordorigin=b.coordorigin;c[l](d);var f=new bN(d,c,b),g={fill:"none",stroke:"#000"};a&&(g.path=a);f.type="path";f.path=[];f.Path=p;bK(f,g);b.canvas[l](c);return f};bK=function(c,d){c.attrs=c.attrs||{};var e=c.node,h=c.attrs,i=e.style,j,k=(d.x!=h.x||d.y!=h.y||d.width!=h.width||d.height!=h.height||d.r!=h.r)&&c.type=="rect",m=c;for(var n in d)d[f](n)&&(h[n]=d[n]);if(k){h.path=cc(h.x,h.y,h.width,h.height,h.r);c.X=h.x;c.Y=h.y;c.W=h.width;c.H=h.height}d.href&&(e.href=d.href);d.title&&(e.title=d.title);d.target&&(e.target=d.target);d.cursor&&(i.cursor=d.cursor);"blur"in d&&c.blur(d.blur);if(d.path&&c.type=="path"||k)e.path=cb(h.path);d.rotation!=null&&c.rotate(d.rotation,true);if(d.translation){j=r(d.translation)[s](b);cz.call(c,j[0],j[1]);if(c._.rt.cx!=null){c._.rt.cx+=+j[0];c._.rt.cy+=+j[1];c.setBox(c.attrs,j[0],j[1])}}if(d.scale){j=r(d.scale)[s](b);c.scale(+j[0]||1,+j[1]||+j[0]||1,+j[2]||null,+j[3]||null)}if("clip-rect"in d){var o=r(d["clip-rect"])[s](b);if(o[w]==4){o[2]=+o[2]+ +o[0];o[3]=+o[3]+ +o[1];var q=e.clipRect||g.createElement("div"),t=q.style,u=e.parentNode;t.clip=a.format("rect({1}px {2}px {3}px {0}px)",o);if(!e.clipRect){t.position="absolute";t.top=0;t.left=0;t.width=c.paper.width+"px";t.height=c.paper.height+"px";u.parentNode.insertBefore(q,u);q[l](u);e.clipRect=q}}d["clip-rect"]||e.clipRect&&(e.clipRect.style.clip=p)}c.type=="image"&&d.src&&(e.src=d.src);if(c.type=="image"&&d.opacity){e.filterOpacity=U+".Alpha(opacity="+d.opacity*100+")";i.filter=(e.filterMatrix||p)+(e.filterOpacity||p)}d.font&&(i.font=d.font);d["font-family"]&&(i.fontFamily="\""+d["font-family"][s](",")[0][Y](/^['"]+|['"]+$/g,p)+"\"");d["font-size"]&&(i.fontSize=d["font-size"]);d["font-weight"]&&(i.fontWeight=d["font-weight"]);d["font-style"]&&(i.fontStyle=d["font-style"]);if(d.opacity!=null||d["stroke-width"]!=null||d.fill!=null||d.stroke!=null||d["stroke-width"]!=null||d["stroke-opacity"]!=null||d["fill-opacity"]!=null||d["stroke-dasharray"]!=null||d["stroke-miterlimit"]!=null||d["stroke-linejoin"]!=null||d["stroke-linecap"]!=null){e=c.shape||e;var v=e.getElementsByTagName(I)&&e.getElementsByTagName(I)[0],x=false;!v&&(x=v=cd(I));if("fill-opacity"in d||"opacity"in d){var y=((+h["fill-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+a.getRGB(d.fill).o+1||2)-1);y=A(z(y,0),1);v.opacity=y}d.fill&&(v.on=true);if(v.on==null||d.fill=="none")v.on=false;if(v.on&&d.fill){var B=d.fill.match(M);if(B){v.src=B[1];v.type="tile"}else{v.color=a.getRGB(d.fill).hex;v.src=p;v.type="solid";if(a.getRGB(d.fill).error&&(m.type in{circle:1,ellipse:1}||r(d.fill).charAt()!="r")&&bI(m,d.fill)){h.fill="none";h.gradient=d.fill}}}x&&e[l](v);var C=e.getElementsByTagName("stroke")&&e.getElementsByTagName("stroke")[0],D=false;!C&&(D=C=cd("stroke"));if(d.stroke&&d.stroke!="none"||d["stroke-width"]||d["stroke-opacity"]!=null||d["stroke-dasharray"]||d["stroke-miterlimit"]||d["stroke-linejoin"]||d["stroke-linecap"])C.on=true;(d.stroke=="none"||C.on==null||d.stroke==0||d["stroke-width"]==0)&&(C.on=false);var E=a.getRGB(d.stroke);C.on&&d.stroke&&(C.color=E.hex);y=((+h["stroke-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+E.o+1||2)-1);var F=(S(d["stroke-width"])||1)*0.75;y=A(z(y,0),1);d["stroke-width"]==null&&(F=h["stroke-width"]);d["stroke-width"]&&(C.weight=F);F&&F<1&&(y*=F)&&(C.weight=1);C.opacity=y;d["stroke-linejoin"]&&(C.joinstyle=d["stroke-linejoin"]||"miter");C.miterlimit=d["stroke-miterlimit"]||8;d["stroke-linecap"]&&(C.endcap=d["stroke-linecap"]=="butt"?"flat":d["stroke-linecap"]=="square"?"square":"round");if(d["stroke-dasharray"]){var G={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};C.dashstyle=G[f](d["stroke-dasharray"])?G[d["stroke-dasharray"]]:p}D&&e[l](C)}if(m.type=="text"){i=m.paper.span.style;h.font&&(i.font=h.font);h["font-family"]&&(i.fontFamily=h["font-family"]);h["font-size"]&&(i.fontSize=h["font-size"]);h["font-weight"]&&(i.fontWeight=h["font-weight"]);h["font-style"]&&(i.fontStyle=h["font-style"]);m.node.string&&(m.paper.span.innerHTML=r(m.node.string)[Y](/</g,"&#60;")[Y](/&/g,"&#38;")[Y](/\n/g,"<br>"));m.W=h.w=m.paper.span.offsetWidth;m.H=h.h=m.paper.span.offsetHeight;m.X=h.x;m.Y=h.y+Q(m.H/2);switch(h["text-anchor"]){case"start":m.node.style["v-text-align"]="left";m.bbx=Q(m.W/2);break;case"end":m.node.style["v-text-align"]="right";m.bbx=-Q(m.W/2);break;default:m.node.style["v-text-align"]="center";break}}};bI=function(a,b){a.attrs=a.attrs||{};var c=a.attrs,d,e="linear",f=".5 .5";a.attrs.gradient=b;b=r(b)[Y](bd,function(a,b,c){e="radial";if(b&&c){b=S(b);c=S(c);C(b-0.5,2)+C(c-0.5,2)>0.25&&(c=y.sqrt(0.25-C(b-0.5,2))*((c>0.5)*2-1)+0.5);f=b+q+c}return p});b=b[s](/\s*\-\s*/);if(e=="linear"){var g=b.shift();g=-S(g);if(isNaN(g))return null}var h=bx(b);if(!h)return null;a=a.shape||a.node;d=a.getElementsByTagName(I)[0]||cd(I);!d.parentNode&&a.appendChild(d);if(h[w]){d.on=true;d.method="none";d.color=h[0].color;d.color2=h[h[w]-1].color;var i=[];for(var j=0,k=h[w];j<k;j++)h[j].offset&&i[L](h[j].offset+q+h[j].color);d.colors&&(d.colors.value=i[w]?i[v]():"0% "+d.color);if(e=="radial"){d.type="gradientradial";d.focus="100%";d.focussize=f;d.focusposition=f}else{d.type="gradient";d.angle=(270-g)%360}}return 1};bN=function(b,c,d){var e=0,f=0,g=0,h=1;this[0]=b;this.id=a._oid++;this.node=b;b.raphael=this;this.X=0;this.Y=0;this.attrs={};this.Group=c;this.paper=d;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!d.bottom&&(d.bottom=this);this.prev=d.top;d.top&&(d.top.next=this);d.top=this;this.next=null};bO=bN[e];bO.rotate=function(a,c,d){if(this.removed)return this;if(a==null){if(this._.rt.cx)return[this._.rt.deg,this._.rt.cx,this._.rt.cy][v](q);return this._.rt.deg}a=r(a)[s](b);if(a[w]-1){c=S(a[1]);d=S(a[2])}a=S(a[0]);c!=null?this._.rt.deg=a:this._.rt.deg+=a;d==null&&(c=null);this._.rt.cx=c;this._.rt.cy=d;this.setBox(this.attrs,c,d);this.Group.style.rotation=this._.rt.deg;return this};bO.setBox=function(a,b,c){if(this.removed)return this;var d=this.Group.style,e=this.shape&&this.shape.style||this.node.style;a=a||{};for(var g in a)a[f](g)&&(this.attrs[g]=a[g]);b=b||this._.rt.cx;c=c||this._.rt.cy;var h=this.attrs,i,j,k,l;switch(this.type){case"circle":i=h.cx-h.r;j=h.cy-h.r;k=l=h.r*2;break;case"ellipse":i=h.cx-h.rx;j=h.cy-h.ry;k=h.rx*2;l=h.ry*2;break;case"image":i=+h.x;j=+h.y;k=h.width||0;l=h.height||0;break;case"text":this.textpath.v=["m",Q(h.x),", ",Q(h.y-2),"l",Q(h.x)+1,", ",Q(h.y-2)][v](p);i=h.x-Q(this.W/2);j=h.y-this.H/2;k=this.W;l=this.H;break;case"rect":case"path":if(this.attrs.path){var m=bn(this.attrs.path);i=m.x;j=m.y;k=m.width;l=m.height}else{i=0;j=0;k=this.paper.width;l=this.paper.height}break;default:i=0;j=0;k=this.paper.width;l=this.paper.height;break}b=b==null?i+k/2:b;c=c==null?j+l/2:c;var n=b-this.paper.width/2,o=c-this.paper.height/2,q;d.left!=(q=n+"px")&&(d.left=q);d.top!=(q=o+"px")&&(d.top=q);this.X=ca[f](this.type)?-n:i;this.Y=ca[f](this.type)?-o:j;this.W=k;this.H=l;if(ca[f](this.type)){e.left!=(q=-n*b_+"px")&&(e.left=q);e.top!=(q=-o*b_+"px")&&(e.top=q)}else if(this.type=="text"){e.left!=(q=-n+"px")&&(e.left=q);e.top!=(q=-o+"px")&&(e.top=q)}else{d.width!=(q=this.paper.width+"px")&&(d.width=q);d.height!=(q=this.paper.height+"px")&&(d.height=q);e.left!=(q=i-n+"px")&&(e.left=q);e.top!=(q=j-o+"px")&&(e.top=q);e.width!=(q=k+"px")&&(e.width=q);e.height!=(q=l+"px")&&(e.height=q)}};bO.hide=function(){!this.removed&&(this.Group.style.display="none");return this};bO.show=function(){!this.removed&&(this.Group.style.display="block");return this};bO.getBBox=function(){if(this.removed)return this;if(ca[f](this.type))return bn(this.attrs.path);return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}};bO.remove=function(){if(this.removed)return;bA(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)delete this[a];this.removed=true};bO.attr=function(b,c){if(this.removed)return this;if(b==null){var d={};for(var e in this.attrs)this.attrs[f](e)&&(d[e]=this.attrs[e]);this._.rt.deg&&(d.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(d.scale=this.scale());d.gradient&&d.fill=="none"&&(d.fill=d.gradient)&&delete d.gradient;return d}if(c==null&&a.is(b,"string")){if(b=="translation")return cz.call(this);if(b=="rotation")return this.rotate();if(b=="scale")return this.scale();if(b==I&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;return this.attrs[b]}if(this.attrs&&c==null&&a.is(b,G)){var g,h={};for(e=0,g=b[w];e<g;e++)h[b[e]]=this.attr(b[e]);return h}var i;if(c!=null){i={};i[b]=c}c==null&&a.is(b,"object")&&(i=b);if(i){for(var j in this.paper.customAttributes)if(this.paper.customAttributes[f](j)&&i[f](j)&&a.is(this.paper.customAttributes[j],"function")){var k=this.paper.customAttributes[j].apply(this,[][n](i[j]));this.attrs[j]=i[j];for(var l in k)k[f](l)&&(i[l]=k[l])}i.text&&this.type=="text"&&(this.node.string=i.text);bK(this,i);i.gradient&&(({circle:1,ellipse:1})[f](this.type)||r(i.gradient).charAt()!="r")&&bI(this,i.gradient);(!ca[f](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this};bO.toFront=function(){!this.removed&&this.Group.parentNode[l](this.Group);this.paper.top!=this&&bB(this,this.paper);return this};bO.toBack=function(){if(this.removed)return this;if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);bC(this,this.paper)}return this};bO.insertAfter=function(a){if(this.removed)return this;a.constructor==cC&&(a=a[a.length-1]);a.Group.nextSibling?a.Group.parentNode.insertBefore(this.Group,a.Group.nextSibling):a.Group.parentNode[l](this.Group);bD(this,a,this.paper);return this};bO.insertBefore=function(a){if(this.removed)return this;a.constructor==cC&&(a=a[0]);a.Group.parentNode.insertBefore(this.Group,a.Group);bE(this,a,this.paper);return this};bO.blur=function(b){var c=this.node.runtimeStyle,d=c.filter;d=d.replace(bY,p);if(+b!==0){this.attrs.blur=b;c.filter=d+q+U+".Blur(pixelradius="+(+b||1.5)+")";c.margin=a.format("-{0}px 0 0 -{0}px",Q(+b||1.5))}else{c.filter=d;c.margin=0;delete this.attrs.blur}};bP=function(a,b,c,d){var e=cd("group"),f=cd("oval"),g=f.style;e.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";e.coordsize=b$;e.coordorigin=a.coordorigin;e[l](f);var h=new bN(f,e,a);h.type="circle";bK(h,{stroke:"#000",fill:"none"});h.attrs.cx=b;h.attrs.cy=c;h.attrs.r=d;h.setBox({x:b-d,y:c-d,width:d*2,height:d*2});a.canvas[l](e);return h};function cc(b,c,d,e,f){return f?a.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",b+f,c,d-f*2,f,-f,e-f*2,f*2-d,f*2-e):a.format("M{0},{1}l{2},0,0,{3},{4},0z",b,c,d,e,-d)}bQ=function(a,b,c,d,e,f){var g=cc(b,c,d,e,f),h=a.path(g),i=h.attrs;h.X=i.x=b;h.Y=i.y=c;h.W=i.width=d;h.H=i.height=e;i.r=f;i.path=g;h.type="rect";return h};bR=function(a,b,c,d,e){var f=cd("group"),g=cd("oval"),h=g.style;f.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";f.coordsize=b$;f.coordorigin=a.coordorigin;f[l](g);var i=new bN(g,f,a);i.type="ellipse";bK(i,{stroke:"#000"});i.attrs.cx=b;i.attrs.cy=c;i.attrs.rx=d;i.attrs.ry=e;i.setBox({x:b-d,y:c-e,width:d*2,height:e*2});a.canvas[l](f);return i};bS=function(a,b,c,d,e,f){var g=cd("group"),h=cd("image");g.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";g.coordsize=b$;g.coordorigin=a.coordorigin;h.src=b;g[l](h);var i=new bN(h,g,a);i.type="image";i.attrs.src=b;i.attrs.x=c;i.attrs.y=d;i.attrs.w=e;i.attrs.h=f;i.setBox({x:c,y:d,width:e,height:f});a.canvas[l](g);return i};bT=function(b,c,d,e){var f=cd("group"),g=cd("shape"),h=g.style,i=cd("path"),j=i.style,k=cd("textpath");f.style.cssText="position:absolute;left:0;top:0;width:"+b.width+"px;height:"+b.height+"px";f.coordsize=b$;f.coordorigin=b.coordorigin;i.v=a.format("m{0},{1}l{2},{1}",Q(c*10),Q(d*10),Q(c*10)+1);i.textpathok=true;h.width=b.width;h.height=b.height;k.string=r(e);k.on=true;g[l](k);g[l](i);f[l](g);var m=new bN(k,f,b);m.shape=g;m.textpath=i;m.type="text";m.attrs.text=e;m.attrs.x=c;m.attrs.y=d;m.attrs.w=1;m.attrs.h=1;bK(m,{font:W.font,stroke:"none",fill:"#000"});m.setBox();b.canvas[l](f);return m};bU=function(a,b){var c=this.canvas.style;a==+a&&(a+="px");b==+b&&(b+="px");c.width=a;c.height=b;c.clip="rect(0 "+a+" "+b+" 0)";return this};var cd;g.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!g.namespaces.rvml&&g.namespaces.add("rvml","urn:schemas-microsoft-com:vml");cd=function(a){return g.createElement("<rvml:"+a+" class=\"rvml\">")}}catch(a){cd=function(a){return g.createElement("<"+a+" xmlns=\"urn:schemas-microsoft.com:vml\" class=\"rvml\">")}}bV=function(){var b=by[m](0,arguments),c=b.container,d=b.height,e,f=b.width,h=b.x,i=b.y;if(!c)throw new Error("VML container not found.");var k=new j,n=k.canvas=g.createElement("div"),o=n.style;h=h||0;i=i||0;f=f||512;d=d||342;f==+f&&(f+="px");d==+d&&(d+="px");k.width=1000;k.height=1000;k.coordsize=b_*1000+q+b_*1000;k.coordorigin="0 0";k.span=g.createElement("span");k.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";n[l](k.span);o.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",f,d);if(c==1){g.body[l](n);o.left=h+"px";o.top=i+"px";o.position="absolute"}else c.firstChild?c.insertBefore(n,c.firstChild):c[l](n);bz.call(k,k,a.fn);return k};k.clear=function(){this.canvas.innerHTML=p;this.span=g.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas[l](this.span);this.bottom=this.top=null};k.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=bF(a);return true}}var ce=navigator.userAgent.match(/Version\\x2f(.*?)\s/);navigator.vendor=="Apple Computer, Inc."&&(ce&&ce[1]<4||navigator.platform.slice(0,2)=="iP")?k.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});h.setTimeout(function(){a.remove()})}:k.safari=function(){};var cf=function(){this.returnValue=false},cg=function(){return this.originalEvent.preventDefault()},ch=function(){this.cancelBubble=true},ci=function(){return this.originalEvent.stopPropagation()},cj=(function(){{if(g.addEventListener)return function(a,b,c,d){var e=o&&u[b]?u[b]:b,g=function(e){if(o&&u[f](b))for(var g=0,h=e.targetTouches&&e.targetTouches.length;g<h;g++){if(e.targetTouches[g].target==a){var i=e;e=e.targetTouches[g];e.originalEvent=i;e.preventDefault=cg;e.stopPropagation=ci;break}}return c.call(d,e)};a.addEventListener(e,g,false);return function(){a.removeEventListener(e,g,false);return true}};if(g.attachEvent)return function(a,b,c,d){var e=function(a){a=a||h.event;a.preventDefault=a.preventDefault||cf;a.stopPropagation=a.stopPropagation||ch;return c.call(d,a)};a.attachEvent("on"+b,e);var f=function(){a.detachEvent("on"+b,e);return true};return f}}})(),ck=[],cl=function(a){var b=a.clientX,c=a.clientY,d=g.documentElement.scrollTop||g.body.scrollTop,e=g.documentElement.scrollLeft||g.body.scrollLeft,f,h=ck.length;while(h--){f=ck[h];if(o){var i=a.touches.length,j;while(i--){j=a.touches[i];if(j.identifier==f.el._drag.id){b=j.clientX;c=j.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}}else a.preventDefault();b+=e;c+=d;f.move&&f.move.call(f.move_scope||f.el,b-f.el._drag.x,c-f.el._drag.y,b,c,a)}},cm=function(b){a.unmousemove(cl).unmouseup(cm);var c=ck.length,d;while(c--){d=ck[c];d.el._drag={};d.end&&d.end.call(d.end_scope||d.start_scope||d.move_scope||d.el,b)}ck=[]};for(var cn=t[w];cn--;)(function(b){a[b]=bN[e][b]=function(c,d){if(a.is(c,"function")){this.events=this.events||[];this.events.push({name:b,f:c,unbind:cj(this.shape||this.node||g,b,c,d||this)})}return this};a["un"+b]=bN[e]["un"+b]=function(a){var c=this.events,d=c[w];while(d--)if(c[d].name==b&&c[d].f==a){c[d].unbind();c.splice(d,1);!c.length&&delete this.events;return this}return this}})(t[cn]);bO.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)};bO.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};bO.drag=function(b,c,d,e,f,h){this._drag={};this.mousedown(function(i){(i.originalEvent||i).preventDefault();var j=g.documentElement.scrollTop||g.body.scrollTop,k=g.documentElement.scrollLeft||g.body.scrollLeft;this._drag.x=i.clientX+k;this._drag.y=i.clientY+j;this._drag.id=i.identifier;c&&c.call(f||e||this,i.clientX+k,i.clientY+j,i);!ck.length&&a.mousemove(cl).mouseup(cm);ck.push({el:this,move:b,end:d,move_scope:e,start_scope:f,end_scope:h})});return this};bO.undrag=function(b,c,d){var e=ck.length;while(e--)ck[e].el==this&&(ck[e].move==b&&ck[e].end==d)&&ck.splice(e++,1);!ck.length&&a.unmousemove(cl).unmouseup(cm)};k.circle=function(a,b,c){return bP(this,a||0,b||0,c||0)};k.rect=function(a,b,c,d,e){return bQ(this,a||0,b||0,c||0,d||0,e||0)};k.ellipse=function(a,b,c,d){return bR(this,a||0,b||0,c||0,d||0)};k.path=function(b){b&&!a.is(b,F)&&!a.is(b[0],G)&&(b+=p);return bH(a.format[m](a,arguments),this)};k.image=function(a,b,c,d,e){return bS(this,a||"about:blank",b||0,c||0,d||0,e||0)};k.text=function(a,b,c){return bT(this,a||0,b||0,r(c))};k.set=function(a){arguments[w]>1&&(a=Array[e].splice.call(arguments,0,arguments[w]));return new cC(a)};k.setSize=bU;k.top=k.bottom=null;k.raphael=a;function co(){return this.x+q+this.y}bO.resetScale=function(){if(this.removed)return this;this._.sx=1;this._.sy=1;this.attrs.scale="1 1"};bO.scale=function(a,b,c,d){if(this.removed)return this;if(a==null&&b==null)return{x:this._.sx,y:this._.sy,toString:co};b=b||a;!(+b)&&(b=a);var e,f,g,h,i=this.attrs;if(a!=0){var j=this.getBBox(),k=j.x+j.width/2,l=j.y+j.height/2,m=B(a/this._.sx),o=B(b/this._.sy);c=+c||c==0?c:k;d=+d||d==0?d:l;var r=this._.sx>0,s=this._.sy>0,t=~(~(a/B(a))),u=~(~(b/B(b))),x=m*t,y=o*u,z=this.node.style,A=c+B(k-c)*x*(k>c==r?1:-1),C=d+B(l-d)*y*(l>d==s?1:-1),D=a*t>b*u?o:m;switch(this.type){case"rect":case"image":var E=i.width*m,F=i.height*o;this.attr({height:F,r:i.r*D,width:E,x:A-E/2,y:C-F/2});break;case"circle":case"ellipse":this.attr({rx:i.rx*m,ry:i.ry*o,r:i.r*D,cx:A,cy:C});break;case"text":this.attr({x:A,y:C});break;case"path":var G=bp(i.path),H=true,I=r?x:m,J=s?y:o;for(var K=0,L=G[w];K<L;K++){var M=G[K],N=V.call(M[0]);{if(N=="M"&&H)continue;H=false}if(N=="A"){M[G[K][w]-2]*=I;M[G[K][w]-1]*=J;M[1]*=m;M[2]*=o;M[5]=+(t+u?!(!(+M[5])):!(+M[5]))}else if(N=="H")for(var O=1,P=M[w];O<P;O++)M[O]*=I;else if(N=="V")for(O=1,P=M[w];O<P;O++)M[O]*=J;else for(O=1,P=M[w];O<P;O++)M[O]*=O%2?I:J}var Q=bn(G);e=A-Q.x-Q.width/2;f=C-Q.y-Q.height/2;G[0][1]+=e;G[0][2]+=f;this.attr({path:G});break}if(this.type in{text:1,image:1}&&(t!=1||u!=1))if(this.transformations){this.transformations[2]="scale("[n](t,",",u,")");this.node[R]("transform",this.transformations[v](q));e=t==-1?-i.x-(E||0):i.x;f=u==-1?-i.y-(F||0):i.y;this.attr({x:e,y:f});i.fx=t-1;i.fy=u-1}else{this.node.filterMatrix=U+".Matrix(M11="[n](t,", M12=0, M21=0, M22=",u,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");z.filter=(this.node.filterMatrix||p)+(this.node.filterOpacity||p)}else if(this.transformations){this.transformations[2]=p;this.node[R]("transform",this.transformations[v](q));i.fx=0;i.fy=0}else{this.node.filterMatrix=p;z.filter=(this.node.filterMatrix||p)+(this.node.filterOpacity||p)}i.scale=[a,b,c,d][v](q);this._.sx=a;this._.sy=b}return this};bO.clone=function(){if(this.removed)return null;var a=this.attr();delete a.scale;delete a.translation;return this.paper[this.type]().attr(a)};var cp={},cq=function(b,c,d,e,f,g,h,i,j){var k=0,l=100,m=[b,c,d,e,f,g,h,i].join(),n=cp[m],o,p;!n&&(cp[m]=n={data:[]});n.timer&&clearTimeout(n.timer);n.timer=setTimeout(function(){delete cp[m]},2000);if(j!=null){var q=cq(b,c,d,e,f,g,h,i);l=~(~q)*10}for(var r=0;r<l+1;r++){if(n.data[j]>r)p=n.data[r*l];else{p=a.findDotsAtSegment(b,c,d,e,f,g,h,i,r/l);n.data[r]=p}r&&(k+=C(C(o.x-p.x,2)+C(o.y-p.y,2),0.5));if(j!=null&&k>=j)return p;o=p}if(j==null)return k},cr=function(b,c){return function(d,e,f){d=bw(d);var g,h,i,j,k="",l={},m,n=0;for(var o=0,p=d.length;o<p;o++){i=d[o];if(i[0]=="M"){g=+i[1];h=+i[2]}else{j=cq(g,h,i[1],i[2],i[3],i[4],i[5],i[6]);if(n+j>e){if(c&&!l.start){m=cq(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n);k+=["C",m.start.x,m.start.y,m.m.x,m.m.y,m.x,m.y];if(f)return k;l.start=k;k=["M",m.x,m.y+"C",m.n.x,m.n.y,m.end.x,m.end.y,i[5],i[6]][v]();n+=j;g=+i[5];h=+i[6];continue}if(!b&&!c){m=cq(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n);return{x:m.x,y:m.y,alpha:m.alpha}}}n+=j;g=+i[5];h=+i[6]}k+=i}l.end=k;m=b?n:c?l:a.findDotsAtSegment(g,h,i[1],i[2],i[3],i[4],i[5],i[6],1);m.alpha&&(m={x:m.x,y:m.y,alpha:m.alpha});return m}},cs=cr(1),ct=cr(),cu=cr(0,1);bO.getTotalLength=function(){if(this.type!="path")return;if(this.node.getTotalLength)return this.node.getTotalLength();return cs(this.attrs.path)};bO.getPointAtLength=function(a){if(this.type!="path")return;return ct(this.attrs.path,a)};bO.getSubpath=function(a,b){if(this.type!="path")return;if(B(this.getTotalLength()-b)<"1e-6")return cu(this.attrs.path,a).end;var c=cu(this.attrs.path,b,1);return a?cu(c,a).end:c};a.easing_formulas={linear:function(a){return a},"<":function(a){return C(a,3)},">":function(a){return C(a-1,3)+1},"<>":function(a){a=a*2;if(a<1)return C(a,3)/2;a-=2;return(C(a,3)+2)/2},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a=a-1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){if(a==0||a==1)return a;var b=0.3,c=b/4;return C(2,-10*a)*y.sin((a-c)*(2*D)/b)+1},bounce:function(a){var b=7.5625,c=2.75,d;if(a<1/c)d=b*a*a;else if(a<2/c){a-=1.5/c;d=b*a*a+0.75}else if(a<2.5/c){a-=2.25/c;d=b*a*a+0.9375}else{a-=2.625/c;d=b*a*a+0.984375}return d}};var cv=[],cw=function(){var b=+(new Date);for(var c=0;c<cv[w];c++){var d=cv[c];if(d.stop||d.el.removed)continue;var e=b-d.start,g=d.ms,h=d.easing,i=d.from,j=d.diff,k=d.to,l=d.t,m=d.el,n={},o;if(e<g){var r=h(e/g);for(var s in i)if(i[f](s)){switch(X[s]){case"along":o=r*g*j[s];k.back&&(o=k.len-o);var t=ct(k[s],o);m.translate(j.sx-j.x||0,j.sy-j.y||0);j.x=t.x;j.y=t.y;m.translate(t.x-j.sx,t.y-j.sy);k.rot&&m.rotate(j.r+t.alpha,t.x,t.y);break;case E:o=+i[s]+r*g*j[s];break;case"colour":o="rgb("+[cy(Q(i[s].r+r*g*j[s].r)),cy(Q(i[s].g+r*g*j[s].g)),cy(Q(i[s].b+r*g*j[s].b))][v](",")+")";break;case"path":o=[];for(var u=0,x=i[s][w];u<x;u++){o[u]=[i[s][u][0]];for(var y=1,z=i[s][u][w];y<z;y++)o[u][y]=+i[s][u][y]+r*g*j[s][u][y];o[u]=o[u][v](q)}o=o[v](q);break;case"csv":switch(s){case"translation":var A=r*g*j[s][0]-l.x,B=r*g*j[s][1]-l.y;l.x+=A;l.y+=B;o=A+q+B;break;case"rotation":o=+i[s][0]+r*g*j[s][0];i[s][1]&&(o+=","+i[s][1]+","+i[s][2]);break;case"scale":o=[+i[s][0]+r*g*j[s][0],+i[s][1]+r*g*j[s][1],2 in k[s]?k[s][2]:p,3 in k[s]?k[s][3]:p][v](q);break;case"clip-rect":o=[];u=4;while(u--)o[u]=+i[s][u]+r*g*j[s][u];break}break;default:var C=[].concat(i[s]);o=[];u=m.paper.customAttributes[s].length;while(u--)o[u]=+C[u]+r*g*j[s][u];break}n[s]=o}m.attr(n);m._run&&m._run.call(m)}else{if(k.along){t=ct(k.along,k.len*!k.back);m.translate(j.sx-(j.x||0)+t.x-j.sx,j.sy-(j.y||0)+t.y-j.sy);k.rot&&m.rotate(j.r+t.alpha,t.x,t.y)}(l.x||l.y)&&m.translate(-l.x,-l.y);k.scale&&(k.scale+=p);m.attr(k);cv.splice(c--,1)}}a.svg&&m&&m.paper&&m.paper.safari();cv[w]&&setTimeout(cw)},cx=function(b,c,d,e,f){var g=d-e;c.timeouts.push(setTimeout(function(){a.is(f,"function")&&f.call(c);c.animate(b,g,b.easing)},e))},cy=function(a){return z(A(a,255),0)},cz=function(a,b){if(a==null)return{x:this._.tx,y:this._.ty,toString:co};this._.tx+=+a;this._.ty+=+b;switch(this.type){case"circle":case"ellipse":this.attr({cx:+a+this.attrs.cx,cy:+b+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+a+this.attrs.x,y:+b+this.attrs.y});break;case"path":var c=bp(this.attrs.path);c[0][1]+=+a;c[0][2]+=+b;this.attr({path:c});break}return this};bO.animateWith=function(a,b,c,d,e){for(var f=0,g=cv.length;f<g;f++)cv[f].el.id==a.id&&(b.start=cv[f].start);return this.animate(b,c,d,e)};bO.animateAlong=cA();bO.animateAlongBack=cA(1);function cA(b){return function(c,d,e,f){var g={back:b};a.is(e,"function")?f=e:g.rot=e;c&&c.constructor==bN&&(c=c.attrs.path);c&&(g.along=c);return this.animate(g,d,f)}}function cB(a,b,c,d,e,f){var g=3*b,h=3*(d-b)-g,i=1-g-h,j=3*c,k=3*(e-c)-j,l=1-j-k;function m(a){return((i*a+h)*a+g)*a}function n(a,b){var c=o(a,b);return((l*c+k)*c+j)*c}function o(a,b){var c,d,e,f,j,k;for(e=a,k=0;k<8;k++){f=m(e)-a;if(B(f)<b)return e;j=(3*i*e+2*h)*e+g;if(B(j)<0.000001)break;e=e-f/j}c=0;d=1;e=a;if(e<c)return c;if(e>d)return d;while(c<d){f=m(e);if(B(f-a)<b)return e;a>f?c=e:d=e;e=(d-c)/2+c}return e}return n(a,1/(200*f))}bO.onAnimation=function(a){this._run=a||0;return this};bO.animate=function(c,d,e,g){var h=this;h.timeouts=h.timeouts||[];if(a.is(e,"function")||!e)g=e||null;if(h.removed){g&&g.call(h);return h}var i={},j={},k=false,l={};for(var m in c)if(c[f](m)){if(X[f](m)||h.paper.customAttributes[f](m)){k=true;i[m]=h.attr(m);i[m]==null&&(i[m]=W[m]);j[m]=c[m];switch(X[m]){case"along":var n=cs(c[m]),o=ct(c[m],n*!(!c.back)),p=h.getBBox();l[m]=n/d;l.tx=p.x;l.ty=p.y;l.sx=o.x;l.sy=o.y;j.rot=c.rot;j.back=c.back;j.len=n;c.rot&&(l.r=S(h.rotate())||0);break;case E:l[m]=(j[m]-i[m])/d;break;case"colour":i[m]=a.getRGB(i[m]);var q=a.getRGB(j[m]);l[m]={r:(q.r-i[m].r)/d,g:(q.g-i[m].g)/d,b:(q.b-i[m].b)/d};break;case"path":var t=bw(i[m],j[m]);i[m]=t[0];var u=t[1];l[m]=[];for(var v=0,x=i[m][w];v<x;v++){l[m][v]=[0];for(var y=1,z=i[m][v][w];y<z;y++)l[m][v][y]=(u[v][y]-i[m][v][y])/d}break;case"csv":var A=r(c[m])[s](b),B=r(i[m])[s](b);switch(m){case"translation":i[m]=[0,0];l[m]=[A[0]/d,A[1]/d];break;case"rotation":i[m]=B[1]==A[1]&&B[2]==A[2]?B:[0,A[1],A[2]];l[m]=[(A[0]-i[m][0])/d,0,0];break;case"scale":c[m]=A;i[m]=r(i[m])[s](b);l[m]=[(A[0]-i[m][0])/d,(A[1]-i[m][1])/d,0,0];break;case"clip-rect":i[m]=r(i[m])[s](b);l[m]=[];v=4;while(v--)l[m][v]=(A[v]-i[m][v])/d;break}j[m]=A;break;default:A=[].concat(c[m]);B=[].concat(i[m]);l[m]=[];v=h.paper.customAttributes[m][w];while(v--)l[m][v]=((A[v]||0)-(B[v]||0))/d;break}}}if(k){var G=a.easing_formulas[e];if(!G){G=r(e).match(P);if(G&&G[w]==5){var H=G;G=function(a){return cB(a,+H[1],+H[2],+H[3],+H[4],d)}}else G=function(a){return a}}cv.push({start:c.start||+(new Date),ms:d,easing:G,from:i,diff:l,to:j,el:h,t:{x:0,y:0}});a.is(g,"function")&&(h._ac=setTimeout(function(){g.call(h)},d));cv[w]==1&&setTimeout(cw)}else{var C=[],D;for(var F in c)if(c[f](F)&&Z.test(F)){m={value:c[F]};F=="from"&&(F=0);F=="to"&&(F=100);m.key=T(F,10);C.push(m)}C.sort(be);C[0].key&&C.unshift({key:0,value:h.attrs});for(v=0,x=C[w];v<x;v++)cx(C[v].value,h,d/100*C[v].key,d/100*(C[v-1]&&C[v-1].key||0),C[v-1]&&C[v-1].value.callback);D=C[C[w]-1].value.callback;D&&h.timeouts.push(setTimeout(function(){D.call(h)},d))}return this};bO.stop=function(){for(var a=0;a<cv.length;a++)cv[a].el.id==this.id&&cv.splice(a--,1);for(a=0,ii=this.timeouts&&this.timeouts.length;a<ii;a++)clearTimeout(this.timeouts[a]);this.timeouts=[];clearTimeout(this._ac);delete this._ac;return this};bO.translate=function(a,b){return this.attr({translation:a+" "+b})};bO[H]=function(){return"Raphals object"};a.ae=cv;var cC=function(a){this.items=[];this[w]=0;this.type="set";if(a)for(var b=0,c=a[w];b<c;b++){if(a[b]&&(a[b].constructor==bN||a[b].constructor==cC)){this[this.items[w]]=this.items[this.items[w]]=a[b];this[w]++}}};cC[e][L]=function(){var a,b;for(var c=0,d=arguments[w];c<d;c++){a=arguments[c];if(a&&(a.constructor==bN||a.constructor==cC)){b=this.items[w];this[b]=this.items[b]=a;this[w]++}}return this};cC[e].pop=function(){delete this[this[w]--];return this.items.pop()};for(var cD in bO)bO[f](cD)&&(cC[e][cD]=(function(a){return function(){for(var b=0,c=this.items[w];b<c;b++)this.items[b][a][m](this.items[b],arguments);return this}})(cD));cC[e].attr=function(b,c){if(b&&a.is(b,G)&&a.is(b[0],"object"))for(var d=0,e=b[w];d<e;d++)this.items[d].attr(b[d]);else for(var f=0,g=this.items[w];f<g;f++)this.items[f].attr(b,c);return this};cC[e].animate=function(b,c,d,e){(a.is(d,"function")||!d)&&(e=d||null);var f=this.items[w],g=f,h,i=this,j;e&&(j=function(){!(--f)&&e.call(i)});d=a.is(d,F)?d:j;h=this.items[--g].animate(b,c,d,j);while(g--)this.items[g]&&!this.items[g].removed&&this.items[g].animateWith(h,b,c,d,j);return this};cC[e].insertAfter=function(a){var b=this.items[w];while(b--)this.items[b].insertAfter(a);return this};cC[e].getBBox=function(){var a=[],b=[],c=[],d=[];for(var e=this.items[w];e--;){var f=this.items[e].getBBox();a[L](f.x);b[L](f.y);c[L](f.x+f.width);d[L](f.y+f.height)}a=A[m](0,a);b=A[m](0,b);return{x:a,y:b,width:z[m](0,c)-a,height:z[m](0,d)-b}};cC[e].clone=function(a){a=new cC;for(var b=0,c=this.items[w];b<c;b++)a[L](this.items[b].clone());return a};a.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[f](d)&&(b.face[d]=a.face[d]);this.fonts[c]?this.fonts[c][L](b):this.fonts[c]=[b];if(!a.svg){b.face["units-per-em"]=T(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[f](e)){var g=a.glyphs[e];b.glyphs[e]={w:g.w,k:{},d:g.d&&"M"+g.d[Y](/[mlcxtrv]/g,function(a){return({l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"})[a]||"M"})+"z"};if(g.k)for(var h in g.k)g[f](h)&&(b.glyphs[e].k[h]=g.k[h])}}return a};k.getFont=function(b,c,d,e){e=e||"normal";d=d||"normal";c=+c||({normal:400,bold:700,lighter:300,bolder:800})[c]||400;if(!a.fonts)return;var g=a.fonts[b];if(!g){var h=new RegExp("(^|\\s)"+b[Y](/[^\w\d\s+!~.:_-]/g,p)+"(\\s|$)","i");for(var i in a.fonts)if(a.fonts[f](i)){if(h.test(i)){g=a.fonts[i];break}}}var j;if(g)for(var k=0,l=g[w];k<l;k++){j=g[k];if(j.face["font-weight"]==c&&(j.face["font-style"]==d||!j.face["font-style"])&&j.face["font-stretch"]==e)break}return j};k.print=function(c,d,e,f,g,h,i){h=h||"middle";i=z(A(i||0,1),-1);var j=this.set(),k=r(e)[s](p),l=0,m=p,n;a.is(f,e)&&(f=this.getFont(f));if(f){n=(g||16)/f.face["units-per-em"];var o=f.face.bbox.split(b),q=+o[0],t=+o[1]+(h=="baseline"?o[3]-o[1]+ +f.face.descent:(o[3]-o[1])/2);for(var u=0,v=k[w];u<v;u++){var x=u&&f.glyphs[k[u-1]]||{},y=f.glyphs[k[u]];l+=u?(x.w||f.w)+(x.k&&x.k[k[u]]||0)+f.w*i:0;y&&y.d&&j[L](this.path(y.d).attr({fill:"#000",stroke:"none",translation:[l,0]}))}j.scale(n,n,q,t).translate(c-q,d-t)}return j};a.format=function(b,c){var e=a.is(c,G)?[0][n](c):arguments;b&&a.is(b,F)&&e[w]-1&&(b=b[Y](d,function(a,b){return e[++b]==null?p:e[b]}));return b||p};a.ninja=function(){i.was?h.Raphael=i.is:delete Raphael;return a};a.el=bO;a.st=cC[e];i.was?h.Raphael=a:Raphael=a})();/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/graphael/g.raphael-min.js*//* * g.Raphael 0.4.1 - Charting library, based on Raphal * * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com) * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license. */(function(){var a=Math.max,c=Math.min;Raphael.fn.g=Raphael.fn.g||{};Raphael.fn.g.markers={disc:"disc",o:"disc",flower:"flower",f:"flower",diamond:"diamond",d:"diamond",square:"square",s:"square",triangle:"triangle",t:"triangle",star:"star","*":"star",cross:"cross",x:"cross",plus:"plus","+":"plus",arrow:"arrow","->":"arrow"};Raphael.fn.g.shim={stroke:"none",fill:"#000","fill-opacity":0};Raphael.fn.g.txtattr={font:"12px Arial, sans-serif"};Raphael.fn.g.colors=[];var e=[0.6,0.2,0.05,0.1333,0.75,0];for(var b=0;b<10;b++){if(b<e.length){Raphael.fn.g.colors.push("hsb("+e[b]+", .75, .75)");}else{Raphael.fn.g.colors.push("hsb("+e[b-e.length]+", 1, .5)");}}Raphael.fn.g.text=function(f,h,g){return this.text(f,h,g).attr(this.g.txtattr);};Raphael.fn.g.labelise=function(f,h,g){if(f){return(f+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(i,k,j){if(k){return(+h).toFixed(k.replace(/^#+\.?/g,"").length);}if(j){return(h*100/g).toFixed(j.replace(/^%+\.?/g,"").length)+"%";}});}else{return(+h).toFixed(0);}};Raphael.fn.g.finger=function(l,k,g,m,h,i,j){if((h&&!m)||(!h&&!g)){return j?"":this.path();}i={square:"square",sharp:"sharp",soft:"soft"}[i]||"round";var o;m=Math.round(m);g=Math.round(g);l=Math.round(l);k=Math.round(k);switch(i){case"round":if(!h){var f=~~(m/2);if(g<f){f=g;o=["M",l+0.5,k+0.5-~~(m/2),"l",0,0,"a",f,~~(m/2),0,0,1,0,m,"l",0,0,"z"];}else{o=["M",l+0.5,k+0.5-f,"l",g-f,0,"a",f,f,0,1,1,0,m,"l",f-g,0,"z"];}}else{f=~~(g/2);if(m<f){f=m;o=["M",l-~~(g/2),k,"l",0,0,"a",~~(g/2),f,0,0,1,g,0,"l",0,0,"z"];}else{o=["M",l-f,k,"l",0,f-m,"a",f,f,0,1,1,g,0,"l",0,m-f,"z"];}}break;case"sharp":if(!h){var n=~~(m/2);o=["M",l,k+n,"l",0,-m,a(g-n,0),0,c(n,g),n,-c(n,g),n+(n*2<m),"z"];}else{n=~~(g/2);o=["M",l+n,k,"l",-g,0,0,-a(m-n,0),n,-c(n,m),n,c(n,m),n,"z"];}break;case"square":if(!h){o=["M",l,k+~~(m/2),"l",0,-m,g,0,0,m,"z"];}else{o=["M",l+~~(g/2),k,"l",1-g,0,0,-m,g-1,0,"z"];}break;case"soft":if(!h){f=c(g,Math.round(m/5));o=["M",l+0.5,k+0.5-~~(m/2),"l",g-f,0,"a",f,f,0,0,1,f,f,"l",0,m-f*2,"a",f,f,0,0,1,-f,f,"l",f-g,0,"z"];}else{f=c(Math.round(g/5),m);o=["M",l-~~(g/2),k,"l",0,f-m,"a",f,f,0,0,1,f,-f,"l",g-2*f,0,"a",f,f,0,0,1,f,f,"l",0,m-f,"z"];}}if(j){return o.join(",");}else{return this.path(o);}};Raphael.fn.g.disc=function(f,h,g){return this.circle(f,h,g);};Raphael.fn.g.line=function(f,h,g){return this.rect(f-g,h-g/5,2*g,2*g/5);};Raphael.fn.g.square=function(f,h,g){g=g*0.7;return this.rect(f-g,h-g,2*g,2*g);};Raphael.fn.g.triangle=function(f,h,g){g*=1.75;return this.path("M".concat(f,",",h,"m0-",g*0.58,"l",g*0.5,",",g*0.87,"-",g,",0z"));};Raphael.fn.g.diamond=function(f,h,g){return this.path(["M",f,h-g,"l",g,g,-g,g,-g,-g,g,-g,"z"]);};Raphael.fn.g.flower=function(j,h,f,g){f=f*1.25;var o=f,m=o*0.5;g=+g<3||!g?5:g;var p=["M",j,h+m,"Q"],l;for(var k=1;k<g*2+1;k++){l=k%2?o:m;p=p.concat([+(j+l*Math.sin(k*Math.PI/g)).toFixed(3),+(h+l*Math.cos(k*Math.PI/g)).toFixed(3)]);}p.push("z");return this.path(p.join(","));};Raphael.fn.g.star=function(f,n,m,h,g){h=h||m*0.382;g=g||5;var l=["M",f,n+h,"L"],k;for(var j=1;j<g*2;j++){k=j%2?m:h;l=l.concat([(f+k*Math.sin(j*Math.PI/g)),(n+k*Math.cos(j*Math.PI/g))]);}l.push("z");return this.path(l.join(","));};Raphael.fn.g.cross=function(f,h,g){g=g/2.5;return this.path("M".concat(f-g,",",h,"l",[-g,-g,g,-g,g,g,g,-g,g,g,-g,g,g,g,-g,g,-g,-g,-g,g,-g,-g,"z"]));};Raphael.fn.g.plus=function(f,h,g){g=g/2;return this.path("M".concat(f-g/2,",",h-g/2,"l",[0,-g,g,0,0,g,g,0,0,g,-g,0,0,g,-g,0,0,-g,-g,0,0,-g,"z"]));};Raphael.fn.g.arrow=function(f,h,g){return this.path("M".concat(f-g*0.7,",",h-g*0.4,"l",[g*0.6,0,0,-g*0.4,g,g*0.8,-g,g*0.8,0,-g*0.4,-g*0.6,0],"z"));};Raphael.fn.g.tag=function(f,m,l,k,i){k=k||0;i=i==null?5:i;l=l==null?"$9.99":l;var h=0.5522*i,g=this.set(),j=3;g.push(this.path().attr({fill:"#000",stroke:"#000"}));g.push(this.text(f,m,l).attr(this.g.txtattr).attr({fill:"#fff","font-family":"Helvetica, Arial"}));g.update=function(){this.rotate(0,f,m);var o=this[1].getBBox();if(o.height>=i*2){this[0].attr({path:["M",f,m+i,"a",i,i,0,1,1,0,-i*2,i,i,0,1,1,0,i*2,"m",0,-i*2-j,"a",i+j,i+j,0,1,0,0,(i+j)*2,"L",f+i+j,m+o.height/2+j,"l",o.width+2*j,0,0,-o.height-2*j,-o.width-2*j,0,"L",f,m-i-j].join(",")});}else{var n=Math.sqrt(Math.pow(i+j,2)-Math.pow(o.height/2+j,2));this[0].attr({path:["M",f,m+i,"c",-h,0,-i,h-i,-i,-i,0,-h,i-h,-i,i,-i,h,0,i,i-h,i,i,0,h,h-i,i,-i,i,"M",f+n,m-o.height/2-j,"a",i+j,i+j,0,1,0,0,o.height+2*j,"l",i+j-n+o.width+2*j,0,0,-o.height-2*j,"L",f+n,m-o.height/2-j].join(",")});}this[1].attr({x:f+i+j+o.width/2,y:m});k=(360-k)%360;this.rotate(k,f,m);k>90&&k<270&&this[1].attr({x:f-i-j-o.width/2,y:m,rotation:[180+k,f,m]});return this;};g.update();return g;};Raphael.fn.g.popupit=function(l,k,m,g,t){g=g==null?2:g;t=t||5;l=Math.round(l);k=Math.round(k);var j=m.getBBox(),n=Math.round(j.width/2),i=Math.round(j.height/2),s=[0,n+t*2,0,-n-t*2],o=[-i*2-t*3,-i-t,0,-i-t],f=["M",l-s[g],k-o[g],"l",-t,(g==2)*-t,-a(n-t,0),0,"a",t,t,0,0,1,-t,-t,"l",0,-a(i-t,0),(g==3)*-t,-t,(g==3)*t,-t,0,-a(i-t,0),"a",t,t,0,0,1,t,-t,"l",a(n-t,0),0,t,!g*-t,t,!g*t,a(n-t,0),0,"a",t,t,0,0,1,t,t,"l",0,a(i-t,0),(g==1)*t,t,(g==1)*-t,t,0,a(i-t,0),"a",t,t,0,0,1,-t,t,"l",-a(n-t,0),0,"z"].join(","),q=[{x:l,y:k+t*2+i},{x:l-t*2-n,y:k},{x:l,y:k-t*2-i},{x:l+t*2+n,y:k}][g];m.translate(q.x-n-j.x,q.y-i-j.y);return this.path(f).attr({fill:"#000",stroke:"none"}).insertBefore(m.node?m:m[0]);};Raphael.fn.g.popup=function(f,l,k,g,i){g=g==null?2:g>3?3:g;i=i||5;k=k||"$9.99";var h=this.set(),j=3;h.push(this.path().attr({fill:"#000",stroke:"#000"}));h.push(this.text(f,l,k).attr(this.g.txtattr).attr({fill:"#fff","font-family":"Helvetica, Arial"}));h.update=function(o,n,q){o=o||f;n=n||l;var t=this[1].getBBox(),u=t.width/2,s=t.height/2,y=[0,u+i*2,0,-u-i*2],v=[-s*2-i*3,-s-i,0,-s-i],m=["M",o-y[g],n-v[g],"l",-i,(g==2)*-i,-a(u-i,0),0,"a",i,i,0,0,1,-i,-i,"l",0,-a(s-i,0),(g==3)*-i,-i,(g==3)*i,-i,0,-a(s-i,0),"a",i,i,0,0,1,i,-i,"l",a(u-i,0),0,i,!g*-i,i,!g*i,a(u-i,0),0,"a",i,i,0,0,1,i,i,"l",0,a(s-i,0),(g==1)*i,i,(g==1)*-i,i,0,a(s-i,0),"a",i,i,0,0,1,-i,i,"l",-a(u-i,0),0,"z"].join(","),x=[{x:o,y:n+i*2+s},{x:o-i*2-u,y:n},{x:o,y:n-i*2-s},{x:o+i*2+u,y:n}][g];x.path=m;if(q){this.animate(x,500,">");}else{this.attr(x);}return this;};return h.update(f,l);};Raphael.fn.g.flag=function(f,k,j,i){i=i||0;j=j||"$9.99";var g=this.set(),h=3;g.push(this.path().attr({fill:"#000",stroke:"#000"}));g.push(this.text(f,k,j).attr(this.g.txtattr).attr({fill:"#fff","font-family":"Helvetica, Arial"}));g.update=function(l,o){this.rotate(0,l,o);var n=this[1].getBBox(),m=n.height/2;this[0].attr({path:["M",l,o,"l",m+h,-m-h,n.width+2*h,0,0,n.height+2*h,-n.width-2*h,0,"z"].join(",")});this[1].attr({x:l+m+h+n.width/2,y:o});i=360-i;this.rotate(i,l,o);i>90&&i<270&&this[1].attr({x:l-r-h-n.width/2,y:o,rotation:[180+i,l,o]});return this;};return g.update(f,k);};Raphael.fn.g.label=function(f,i,h){var g=this.set();g.push(this.rect(f,i,10,10).attr({stroke:"none",fill:"#000"}));g.push(this.text(f,i,h).attr(this.g.txtattr).attr({fill:"#fff"}));g.update=function(){var k=this[1].getBBox(),j=c(k.width+10,k.height+10)/2;this[0].attr({x:k.x-j/2,y:k.y-j/2,width:k.width+j,height:k.height+j,r:j});};g.update();return g;};Raphael.fn.g.labelit=function(h){var g=h.getBBox(),f=c(20,g.width+10,g.height+10)/2;return this.rect(g.x-f/2,g.y-f/2,g.width+f,g.height+f,f).attr({stroke:"none",fill:"#000"}).insertBefore(h.node?h:h[0]);};Raphael.fn.g.drop=function(f,k,j,h,i){h=h||30;i=i||0;var g=this.set();g.push(this.path(["M",f,k,"l",h,0,"A",h*0.4,h*0.4,0,1,0,f+h*0.7,k-h*0.7,"z"]).attr({fill:"#000",stroke:"none",rotation:[22.5-i,f,k]}));i=(i+90)*Math.PI/180;g.push(this.text(f+h*Math.sin(i),k+h*Math.cos(i),j).attr(this.g.txtattr).attr({"font-size":h*12/30,fill:"#fff"}));g.drop=g[0];g.text=g[1];return g;};Raphael.fn.g.blob=function(g,m,l,k,i){k=(+k+1?k:45)+90;i=i||12;var f=Math.PI/180,j=i*12/12;var h=this.set();h.push(this.path().attr({fill:"#000",stroke:"none"}));h.push(this.text(g+i*Math.sin((k)*f),m+i*Math.cos((k)*f)-j/2,l).attr(this.g.txtattr).attr({"font-size":j,fill:"#fff"}));h.update=function(t,s,y){t=t||g;s=s||m;var A=this[1].getBBox(),D=a(A.width+j,i*25/12),z=a(A.height+j,i*25/12),o=t+i*Math.sin((k-22.5)*f),B=s+i*Math.cos((k-22.5)*f),q=t+i*Math.sin((k+22.5)*f),C=s+i*Math.cos((k+22.5)*f),F=(q-o)/2,E=(C-B)/2,p=D/2,n=z/2,x=-Math.sqrt(Math.abs(p*p*n*n-p*p*E*E-n*n*F*F)/(p*p*E*E+n*n*F*F)),v=x*p*E/n+(q+o)/2,u=x*-n*F/p+(C+B)/2;if(y){this.animate({x:v,y:u,path:["M",g,m,"L",q,C,"A",p,n,0,1,1,o,B,"z"].join(",")},500,">");}else{this.attr({x:v,y:u,path:["M",g,m,"L",q,C,"A",p,n,0,1,1,o,B,"z"].join(",")});}return this;};h.update(g,m);return h;};Raphael.fn.g.colorValue=function(i,h,g,f){return"hsb("+[c((1-i/h)*0.4,1),g||0.75,f||0.75]+")";};Raphael.fn.g.snapEnds=function(n,o,m){var k=n,p=o;if(k==p){return{from:k,to:p,power:0};}function q(f){return Math.abs(f-0.5)<0.25?~~(f)+0.5:Math.round(f);}var l=(p-k)/m,g=~~(l),j=g,h=0;if(g){while(j){h--;j=~~(l*Math.pow(10,h))/Math.pow(10,h);}h++;}else{while(!g){h=h||1;g=~~(l*Math.pow(10,h))/Math.pow(10,h);h++;}h&&h--;}p=q(o*Math.pow(10,h))/Math.pow(10,h);if(p<o){p=q((o+0.5)*Math.pow(10,h))/Math.pow(10,h);}k=q((n-(h>0?0:0.5))*Math.pow(10,h))/Math.pow(10,h);return{from:k,to:p,power:h};};Raphael.fn.g.axis=function(v,u,o,G,l,J,m,L,n,g){g=g==null?2:g;n=n||"t";J=J||10;var F=n=="|"||n==" "?["M",v+0.5,u,"l",0,0.001]:m==1||m==3?["M",v+0.5,u,"l",0,-o]:["M",v,u+0.5,"l",o,0],z=this.g.snapEnds(G,l,J),K=z.from,B=z.to,I=z.power,H=0,C=this.set();d=(B-K)/J;var s=K,q=I>0?I:0;w=o/J;if(+m==1||+m==3){var h=u,A=(m-1?1:-1)*(g+3+!!(m-1));while(h>=u-o){n!="-"&&n!=" "&&(F=F.concat(["M",v-(n=="+"||n=="|"?g:!(m-1)*g*2),h+0.5,"l",g*2+1,0]));C.push(this.text(v+A,h,(L&&L[H++])||(Math.round(s)==s?s:+s.toFixed(q))).attr(this.g.txtattr).attr({"text-anchor":m-1?"start":"end"}));s+=d;h-=w;}if(Math.round(h+w-(u-o))){n!="-"&&n!=" "&&(F=F.concat(["M",v-(n=="+"||n=="|"?g:!(m-1)*g*2),u-o+0.5,"l",g*2+1,0]));C.push(this.text(v+A,u-o,(L&&L[H])||(Math.round(s)==s?s:+s.toFixed(q))).attr(this.g.txtattr).attr({"text-anchor":m-1?"start":"end"}));}}else{s=K;q=(I>0)*I;A=(m?-1:1)*(g+9+!m);var k=v,w=o/J,D=0,E=0;while(k<=v+o){n!="-"&&n!=" "&&(F=F.concat(["M",k+0.5,u-(n=="+"?g:!!m*g*2),"l",0,g*2+1]));C.push(D=this.text(k,u+A,(L&&L[H++])||(Math.round(s)==s?s:+s.toFixed(q))).attr(this.g.txtattr));var p=D.getBBox();if(E>=p.x-5){C.pop(C.length-1).remove();}else{E=p.x+p.width;}s+=d;k+=w;}if(Math.round(k-w-v-o)){n!="-"&&n!=" "&&(F=F.concat(["M",v+o+0.5,u-(n=="+"?g:!!m*g*2),"l",0,g*2+1]));C.push(this.text(v+o,u+A,(L&&L[H])||(Math.round(s)==s?s:+s.toFixed(q))).attr(this.g.txtattr));}}var M=this.path(F);M.text=C;M.all=this.set([M,C]);M.remove=function(){this.text.remove();this.constructor.prototype.remove.call(this);};return M;};Raphael.el.lighter=function(g){g=g||2;var f=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[f[0],f[1]];f[0]=Raphael.rgb2hsb(Raphael.getRGB(f[0]).hex);f[1]=Raphael.rgb2hsb(Raphael.getRGB(f[1]).hex);f[0].b=c(f[0].b*g,1);f[0].s=f[0].s/g;f[1].b=c(f[1].b*g,1);f[1].s=f[1].s/g;this.attr({fill:"hsb("+[f[0].h,f[0].s,f[0].b]+")",stroke:"hsb("+[f[1].h,f[1].s,f[1].b]+")"});};Raphael.el.darker=function(g){g=g||2;var f=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[f[0],f[1]];f[0]=Raphael.rgb2hsb(Raphael.getRGB(f[0]).hex);f[1]=Raphael.rgb2hsb(Raphael.getRGB(f[1]).hex);f[0].s=c(f[0].s*g,1);f[0].b=f[0].b/g;f[1].s=c(f[1].s*g,1);f[1].b=f[1].b/g;this.attr({fill:"hsb("+[f[0].h,f[0].s,f[0].b]+")",stroke:"hsb("+[f[1].h,f[1].s,f[1].b]+")"});};Raphael.el.original=function(){if(this.fs){this.attr({fill:this.fs[0],stroke:this.fs[1]});delete this.fs;}};})();/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/graphael/g.line-min.js*//* * g.Raphael 0.4.2 - Charting library, based on Raphal * * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com) * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license. */Raphael.fn.g.linechart=function(M,L,b,d,t,s,F){function E(x,ae){var i=x.length/ae,y=0,a=i,Y=0,X=[];while(y<x.length){a--;if(a<0){Y+=x[y]*(1+a);X.push(Y/i);Y=x[y++]*-a;a+=i}else{Y+=x[y++]}}return X}function P(j,i,aj,ah,ae,Y){var y=(aj-j)/2,x=(ae-aj)/2,ak=Math.atan((aj-j)/Math.abs(ah-i)),ai=Math.atan((ae-aj)/Math.abs(ah-Y));ak=i<ah?Math.PI-ak:ak;ai=Y<ah?Math.PI-ai:ai;var X=Math.PI/2-((ak+ai)%(Math.PI*2))/2,am=y*Math.sin(X+ak),ag=y*Math.cos(X+ak),al=x*Math.sin(X+ai),af=x*Math.cos(X+ai);return{x1:aj-am,y1:ah+ag,x2:aj+al,y2:ah+af}}F=F||{};if(!this.raphael.is(t[0],"array")){t=[t]}if(!this.raphael.is(s[0],"array")){s=[s]}var m=F.gutter||10,u=Math.max(t[0].length,s[0].length),o=F.symbol||"",Q=F.colors||Raphael.fn.g.colors,K=this,q=null,l=null,ab=this.set(),R=[];for(var aa=0,H=s.length;aa<H;aa++){u=Math.max(u,s[aa].length)}var ac=this.set();for(aa=0,H=s.length;aa<H;aa++){if(F.shade){ac.push(this.path().attr({stroke:"none",fill:Q[aa],opacity:F.nostroke?1:0.3}))}if(s[aa].length>b-2*m){s[aa]=E(s[aa],b-2*m);u=b-2*m}if(t[aa]&&t[aa].length>b-2*m){t[aa]=E(t[aa],b-2*m)}}var U=Array.prototype.concat.apply([],t),S=Array.prototype.concat.apply([],s),p=this.g.snapEnds(Math.min.apply(Math,U),Math.max.apply(Math,U),t[0].length-1),z=p.from,k=p.to,J=this.g.snapEnds(Math.min.apply(Math,S),Math.max.apply(Math,S),s[0].length-1),v=J.from,h=J.to,V=(b-m*2)/((k-z)||1),T=(d-m*2)/((h-v)||1);var B=this.set();if(F.axis){var g=(F.axis+"").split(/[,\s]+/);+g[0]&&B.push(this.g.axis(M+m,L+m,b-2*m,z,k,F.axisxstep||Math.floor((b-2*m)/20),2));+g[1]&&B.push(this.g.axis(M+b-m,L+d-m,d-2*m,v,h,F.axisystep||Math.floor((d-2*m)/20),3));+g[2]&&B.push(this.g.axis(M+m,L+d-m,b-2*m,z,k,F.axisxstep||Math.floor((b-2*m)/20),0));+g[3]&&B.push(this.g.axis(M+m,L+d-m,d-2*m,v,h,F.axisystep||Math.floor((d-2*m)/20),1))}var I=this.set(),W=this.set(),n;for(aa=0,H=s.length;aa<H;aa++){if(!F.nostroke){I.push(n=this.path().attr({stroke:Q[aa],"stroke-width":F.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":F.dash||""}))}var c=this.raphael.is(o,"array")?o[aa]:o,C=this.set();R=[];for(var Z=0,r=s[aa].length;Z<r;Z++){var f=M+m+((t[aa]||t[0])[Z]-z)*V,e=L+d-m-(s[aa][Z]-v)*T;(Raphael.is(c,"array")?c[Z]:c)&&C.push(this.g[Raphael.fn.g.markers[this.raphael.is(c,"array")?c[Z]:c]](f,e,(F.width||2)*3).attr({fill:Q[aa],stroke:"none"}));if(F.smooth){if(Z&&Z!=r-1){var O=M+m+((t[aa]||t[0])[Z-1]-z)*V,A=L+d-m-(s[aa][Z-1]-v)*T,N=M+m+((t[aa]||t[0])[Z+1]-z)*V,w=L+d-m-(s[aa][Z+1]-v)*T;var ad=P(O,A,f,e,N,w);R=R.concat([ad.x1,ad.y1,f,e,ad.x2,ad.y2])}if(!Z){R=["M",f,e,"C",f,e]}}else{R=R.concat([Z?"L":"M",f,e])}}if(F.smooth){R=R.concat([f,e,f,e])}W.push(C);if(F.shade){ac[aa].attr({path:R.concat(["L",f,L+d-m,"L",M+m+((t[aa]||t[0])[0]-z)*V,L+d-m,"z"]).join(",")})}!F.nostroke&&n.attr({path:R.join(",")})}function G(ak){var ah=[];for(var ai=0,am=t.length;ai<am;ai++){ah=ah.concat(t[ai])}ah.sort();var an=[],ae=[];for(ai=0,am=ah.length;ai<am;ai++){ah[ai]!=ah[ai-1]&&an.push(ah[ai])&&ae.push(M+m+(ah[ai]-z)*V)}ah=an;am=ah.length;var Y=ak||K.set();for(ai=0;ai<am;ai++){var y=ae[ai]-(ae[ai]-(ae[ai-1]||M))/2,al=((ae[ai+1]||M+b)-ae[ai])/2+(ae[ai]-(ae[ai-1]||M))/2,a;ak?(a={}):Y.push(a=K.rect(y-1,L,Math.max(al+1,1),d).attr({stroke:"none",fill:"#000",opacity:0}));a.values=[];a.symbols=K.set();a.y=[];a.x=ae[ai];a.axis=ah[ai];for(var ag=0,aj=s.length;ag<aj;ag++){an=t[ag]||t[0];for(var af=0,x=an.length;af<x;af++){if(an[af]==ah[ai]){a.values.push(s[ag][af]);a.y.push(L+d-m-(s[ag][af]-v)*T);a.symbols.push(ab.symbols[ag][af])}}}ak&&ak.call(a)}!ak&&(q=Y)}function D(ai){var ae=ai||K.set(),a;for(var ag=0,ak=s.length;ag<ak;ag++){for(var af=0,ah=s[ag].length;af<ah;af++){var y=M+m+((t[ag]||t[0])[af]-z)*V,aj=M+m+((t[ag]||t[0])[af?af-1:1]-z)*V,x=L+d-m-(s[ag][af]-v)*T;ai?(a={}):ae.push(a=K.circle(y,x,(F.width||2)*3+1).attr({stroke:"none",fill:"#000",opacity:0}));a.x=y;a.y=x;a.value=s[ag][af];a.line=ab.lines[ag];a.shade=ab.shades[ag];a.symbol=ab.symbols[ag][af];a.symbols=ab.symbols[ag];a.axis=(t[ag]||t[0])[af];ai&&ai.call(a)}}!ai&&(l=ae)}ab.push(I,ac,W,B,q,l);ab.lines=I;ab.shades=ac;ab.symbols=W;ab.axis=B;ab.hoverColumn=function(i,a){!q&&G();q.mouseover(i).mouseout(a);return this};ab.clickColumn=function(a){!q&&G();q.click(a);return this};ab.dblclickColumn=function(a){!q&&G();q.dblclick(a);return this};ab.mousedownColumn=function(a){!q&&G();q.mousedown(a);return this};ab.mousemoveColumn=function(a){!q&&G();q.mousemove(a);return this};ab.mouseoutColumn=function(a){!q&&G();q.mouseout(a);return this};ab.mouseoverColumn=function(a){!q&&G();q.mouseover(a);return this};ab.mouseupColumn=function(a){!q&&G();q.mouseup(a);return this};ab.hrefColumn=function(X){var Y=K.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof X=="object"){for(var a in X){for(var j=0,y=q.length;j<y;j++){if(q[j].axis==a){q[j].attr("href",X[a])}}}}!q&&G();for(j=0,y=Y.length;j<y;j++){q[j]&&q[j].attr("href",Y[j])}return this};ab.hover=function(i,a){!l&&D();l.mouseover(i).mouseout(a);return this};ab.click=function(a){!l&&D();l.click(a);return this};ab.dblclick=function(a){!l&&D();l.dblclick(a);return this};ab.mousedown=function(a){!l&&D();l.mousedown(a);return this};ab.mousemove=function(a){!l&&D();l.mousemove(a);return this};ab.mouseout=function(a){!l&&D();l.mouseout(a);return this};ab.mouseover=function(a){!l&&D();l.mouseover(a);return this};ab.mouseup=function(a){!l&&D();l.mouseup(a);return this};ab.each=function(a){D(a);return this};ab.eachColumn=function(a){G(a);return this};return ab};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/graphael/g.bar-min.js*//* * g.Raphael 0.4.1 - Charting library, based on Raphal * * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com) * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license. */Raphael.fn.g.barchart=function(C,A,a,d,O,u){u=u||{};var P={round:"round",sharp:"sharp",soft:"soft"}[u.type]||"square",n=parseFloat(u.gutter||"20%"),M=this.set(),v=this.set(),e=this.set(),r=this.set(),w=Math.max.apply(Math,O),N=[],c=this,B=0,F=u.colors||this.g.colors,q=O.length;if(this.raphael.is(O[0],"array")){w=[];B=q;q=0;for(var K=O.length;K--;){v.push(this.set());w.push(Math.max.apply(Math,O[K]));q=Math.max(q,O[K].length);}if(u.stacked){for(var K=q;K--;){var l=0;for(var J=O.length;J--;){l+=+O[J][K]||0;}N.push(l);}}for(var K=O.length;K--;){if(O[K].length<q){for(var J=q;J--;){O[K].push(0);}}}w=Math.max.apply(Math,u.stacked?N:w);}w=(u.to)||w;var D=a/(q*(100+n)+n)*100,b=D*n/100,g=u.vgutter==null?20:u.vgutter,t=[],k=C+b,f=(d-2*g)/w;if(!u.stretch){b=Math.round(b);D=Math.floor(D);}!u.stacked&&(D/=B||1);for(var K=0;K<q;K++){t=[];for(var J=0;J<(B||1);J++){var L=Math.round((B?O[J][K]:O[K])*f),m=A+d-g-L,H=this.g.finger(Math.round(k+D/2),m+L,D,L,true,P).attr({stroke:"none",fill:F[B?J:K]});if(B){v[J].push(H);}else{v.push(H);}H.y=m;H.x=Math.round(k+D/2);H.w=D;H.h=L;H.value=B?O[J][K]:O[K];if(!u.stacked){k+=D;}else{t.push(H);}}if(u.stacked){var I;r.push(I=this.rect(t[0].x-t[0].w/2,A,D,d).attr(this.g.shim));I.bars=this.set();var o=0;for(var E=t.length;E--;){t[E].toFront();}for(var E=0,p=t.length;E<p;E++){var H=t[E],z,L=(o+H.value)*f,G=this.g.finger(H.x,A+d-g-!!o*0.5,D,L,true,P,1);I.bars.push(H);o&&H.attr({path:G});H.h=L;H.y=A+d-g-!!o*0.5-L;e.push(z=this.rect(H.x-H.w/2,H.y,D,H.value*f).attr(this.g.shim));z.bar=H;z.value=H.value;o+=H.value;}k+=D;}k+=b;}r.toFront();k=C+b;if(!u.stacked){for(var K=0;K<q;K++){for(var J=0;J<(B||1);J++){var z;e.push(z=this.rect(Math.round(k),A+g,D,d-g).attr(this.g.shim));z.bar=B?v[J][K]:v[K];z.value=z.bar.value;k+=D;}k+=b;}}M.label=function(y,S){y=y||[];this.labels=c.set();var T,h=-Infinity;if(u.stacked){for(var x=0;x<q;x++){var Q=0;for(var s=0;s<(B||1);s++){Q+=B?O[s][x]:O[x];if(s==B-1){var U=c.g.labelise(y[x],Q,w);T=c.g.text(v[x*(B||1)+s].x,A+d-g/2,U).insertBefore(e[x*(B||1)+s]);var R=T.getBBox();if(R.x-7<h){T.remove();}else{this.labels.push(T);h=R.x+R.width;}}}}}else{for(var x=0;x<q;x++){for(var s=0;s<(B||1);s++){var U=c.g.labelise(B?y[s]&&y[s][x]:y[x],B?O[s][x]:O[x],w);T=c.g.text(v[x*(B||1)+s].x,S?A+d-g/2:v[x*(B||1)+s].y-10,U).insertBefore(e[x*(B||1)+s]);var R=T.getBBox();if(R.x-7<h){T.remove();}else{this.labels.push(T);h=R.x+R.width;}}}}return this;};M.hover=function(i,h){r.hide();e.show();e.mouseover(i).mouseout(h);return this;};M.hoverColumn=function(i,h){e.hide();r.show();h=h||function(){};r.mouseover(i).mouseout(h);return this;};M.click=function(h){r.hide();e.show();e.click(h);return this;};M.dblclick=function(h){r.hide();e.show();e.dblclick(h);return this;};M.mousedown=function(h){r.hide();e.show();e.mousedown(h);return this;};M.mousemove=function(h){r.hide();e.show();e.mousemove(h);return this;};M.mouseout=function(h){r.hide();e.show();e.mouseout(h);return this;};M.mouseover=function(h){r.hide();e.show();e.mouseover(h);return this;};M.mouseup=function(h){r.hide();e.show();e.mouseup(h);return this;};M.each=function(j){if(!Raphael.is(j,"function")){return this;}for(var h=e.length;h--;){j.call(e[h]);}return this;};M.eachColumn=function(j){if(!Raphael.is(j,"function")){return this;}for(var h=r.length;h--;){j.call(r[h]);}return this;};M.clickColumn=function(h){e.hide();r.show();r.click(h);return this;};M.dblclickColumn=function(h){e.hide();r.show();r.dblclick(h);return this;};M.mousedownColumn=function(h){e.hide();r.show();r.mousedown(h);return this;};M.mousemoveColumn=function(h){e.hide();r.show();r.mousemove(h);return this;};M.mouseoutColumn=function(h){e.hide();r.show();r.mouseout(h);return this;};M.mouseoverColumn=function(h){e.hide();r.show();r.mouseover(h);return this;};M.mouseupColumn=function(h){e.hide();r.show();r.mouseup(h);return this;};M.push(v,e,r);M.bars=v;M.covers=e;return M;};Raphael.fn.g.hbarchart=function(n,l,B,w,c,r){r=r||{};var e={round:"round",sharp:"sharp",soft:"soft"}[r.type]||"square",f=parseFloat(r.gutter||"20%"),u=this.set(),A=this.set(),h=this.set(),E=this.set(),M=Math.max.apply(Math,c),a=[],o=this,C=0,m=r.colors||this.g.colors,H=c.length;if(this.raphael.is(c[0],"array")){M=[];C=H;H=0;for(var G=c.length;G--;){A.push(this.set());M.push(Math.max.apply(Math,c[G]));H=Math.max(H,c[G].length);}if(r.stacked){for(var G=H;G--;){var p=0;for(var F=c.length;F--;){p+=+c[F][G]||0;}a.push(p);}}for(var G=c.length;G--;){if(c[G].length<H){for(var F=H;F--;){c[G].push(0);}}}M=Math.max.apply(Math,r.stacked?a:M);}M=(r.to)||M;var J=Math.floor(w/(H*(100+f)+f)*100),k=Math.floor(J*f/100),g=[],b=l+k,d=(B-1)/M;!r.stacked&&(J/=C||1);for(var G=0;G<H;G++){g=[];for(var F=0;F<(C||1);F++){var L=C?c[F][G]:c[G],I=this.g.finger(n,b+J/2,Math.round(L*d),J-1,false,e).attr({stroke:"none",fill:m[C?F:G]});if(C){A[F].push(I);}else{A.push(I);}I.x=n+Math.round(L*d);I.y=b+J/2;I.w=Math.round(L*d);I.h=J;I.value=+L;if(!r.stacked){b+=J;}else{g.push(I);}}if(r.stacked){var q=this.rect(n,g[0].y-g[0].h/2,B,J).attr(this.g.shim);E.push(q);q.bars=this.set();var v=0;for(var t=g.length;t--;){g[t].toFront();}for(var t=0,D=g.length;t<D;t++){var I=g[t],K,L=Math.round((v+I.value)*d),z=this.g.finger(n,I.y,L,J-1,false,e,1);q.bars.push(I);v&&I.attr({path:z});I.w=L;I.x=n+L;h.push(K=this.rect(n+v*d,I.y-I.h/2,I.value*d,J).attr(this.g.shim));K.bar=I;v+=I.value;}b+=J;}b+=k;}E.toFront();b=l+k;if(!r.stacked){for(var G=0;G<H;G++){for(var F=0;F<(C||1);F++){var K=this.rect(n,b,B,J).attr(this.g.shim);h.push(K);K.bar=C?A[F][G]:A[G];K.value=K.bar.value;b+=J;}b+=k;}}u.label=function(R,P){R=R||[];this.labels=o.set();for(var O=0;O<H;O++){for(var N=0;N<C;N++){var y=o.g.labelise(C?R[N]&&R[N][O]:R[O],C?c[N][O]:c[O],M);var Q=P?A[O*(C||1)+N].x-J/2+3:n+5,x=P?"end":"start",s;this.labels.push(s=o.g.text(Q,A[O*(C||1)+N].y,y).attr({"text-anchor":x}).insertBefore(h[0]));if(s.getBBox().x<n+5){s.attr({x:n+5,"text-anchor":"start"});}else{A[O*(C||1)+N].label=s;}}}return this;};u.hover=function(j,i){E.hide();h.show();i=i||function(){};h.mouseover(j).mouseout(i);return this;};u.hoverColumn=function(j,i){h.hide();E.show();i=i||function(){};E.mouseover(j).mouseout(i);return this;};u.each=function(s){if(!Raphael.is(s,"function")){return this;}for(var j=h.length;j--;){s.call(h[j]);}return this;};u.eachColumn=function(s){if(!Raphael.is(s,"function")){return this;}for(var j=E.length;j--;){s.call(E[j]);}return this;};u.click=function(i){E.hide();h.show();h.click(i);return this;};u.dblclick=function(i){E.hide();h.show();h.dblclick(i);return this;};u.mousedown=function(i){E.hide();h.show();h.mousedown(i);return this;};u.mousemove=function(i){E.hide();h.show();h.mousemove(i);return this;};u.mouseout=function(i){E.hide();h.show();h.mouseout(i);return this;};u.mouseover=function(i){E.hide();h.show();h.mouseover(i);return this;};u.mouseup=function(i){E.hide();h.show();h.mouseup(i);return this;};u.clickColumn=function(i){h.hide();E.show();E.click(i);return this;};u.dblclickColumn=function(i){h.hide();E.show();E.dblclick(i);return this;};u.mousedownColumn=function(i){h.hide();E.show();E.mousedown(i);return this;};u.mousemoveColumn=function(i){h.hide();E.show();E.mousemove(i);return this;};u.mouseoutColumn=function(i){h.hide();E.show();E.mouseout(i);return this;};u.mouseoverColumn=function(i){h.hide();E.show();E.mouseover(i);return this;};u.mouseupColumn=function(i){h.hide();E.show();E.click(i);return this;};u.push(A,h,E);u.bars=A;u.covers=h;return u;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/graphael/g.pie-min.js*/Raphael.fn.g.piechart=function(e,d,o,b,l){    l=l||{};    var k=this,m=[],g=this.set(),n=this.set(),j=this.set(),u=[],w=b.length,x=0,A=0,z=0,c=100,y=true;    n.covers=g;    if(w==1){        j.push(this.circle(e,d,o).attr({            fill:this.g.colors[0],            stroke:l.stroke||"#fff",            "stroke-width":l.strokewidth==null?1:l.strokewidth            }));        g.push(this.circle(e,d,o).attr(this.g.shim));        A=b[0];        b[0]={            value:b[0],            order:0,            valueOf:function(){                return this.value;            }        };    j[0].middle={        x:e,        y:d    };    j[0].mangle=180;}else{    function t(F,E,i,H,D,M){        H -= 0.05;        var J=Math.PI/180,B=F+i*Math.cos(-H*J),p=F+i*Math.cos(-D*J),G=F+i/2*Math.cos(-(H+(D-H)/2)*J),L=E+i*Math.sin(-H*J),K=E+i*Math.sin(-D*J),C=E+i/2*Math.sin(-(H+(D-H)/2)*J),I=["M",F,E,"L",B,L,"A",i,i,0,+(Math.abs(D-H)>180),1,p,K,"z"];        I.middle={            x:G,            y:C        };        return I;    }    for(var v=0;v<w;v++){        A+=b[v];        b[v]={            value:b[v],            order:v,            valueOf:function(){                return this.value;            }        };}b.sort(function(p,i){    return i.value-p.value;});for(v=0;v<w;v++){    c=v;    y=false;//    if(y&&b[v]*360/A<=1.5){//        c=v;//        y=false;//    }//    if(v>c){//        y=false;//        b[c].value+=b[v];//        b[c].others=true;//        z=b[c].value;//    }}w=Math.min(c+1,b.length);z&&b.splice(w)&&(b[c].others=true);for(v=0;v<w;v++){    var f=x-360*b[v]/A/2;    if(!v){        x=90-f;        f=x-360*b[v]/A/2;    }    if(l.init){        var h=t(e,d,1,x,x-360*b[v]/A).join(",");    }    var s=t(e,d,o,x,x-=360*b[v]/A);    var q=this.path(l.init?h:s).attr({        fill:l.colors&&l.colors[v%l.colors.length]||this.g.colors[v%l.colors.length]||"#666",        stroke:l.stroke||"#fff",        "stroke-width":(l.strokewidth==null?1:l.strokewidth),        "stroke-linejoin":"round"    });    q.value=b[v];    q.middle=s.middle;    q.mangle=f;    m.push(q);    j.push(q);    l.init&&q.animate({        path:s.join(",")        },(+l.init-1)||1000,">");}for(v=0;v<w;v++){    q=k.path(m[v].attr("path")).attr(this.g.shim);    l.href&&l.href[v]&&q.attr({        href:l.href[v]        });    q.attr=function(){};    g.push(q);    j.push(q);}}n.hover=function(C,r){    r=r||function(){};    var B=this;    for(var p=0;p<w;p++){        (function(D,E,i){            var F={                sector:D,                cover:E,                cx:e,                cy:d,                mx:D.middle.x,                my:D.middle.y,                mangle:D.mangle,                r:o,                value:b[i],                total:A,                label:B.labels&&B.labels[i]                };            E.mouseover(function(){                C.call(F);            }).mouseout(function(){                r.call(F);            });        })(j[p],g[p],p);    }    return this;};n.each=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                x:C.middle.x,                y:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            B.call(E);        })(j[p],g[p],p);    }    return this;};n.click=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.click(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.dblclick=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.dblclick(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.mousedown=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.mousedown(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.mousemove=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.mousemove(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.mouseout=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.mouseout(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.mouseover=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.mouseover(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.mouseup=function(B){    var r=this;    for(var p=0;p<w;p++){        (function(C,D,i){            var E={                sector:C,                cover:D,                cx:e,                cy:d,                mx:C.middle.x,                my:C.middle.y,                mangle:C.mangle,                r:o,                value:b[i],                total:A,                label:r.labels&&r.labels[i]                };            D.mouseup(function(){                B.call(E);            });        })(j[p],g[p],p);    }    return this;};n.inject=function(i){    i.insertBefore(g[0]);};var a=function(G,B,r,p){    var K=e+o+o/5,J=d,F=J+10;    G=G||[];    p=(p&&p.toLowerCase&&p.toLowerCase())||"east";    r=k.g.markers[r&&r.toLowerCase()]||"disc";    n.labels=k.set();    for(var E=0;E<w;E++){        var L=j[E].attr("fill"),C=b[E].order,D;        b[E].others&&(G[C]=B||"Others");        G[C]=k.g.labelise(G[C],b[E],A);        n.labels.push(k.set());        n.labels[E].push(k.g[r](K+5,F,5).attr({            fill:L,            stroke:"none"        }));        n.labels[E].push(D=k.text(K+20,F,G[C]||b[C]).attr(k.g.txtattr).attr({            fill:l.legendcolor||"#000",            "text-anchor":"start"        }));        g[E].label=n.labels[E];        F+=D.getBBox().height*1.2;    }    var H=n.labels.getBBox(),I={        east:[0,-H.height/2],        west:[-H.width-2*o-20,-H.height/2],        north:[-o-H.width/2,-o-H.height-10],        south:[-o-H.width/2,o+10]        }        [p];    n.labels.translate.apply(n.labels,I);    n.push(n.labels);};if(l.legend){    a(l.legend,l.legendothers,l.legendmark,l.legendpos);}n.push(j,g);n.series=j;n.covers=g;return n;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/jquery.svg/jquery.svg.min.js*//* http://keith-wood.name/svg.html   SVG for jQuery v1.4.3.   Written by Keith Wood (kbwood{at}iinet.com.au) August 2007.   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.   Please attribute the author if you use it. */(function($){function SVGManager(){this._settings=[];this._extensions=[];this.regional=[];this.regional['']={errorLoadingText:'Error loading',notSupportedText:'This browser does not support SVG'};this.local=this.regional[''];this._uuid=new Date().getTime();this._renesis=detectActiveX('RenesisX.RenesisCtrl')}function detectActiveX(a){try{return!!(window.ActiveXObject&&new ActiveXObject(a))}catch(e){return false}}var p='svgwrapper';$.extend(SVGManager.prototype,{markerClassName:'hasSVG',svgNS:'http://www.w3.org/2000/svg',xlinkNS:'http://www.w3.org/1999/xlink',_wrapperClass:SVGWrapper,_attrNames:{class_:'class',in_:'in',alignmentBaseline:'alignment-baseline',baselineShift:'baseline-shift',clipPath:'clip-path',clipRule:'clip-rule',colorInterpolation:'color-interpolation',colorInterpolationFilters:'color-interpolation-filters',colorRendering:'color-rendering',dominantBaseline:'dominant-baseline',enableBackground:'enable-background',fillOpacity:'fill-opacity',fillRule:'fill-rule',floodColor:'flood-color',floodOpacity:'flood-opacity',fontFamily:'font-family',fontSize:'font-size',fontSizeAdjust:'font-size-adjust',fontStretch:'font-stretch',fontStyle:'font-style',fontVariant:'font-variant',fontWeight:'font-weight',glyphOrientationHorizontal:'glyph-orientation-horizontal',glyphOrientationVertical:'glyph-orientation-vertical',horizAdvX:'horiz-adv-x',horizOriginX:'horiz-origin-x',imageRendering:'image-rendering',letterSpacing:'letter-spacing',lightingColor:'lighting-color',markerEnd:'marker-end',markerMid:'marker-mid',markerStart:'marker-start',stopColor:'stop-color',stopOpacity:'stop-opacity',strikethroughPosition:'strikethrough-position',strikethroughThickness:'strikethrough-thickness',strokeDashArray:'stroke-dasharray',strokeDashOffset:'stroke-dashoffset',strokeLineCap:'stroke-linecap',strokeLineJoin:'stroke-linejoin',strokeMiterLimit:'stroke-miterlimit',strokeOpacity:'stroke-opacity',strokeWidth:'stroke-width',textAnchor:'text-anchor',textDecoration:'text-decoration',textRendering:'text-rendering',underlinePosition:'underline-position',underlineThickness:'underline-thickness',vertAdvY:'vert-adv-y',vertOriginY:'vert-origin-y',wordSpacing:'word-spacing',writingMode:'writing-mode'},_attachSVG:function(a,b){var c=(a.namespaceURI==this.svgNS?a:null);var a=(c?null:a);if($(a||c).hasClass(this.markerClassName)){return}if(typeof b=='string'){b={loadURL:b}}else if(typeof b=='function'){b={onLoad:b}}$(a||c).addClass(this.markerClassName);try{if(!c){c=document.createElementNS(this.svgNS,'svg');c.setAttribute('version','1.1');c.setAttribute('width',a.clientWidth);c.setAttribute('height',a.clientHeight);a.appendChild(c)}this._afterLoad(a,c,b||{})}catch(e){if($.browser.msie){if(!a.id){a.id='svg'+(this._uuid++)}this._settings[a.id]=b;a.innerHTML='<embed type="image/svg+xml" width="100%" '+'height="100%" src="'+(b.initPath||'')+'blank.svg"/>'}else{a.innerHTML='<p class="svg_error">'+this.local.notSupportedText+'</p>'}}},_registerSVG:function(){for(var i=0;i<document.embeds.length;i++){var a=document.embeds[i].parentNode;if(!$(a).hasClass($.svg.markerClassName)||$.data(a,p)){continue}var b=null;try{b=document.embeds[i].getSVGDocument()}catch(e){setTimeout($.svg._registerSVG,250);return}b=(b?b.documentElement:null);if(b){$.svg._afterLoad(a,b)}}},_afterLoad:function(a,b,c){var c=c||this._settings[a.id];this._settings[a?a.id:'']=null;var d=new this._wrapperClass(b,a);$.data(a||b,p,d);try{if(c.loadURL){d.load(c.loadURL,c)}if(c.settings){d.configure(c.settings)}if(c.onLoad&&!c.loadURL){c.onLoad.apply(a||b,[d])}}catch(e){alert(e)}},_getSVG:function(a){a=(typeof a=='string'?$(a)[0]:(a.jquery?a[0]:a));return $.data(a,p)},_destroySVG:function(a){var b=$(a);if(!b.hasClass(this.markerClassName)){return}b.removeClass(this.markerClassName);if(a.namespaceURI!=this.svgNS){b.empty()}$.removeData(a,p)},addExtension:function(a,b){this._extensions.push([a,b])}});function SVGWrapper(a,b){this._svg=a;this._container=b;for(var i=0;i<$.svg._extensions.length;i++){var c=$.svg._extensions[i];this[c[0]]=new c[1](this)}}$.extend(SVGWrapper.prototype,{_width:function(){return(this._container?this._container.clientWidth:this._svg.width)},_height:function(){return(this._container?this._container.clientHeight:this._svg.height)},root:function(){return this._svg},configure:function(a,b){if(b){for(var i=this._svg.attributes.length-1;i>=0;i--){var c=this._svg.attributes.item(i);if(!(c.nodeName=='onload'||c.nodeName=='version'||c.nodeName.substring(0,5)=='xmlns')){this._svg.attributes.removeNamedItem(c.nodeName)}}}for(var d in a){this._svg.setAttribute(d,a[d])}return this},getElementById:function(a){return this._svg.ownerDocument.getElementById(a)},change:function(a,b){if(a){for(var c in b){if(b[c]==null){a.removeAttribute(c)}else{a.setAttribute(c,b[c])}}}return this},_args:function(b,c,d){c.splice(0,0,'parent');c.splice(c.length,0,'settings');var e={};var f=0;if(b[0]!=null&&b[0].jquery){b[0]=b[0][0]}if(b[0]!=null&&!(typeof b[0]=='object'&&b[0].nodeName)){e['parent']=null;f=1}for(var i=0;i<b.length;i++){e[c[i+f]]=b[i]}if(d){$.each(d,function(i,a){if(typeof e[a]=='object'){e.settings=e[a];e[a]=null}})}return e},title:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'title',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},describe:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'desc',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},defs:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'defs',$.extend((d.id?{id:d.id}:{}),d.settings||{}))},symbol:function(a,b,c,d,e,f,g){var h=this._args(arguments,['id','x1','y1','width','height']);return this._makeNode(h.parent,'symbol',$.extend({id:h.id,viewBox:h.x1+' '+h.y1+' '+h.width+' '+h.height},h.settings||{}))},marker:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','refX','refY','mWidth','mHeight','orient'],['orient']);return this._makeNode(i.parent,'marker',$.extend({id:i.id,refX:i.refX,refY:i.refY,markerWidth:i.mWidth,markerHeight:i.mHeight,orient:i.orient||'auto'},i.settings||{}))},style:function(a,b,c){var d=this._args(arguments,['styles']);var e=this._makeNode(d.parent,'style',$.extend({type:'text/css'},d.settings||{}));e.appendChild(this._svg.ownerDocument.createTextNode(d.styles));if($.browser.opera){$('head').append('<style type="text/css">'+d.styles+'</style>')}return e},script:function(a,b,c,d){var e=this._args(arguments,['script','type'],['type']);var f=this._makeNode(e.parent,'script',$.extend({type:e.type||'text/javascript'},e.settings||{}));f.appendChild(this._svg.ownerDocument.createTextNode(this._escapeXML(e.script)));if(!$.browser.mozilla){$.globalEval(e.script)}return f},linearGradient:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','stops','x1','y1','x2','y2'],['x1']);var j=$.extend({id:i.id},(i.x1!=null?{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}:{}));return this._gradient(i.parent,'linearGradient',$.extend(j,i.settings||{}),i.stops)},radialGradient:function(a,b,c,d,e,r,f,g,h){var i=this._args(arguments,['id','stops','cx','cy','r','fx','fy'],['cx']);var j=$.extend({id:i.id},(i.cx!=null?{cx:i.cx,cy:i.cy,r:i.r,fx:i.fx,fy:i.fy}:{}));return this._gradient(i.parent,'radialGradient',$.extend(j,i.settings||{}),i.stops)},_gradient:function(a,b,c,d){var e=this._makeNode(a,b,c);for(var i=0;i<d.length;i++){var f=d[i];this._makeNode(e,'stop',$.extend({offset:f[0],stopColor:f[1]},(f[2]!=null?{stopOpacity:f[2]}:{})))}return e},pattern:function(a,b,x,y,c,d,e,f,g,h,i){var j=this._args(arguments,['id','x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var k=$.extend({id:j.id,x:j.x,y:j.y,width:j.width,height:j.height},(j.vx!=null?{viewBox:j.vx+' '+j.vy+' '+j.vwidth+' '+j.vheight}:{}));return this._makeNode(j.parent,'pattern',$.extend(k,j.settings||{}))},mask:function(a,b,x,y,c,d,e){var f=this._args(arguments,['id','x','y','width','height']);return this._makeNode(f.parent,'mask',$.extend({id:f.id,x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}))},createPath:function(){return new SVGPath()},createText:function(){return new SVGText()},svg:function(a,x,y,b,c,d,e,f,g,h){var i=this._args(arguments,['x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var j=$.extend({x:i.x,y:i.y,width:i.width,height:i.height},(i.vx!=null?{viewBox:i.vx+' '+i.vy+' '+i.vwidth+' '+i.vheight}:{}));return this._makeNode(i.parent,'svg',$.extend(j,i.settings||{}))},group:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'g',$.extend({id:d.id},d.settings||{}))},use:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);if(typeof f.x=='string'){f.ref=f.x;f.settings=f.y;f.x=f.y=f.width=f.height=null}var g=this._makeNode(f.parent,'use',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},link:function(a,b,c){var d=this._args(arguments,['ref']);var e=this._makeNode(d.parent,'a',d.settings);e.setAttributeNS($.svg.xlinkNS,'href',d.ref);return e},image:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);var g=this._makeNode(f.parent,'image',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},path:function(a,b,c){var d=this._args(arguments,['path']);return this._makeNode(d.parent,'path',$.extend({d:(d.path.path?d.path.path():d.path)},d.settings||{}))},rect:function(a,x,y,b,c,d,e,f){var g=this._args(arguments,['x','y','width','height','rx','ry'],['rx']);return this._makeNode(g.parent,'rect',$.extend({x:g.x,y:g.y,width:g.width,height:g.height},(g.rx?{rx:g.rx,ry:g.ry}:{}),g.settings||{}))},circle:function(a,b,c,r,d){var e=this._args(arguments,['cx','cy','r']);return this._makeNode(e.parent,'circle',$.extend({cx:e.cx,cy:e.cy,r:e.r},e.settings||{}))},ellipse:function(a,b,c,d,e,f){var g=this._args(arguments,['cx','cy','rx','ry']);return this._makeNode(g.parent,'ellipse',$.extend({cx:g.cx,cy:g.cy,rx:g.rx,ry:g.ry},g.settings||{}))},line:function(a,b,c,d,e,f){var g=this._args(arguments,['x1','y1','x2','y2']);return this._makeNode(g.parent,'line',$.extend({x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2},g.settings||{}))},polyline:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polyline',d.points,d.settings)},polygon:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polygon',d.points,d.settings)},_poly:function(a,b,c,d){var e='';for(var i=0;i<c.length;i++){e+=c[i].join()+' '}return this._makeNode(a,b,$.extend({points:$.trim(e)},d||{}))},text:function(a,x,y,b,c){var d=this._args(arguments,['x','y','value']);if(typeof d.x=='string'&&arguments.length<4){d.value=d.x;d.settings=d.y;d.x=d.y=null}return this._text(d.parent,'text',d.value,$.extend({x:(d.x&&isArray(d.x)?d.x.join(' '):d.x),y:(d.y&&isArray(d.y)?d.y.join(' '):d.y)},d.settings||{}))},textpath:function(a,b,c,d){var e=this._args(arguments,['path','value']);var f=this._text(e.parent,'textPath',e.value,e.settings||{});f.setAttributeNS($.svg.xlinkNS,'href',e.path);return f},_text:function(a,b,c,d){var e=this._makeNode(a,b,d);if(typeof c=='string'){e.appendChild(e.ownerDocument.createTextNode(c))}else{for(var i=0;i<c._parts.length;i++){var f=c._parts[i];if(f[0]=='tspan'){var g=this._makeNode(e,f[0],f[2]);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else if(f[0]=='tref'){var g=this._makeNode(e,f[0],f[2]);g.setAttributeNS($.svg.xlinkNS,'href',f[1]);e.appendChild(g)}else if(f[0]=='textpath'){var h=$.extend({},f[2]);h.href=null;var g=this._makeNode(e,f[0],h);g.setAttributeNS($.svg.xlinkNS,'href',f[2].href);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else{e.appendChild(e.ownerDocument.createTextNode(f[1]))}}}return e},other:function(a,b,c){var d=this._args(arguments,['name']);return this._makeNode(d.parent,d.name,d.settings||{})},_makeNode:function(a,b,c){a=a||this._svg;var d=this._svg.ownerDocument.createElementNS($.svg.svgNS,b);for(var b in c){var e=c[b];if(e!=null&&e!=null&&(typeof e!='string'||e!='')){d.setAttribute($.svg._attrNames[b]||b,e)}}a.appendChild(d);return d},add:function(b,c){var d=this._args((arguments.length==1?[null,b]:arguments),['node']);var f=this;d.parent=d.parent||this._svg;try{if($.svg._renesis){throw'Force traversal';}d.parent.appendChild(d.node.cloneNode(true))}catch(e){d.node=(d.node.jquery?d.node:$(d.node));d.node.each(function(){var a=f._cloneAsSVG(this);if(a){d.parent.appendChild(a)}})}return this},_cloneAsSVG:function(a){var b=null;if(a.nodeType==1){b=this._svg.ownerDocument.createElementNS($.svg.svgNS,this._checkName(a.nodeName));for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(c.nodeName!='xmlns'&&c.nodeValue){if(c.prefix=='xlink'){b.setAttributeNS($.svg.xlinkNS,c.localName,c.nodeValue)}else{b.setAttribute(this._checkName(c.nodeName),c.nodeValue)}}}for(var i=0;i<a.childNodes.length;i++){var d=this._cloneAsSVG(a.childNodes[i]);if(d){b.appendChild(d)}}}else if(a.nodeType==3){if($.trim(a.nodeValue)){b=this._svg.ownerDocument.createTextNode(a.nodeValue)}}else if(a.nodeType==4){if($.trim(a.nodeValue)){try{b=this._svg.ownerDocument.createCDATASection(a.nodeValue)}catch(e){b=this._svg.ownerDocument.createTextNode(a.nodeValue.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'))}}}return b},_checkName:function(a){a=(a.substring(0,1)>='A'&&a.substring(0,1)<='Z'?a.toLowerCase():a);return(a.substring(0,4)=='svg:'?a.substring(4):a)},load:function(h,j){j=(typeof j=='boolean'?{addTo:j}:(typeof j=='function'?{onLoad:j}:j||{}));if(!j.addTo){this.clear(false)}var k=[this._svg.getAttribute('width'),this._svg.getAttribute('height')];var l=this;var m=function(a){a=$.svg.local.errorLoadingText+': '+a;if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l,a])}else{l.text(null,10,20,a)}};var n=function(a){var b=new ActiveXObject('Microsoft.XMLDOM');b.validateOnParse=false;b.resolveExternals=false;b.async=false;b.loadXML(a);if(b.parseError.errorCode!=0){m(b.parseError.reason);return null}return b};var o=function(a){if(!a){return}if(a.documentElement.nodeName!='svg'){var b=a.getElementsByTagName('parsererror');var c=(b.length?b[0].getElementsByTagName('div'):[]);m(!b.length?'???':(c.length?c[0]:b[0]).firstChild.nodeValue);return}var d={};for(var i=0;i<a.documentElement.attributes.length;i++){var f=a.documentElement.attributes.item(i);if(!(f.nodeName=='version'||f.nodeName.substring(0,5)=='xmlns')){d[f.nodeName]=f.nodeValue}}l.configure(d,true);var g=a.documentElement.childNodes;for(var i=0;i<g.length;i++){try{if($.svg._renesis){throw'Force traversal';}l._svg.appendChild(g[i].cloneNode(true));if(g[i].nodeName=='script'){$.globalEval(g[i].textContent)}}catch(e){l.add(null,g[i])}}if(!j.changeSize){l.configure({width:k[0],height:k[1]})}if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l])}};if(h.match('<svg')){o($.browser.msie?n(h):new DOMParser().parseFromString(h,'text/xml'))}else{$.ajax({url:h,dataType:($.browser.msie?'text':'xml'),success:function(a){o($.browser.msie?n(a):a)},error:function(a,b,c){m(b+(c?' '+c.message:''))}})}return this},remove:function(a){a=(a.jquery?a[0]:a);a.parentNode.removeChild(a);return this},clear:function(a){if(a){this.configure({},true)}while(this._svg.firstChild){this._svg.removeChild(this._svg.firstChild)}return this},toSVG:function(a){a=a||this._svg;return(typeof XMLSerializer=='undefined'?this._toSVG(a):new XMLSerializer().serializeToString(a))},_toSVG:function(a){var b='';if(!a){return b}if(a.nodeType==3){b=a.nodeValue}else if(a.nodeType==4){b='<![CDATA['+a.nodeValue+']]>'}else{b='<'+a.nodeName;if(a.attributes){for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(!($.trim(c.nodeValue)==''||c.nodeValue.match(/^\[object/)||c.nodeValue.match(/^function/))){b+=' '+(c.namespaceURI==$.svg.xlinkNS?'xlink:':'')+c.nodeName+'="'+c.nodeValue+'"'}}}if(a.firstChild){b+='>';var d=a.firstChild;while(d){b+=this._toSVG(d);d=d.nextSibling}b+='</'+a.nodeName+'>'}else{b+='/>'}}return b},_escapeXML:function(a){a=a.replace(/&/g,'&amp;');a=a.replace(/</g,'&lt;');a=a.replace(/>/g,'&gt;');return a}});function SVGPath(){this._path=''}$.extend(SVGPath.prototype,{reset:function(){this._path='';return this},move:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'m':'M'),x,y)},line:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'l':'L'),x,y)},horiz:function(x,a){this._path+=(a?'h':'H')+(isArray(x)?x.join(' '):x);return this},vert:function(y,a){this._path+=(a?'v':'V')+(isArray(y)?y.join(' '):y);return this},curveC:function(a,b,c,d,x,y,e){e=(isArray(a)?b:e);return this._coords((e?'c':'C'),a,b,c,d,x,y)},smoothC:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'s':'S'),a,b,x,y)},curveQ:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'q':'Q'),a,b,x,y)},smoothQ:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'t':'T'),x,y)},_coords:function(a,b,c,d,e,f,g){if(isArray(b)){for(var i=0;i<b.length;i++){var h=b[i];this._path+=(i==0?a:' ')+h[0]+','+h[1]+(h.length<4?'':' '+h[2]+','+h[3]+(h.length<6?'':' '+h[4]+','+h[5]))}}else{this._path+=a+b+','+c+(d==null?'':' '+d+','+e+(f==null?'':' '+f+','+g))}return this},arc:function(a,b,c,d,e,x,y,f){f=(isArray(a)?b:f);this._path+=(f?'a':'A');if(isArray(a)){for(var i=0;i<a.length;i++){var g=a[i];this._path+=(i==0?'':' ')+g[0]+','+g[1]+' '+g[2]+' '+(g[3]?'1':'0')+','+(g[4]?'1':'0')+' '+g[5]+','+g[6]}}else{this._path+=a+','+b+' '+c+' '+(d?'1':'0')+','+(e?'1':'0')+' '+x+','+y}return this},close:function(){this._path+='z';return this},path:function(){return this._path}});SVGPath.prototype.moveTo=SVGPath.prototype.move;SVGPath.prototype.lineTo=SVGPath.prototype.line;SVGPath.prototype.horizTo=SVGPath.prototype.horiz;SVGPath.prototype.vertTo=SVGPath.prototype.vert;SVGPath.prototype.curveCTo=SVGPath.prototype.curveC;SVGPath.prototype.smoothCTo=SVGPath.prototype.smoothC;SVGPath.prototype.curveQTo=SVGPath.prototype.curveQ;SVGPath.prototype.smoothQTo=SVGPath.prototype.smoothQ;SVGPath.prototype.arcTo=SVGPath.prototype.arc;function SVGText(){this._parts=[]}$.extend(SVGText.prototype,{reset:function(){this._parts=[];return this},string:function(a){this._parts[this._parts.length]=['text',a];return this},span:function(a,b){this._parts[this._parts.length]=['tspan',a,b];return this},ref:function(a,b){this._parts[this._parts.length]=['tref',a,b];return this},path:function(a,b,c){this._parts[this._parts.length]=['textpath',b,$.extend({href:a},c||{})];return this}});$.fn.svg=function(a){var b=Array.prototype.slice.call(arguments,1);if(typeof a=='string'&&a=='get'){return $.svg['_'+a+'SVG'].apply($.svg,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){$.svg['_'+a+'SVG'].apply($.svg,[this].concat(b))}else{$.svg._attachSVG(this,a||{})}})};function isArray(a){return(a&&a.constructor==Array)}$.svg=new SVGManager()})(jQuery);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/selectbox/jquery-selectbox.js*/jQuery.fn.extend({	selectbox: function(options) {		return this.each(function() {			new jQuery.SelectBox(this, options);		});	}});if (!window.console) {	var console = {		log: function(msg) {	 }	}}jQuery.SelectBox = function(selectobj, options) {	var opt = options || {};	opt.inputClass = opt.inputClass || "selectbox";	opt.containerClass = opt.containerClass || "selectbox-wrapper";	opt.hoverClass = opt.hoverClass || "selected";	opt.debug = opt.debug || false;	var elm_id = selectobj.id;	var active = -1;	var inFocus = false;	var hasfocus = 0;	//jquery object for select element	var $select = $(selectobj);	// jquery container object	var $container = setupContainer(opt);	//jquery input object	var $input = setupInput(opt);	// hide select and append newly created elements	$select.hide().before($input).before($container);	init();	$input	.click(function(){        if (!inFocus) {		  $container.toggle();		}	})	.focus(function(){	   if ($container.not(':visible')) {	       inFocus = true;	       $container.show();	   }	})	.keydown(function(event) {		switch(event.keyCode) {			case 38: // up				event.preventDefault();				moveSelect(-1);				break;			case 40: // down				event.preventDefault();				moveSelect(1);				break;			//case 9:  // tab			case 13: // return				event.preventDefault(); // seems not working in mac !				setCurrent();				hideMe();				break;		}	})	.blur(function() {		if ($container.is(':visible') && hasfocus > 0 ) {			if(opt.debug) console.log('container visible and has focus')		} else {			hideMe();		}	});	function hideMe() {		hasfocus = 0;		$container.hide();	}	function init() {		$container.append(getSelectOptions($input.prop('id'))).hide();		var width = $input.css('width');		$container.width(width);    }	function setupContainer(options) {		var container = document.createElement("div");		$container = $(container);		$container.prop('id', elm_id+'_container');		$container.addClass(options.containerClass);		return $container;	}	function setupInput(options) {		var input = document.createElement("input");		var $input = $(input);		$input.prop("id", elm_id+"_input");		$input.prop("type", "text");		$input.addClass(options.inputClass);		$input.prop("autocomplete", "off");		$input.prop("readonly", "readonly");		$input.prop("tabIndex", $select.prop("tabindex")); // "I" capital is important for ie		return $input;	}	function moveSelect(step) {		var lis = $("li", $container);		if (!lis) return;		active += step;		if (active < 0) {			active = 0;		} else if (active >= lis.size()) {			active = lis.size() - 1;		}		lis.removeClass(opt.hoverClass);		$(lis[active]).addClass(opt.hoverClass);	}	function setCurrent() {		var li = $("li."+opt.hoverClass, $container).get(0);		var ar = (''+li.id).split('_');		var el = ar[ar.length-1];		$select.val(el);		$input.val($(li).html());		return true;	}	// select value	function getCurrentSelected() {		return $select.val();	}	// input value	function getCurrentValue() {		return $input.val();	}	function getSelectOptions(parentid) {		var select_options = new Array();		var ul = document.createElement('ul');		$select.children('option').each(function() {			var li = document.createElement('li');			li.setAttribute('id', parentid + '_' + $(this).val());			li.innerHTML = $(this).html();			if ($(this).is(':selected')) {				$input.val($(this).html());				$(li).addClass(opt.hoverClass);			}			ul.appendChild(li);			$(li)			.mouseover(function(event) {				hasfocus = 1;				if (opt.debug) console.log('out on : '+this.id);				jQuery(event.target, $container).addClass(opt.hoverClass);			})			.mouseout(function(event) {				hasfocus = -1;				if (opt.debug) console.log('out on : '+this.id);				jQuery(event.target, $container).removeClass(opt.hoverClass);			})			.click(function(event) {				if (opt.debug) console.log('click on :'+this.id);				$(this).addClass(opt.hoverClass);				setCurrent();				hideMe();			});		});		return ul;	}};(function($){	$.fn.csb = function(options) {		$(this).hide();		var style = options.style;		var mode = options.mode;		var thisid = $(this).prop('id');		var selected = this.find("option[selected]");		if (mode == 'link') var selects = this.find("option:not([selected])");		else var selects = this.find("option");		$(this).parent().append('<dl id="'+thisid+'" class="csb '+style+'"></dl>');		$('dl#'+thisid).append('<dt><a name="' + selected.val() + '">' + selected.text() + '</a></dt>');		$('dl#'+thisid).append('<dd><ul></ul></dd>');		selects.each(function(){			$('dl#'+ thisid + " dd ul").append('<li><a name="' + $(this).val() + '">' + $(this).text() + '</a></li>');		});		$('.'+style+' dt a').click(function() {			$('.'+style+' dd ul').toggle();			return false;		});		$(document).bind('click', function(e) {			var $clicked = $(e.target);			if (! $clicked.parents().hasClass(style)) $('.'+style+' dd ul').hide();		});		if (mode == 'link') {			$('.'+style+' dd ul li a').live('click',function() {				$('.'+style+' dd ul').hide();				var functvar = $(this).prop('name');				// now call a callback function				if(typeof options.callback == 'function'){					options.callback(functvar);				}				return false;			});		}		else {			$('.'+style+' dd ul li a').live('click',function() {				var text = $(this).html();				$('.'+style+' dt a').html(text);				$('.'+style+' dd ul').hide();				var source = $('select#'+thisid);				var functvar = $(this).prop('name');				source.val(functvar);				// now call a callback function				if(typeof options.callback == 'function'){					options.callback(functvar, options.data);				}				return false;			});		}	}})(jQuery);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/combobox/jquery-combobox.js*/$.widget( "ui.combobox", {    _create: function() {        var self = this,        select = this.element.hide(),        selected = select.children( ":selected" ),        value = selected.val() ? selected.text() : "";        var input = this.input = $( "<input>" )        .insertAfter( select )        .val( value )        .autocomplete({            delay: 0,            minLength: 0,            source: function( request, response ) {                var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );                response( select.children( "option" ).map(function() {                    var text = $( this ).text();                    if ( this.value && ( !request.term || matcher.test(text) ) )                        return {                            label: text.replace(                                new RegExp(                                    "(?![^&;]+;)(?!<[^<>]*)(" +                                    $.ui.autocomplete.escapeRegex(request.term) +                                    ")(?![^<>]*>)(?![^&;]+;)", "gi"                                    ), "<strong>$1</strong>" ),                            value: text,                            option: this                        };                }) );            },            select: function( event, ui ) {                ui.item.option.selected = true;                self._trigger( "selected", event, {                    item: ui.item.option                });            },            change: function( event, ui ) {                if ( !ui.item ) {                    var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( $(this).val() ) + "$", "i" ),                    valid = false;                    select.children( "option" ).each(function() {                        if ( $( this ).text().match( matcher ) ) {                            this.selected = valid = true;                            return false;                        }                    });                    if ( !valid ) {                        // remove invalid value, as it didn't match anything                        $( this ).val( "" );                        select.val( "" );                        input.data( "autocomplete" ).term = "";                        return false;                    }                }            }        })        .addClass( "ui-widget ui-widget-content ui-corner-left" );        input.data( "autocomplete" )._renderItem = function( ul, item ) {            return $( "<li></li>" )            .data( "item.autocomplete", item )            .append( "<a>" + item.label + "</a>" )            .appendTo( ul );        };        this.button = $( "<button type='button'>&nbsp;</button>" )        .prop( "tabIndex", -1 )        .prop( "title", "Show All Items" )        .insertAfter( input )        .button({            icons: {                primary: "ui-icon-triangle-1-s"            },            text: false        })        .removeClass( "ui-corner-all" )        .addClass( "ui-corner-right ui-button-icon" )        .click(function() {            // close if already visible            if ( input.autocomplete( "widget" ).is( ":visible" ) ) {                input.autocomplete( "close" );                return;            }            // work around a bug (likely same cause as #5265)            $( this ).blur();            // pass empty string as value to search for, displaying all results            input.autocomplete( "search", "" );            //input.focus();        });    },    destroy: function() {        this.input.remove();        this.button.remove();        this.element.show();        $.Widget.prototype.destroy.call( this );    },    //allows programmatic selection of combo using the option value    setValue: function (value) {        var $input = this.input;        $("option", this.element).each(function () {            if ($(this).val() == value) {                this.selected = true;                $input.val(this.text);                return false;            }        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/beautytips/beautytips.js*//* * @name BeautyTips * @desc a tooltips/baloon-help plugin for jQuery * * @author Jeff Robbins - Lullabot - http://www.lullabot.com * @version 0.9.5-rc1  (5/20/2009) */jQuery.bt={version:"0.9.5-rc1"};(function($){jQuery.fn.bt=function(content,options){if(typeof content!="string"){var contentSelect=true;options=content;content=false;}else{var contentSelect=false;}if(jQuery.fn.hoverIntent&&jQuery.bt.defaults.trigger=="hover"){jQuery.bt.defaults.trigger="hoverIntent";}return this.each(function(index){var opts=jQuery.extend(false,jQuery.bt.defaults,jQuery.bt.options,options);opts.spikeLength=numb(opts.spikeLength);opts.spikeGirth=numb(opts.spikeGirth);opts.overlap=numb(opts.overlap);var ajaxTimeout=false;if(opts.killTitle){$(this).find("[title]").andSelf().each(function(){if(!$(this).prop("bt-xTitle")){$(this).prop("bt-xTitle",$(this).prop("title")).prop("title","");}});}if(typeof opts.trigger=="string"){opts.trigger=[opts.trigger];}if(opts.trigger[0]=="hoverIntent"){var hoverOpts=jQuery.extend(opts.hoverIntentOpts,{over:function(){this.btOn();},out:function(){this.btOff();}});$(this).hoverIntent(hoverOpts);}else{if(opts.trigger[0]=="hover"){$(this).hover(function(){this.btOn();},function(){this.btOff();});}else{if(opts.trigger[0]=="now"){if($(this).hasClass("bt-active")){this.btOff();}else{this.btOn();}}else{if(opts.trigger[0]=="none"){}else{if(opts.trigger.length>1&&opts.trigger[0]!=opts.trigger[1]){$(this).bind(opts.trigger[0],function(){this.btOn();}).bind(opts.trigger[1],function(){this.btOff();});}else{$(this).bind(opts.trigger[0],function(){if($(this).hasClass("bt-active")){this.btOff();}else{this.btOn();}});}}}}}this.btOn=function(){if(typeof $(this).data("bt-box")=="object"){this.btOff();}opts.preBuild.apply(this);$(jQuery.bt.vars.closeWhenOpenStack).btOff();$(this).addClass("bt-active "+opts.activeClass);if(contentSelect&&opts.ajaxPath==null){if(opts.killTitle){$(this).prop("title",$(this).prop("bt-xTitle"));}content=$.isFunction(opts.contentSelector)?opts.contentSelector.apply(this):eval(opts.contentSelector);if(opts.killTitle){$(this).prop("title","");}}if(opts.ajaxPath!=null&&content==false){if(typeof opts.ajaxPath=="object"){var url=eval(opts.ajaxPath[0]);url+=opts.ajaxPath[1]?" "+opts.ajaxPath[1]:"";}else{var url=opts.ajaxPath;}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off);}var cacheData=opts.ajaxCache?$(document.body).data("btCache-"+url.replace(/\./g,"")):null;if(typeof cacheData=="string"){content=selector?$("<div/>").append(cacheData.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):cacheData;}else{var target=this;var ajaxOpts=jQuery.extend(false,{type:opts.ajaxType,data:opts.ajaxData,cache:opts.ajaxCache,url:url,complete:function(XMLHttpRequest,textStatus){if(textStatus=="success"||textStatus=="notmodified"){if(opts.ajaxCache){$(document.body).data("btCache-"+url.replace(/\./g,""),XMLHttpRequest.responseText);}ajaxTimeout=false;content=selector?$("<div/>").append(XMLHttpRequest.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):XMLHttpRequest.responseText;}else{if(textStatus=="timeout"){ajaxTimeout=true;}content=opts.ajaxError.replace(/%error/g,XMLHttpRequest.statusText);}if($(target).hasClass("bt-active")){target.btOn();}}},opts.ajaxOpts);jQuery.ajax(ajaxOpts);content=opts.ajaxLoading;}}var shadowMarginX=0;var shadowMarginY=0;var shadowShiftX=0;var shadowShiftY=0;if(opts.shadow&&!shadowSupport()){opts.shadow=false;jQuery.extend(opts,opts.noShadowOpts);}if(opts.shadow){if(opts.shadowBlur>Math.abs(opts.shadowOffsetX)){shadowMarginX=opts.shadowBlur*2;}else{shadowMarginX=opts.shadowBlur+Math.abs(opts.shadowOffsetX);}shadowShiftX=(opts.shadowBlur-opts.shadowOffsetX)>0?opts.shadowBlur-opts.shadowOffsetX:0;if(opts.shadowBlur>Math.abs(opts.shadowOffsetY)){shadowMarginY=opts.shadowBlur*2;}else{shadowMarginY=opts.shadowBlur+Math.abs(opts.shadowOffsetY);}shadowShiftY=(opts.shadowBlur-opts.shadowOffsetY)>0?opts.shadowBlur-opts.shadowOffsetY:0;}if(opts.offsetParent){var offsetParent=$(opts.offsetParent);var offsetParentPos=offsetParent.offset();var pos=$(this).offset();var top=numb(pos.top)-numb(offsetParentPos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)-numb(offsetParentPos.left)+numb($(this).css("margin-left"))-shadowShiftX;}else{var offsetParent=($(this).css("position")=="absolute")?$(this).parents().eq(0).offsetParent():$(this).offsetParent();var pos=$(this).btPosition();var top=numb(pos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)+numb($(this).css("margin-left"))-shadowShiftX;}var width=$(this).btOuterWidth();var height=$(this).outerHeight();if(typeof content=="object"){var original=content;var clone=$(original).clone(true).show();var origClones=$(original).data("bt-clones")||[];origClones.push(clone);$(original).data("bt-clones",origClones);$(clone).data("bt-orig",original);$(this).data("bt-content-orig",{original:original,clone:clone});content=clone;}if(typeof content=="null"||content==""){return;}var $text=$('<div class="bt-content"></div>').append(content).css({padding:opts.padding,position:"absolute",width:(opts.shrinkToFit?"auto":opts.width),zIndex:opts.textzIndex,left:shadowShiftX,top:shadowShiftY}).css(opts.cssStyles);var $box=$('<div class="bt-wrapper"></div>').append($text).addClass(opts.cssClass).css({position:"absolute",width:opts.width,zIndex:opts.wrapperzIndex,visibility:"hidden"}).appendTo(offsetParent);if(jQuery.fn.bgiframe){$text.bgiframe();$box.bgiframe();}$(this).data("bt-box",$box);var scrollTop=numb($(document).scrollTop());var scrollLeft=numb($(document).scrollLeft());var docWidth=numb($(window).width());var docHeight=numb($(window).height());var winRight=scrollLeft+docWidth;var winBottom=scrollTop+docHeight;var space=new Object();var thisOffset=$(this).offset();space.top=thisOffset.top-scrollTop;space.bottom=docHeight-((thisOffset+height)-scrollTop);space.left=thisOffset.left-scrollLeft;space.right=docWidth-((thisOffset.left+width)-scrollLeft);var textOutHeight=numb($text.outerHeight());var textOutWidth=numb($text.btOuterWidth());if(opts.positions.constructor==String){opts.positions=opts.positions.replace(/ /,"").split(",");}if(opts.positions[0]=="most"){var position="top";for(var pig in space){position=space[pig]>space[position]?pig:position;}}else{for(var x in opts.positions){var position=opts.positions[x];if((position=="left"||position=="right")&&space[position]>textOutWidth+opts.spikeLength){break;}else{if((position=="top"||position=="bottom")&&space[position]>textOutHeight+opts.spikeLength){break;}}}}var horiz=left+((width-textOutWidth)*0.5);var vert=top+((height-textOutHeight)*0.5);var points=new Array();var textTop,textLeft,textRight,textBottom,textTopSpace,textBottomSpace,textLeftSpace,textRightSpace,crossPoint,textCenter,spikePoint;switch(position){case"top":$text.css("margin-bottom",opts.spikeLength+"px");$box.css({top:(top-$text.outerHeight(true))+opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace;}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace;}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={y:textBottom+opts.spikeLength,x:((textRight-textLeft)*0.5)+xShift,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textBottom);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.CornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:crossPoint.x+(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]=spikePoint;break;case"left":$text.css("margin-right",opts.spikeLength+"px");$box.css({top:vert+"px",left:((left-$text.btOuterWidth(true))+opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace;}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace;}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:textRight+opts.spikeLength,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textRight);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textRight,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break;case"bottom":$text.css("margin-top",opts.spikeLength+"px");$box.css({top:(top+height)-opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace;}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace;}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:((textRight-textLeft)*0.5)+xShift,y:shadowShiftY,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textTop);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textTop,type:"join"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textTop,type:"join"};points[points.length]=spikePoint;break;case"right":$text.css("margin-left",(opts.spikeLength+"px"));$box.css({top:vert+"px",left:((left+width)-opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace;}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace;}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:shadowShiftX,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textLeft);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textLeft,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break;}var canvas=document.createElement("canvas");$(canvas).prop("width",(numb($text.btOuterWidth(true))+opts.strokeWidth*2+shadowMarginX)).prop("height",(numb($text.outerHeight(true))+opts.strokeWidth*2+shadowMarginY)).appendTo($box).css({position:"absolute",zIndex:opts.boxzIndex});if(typeof G_vmlCanvasManager!="undefined"){canvas=G_vmlCanvasManager.initElement(canvas);}if(opts.cornerRadius>0){var newPoints=new Array();var newPoint;for(var i=0;i<points.length;i++){if(points[i].type=="corner"){newPoint=betweenPoint(points[i],points[(i-1)%points.length],opts.cornerRadius);newPoint.type="arcStart";newPoints[newPoints.length]=newPoint;newPoints[newPoints.length]=points[i];newPoint=betweenPoint(points[i],points[(i+1)%points.length],opts.cornerRadius);newPoint.type="arcEnd";newPoints[newPoints.length]=newPoint;}else{newPoints[newPoints.length]=points[i];}}points=newPoints;}var ctx=canvas.getContext("2d");if(opts.shadow&&opts.shadowOverlap!==true){var shadowOverlap=numb(opts.shadowOverlap);switch(position){case"top":if(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap>0){$box.css("top",(numb($box.css("top"))-(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap)));}break;case"right":if(shadowShiftX-shadowOverlap>0){$box.css("left",(numb($box.css("left"))+shadowShiftX-shadowOverlap));}break;case"bottom":if(shadowShiftY-shadowOverlap>0){$box.css("top",(numb($box.css("top"))+shadowShiftY-shadowOverlap));}break;case"left":if(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap>0){$box.css("left",(numb($box.css("left"))-(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap)));}break;}}drawIt.apply(ctx,[points],opts.strokeWidth);ctx.fillStyle=opts.fill;if(opts.shadow){ctx.shadowOffsetX=opts.shadowOffsetX;ctx.shadowOffsetY=opts.shadowOffsetY;ctx.shadowBlur=opts.shadowBlur;ctx.shadowColor=opts.shadowColor;}ctx.closePath();ctx.fill();if(opts.strokeWidth>0){ctx.shadowColor="rgba(0, 0, 0, 0)";ctx.lineWidth=opts.strokeWidth;ctx.strokeStyle=opts.strokeStyle;ctx.beginPath();drawIt.apply(ctx,[points],opts.strokeWidth);ctx.closePath();ctx.stroke();}opts.preShow.apply(this,[$box[0]]);$box.css({display:"none",visibility:"visible"});opts.showTip.apply(this,[$box[0]]);if(opts.overlay){var overlay=$('<div class="bt-overlay"></div>').css({position:"absolute",backgroundColor:"blue",top:top,left:left,width:width,height:height,opacity:".2"}).appendTo(offsetParent);$(this).data("overlay",overlay);}if((opts.ajaxPath!=null&&opts.ajaxCache==false)||ajaxTimeout){content=false;}if(opts.clickAnywhereToClose){jQuery.bt.vars.clickAnywhereStack.push(this);$(document).click(jQuery.bt.docClick);}if(opts.closeWhenOthersOpen){jQuery.bt.vars.closeWhenOpenStack.push(this);}opts.postShow.apply(this,[$box[0]]);};this.btOff=function(){var box=$(this).data("bt-box");opts.preHide.apply(this,[box]);var i=this;i.btCleanup=function(){var box=$(i).data("bt-box");var contentOrig=$(i).data("bt-content-orig");var overlay=$(i).data("bt-overlay");if(typeof box=="object"){$(box).remove();$(i).removeData("bt-box");}if(typeof contentOrig=="object"){var clones=$(contentOrig.original).data("bt-clones");$(contentOrig).data("bt-clones",arrayRemove(clones,contentOrig.clone));}if(typeof overlay=="object"){$(overlay).remove();$(i).removeData("bt-overlay");}jQuery.bt.vars.clickAnywhereStack=arrayRemove(jQuery.bt.vars.clickAnywhereStack,i);jQuery.bt.vars.closeWhenOpenStack=arrayRemove(jQuery.bt.vars.closeWhenOpenStack,i);$(i).removeClass("bt-active "+opts.activeClass);opts.postHide.apply(i);};opts.hideTip.apply(this,[box,i.btCleanup]);};var refresh=this.btRefresh=function(){this.btOff();this.btOn();};});function drawIt(points,strokeWidth){this.moveTo(points[0].x,points[0].y);for(i=1;i<points.length;i++){if(points[i-1].type=="arcStart"){this.quadraticCurveTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth),round5(points[(i+1)%points.length].x,strokeWidth),round5(points[(i+1)%points.length].y,strokeWidth));i++;}else{this.lineTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth));}}}function round5(num,strokeWidth){var ret;strokeWidth=numb(strokeWidth);if(strokeWidth%2){ret=num;}else{ret=Math.round(num-0.5)+0.5;}return ret;}function numb(num){return parseInt(num)||0;}function arrayRemove(arr,elem){var x,newArr=new Array();for(x in arr){if(arr[x]!=elem){newArr.push(arr[x]);}}return newArr;}function canvasSupport(){var canvas_compatible=false;try{canvas_compatible=!!(document.createElement("canvas").getContext("2d"));}catch(e){canvas_compatible=!!(document.createElement("canvas").getContext);}return canvas_compatible;}function shadowSupport(){try{var userAgent=navigator.userAgent.toLowerCase();if(/webkit/.test(userAgent)){return true;}else{if(/gecko|mozilla/.test(userAgent)&&parseFloat(userAgent.match(/firefox\/(\d+(?:\.\d+)+)/)[1])>=3.1){return true;}}}catch(err){}return false;}function betweenPoint(point1,point2,dist){var y,x;if(point1.x==point2.x){y=point1.y<point2.y?point1.y+dist:point1.y-dist;return{x:point1.x,y:y};}else{if(point1.y==point2.y){x=point1.x<point2.x?point1.x+dist:point1.x-dist;return{x:x,y:point1.y};}}}function centerPoint(arcStart,corner,arcEnd){var x=corner.x==arcStart.x?arcEnd.x:arcStart.x;var y=corner.y==arcStart.y?arcEnd.y:arcStart.y;var startAngle,endAngle;if(arcStart.x<arcEnd.x){if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*180;endAngle=(Math.PI/180)*90;}else{startAngle=(Math.PI/180)*90;endAngle=0;}}else{if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*270;endAngle=(Math.PI/180)*180;}else{startAngle=0;endAngle=(Math.PI/180)*270;}}return{x:x,y:y,type:"center",startAngle:startAngle,endAngle:endAngle};}function findIntersect(r1x1,r1y1,r1x2,r1y2,r2x1,r2y1,r2x2,r2y2){if(r2x1==r2x2){return findIntersectY(r1x1,r1y1,r1x2,r1y2,r2x1);}if(r2y1==r2y2){return findIntersectX(r1x1,r1y1,r1x2,r1y2,r2y1);}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var r2m=(r2y1-r2y2)/(r2x1-r2x2);var r2b=r2y1-(r2m*r2x1);var x=(r2b-r1b)/(r1m-r2m);var y=r1m*x+r1b;return{x:x,y:y};}function findIntersectY(r1x1,r1y1,r1x2,r1y2,x){if(r1y1==r1y2){return{x:x,y:r1y1};}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var y=r1m*x+r1b;return{x:x,y:y};}function findIntersectX(r1x1,r1y1,r1x2,r1y2,y){if(r1x1==r1x2){return{x:r1x1,y:y};}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var x=(y-r1b)/r1m;return{x:x,y:y};}};jQuery.fn.btPosition=function(){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0;}var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};}return results;};jQuery.fn.btOuterWidth=function(margin){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0;}return this["innerWidth"]()+num(this,"borderLeftWidth")+num(this,"borderRightWidth")+(margin?num(this,"marginLeft")+num(this,"marginRight"):0);};jQuery.fn.btOn=function(){return this.each(function(index){if(jQuery.isFunction(this.btOn)){this.btOn();}});};jQuery.fn.btOff=function(){return this.each(function(index){if(jQuery.isFunction(this.btOff)){this.btOff();}});};jQuery.bt.vars={clickAnywhereStack:[],closeWhenOpenStack:[]};jQuery.bt.docClick=function(e){if(!e){var e=window.event;}if(!$(e.target).parents().andSelf().filter(".bt-wrapper, .bt-active").length&&jQuery.bt.vars.clickAnywhereStack.length){$(jQuery.bt.vars.clickAnywhereStack).btOff();$(document).unbind("click",jQuery.bt.docClick);}};jQuery.bt.defaults={trigger:"hover",clickAnywhereToClose:true,closeWhenOthersOpen:false,shrinkToFit:false,width:"200px",padding:"10px",spikeGirth:10,spikeLength:15,overlap:0,overlay:false,killTitle:true,textzIndex:9999,boxzIndex:9998,wrapperzIndex:9997,offsetParent:null,positions:["most"],fill:"rgb(255, 255, 102)",windowMargin:10,strokeWidth:1,strokeStyle:"#000",cornerRadius:5,centerPointX:0.5,centerPointY:0.5,shadow:false,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3,shadowColor:"#000",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999"},cssClass:"",cssStyles:{},activeClass:"bt-active",contentSelector:"$(this).prop('title')",ajaxPath:null,ajaxError:"<strong>ERROR:</strong> <em>%error</em>",ajaxLoading:"<blink>Loading...</blink>",ajaxData:{},ajaxType:"GET",ajaxCache:true,ajaxOpts:{},preBuild:function(){},preShow:function(box){},showTip:function(box){$(box).show();},postShow:function(box){},preHide:function(box){},hideTip:function(box,callback){$(box).hide();callback();},postHide:function(){},hoverIntentOpts:{interval:300,timeout:500}};jQuery.bt.options={};})(jQuery);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/list/tags-list.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * List of objects * @namespace WAF.tags.list */WAF.tags.list = {};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/list/descriptor/tags-list-descriptor.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Tag Descriptor List Management * @namespace WAF.tags.list * @class Descriptor */WAF.tags.list.Descriptor = function () {    this._list = [];}/** * Add a tag descriptor in the list * @namespace WAF.tags.list.Descriptor * @method add * @param {WAF.tags.Descriptor} tag tag descriptor */WAF.tags.list.Descriptor.prototype.add = function (tag) {    this._list.push(tag);};/** * Get the number of tag definition in the catalog * @namespace WAF.tags.list.Descriptor * @method count * @return {Integer} number of element */WAF.tags.list.Descriptor.prototype.count = function () {    return this._list.length;};/** * Get a tag definition by its position * @namespace WAF.tags.list.Descriptor * @method get * @param {Integer} position position of the tag */WAF.tags.list.Descriptor.prototype.get = function (position) {    var result = null;    if (position < this.count()) {        result = this._list[position];    }    return result;};/** * Get a tag definition by its position * @namespace WAF.tags.list.Descriptor * @method get * @param {String} type type of the tag */WAF.tags.list.Descriptor.prototype.getByType = function (type) {    var i = 0,    result = null,    desc = null,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        desc = this.get(i);        if (desc.getType() == type) {            result = desc;            break;        }    }    return result;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/list/propertydescriptor/tags-list-propertydescriptor.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Tag Property Descriptor Management * @namespace WAF.tags.list * @class PropertyDescriptor */WAF.tags.list.PropertyDescriptor = function () {    this._list = [];    this._hash = {};}/** * Get all the structure in array * @namespace WAF.tags.list.PropertyDescriptor * @method toArray * @return {Array} array that represents the structures */WAF.tags.list.PropertyDescriptor.prototype.toArray = function () {    return this._list;};/** * Get all the structure in hash map * @namespace WAF.tags.list.PropertyDescriptor * @method toHash * @return {Object} hashmap of the structure */WAF.tags.list.PropertyDescriptor.prototype.toHash = function () {    return this._hash;};/** * Add an item (a descriptor of an attribute, event or style of a tag) * @namespace WAF.tags.list.PropertyDescriptor * @method add * @param {Object} item a tag descriptor attribute, event or style */WAF.tags.list.PropertyDescriptor.prototype.add = function (item) {    this._list.push(item);    if (typeof item._name !== 'undefined') {        this._hash[item._name] = item;    }};/** * Get the number of item in the catalog * @namespace WAF.tags.list.PropertyDescriptor * @method count * @return {Integer} number of item */WAF.tags.list.PropertyDescriptor.prototype.count = function () {    return this._list.length;};/** * * @namespace WAF.tags.list.PropertyDescriptor * @method get * @param {Integer} position position of the item */WAF.tags.list.PropertyDescriptor.prototype.get = function (position) {    var result = null;    if (position < this.count()) {        result = this._list[position];    }    return result;};/** * Get a tag definition by its description * @namespace WAF.tags.list.PropertyDescriptor * @method getByDescription * @param {String} description description property to search */WAF.tags.list.PropertyDescriptor.prototype.getByDescription = function (description) {    var i = 0,    result = null,    desc = null,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        desc = this.get(i);        if (desc.getDescription() == description) {            result = desc;            break;        }    }    return result;};/** * Get a tag definition by its name * @namespace WAF.tags.list.PropertyDescriptor * @method getByName * @param {String} name name property to search */WAF.tags.list.PropertyDescriptor.prototype.getByName = function (name) {    return this._hash[name];};/** * Get a tag definition by its selector (for structure attribute) * @namespace WAF.tags.list.PropertyDescriptor * @method getBySelector * @param {String} selector selector to search */WAF.tags.list.PropertyDescriptor.prototype.getBySelector = function (selector) {    var i = 0,    result = null,    desc = null,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        desc = this.get(i);        if (desc.getSelector() == selector) {            result = desc;            break;        }    }    return result;};/** * Remove a property * @namespace WAF.tags.list.PropertyDescriptor * @method remove * @param {String} description description of the property to remove * @param {Boolean} byName true if we want to remove the property by name */WAF.tags.list.PropertyDescriptor.prototype.remove = function (description , byName) {    var i = 0,    position = -1,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        if(byName){            if (this.get(i).getName() == description) {                position = i;                break;            }        }        else if (this.get(i).getDescription() == description) {            position = i;            break;        }    }    if (position != -1) {        this._list = this._list.slice(0, position).concat(this._list.slice(position+1));    }};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/list/column/tags-list-column.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Columns Descriptor Management * @namespace WAF.tags.list * @class Column */WAF.tags.list.Column = function () {    this._list = [];}// PRIVATE METHODS/** * Refresh the position of all columns * @namespace WAF.tags.list.Column * @method _refreshPosition * @private */WAF.tags.list.Column.prototype._refreshPosition = function () {    var i = 0,    length = this.count(),    column = null;    for (i = 0; i < length; i++) {        column = this.get(i);        column._position = i;    }};// PUBLIC METHODS/** * Add an column * @namespace WAF.tags.list.Column * @method add * @param {WAF.tags.descriptor.Column} column a column */WAF.tags.list.Column.prototype.add = function (column) {    this._list.push(column);    // refresh the position of the item    this._refreshPosition();    // refresh the reference to the column list    column.setColumns(this);};/** * Get the number of item in the catalog * @namespace WAF.tags.list.Column * @method count * @return {Integer} number of item */WAF.tags.list.Column.prototype.count = function () {    return this._list.length;};/** * Remove all the columns from the list * @namespace WAF.tags.list.Column * @method clear */WAF.tags.list.Column.prototype.clear = function () {    this._list = [];};/** * * @namespace WAF.tags.list.Column * @method get * @param {Integer} position position of the item */WAF.tags.list.Column.prototype.get = function (position) {    var result = null;    if (position < this.count()) {        result = this._list[position];    }    return result;};/** * Get a tag definition by its description * @namespace WAF.tags.list.Column * @method getByColId * @param {String} colid colId property to search */WAF.tags.list.Column.prototype.getByColId = function (colid) {    var i = 0,    result = null,    desc = null,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        desc = this.get(i);        if (desc.getAttribute('colID').getValue() == colid) {            result = desc;            break;        }    }    return result;};/** * Get a tag definition by its name * @namespace WAF.tags.list.Column * @method getByName * @param {Array} name name property to search */WAF.tags.list.Column.prototype.getByAttribute = function (name) {    var i = 0,    result = [],    desc = null,    length = 0;    length = this.count();    for (i = 0; i < length; i++) {        desc = this.get(i);        if (desc.getName() == name) {            result.push(desc);        }    }    return result;};/** * Remove a property * @namespace WAF.tags.list.Column * @method remove * @param {String} position position of the column to remove */WAF.tags.list.Column.prototype.remove = function (position) {    if (position != -1) {        this._list = this._list.slice(0, position).concat(this._list.slice(position+1));    }    this._refreshPosition();};/** * Get the column property into string * @namespace WAF.tags.list.Column * @method toString */WAF.tags.list.Column.prototype.toString = function () {    var length = this.count(),    i = 0,    j = 0,    attributeLength = 0,    column = null,    result = [],    columnProp = {},    cleanResult = '',    attributeName = '',    value = '';    for (i = 0; i < length; i++) {        column = this.get(i);        columnProp = {};        attributeLength = column.getAttributes().count();        for (j = 0; j < attributeLength; j++) {            attributeName = column.getAttributes().get(j).getName();            if (column.getAttribute(attributeName).getValue() != '') {                value = column.getAttribute(attributeName).getValue();                if (attributeName == 'width' && (typeof value === 'undefined' || value == NaN)) {                    value = '70';                }                columnProp[attributeName] = escape(value);            } else {                if (column.getAttribute(attributeName).getDefaultValue() != '') {                    columnProp[attributeName] = escape(column.getAttribute(attributeName).getDefaultValue());                }            }        }        result.push(columnProp);    }    cleanResult = JSON.stringify(result).replace(/"/g,"\'");    return cleanResult;};/** * Get the column property into array * @namespace WAF.tags.list.Column * @method toArray */WAF.tags.list.Column.prototype.toArray = function () {    var length = this.count(),    attributeLength = 0,    attributeName = '',    i = 0,    j = 0,    column = null,    result = [],    columnProp = {};    for (i = 0; i < length; i++) {        column = this.get(i);        columnProp = {};        attributeLength = column.getAttributes().count();        for (j = 0; j < attributeLength; j++) {            attributeName = column.getAttributes().get(j).getName();            if (column.getAttribute(attributeName).getValue() != '') {                columnProp[attributeName] = column.getAttribute(attributeName).getValue();            } else {                if (column.getAttribute(attributeName).getDefaultValue() != '') {                    columnProp[attributeName] = column.getAttribute(attributeName).getDefaultValue();                }            }        }        result.push(columnProp);    }    return result;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/tags-descriptor.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.tags.descriptor = {    }/** * TagDescriptor * @namespace WAF.tags * @class Descriptor * @params {Object} config parameters */WAF.tags.Descriptor = function(config) {    var i = 0,    length = 0,    attribute = {};    config = config || {};    config.type         = config.type        || '';    config.lib          = config.lib         || 'WAF';    config.description  = config.description || '';    config.category     = config.category    || '';    config.img          = config.img         || '';    config.css          = config.css         || [];    config.include      = config.include     || [];    config.tag          = config.tag         || 'div';    config.onDesign     = config.onDesign    || function () {};    config.onInit       = config.onInit      || function () {};    config.attributes   = config.attributes  || [];    config.structure    = config.structure   || [];    config.events       = config.events      || [];    config.style        = config.style       || [];    config.properties   = config.properties  || {};    config.menuItems    = config.menuItems   || [];    this._config = config;    // properties inherited from config    this._type          = config.type;    this._lib           = config.lib;    this._description   = config.description;    this._category      = config.category;    this._img           = config.img;    this._css           = config.css;    this._include       = config.include;    this._tag           = config.tag;    this._onDesign      = config.onDesign;    this._onInit        = config.onInit;    this._properties    = config.properties;    this._menuItems     = config.menuItems;    // property for design only    this._internalId    = -1;    // list    this._attributes    = new WAF.tags.list.PropertyDescriptor();    length = config.attributes.length;    // add default attributes    // id    attribute = new WAF.tags.descriptor.Attribute({        name       : 'id',        description: 'ID'    });    attribute.setDescriptor(this);    this._attributes.add(attribute);    // data-type    attribute = new WAF.tags.descriptor.Attribute({        name        : 'data-type',        description : 'type',        defaultValue: config.type    });    attribute.setDescriptor(this);    this._attributes.add(attribute);    // data-hideOnLoad    attribute = new WAF.tags.descriptor.Attribute({        name        : 'data-hideonload',        description : 'Hide widget on load',        defaultValue: false    });    attribute.setDescriptor(this);    this._attributes.add(attribute);    // data-lib    attribute = new WAF.tags.descriptor.Attribute({        name        : 'data-lib',        description : 'library',        defaultValue: config.lib    });    attribute.setDescriptor(this);    this._attributes.add(attribute);    for (i = 0; i < length; i++) {        attribute = new WAF.tags.descriptor.Attribute(config.attributes[i]);        attribute.setDescriptor(this);        this._attributes.add(attribute);    }    this._style         = new WAF.tags.list.PropertyDescriptor();    length = config.style.length;    for (i = 0; i < length; i++) {        this._style.add(new WAF.tags.descriptor.Style(config.style[i]));    }    this._events         = new WAF.tags.list.PropertyDescriptor();    length = config.events.length;    for (i = 0; i < length; i++) {        this._events.add(new WAF.tags.descriptor.Event(config.events[i]));    }    this._menuItems     = new WAF.tags.list.PropertyDescriptor();    length = config.menuItems.length;    for (i = 0; i < length; i++) {        this._menuItems.add(new WAF.tags.descriptor.MenuItem(config.menuItem[i]));    }    if (config.columns) {        this._columns  = new WAF.tags.list.Column();    } else {        this._columns  = null;    }    if (config.properties.style) {        this._propertyStyle  = new WAF.tags.descriptor.PropertyStyle(config.properties.style);    } else {        this._propertyStyle  = null;    }    this._structure         = new WAF.tags.list.PropertyDescriptor();    length = config.structure.length;    for (i = 0; i < length; i++) {        this._structure.add(new WAF.tags.descriptor.Structure(config.structure[i]));    }    /*     * If the tag has a label => auto add label into the structure     */    if (this.getAttribute('data-label')) {        this._structure.add(new WAF.tags.descriptor.Structure({            description : 'label',            selector    : 'waf-label'        }));    }}/** * Get the configuration file of the descriptor * @namespace WAF.tags.Descriptor * @method getConfig * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getConfig = function () {    return this._config;};/** * Get the internal id of the descriptor * @namespace WAF.tags.Descriptor * @method getConfig * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getInternalId = function () {    return this._internalId;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getType * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getType = function () {    return this._type;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getLib * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getLib = function () {    return this._lib;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getDescription * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getDescription = function () {    return this._description;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getCategory * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getCategory = function () {    return this._category;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getCategory * @return {WAF.tags.list.column} the value of the attribute */WAF.tags.Descriptor.prototype.getColumns = function () {    return this._columns;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getImg * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getImg = function () {    return this._img;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getCss * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getCss = function () {    return this._css;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getInclude * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getInclude = function () {    return this._include;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getTag * @return {String} the value of the attribute */WAF.tags.Descriptor.prototype.getTag = function () {    return this._tag;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method onDesign * @param {Designer.api} designer set of functions for gui designer management * @param {Designer.ui.Tag} tag container of the tag in the designer * @param {Object} catalog catalog of DataClasses * @param {Boolean} isResize is a resize call  */WAF.tags.Descriptor.prototype.onDesign = function (designer, tag, catalog, isResize) {    return this._onDesign(designer, tag, catalog, isResize);};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method onInit * @param {Object} param all the of attributes of the html tag  */WAF.tags.Descriptor.prototype.onInit = function (param) {    return this._onInit(param);};/** * Get the list of the attribute descriptor * @namespace WAF.tags.Descriptor * @method getAttributes * @return {WAF.tags.list.PropertyDescriptor} list of the attributes */WAF.tags.Descriptor.prototype.getAttributes = function () {    return this._attributes;};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getAttribute * @param {String} name name * @return {WAF.tags.descriptor.Attribute} attribute descriptor */WAF.tags.Descriptor.prototype.getAttribute = function (name) {    return this._attributes.getByName(name);};/** * Get the list of datasource attributes of a widget * @namespace WAF.tags.Descriptor * @method getDataSourceAttributes * @param {String} * @return {Object} list of attributes */WAF.tags.Descriptor.prototype.getDataSourceAttributes = function () {    var    i,    result,    attribute,    attributes,    attributeLength;    result          = [];    attributes      = this.getAttributes();    attributeLength = attributes.count();    for (i = 0; i < attributeLength; i += 1) {        attribute = attributes.get(i);        if (attribute.getTypeValue() === 'datasource' || attribute.getName() === 'data-binding') {            result.push(attribute);        }    }    return result;};/** * Get the list of the event descriptor * @namespace WAF.tags.Descriptor * @method getEvents * @return {WAF.tags.list.PropertyDescriptor} list of the events */WAF.tags.Descriptor.prototype.getEvents = function () {    return this._events;};/** * Get an event description by its name * @namespace WAF.tags.Descriptor * @method getEvent * @return {WAF.tags.descriptor.Event} Event descriptor */WAF.tags.Descriptor.prototype.getEvent = function (name) {    return this._events.getByName(name);};/** * Get the list of the style descriptor * @namespace WAF.tags.Descriptor * @method getStyles * @return {Designer.list.TagPropertyDescriptor} list of the style */WAF.tags.Descriptor.prototype.getStyles = function () {    return this._style;};/** * Get an style description by its name * @namespace WAF.tags.Descriptor * @method getStyle * @return {WAF.tags.descriptor.Style} style descriptor */WAF.tags.Descriptor.prototype.getStyle = function (name) {    return this._style.getByName(name);};/** * Get the value of the name of the attribute * @namespace WAF.tags.Descriptor * @method getPropertyStyle * @return {WAF.tags.descriptor.PropertyStyle} propertyStyle descriptor */WAF.tags.Descriptor.prototype.getPropertyStyle = function () {    return this._propertyStyle;};/** * Get the list of the structure descriptor * @namespace WAF.tags.Descriptor * @method getStructures * @return {Designer.list.TagPropertyDescriptor} list of the structure */WAF.tags.Descriptor.prototype.getStructures = function () {    return this._structure;};/** * Get the list of subItems descriptor * @namespace WAF.tags.Descriptor * @method getSubItems * @return {Designer.list.TagPropertyDescriptor} list of subitems */WAF.tags.Descriptor.prototype.getMenuItems = function () {    return this._menuItems;};// Setter/** * Set the internal id of the descriptor * @namespace WAF.tags.Descriptor * @method setInternalId * @param {String} value the value of the attribute */WAF.tags.Descriptor.prototype.setInternalId = function (value) {    this._internalId = value;};// Add/** * Add a new attribute to the descriptor * @namespace WAF.tags.Descriptor * @method addAttribute * @param {String} name name of the attribute to add to the descriptor */WAF.tags.Descriptor.prototype.addAttribute = function (name) {    var attribute = new WAF.tags.descriptor.Attribute({        name       : name,        description: name    });    attribute.setDescriptor(this);    this._attributes.add(attribute);};/** * Add a new menuItem to the descriptor * @namespace WAF.tags.Descriptor * @method addMenuItem * @param {Object} config menuItem properties */WAF.tags.Descriptor.prototype.addMenuItem = function (config, callback) {    var    menuItem,    tagDefinition,    subMenu,    direction,    borderLeft,    borderTop,    parentBar;    config          = config || {};    config.parent   = this;    parentBar       = this.getParent();    borderLeft      = parentBar ? parseInt(parentBar.getComputedStyle('border-width')) : 0;    borderTop       = borderLeft;    if (this.isMenuBar()) {        menuItem = new WAF.tags.descriptor.MenuItem(config);        menuItem.init();        this._menuItems.add(menuItem);        this.onDesign({            resize      : true,            redrawItems : false // to do not redraw all menu items of the menubar        });        menuItem.getTag().domUpdate();    } else { // if the current tag is not a menubar => create one        if (this._menuBar) {            subMenu = this._menuBar;        } else {            tagDefinition   = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('menuBar'));            subMenu = new Designer.tag.Tag(tagDefinition);            subMenu.create({                parent : this,                width : this.getWidth() + 'px'            });            subMenu.save(false, false);            subMenu.setParent(this);        }        D.tag.displayParentsMenuBar(this)        direction = this.getParent().getAttribute('data-display').getValue();        if (direction === 'horizontal') {            subMenu.setXY(0, this.getHeight() + borderTop, true);        } else {            subMenu.setXY(this.getWidth() + borderLeft, 0, true);        }        subMenu.getAttribute('data-display').setValue('vertical');        subMenu.addMenuItem(config);    }    this.setResizable(true);    if (this.getParent().isMenuItem()) {        this.getParent().displayInfo();    }    if (callback) {        callback(menuItem);    }    /**     * Call custom after add item event     */    $(this).trigger('afterAddItem', [menuItem, config.silentMode]);};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/attribute/tags-descriptor-attribute.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Attribute of Tag Descriptor * @namespace WAF.tags.descriptor * @class Attribute * @params {Object} config parameters */WAF.tags.descriptor.Attribute = function(config) {    config = config || {};    config.name             = config.name         || '';    config.defaultValue     = typeof config.defaultValue == 'undefined' ? '' : config.defaultValue;    config.typeValue        = config.typeValue    || '';    config.description      = config.description  || '';    config.tooltip          = config.tooltip      || '';    config.type             = config.type         || '';    config.options          = config.options      || '';    config.tab              = config.tab          || '';    if (typeof config.visibility === 'undefined') {        config.visibility   = true;    }    if (typeof config.category === 'undefined') {        config.category     = 0;    }    // properties inherited from config    this._name              = config.name;    this._defaultValue      = config.defaultValue;    this._description       = config.description;    this._tooltip           = config.tooltip;    this._type              = config.type;    this._options           = config.options;    this._category          = config.category;    this._tab               = config.tab;    this._typeValue         = config.typeValue;    this._domAttribute      = config.domAttribute;    this._visibility        = config.visibility;    this._saveHistory       = typeof config.saveHistory == 'undefined' ? true : config.saveHistory;    // property    this._value             = '';    this._oldValue          = '';    this._descriptor        = {};};// GETTER/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getName * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getName = function () {    return this._name;};/** * Get the value of the default value of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getDefaultValue * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getDefaultValue = function () {    return this._defaultValue;};/** * Get the type of the value of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getTypeValue * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getTypeValue = function () {    return this._typeValue;};/** * Get the value of the description of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getDescription * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getDescription = function () {    return this._description;};/** * Get the value of the desritor of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getDescriptor * @return {WAF.tags.Descriptor} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getDescriptor = function () {    return this._descriptor;};/** * Get the value of the options of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getOptions * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getOptions = function () {    var options = [];    var i       = 0;    if (this._options.length === 0) {        for (i in this._options) {            options.push(this._options[i]);        }    } else {        options = this._options;    }    return options;};/** * Get the value of the tooltip of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getTooltip * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getTooltip = function () {    return this._tooltip;};/** * Get the value of the type of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getType * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getType = function () {    return this._type;};/** * Get the value of the type of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getVisibility * @return {String} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getVisibility = function () {    return this._visibility;};/** * Get the value of the type of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getCategory * @return {Integer} the value of the attribute */WAF.tags.descriptor.Attribute.prototype.getCategory = function () {    return this._category;};/** * Get the tab where the attribute must be placed * @namespace WAF.tags.descriptor.Attribute * @method getTab * @return {String} name of the tab */WAF.tags.descriptor.Attribute.prototype.getTab = function () {    return this._tab;};/** * Get the value of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getValue * @return {String} value of the attribute */WAF.tags.descriptor.Attribute.prototype.getValue = function () {    return this._value;};/** * Get the old value of the attribute * @namespace WAF.tags.descriptor.Attribute * @method getOldValue * @return {String} value of the attribute */WAF.tags.descriptor.Attribute.prototype.getOldValue = function () {    return this._oldValue;};// SETTER/** * Set the value of the attribute * @namespace WAF.tags.descriptor.Attribute * @method setValue * @param {String} value new value of the attribute */WAF.tags.descriptor.Attribute.prototype.setValue = function (value) {    this._oldValue = this._value;    this._value = value;};/** * Set the descriptor to link to the attribute * @namespace WAF.tags.descriptor.Attribute * @method setDescriptor * @param {WAF.tags.Descriptor} descriptor descriptor to link */WAF.tags.descriptor.Attribute.prototype.setDescriptor = function (descriptor) {    this._descriptor = descriptor;};     /**     * Set the visibility of the attribute     * @namespace Designer.tag.Attribute     * @method setVisibility     * @param {String} value the new value     */WAF.tags.descriptor.Attribute.prototype.setVisibility = function (value) {        this._visibility = value;    };// PUBLIC METHODS/** * Remove the attribute * @namespace WAF.tags.descriptor.Attribute * @method remove */WAF.tags.descriptor.Attribute.prototype.remove = function () {    this.getDescriptor()._attributes.remove(this.getName());};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/event/tags-descriptor-event.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Event of the Tag * @namespace WAF.tags.descriptor * @class Event * @params {Object} config parameters */WAF.tags.descriptor.Event = function(config) {    config = config || {};    config.name        = config.name         || '';    config.description = config.description  || '';    config.handlername = config.handlername  || '';    config.category = config.category        || '';    // properties inherited from config    this._name         = config.name;    this._description  = config.description;    this._category     = config.category;    // value    this._handlername  = config.handlername;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Event * @method getDefaultValue * @return {String} the value of the attribute */WAF.tags.descriptor.Event.prototype.getName = function () {    return this._name;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Event * @method getDescription * @return {String} the value of the attribute */WAF.tags.descriptor.Event.prototype.getDescription = function () {    return this._description;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Event * @method getHandlerName * @return {String} the value of the attribute */WAF.tags.descriptor.Event.prototype.getHandlerName = function () {    return this._handlername;};/** * Get the value of the category of the attribute * @namespace WAF.tags.descriptor.Event * @method getCategory * @return {String} the value of the attribute */WAF.tags.descriptor.Event.prototype.getCategory = function () {    return this._category;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Event * @method setHandlerName * @paramn {name} the name of the handler */WAF.tags.descriptor.Event.prototype.setHandlerName = function (name) {    this._handlername = name;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/structure/tags-descriptor-structure.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Structure of the Tag * @namespace WAF.tags.descriptor * @class Structure * @params {Object} config parameters */WAF.tags.descriptor.Structure = function(config) {    config = config || {};    config.description = config.description || '';    config.selector    = config.selector    || '';    config.style       = config.style       || {};    config.state       = config.state       || {};    config.hidden      = config.hidden      || false;    config.group       = config.group       || null;    // properties inherited from config    this._description = config.description;    this._selector    = config.selector;    this._style       = config.style;    this._states      = config.state;    this._hidden      = config.hidden;    this._group       = config.group;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Structure * @method getDescription * @return {String} the value of the attribute */WAF.tags.descriptor.Structure.prototype.getDescription = function () {    return this._description;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Structure * @method getSelector * @return {String} the value of the attribute */WAF.tags.descriptor.Structure.prototype.getSelector = function () {    return this._selector;};/** * Get the value a style of the current structure * @namespace WAF.tags.descriptor.Structure * @method getStyle * @param {String} styleName name of the style * @return {String} the value of the attribute */WAF.tags.descriptor.Structure.prototype.getStyle = function (styleName) {    return this._style[styleName];};;/** * Get the states of the current structure * @namespace WAF.tags.descriptor.Structure * @method getState * @param {String} styleName name of the style * @return {String} the value of the attribute */WAF.tags.descriptor.Structure.prototype.getStates = function () {    return this._states;};/** * Get the group of the current structure * @namespace WAF.tags.descriptor.Structure * @method getGroup * @return {String} the group of the attribute */WAF.tags.descriptor.Structure.prototype.getGroup = function () {    return this._group;};/** * Check if the structure is visible * @namespace WAF.tags.descriptor.Structure * @method isVisible * @return {boolean} */WAF.tags.descriptor.Structure.prototype.isVisible = function () {    var    result;    result = this._hidden == true ? false : true;    return result;};/** * Get all the name of style for the current structure * @namespace WAF.tags.descriptor.Structure * @method getStyles * @param * @return {String} the value of the attribute */WAF.tags.descriptor.Structure.prototype.getStyles = function () {    var result = [],    styleName = '';    for (styleName in this._style) {        result.push(styleName);    }    return result;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/style/tags-descriptor-style.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Style of the Tag * @namespace WAF.tags.descriptor * @class Style * @params {Object} config parameters */WAF.tags.descriptor.Style = function(config) {    config = config || {};    config.name         = config.name         || '';    config.defaultValue = config.defaultValue || '';    // properties inherited from config    this._name = config.name;    this._defaultValue = config.defaultValue;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Style * @method getDefaultValue * @return {String} the value of the attribute */WAF.tags.descriptor.Style.prototype.getDefaultValue = function () {    return this._defaultValue;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Style * @method getName * @return {String} the value of the attribute */WAF.tags.descriptor.Style.prototype.getName = function () {    return this._name;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/property/tags-descriptor-property-style.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Style properties of the Tag * @namespace WAF.tags.descriptor * @class PropertyStyle * @params {Object} config parameters */WAF.tags.descriptor.PropertyStyle = function(config) {    config = config || {};    if (typeof config.fClass === 'undefined') {        config.fClass = true;    }    if (typeof config.text === 'undefined') {        config.text = true;    }    if (typeof config.background === 'undefined') {        config.background = true;    }    if (typeof config.border === 'undefined') {        config.border = true;    }    if (typeof config.sizePosition === 'undefined') {        config.sizePosition = true;    }    if (typeof config.label === 'undefined') {        config.label = true;    }    // properties inherited from config    /**     * fClass     * @private     * @property fClass     * @type Boolean     * @default true     */    this._fClass = config.fClass;    this._text = config.text;    this._background = config.background;    this._border = config.border;    this._sizePosition = config.sizePosition;    this._label = config.label;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getFClass * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getFClass = function () {    return this._fClass;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getText * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getText = function () {    return this._text;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getBackground * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getBackground = function () {    return this._background;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getBorder * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getBorder = function () {    return this._border;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getSizePosition * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getSizePosition = function () {    return this._sizePosition;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.PropertyStyle * @method getLabel * @return {Boolean} the value of the attribute */WAF.tags.descriptor.PropertyStyle.prototype.getLabel = function () {    return this._label;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/column/tags-descriptor-column.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Columns of Tag Descriptor * @namespace WAF.tags.descriptor * @class Column * @params {Object} config parameters */WAF.tags.descriptor.Column = function(config) {    var length = 0,    i = 0;    config = config || {};    config.attribute = config.attribute || '';    // property    this._columns = null;    this._position = -1;    this._attributes = new WAF.tags.list.PropertyDescriptor();    // default property for attributes    if (WAF.config.widget.datagrid) {        this.configColumn = WAF.config.widget.datagrid;    } else {        this.configColumn = {            columns: {                attributes : [                {                    name       : 'sourceAttID'                },                {                    name       : 'colID'                },                {                    name       : 'format'                },                {                    name       : 'width'                },                {                    name       : 'title'                },                {                    name       : 'readOnly'                }                ]            }        };    }    if(config.attributes){        for(var _i = 0 , attr; attr = config.attributes[_i] ; _i++){            this.configColumn.columns.attributes.push(attr);        }    }    length = this.configColumn.columns.attributes.length;    for (i = 0; i < length; i++) {        this._attributes.add(new WAF.tags.descriptor.AttributeColumn(this.configColumn.columns.attributes[i]));    }};// GETTER/** * Get the list of the attribute descriptor * @namespace WAF.tags.descriptor.Column * @method getAttributes * @return {WAF.tags.list.PropertyDescriptor} list of the attributes */WAF.tags.descriptor.Column.prototype.getAttributes = function () {    return this._attributes;};/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.Column * @method getAttribute * @param {String} name name * @return {WAF.tags.descriptor.Attribute} attribute descriptor */WAF.tags.descriptor.Column.prototype.getAttribute = function (name) {    return this._attributes.getByName(name);};/** * Get the list of column * @namespace WAF.tags.descriptor.Column * @method getColumns * @return {String} the value of the attribute */WAF.tags.descriptor.Column.prototype.getColumns = function () {    return this._columns;};/** * Get the value of the column position * @namespace WAF.tags.descriptor.Column * @method getPosition * @return {String} the value of the attribute */WAF.tags.descriptor.Column.prototype.getPosition = function () {    return this._position;};// SETTER/** * Get the list of column * @namespace WAF.tags.descriptor.Column * @method setColumns * @return {String} the value of the attribute */WAF.tags.descriptor.Column.prototype.setColumns = function (value) {    this._columns = value;};/** * Set the value of the column position * @namespace WAF.tags.descriptor.Column * @method setPosition * @param {String} value new value of the attribute */WAF.tags.descriptor.Column.prototype.setPosition = function (value) {    // refresh the column list    this.getColumns()._list.splice(this.getPosition(), 1);    this.getColumns()._list.splice(value, 0 , this);    this.getColumns()._refreshPosition();};// PUBLIC METHODS/** * Remove the attribute * @namespace WAF.tags.descriptor.Column * @method remove */WAF.tags.descriptor.Column.prototype.remove = function () {    this.getColumns().remove(this.getPosition());};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/Tags/descriptor/column/attribute/tags-descriptor-attributecolumn.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * Attribute of Tag Descriptor * @namespace WAF.tags.descriptor * @class AttributeColumn * @params {Object} config parameters */WAF.tags.descriptor.AttributeColumn = function(config) {    config = config || {};    config.name             = config.name         || '';    config.defaultValue     = config.defaultValue || '';    // properties inherited from config    this._name              = config.name;    this._defaultValue      = config.defaultValue;    // property    this._value             = '';    this._oldValue          = '';    // defaultValue    this._value = this._defaultValue;};// GETTER/** * Get the value of the name of the attribute * @namespace WAF.tags.descriptor.AttributeColumn * @method getName * @return {String} the value of the attribute */WAF.tags.descriptor.AttributeColumn.prototype.getName = function () {    return this._name;};/** * Get the value of the default value of the attribute * @namespace WAF.tags.descriptor.AttributeColumn * @method getDefaultValue * @return {String} the value of the attribute */WAF.tags.descriptor.AttributeColumn.prototype.getDefaultValue = function () {    return this._defaultValue;};/** * Get the value of the attribute * @namespace WAF.tags.descriptor.AttributeColumn * @method getValue * @return {String} value of the attribute */WAF.tags.descriptor.AttributeColumn.prototype.getValue = function () {    return this._value;};/** * Get the old value of the attribute * @namespace WAF.tags.descriptor.AttributeColumn * @method getOldValue * @return {String} value of the attribute */WAF.tags.descriptor.AttributeColumn.prototype.getOldValue = function () {    return this._oldValue;};// SETTER/** * Set the value of the attribute * @namespace WAF.tags.descriptor.AttributeColumn * @method setValue * @param {String} value new value of the attribute */WAF.tags.descriptor.AttributeColumn.prototype.setValue = function (value) {    this._oldValue = this._value;    this._value = value;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/jquery.svg/jquery.svg.min.js*//* http://keith-wood.name/svg.html   SVG for jQuery v1.4.3.   Written by Keith Wood (kbwood{at}iinet.com.au) August 2007.   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.   Please attribute the author if you use it. */(function($){function SVGManager(){this._settings=[];this._extensions=[];this.regional=[];this.regional['']={errorLoadingText:'Error loading',notSupportedText:'This browser does not support SVG'};this.local=this.regional[''];this._uuid=new Date().getTime();this._renesis=detectActiveX('RenesisX.RenesisCtrl')}function detectActiveX(a){try{return!!(window.ActiveXObject&&new ActiveXObject(a))}catch(e){return false}}var p='svgwrapper';$.extend(SVGManager.prototype,{markerClassName:'hasSVG',svgNS:'http://www.w3.org/2000/svg',xlinkNS:'http://www.w3.org/1999/xlink',_wrapperClass:SVGWrapper,_attrNames:{class_:'class',in_:'in',alignmentBaseline:'alignment-baseline',baselineShift:'baseline-shift',clipPath:'clip-path',clipRule:'clip-rule',colorInterpolation:'color-interpolation',colorInterpolationFilters:'color-interpolation-filters',colorRendering:'color-rendering',dominantBaseline:'dominant-baseline',enableBackground:'enable-background',fillOpacity:'fill-opacity',fillRule:'fill-rule',floodColor:'flood-color',floodOpacity:'flood-opacity',fontFamily:'font-family',fontSize:'font-size',fontSizeAdjust:'font-size-adjust',fontStretch:'font-stretch',fontStyle:'font-style',fontVariant:'font-variant',fontWeight:'font-weight',glyphOrientationHorizontal:'glyph-orientation-horizontal',glyphOrientationVertical:'glyph-orientation-vertical',horizAdvX:'horiz-adv-x',horizOriginX:'horiz-origin-x',imageRendering:'image-rendering',letterSpacing:'letter-spacing',lightingColor:'lighting-color',markerEnd:'marker-end',markerMid:'marker-mid',markerStart:'marker-start',stopColor:'stop-color',stopOpacity:'stop-opacity',strikethroughPosition:'strikethrough-position',strikethroughThickness:'strikethrough-thickness',strokeDashArray:'stroke-dasharray',strokeDashOffset:'stroke-dashoffset',strokeLineCap:'stroke-linecap',strokeLineJoin:'stroke-linejoin',strokeMiterLimit:'stroke-miterlimit',strokeOpacity:'stroke-opacity',strokeWidth:'stroke-width',textAnchor:'text-anchor',textDecoration:'text-decoration',textRendering:'text-rendering',underlinePosition:'underline-position',underlineThickness:'underline-thickness',vertAdvY:'vert-adv-y',vertOriginY:'vert-origin-y',wordSpacing:'word-spacing',writingMode:'writing-mode'},_attachSVG:function(a,b){var c=(a.namespaceURI==this.svgNS?a:null);var a=(c?null:a);if($(a||c).hasClass(this.markerClassName)){return}if(typeof b=='string'){b={loadURL:b}}else if(typeof b=='function'){b={onLoad:b}}$(a||c).addClass(this.markerClassName);try{if(!c){c=document.createElementNS(this.svgNS,'svg');c.setAttribute('version','1.1');c.setAttribute('width',a.clientWidth);c.setAttribute('height',a.clientHeight);a.appendChild(c)}this._afterLoad(a,c,b||{})}catch(e){if($.browser.msie){if(!a.id){a.id='svg'+(this._uuid++)}this._settings[a.id]=b;a.innerHTML='<embed type="image/svg+xml" width="100%" '+'height="100%" src="'+(b.initPath||'')+'blank.svg"/>'}else{a.innerHTML='<p class="svg_error">'+this.local.notSupportedText+'</p>'}}},_registerSVG:function(){for(var i=0;i<document.embeds.length;i++){var a=document.embeds[i].parentNode;if(!$(a).hasClass($.svg.markerClassName)||$.data(a,p)){continue}var b=null;try{b=document.embeds[i].getSVGDocument()}catch(e){setTimeout($.svg._registerSVG,250);return}b=(b?b.documentElement:null);if(b){$.svg._afterLoad(a,b)}}},_afterLoad:function(a,b,c){var c=c||this._settings[a.id];this._settings[a?a.id:'']=null;var d=new this._wrapperClass(b,a);$.data(a||b,p,d);try{if(c.loadURL){d.load(c.loadURL,c)}if(c.settings){d.configure(c.settings)}if(c.onLoad&&!c.loadURL){c.onLoad.apply(a||b,[d])}}catch(e){alert(e)}},_getSVG:function(a){a=(typeof a=='string'?$(a)[0]:(a.jquery?a[0]:a));return $.data(a,p)},_destroySVG:function(a){var b=$(a);if(!b.hasClass(this.markerClassName)){return}b.removeClass(this.markerClassName);if(a.namespaceURI!=this.svgNS){b.empty()}$.removeData(a,p)},addExtension:function(a,b){this._extensions.push([a,b])}});function SVGWrapper(a,b){this._svg=a;this._container=b;for(var i=0;i<$.svg._extensions.length;i++){var c=$.svg._extensions[i];this[c[0]]=new c[1](this)}}$.extend(SVGWrapper.prototype,{_width:function(){return(this._container?this._container.clientWidth:this._svg.width)},_height:function(){return(this._container?this._container.clientHeight:this._svg.height)},root:function(){return this._svg},configure:function(a,b){if(b){for(var i=this._svg.attributes.length-1;i>=0;i--){var c=this._svg.attributes.item(i);if(!(c.nodeName=='onload'||c.nodeName=='version'||c.nodeName.substring(0,5)=='xmlns')){this._svg.attributes.removeNamedItem(c.nodeName)}}}for(var d in a){this._svg.setAttribute(d,a[d])}return this},getElementById:function(a){return this._svg.ownerDocument.getElementById(a)},change:function(a,b){if(a){for(var c in b){if(b[c]==null){a.removeAttribute(c)}else{a.setAttribute(c,b[c])}}}return this},_args:function(b,c,d){c.splice(0,0,'parent');c.splice(c.length,0,'settings');var e={};var f=0;if(b[0]!=null&&b[0].jquery){b[0]=b[0][0]}if(b[0]!=null&&!(typeof b[0]=='object'&&b[0].nodeName)){e['parent']=null;f=1}for(var i=0;i<b.length;i++){e[c[i+f]]=b[i]}if(d){$.each(d,function(i,a){if(typeof e[a]=='object'){e.settings=e[a];e[a]=null}})}return e},title:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'title',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},describe:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'desc',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},defs:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'defs',$.extend((d.id?{id:d.id}:{}),d.settings||{}))},symbol:function(a,b,c,d,e,f,g){var h=this._args(arguments,['id','x1','y1','width','height']);return this._makeNode(h.parent,'symbol',$.extend({id:h.id,viewBox:h.x1+' '+h.y1+' '+h.width+' '+h.height},h.settings||{}))},marker:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','refX','refY','mWidth','mHeight','orient'],['orient']);return this._makeNode(i.parent,'marker',$.extend({id:i.id,refX:i.refX,refY:i.refY,markerWidth:i.mWidth,markerHeight:i.mHeight,orient:i.orient||'auto'},i.settings||{}))},style:function(a,b,c){var d=this._args(arguments,['styles']);var e=this._makeNode(d.parent,'style',$.extend({type:'text/css'},d.settings||{}));e.appendChild(this._svg.ownerDocument.createTextNode(d.styles));if($.browser.opera){$('head').append('<style type="text/css">'+d.styles+'</style>')}return e},script:function(a,b,c,d){var e=this._args(arguments,['script','type'],['type']);var f=this._makeNode(e.parent,'script',$.extend({type:e.type||'text/javascript'},e.settings||{}));f.appendChild(this._svg.ownerDocument.createTextNode(this._escapeXML(e.script)));if(!$.browser.mozilla){$.globalEval(e.script)}return f},linearGradient:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','stops','x1','y1','x2','y2'],['x1']);var j=$.extend({id:i.id},(i.x1!=null?{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}:{}));return this._gradient(i.parent,'linearGradient',$.extend(j,i.settings||{}),i.stops)},radialGradient:function(a,b,c,d,e,r,f,g,h){var i=this._args(arguments,['id','stops','cx','cy','r','fx','fy'],['cx']);var j=$.extend({id:i.id},(i.cx!=null?{cx:i.cx,cy:i.cy,r:i.r,fx:i.fx,fy:i.fy}:{}));return this._gradient(i.parent,'radialGradient',$.extend(j,i.settings||{}),i.stops)},_gradient:function(a,b,c,d){var e=this._makeNode(a,b,c);for(var i=0;i<d.length;i++){var f=d[i];this._makeNode(e,'stop',$.extend({offset:f[0],stopColor:f[1]},(f[2]!=null?{stopOpacity:f[2]}:{})))}return e},pattern:function(a,b,x,y,c,d,e,f,g,h,i){var j=this._args(arguments,['id','x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var k=$.extend({id:j.id,x:j.x,y:j.y,width:j.width,height:j.height},(j.vx!=null?{viewBox:j.vx+' '+j.vy+' '+j.vwidth+' '+j.vheight}:{}));return this._makeNode(j.parent,'pattern',$.extend(k,j.settings||{}))},mask:function(a,b,x,y,c,d,e){var f=this._args(arguments,['id','x','y','width','height']);return this._makeNode(f.parent,'mask',$.extend({id:f.id,x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}))},createPath:function(){return new SVGPath()},createText:function(){return new SVGText()},svg:function(a,x,y,b,c,d,e,f,g,h){var i=this._args(arguments,['x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var j=$.extend({x:i.x,y:i.y,width:i.width,height:i.height},(i.vx!=null?{viewBox:i.vx+' '+i.vy+' '+i.vwidth+' '+i.vheight}:{}));return this._makeNode(i.parent,'svg',$.extend(j,i.settings||{}))},group:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'g',$.extend({id:d.id},d.settings||{}))},use:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);if(typeof f.x=='string'){f.ref=f.x;f.settings=f.y;f.x=f.y=f.width=f.height=null}var g=this._makeNode(f.parent,'use',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},link:function(a,b,c){var d=this._args(arguments,['ref']);var e=this._makeNode(d.parent,'a',d.settings);e.setAttributeNS($.svg.xlinkNS,'href',d.ref);return e},image:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);var g=this._makeNode(f.parent,'image',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},path:function(a,b,c){var d=this._args(arguments,['path']);return this._makeNode(d.parent,'path',$.extend({d:(d.path.path?d.path.path():d.path)},d.settings||{}))},rect:function(a,x,y,b,c,d,e,f){var g=this._args(arguments,['x','y','width','height','rx','ry'],['rx']);return this._makeNode(g.parent,'rect',$.extend({x:g.x,y:g.y,width:g.width,height:g.height},(g.rx?{rx:g.rx,ry:g.ry}:{}),g.settings||{}))},circle:function(a,b,c,r,d){var e=this._args(arguments,['cx','cy','r']);return this._makeNode(e.parent,'circle',$.extend({cx:e.cx,cy:e.cy,r:e.r},e.settings||{}))},ellipse:function(a,b,c,d,e,f){var g=this._args(arguments,['cx','cy','rx','ry']);return this._makeNode(g.parent,'ellipse',$.extend({cx:g.cx,cy:g.cy,rx:g.rx,ry:g.ry},g.settings||{}))},line:function(a,b,c,d,e,f){var g=this._args(arguments,['x1','y1','x2','y2']);return this._makeNode(g.parent,'line',$.extend({x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2},g.settings||{}))},polyline:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polyline',d.points,d.settings)},polygon:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polygon',d.points,d.settings)},_poly:function(a,b,c,d){var e='';for(var i=0;i<c.length;i++){e+=c[i].join()+' '}return this._makeNode(a,b,$.extend({points:$.trim(e)},d||{}))},text:function(a,x,y,b,c){var d=this._args(arguments,['x','y','value']);if(typeof d.x=='string'&&arguments.length<4){d.value=d.x;d.settings=d.y;d.x=d.y=null}return this._text(d.parent,'text',d.value,$.extend({x:(d.x&&isArray(d.x)?d.x.join(' '):d.x),y:(d.y&&isArray(d.y)?d.y.join(' '):d.y)},d.settings||{}))},textpath:function(a,b,c,d){var e=this._args(arguments,['path','value']);var f=this._text(e.parent,'textPath',e.value,e.settings||{});f.setAttributeNS($.svg.xlinkNS,'href',e.path);return f},_text:function(a,b,c,d){var e=this._makeNode(a,b,d);if(typeof c=='string'){e.appendChild(e.ownerDocument.createTextNode(c))}else{for(var i=0;i<c._parts.length;i++){var f=c._parts[i];if(f[0]=='tspan'){var g=this._makeNode(e,f[0],f[2]);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else if(f[0]=='tref'){var g=this._makeNode(e,f[0],f[2]);g.setAttributeNS($.svg.xlinkNS,'href',f[1]);e.appendChild(g)}else if(f[0]=='textpath'){var h=$.extend({},f[2]);h.href=null;var g=this._makeNode(e,f[0],h);g.setAttributeNS($.svg.xlinkNS,'href',f[2].href);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else{e.appendChild(e.ownerDocument.createTextNode(f[1]))}}}return e},other:function(a,b,c){var d=this._args(arguments,['name']);return this._makeNode(d.parent,d.name,d.settings||{})},_makeNode:function(a,b,c){a=a||this._svg;var d=this._svg.ownerDocument.createElementNS($.svg.svgNS,b);for(var b in c){var e=c[b];if(e!=null&&e!=null&&(typeof e!='string'||e!='')){d.setAttribute($.svg._attrNames[b]||b,e)}}a.appendChild(d);return d},add:function(b,c){var d=this._args((arguments.length==1?[null,b]:arguments),['node']);var f=this;d.parent=d.parent||this._svg;try{if($.svg._renesis){throw'Force traversal';}d.parent.appendChild(d.node.cloneNode(true))}catch(e){d.node=(d.node.jquery?d.node:$(d.node));d.node.each(function(){var a=f._cloneAsSVG(this);if(a){d.parent.appendChild(a)}})}return this},_cloneAsSVG:function(a){var b=null;if(a.nodeType==1){b=this._svg.ownerDocument.createElementNS($.svg.svgNS,this._checkName(a.nodeName));for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(c.nodeName!='xmlns'&&c.nodeValue){if(c.prefix=='xlink'){b.setAttributeNS($.svg.xlinkNS,c.localName,c.nodeValue)}else{b.setAttribute(this._checkName(c.nodeName),c.nodeValue)}}}for(var i=0;i<a.childNodes.length;i++){var d=this._cloneAsSVG(a.childNodes[i]);if(d){b.appendChild(d)}}}else if(a.nodeType==3){if($.trim(a.nodeValue)){b=this._svg.ownerDocument.createTextNode(a.nodeValue)}}else if(a.nodeType==4){if($.trim(a.nodeValue)){try{b=this._svg.ownerDocument.createCDATASection(a.nodeValue)}catch(e){b=this._svg.ownerDocument.createTextNode(a.nodeValue.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'))}}}return b},_checkName:function(a){a=(a.substring(0,1)>='A'&&a.substring(0,1)<='Z'?a.toLowerCase():a);return(a.substring(0,4)=='svg:'?a.substring(4):a)},load:function(h,j){j=(typeof j=='boolean'?{addTo:j}:(typeof j=='function'?{onLoad:j}:j||{}));if(!j.addTo){this.clear(false)}var k=[this._svg.getAttribute('width'),this._svg.getAttribute('height')];var l=this;var m=function(a){a=$.svg.local.errorLoadingText+': '+a;if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l,a])}else{l.text(null,10,20,a)}};var n=function(a){var b=new ActiveXObject('Microsoft.XMLDOM');b.validateOnParse=false;b.resolveExternals=false;b.async=false;b.loadXML(a);if(b.parseError.errorCode!=0){m(b.parseError.reason);return null}return b};var o=function(a){if(!a){return}if(a.documentElement.nodeName!='svg'){var b=a.getElementsByTagName('parsererror');var c=(b.length?b[0].getElementsByTagName('div'):[]);m(!b.length?'???':(c.length?c[0]:b[0]).firstChild.nodeValue);return}var d={};for(var i=0;i<a.documentElement.attributes.length;i++){var f=a.documentElement.attributes.item(i);if(!(f.nodeName=='version'||f.nodeName.substring(0,5)=='xmlns')){d[f.nodeName]=f.nodeValue}}l.configure(d,true);var g=a.documentElement.childNodes;for(var i=0;i<g.length;i++){try{if($.svg._renesis){throw'Force traversal';}l._svg.appendChild(g[i].cloneNode(true));if(g[i].nodeName=='script'){$.globalEval(g[i].textContent)}}catch(e){l.add(null,g[i])}}if(!j.changeSize){l.configure({width:k[0],height:k[1]})}if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l])}};if(h.match('<svg')){o($.browser.msie?n(h):new DOMParser().parseFromString(h,'text/xml'))}else{$.ajax({url:h,dataType:($.browser.msie?'text':'xml'),success:function(a){o($.browser.msie?n(a):a)},error:function(a,b,c){m(b+(c?' '+c.message:''))}})}return this},remove:function(a){a=(a.jquery?a[0]:a);a.parentNode.removeChild(a);return this},clear:function(a){if(a){this.configure({},true)}while(this._svg.firstChild){this._svg.removeChild(this._svg.firstChild)}return this},toSVG:function(a){a=a||this._svg;return(typeof XMLSerializer=='undefined'?this._toSVG(a):new XMLSerializer().serializeToString(a))},_toSVG:function(a){var b='';if(!a){return b}if(a.nodeType==3){b=a.nodeValue}else if(a.nodeType==4){b='<![CDATA['+a.nodeValue+']]>'}else{b='<'+a.nodeName;if(a.attributes){for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(!($.trim(c.nodeValue)==''||c.nodeValue.match(/^\[object/)||c.nodeValue.match(/^function/))){b+=' '+(c.namespaceURI==$.svg.xlinkNS?'xlink:':'')+c.nodeName+'="'+c.nodeValue+'"'}}}if(a.firstChild){b+='>';var d=a.firstChild;while(d){b+=this._toSVG(d);d=d.nextSibling}b+='</'+a.nodeName+'>'}else{b+='/>'}}return b},_escapeXML:function(a){a=a.replace(/&/g,'&amp;');a=a.replace(/</g,'&lt;');a=a.replace(/>/g,'&gt;');return a}});function SVGPath(){this._path=''}$.extend(SVGPath.prototype,{reset:function(){this._path='';return this},move:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'m':'M'),x,y)},line:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'l':'L'),x,y)},horiz:function(x,a){this._path+=(a?'h':'H')+(isArray(x)?x.join(' '):x);return this},vert:function(y,a){this._path+=(a?'v':'V')+(isArray(y)?y.join(' '):y);return this},curveC:function(a,b,c,d,x,y,e){e=(isArray(a)?b:e);return this._coords((e?'c':'C'),a,b,c,d,x,y)},smoothC:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'s':'S'),a,b,x,y)},curveQ:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'q':'Q'),a,b,x,y)},smoothQ:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'t':'T'),x,y)},_coords:function(a,b,c,d,e,f,g){if(isArray(b)){for(var i=0;i<b.length;i++){var h=b[i];this._path+=(i==0?a:' ')+h[0]+','+h[1]+(h.length<4?'':' '+h[2]+','+h[3]+(h.length<6?'':' '+h[4]+','+h[5]))}}else{this._path+=a+b+','+c+(d==null?'':' '+d+','+e+(f==null?'':' '+f+','+g))}return this},arc:function(a,b,c,d,e,x,y,f){f=(isArray(a)?b:f);this._path+=(f?'a':'A');if(isArray(a)){for(var i=0;i<a.length;i++){var g=a[i];this._path+=(i==0?'':' ')+g[0]+','+g[1]+' '+g[2]+' '+(g[3]?'1':'0')+','+(g[4]?'1':'0')+' '+g[5]+','+g[6]}}else{this._path+=a+','+b+' '+c+' '+(d?'1':'0')+','+(e?'1':'0')+' '+x+','+y}return this},close:function(){this._path+='z';return this},path:function(){return this._path}});SVGPath.prototype.moveTo=SVGPath.prototype.move;SVGPath.prototype.lineTo=SVGPath.prototype.line;SVGPath.prototype.horizTo=SVGPath.prototype.horiz;SVGPath.prototype.vertTo=SVGPath.prototype.vert;SVGPath.prototype.curveCTo=SVGPath.prototype.curveC;SVGPath.prototype.smoothCTo=SVGPath.prototype.smoothC;SVGPath.prototype.curveQTo=SVGPath.prototype.curveQ;SVGPath.prototype.smoothQTo=SVGPath.prototype.smoothQ;SVGPath.prototype.arcTo=SVGPath.prototype.arc;function SVGText(){this._parts=[]}$.extend(SVGText.prototype,{reset:function(){this._parts=[];return this},string:function(a){this._parts[this._parts.length]=['text',a];return this},span:function(a,b){this._parts[this._parts.length]=['tspan',a,b];return this},ref:function(a,b){this._parts[this._parts.length]=['tref',a,b];return this},path:function(a,b,c){this._parts[this._parts.length]=['textpath',b,$.extend({href:a},c||{})];return this}});$.fn.svg=function(a){var b=Array.prototype.slice.call(arguments,1);if(typeof a=='string'&&a=='get'){return $.svg['_'+a+'SVG'].apply($.svg,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){$.svg['_'+a+'SVG'].apply($.svg,[this].concat(b))}else{$.svg._attachSVG(this,a||{})}})};function isArray(a){return(a&&a.constructor==Array)}$.svg=new SVGManager()})(jQuery);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/widget.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//** * WAF widget global class * * @module  widget * * @class   WAF.Widget * @extends Object * * @author  The Wakanda Team * @date    august 2010 * @version 0.1 * *//** * WAF Widget * @namespace WAF * @class Widget **/WAF.Widget = function Widget () {    var outWidget = null;    outWidget = (typeof this === 'undefined') ? new WAF.Widget() : this;    return outWidget;};/** * Generate an Id * @method _generateId * @return {string} */WAF.Widget._generateId = function _generate_id(type) {    var    id,    type;    type    = type || '';    id      = type + '' + Math.floor(Math.random()*100*100*99);    if ($$(id)) {        id = WAF.Widget._generateId();    }    return id;};/** * PUBLIC METHODS *//* * * @namespace WAF.Widget * @method redraw */WAF.Widget.prototype.redraw = function redraw () {    throw new Error('method not yet implemented');};/* * * @namespace WAF.Widget * @method render */WAF.Widget.prototype.render = function render (node) {    throw new Error('method not yet implemented');};/* * * @namespace WAF.Widget * @method move * @param {String} left left postion (in px) * @param {String} top top postion (in px) */WAF.Widget.prototype.move = function move (left, top) {    this.setLeft(left);    this.setTop(top);};/** * Check if a widget is visible * @namespace WAF.Widget * @method isVisible */WAF.Widget.prototype.isVisible = function is_visible (  ) {    this._isVisible = this.$domNode.css('visibility') == 'hidden' || this.$domNode.css('display') == 'none' ? false : true;    return this._isVisible;}/* * Shox/Hide a widget * @namespace WAF.Widget * @method show */WAF.Widget.prototype.toggle = function toggle ( type ) {    if (!this.isVisible()) {        this.show();    } else {        this.hide(type);    }};/* * Show a widget * @namespace WAF.Widget * @method show */WAF.Widget.prototype.show = function show () {    var labels = $('[for = ' + this.id + ']');    if (this._hideType == 'visibility') {        if (labels.length > 0) {            $(labels[0]).css('visibility', 'visible');        }        this.$domNode.css('visibility', 'visible');        /*         * Display forced hidden children         */        $.each(this.$domNode.find('*'), function(){            var            that;            that = $(this);            if (that.data('hasBeenHidden')) {                that.css('visibility', 'visible');            }        });    } else {        if (labels.length > 0) {            $(labels[0]).show();        }        this.$domNode.show();    }    this._isVisible = true;};/* * Hide a widget * @namespace WAF.Widget * @method hide */WAF.Widget.prototype.hide = function hide ( type ) {    var labels = $('[for = ' + this.id + ']');    if (type && type == 'visibility') {        this._hideType = 'visibility';        if (labels.length > 0) {            $(labels[0]).css('visibility', 'hidden');        }        this.$domNode.css('visibility', 'hidden');        /*         * Force visibility hidden on visible children         */        $.each(this.$domNode.find('*'), function(){            var            that;            that = $(this);            if (this.style.visibility == 'visible') {                that                .css('visibility', 'hidden')                .data('hasBeenHidden', true);            }        });    } else {        this._hideType = 'display';        if (labels.length > 0) {            $(labels[0]).hide();        }        this.$domNode.hide();    }    this._isVisible = false;};/* * * @namespace WAF.Widget * @method destroy */WAF.Widget.prototype.destroy = function destroy () {    var childrens = this.getChildren(),    length = childrens.length,    i = 0,    children = null;    for (i = 0; i < length; i++) {        children = childrens[i];        if (children.id) {            delete WAF.widgets[children.id];        }    }    delete WAF.widgets[this.id]    this.$domNode.remove();};/* * * @namespace WAF.Widget * @method addListener * @param {String} event event name * @param {Function} callback callback * @param {JSON} options options * */WAF.Widget.prototype.addListener = function addListener (event, callback, options) {    if (typeof options === 'undefined') {        this.$domNode.bind(event, callback);    } else {        this.$domNode.bind(event, options, callback);    }};/* * * @namespace WAF.Widget * @method removeListener * @param {String} event event name * @param {Function} callback callback */WAF.Widget.prototype.removeListener = function removeListener (event, callback) {    if (typeof callback === 'undefined') {        this.$domNode.unbind(event);    } else {        this.$domNode.unbind(event, callback);    }};/* * * @namespace WAF.Widget * @method setTabIndex * @param {String} index */WAF.Widget.prototype.setTabIndex = function setTabIndex (index) {    throw new Error('method not yet implemented');};/* * * @namespace WAF.Widget * @method setTabIndex * @param {String} index */WAF.Widget.prototype.setTabIndex = function getTabIndex () {    throw new Error('method not yet implemented');};/* * * @namespace WAF.Widget * @method focus * @param {boolean} active : add/remove focus on the widget */WAF.Widget.prototype.focus = function focus (active) {    var    htmlObject;    htmlObject = this.$domNode;    active = active || true;    if (active) {        htmlObject.focus();        htmlObject.addClass("waf-state-focus");    } else {        htmlObject.blur();        htmlObject.removeClass("waf-state-focus");    }};/* * * @namespace WAF.Widget * @method hasFocus */WAF.Widget.prototype.hasFocus = function hasFocus () {    return this.$domNode.is(':focus');};/* * * @namespace WAF.Widget * @method setTextColor * @param {String} color color of the background */WAF.Widget.prototype.setTextColor = function setTextColor (color) {    switch (this.kind) {        case 'dataGrid':            $('#' + this.renderId).css('color', color);            break;        default:            this.$domNode.css('color', color);            break;    }};/* * * @namespace WAF.Widget * @method setBackgroundColor * @param {String} color color of the background */WAF.Widget.prototype.setBackgroundColor = function setBackgroundColor (color) {    switch (this.kind) {        case 'dataGrid':            $('#' + this.renderId + ' .waf-dataGrid-body').css('background-color', color);            break;        default:            this.$domNode.css('background-color', color);            break;    }};/* * Called when the widget is resized * @namespace WAF.Widget * @method _callResizeEvents */WAF.Widget.prototype._callResizeEvents = function resize (type) {    var that = null,    events = null,    htmlObject = null;    that        = this;    events      = WAF.events[that.id];    htmlObject  = $(that.containerNode);    type        = type || 'on';    $(that).trigger('widgetResize', [type]);    /*     * Execute custom method     */    switch(type) {        case 'on':            if (that.onResize) {                that.onResize();            }            break;        case 'start':            if (that.startResize) {                that.startResize();            }            break;        case 'stop':            if (that.stopResize) {                that.stopResize();            }            break;    }    /*     * Execute resize event     */    if (events) {        $.each(WAF.events[that.id], function () {            if (                ( this.name == 'onResize'    && type == 'on' )                ||  ( this.name == 'startResize' && type == 'start' )                ||  ( this.name == 'stopResize'  && type == 'stop' ) ) {                this.fn();            }        });    }    $.each(htmlObject.children(), function() {        var        child,        childWidget,        checkResize;        child       = $(this);        childWidget = $$(child.prop('id'));        if (childWidget && childWidget._checkResize) {            /*             * Check if the children is resizable (depending on constraints)             */            checkResize = childWidget._checkResize();            if (childWidget && (checkResize.x == true || checkResize.y == true) && childWidget._callResizeEvents) {                childWidget._callResizeEvents(type);            }        }    });};/* * Enable resize * @namespace WAF.Widget * @method resizable * @param {boolean} active : add/remove resizable on the widget */WAF.Widget.prototype.resizable = function (active) {    var    that,    htmlObject;    htmlObject  = '';    that        = this;    active      = typeof(active) != 'undefined' ? active : true;    htmlObject  = $(this.containerNode);    if (active && this._callResizeEvents) {        htmlObject.resizable({            start : function(e) {                that._callResizeEvents('start');            },            resize : function(e) {                that._callResizeEvents('on');            },            stop : function(e) {                that._callResizeEvents('stop');            }        });    } else {        htmlObject.resizable('destroy');    }}/* * Enable draggable * @namespace WAF.Widget * @method draggable * @param {boolean} active : add/remove draggable on the widget */WAF.Widget.prototype.draggable = function draggable (active) {    var    htmlObject;    htmlObject  = null;    active      = typeof(active) != 'undefined' ? active : true;    htmlObject  = $(this.containerNode);    if (this.kind != 'autoForm' && this.kind != 'queryForm') {        htmlObject.css('cursor', 'pointer');    }    if (active) {        htmlObject.draggable({            start : function (event, ui){                this._zindexBeforeDrag = $(this).css('zIndex');            },            stop : function (event, ui){                $(this).css('zIndex', this._zindexBeforeDrag);            },            cancel  : '.waf-widget-body',            stack   : '.waf-widget',            zIndex  : 99999        });    } else {        htmlObject.draggable('destroy');    }}/** * Return the value with its format applyed * @namespace WAF.Widget * @method getFormattedValue * @param {String} value * @return {String} * @private **/WAF.Widget.prototype.getFormattedValue = function getFormattedValue (value, encode) {    var test = '',    result = '';    if (value === undefined) {        if (this.sourceAtt == null) {            if (this.att != null && this.source.getAttribute(this.att.name)){                value = this.source.getAttribute(this.att.name).getValue();            }        } else {            value = this.sourceAtt.getValue();        }    }    /*     * Format widget value depending on attribute format     */    if (this.sourceAtt && this.format && !this.format.format) {        this.format = this.sourceAtt.dataClassAtt.defaultFormat;    }    if (typeof (value) == 'number') {        result = WAF.utils.formatNumber(value, this.format);    } else if (this.att && this.att.type == 'date') {        result = WAF.utils.formatDate(value,this.format);    } else if (this.att && this.att.type == 'image') {        if (value) {            if (value.__deferred) {                value = value.__deferred.uri;            } else {                value = value[0].__deferred[0].uri;            }        } else {            value = '';        }        result = value;    } else if (typeof (value) == 'string') {        result = WAF.utils.formatString(value, this.format);        if (this.kind === 'textField') {        //result = value;        } else{            if (encode != false) {                result = htmlEncode(result, true, 4);            }        /*else {                result = value;            }*/        }    } else {        if (value == null){            result = '';        } else{            result = String(value);        }    }    return result;}/** * Get the current theme of the widget * @namespace WAF.Widget * @method getTheme * @return {String} **/WAF.Widget.prototype.getTheme = function() {    var i = 0,    theme = null,    themes = null,    classes = null,    htmlObject = null;    htmlObject  = $(this.containerNode);    themes      = [];    classes = htmlObject.prop('class');    for (i in WAF.widget.themes) {        theme = WAF.widget.themes[i].key;        if (classes.match(theme)) {            themes.push(theme);        }    }    return themes.join(' ');}/** * Set the current theme of the widget * @namespace WAF.Widget * @method addClass * @return {String} **/WAF.Widget.prototype.addClass = function(theme) {    this.$domNode.addClass(theme);}/** * Set the current theme of the widget * @namespace WAF.Widget * @method removeClass * @return {String} **/WAF.Widget.prototype.removeClass = function(theme) {    this.$domNode.removeClass(theme);}/** * et the value showned by the widget, if any * @namespace WAF.Widget * @method getValue * @return {String} **/WAF.Widget.prototype.getValue = function () {    var value = '',    kind = this.kind;    switch (kind) {        case 'combobox':            value = $('#' + this.id + ' select').val();            break;        case 'richText':            value = this.$domNode.text();            break;        case 'checkbox':            if (this.$domNode.hasClass('waf-state-selected')) {                value = 'checked';            }            break;        case 'radioGroup':            value = $('#' + this.id + ' .waf-state-selected input').val();            break;        case 'label':            value = this.$domNode.text();            break;        default:            value = this.$domNode.val();            break;    }    return value;}/** * Set the value to a widget * @namespace WAF.Widget * @method setValue * @return {String} **/WAF.Widget.prototype.setValue = function (value) {    var kind = this.kind,    noChange = false;    if (!this.isDisabled()) {        switch (kind) {            case 'combobox':                $('#' + this.id + ' select').combobox('setValue' , value);                break;            case 'richText':                this.$domNode.text(value);                break;            case 'checkbox':                if (value == 'checked') {                    this.$domNode.addClass('waf-state-selected');                } else {                    this.$domNode.removeClass('waf-state-selected');                }                break;            case 'radioGroup':                var radio = $('#' + this.id + ' [value="' + value + '"]');                this.$domNode.find('input[type=radio]:checked').attr('checked', false);                // in case we try to check an unknown radio value we simply do nothing                if (radio.length) {                    radio.prop('checked', 'checked');                    this.$domNode.find('.waf-radio').removeClass('waf-state-selected');                    // if $$('radioGroup').setValue() is called on documentLoad, the html isn't ready yet                    // so the <li> gets the class added instead of the parent <div> (which is added later in the widget creation                    // This later breaks setValue()                    if (radio.parent().is('div')) {                        radio.parent().addClass('waf-state-selected');                    }                    this._value = value;                } else {                    noChange = true;                }                break;            case 'slider':                this.$domNode.slider('value', value);                break;            case 'label':                this.$domNode.text(value);                break;            default:                this.$domNode.val(value);                break;        }    } else {        // prevent change event from being triggered if the widget is disabled        noChange = true;    }    /*     * Trigger change event     */    if (noChange === false) {        this.$domNode.trigger('change');    }}/* * Check if a widget is resizable depending on its position constraints * @namespace WAF.Widget * @method checkResize * @return {object} */WAF.Widget.prototype._checkResize = function checkResize() {    var result = '',    htmlObject = '';    htmlObject  = $(this.containerNode);    result      = {};    if (htmlObject.attr('data-constraint-right') == 'true' && htmlObject.attr('data-constraint-left') == 'true') {        result.x = true;    }    if (htmlObject.attr('data-constraint-top') == 'true' && htmlObject.attr('data-constraint-bottom') == 'true') {        result.y = true;    }    return result;}/* * Get the error div of the widget * @namespace WAF.Widget * @method getErrorDiv * @return {JQueryObj} */WAF.Widget.prototype.getErrorDiv = function() {    var div = this.errorDiv;    if (typeof div === 'string') {        if (div == '') {            div = null;        } else {            div = $('#' + div);        }    }    return div;}/* * Set the error div of the widget * @namespace WAF.Widget * @method setErrorDiv * @param {string} */WAF.Widget.prototype.setErrorDiv = function (div) {    if (typeof div === 'string') {        if (div == '') {            div = null;        } else {            div = $('#' + div);        }    }    this.errorDiv = div;}/* * @namespace WAF.Widget * @method setLabelText * @result {Widget.widget.Label} Label */WAF.Widget.prototype.setLabelText = function (value) {    if (this.kind == 'button') {        this.$domNode.text(value);    } else {        var labels = $('[for = ' + this.id + ']');        if (labels.length > 0) {            $(labels[0]).text(value);        }    }}/* * @namespace WAF.Widget * @method setLabelTextColor * @result {Widget.widget.Label} Label */WAF.Widget.prototype.setLabelTextColor = function (value) {    var labels = $('[for = ' + this.id + ']');    if (labels.length > 0) {        $(labels[0]).css('color', value);    }}/* * @namespace WAF.Widget * @method getLinks * @result {Array} List of linked widgets */WAF.Widget.prototype.getLinks = function () {    var    i,    attr,    widget,    widgets,    linkedTags,    linkedTagsLength;    attr = this.$domNode.attr('data-linked-tag');    if (attr) {        linkedTags          = attr.split(',');        widgets             = [];        linkedTagsLength    = linkedTags.length;        for (i = 0; i < linkedTagsLength; i += 1) {            widget = $$(linkedTags[i]);            if (widget) {                widgets.push($$(linkedTags[i]));            }        }    }    return widgets;}/** * link a widget with an other one * @namespace WAF.Widget * @method link * @param {object} widget : widget to link with */WAF.Widget.prototype.link = function (widget) {    var    attr,    value;    attr = this.$domNode.attr('data-linked-tag');    value = attr ? attr + ',' + widget.id : widget.id;    this.$domNode.attr('data-linked-tag', value);}/** * unlink a widget from an other one * @namespace WAF.Widget * @method unlink * @param {object} widget : widget to link with */WAF.Widget.prototype.unlink = function (widget) {    var    i,    list,    attr,    value,    newList,    listLength;    newList     = [];    attr        = this.$domNode.attr('data-linked-tag');    list        = attr.split(',');    listLength  = list.length;    for (i = 0; i < listLength; i += 1) {        if (list[i] != widget.id) {            newList.push(list[i]);        }    }    this.$domNode.attr('data-linked-tag', newList.join(','));}/** * Set the width of the widget * @namespace WAF.Widget * @method setWidth * @param {number} value : width value */WAF.Widget.prototype.setWidth = function (value) {    /*     * Set dom node width     */    this.$domNode.width(value);    /*     * Call resize function     */    if (this._callResizeEvents) {        this._callResizeEvents('stop');    }}/** * Set the height of the widget * @namespace WAF.Widget * @method setHeight * @param {number} value : height value */WAF.Widget.prototype.setHeight = function (value) {    /*     * Set dom node height     */    this.$domNode.height(value);    /*     * Call resize function     */    if (this._callResizeEvents) {        this._callResizeEvents('stop');    }}/** * Set the height and the height of the widget * @namespace WAF.Widget * @method resize * @param {number} width * @param {number} height */WAF.Widget.prototype.resize = function (width, height) {    /*     * Set dom node width     */    this.$domNode.width(width);    /*     * Set dom node height     */    this.$domNode.height(height);    /*     * Call resize function     */    if (this._callResizeEvents) {        this._callResizeEvents('stop');    }}/** * Get the width of the widget * @namespace WAF.Widget * @method getWidth * @return {number} width value */WAF.Widget.prototype.getWidth = function (includeMargin) {    if (includeMargin === true) {        return this.$domNode.outerWidth(true);    } else {        return this.$domNode.outerWidth();    }}/** * Get the height of the widget * @namespace WAF.Widget * @method getHeight * @return {number} height value */WAF.Widget.prototype.getHeight = function () {    return this.$domNode.outerHeight();}/** * Get the position info * @namespace WAF.Widget * @method getPosition * @return {object} left, top, bottom, right */WAF.Widget.prototype.getPosition = function () {    var left = this.$domNode.css('left'),    top = this.$domNode.css('top'),    bottom = this.$domNode.css('bottom'),    right = this.$domNode.css('right');    if (left === 'auto') {        left = this.$domNode.offset().left;    }    if (top === 'auto') {        top = this.$domNode.offset().top;    }    if (bottom === 'auto') {        bottom = $(window).height() - this.$domNode.offset().top - this.$domNode.outerHeight(false);    }    if (right === 'auto') {        right = $(window).width() - this.$domNode.offset().left - this.$domNode.outerWidth(false);    }    return {        left    : parseInt(left, 10),        top     : parseInt(top, 10),        bottom  : parseInt(bottom, 10),        right   : parseInt(right, 10)    }}/** * Set a widget parent to another widget * @method setParent * @param {object} widget : widget to define as parent */WAF.Widget.prototype.setParent = function setParent (widget) {    if (widget) {        this.$domNode.appendTo(widget.$domNode);    }};/** * Add a child widget to another widget * @method addChild * @param {object} widget : widget to define as child */WAF.Widget.prototype.addChild = function setParent (widget) {    if (widget) {        widget.$domNode.appendTo(this.$domNode);    }};/** * Add children widgets to another widget * @method addChildren */WAF.Widget.prototype.addChildren = function setParent () {    var    i,    widget,    argumentsLength;    argumentsLength = arguments.length;    if (argumentsLength > 0) {        for (i = 0; i < argumentsLength; i += 1) {            widget = arguments[i];            if (widget) {                widget.$domNode.appendTo(this.$domNode);            }        }    }};/** * Move a widget to indicated position * @method _moveTo * @param {string} type : type of the position (left, top, right, bottom) * @param {number} pos : position * @param {boolean} moveLabel : true to also move label */WAF.Widget.prototype._moveTo = function move_to (type, pos, moveLabel) {    var    diff,    label,    newPos,    oldPos,    labelHtml;    pos = pos == 'auto' ? pos : pos || pos == 0 ? parseInt(pos) + 'px' : 'auto';    oldPos = type == 'left' || type == 'right' ? this.$domNode.offset().left : this.$domNode.offset().top;    if (pos != 'auto') {        switch(type) {            case 'left':                this.setRight('auto', false);                break;            case 'top':                this.setBottom('auto', false);                break;            case 'bottom':                this.setTop('auto', false);                break;            case 'right':                this.setLeft('auto', false);                break;        }    }    this.$domNode.css(type, pos);    /*     * Also move label if exists     */    if (this.label && moveLabel !== false) {        labelHtml   = $(this.label);        label       = $$(labelHtml.prop('id'));        if ( type == 'left' || type == 'right' ) {            newPos = this.$domNode.offset().left;            diff =  newPos - oldPos;            label.setLeft(label.$domNode.offset().left + diff);        } else {            newPos = this.$domNode.offset().top;            diff =  newPos - oldPos;            label.setTop(label.$domNode.offset().top + diff);        }    }}/** * Set the left position of a widget * @method setLeft * @param {number} pos : position * @param {boolean} moveLabel : true to also move label */WAF.Widget.prototype.setLeft = function setLeft (pos, moveLabel) {    this._moveTo('left', pos, moveLabel);};/** * Set the top position of a widget * @method setTop * @param {number} pos : position * @param {boolean} moveLabel : true to also move label */WAF.Widget.prototype.setTop = function setTop (pos, moveLabel) {    this._moveTo('top', pos, moveLabel);};/** * Set the bottom position of a widget * @method setBottom * @param {number} pos : position * @param {boolean} moveLabel : true to also move label */WAF.Widget.prototype.setBottom = function setBottom (pos, moveLabel) {    this._moveTo('bottom', pos, moveLabel);};/** * Get the current state * @function getState * @return {string} */WAF.Widget.prototype.getState = function getState () {    if (!this._currentState) {        this._currentState = 'default';    }    return this._currentState;};/** * Set the state of a widget * @method setState * @param {string} value : state value */WAF.Widget.prototype.setState = function setState (value) {    var    label,    nState,    htmlObject;    label = this.getLabel();    value = value || 'default';    if (!this._disabled) {        htmlObject = this.$domNode;        htmlObject.addClass('waf-state-' + value);        if (value == 'hover') {            htmlObject.removeClass('waf-state-active');            htmlObject.removeClass('waf-state-default');        }        if (value == 'active') {            htmlObject.removeClass('waf-state-hover');            htmlObject.removeClass('waf-state-default');        }        if (value == 'focus') {            htmlObject.removeClass('waf-state-hover');            htmlObject.removeClass('waf-state-default');        }        if (value == 'default') {            htmlObject.removeClass('waf-state-hover');            htmlObject.removeClass('waf-state-active');            htmlObject.removeClass('waf-state-focus');            htmlObject.removeClass('waf-state-disabled');            this._tmpState = nState;        }        if (value == 'state2') {            htmlObject.removeClass('waf-state-state3');        }        if (value == 'state3') {            htmlObject.removeClass('waf-state-state2');        }        if (value == 'state1') {            htmlObject.removeClass('waf-state-state2');            htmlObject.removeClass('waf-state-state3');            htmlObject.removeClass('waf-state-state4');            this._tmpState = value;        }    }    if (label) {        label.setState(value);    }    this._currentState = value;};/** * Remove a state on a widget * @method removeState * @param {string} value : state value */WAF.Widget.prototype.removeState = function removeState (value) {    this.$domNode.removeClass('waf-state-' + value);    if (this._currentState == value) {        this._currentState = null;    }}/** * Set the right position of a widget * @method setRight * @param {number} pos : position * @param {boolean} moveLabel : true to also move label */WAF.Widget.prototype.setRight = function setRight (pos, moveLabel) {    this._moveTo('right', pos, moveLabel);};/** * Check if a widget is disabled or not * @function isDisabled * @return {boolean} */WAF.Widget.prototype.isDisabled = function isDisabled () {    var    result;    result = false;    if (this.$domNode.hasClass('waf-state-disabled') || this._disabled) {        result = true;    }    return result;}/** * Disable the widget * @method disable */WAF.Widget.prototype.disable = function disable () {    var    i,    evt,    label,    child,    children,    tmpEvents,    childrenLength;    /*     * To prevent dbl disable     */    if (this.isDisabled()) {        return;    }    this._disabled  = true;    label           = this.getLabel();    /*     * Add disable class & disabled attribute     */    this.$domNode    .addClass('waf-state-disabled')    .prop('disabled', 'disabled');    /*     * Disable widget's events     */    this._tmpEvents = [];    tmpEvents       = this.$domNode.data('events');    for (i in tmpEvents) {        evts = tmpEvents[i];        for (var j = 0; j < evts.length; j += 1) {            this._tmpEvents.push(evts[j]);        }        this.$domNode.off(i);    }    /*     * Also disable children     */    children        = this.getChildren();    childrenLength  = children.length;    for (i = 0; i < childrenLength; i += 1) {        child = children[i];        child.disable();    }    /*     * Also disable label     */    if (label) {        label.disable();    }};/** * Enable the widget * @method enable */WAF.Widget.prototype.enable = function enable () {    var    i,    evt,    label,    child,    children,    tmpEvents,    childrenLength;    /*     * To prevent dbl enable     */    if (!this.isDisabled()) {        return;    }    this._disabled  = false;    label           = this.getLabel();    /*     * Remove disable class & disabled attribute     */    this.$domNode    .removeClass('waf-state-disabled')    .removeProp('disabled');    /*     * Enable widget's events     */    for (i = 0; i < this._tmpEvents.length; i += 1) {        evt = this._tmpEvents[i];        this.$domNode.on(evt.type, evt.handler);    }    /*     * Also enable children     */    children        = this.getChildren();    childrenLength  = children.length;    for (i = 0; i < childrenLength; i += 1) {        child = children[i];        child.enable();    }    /*     * Also enable label     */    if (label) {        label.enable();    }};/** * Initialize the widget * @namespace WAF.Widget * @method init * @param {Object} inClassName inConfiguration of the widget * @param {Object} inConfig inConfiguration of the widget **/WAF.Widget.prototype.init = function init (inClassName, inConfig) {    var    itemName,    item,    binding,    bindingInfo,    id,    i,    widget,    resizeWidgets,    resizableWidgets;    itemName            = '';    item                = '';    binding             = '';    bindingInfo         = '';    id                  = '';    widget              = '';    resizeWidgets       = '';    resizableWidgets    = '';    if (typeof inConfig === 'undefined') {        throw new Error('inConfig not defined');    }    function getUuidlet () {        return (((1+Math.random())*0x10000)|0).toString(16).substring(1);    }    /**     * The id of the widget     * @namespace WAF.Widget     * @property id     * @type String     **/    if ('id' in inConfig) {        this.id = inConfig.id;    } else {        this.id = inClassName.toLowerCase() + '-' + getUuidlet() + '-' + getUuidlet() + '-' + getUuidlet() + '-' + getUuidlet() + getUuidlet() + getUuidlet();    }    /**     * The kind of the widget     *     * @property kind     * @type String     * @default googleMap     **/    if ('data-type' in inConfig) {        this.kind = inConfig['data-type'];    } else {        this.kind = inClassName.substr(0, 1).toLowerCase() + inClassName.substr(1);    }    /**     * The divID of the widget (by default the same as the id property)     *     * @property divID     * @type String     * @deprecated already defined by the id property     **/    this.divID = ('divID' in inConfig) ? inConfig.divID : this.id;    /**     * The renderId of the widget (by default the same as the id property)     *     * @property renderId     * @type String     **/    this.renderId = ('renderId' in inConfig) ? inConfig.renderId : this.id;    /**     * Config as widget property to be used by the matrix     *     * @property config     * @type Object     **/    this.config = inConfig;    /**     * The reference of the DOM node Element of the widget     *     * @property containerNode     * @type HTMLElement     **/    this.containerNode = document.getElementById(this.id);    /**     *     *     * @property domNode     * @type Object     **/    this.domNode = document.getElementById(this.id);    /**     *     *     * @property $domNode     * @type Object     **/    this.$domNode = $(document.getElementById(this.id));    if (this.containerNode === null) {        if ('div, span, img'.indexOf(inConfig.tagName) != -1) {            throw new Error('Bad tagName in config !');        }        this.containerNode = document.createElement('div');    }    /**     * The reference of the DOM node Element of the widget     * @namespace WAF.Widget     * @property ref     * @type HTMLElement     * @todo Should be replaced by the <code>containerNode</code> property     **/    this.ref = this.containerNode;    /**     * The label widget of the current widget     *     * @property ref     * @type WAF.widget.Label     **/    this.label = null;    // on design    for (itemName in WAF.widgets) {        if (WAF.widgets.hasOwnProperty(itemName)) {            item = WAF.widgets[itemName];            if (item.type === 'label' && item.ref['for'] === this.id) {                this.label = item;                break;            }        }    }    // on runtime    if (typeof Designer === 'undefined') {        var labels = $('label');        for (i = 0; i < labels.length; i++) {            if (labels[i].getAttribute('for') == this.id) {                this.label = labels[i];                break;            }        }    }    /**     * @property errorDiv     */    this.errorDiv = null;    // retro compatibility    if (typeof inConfig['data-error-div'] !== 'undefined') {        if (inConfig['data-error-div'] != null && typeof inConfig['data-errorDiv'] === 'undefined') {            inConfig['data-errorDiv'] = inConfig['data-error-div'];        }    }    /**    * The id of the container for error information    *    * @property errorDiv    * @type String|undefined    **/    this.errorDiv = inConfig['data-errorDiv'];    /**     * Clear the error message from the associated error display widget     *     * @method clearErrorMessage     **/    this.clearErrorMessage = function(){        var errorobj = this.errorDiv !== '' ? document.getElementById(this.errorDiv) : null; // To prevent warning        if (this.errorDiv && typeof this.errorDiv == "object") {            errorobj = this.errorDiv[0];        }        this.$domNode.removeClass("AF_InputError");        this.$domNode.addClass("AF_InputOK");        /*         * Do not execute bt methods on mobile         */        if (WAF.PLATFORM.modulesString !== 'mobile') {            this.$domNode.bt();        }        if (errorobj != null) {            $(errorobj).removeClass("AF_ErrorMessageWrong");            $(errorobj).addClass("AF_ErrorMessage");            $(errorobj).html("");        }    }    /**     * Display an error message from the associated error display widget     * @namespace WAF.Widget     * @method setErrorMessage     * @param {Object} param Parameters     **/    this.setErrorMessage = function (param) {        var errorobj = null;        param         = param         || {};        param.message = param.message || '';        param.tooltip = param.tooltip || false;        if (typeof this.errorDiv === 'string') {            if (this.errorDiv != '') {                errorobj = document.getElementById(this.errorDiv);            }        } else {            errorobj = this.errorDiv;        }        this.$domNode.addClass("AF_InputError");        this.$domNode.removeClass("AF_InputOK");        if (errorobj != null) {            $(errorobj).addClass("AF_ErrorMessageWrong");            $(errorobj).removeClass("AF_ErrorMessage");            $(errorobj).html(param.message);        } else {            alert(param.message);        }        if (param.tooltip) {            /*             * Do not execute bt methods on mobile             */            if (WAF.PLATFORM.modulesString !== 'mobile') {                this.$domNode.bt(param.message, {                    offsetParent:this.$domNode.parent()                });            }            this.$domNode.parent().css('overflow', 'visible');        }    }    /**     * The representation format of the value     * @property format     * @type {String|undefined}     **/    this.format = {        format: inConfig['data-format']    };    /**     * isInFocus     *     * @property isInFocus     * @type Boolean     * @default false     **/    this.isInFocus = false;    binding     = inConfig['data-binding'] || '';    if (typeof Designer === 'undefined') {        bindingInfo = WAF.dataSource.solveBinding(binding);    }    this.source = bindingInfo.dataSource;    if ('source' in this) {        this.att = bindingInfo.dataClassAtt;        this.sourceAtt = bindingInfo.sourceAtt;        // if no format is defined, set the potential default format        if (this.att !== null && typeof this.format === 'undefined') {            this.format = this.att.defaultFormat;        }    }    // add the widget instance to the widget instance list    WAF.widgets[this.id] = this;    /*     * Force resize on window event     */    WAF.widgets._length = WAF.widgets._length || 0;    WAF.widgets._length += 1;    /*     * When the last widget is ready     */    if (WAF.Widget._lastWidget == this.id && !WAF.widgets._isReady) {        resizableWidgets = $('body').children('.waf-container[data-constraint-right],.waf-container[data-constraint-bottom],' +            '.waf-matrix[data-constraint-right],waf-matrix[data-constraint-bottom],' +            '.waf-splitView[data-constraint-right],waf-splitView[data-constraint-bottom],' +            '.waf-navigationView[data-constraint-right],waf-navigationView[data-constraint-bottom],' +            '.waf-component[data-constraint-right],.waf-component[data-constraint-bottom]');        if (resizableWidgets.length == 0) {            var component;            component = $('body').children('.waf-component');            if (component.width(), $(window).width()) {                resizableWidgets = component;            }        }        /*         * Resize widgets with constraints         * @namespace WAF.Widget         * @method resizeWidgets         */        resizeWidgets = function resizeWidgets() {            $.each(resizableWidgets, function(i) {                id      = $(this).prop('id');                widget  = $$(id);                if (widget._callResizeEvents) {                    widget._callResizeEvents('on');                }            });        };        /*         * Force resize on load         */        setTimeout(resizeWidgets, 1);        /*         * Force resize on window resize         */        $(window).resize(resizeWidgets);        /*         * To prevent bubbling         */        $('label').bind('click', {}, function() {            $('#' + $(this).prop('for')).trigger('click');            $('#' + $(this).prop('for')).select();            return false;        });        WAF.Widget.ready();    }    if (!this.clear) {        /*         * Clear widgets values         * @namespace WAF.Widget         * @method clear         */        this.clear = function clear () {            var htmlObject = null;            htmlObject = $(this.containerNode);            switch (this.kind) {                case 'textField':                    htmlObject.val('');                    break;                case 'richText':                case 'container':                    htmlObject.html('');                    break;                case 'slider':                    htmlObject.slider( 'value' , 0);                    break;                default :                    break;            }        }    }    // hide widget on load    if (this.config['data-hideonload'] === 'true') {        this.$domNode.hide();    }};/** * Provide a Widget Class from a name, a constructor, a prototype, and a private shared object * * @namespace WAF.Widget * @static * @method provide * * @param {String} name Required. The name of the widget constructor (ex: Datagrid) * @param {Object} shared The private properties and methods shared between all the instances * @param {Function} construct Required. The constructor used to create the widget instance * @param {Object} proto The public shared properties and methods inherited by all the instances * * @return {Function} The constructor of the widget * * @throw {Error} If the constructor name is not valid or if the constructor is not a function **/WAF.Widget.provide = function provide(name, shared, construct, proto) {    var ThisConstructor, thisPrototype, itemName;    // Create the 'shared' private object    shared = arguments[1];    // Check the parameters validity    if (typeof name !== 'string' || name.length < 2) {        throw new Error('The constructor name is missing or too short');    }    if (typeof construct !== 'function') {        throw new Error('The constructor function is missing or is not a function');    }    // Create the widget Constructor    ThisConstructor = WAF.widget[name] = function (config, data) {        var itemName = '',        outWidget = null;        if (data === undefined) {            data = {};            for (itemName in config) {                if (itemName.substr(0, 5) === 'data-') {                    data[itemName.substr(5)] = config[itemName];                }            }        }        if (typeof this === 'undefined') {            outWidget = new ThisConstructor(config, data);        } else {            this.init(name, config);            // to replace by this.call(this, construct, config, data, shared);            this.create = construct;            this.create(config, data, shared);            delete this.create;            outWidget = this;        }        /*         * Append resizable method if defined         */        if (data && data.resizable == 'true' && this.kind != 'autoform') {            this.resizable();        }        /*         * Append resizable method if defined         */        if (data && data.draggable == 'true') {            this.draggable();        }        this._shared = shared;        return outWidget;    };    // Extend the provided Widget from WAF.Widget    try {        ThisConstructor.name = name;    } catch (e) {    }    thisPrototype = ThisConstructor.prototype = new WAF.Widget();    thisPrototype.constructor = ThisConstructor;    // Add its own prototype properties and methods to the Constructor    for (itemName in proto) {        if (proto.hasOwnProperty(itemName)) {            thisPrototype[itemName] = proto[itemName];        }    }    itemName = undefined;};/** * Get the label widget of the widget * @namespace WAF.Widget * @method getLabel * @return {object} label widget **/WAF.Widget.prototype.getLabel = function () {    var    labelId;    labelId = $(this.label).prop('id');    return $$(labelId);}/** * Get the widget parent * @namespace WAF.Widget * @method getParent * @return {object} parent widget **/WAF.Widget.prototype.getParent = function () {    var    parentHtml;    parentHtml = this.$domNode.parent();    return $$(parentHtml.prop('id'));}/** * Get widget children * @namespace WAF.Widget * @method getChildren * @return {array} list of children widgets **/WAF.Widget.prototype.getChildren = function () {    var    widget,    children,    htmlObject;    htmlObject  = this.$domNode;    children    = [];    if (this.kind && this.kind == 'component') {        $.each(htmlObject.children().children(), function(i) {            widget = $$($(this).prop('id'));            if (widget) {                children.push(widget);            }        });    } else {        $.each(htmlObject.children(), function(i) {            widget = $$($(this).prop('id'));            if (widget) {                children.push(widget);            }        });    }    return children;}/** * Executed when all widgets are loaded * @method readys */WAF.Widget.ready = function () {    var    i,    widget;    /*     * Add custom widgets ready     */    for (i in WAF.widgets) {        widget = WAF.widgets[i];        if (widget.ready) {            widget.ready(widget._shared);        }    }    WAF.widgets._isReady = true;}/* * Open container in a panel * @namespace WAF * @method openContainerInAPanel * @param {String} divID * @param {String} config */WAF.openContainerInAPanel = function openContainerInAPanel (divID, config) {    var formdiv = '',    already = '',    off = '',    h = '',    w = '',    title = '';    formdiv = $('#'+divID);    already = formdiv.attr('data-inPanel');    if (already == '1') {        if (formdiv.prop('type') == 'textarea') {            formdiv = formdiv.parent();        }        formdiv.dialog('open');    } else {        formdiv.attr('data-inPanel', '1');        off = formdiv.offset();        h = formdiv.height();        w = formdiv.width();        formdiv.css('position', 'relative');        formdiv.css('top','0px');        formdiv.css('left','0px');        if (formdiv.prop('type') == 'textarea') {            formdiv.wrap('<div></div>');            formdiv.css('width', '100%');            formdiv.css('height', '100%');            formdiv = formdiv.parent();            formdiv.css('position', 'relative');            formdiv.css('top','0px');            formdiv.css('left','0px');        }        title = config.title;        if (title == null)  {            title = '';        }        formdiv.dialog({            dialogClass: 'waf-container-panel ' + formdiv.prop('class'),            title      : title,            position   : [off.left, off.top],            width      : w,            height     :h        });    }}/* * Get the last dom element to define the lastWidget */WAF.Widget._lastWidget = $('.waf-widget:last').prop('id');/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/icon/widget-icon.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * A class to provide 4-states icons     * (normal, hover, active, disabled)     *     * @class WAF.Widget.Icon     * @extends WAF.Widget     */    'Icon',    {        /**         * The default states attributes         *         * @private         * @shared         * @property shared.defaultState         * @type Object        */        defaultState: {            normalMobile: {                scale: '0.7 0.7',                fill: '#fff',                //opacity: 0.7,                stroke: 'none'            },            normal: {                scale: '0.7 0.7',                fill: '#5e5e5e',//5e5e5e                //opacity: 0.7,                stroke: 'none'            },            hover: {                //fill: '#888',                //fill: '#5e5e5e',                //stroke: 'none'            },            active: {                //fill: '#fff',                //fill: '#5e5e5e',                //stroke: 'none'            },            disabled: {                //fill: '#716b65',                //fill: '#5e5e5e',                //stroke: 'none'            }        },        /**         * The available paths         *         * @private         * @shared         * @property shared.path         * @type Object        */        path: {            'questionMark': 'M 8,0.21875 C 4.2713275,0.14197786 0.80494426,3.1229021 0.30854347,6.8163019 -0.30845812,10.371109 1.9238817,14.126388 5.3268245,15.30845 8.6393979,16.589366 12.693361,15.213442 14.55397,12.191507 16.565547,9.1809685 16.036009,4.8146305 13.3664,2.3694547 11.940025,0.99842746 9.9794657,0.20890504 8,0.21875 z m 0.1875,3.75 C 9.6214659,3.8617741 11.105506,5.1590605 10.699913,6.6594261 10.540219,7.993643 8.7071455,8.3623657 8.71875,9.7296909 8.8687245,10.307797 8.1087289,9.9759333 7.7671638,10.0625 7.1007837,10.277321 7.2324258,9.6515364 7.27211,9.1964456 7.3192005,7.7776594 9.8529406,7.2897556 9.0234873,5.7630303 8.3674501,4.6439043 7.1130327,6.10801 6.5972927,5.5807189 6.2235365,5.1499766 5.6259204,4.6394495 6.5532153,4.390625 7.0502207,4.113654 7.6184865,3.9673256 8.1875,3.96875 z m -0.9375,7.125 c 0.4895833,0 0.9791667,0 1.46875,0 0,0.458333 0,0.916667 0,1.375 -0.4895833,0 -0.9791667,0 -1.46875,0 0,-0.458333 0,-0.916667 0,-1.375 z',            'plus': 'M 12.95363,0.00218262 H 3.04597 C 1.36359,0.00218262 0,1.3364826 0,2.9826826 V 13.021683 c 0,1.6459 1.36398,2.9805 3.04597,2.9805 h 9.90807 c 1.68238,0 3.04596,-1.335 3.04596,-2.9805 V 2.9830826 c 0,-1.6466 -1.36398,-2.98089998 -3.04637,-2.98089998 z M 12.19861,9.4123826 h -2.7606 l 0,2.6954004 c -4e-4,0.7784 -0.64517,1.4094 -1.4404,1.4101 -0.79562,0 -1.4396,-0.632 -1.4396,-1.4101 l 7.7e-4,-2.6954004 -2.7594,-8e-4 c -0.79482,0 -1.4388,-0.6297 -1.4388,-1.4074 7.7e-4,-0.7781 0.64477,-1.4083 1.4388,-1.4078 h 2.7602 l -4e-4,-2.7009 c 0.001,-0.7785 0.64557,-1.4086 1.4408,-1.409 0.79562,0 1.44,0.6314 1.4392,1.409 l -3.9e-4,2.7009 2.7598,3e-4 c 0.79522,7e-4 1.43959,0.6317 1.44039,1.4098 -10e-4,0.7777 -0.64517,1.4067 -1.44039,1.4059 z',            'plusMobile': 'M25.979,12.896 19.312,12.896 19.312,6.229 12.647,6.229 12.647,12.896 5.979,12.896 5.979,19.562 12.647,19.562 12.647,26.229 19.312,26.229 19.312,19.562 25.979,19.562z',            'minus': 'M 12.954026,0.002183 H 3.0459693 C 1.3635807,0.002183 0,1.3364239 0,2.9826132 V 13.021753 c 0,1.645797 1.3639796,2.98043 3.0459693,2.98043 H 12.954026 C 14.636818,16.002183 16,14.667168 16,13.021753 V 2.9830057 C 16,1.3364239 14.636419,0.002183 12.954026,0.002183 z M 12.199001,9.4123666 3.7998001,9.4119741 C 3.004974,9.4115925 2.3609945,8.7818519 2.3609945,8.0041289 2.3617667,7.2260134 3.0057707,6.5958913 3.7998001,6.5966763 h 8.3992009 c 0.794432,7.523e-4 1.438811,0.6316812 1.439606,1.4097858 -5.94e-4,0.777723 -0.645174,1.4066895 -1.439606,1.4059045 z',            'arrowFullLeft': 'M 6.42825,15.374508 0.6214,9.5205079 C 0.20777,9.1013079 0,8.5475079 0,8.0006079 l 0,0 c 0,-0.5461 0.20777,-1.0976 0.6214,-1.5188 l 0,0 0.001,0 5.80609,-5.85399995 c 0.41478,-0.4184 0.96472,-0.6293 1.50695,-0.627800004869 l 0,0 c 0.54221,0 1.09139,0.209400004869 1.50307,0.625500004869 l 0,0 C 9.85483,1.0392079 10.06802,1.5927079 10.06802,2.1439079 l 0,0 c 0,0.5468 -0.20972,1.1015 -0.62565,1.5191 l 0,0 -2.17274,2.1875 h 6.60088 c 1.17906,0 2.12756,0.9633 2.12949,2.1481 l 0,0 c -0.002,1.1841 -0.94927,2.1474001 -2.12949,2.1474001 l 0,0 H 7.27156 l 2.16888,2.1871 c 0.41439,0.4165 0.62758,0.9699 0.62758,1.5215 l 0,0 c 0,0.5461 -0.20972,1.0995 -0.62758,1.518 l 0,0 c -0.41554,0.4161 -0.96009,0.6274 -1.505,0.6274 l 0,0 c -0.54262,0 -1.09256,-0.211 -1.50734,-0.6274 l 0,0 z',            'arrowFullRight': 'M 9.57175,15.374508 15.3786,9.5205079 c 0.41363,-0.4192 0.6214,-0.973 0.6214,-1.5199 l 0,0 c 0,-0.5461 -0.20777,-1.0976 -0.6214,-1.5188 l 0,0 -0.001,0 -5.80609,-5.85399995 c -0.41478,-0.4184 -0.96472,-0.6293 -1.50695,-0.627800004869 l 0,0 C 7.52235,7.945131e-6 6.97317,0.20940795 6.56149,0.62550795 l 0,0 C 6.14517,1.0392079 5.93198,1.5927079 5.93198,2.1439079 l 0,0 c 0,0.5468 0.20972,1.1015 0.62565,1.5191 l 0,0 2.17274,2.1875 H 2.12949 c -1.17906,0 -2.12756,0.9633 -2.12949,2.1481 l 0,0 c 0.002,1.1841 0.94927,2.1474001 2.12949,2.1474001 l 0,0 h 6.59895 l -2.16888,2.1871 c -0.41439,0.4165 -0.62758,0.9699 -0.62758,1.5215 l 0,0 c 0,0.5461 0.20972,1.0995 0.62758,1.518 l 0,0 c 0.41554,0.4161 0.96009,0.6274 1.505,0.6274 l 0,0 c 0.54262,0 1.09256,-0.211 1.50734,-0.6274 l 0,0 z',            'arrowSansLeft': 'M 11 1 L 4 8 L 11 15 L 11 1 z',            'arrowSansRight': 'M 5 1 L 5 15 L 12 8 L 5 1 z',            'trash': 'M 6.75 -0.03125 C 6.128465 0.076817308 6.05147 1.1254821 5.5 1.1875 C 4.5426184 1.1568985 3.4370056 1.114832 2.71875 1.875 C 2.3521867 2.2242683 1.7403905 3.247357 2.15625 3.53125 L 13.6875 3.53125 C 13.697157 2.1441629 12.331468 0.98910275 10.96875 1.1875 L 10.03125 1.1875 C 10.059954 0.38472055 9.200304 -0.13856532 8.46875 0 L 7.0625 0 C 6.9491067 -0.028065075 6.8387907 -0.046688187 6.75 -0.03125 z M 2 4.71875 C 2.0151152 7.7993031 1.9769344 10.889794 2.03125 13.96875 C 2.2072088 15.267229 3.5342711 16.19058 4.8125 16 C 7.0974602 15.986541 9.4037307 16.024902 11.6875 15.96875 C 12.97934 15.801558 13.866386 14.446299 13.6875 13.1875 L 13.6875 4.71875 L 2 4.71875 z M 4.625 6.5 C 5.3457596 6.5230087 5.2299452 7.4068785 5.21875 7.90625 C 5.2147422 9.7906036 5.2446673 11.678236 5.21875 13.5625 C 4.9913079 14.551871 3.6298606 13.782735 4.03125 12.96875 C 4.0361739 10.965356 4.0046075 8.972057 4.03125 6.96875 C 4.0796378 6.6993753 4.3517656 6.4932642 4.625 6.5 z M 7.9375 6.5 C 8.6580687 6.5233484 8.5425444 7.4068372 8.53125 7.90625 C 8.527204 9.7906036 8.5572436 11.678236 8.53125 13.5625 C 8.3986177 14.451514 6.9979048 13.943712 7.3125 13.15625 C 7.3206683 11.094294 7.2836818 9.0296457 7.3125 6.96875 C 7.3738846 6.694356 7.6588111 6.4954498 7.9375 6.5 z M 11.21875 6.5 C 11.90116 6.4945188 11.887355 7.3263963 11.84375 7.8125 C 11.838292 9.7282582 11.873293 11.646854 11.84375 13.5625 C 11.595612 14.54458 10.225538 13.799329 10.625 12.96875 C 10.629886 10.965356 10.598625 8.9720586 10.625 6.96875 C 10.672521 6.6988409 10.94534 6.4926256 11.21875 6.5 z',            'radioactive': 'M 4.7495053,2.3824846 C 3.8243413,2.6462962 4.1157849,3.823571 4.6038227,4.3644301 5.2320236,5.4637816 5.8602244,6.5631331 6.4884253,7.6624846 7.1692961,6.8780436 8.3091481,7.1655221 9.1748265,7.408136 9.9291467,7.623662 10.021617,6.3207181 10.488771,5.86498 10.945486,5.0407792 11.469243,4.2387285 11.84284,3.3774689 11.97655,2.4211178 10.772637,2.2783756 10.081615,2.3824846 c -1.7773701,0 -3.5547399,0 -5.3321097,0 z m 3.22491,5.4697 C 6.7331958,7.7611498 5.9208699,9.4872057 6.7785653,10.387365 7.51891,11.426096 9.413431,10.903469 9.5095854,9.6267657 9.6662484,8.7322249 8.8859315,7.8189714 7.9744153,7.8521846 z m -7.14537998,1.64407 c -1.08464358,0.012331 -0.96463588,1.4550234 -0.36180202,2.0116004 0.9217462,1.558522 1.7824728,3.153241 2.747512,4.68601 0.716755,0.718329 1.5656111,-0.235502 1.8058793,-0.922572 0.7211236,-1.239982 1.4422471,-2.479965 2.1633707,-3.719948 -0.9902269,-0.196271 -1.2119359,-1.327551 -1.6781,-2.0550904 -1.5589533,0 -3.1179067,0 -4.67685998,0 z m 9.42177968,0 c 0.147251,0.9368064 -0.7722997,1.5060524 -1.2965112,2.1257144 0.2334278,0.863027 0.9648908,1.750888 1.3857042,2.625676 0.573525,0.706697 0.748386,1.95318 1.710438,2.210055 1.056004,-0.142493 1.250015,-1.424228 1.804623,-2.147867 0.71404,-1.260181 1.515398,-2.486018 2.130698,-3.793004 0.152224,-0.9652721 -1.062455,-1.1329592 -1.762362,-1.0205744 -1.324197,0 -2.648393,0 -3.97259,0 z',            'magnifyingGlass': 'M 5.875 0 C 4.5338886 0.016050726 3.1868715 0.45979752 2.15625 1.34375 C 0.072738424 3.0004621 -0.60339095 6.1210439 0.59375 8.5 C 1.7163235 10.926788 4.5811151 12.367751 7.1875 11.75 C 7.7387149 11.725749 8.3589478 11.068707 8.71875 11.71875 C 9.9951609 12.985328 11.242514 14.246548 12.53125 15.5 C 13.532737 16.376934 15.295651 15.977725 15.8125 14.75 C 16.187091 13.964936 15.999118 12.982574 15.375 12.375 L 11.375 8.375 C 12.510678 5.9713281 11.741233 2.8518394 9.625 1.25 C 8.5733253 0.39145237 7.2161114 -0.016050726 5.875 0 z M 5.75 2.0625 C 7.703925 1.916566 9.5740453 3.4902641 9.78125 5.4375 C 10.076514 7.3773921 8.6457976 9.3662014 6.71875 9.71875 C 4.8386012 10.149181 2.7856227 8.9438606 2.25 7.09375 C 2.1341417 6.7226316 2.0623287 6.3262351 2.0625 5.9375 C 2.0151077 3.9453777 3.7586995 2.1182851 5.75 2.0625 z',            'floppyDisk': 'M 2.8125 0 C 1.2634539 0 0 1.2923468 0 2.84375 L 0 13.1875 C 0 14.737725 1.2634539 16 2.8125 16 L 13.1875 16 C 14.738118 16 16 14.737725 16 13.1875 L 16 2.84375 C 16 1.2923468 14.738118 0 13.1875 0 L 12.9375 0 L 12.9375 6.03125 C 12.9375 6.4531814 12.60786 6.78125 12.1875 6.78125 L 3.8125 6.78125 C 3.3905686 6.78125 3.0625 6.4531814 3.0625 6.03125 L 3.0625 0 L 2.8125 0 z M 9.15625 0.03125 C 8.9464629 0.03125 8.78125 0.19646288 8.78125 0.40625 L 8.78125 5.125 C 8.78125 5.3359657 8.9464629 5.5 9.15625 5.5 L 11.0625 5.5 C 11.273466 5.5 11.4375 5.3359657 11.4375 5.125 L 11.4375 0.40625 C 11.4375 0.19646288 11.273466 0.03125 11.0625 0.03125 L 9.15625 0.03125 z',            'arrowDown': 'M 8,14 3.2290908,7.6 12.770909,7.6 8,14 z',            'arrowUp': 'M 8,2 3.2290908,8.4 12.770909,8.4 8,2 z',            'checkbox': 'M6.039,14.107L0.368,7.708C-0.216,7.052-0.092,6.092,0.65,5.571C1.39,5.05,2.465,5.163,3.052,5.824 L5.93,9.068l6.927-8.442c0.558-0.677,1.627-0.831,2.39-0.335s0.929,1.447,0.375,2.127L6.039,14.107L6.039,14.107z'        }    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default TODO: set to the name to this class (ex: WAF.widget.DataGrid)     **/    function WAFWidget(config, data, shared) {        var        widget,        cssProp,        /*         * The Raphael viewport         */        paper,        /*         * The initial icon, normal state         */        icon;        /*         * Set icon widget type         */        this._type          = data['icon-type'] ? data['icon-type'] : null;        this._spriteInfo    = data['sprite-info'] || "";        widget      = this;        switch(this._type) {            /*             * Images icon behaviour             */            case 'images' :                /*                 * Show default image                 */                this.setState('state1');                /*                 * Bind states events                 */                this.$domNode.bind({                        mouseenter: function() {                            widget.setState('state2');                        },                        mousedown: function() {                            widget.setState('state3');                        },                        'mouseleave': function() {                            widget.setState('state1');                        },                        'mouseup': function() {                            widget.setState('state2');                        }                });                /*                 * Resize icon depending on data-fit value                 */                this.$domNode.find('img').width('100%').height('100%');                break;            /*             * Sprite icon behaviour             */            case 'sprite' :                /*                 * Set image as background-image css property                 */                cssProp = {                    'background-image' : 'url("' + data['image-state1'] + '")'                }                this.$domNode.css(cssProp);                /*                 * Show default image                 */                this.setState('state1');                /*                 * Bind states events                 */                this.$domNode.bind({                        mouseenter: function() {                            widget.setState('state2');                        },                        mousedown: function() {                            widget.setState('state3');                        },                        'mouseleave': function() {                            widget.setState('state1');                        },                        'mouseup': function() {                            widget.setState('state2');                        }                });                break;            /*             * Default icon behaviour             */            default :                /**                 * The states of this icon instance, default to shared.defaultState                 *                 * @private                 * @property defaultState                 * @type object                 */                this.state = $.extend(true, {}, shared.defaultState, config.state);                if (shared.path[config.type] == undefined) {                    config.type = 'questionMark';                }                if (config.size == undefined || ("16, 24, 32".indexOf(config.size) === -1)) {                    config.size = 16;                }                $(this.containerNode).prop(                {                    id: config.id,                    'class': 'waf-icon waf-icon-' + config.size + ' ' + [].concat(config.className).join(' ')                }                )                .data(                {                    'icon-size': config.size,                    'icon-type': config.type                }                ).bind({                        mouseenter: function() {                                $(this).addClass('waf-state-hover');                        },                        mousedown: function() {                                $(this).addClass('waf-state-active');                        },                        'mouseleave mouseup': function() {                                $(this).removeClass('waf-state-hover waf-state-active');                        }                });                paper = Raphael(this.containerNode, config.size, config.size * 4);                if (WAF.PLATFORM.modulesString === "mobile" || WAF.PLATFORM.modulesString === "touch") {                    icon = paper.path(shared.path[config.type]).attr(this.state.normalMobile);                } else {                    icon = paper.path(shared.path[config.type]).attr(this.state.normal);                }                icon.clone().translate(0, config.size).attr(this.state.hover);                icon.clone().translate(0, config.size * 2).attr(this.state.active);                icon.clone().translate(0, config.size * 3).attr(this.state.disabled);                /* append a transparent foregroung to handle events */                paper.rect(0, 0, config.size, config.size * 4).attr({                    fill: '#000',                    stroke: 'none',                    opacity: 0                });                $(this.containerNode).append($(paper.node));                break;        }    },    {        _type : null,        _tmpState : 'default',        setState : function icon_set_state (state) {            var            label,            htmlObject;            label = this.getLabel();            /*             * Equivalences             */            if (state == 'default') {                state = 'state1';            }            if (state == 'hover') {                state = 'state2';                this.addClass('waf-state-hover');            }            if (state == 'active') {                state = 'state3';            }            if (state == 'disabled') {                state = 'state4';            }            if (!this._disabled) {                htmlObject = this.$domNode;                htmlObject.addClass('waf-state-' + state);                this._showImage(state);                if (state == 'state2') {                    htmlObject.removeClass('waf-state-state3');                }                if (state == 'state3') {                    htmlObject.removeClass('waf-state-state2');                }                if (state == 'state1') {                    htmlObject.removeClass('waf-state-state2');                    htmlObject.removeClass('waf-state-state3');                    htmlObject.removeClass('waf-state-state4');                    this._tmpState = state;                }                if (label) {                    label.setState(state);                }            }        },        /*         * Display the correct image depending on icon state         * @method _showImage         * @param {string} state         */        _showImage : function icon_show_image(state) {            var            spriteInfo;            switch (this._type){                case 'images' :                    this.$domNode.find('img.waf-icon-' + state).show();                    this.$domNode.find('img').not('.waf-icon-' + state).hide();                    break;                case 'sprite' :                    /*                     * Get sprite info                     */                    /*spriteInfo  = this._spriteInfo;                    spriteInfo  = JSON.parse(spriteInfo.replace(/\'/g, '"'))[0];*/                    /*                     * Change background-position                     */                    /*if (spriteInfo[state]) {                        this.$domNode.css({                            'background-position' : spriteInfo[state]                        });                    }                    */                    break;            }        },        /**         * Custom disable function (enable sub widgets)         * @method enable         */        disable : function icon_disable() {            this.setState('disabled');            /*             * Call super class disable function             */            WAF.Widget.prototype.disable.call(this);        },        /**         * Custom enable function (enable sub widgets)         * @method enable         */        enable : function icon_enable() {            this.setState('default');            /*             * Call super class enable function             */            WAF.Widget.prototype.enable.call(this);        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/icon/widget-icon-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'icon',    lib         : 'WAF',    description : 'Icon',    category    : 'Misc. Controls',    img         : '/walib/WAF/widget/image/icons/widget-image.png',    //resizable   : false,    css         : [],    include     : [],    tag         : 'span',    attributes  : [    {        name        : 'data-label',        description : 'Label',        defaultValue: ''    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    /*     * Sprite info attribute     */    {        name        : 'data-sprite-info',        id          : 'waf-form-spriteManager',        description : 'Preview',        tabCategory : 'Image',        //category    : 'Image',        tab         : 'style',        type        : 'container',        style       : {            'position'  : 'relative',            'max-width' : '260px',            'overflow'  : 'hidden'        },        ready       : function(){            var            tag,            pos,            data,            state,            tmpDiv,            jsonObj,            computed,            maxWidth,            maxHeight,            spriteImg,            container,            attrValue,            htmlObject,            spritePath,            idSelector,            selectorCSS,            imageContainer,            spriteInfoAttr,            spriteSelector;            maxWidth        = 260;            maxHeight       = 260;            data            = this.data;            tag             = data.tag;            htmlObject      = this.htmlObject;            spriteInfoAttr  = tag.getAttribute('data-sprite-info');            attrValue       = tag.getAttribute('data-image-state1').getValue();            idSelector      = 'sprite-selector';            state           = getTagStateLabel(tag);            computed        = tag.getComputedStyle('background-position');            selectorCSS     = {                'position'      : 'absolute',                'background'    : 'rgba(156,185,230,0.8)',                'cursor'        : 'pointer'            }            /*             * Set sprite selector properties if exist on widget load             */            if (spriteInfoAttr.getValue() || computed != '0px 0px') {                if (!computed) {                    jsonObj             = JSON.parse(spriteInfoAttr.getValue().replace(/\'/g, '"'))[0];                    jsonObj             = jsonObj[state] ? jsonObj[state] : jsonObj['state1'];                    pos                 = jsonObj.split(' ');                } else {                    pos                 = computed.split(' ');                }                selectorCSS.left    = parseInt(pos[0]) * -1 + "px";                selectorCSS.top     = parseInt(pos[1]) * -1 + "px";                selectorCSS.width   = tag.getStyle('width') + "px";                selectorCSS.height  = tag.getStyle('height') + "px";            /*             * Default selector size and position             */            } else {                selectorCSS.left    = "0px";                selectorCSS.top     = "0px";                selectorCSS.width   = tag.getStyle('width') + "px";                selectorCSS.height  = tag.getStyle('height') + "px";            }            /*             * Show attribute editor             * remove existings images             */            this.htmlObject.parent().parent().show();            this.htmlObject.children().remove();            /*             * Create image container             */            container = $('<div>')                                .css({                                    'margin-bottom' : '10px',                                    //'width'         : maxWidth + 'px',                                    'max-height'    : maxHeight + 'px',                                    'overflow'      : 'hidden'                                })                                .appendTo(htmlObject);            imageContainer = $('<div>')                                .css({                                    position    : 'relative'                                })                                .appendTo(container);            /*             * Create sprite selector             */            spriteSelector  = $('<div id="' + idSelector + '">')                                    .css(selectorCSS)                                    .appendTo(imageContainer)                                    /*                                     * Set Resizable                                     */                                    .resizable({                                        containment : 'parent',                                        handles     : 'n, e, s, w'                                    })                                    /*                                     * Set draggable                                     */                                    .draggable({                                        containment : 'parent',                                        /*                                         * Stop draw sprite selector on start drag                                         */                                        start : function(){                                            D.ui._startSpriteSelector = false                                        },                                        /*                                         * Refresh tag background position on drag                                         */                                        drag : function(e, ui){                                            var                                            i,                                            tagElt,                                            selectionCount;                                            /*                                             * Update sprite info attribute                                             */                                             selectionCount = Designer.env.tag.selection.count();                                            if (selectionCount > 1) {                                                for (i = 0; i < selectionCount; i += 1 ) {                                                    tagElt = Designer.env.tag.selection.get(i);                                                    tagElt._updateSpriteInfo(spriteSelector.css('left'), spriteSelector.css('top'));                                                    tagElt.onDesign(true);                                                }                                            } else {                                                tag._updateSpriteInfo(spriteSelector.css('left'), spriteSelector.css('top'));                                                tag.onDesign(true);                                            }                                        }                                    });            /*             * Do not display if separated images             */            if (tag.getAttribute('data-icon-type').getValue() != 'sprite') {                this.htmlObject.parent().parent().hide();                return;            }            if (attrValue) {                spritePath  = Designer.util.formatPath(attrValue);                /*                 * Display sprite image                 */                spriteImg = $('<img src="' + spritePath.fullPath + '">')                        .css({                            'cursor' : 'crosshair'                        })                        .appendTo(imageContainer)                /*                 * Execute script after image sprite load                 */                spriteImg[0].onload = function(){                    var                    imgWidth,                    imgHeight,                    _tmpIndex,                    _tmpParent,                    _timeoutShow,                    _timeoutHide;                    imgWidth    = spriteImg.width();                    imgHeight   = spriteImg.height();                    container.css({                        'width'     : imgWidth                    });                    if (imgHeight > maxHeight) {                        container.css({                            'height'    : imgHeight                        });                    }                    if (imgWidth > maxWidth || imgHeight > maxHeight) {                        /*                         * Move on mouse over                         */                        _tmpParent = [];                        var                        x,                        y;                            x           = htmlObject.offset().left                            y           = htmlObject.offset().top                        imageContainer.hover(function() {                            var                            pos;                            pos = (x - (imgWidth-maxWidth) - 10)                            $(this).stop(true, true);                            /*                             * Clear animation timeout                             */                            clearTimeout(_timeoutHide);                            if (imgWidth <= maxWidth) {                                pos = imageContainer.offset().left - 1;                            }                            if (imageContainer.offset().left == pos) {                                return;                            }                            /*                             * Time out to do not instantly execute animation                             */                            _timeoutShow = setTimeout(function(){                                imageContainer                                    .appendTo('body')                                    .css({                                        'left'              : x,                                        'top'               : y,                                        'position'          : 'absolute',                                        'background-color'  : 'white',                                        '-webkit-box-shadow': '2px 2px 6px rgba(0, 0, 0, 0.2)'                                    })                                    .animate({                                        'left'     : pos + 'px'                                    }, 200);                            }, 100);                        }, function() {                            /*                             * Clear animation timeout                             */                            clearTimeout(_timeoutShow)                            $(this).stop(true, true);                            _timeoutHide = setTimeout(function(){                                /*                                 * Move image                                 */                                imageContainer.animate({                                    'left'     : x + 'px'                                }, 150, function(){                                    imageContainer                                        .appendTo(container)                                        .css({                                            'left'              : 0,                                            'top'               : 0,                                            'position'          : 'relative',                                            'background-color'  : 'transparent',                                            '-webkit-box-shadow': 'none'                                        });                                });                            }, 500);                        });                    }                }                /*                 * Begin draw sprite selector on mousedown                 */                imageContainer.bind('mousedown', function(e){                    /*                     * Do not draw sprite selector if click                     * on spriteSelector object                     */                    if (e.target.tagName != "IMG") {                        D.ui._startSpriteSelector = false;                    } else {                        D.ui._startSpriteSelector = true;                        selectorCSS.left    = e.offsetX;                        selectorCSS.top     = e.offsetY;                        selectorCSS.width   = 0;                        selectorCSS.height  = 0;                        spriteSelector                            .css(selectorCSS)                        D.ui._tmpSpriteSelector = {                            x   : e.offsetX,                            y   : e.offsetY                        }                    }                });                /*                 * Draw sprite selector on mousemouse                 */                imageContainer.bind('mousemove', function(e){                    var                    calculX,                    calculY;                    if (!D.ui._startSpriteSelector) {                        return;                    }                    calculX             = e.offsetX - D.ui._tmpSpriteSelector.x;                    calculY             = e.offsetY - D.ui._tmpSpriteSelector.y;                    selectorCSS.width   = (spriteSelector.width() + calculX) + 'px';                    selectorCSS.height  = (spriteSelector.height() + calculY) + 'px';                    selectorCSS['pointer-events'] = 'none';                    spriteSelector                        .css(selectorCSS)                    D.ui._tmpSpriteSelector = {                        x   : e.offsetX,                        y   : e.offsetY                    }                });                /*                 * Stop draw sprite selector on mousedown                 */                imageContainer.bind('mouseup', function(){                    var                    i,                    top,                    left,                    width,                    height,                    selectionCount;                    width   = spriteSelector.width();                    height  = spriteSelector.height();                    left    = spriteSelector.css('left');                    top     = spriteSelector.css('top');                    /**                     * update tag                     * @updateTag                     * @param {object} tagElt                     * @param {number} left                     * @param {number} top                     * @param {number} width                     * @param {number} height                     */                    this.updateTag = function (tagElt, left, top, width, height) {                        /*                         * Update sprite info attribute                         */                        tagElt._updateSpriteInfo(left, top);                        /*                         * Update tag size depending on spriteSelector size                         * Disable domUpdate                         */                        D.tag.preventDomUpdate();                        tagElt.setWidth(width, false)                        tagElt.setHeight(height, false)                        /*                         * Enable domUpdate                         */                        D.tag.preventDomUpdate(false);                        tagElt.onDesign(true);                        tagElt.domUpdate();                    }                    selectionCount = Designer.env.tag.selection.count();                    if (selectionCount > 1) {                        for (i = 0; i < selectionCount; i += 1 ) {                            tagElt = Designer.env.tag.selection.get(i);                            this.updateTag(tagElt, left, top, width, height);                        }                    } else {                        this.updateTag(tag, left, top, width, height);                    }                    spriteSelector                        .css('pointer-events', 'auto');                    D.ui._startSpriteSelector = false;                    $('#waf-sprite-input-width').val(width);                    $('#waf-sprite-input-height').val(height);                    $('#waf-sprite-input-left').val(parseInt(left));                    $('#waf-sprite-input-top').val(parseInt(top));                });                tmpDiv = $('<div>').appendTo(htmlObject)                createSpriteManagerInput(tag, spriteSelector, 'Width', tmpDiv);                createSpriteManagerInput(tag, spriteSelector, 'Left', tmpDiv);                createSpriteManagerInput(tag, spriteSelector, 'Height', tmpDiv);                createSpriteManagerInput(tag, spriteSelector, 'Top', tmpDiv);            }        }    },    /*     * Display states image path attribute     */    iconImageStateAttribute('state1'),    iconImageStateAttribute('state2'),    iconImageStateAttribute('state3'),    iconImageStateAttribute('state4'),    /*     * Icon type selector     */    {        name        : 'data-icon-type',        description : 'Type',        type        : 'combobox',        onchange    : function(){            var            tag,            data;            data            = this.data;            tag             = data.tag;            /*             * Reload sprite manager             */            waForm.components.get('waf-form-spriteManager')._ready()            switch(this.getValue()) {                case 'images' :                    tag.getHtmlObject().css('background-image', 'none');                    break;            }        },        options     : [{            value   : 'Separate images',            key     : 'images'        },{            value   : 'Sprite',            key     : 'sprite'        }],        defaultValue: 'images',        tabCategory : 'Image',        //category    : 'Image',        tab         : 'style',        ready       : function(){            var            tag,            data,            currentState;            data            = this.data;            tag             = data.tag;            currentState    = getTagStateLabel(tag);            if (currentState != 'state1') {                this.htmlObject.parent().parent().hide();            }        }    }],    events      : [{        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    properties  : {        style   : {            theme       : false,            fClass      : true,            text        : false,            background  : true,            gradient    : true,            border      : true,            sizePosition: true,            shadow      : true,            disabled    : ['background-image']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-state2'        },{                label   : 'active',                cssClass: 'waf-state-state3'        },{                label   : 'disabled',                cssClass: 'waf-state-state4'        }]    },    style: [    {        name        : 'width',        defaultValue: '24px'    },    {        name        : 'height',        defaultValue: '24px'    }],    onInit      : function (config) {        return new WAF.widget.Icon(config);    },    onDesign    : function (config, designer, tag, catalog, isResize) {        var        i,        ctx,        path,        state,        width,        height,        canvas,        _state,        aState,        htmlCSS,        iconType,        iconHtml,        iconClass,        thisWidth,        iconImage,        thisHeight,        htmlObject,        spriteInfo,        state1Value,        attrSpriteInfo;        htmlObject  = tag.getHtmlObject();        iconType    = tag.getAttribute('data-icon-type').getValue();        iconType    = iconType || 'images';        switch(iconType) {            /*             * Case of separated images             */            case 'images':                /*                 * Keep data images into _iconState object                 */                tag._iconState = {                    'state1'    : tag.getAttribute('data-image-state1').getValue(),                    'state2'    : tag.getAttribute('data-image-state2').getValue(),                    'state3'    : tag.getAttribute('data-image-state3').getValue(),                    'state4'    : tag.getAttribute('data-image-state4').getValue()                }                _state  = getTagStateLabel(tag);                /*                 * Add images                 */                for (i in tag._iconState) {                    aState      = tag._iconState[i];                    iconClass   = 'waf-icon-' + i;                    iconHtml    = $('#' + tag.getId() + ' .' + iconClass);                    if (aState) {                        path    = Designer.util.formatPath(aState);                        /*                         * If image already exists for this state                         */                        if (iconHtml.length > 0) {                            iconHtml.prop('src', path.fullPath);                        }                        /*                         * else create it                         */                        else {                            iconHtml = $('<img class="' + iconClass + '" src="' + path.fullPath + '">')                                .appendTo(htmlObject);                        }                        if (i != _state) {                            iconHtml.hide();                        }                    /*                     * Remove image if not defined                     */                    } else {                        iconHtml.remove();                    }                }                /*                 * Resize icon depending on data-fit value                 */                htmlObject.find('img').width('100%').height('100%');                break;            /*             * Case of sprite :             * Set background image with background-position             */            case 'sprite':                /*                 * Remove existing images                 */                htmlObject.find('img').remove();                attrSpriteInfo  = tag.getAttribute('data-sprite-info');                state1Value     = tag.getAttribute('data-image-state1').getValue();                if (attrSpriteInfo && state1Value) {                    spriteInfo = attrSpriteInfo.getValue();                    htmlCSS = {                        'background-image' : 'url("' + Designer.util.formatPath(state1Value).fullPath + '")'                    }                    if (spriteInfo) {                        state = getTagStateLabel(tag);                        spriteInfo  = JSON.parse(spriteInfo.replace(/\'/g, '"'))[0];                        spriteInfo  = spriteInfo[state] || spriteInfo['state1'];                        //htmlCSS['background-position'] = spriteInfo;                    }                    htmlObject.css(htmlCSS);                }                _state  = 'state1';                break;        }        width   = tag.getWidth();        height  = tag.getHeight();        /*         * Create canvas if no image         */        if (!tag.getAttribute('data-image-' + _state).getValue()) {            htmlObject.find('canvas').remove();            canvas = $('<canvas width="' + width + 'px" height="' + height + 'px">')                        .css({                            'position'  : 'absolute',                            'left'      : '0px',                            'top'       : '0px'                        });            htmlObject.append(canvas);            ctx = canvas[0].getContext("2d");            ctx.fillStyle = "rgb(200,0,0)";            ctx.fillRect(0, 0, width / 2, height / 2);            ctx.fillStyle = "rgba(0, 50, 200, 0.5)";            ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);            canvas.css({                'width'     : '100%',                'height'    : '100%'            });        } else {            htmlObject.find('canvas').remove();        }    },    onCreate    : function (tag, param) {        /**         * Change the icon depending on the state         * @method _changeIcon         * @param {string} state         */        tag._showIcon = function change_icon (state) {            var            i,            iconHtml;            for (i in this._iconState) {                iconHtml    = $('#' + this.getId() + ' .waf-icon-' + i);                /*                 * Show defined state icon                 */                if (i == state) {                    iconHtml.show();                } else {                    iconHtml.hide();                }            }        }        /*         * Widget custom on state change event         */        $(tag).bind('onStateChange', function(e, state){            state = state == -1 ? 'waf-state-state1' : state            this._showIcon(state.replace('waf-state-', ''));        });        /*         * Widget custom on file drop event         * Set path for all states         */        $(tag).bind('onFileDrop', function(e, data) {            var            i,            that,            path,            state,            tmpImg;            that    = this;            path    = data.path.cropedPath;            tmpImg = $('<img src="' + data.path.fullPath + '">').appendTo('body');            tmpImg[0].onload = function(){                var                i,                x,                y,                nb,                json,                isInt,                width,                state,                states,                height,                imgObj,                noState,                infoAttr,                iconType,                newWidth,                newHeight,                thatState,                listStates;                imgObj      = $(this);                noState     = true;                iconType    = that.getAttribute('data-icon-type').getValue();                infoAttr    = that.getAttribute('data-sprite-info');                width       = imgObj.width();                height      = imgObj.height();                listStates  = [];                states      = ['state1', 'state2', 'state3', 'state4']                /*                 * Auto detect proportion to set as sprite or not                 */                if (height > width) {                    nb = (height/width);                    newWidth = newHeight = width;                    for (i = 0; i < nb; i += 1) {                        x = 0;                        y = i * newHeight;                        listStates.push("'" + states[i] + "' : '-" + x  + "px -" + y + "px'");                    }                } else {                    nb = (width/height);                    newWidth = newHeight = height;                    for (i = 0; i < nb; i += 1) {                        x = i * newHeight;                        y = 0;                        listStates.push("'" + states[i] + "' : '-" + x  + "px -" + y + "px'");                    }                }                isInt = D.util.isInt(nb);                if (isInt && nb > 2) {                    json = "{"                        + listStates.join(',')                    + "}";                    iconType = 'sprite';                    that.getAttribute('data-icon-type').setValue(iconType);                    that.setWidth(newWidth, false);                    that.setHeight(newHeight, false);                    infoAttr.setValue("[" + json + "]");                }                switch (iconType) {                    case 'images':                        thatState = getTagStateLabel(that);                        for (i in that._iconState) {                            state = that._iconState[i];                            if (!state) {                                that.getAttribute('data-image-' + i).setValue(path);                                that._iconState[i] = path;                            } else {                                noState = false;                            }                        }                        that.getAttribute('data-image-' + thatState).setValue(path);                        that._showIcon(thatState);                        break;                    case 'sprite':                        if (!infoAttr.getValue()) {                            infoAttr.setValue("[{'state1':'-0px -0px'}]");                        }                        that.getAttribute('data-image-state1').setValue(path);                        break;                }                D.tag.preventDomUpdate();                /*                 * Change widget size                 */                if ( noState && iconType == 'images' && !data.keepSize && !that._inButton) {                    that.setWidth(imgObj.width());                    that.setHeight(imgObj.height());                }                /*                 * Set focus                 */                that.onDesign(true);                D.tag.preventDomUpdate(false);                that.domUpdate();                if (!data.silentMode) {                    that.setCurrent();                    D.tag.refreshPanels();                }            }        });        /*         * Widget custom dom update event         * save images into widget dom         */        $(tag).bind('onDomUpdate', function(e, element) {            var            i,            state,            image,            jsonObj,            iconType,            thisState,            stateInfo,            childNodes;            childNodes = element.getChildNodes();            /*             * Remove existing images             */            for(i in childNodes) {                childNodes[i].remove();            }            /*             * Fix images duplicate             */            element._json.childNodes = [];            iconType    = tag.getAttribute('data-icon-type').getValue();            iconType    = iconType || 'images';            switch(iconType) {                case 'images':                    /*                     * Add states images                     */                    for (i in this._iconState) {                        state = tag.getAttribute('data-image-' + i).getValue();                        if (state) {                            image = Designer.env.document.createElement('img');                            image.setAttribute('src', state);                            image.setAttribute('class', 'waf-icon-' + i);                            element.appendChild(image);                        }                    }                    break;                case 'sprite':                    /*                     * Remove useless attributes                     */                    element.removeAttribute('data-image-state2');                    element.removeAttribute('data-image-state3');                    element.removeAttribute('data-image-state4');                    if (this.getAttribute('data-sprite-info').getValue()) {                        /*                         * Save states into css file                         */                        jsonObj = JSON.parse(this.getAttribute('data-sprite-info').getValue().replace(/\'/g, '"'))[0];                        for (i = 1; i <= 4; i += 1) {                            thisState = jsonObj['state' + i];                            if (thisState) {                                stateInfo = {                                    cssClass: 'waf-state-state' + i,                                    find: '',                                    label: 'state' + i,                                    selector: '#' + this.getId() + '.waf-state-state' + i                                };                                if (i == 1) {                                    stateInfo = null                                }                                this.setCss('background-position', thisState, undefined, undefined, stateInfo);                            }                        }                    }                    /*                     * Remove sprite info attribute                     */                    element.removeAttribute('data-sprite-info');                    break;            }        });        $(tag).bind('onStateChange', function(e) {            this.onDesign();        });        /**         * Update the sprite info attribute         * @method _updateSpriteInfo         * @param {string} state         * @param {string} left         * @param {string} top         */        tag._updateSpriteInfo = function(left, top) {            var            i,            json,            attr,            state,            jsonObj,            attrValue,            listStates;            state           = getTagStateLabel(this);            attr            = this.getAttribute('data-sprite-info');            attrValue       = attr.getValue();            listStates      = [];            if (attrValue) {                jsonObj = JSON.parse(attrValue.replace(/\'/g, '"'))[0];            } else {                jsonObj = {};            }            jsonObj[state]  = "-" + left + " -" + top;            for (i in jsonObj) {                listStates.push("'" + i + "' : '" + jsonObj[i] + "'");            }            json = "{"                + listStates.join(',')            + "}";            attr.setValue("[" + json + "]");        }        /**         * Get the path of the icon         * @function getPath         * @return {string}         */        tag.getPath = function icon_get_path () {            return this.getAttribute('data-image-state1').getValue();        }        /*         * Show default icon on create         */        tag._showIcon('state1');    }});/** * Display icon image path attribute depending on widget state * @method iconImageStateAttribute * @param {string} state */function iconImageStateAttribute(state) {    return {        tabCategory : 'Image',        tab         : 'style',        //category    : 'Image',        name        : 'data-image-' + state,        description : 'Src',        type        : 'file',        accept      : 'image/*',        state       : state,        onchange    : function(){            /*             * Refresh panels on path change             */            D.tag.refreshPanels();            /*             * Remove background image             */            this.data.tag.getHtmlObject().css('background-image', 'none');        },        ready       : function(){            var            tag,            data,            currentState;            data                = this.data;            tag                 = data.tag;            currentState        = getTagStateLabel(tag);            if (currentState != state || (tag.getAttribute('data-icon-type').getValue() == 'sprite' && currentState != "state1")) {                this.htmlObject.parent().parent().hide();            }        }    }}function getTagStateLabel (tag) {    var    currentState;    currentState    = tag.getCurrentState() || {};    currentState    = currentState.cssClass || 'waf-state-state1';    currentState    = currentState.replace('waf-state-', '');    return currentState;}/** * Create size and position inputs * @method createSpriteManagerInput * @param {object} tag * @param {object} spriteSelector * @param {string} prop * @param {object} render */function createSpriteManagerInput(tag, spriteSelector, prop, render) {    var    propLabel = prop;    prop = prop.toLowerCase();    /*     * Size inputs     */    new Designer.lib.form.TextField({        id      : 'waf-sprite-input-' + prop,        label   : propLabel + ':',        value   : parseInt(spriteSelector.css(prop)),        style   : {            'width'         : '40px',            'margin-right'  : '10px',            'float'         : 'none'        },        ready : function() {            this.htmlObject.parent().find('label').css({                'display'       : 'inline-block',                'width'         : '40px',                'text-align'    : 'right',                'margin-right'  : '10px'            })        },        onchange : function(){            var            i,            value,            selectionCount;            value = this.getValue();            spriteSelector.css(prop, value + 'px');            this.updateTag = function (tagElt, value, prop) {                if (prop == 'width') {                    tagElt.setWidth(value);                }                if (prop == 'height') {                    tagElt.setHeight(value);                }                if (prop == 'left' || prop == 'top') {                    tagElt._updateSpriteInfo(spriteSelector.css('left'), spriteSelector.css('top'));                    tagElt.onDesign();                }                tagElt.domUpdate();            }            selectionCount = Designer.env.tag.selection.count();            if (selectionCount > 1) {                for (i = 0; i < selectionCount; i += 1 ) {                    this.updateTag(Designer.env.tag.selection.get(i), value, prop);                }            } else {                this.updateTag(tag, value, prop);            }        }    }).render(render);}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/button/widget-button.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Button',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        text,        that,        toinnerHTML,        htmlObject,        nb,        thisI;        that        = this;        htmlObject  = this.$domNode;        text        = data.text === "" ? data.action : data.text;        nb          = 0;        if (this._textValue) {            text = this._textValue;        }        if (data['state-1'] && data.text === "") {            text = "";        }        /*         * Add button text         */        toinnerHTML = '<span class="text">' + text  + '</span>';        /*         * Add 4 states         */        for (var i = 1; i <= 4; i +=1) {            if (data['state-' + i]) {                toinnerHTML += '<img style="width:' + htmlObject.width() + 'px;height:' + htmlObject.height() + 'px;" src="' + data['state-' + i] + '" class="data-state-' + i +'" />';                nb += 1;            }        }        if (nb === 1) {            toinnerHTML = '<img style="width:' + htmlObject.width() + 'px;height:' + htmlObject.height() + 'px;" src="' +  data['state-' + i]  + '" class="data-state-1 data-state-2 data-state-3 data-state-4" />';        }        htmlObject.html(toinnerHTML);        /*         * Fix button text position         */        htmlObject.children('.text').css('margin-top', '-' + parseInt(htmlObject.css('font-size'))/2 + 'px');        /*         * ------------ <MOUSE EVENTS> ------------         * To change status         */         if (WAF.PLATFORM.isTouch) {             htmlObject.bind('touchstart', {}, function(e) {                that.setState('active');                 htmlObject._state = 'active';             });             htmlObject.bind('touchend', {}, function(e) {                that.setState('default');                 htmlObject._state = null;             });         } else {            htmlObject.hover(                function () {                    that.setState('hover');                },                function () {                    that.setState('default');                }            );            htmlObject.bind('mousedown', {}, function(e) {                that.setState('active');                htmlObject._state = 'active';            });            htmlObject.bind('mouseup', {}, function(e) {                that.setState('hover');                htmlObject._state = null;            });            htmlObject.focusin(function() {                if (htmlObject._state != 'active') {                    that.setState('focus');                }            });            htmlObject.focusout(function() {                that.setState('default');            });         }        /*         * ------------ </MOUSE EVENTS> ------------         */        /*         * BUTTON NAVIGATION         */        if (data['link']) {            htmlObject.bind('click', {}, function(e) {                switch(data['target']) {                    case '_blank':                        window.open(data['link']);                        break;                    default :                        window.location = data['link'];                        break;                }            });        }        /*         * Add actions on data source if button is binded         */        if (this.source) {            var eventAction = "click";            if (WAF.PLATFORM.isTouch) {                eventAction = "touchstart";            }            htmlObject.bind(eventAction, {}, function(e){                switch (data['action']) {                    case 'create' :                        that.source.addNewElement();                        break;                    case 'save' :                        that.source.save();                        break;                    case 'next' :                        that.source.selectNext();                        break;                    case 'previous' :                        that.source.selectPrevious();                        break;                    case 'last' :                        var length = that.source._private.entityCollection.length;                        that.source.select( parseInt(length-1) );                        break;                    case 'first' :                        that.source.select(0);                        break;                    case 'remove' :                        that.source.removeCurrent();                        break;                    default:                        break;                }            })        }    },{        ready : function button_ready () {            if (this.$domNode.data('action') && (this.$domNode.data('text') === '' || this.$domNode.data('text') == null)) {                this._textValue = WAF.utils.ucFirst(this.$domNode.data('action'));                this.$domNode.find('.text').html(this._textValue);            }        },        /**         * Custom getValue function         * @method getValue         * @param {string} value         */        getValue : function button_set_value (value) {            return this.$domNode.text();        },        /**         * Custom setValue function         * @method setValue         * @param {string} value         */        setValue : function button_set_value (value) {            this.$domNode.text(value);        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/button/widget-button-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'button',    lib        : 'WAF',    description: 'Button',    category   : 'Form Controls',    img        : '/walib/WAF/widget/button/icons/widget-button.png',    tag        : 'button',    attributes : [    {        name        : 'data-binding',        description : 'Source',        onchange    : function(){            if (!this.getValue()) {                $('#dropdown-data-action').parent().parent().hide();            } else {                $('#dropdown-data-action').parent().parent().show();            }        }    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-state-1',        visibility : 'hidden'    },    {        name       : 'data-state-2',        visibility : 'hidden'    },    {        name       : 'data-state-3',        visibility : 'hidden'    },    {        name       : 'data-state-4',        visibility : 'hidden'    },    {        name        : 'data-action',        description : 'Action',        defaultValue: 'simple',        type        : 'dropdown',        options     : [{            key     : 'create',            value   : 'Create'        },{            key     : 'simple',            value   : 'Simple'        },{            key     : 'save',            value   : 'Save'        },{            key     : 'next',            value   : 'Next'        },{            key     : 'previous',            value   : 'Previous'        },{            key     : 'last',            value   : 'Last'        },{            key     : 'first',            value   : 'First'        },{            key     : 'remove',            value   : 'Remove'        }],        ready     : function(){            var            i,            tag,            selection,            selectionL;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                if (!this.data.tag.getSource()) {                    this.getHtmlObject().parent().parent().hide();                }            } else {                if (!D.ui.selection.getAttribute('data-binding').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            }        }    },    {        name       : 'data-text',        description: 'Text'    },    {        name        : 'data-link',        description : 'Link',        onchange    : function(){            if (!this.getValue()) {                $('#dropdown-data-target').parent().parent().hide();            } else {                $('#dropdown-data-target').parent().parent().show();            }        }    },    {        name        : 'data-target',        description : 'Target',        type        : 'dropdown',        options     : ['_blank', '_self'],        defaultValue: '_blank',        ready     : function(){            var            i,            tag,            selection,            selectionL;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                if (!this.data.tag.getAttribute('data-link').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            } else {                if (!D.ui.selection.getAttribute('data-link').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            }        }    },    {        name        : 'tabindex',        description : 'Tabindex',        typeValue   : 'integer'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    style: [,    {        name        : 'width',        defaultValue: '92px'    },    {        name        : 'height',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "29px";                } else {                    result = "22px";                }            }        return result;    }.call()    }],    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            shadow      : true,            textShadow  : true,            innerShadow : true,            label       : false        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '',                mobile  : true        },{                label   : 'focus',                cssClass: 'waf-state-focus',                find    : '',                mobile  : true        },{                label   : 'disabled',                cssClass: 'waf-state-disabled',                find    : '',                mobile  : true        }]    },    onInit: function (config) {        var button = new WAF.widget.Button(config);        return button;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        tagId,        nb,        thisI,        toinnerHTML,        textSize,        url,        path,        htmlObject,        dbClickFn,        htmlObjectInput,        imgHTML;        tagId       = tag.getId();        htmlObject  = $('#' + tagId);        nb          = 0;        thisI       = 0;        textSize    = 0;        toinnerHTML = '';        url         = '';        path        = '';        imgHTML     = '';        if (!isResize) {            var text = tag.getAttribute('data-text').getValue();            if (text.length == 0 && tag.getAttribute('data-action').getValue() == "simple") {                text = '[' + tagId + ']';            } else if (text.length == 0 && tag.getAttribute('data-action').getValue() != "simple") {                text = WAF.utils.ucFirst(tag.getAttribute('data-action').getValue());            }            if (tag.getAttribute('data-state-1').getValue() && !tag.getAttribute('data-text').getValue() ) {                text = '';            }            toinnerHTML = '<span class="text"></span>';            if (tag.getAttribute('data-src')) {                path = Designer.util.formatPath(tag.getAttribute('data-state-' + thisI).getValue());                url = path.fullPath;            }            // Append 4 states            if (nb === 1) {                url = Designer.util.formatPath(tag.getAttribute('data-state-' + thisI).getValue()).fullPath;                imgHTML += '<img src="' + url  + '" class="data-state-1 data-state-2 data-state-3 data-state-4" />';            } else {                for (var i = 1; i <= 4; i +=1) {                    if (tag.getAttribute('data-state-' + i) && tag.getAttribute('data-state-' + i).getValue()) {                        url = Designer.util.formatPath(tag.getAttribute('data-state-' + i).getValue()).fullPath;                        imgHTML += '<img src="' + url  + '" class="data-state-' + i + '" />';                        nb += 1;                        thisI = i;                    }                }            }            htmlObject.html(toinnerHTML + imgHTML);            // escape text            $('#' + tagId + ' span').text(text);            if (tag.style['font-size']) {                textSize = tag.style['font-size'];            } else {                textSize = $('#' + tagId + ' span.text').css('font-size');            }            $('#' +tagId + ' .text').css('margin-top', '-' + parseInt(textSize)/2 + 'px');            // Dblclick event            htmlObject.bind('dblclick', {}, dbClickFn = function dbClickFn (e) {                var                text;                Designer.env.editMode = tag;                tag.setFocus(true);                /* No text for image or none button theme */                if ((tag.getTheme() === 'image' || tag.getTheme() === 'none') && !tag.getAttribute('data-text').getValue() ) {                    return;                }                text = tag.getAttribute('data-text').getValue();                if (text.length == 0 && tag.getAttribute('data-action').getValue() == "simple") {                    text = '[' + tagId + ']';                } else if (text.length == 0 && tag.getAttribute('data-action').getValue() != "simple") {                    text = WAF.utils.ucFirst(tag.getAttribute('data-action').getValue());                }                // Disable the events key                Designer.ui.core.disableKeyEvent();                Designer.api.setListenerMode(false);                tag.resize.lock(true);                YAHOO.util.Event.stopEvent(e);                $(this).prop('disabled', 'disabled');                // lock d&d                tag.lock();                htmlObject.html('<input />' + imgHTML);                htmlObjectInput = htmlObject.children('input');                htmlObjectInput.focus();                htmlObjectInput.val(text);                // Append inherit css                htmlObjectInput.css({                    'width'             : tag.getWidth() + 'px',                    'height'            : tag.getHeight() + 'px',                    'resize'            : 'none',                    'overflow'          : 'hidden',                    'background'        : 'none',                    'border'            : 'none',                    'font-size'         : 'inherit',                    'font-style'         : 'inherit',                    'font-family'       : 'inherit',                    'font-weight'       : 'inherit',                    'text-decoration'   : 'inherit',                    'text-align'        : 'inherit',                    'letter-spacing'    : 'inherit',                    'color'             : tag.getComputedStyle('color'),                    'margin-top'        : '-1px',                    'margin-left'       : '-1px'                });                htmlObjectInput.select();                htmlObjectInput.bind('keydown', {}, function (e) {                    if (e.keyCode === 13) {                        $(this).blur();                    }                })                htmlObjectInput.bind('blur', {}, function(e){                    var                    newValue;                    newValue = $(this).val();                    if (D.getCurrent() && D.getCurrent() === tag) {                        tag.setResizable(true);                    }                    htmlObject.bind('dblclick', {}, dbClickFn);                    // unlock d&d                    tag.unlock();                    tag.getAttribute('data-text').setValue(newValue);                    tag.update();                    tag.domUpdate();                    tag.editBox = null;                    Designer.ui.core.enableKeyEvent();                    Designer.api.setListenerMode(true);                    tag.resize.unlock(true);                    htmlObject.html('<span class="text"></span>' + imgHTML);                    // escape text                    $('#' + tagId + ' span').text(newValue);                    htmlObject.removeProp('disabled');                    D.tag.refreshPanels();                    Designer.env.editMode = false;                });            });        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/buttonImage/widget-buttonImage.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'ButtonImage',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        that,        htmlObject;        that        = this;        htmlObject  = this.$domNode;        /*         * BUTTON NAVIGATION         */        if (data['link']) {            htmlObject.bind('click', {}, function(e) {                switch(data['target']) {                    case '_blank':                        window.open(data['link']);                        break;                    default :                        window.location = data['link'];                        break;                }            });        }        /*         * Add actions on data source if button is binded         */        if (this.source) {            htmlObject.bind('click', {}, function(e){                switch (data['action']) {                    case 'create' :                        that.source.addNewElement();                        break;                    case 'save' :                        that.source.save();                        break;                    case 'next' :                        that.source.selectNext();                        break;                    case 'previous' :                        that.source.selectPrevious();                        break;                    case 'last' :                        var length = that.source._private.entityCollection.length;                        that.source.select( parseInt(length-1) );                        break;                    case 'first' :                        that.source.select(0);                        break;                    case 'remove' :                        that.source.removeCurrent();                        break;                    default:                        break;                }            })        }    },{        /**         * Custom ready function         * @method ready         */        ready : function (){            var            that,            icon,            htmlObject;            that        = this;            htmlObject  = this.$domNode;            icon        = this.getIcon();            /*             * ------------ <MOUSE EVENTS> ------------             * To change status             */            if (WAF.PLATFORM.isTouch) {                htmlObject.bind('touchstart', {}, function(e) {                    that.setState('active');                    icon.setState('active');                    htmlObject._state = 'active';                });                htmlObject.bind('touchend', {}, function(e) {                    that.setState('default');                    icon.setState('default');                    htmlObject._state = null;                });            } else {                htmlObject.hover(                    function () {                        that.setState('hover');                        icon.setState('hover');                    },                    function () {                        that.setState('default');                        icon.setState('default');                    }                );                htmlObject.bind('mousedown', {}, function(e) {                    that.setState('active');                    icon.setState('active');                    htmlObject._state = 'active';                });                htmlObject.bind('mouseup', {}, function(e) {                    that.setState('hover');                    icon.setState('hover');                    htmlObject._state = null;                });                htmlObject.focusin(function() {                    if (htmlObject._state != 'active') {                        that.setState('focus');                    }                });                htmlObject.focusout(function() {                    that.setState('default');                });                /*                 * ------------ </MOUSE EVENTS> ------------                 */            }        },        /**         * Custom setState function         * @method setState         * @param {string} state : value of the state         */         setState : function setState (state) {            var            icon;            /*             * Call super class disable function             */            WAF.Widget.prototype.setState.call(this, arguments);            if (state == "active") {                this.$domNode.addClass("waf-state-active");            } else {                this.$domNode.removeClass("waf-state-active");            }            /*             * Set icon state             */             icon = this.getIcon();             icon.setState(state);         },        /**         * Get icon state         * @method _getIconState         * @return {string} state value         */        _getIconState : function buttonImage_get_icon_state () {            var            nState;            switch(state) {                case 'waf-state-hover':                    nState = 'waf-state-state2';                    break;                case 'waf-state-active':                    nState = 'waf-state-state3';                    break;                case 'waf-state-disabled':                    nState = 'waf-state-state4';                    break;                default:                    nState = 'waf-state-state1';                    break;            }            return nState;        },        /**         * Get icon widget         * @method getIcon         * @return {object} icon widget         */        getIcon : function buttonImage_get_icon () {            return this.getLinks()[0];        },        /**         * Custom getValue function         * @method getValue         * @param {string} value         */        getValue : function buttonImage_set_value (value) {            return this.$domNode.text();        },        /**         * Custom setValue function         * @method setValue         * @param {string} value         */        setValue : function buttonImage_set_value (value) {            this.$domNode.text(value);        },        /**         * Custom disable function (enable sub widgets)         * @method enable         */        disable : function buttonImage_disable() {            /*             * Disable icon             */            this.getIcon().disable();            /*             * Call super class disable function             */            WAF.Widget.prototype.disable.call(this);        },        /**         * Custom enable function (enable sub widgets)         * @method enable         */        enable : function buttonImage_enable() {            /*             * Enable icon             */            this.getIcon().enable();            /*             * Call super class enable function             */            WAF.Widget.prototype.enable.call(this);        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/buttonImage/widget-buttonImage-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'buttonImage',    lib        : 'WAF',    description: 'Image Button',    category   : 'Form Controls',    bindable   : 'EntityModel,relatedEntity,relatedEntities',    img        : '/walib/WAF/widget/buttonImage/icons/widget-buttonImage.png',    tag        : 'div',    attributes : [    {        name        : 'data-binding',        description : 'Source',        onchange    : function(){            if (!this.getValue()) {                $('#dropdown-data-action').parent().parent().hide();            } else {                $('#dropdown-data-action').parent().parent().show();            }        }    },    {        name        : 'data-action',        description : 'Action',        defaultValue: 'simple',        type        : 'dropdown',        options     : [{            key     : 'create',            value   : 'Create'        },{            key     : 'simple',            value   : 'Simple'        },{            key     : 'save',            value   : 'Save'        },{            key     : 'next',            value   : 'Next'        },{            key     : 'previous',            value   : 'Previous'        },{            key     : 'last',            value   : 'Last'        },{            key     : 'first',            value   : 'First'        },{            key     : 'remove',            value   : 'Remove'        }],        onchange    : function(){            /*             * Auto change image button label             */            this.data.tag._changeLabel(WAF.utils.ucFirst(this.getValue()));            D.tag.refreshPanels();        },        ready     : function(){            if (!this.data.tag.getSource()) {                this.getHtmlObject().parent().parent().hide();            }        }    },    {        name       : 'class',        description: 'Css class'    },    {        name        : 'data-text',        description : 'Text',        /*         * Get label text         */        ready       : function() {            var            i,            tag,            icon,            data,            label,            diffLabel,            selection,            selectionL,            labelValue;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                data    = this.data;                tag     = data.tag;                icon    = tag.getLinks()[0];				if (typeof icon !== 'undefined') {					label   = icon.getLabel();				}                if (label && label.status != 'destroy') {                    this.setValue(label.getAttribute('data-text').getValue());                } else {                    this.setValue('');                }            } else {                diffLabel = false;                for (i = 0; i < selectionL; i += 1) {                    tag     = selection.get(i);                    icon    = tag.getLinks()[0];                    label   = icon.getLabel();                    if (labelValue && labelValue != label.getAttribute('data-text').getValue()) {                        diffLabel = true;                        break;                    }                    labelValue = label.getAttribute('data-text').getValue();                }                if (!diffLabel) {                    this.setValue(labelValue);                } else {                    this.setValue('');                }            }        },        /*         * Change label text         */        onchange    : function() {            var            i,            tag,            selection,            selectionL;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                /*                 * Auto change image button label                 */                this.data.tag._changeLabel(this.getValue(), true);            } else {                for (i = 0; i < selectionL; i += 1) {                    tag = selection.get(i);                    tag._changeLabel(this.getValue(), true);                }            }        }    },    {        name        : 'data-link',        description : 'Link',        onchange    : function(){            if (!this.getValue()) {                $('#dropdown-data-target').parent().parent().hide();            } else {                $('#dropdown-data-target').parent().parent().show();            }        }    },    {        name        : 'data-target',        description : 'Target',        type        : 'dropdown',        options     : ['_blank', '_self'],        defaultValue: '_blank',        ready     : function(){            if (!this.data.tag.getAttribute('data-link').getValue()) {                this.getHtmlObject().parent().parent().hide();            }        }    },    {        name        : 'tabindex',        description : 'Tabindex',        typeValue   : 'integer'    }],    events: [{        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    style: [,    {        name        : 'width',        defaultValue: '130px'    },    {        name        : 'height',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "29px";                } else {                    result = "45px";                }            }        return result;    }.call()    }],    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            shadow      : true,            textShadow  : false,            innerShadow : true,            label       : false        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '',                mobile  : true        },{                label   : 'focus',                cssClass: 'waf-state-focus',                find    : '',                mobile  : true        },{                label   : 'disabled',                cssClass: 'waf-state-disabled',                find    : '',                mobile  : true        }]    },    onInit: function (config) {        new WAF.widget.ButtonImage(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        if (isResize) {            /*             * Center content             */            tag._centerContent();        }    },    onCreate: function (tag, param) {        var        icon,        group,        iconLabel;        /**         * Get the linked icon widget         * @method getWidgetIcon         * @return {object}         */        tag.getWidgetIcon = function buttonImage_get_widget_label() {            var            icon;            icon = this.getLinks()[0] || null;            return icon;        }        /**         * Get the linked label widget         * @method getWidgetLabel         * @return {object}         */        tag.getWidgetLabel = function buttonImage_get_widget_label() {            var            icon,            label;            icon    = this.getWidgetIcon();            label   = icon.getLabel() || null            if (label.status == "destroy") {                label = null;            }            return label;        }        /**         * Change the label value of the linked icon         * @method _autoChangeLabel         * @param {string} newValue         * @param {boolean} force : force label change         */        tag._changeLabel = function buttonImage_change_label(newValue, force) {            var            icon,            label,            value,            attribute;            icon        = this.getWidgetIcon();            label       = icon.getLabel();            if (label && label.status != 'destroy') {                attribute   = label.getAttribute('data-text');                value       = attribute.getValue();                /*                 * Destroy label if no value                 */                if (newValue == '') {                    D.tag.deleteWidgets(label, undefined, undefined, false);                }                if (force || value == "[" + this.getId() + "]" || /create|save|next|previous|simple|last|first|remove/.test(value.toLowerCase())){                    attribute.setValue(newValue);                    icon.getAttribute('data-label').setValue(newValue);                    icon.onDesign(true);                    icon.domUpdate();                    label.onDesign(true);                    label.domUpdate();                }            } else {                /*                 * Create label widget                 */                icon.getAttribute('data-label').setValue(newValue);                D.tag.setLabel(icon)                icon.onDesign(true);                icon.domUpdate();            }        }        /**         * Init widget : bind custom events         * @method _init         */        tag._init = function buttonImage_init() {            var            icon,            iconLabel;            icon        = this.getLinks()[0];            iconLabel   = icon.getLabel();            /*             * Prevent binding on icon and label             */            if (icon) {                icon.preventBinding = true;            }            icon._inButton = true;            /*             * Center content on icon design change             */            $(icon).bind('onWidgetDesign', function(){                var                button;                button = this.getLinks()[0];                button._centerContent();                /*                 * Refresh focus position                 */                Designer.ui.focus.setPosition(icon);                Designer.ui.focus.setSize(icon);            });            if (iconLabel && iconLabel.status != 'destroy') {                iconLabel.preventBinding = true;                /*                 * Center content on icon design change                 */                $(iconLabel).bind('onWidgetDesign', function(){                    var                    icon,                    button;                    icon    = this.getLinkedTag();                    button  = icon.getLinks()[0];                    button._centerContent();                    /*                     * Refresh focus position                     */                    Designer.ui.focus.setPosition(icon);                    Designer.ui.focus.setSize(icon);                });                /*                 * Icon label custom on file drop event                 * Trigger icon onFileDrop event                 */                $(iconLabel).bind('onFileDrop', {tag : tag}, function(e, data) {                    data.keepSize = true;                    $(e.data.tag).trigger('onFileDrop', data);                });                /*                 * Icon label custom on destroy event                 * Reset position                 */                $(iconLabel).bind('onWidgetDestroy', {tag : tag}, function() {                    tag._centerContent();                })            }            /*             * Widget custom on file drop event             * Trigger icon onFileDrop event             */            $(tag).bind('onFileDrop', {}, function(e, data) {                var                icon;                icon = this.getLinks()[0];                data.silentMode = true;                data.keepSize = true;                $(icon).trigger('onFileDrop', data);                this.setCurrent();                D.tag.refreshPanels();            });            /*             * Widget custom dom update event             * Remove useless attributes             */            $(tag).bind('onDomUpdate', function(e, element) {                element.removeAttribute('data-text');            });            /*             * Widget custom on state change event             * Also change sub widgets  states             */            $(tag).bind('onStateChange', function(){                var                icon,                state,                nState,                stateObj,                iconState,                iconLabel,                iconStateObj,                disableButton;                icon            = this.getWidgetIcon();                stateObj        = this.getCurrentState();                state           = stateObj ? stateObj.cssClass : '';                iconStateObj    = icon.getCurrentState();                iconState       = iconStateObj ? iconStateObj.cssClass : '';                iconLabel       = icon.getLabel();                /*                 * Get equivalence                 */                switch(state) {                    case 'waf-state-hover':                        nState = 'waf-state-state2';                        break;                    case 'waf-state-active':                        nState = 'waf-state-state3';                        break;                    case 'waf-state-disabled':                        nState = 'waf-state-state4';                        break;                    default:                        nState = 'waf-state-state1';                        break;                }                /*                 * Change icon state                 */                if (iconState != nState) {                    icon.changeState(nState);                    if (iconLabel) {                        iconLabel.changeState(nState);                    }                }            });            /*             * Widgeticon  custom on state change event             * Also change parent widget states             */            $(icon).bind('onStateChange', function(){                var                state,                button,                stateObj,                buttonState,                buttonStateObj;                button = this.getLinks()[0];                stateObj        = this.getCurrentState();                state           = stateObj ? stateObj.cssClass : '';                buttonStateObj  = button.getCurrentState();                buttonState     = buttonStateObj ? buttonStateObj.cssClass : '';                /*                 * Get equivalence                 */                switch(state) {                    case 'waf-state-state2':                        state = 'waf-state-hover';                        break;                    case 'waf-state-state3':                        state = 'waf-state-active';                        break;                    case 'waf-state-state4':                        state = 'waf-state-disabled';                        break;                    default:                        state = '';                        break;                }                /*                 * Change button state                 */                if (buttonState == 'waf-state-focus' && state == '') {                    // DO NOTHING                } else if (buttonState != state) {                    button.changeState(state);                }            });            /*             * Icon label custom on destroy event             * Reset position             */            $(icon).bind('onWidgetDestroy', {tag : tag}, function() {                if (tag.status != 'destroy') {                    D.tag.deleteWidgets(tag);                }            })        }        /**         * Center the content of the widget         * @method _centerContent         */        tag._centerContent = function buttonImage_center_content() {            var            icon,            newTop,            newLeft,            labelPos,            eltWidth,            tagWidth,            eltHeight,            tagHeight,            iconLabel,            iconWidth,            iconHeight,            htmlObject,            iconMargin;            icon        = this.getLinks()[0];            tagWidth    = this.getWidth();            tagHeight   = this.getHeight();            if (!icon) {                return;            }            htmlObject  = this.getHtmlObject();            iconWidth   = eltWidth = icon.getWidth();            iconHeight  = eltHeight= icon.getHeight();            iconLabel   = icon.getLabel();            /*             * Include label size to position calcul             */            if (iconLabel && iconLabel.status != 'destroy') {                labelPos    = icon.getAttribute('data-label-position').getValue();                iconMargin  = parseInt(iconLabel.getAttribute('data-margin').getValue())                switch (labelPos) {                    case 'left':                        eltWidth   += iconLabel.getWidth() + iconMargin;                        newLeft     = (tagWidth/2) + (eltWidth/2) - iconWidth;                        newTop      = (tagHeight/2) - (eltHeight/2);                        break;                    case 'right':                        eltWidth   += iconLabel.getWidth()+ iconMargin;                        newLeft     = (tagWidth/2) - (eltWidth/2);                        newTop      = (tagHeight/2) - (eltHeight/2);                        break;                    case 'top':                        eltHeight  += iconLabel.getHeight() + iconMargin;                        newLeft     = (tagWidth/2) - (eltWidth/2);                        newTop      = (tagHeight/2) + (eltHeight/2) - iconHeight;                        break;                    case 'bottom':                        eltHeight  += iconLabel.getHeight() + iconMargin;                        newLeft     = (tagWidth/2) - (eltWidth/2);                        newTop      = (tagHeight/2) - (eltHeight/2);                        break;                }            } else {                newLeft = (tagWidth/2) - (eltWidth/2);                newTop  = (tagHeight/2) - (eltHeight/2);            }            icon.setXY(newLeft, newTop, true, false);            if (iconLabel && iconLabel.status != 'destroy') {                /*                 * Refresh label position                 */                iconLabel._refreshPosition();            }        }        if (!param._isLoaded) {            /*             * Create icon widget with label             */            icon = D.createTag({                type        : 'icon',                silentMode  : true,                parent      : tag,                width       : 24,                height      : 24,                left        : 5,                top         : 10,                attr        : {                    'data-label'            : '[' + tag.getId() + ']',                    'data-label-position'   : 'right'                }            });            /*             * Link widgets             */            icon.link(tag);            tag.link(icon);            /*             * Group widgets             */            group = new Designer.ui.group.Group();            group.add(tag);            group.add(icon);            group.add(icon.getLabel());            /*             * Save the group             */            Designer.ui.group.save();            /*             * Create a label to the icon             */            D.tag.setLabel(icon);            iconLabel = icon.getLabel();            /*             * Set label align if not defined             */            if (iconLabel && iconLabel.status != 'destroy') {                iconLabel.getAttribute('data-valign').setValue('middle');                iconLabel.setCss('text-align', 'center');            }            /*             * Center content             */            tag._centerContent();            /*             * Init button             */            tag._init();        } else {            $(tag).bind('onReady', function(){            /*             * Init button             */                this._init();            });        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/checkbox/widget-checkbox.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Checkbox',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        i,        icon,        theme,        icons,        widget,        themes,        classes,        imgHtml,        readOnly,        cssClass,        htmlObject,        definedTheme,        checkboxHtml;        config      = config || {};        widget      = this;        htmlObject  = this.$domNode;        classes     = htmlObject.prop('class');        themes      = [];		// since we cannot rely on checkbox.is:checked nor checkbox.attr('checked'), we store the state of the checkbox there		// for some odd reasons, chrome's is:checked status isn't updated in some cases		this._checked = false;        /*         * Get widget theme         */        for (i in WAF.widget.themes) {            theme = WAF.widget.themes[i].key;            if (classes.match(theme)) {                themes.push(theme);                if (theme != 'inherited') {                    definedTheme = theme;                }            }        }        htmlObject.children().remove()        $('<div class="waf-checkbox-box">').appendTo(htmlObject);        icons   = [];        if (data['icon-default'])    icons.push({cssClass : 'waf-checkbox-icon-default',  value : data['icon-default']});        if (data['icon-hover'])      icons.push({cssClass : 'waf-checkbox-icon-hover',    value : data['icon-hover']});        if (data['icon-active'])     icons.push({cssClass : 'waf-checkbox-icon-active',   value : data['icon-active']});        if (data['icon-selected'])   icons.push({cssClass : 'waf-checkbox-icon-selected', value : data['icon-selected']});        cssClass    = 'waf-icon waf-checkbox-icon';        if (icons.length == 0) {            cssClass += ' waf-icon-svg';        } else {            cssClass += ' waf-icon-image';        }        icon    = $('<div class="' + cssClass + '">');        /*         * Img icon         */        if (icons.length > 0) {            for (i = 0; i < icons.length; i += 1) {                imgHtml = $('<img>');                imgHtml.addClass(icons[i].cssClass);                imgHtml.prop({                    src : icons[i].value                });                imgHtml.appendTo(icon);            }        /*         * Svg icon         */        } else {            icon.svg({                loadURL: '/walib/WAF/widget/checkbox/skin/' + definedTheme + '/svg/widget-checkbox-skin-' + definedTheme + '.svg',                onLoad: function(svg) {                    svg.configure({                        width: '100%',                        height: '100%',                        preserveAspectRatio: 'none'                    });                }            });        }        icon.appendTo(htmlObject);        checkboxHtml = $('<input>').prop('type', 'checkbox');        checkboxHtml.appendTo(htmlObject);        /*         * Check the box if checked is true         */        if (data.checked === 'true' || data.checked === true) {			this._checked = true;            checkboxHtml.prop('checked', 'checked');            htmlObject.addClass('waf-state-selected');        } else {			this._checked = false;            checkboxHtml.removeProp('checked');        }        /*         * ------------ <MOUSE EVENTS> ------------         * To change status         */        htmlObject.hover(            function () {                widget.setState('hover');            },            function () {                widget.setState('default');            }        );        htmlObject.bind('mousedown', {widget : this}, function(e) {            widget.removeState('selected');            widget.setState('active');        });        htmlObject.bind('mouseup', {widget : this}, function(e) {            widget.setState('hover');        });        checkboxHtml.bind('change', function() {			widget._checked = !widget._checked;			var value;            if (widget._checked) {				value = true;                widget.setState('selected');            } else {				widget.removeState('selected');                widget.setState('default');				value = false;            }			if (widget.sourceAtt != null)				widget._changeDsValue(value);		});        htmlObject.focusin(function() {            widget.setState('focus');        });        htmlObject.focusout(function() {            widget.setState('default');        });        /*         * Active click on checkbox label to check/uncheck         */        $('label[for=' + widget.id + ']').bind('click', {widget: widget}, function(e) {            widget.toggleCheckbox();        });        /*         * ------------ </MOUSE EVENTS> ------------         */        /*         * Data sources binded         */        if (this.sourceAtt) {            //checkboxHtml.unbind('click');            readOnly    = this.att.readOnly;			/*            checkboxHtml.bind('click', {widget : this}, function(e) {                var                value;                if (widget._checked) {                    value = true;                } else {                    value = false;                }                e.data.widget._changeDsValue(value);            })			*/            if (readOnly) {                htmlObject.disabled = true;            } else {                htmlObject.disabled = false;            }            /*             * Save value if binding "in" is defined             */            this.sourceAtt.addListener(function(e) {                var                widget,                widgetID,                htmlObject,                checkboxHtml,                value;                widget          = e.data.widget;                widgetID        = widget.id;                htmlObject      = $('#' + widgetID);                checkboxHtml    = htmlObject.find('input');                widget.clearErrorMessage();                if (checkboxHtml.length > 0) {                    value = widget.sourceAtt.getValue();                    if (!value || value === 'false') {						widget._checked = false;                        checkboxHtml[0].checked = false;                        checkboxHtml.attr('checked', false);                        widget.removeState('selected');                        widget.setState('default');                    } else {                        checkboxHtml[0].checked = true;						widget._checked = true;                        checkboxHtml.attr('checked', 'checked');                        widget.setState('selected');                    }                }            }, {                listenerID      : config.id,                listenerType    : 'checkBox',                subID           : config.subID ? config.subID : null            },{                widget  : this            });        }    }, {        /**          * Change the associated ds attribute value          * @function _changeDsValue          * @param {boolean} value          */        _changeDsValue : function(value) {            var            widget,            sourceAtt;            checkboxHtml = this.$domNode.find('input');            if (this.sourceAtt && !this.isDisabled()) {                sourceAtt   = this.source.getAttribute(this.att.name);                sourceAtt.setValue(value, {                    dispatcherID: this.id                });                this.clearErrorMessage();            }        },        /**         * Check the checkbox         * @method check         */        check : function checkbox_check() {            var            htmlObject,            checkboxHtml;            if (this._checked !== true) {                this._checked = true;                htmlObject      = this.$domNode                checkboxHtml    = htmlObject.find('input');                htmlObject.removeClass("waf-state-active");                htmlObject.addClass('waf-state-selected');                checkboxHtml.attr('checked', 'checked');                this.$domNode.trigger('change');                this._changeDsValue(true);            }        },        /**         * Uncheck the checkbox         * @method uncheck         * @param updateDs         */        uncheck : function checkbox_uncheck(updateDs) {            var            htmlObject,            checkboxHtml;            if (this._checked !== false) {    			this._checked = false;                htmlObject      = this.$domNode                checkboxHtml    = htmlObject.find('input');                htmlObject.removeClass("waf-state-active");                htmlObject.removeClass('waf-state-selected');                checkboxHtml.attr('checked', false);                this.$domNode.trigger('change');                if (updateDs !== false) {                    this._changeDsValue(false);                }            }        },        /**         * Check or uncheck the checkbox         * @method toggleCheckbox         */        toggleCheckbox : function checkbox_toggle_checkbox() {            var            htmlObject,            checkboxHtml;            htmlObject      = this.$domNode            checkboxHtml    = htmlObject.find('input');            if (this._checked) {                this.uncheck();            } else {                this.check();            }            /*             * Trigger on change event             */            // this.$domNode.trigger('change');        },        /**         * Custom getValue function         * @method getValue         * @return {boolean}         */        getValue : function checkbox_get_value() {			return this._checked;        },		disable: function() {			this.$domNode.find('input').attr('disabled', 'disabled');			WAF.Widget.prototype.disable.call(this);		},		enable: function() {			this.$domNode.find('input').attr('disabled', false);			WAF.Widget.prototype.enable.call(this);		},        /**         * Custom setValue function         * @method getValue         */        setValue : function checkbox_set_value(value) {            if (!this.isDisabled()) {                if (value) {                    this.check();                } else {                    this.uncheck();                }            }            /*             * Trigger on change event             */            //this.$domNode.trigger('change');        },        /**         * Custom clear function         * @method clear         * @param updateDs         */        clear : function checkbox_clear(updateDs) {            this.uncheck(updateDs);        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/checkbox/widget-checkbox-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'checkbox',    lib        : 'WAF',    description: 'Checkbox',    category   : 'Form Controls',    img        : '/walib/WAF/widget/checkbox/icons/widget-checkbox.png',    tag        : 'div',    attributes : [    {        name        : 'type',        defaultValue: 'checkbox'    },    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-errorDiv',        description: 'Display Error'    },    {        name        : 'data-checked',        description : 'Checked',        type        : 'checkbox'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'right'    },    {        name        : 'tabindex',        description : 'Tabindex',        typeValue   : 'integer'    },    {        name        : 'data-icon-default',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    },    {        name        : 'data-icon-hover',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    },    {        name        : 'data-icon-active',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    },    {        name        : 'data-icon-selected',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    }],    style: [    {        name        : 'width',        defaultValue: '16px'    },    {        name        : 'height',        defaultValue: '16px'    }],    events: [    {        name       : 'change',        description: 'On Change',        category   : 'Focus Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : false,            background  : true,            border      : false,            sizePosition: true,            label       : true,            disabled    : ['border-radius']        }    },    structure: [{        description : 'box',        selector    : '.waf-checkbox-box',        style: {            background  : true,            gradient    : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover'        },{                label   : 'active',                cssClass: 'waf-state-active'        },{                label   : 'selected',                cssClass: 'waf-state-selected'        },{                label   : 'disabled',                cssClass: 'waf-state-disabled'        }]    }/*,{        description : 'icon',        selector    : '.waf-checkbox-icon',        style: {            background  : true,            shadow      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover'        },{                label   : 'active',                cssClass: 'waf-state-active'        },{                label   : 'selected',                cssClass: 'waf-state-selected'        }]    }*/],    onInit: function (config) {        return new WAF.widget.Checkbox(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        i,        htmlObject,        icon,        icons,        url,        path,        imgHtml,        cssClass,        theme;        htmlObject  = $('#' + tag.getId());        theme       = $.trim(tag.getTheme().replace('inherited', ''));        if (!isResize) {            $('<div class="waf-checkbox-box">').appendTo(htmlObject);            icons = [];            if (config['data-icon-default'])    icons.push({cssClass : 'waf-checkbox-icon-default',  value : config['data-icon-default']});            if (config['data-icon-hover'])      icons.push({cssClass : 'waf-checkbox-icon-hover',    value : config['data-icon-hover']});            if (config['data-icon-active'])     icons.push({cssClass : 'waf-checkbox-icon-active',   value : config['data-icon-active']});            if (config['data-icon-selected'])   icons.push({cssClass : 'waf-checkbox-icon-selected', value : config['data-icon-selected']});            cssClass    = 'waf-icon waf-checkbox-icon';            if (icons.length == 0) {                cssClass += ' waf-icon-svg';            } else {                cssClass += ' waf-icon-image';            }            icon = $('<div class="' + cssClass + '">');            if (icons.length > 0) {                for (i = 0; i < icons.length; i += 1) {                    path = Designer.util.cleanPath(icons[i].value.replace('/', ''));                    url = path.fullPath;                    //url = 'http://kpitalrisk.free.fr/images/stars/17000/s_toto1.jpg'                    imgHtml = $('<img>');                    imgHtml.addClass(icons[i].cssClass);                    imgHtml.prop({                        src : url                    });                    imgHtml.appendTo(icon);                }            } else {                icon.svg({                    loadURL: '/walib/WAF/widget/checkbox/skin/' + theme + '/svg/widget-checkbox-skin-' + theme + '.svg',                    onLoad: function(svg) {                            svg.configure({                                    width: '100%',                                    height: '100%',                                    preserveAspectRatio: 'none'                            });                    }                });            }            icon.appendTo(htmlObject);        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/switchBox/widget-switchbox.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'SwitchBox',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        i,        checkboxHtml,        readOnly,        icon,        theme,        themes,        definedTheme,        classes,        htmlObject,        imgHtml,        icons,        cssClass,        contSize,        slideObject,        that    = this,        xValue  = null,        hasMove = false;        config      = config || {};        htmlObject  = $(this.containerNode);        classes     = htmlObject.prop('class');        themes      = [];        if (config["data-off"] === null) {            config["data-off"] = "";        }        if (config["data-on"] === null) {            config["data-on"] = "";        }        checkboxHtml = "<div class='waf-switchbox-container'><div class='waf-switchbox-on'><span class='waf-switchbox-label-on'>"+config["data-on"]+"</span></div><div class='waf-switchbox-switch'></div><div class='waf-switchbox-off'><span class='waf-switchbox-label-off'>"+config["data-off"]+"</span></div></div>";        htmlObject.html(checkboxHtml);        slideObject = htmlObject.find(".waf-switchbox-container");        offObject   = htmlObject.find(".waf-switchbox-off");        onObject    = htmlObject.find(".waf-switchbox-on");		// console.log(htmlObject, htmlObject[0], htmlObject[0].offsetWidth, htmlObject[0].offsetWidth/1.6);        // contSize    = Math.round(htmlObject[0].offsetWidth/1.6);        contSize    = Math.round(htmlObject.outerWidth()/1.6);		// console.log(htmlObject[0].offsetWidth, htmlObject[0].offsetWidth/1.6, Math.round(htmlObject[0].offsetWidth/1.6));	    // console.log(htmlObject.outerWidth(), htmlObject.outerWidth()/1.6, Math.round(htmlObject.outerWidth()/1.6));        // slideObject.css("width", slideObject.get()[0].offsetWidth+"px");        slideObject.css("width", slideObject.width() + "px");		// console.log(slideObject.get()[0].offsetWidth+"px", slideObject.outerWidth() + "px");        this.slide = function slide(goToState, noSlideEffect) {                var                pos     = Math.abs(parseInt(slideObject.css("margin-left"))),                newPos,                state   = true;                xValue = null;                if (hasMove) {                    hasMove = false;                    if (pos != contSize && pos != 0) {                        if (pos > (contSize+2)/2) {                            newPos = contSize;                        } else {                            newPos = 0;                        }                    }                } else {                    if (typeof(goToState) != "undefined") {                        if (!goToState) {                            newPos = contSize;                        } else {                            newPos = 0;                        }                    } else {                        if (pos === 0) {                            newPos = contSize;                        } else {                            newPos = 0;                        }                    }                }                if (noSlideEffect) {                    slideObject.css("margin-left", -newPos+"px");                } else {                    slideObject.animate({                        marginLeft: -newPos+"px"                        },                        500, function() {                        }                    );                }                if (newPos === contSize) {                    state = false;                }                if (typeof(goToState) === "undefined" && that.sourceAtt) {                    updateDataState(state);                }        }        /*        * Check the box if checked is true        */        if(data.checked === 'false' || data.checked === null) {            this.slide( false, true, false );        }        if (!WAF.PLATFORM.isTouch) {             /*             * ------------ <MOUSE EVENTS> ------------             * To change status             */             htmlObject.find(".waf-switchbox-switch").bind('click',function(e){                 that.slide();             });             offObject.bind('click',function(e){                 that.slide();             });             onObject.bind('click',function(e){                 that.slide();             });        } else {            /*            * ------------ <TOUCH EVENTS> ------------            * To change status            */            htmlObject.find(".waf-switchbox-switch").bind('touchmove',function(e) {                hasMove = true;                e.preventDefault();                var                touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0],                diff,                currentMarginLeft,                newPos;                diff = xValue - touch.pageX;                xValue = touch.pageX;                currentMarginLeft = Math.abs(parseInt(slideObject.css("margin-left"))) ;                newPos = currentMarginLeft + diff;                if (newPos < contSize+1 && newPos > -1) {                    slideObject.css("margin-left", -newPos+"px");                }            });            htmlObject.find(".waf-switchbox-switch").bind('touchstart',function(e){                xValue = e.originalEvent.touches[0].pageX;            });            htmlObject.find(".waf-switchbox-switch").bind('touchend',function(e){                that.slide();            });            offObject.bind('touchend',function(e){                that.slide();            });            onObject.bind('touchend',function(e){                that.slide();            });         }        function updateDataState(state) {            var            widget,            sourceAtt,            value;            widget      = WAF.widgets[config.id];            sourceAtt   = widget.source.getAttribute(widget.att.name);            value       = '';            /*if(state) {                value = sourceAtt.normalize('true');            } else {                value = sourceAtt.normalize('false');            }*/            sourceAtt.setValue(state, {                dispatcherID: config.id            });            widget.clearErrorMessage();        }        /*         * Data sources binded         */        if (that.sourceAtt) {           /*           * Save value if binding "in" is defined           */           that.sourceAtt.addListener(function(e) {                var                widget,                widgetID,                htmlObject,                checkboxHtml,                value;                widget          = e.data.widget;                widgetID        = widget.id;                htmlObject      = $('#' + widgetID);                widget.clearErrorMessage();                    value = widget.sourceAtt.getValue();                    if (!value || value === 'false') {                       that.slide(false);                    } else {                       that.slide(true);                    }            }, {                listenerID      : config.id,                listenerType    : 'checkBox',                subID           : config.subID ? config.subID : null            },{                widget  : this            });        }    }, {        /**        * setValue        *        * @/shared        * @/method setValue        **/        setValue: function setValue(param) {            var value = this.getValue();            if (!this.isDisabled() && typeof(param) != 'undefined') {                if (param === true) {                    this.slide(true);                    value = true;                }                if (param === false) {                    this.slide(false);                    value = false;                }            }            return value;        },        /**        * toggleSlide        *        * @/shared        * @/method toggleSlide        **/        toggleSlide: function toggleSlide() {            this.slide();        },        /**        * getValue        *        * @/shared        * @/method getValue        **/        getValue: function getValue() {            var margin = parseInt($("#" + this.id).find(".waf-switchbox-container").css("margin-left")),                value = false;            if (margin === 0) {                value = true;            }            return value;        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/switchBox/widget-switchbox-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'switchbox',    lib        : 'WAF',    description: 'Switch',    category   : 'Form Controls',    img        : '/walib/WAF/widget/switchBox/icons/widget-switchbox.png',    tag        : 'div',    aspectRatio: true,    attributes : [    {        name        : 'type',        defaultValue: 'checkbox'    },    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-errorDiv',        description: 'Display Error'    },    {        name        : 'data-checked',        description : 'On by default',        type        : 'checkbox',        onclick   : function(){            D.getCurrent().slide(this.htmlObject[0].checked);        }    },    {        name        : 'data-off',        description : 'Off Text',        type        : 'textField',        defaultValue: 'OFF',        category    : 'Texts'    },    {        name        : 'data-on',        description : 'On Text',        type        : 'textField',        defaultValue: 'ON',        category   : 'Texts'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    }],    style: [    {        name        : 'width',        defaultValue: '77px'    },    {        name        : 'height',        defaultValue: '27px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchmove',        description: 'On Touch Move',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : false,            background  : true,            border      : false,            sizePosition: true,            label       : true,            disabled    : ['border-radius']        }    },    structure: [    {           description : 'off container',           selector    : '.waf-switchbox-off',           style: {               //text        : true,               background  : true,               //border      : true,               gradient    : true           }    },    {        description : 'on container',        selector    : '.waf-switchbox-on',        style: {            //text        : true,            background  : true,            //border      : true,            gradient    : true        }    },    {        description : 'switch',        selector    : '.waf-switchbox-switch',        style: {            background  : true,            //border      : true,            gradient    : true        }    },    {       description : 'off text',       selector    : '.waf-switchbox-label-off',       style: {           text    : true       }   },   {       description : 'on text',       selector    : '.waf-switchbox-label-on',       style: {           text    : true       }   }],    //},    onInit: function (config) {        return new WAF.widget.SwitchBox(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        i,        htmlObject,        slideObject,        icon,        icons,        url,        path,        imgHtml,        cssClass,        theme,        state = false;        htmlObject  = $('#' + tag.getId());        slideObject = htmlObject.find(".waf-switchbox-container");        /*htmlObject.unbind("click");        htmlObject.bind("click",function(){            var pos = Math.abs(parseInt(slideObject.css("margin-left")));            if (!state) {                tag.slide(true);                state = true;            } else {                tag.slide(false);                state = false;            }        });*/        if (config["data-off"] === null) {            config["data-off"] = "";        }        if (config["data-on"] === null) {            config["data-on"] = "";        }        checkboxHtml = "<div class='waf-switchbox-container'><div class='waf-switchbox-on'><span class='waf-switchbox-label-on'>"+config["data-on"]+"</span></div><div class='waf-switchbox-switch'></div><div class='waf-switchbox-off'><span class='waf-switchbox-label-off'>"+config["data-off"]+"</span></div></div>";        htmlObject.html(checkboxHtml);        if (isResize) {            htmlObject.css('line-height', tag.getHeight() + 'px');        }        tag.setCss('line-height', tag.getHeight() + 'px');        tag.slide = function switchBox_slide( state ) {            window.setTimeout(function() {                var contSize = Math.round(htmlObject.get()[0].offsetWidth/1.6);                if (!state) {                    /*$('#'+tag.getId()).find(".waf-switchbox-container").animate({                        marginLeft: -contSize+"px"                    }, 500);*/                    $('#'+tag.getId()).find(".waf-switchbox-container").css("margin-left", -contSize+"px");                } else {                    /*$('#'+tag.getId()).find(".waf-switchbox-container").animate({                        marginLeft: "0px"                    }, 500);*/                    $('#'+tag.getId()).find(".waf-switchbox-container").css("margin-left", "0px");                }            },0);        };        if (config['data-checked'] === "false" || config['data-checked'] === "") {            tag.slide(false);        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/container/widget-container.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     * TODO: Write a description of this WAF widget     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Container',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default TODO: set to the name to this class (ex: WAF.widget.DataGrid)     **/    function WAFWidget(config, data, shared) {        var        widget,        htmlObject,        splitted,        splitter,        container,        splitType,        splittedLength,        splitterTop,        splitterLeft,        splitterHeight,        splitterWidth,        splitterConfig,        tagWidth,        tagHeight,        splitterCss,        parent,        dragMethod,        scrollable;        widget          = this;        htmlObject      = $(this.containerNode);        (config["data-scrollable"] == "true") ? scrollable = true : scrollable = false;        splitted        = htmlObject.children('.waf-split-container');        splittedLength  = splitted.length;        splitterConfig  = {};        splitterCss     = {};        tagWidth        = this.containerNode.offsetWidth;        tagHeight       = this.containerNode.offsetHeight;        parent          = htmlObject.parent();        htmlObject.children('.waf-splitter').remove();        //add scroll for mobile        if (WAF.PLATFORM.modulesString == "mobile" && scrollable && splittedLength === 0) {            new iScroll(config.id);        }        /*         * Check if the container get splitted containers         */        if (splittedLength > 0) {            splitType = this._getSplitType();            switch(splitType) {                case 'horizontally':                    splitterLeft    = 0;                    splitterHeight  = widget._splitterHeight;                    splitterWidth   = htmlObject.width();                    splitterTop     = parseInt($(splitted[0]).css('height')) - (splitterHeight/2);                    this._tmpPosition = splitterTop;                    splitterCss['border-top'] = splitterCss['border-bottom'] = '1px solid #AEAEAE';                    splitterConfig  = {                        axis    : 'y'                    }                    dragMethod = function(e, ui) {                        var                        calcul,                        splitted,                        htmlObject;                        splitted    = e.data.splitted;                        htmlObject  = e.data.htmlObject;                        calcul      = ui.position.top + (splitterHeight/2);                        widget._tmpPosition = calcul;                        $.each(splitted, function() {                            var                            container,                            tagHeight;                            tagHeight = htmlObject.height();                            container = $(this);                            if (container.is(":first-child")) {                                container.css('height', calcul + 'px');                            } else {                                container.css('top', calcul + 'px');                                container.css('height', ((tagHeight - ui.position.top) - (splitterHeight/2)) + 'px');                            }                            if ($$(container.prop('id'))) {                                $$(container.prop('id'))._resizeSplitters();                            }                        });                        }                    break;                case 'vertically':                    splitterTop     = 0;                    splitterWidth   = widget._splitterWidth;                    splitterHeight  = htmlObject.height();                    splitterLeft    = parseInt($(splitted[0]).css('width')) - (splitterWidth/2);                    this._tmpPosition = splitterLeft;                    splitterCss['border-left'] = splitterCss['border-right'] = '1px solid #AEAEAE';                    splitterConfig  = {                        axis    : 'x'                    }                    dragMethod = function(e, ui) {                        var                        splitted,                        htmlObject;                        splitted    = e.data.splitted;                        htmlObject  = e.data.htmlObject;                        widget._saveSplitPosition(ui.position.left);                        $.each(splitted, function() {                            var                            calcul,                            container,                            tagWidth;                            tagWidth    = htmlObject.width();                            container   = $(this);                            calcul      = ui.position.left + (splitterWidth/2);                            widget._tmpPosition = calcul;                            if (container.is(":first-child")) {                                container.css('width', calcul + 'px');                            } else {                                container.css('left', calcul + 'px');                                container.css('width', ((tagWidth - ui.position.left) - (splitterWidth/2)) + 'px');                            }                            if ($$(container.prop('id'))) {                                $$(container.prop('id'))._resizeSplitters();                            }                        });                        }                    break;            }            splitterConfig.containment = 'parent';            $.extend(splitterCss, {                'width'         : splitterWidth + 'px',                'height'        : splitterHeight + 'px',                'left'          : splitterLeft + 'px',                'top'           : splitterTop + 'px',                'cursor'        : splitType == 'horizontally' ? 'row-resize' : 'col-resize',                'z-index'       : 8888888            });            splitter    = $('<div>');            splitter                .prop('id', 'waf-splitter-' + htmlObject.prop('id'))                .addClass('waf-splitter')                .css(splitterCss)                .draggable(splitterConfig)                .appendTo(htmlObject)                .bind( "drag", {                        splitted    : splitted,                        htmlObject  : htmlObject                    }, dragMethod)                .bind( "dblclick", function(){                    widget.toggleSplitter();                });            widget._splitter = splitter;            if ((!data.hideSplitter || data.hideSplitter !== 'true') && htmlObject.parents('[data-hideSplitter="true"]').length == 0) {            } else {                splitter.css('visibility', 'hidden');            }            this._initTmpPosition = this._tmpPosition;            splitted        = widget.$domNode.children('.waf-split-container');            splittedLength  = splitted.length;            /*             * Case of loaded from a component into GUI             */            if (this.$domNode.parents('#cms-body').length > 0) {                var checkResize = this._checkResize();                if (checkResize && this._callResizeEvents) {                    this._callResizeEvents('on');                    $(window).resize(function(){                        if (checkResize.x || checkResize.y) {                            widget._callResizeEvents('on');                        }                    });                }            }        }    },{        ready : function(){            var            that,            orient,            splitted,            splittedLength;            that            = this;            splitted        = this.$domNode.children('.waf-split-container');            splittedLength  = splitted.length;            if (splittedLength > 0) {                $.each(splitted, function(){                    that._splitted.push($$($(this).prop('id')));                });                /*                 * @todo : USE LINK TO ASSOCIATE BUTTON TO SPLIT CONTAINER                 */                this._button = $$(this.config['data-popup-display-button']);                if (this._button) {                    this._button.hide();                    if (WAF.PLATFORM.isTouch) {                        this._button.$domNode.bind('touchstart', {that : this}, function(e){                            e.data.that._displayFloatContainer();                        });                    } else {                        this._button.$domNode.bind('click', {that : this}, function(e){                            e.data.that._displayFloatContainer();                        });                    }                }            }            if (this._button) {                this._splitter.hide();            }            orient = (window.outerWidth <  window.outerHeight) ? "profile" : "landscape";            if (this._button) {                /*                 * Default display                 */                if (orient == 'profile') {                    this.mobileSplitView(true);                } else {                    this.mobileSplitView(false);                }                /*                 * Orientation change + touchstart events for mobile device                 */                if( WAF.PLATFORM.isTouch ) {                    $("body").bind('touchstart', {that : this}, function(e){                        var parentContainerID = $(e.target).closest(".waf-split-container")[0].id,                            loatContainer,                            orient  = (window.outerWidth <  window.outerHeight) ? "profile" : "landscape";                        if (parentContainerID && e.target.id != e.data.that._button.id && e.target.offsetParent.id != e.data.that._button.id && parentContainerID != that._splitted[0].id && orient == 'profile') {                            floatContainer  = e.data.that._splitted[0];                            if (floatContainer.$domNode[0].style.visibility === "visible") {                                floatContainer.toggle('visibility');                            }                        }                    });                    $(window).bind('orientationchange', {widget: that}, function (e) {                        var                        orient,                        widget;                        widget  = e.data.widget;                        orient  = (window.outerWidth <  window.outerHeight) ? "profile" : "landscape";                        if (orient == 'profile') {                            widget.mobileSplitView(true);                        } else {                            widget.mobileSplitView(false);                        }                        if (widget._callResizeEvents) {                            widget._callResizeEvents('on');                        }                    })                }            }        },        _button : null,        _splitType : null,        _splitted : [],        _tmpPosition : 0,        _display : false,        /**         * Resize method called during resize         * @method onResize         */        onResize : function container_resize() {            if (this.hasSplitter()) {                this._resizeSplitters('on');            } else {                $.each(this.getChildren(), function() {                    if (this._callResizeEvents) {                        this._callResizeEvents('on');                    }                });            }        },        /**         * Show or hide the splitter and the left/top splitted container         * @method toggleSplitter         */        toggleSplitter : function container_toggle_splitter() {            if (this._tmpPosition <= 2) {                this._tmpPosition = this._initTmpPosition;                this.expandSplitter();            } else {                if (this._splitStatus == 'collapse') {                   this.expandSplitter();                } else {                    this.collapseSplitter();                }            }        },        /**         * Hide the splitter and the left/top splitted container         * @method collapse         */        collapseSplitter : function container_collapse_splitter() {            this._splitStatus = "collapse";            this.setSplitPosition(0);        },        /**         * Show the splitter and the left/top splitted container         * @method expand         */        expandSplitter : function container_expand_splitter() {            if (this._tmpPosition <= 2) {                this._tmpPosition = this._initTmpPosition;            }            this._splitStatus = "expand";            this.setSplitPosition(this._tmpPosition);        },        /*         * Indicate if the container has a splitter         * @method hasSplitter         * @return {boolean}         */        hasSplitter : function container_has_splitter() {            var            result;            result = false;            if (this._hasSplitter) {                result = this._hasSplitter;            } else {                if (this.$domNode.find('.waf-splitter').length > 0) {                    result = true;                    this._hasSplitter = result;                }            }            return result;        },        /*         * Resize method called on stop resize         * @method onResize         */        stopResize : function container_stop_resize() {            if (this.hasSplitter()) {                this._resizeSplitters('stop');            } else {                $.each(this.getChildren(), function() {                    if (this._callResizeEvents) {                        this._callResizeEvents('stop');                    }                });            }        },        /*         * Resize method called on start resize         * @method onResize         */        startResize : function container_start_resize() {            if (this.hasSplitter()) {                this._resizeSplitters('start');            } else {                $.each(this.getChildren(), function() {                    if (this._callResizeEvents) {                        this._callResizeEvents('start');                    }                });            }        },        /*         * Get the position of the splitter         * @method getSplitPosition         * @param {number} value position to define         */        getSplitPosition   : function container_get_split_size() {            var            splitter,            splitType,            htmlObject,            position;            splitType   = this._getSplitType();            htmlObject  = $(this.containerNode);            splitter    = htmlObject.children('.waf-splitter');            if (splitType === 'horizontally') {                position = parseInt(splitter.css('top'));            } else {                position = parseInt(splitter.css('left'));            }            return position;        },        /*         * Set the position of the splitter         * @method setSplitPosition         * @param {number} value position to define         */        setSplitPosition   : function container_set_split_size(value, force) {            var            widget,            htmlObject,            splitter,            splitted,            splitterSize,            splitType,            tagSize;            widget          = this;            htmlObject      = $(this.containerNode);            splitted        = htmlObject.children('.waf-split-container');            splitter        = htmlObject.children('.waf-splitter');            splitType = this._getSplitType();            switch(splitType) {                case 'horizontally':                    splitterSize    = widget._splitterHeight;                    tagSize         = htmlObject.height();                    if (value > tagSize) {                        value = tagSize - splitterSize;                    }                    splitter.css('top', value + 'px');                    $.each(splitted, function() {                        var                        calcul,                        container;                        if (force) {                            calcul = 0;                        } else {                            calcul = (splitterSize/2);                        }                        container = $(this);                        if (container.is(":first-child")) {                            container.css('height', (value + calcul) + 'px');                        } else {                            container.css('top', value + calcul);                            container.css('height', ((tagSize - value) - calcul) + 'px');                        }                        $$(container.prop('id'))._resizeSplitters();                    });                    break;                case 'vertically':                    splitterSize    = widget._splitterWidth;                    tagSize         = htmlObject.width();                    if (value > tagSize) {                        value = tagSize - splitterSize;                    }                    splitter.css('left', value + 'px');                    $.each(splitted, function() {                        var                        calcul,                        container;                        if (force) {                            calcul = 0;                        } else {                            calcul = (splitterSize/2);                        }                        container = $(this);                        if (container.is(":first-child")) {                            container.css('width', (value + calcul) + 'px');                        } else {                            container.css('left', value + calcul);                            container.css('width', ((tagSize - value) - calcul) + 'px');                        }                        $$(container.prop('id'))._resizeSplitters();                    });                    break;            }        },        /*         * Splitter default width         */        _splitterWidth : 5,        /*         * Splitter default height         */        _splitterHeight : 5,        /*         * Get the type of the split (horizontal/vertical)         * @method _getSplitType         * @return {string}         */        _getSplitType : function container_get_split_type() {            var            children,            splitType;            children = $(this.containerNode).children();            if (this._splitType != null) {                splitType = this._splitType;            } else {                /*                 * Get splitter type                 */                if (children.length > 1) {                    if ($(children[0]).css('left') == '0px' && $(children[1]).css('left') == '0px') {                        splitType   = 'horizontally';                    } else {                        splitType   = 'vertically';                    }                } else {                    splitType = '';                }                this._splitType = splitType;            }            return splitType;        },        /*         * Resize splitter containers inside this container         * @method _resizeSplitters         */        _resizeSplitters : function container_resize_splitter(type) {            var            that,            child,            orient,            children,            thatHeight,            thatWidth,            splitType,            splitter,            container;            that        = $(this.containerNode);            container   = this;            children    = that.children(':not(.waf-split-container-float)');            type        = type || 'on';            if (children.length > 0) {                /*                 * Hide overflow if container as splitted containers                 */                that.css('overflow', 'hidden');            }            thatHeight  = parseInt(that.css('height'));            thatWidth   = parseInt(that.css('width'));            splitter    = that.children('.waf-splitter');            /*             * Get splitter type             */            splitType = this._getSplitType();            $.each(children, function(e){                var                calcul,                containerX,                containerY,                childWidget,                checkResize;                child       = $(this);                childWidget = $$(child.prop('id'));                containerX  = parseInt(child.css('left'));                containerY  = parseInt(child.css('top'));                child.resizeChildren = that.resizeChildren;                //if (checkResize.x && checkResize.y) {                if (child.is('.waf-split-container')) {                    switch(splitType) {                        case 'horizontally':                            if (containerY != 0 || container._display) {                                calcul = thatHeight - containerY;                                child.css('height', thatHeight + 'px');                            }                            child.css('width', thatWidth + 'px');                            splitter.css('width', thatWidth + 'px');                            break;                        case 'vertically':                            if (containerX != 0 || container._display) {                                calcul = thatWidth - containerX;                                child.css('width', calcul + 'px');                            }                            child.css('height', thatHeight + 'px');                            splitter.css('height', thatHeight + 'px');                            break;                    }                    if (childWidget) {                        childWidget._resizeSplitters(type);                    }                }                if (childWidget && childWidget._checkResize) {                    checkResize = childWidget._checkResize();                    if (checkResize.x || checkResize.y) {                        childWidget._callResizeEvents(type);                    }                }            });            if (this._button) {                if( !WAF.PLATFORM.isTouch ) {                    var orient;                    orient = (window.outerWidth <  window.outerHeight) ? "profile" : "landscape";                    if (orient == 'profile') {                        container.mobileSplitView(true);                    } else {                        container.mobileSplitView(false);                    }                }            }        },        /**         * Save the splittter position into private property         * @method _saveSplitPosition         * @param {number} position : position of the splitter         */        _saveSplitPosition: function container_save_split_position(position) {            var            dsPos,            dsParent,            htmlObject;            htmlObject = $('#' + this.id);            if (htmlObject.data('dsPos')) {                dsPos = htmlObject.prop('id') + '-' + htmlObject.data('dsPos');            } else {                dsParent = htmlObject.parents('[data-dsPos]');                if (dsParent.length > 0) {                    dsPos = htmlObject.prop('id') + '-' + dsParent.data('dsPos');                }            }            if (!WAF._tmpSplitPosition) {                WAF._tmpSplitPosition = {};            }            if (dsPos) {                WAF._tmpSplitPosition[this.id] = position;            }        },        _displayFloatContainer : function() {            var            top,            left,            buttonHtml,            thatOffset,            containerHtml,            floatContainer;            buttonHtml      = this._button.$domNode;            floatContainer  = this._splitted[0];            containerHtml   = floatContainer.$domNode;            buttonOffset    = buttonHtml.offset();            left            = buttonOffset.left;            top             = buttonOffset.top + buttonHtml.height() + 15;            floatContainer.toggle('visibility');            containerHtml                .addClass('waf-container-split-mobile');            if (buttonOffset.top < window.innerHeight/2) {                containerHtml                    .css({                        left    : left + 'px',                        top     : top + 'px',                        width   : this._initTmpPosition + 'px'                    })            } else {                containerHtml                    .css({                        left    : left + 'px',                        top     : '15px',                        bottom  : window.innerHeight - buttonOffset.top + 10 + 'px',                        width   : this._initTmpPosition + 'px'                    })            }        },        /**         * Display the splitter has a mobile splitview         * @method mobileSplitView         * @param {boolean} mobile : true to display as mobile         */        mobileSplitView : function container_mobile_split_view (mobile) {            var            that,            splitted,            firstSplitted,            firstSplitWidth;            if (mobile == this._display || !this._splitter) {                return false;            }            that            = this;            this._display   = mobile;            firstSplitted   = this._splitted[0];            if (mobile) {                splitted = firstSplitted.$domNode;                /*                 * Collapse splitted                 */                this.setSplitPosition(0, true);                console.log()                splitted                    .css({                        'width'     : this._initTmpPosition + 'px',                        'position'  : 'fixed',                        //'height'    : splitted.height() + 'px',                        'z-index'   : 10                    })                    .addClass('waf-split-container-float')                    //.appendTo('body');                firstSplitted.hide('visibility');                this._splitted[1].$domNode.css({                    'left'      : '0px',                    'width'     : window.innerWidth + 'px',                    'z-index'   : 9                });                /*                 * Hide splitter                 */                this._splitter.css('visibility', 'hidden');                this._button.show();                this._splitted[1]._callResizeEvents('on');            } else {                firstSplitted.show();                firstSplitted.$domNode                    .css({                        'left'      : 0,                        'top'       : 0,                        'z-index'   : 9,                        'position'  : 'absolute',                        'height'    : this.getHeight()                    })                    .removeClass('waf-split-container-float')                    //.appendTo(that.$domNode)                    .removeClass('waf-container-split-mobile');                this._button.hide();                firstSplitWidth = firstSplitted.$domNode.width();                this._splitted[1].$domNode.css({                    'left'      : firstSplitted.$domNode.width() + 'px',                    'z-index'   : 10,                    'width'     : window.innerWidth - firstSplitWidth                });                firstSplitted._callResizeEvents('on');                this._splitted[1]._callResizeEvents('on');            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/container/widget-container-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'container',    lib         : 'WAF',    description : 'Container',    category    : 'Containers/Placeholders',    img         : '/walib/WAF/widget/container/icons/widget-container.png',    tag         : 'div',    attributes  : [    {        name        : 'class',        description : 'Css class'    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox',        platform    : 'desktop'    },    {        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox',        platform    : 'desktop'    },    {        name        : 'data-scrollable',        description : 'Scrollable',        type        : 'checkbox',        platform    : 'mobile'    },    {        name        : 'data-hideSplitter',        description : 'Hide Splitters',        type        : 'checkbox',        category    : 'Splitter Options',        ready       : function(){ // Check if widget is splitted to display this category            var            tag;            tag = this.data.tag;            if (!tag._containers) {                this.formPanel.getHtmlObject().hide();            }        }    },    {        name        : 'data-popup-display-button',        description : 'Left Splitter Button',        category    : 'Splitter Options'    }],    style: [    {        name        : 'width',        defaultValue: '294px'    },    {        name        : 'height',        defaultValue: '211px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name        : 'startResize',        description : 'On Start Resize',        category    : 'Resize'    },    {        name        : 'onResize',        description : 'On Resize',        category    : 'Resize'    },    {        name        : 'stopResize',        description : 'On Stop Resize',        category    : 'Resize'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchmove',        description: 'On Touch Move',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            dropShadow  : true,            innerShadow : true,            label       : false,            disabled    : []        }    },    onInit: function (config) {        return new WAF.widget.Container(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        //console.log("design")        var        i,        child,        parent,        children,        childrenL,        htmlObject,        containerSplitClass;        containerSplitClass = 'waf-split-container';        htmlObject          = tag.getHtmlObject();        children            = tag.getChildren();        childrenL           = children.length;        /*         * Also resize splitted containers         */        if (isResize && tag._containers) {            tag.resizeSplitted();        }        if (isResize && children.length > 0) {            for (i = 0; i < childrenL; i += 1) {                child = children[i];                if (child && !child.isDeleted()) {                    if (child.getType() == 'matrix' && ((child._isFitToRight && child._isFitToLeft) || (child._isFitToTop && child._isFitToBottom))) {                        child.rebuild();                    }                    D.ui.focus.setPosition(child);                    D.ui.focus.setSize(child);                }            }        }        parent = tag.getParent()        /*         * If container is inside a tabview         */        if (isResize) {            if (parent && parent.getType() == 'tabView') {            }        }        /*         * adding states to containers inside a matrix         */        if (parent && parent.getType() === 'matrix') {            tag._states = [{                    label   : 'selected',                    cssClass: 'waf-state-selected'            }]        } else {            tag._states = null;        }    },    onCreate : function (tag, param) {        var        nb,        containerSplitClass,        htmlObject,        parent;        containerSplitClass = 'waf-split-container';        htmlObject = tag.getHtmlObject();        /*         * Get the first parent container of the splitted container         */        tag.getFirstParent = function () {            var            parent;            parent = this.getParent();            if (parent && parent.isContainer()) {                if (parent._isSplit) {                    parent = parent.getFirstParent();                }            } else {                parent = this;            }            return parent;        }        /*         * Split the container into many other containers         */        tag.split = function container_split(params) {            var            tagWidth,            tagHeight,            container,            containers,            nb,            type,            containerHtml,            containerX,            containerY,            containersWidth,            containersWidth2,            containersHeight,            containersHeight2,            i,            that,            htmlObject,            firstParent,            children,            childrenLength,            existingClasses;            params              = params        || {};            nb                  = params.nb     || 2;            type                = params.type   || 'vertically';            htmlObject          = this.getHtmlObject();            that                = this;            tagWidth            = parseInt(htmlObject.css('width'));//that.getWidth();            tagHeight           = parseInt(htmlObject.css('height'));//that.getHeight();            containers          = [];            switch(type) {                case 'horizontally':                    containersWidth     = tagWidth;                    containersWidth2    = tagWidth;                    containersHeight    = params.position || tagHeight/nb;                    containersHeight2   = params.position ? tagHeight-containersHeight : containersHeight;                    break;                case 'vertically':                    containersWidth     = params.position || tagWidth/nb;                    containersWidth2    = params.position ? tagWidth-containersWidth : containersWidth;                    containersHeight    = tagHeight;                    containersHeight2   = tagHeight;                    break;            }            containerX          = 0;            containerY          = 0;            children            = that.getChildren();            childrenLength      = children.length;            /*             * Create many containers as indicated by nb             */            for (i = 0; i < nb; i += 1) {                container = new Designer.tag.Tag(Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('container')));                container._isSplit = true;                container.create();                container.addClass(containerSplitClass);                container.setXY(containerX,containerY, true);                container.setWidth(containersWidth);                container.setHeight(containersHeight);                if (i == 0) {                    container.setWidth(containersWidth);                    container.setHeight(containersHeight);                } else {                    container.setWidth(containersWidth2);                    container.setHeight(containersHeight2);                }                container.setParent(that);                containerHtml = container.getHtmlObject();                containerHtml.addClass(containerSplitClass);                switch(type) {                    case 'horizontally':                        containerY += containersHeight;                        break;                    case 'vertically':                        containerX += containersWidth;                        break;                }                containers.push(container);                /*                 * Lock d&d on splitted containers                 */                container.fix();            }            firstParent = that.getFirstParent();            that._containers = containers;            that.addSplitter(type);            /*             * Append children into first splitted container             */            if (children && childrenLength > 0) {                /*                 * Constraint for right/bottom position                 */                Designer.tag.createPositionConstraintList(children);                Designer.tag.cleanPositionConstraints();                for (i = 0; i < childrenLength; i += 1) {                    if (children[i].status != 'destroy') {                        children[i].setParent(containers[0]);                    }                }                /*                 * restore constaints                 */                Designer.tag.restorePositionConstraints();            }            firstParent.setCurrent();            D.tag.refreshPanels();        }        tag.addSplitter = function container_add_splitter( type ) {            var            that,            htmlObject,            tagHtmlObject,            splitterLeft,            splitterHeight,            splitterWidth,            splitterTop,            config,            splitterCss,            children,            childrenLength,            refreshFocus,            matrix,            matrixHtml,            inMatrix;            that            = this;            tagHtmlObject   = that.getHtmlObject();            children        = that._containers;            htmlObject      = $("<div>");            childrenLength  = children ? children.length : 0;            config          = {                containment : 'parent'            };            splitterCss     = {};            matrixHtml = tagHtmlObject.parents('.waf-matrix');            inMatrix = false;            /*             * Check if the tag is in a matrix             */            if (matrixHtml.length > 0) {                inMatrix = true;                matrix = D.tag.getTagById(matrixHtml.prop('id'));            }            refreshFocus = function () {                var                j,                currentTag,                selection,                selectionCount;                selection       = Designer.getSelection();                selectionCount  = selection.count();                currentTag      = D.getCurrent();                if (selectionCount > 0) {                    for (j = 0; j < selection.count(); j += 1) {                        currentTag = selection.get(j);                        Designer.ui.focus.setPosition(currentTag);                        Designer.ui.focus.setSize(currentTag);                    }                } else if (currentTag){                    Designer.ui.focus.setPosition(currentTag);                    Designer.ui.focus.setSize(currentTag);                }            }            switch(type) {                case 'horizontally':                    splitterLeft    = 0;                    splitterHeight  = 5;                    splitterWidth   = tagHtmlObject.width();                    splitterTop     = children[0].getHeight() - (splitterHeight/2);//(containersHeight - (splitterHeight/2));                    $.extend(config, {                        axis    : 'y',                        /*                         * Resize containers on dragging                         */                        drag    : function(e, ui) {                            var                            i,                            child,                            containersLength;                            containersLength = childrenLength;                            for (i = 0; i < containersLength; i += 1) {                                child = children[i];                                if (i === 0) {                                    child.setHeight(ui.position.top + (splitterHeight/2));                                } else {                                    child.setY(ui.position.top + (splitterHeight/2), true);                                    child.setHeight(((parseInt(that.getHtmlObject().css('height')) + 1) - ui.position.top) - (splitterHeight/2));                                }                                child.domUpdate();                                refreshFocus();                            }                        }                    });                    splitterCss['border-top'] = splitterCss['border-bottom'] = '1px solid #AEAEAE';                    break;                case 'vertically':                    splitterTop     = 0;                    splitterWidth   = 5;                    splitterHeight  = tagHtmlObject.height();                    splitterLeft    = children[0].getWidth() - (splitterWidth/2);//(containersWidth - (splitterWidth/2));                    $.extend(config, {                        axis    : 'x',                        stop   : function() {                            D.env.resizeSplit = false;                        },                        /*                         * Resize containers on dragging                         */                        drag    : function(e, ui) {                            var                            i,                            child,                            containersLength;                            containersLength = childrenLength;                            for (i = 0; i < containersLength; i += 1) {                                child = children[i];                                if (i === 0) {                                    child.setWidth(ui.position.left + (splitterWidth/2));                                } else {                                    child.setX(ui.position.left + (splitterWidth/2), true);                                    child.setWidth(((parseInt(that.getHtmlObject().css('width')) + 1 ) - ui.position.left) - (splitterWidth/2));                                }                                child.domUpdate();                                refreshFocus();                            }                        }                    });                    splitterCss['border-left'] = splitterCss['border-right'] = '1px solid #AEAEAE';                    break;            }            config.start = function (e, ui) {                var                i,                size,                containersLength;                containersLength    = childrenLength;                size                = [];                for (i = 0; i < containersLength; i += 1) {                    if (type == 'vertically') {                        size.push(children[i].getWidth());                    } else {                        size.push(children[i].getHeight());                    }                }                this.oldValue = size;            }            config.stop = function (e, ui) {                var                i,                size,                containersLength;                Designer.beginUserAction('061');                containersLength    = childrenLength;                size                = [];                for (i = 0; i < containersLength; i += 1) {                    children[i].domUpdate();                    if (type == 'vertically') {                        size.push(children[i].getWidth());                    } else {                        size.push(children[i].getHeight());                    }                }                if (inMatrix) {                    matrix.rebuild();                }                // history                var action = new Designer.action.SplitContainer({                    val       : '0',                    oldVal    : '1',                    tagId     : that.id,                    tagHtmlId : that.getId,                    prop      : 'resizeSplit',                    data      : {                        splitType   : type,                        currentTag  : D.getCurrent(),                        newValue    : size,                        oldValue    : this.oldValue                    }                });                Designer.getHistory().add(action);            }            $.extend(splitterCss, {                'width'         : splitterWidth + 'px',                'height'        : splitterHeight + 'px',                'left'          : splitterLeft + 'px',                'top'           : splitterTop + 'px',                'cursor'        : type == 'horizontally' ? 'row-resize' : 'col-resize',                'z-index'       : 100            });            /*             * Add splitter             */            htmlObject                .addClass('waf-splitter')                .bind('mousedown', {}, function(e) {                    /*                     * Lock tag when splitter is dragging                     */                    that.lock();                })                .bind('mouseup', {}, function(e) {                    /*                     * Unlock tag when splitter is dragging                     */                    that.unlock();                })                .css(splitterCss)                .draggable(config)                .appendTo(that.getHtmlObject());            if (inMatrix) {                matrix.rebuild();            }            return tagHtmlObject;        }        tag.getSplitter = function container_get_splitter() {            var            that,            htmlObject,            splitter,            result;            that        = this;            htmlObject  = that.getHtmlObject();            splitter    = htmlObject.children('.waf-splitter');            if (splitter.length === 0) {                result  = null;            } else {                result  = splitter;            }            return result;        }        tag.getSplitOrientation = function container_get_split_orientation() {            var            i,            that,            containersLength,            container,            containers,            splitType;            that                = this;            containers          = that._containers;            if (containers) {                containersLength    = containers.length;                if (containers && containersLength > 0) {                    for (i = 0; i < containersLength; i += 1) {                        container = containers[i];                        if (container.getX() === 0) {                            splitType = "horizontally";                        } else {                            splitType = "vertically";                        }                    }                }            }            return splitType;        }        tag.resizeSplitted = function container_resize_splitted() {            var            i,            that,            htmlObject,            thatWidth,            thatHeight,            containers,            containersLength,            container,            containerX,            containerY,            splitType,            splitter;            that                = this;            htmlObject          = that.getHtmlObject();            thatWidth           = parseInt(htmlObject.css('width'));//that.getWidth();            thatHeight          = parseInt(htmlObject.css('height'));//that.getHeight();            containers          = that.getChildren();            containersLength    = containers.length;            splitType           = that.getSplitOrientation();            splitter            = that.getSplitter();            /*             * Resize splitter             */            if (splitter) {                switch(splitType) {                    case 'horizontally':                        splitter.css('width', thatWidth + 'px');                        break;                    case 'vertically':                        splitter.css('height', thatHeight + 'px');                        break;                }            }            /*             * Resize containers             */            if (containers && containersLength > 0) {                for (i = 0; i < containersLength; i += 1) {                    container       = containers[i];                    if (container._isSplit) {                        containerX      = container.getX();                        containerY      = container.getY();                        switch(splitType) {                            case 'horizontally':                                if (containerY != 0) {                                    container.setHeight(thatHeight - containerY);                                }                                container.setWidth(thatWidth);                                break;                            case 'vertically':                                if (containerX != 0) {                                    container.setWidth((thatWidth - containerX));                                }                                container.setHeight(thatHeight);                                break;                        }                    }                }            }            that._containers    = containers;        }        /*         * if tag is a splitted container, append splitter to is parent         */        if (tag.getAttribute('class').getValue().match(containerSplitClass)) {            htmlObject.addClass(containerSplitClass);            parent          = tag.getParent();            tag._isSplit    = true;            if (parent._containers) {                parent._containers.push(tag);            } else {                parent._containers = [tag];            }            /*             * Lock d&d on splitted containers             */            tag.fix();            /*             * Count the number of child nodes except the undefined nodes             */            nb = 0;            $.each(parent._elementNode.getChildNodes(), function() {                if (this.tagName) {                    nb += 1;                }            })            if(!parent.getSplitter() && nb == parent._containers.length) {                parent.addSplitter(parent.getSplitOrientation());            }        }        /*         * Widget custom on file drop event         * Same as body         */        $(tag).bind('onFileDrop', $(D.doc.tag).data('events').onFileDrop[0].handler);        /*         * Widget custom on copy event         */        $(tag).bind('onWidgetCopy', function(e, original){            var            i,            child,            children,            containerHtml,            childrenLength;            /*             * Check if original widget is splitted             */            if (original._containers) {                this._containers    = [];                children            = this.getChildren();                childrenLength      = children.length;                for (i = 0; i < childrenLength; i += 1) {                    child           = children[i];                    child._isSplit  = true;                    containerHtml   = child.getHtmlObject();                    this._containers.push(child);                    child.fix();                }                /*                 * Display splitter                 */                 this.addSplitter(original.getSplitOrientation());            }        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/richText/widget-richText.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'RichText',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        text,        plainText,        htmlObject;        config      = config || {};        htmlObject  = $(this.containerNode);        plainText   = this.plainText = data.plainText == 'false' || data.plainText === false ? false : true;        /*         * For binded richtext         */        if (this.sourceAtt) {            this.sourceAtt.addListener(function(e) {                if (data.link) {                    htmlObject.html('<a href="' + data.link + '" target="' + data.target + '">' + e.data.widget.getFormattedValue() + '</a>');                } else {                    htmlObject.html(e.data.widget.getFormattedValue(undefined, plainText));                }            }, {                listenerID      : config.id,                listenerType    : 'staticText',                subID           : config.subID ? config.subID : null            }, {                widget:this            });        } else {            text = this.getFormattedValue(htmlObject.html());            htmlObject.html(text);        }        text = htmlObject.html().replace(/\n/g, '<br/>');        /*         * Add link if exists         */        if (data.link) {            htmlObject.addClass('link');            htmlObject.html('<a href="' + data.link + '" target="' + data.target + '">' + text + '</a>');        } else {            htmlObject.html(text);        }        switch (data.overflow) {            case 'Horizontal' :                htmlObject.css({                    'overflow-x' : 'auto',                    'overflow-y' : 'hidden'                });                break;            case 'Vertical' :                htmlObject.css({                    'overflow-x' : 'hidden',                    'overflow-y' : 'auto'                });                break;            case 'Both' :                htmlObject.css({                    'overflow-x' : 'auto',                    'overflow-y' : 'auto'                });                break;            case 'Hidden' :            default :                break;        }        /*         * Remove useless attribute         */        htmlObject.removeAttr('data-link');        if (data.autoWidth == 'true') {            htmlObject.css({                'width'     : 'auto',                'height'    : 'auto',                'min-width' : htmlObject.width()            });        }        /*         * Fix bug on "&" special char         */        this.setValue(this.$domNode.html().replace(/&amp;/g, '&'));    },{        setValue : function(value) {			if (this.plainText) {				this.$domNode.text(value);			} else {				this.$domNode.html(value);			}        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/richText/widget-richText-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'richText',    lib         : 'WAF',    description : 'Text',    category    : 'Form Controls',    img         : '/walib/WAF/widget/richText/icons/widget-richText.png',    include     : [],    tag         : 'div',    attributes  : [    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-format',        description: 'Format'    },    {        name        : 'data-autoWidth',        description : 'Auto Resize',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'data-label',        description : 'Label',        ready       : function () {            var            i,            tag,            selection,            selectionL;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                if (!this.data.tag.getAttribute('data-binding').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            } else {                if (!D.ui.selection.getAttribute('data-binding').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            }        }    },    {        name        : 'data-text',        description : 'Text',        type        : 'textarea'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-link',        description : 'Link',        onchange    : function(){            if (!this.getValue()) {                $('#dropdown-data-target').parent().parent().hide();            } else {                $('#dropdown-data-target').parent().parent().show();            }        }    },    {        name        : 'data-target',        description : 'Target',        type        : 'dropdown',        options     : ['_blank', '_self'],        defaultValue: '_blank',        ready     : function(){            var            i,            tag,            selection,            selectionL;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                if (!this.data.tag.getAttribute('data-link').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            } else {                if (!D.ui.selection.getAttribute('data-link').getValue()) {                    this.getHtmlObject().parent().parent().hide();                }            }        }    },    {        name        : 'data-overflow',        description : 'Scrollbar',        type        : 'dropdown',        options     : ['Hidden', 'Horizontal', 'Vertical', 'Both'],        defaultValue: 'Hidden'    },    {        name        : 'data-plainText',        description : 'Plain Text',        type        : 'checkbox',        defaultValue: 'true'    }],    style: [    {        name        : 'width',        defaultValue: '50px'    },    {        name        : 'height',        defaultValue: '16px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    properties: {        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            dropShadow  : true,            innerShadow : true,            disabled    : ['border-radius']        }    },    onInit: function (config) {        return new WAF.widget.RichText(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        text,        htmlObject,        tmpWidth,        tmpHeight,        tagWidth,        tagHeight,        split,        attrText,        tmpHtmlObject;        htmlObject      = tag.getHtmlObject();        tagWidth        = tag.getWidth();        tagHeight       = tag.getHeight();        attrText = tag.getAttribute('data-text').getValue();        /*         * Get the source as text value         */        if (tag.getSource()) {            text    = '[' + tag.getSource() + ']';            if (attrText) {                text = attrText;            }            /*             * if a text exist set the old text as the label             */            if (tag._oldTextValue) {                tag.getAttribute('data-label').setValue(tag._oldTextValue);            }            tag._oldTextValue = null;            tag._oldLabelValue = tag.getAttribute('data-label').getValue();            tag._oldSource = tag.getSource();        } else {            /*             * if a label exist set the old label as the text then remove label             */            if (tag._oldLabelValue) {                tag.getAttribute('data-text').setValue(tag._oldLabelValue);                tag.getAttribute('data-label').setValue('');            }            if (tag.getLabel()) {                D.tag.deleteWidgets(tag.getLabel());                tag._linkedTag = null;            }            text    = tag.getAttribute('data-text').getValue();            tag._oldLabelValue = null;            tag._oldTextValue = text;        }        //tag.getAttribute('data-text').setValue(text);        if (tag.getAttribute('data-link').getValue()) {            htmlObject.addClass('link');        }        text = text.replace(/\n/g, '<br />');        /*         * get/create the temporary html object         */        tag._getTmpHtmlObject = function tag_createTmpHtmlObject(text) {            var            tmpHtmlObject;            if ($('#waf-tmp-div').length > 0) {                tmpHtmlObject = $('#waf-tmp-div');            } else {                tmpHtmlObject   = $('<div id="waf-tmp-div">');            }            /*             * Set the temporary html object             */            tmpHtmlObject.appendTo('body');            tmpHtmlObject.html(text);            tmpHtmlObject.css({                /*                 * Keep the same css as the tag                 */                'font-size'         : this.getComputedStyle('font-size'),                'font-style'        : this.getComputedStyle('font-style'),                'font-family'       : this.getComputedStyle('font-family'),                'font-weight'       : this.getComputedStyle('font-weight'),                'text-decoration'   : this.getComputedStyle('text-decoration'),                'text-align'        : this.getComputedStyle('text-align'),                'letter-spacing'    : this.getComputedStyle('letter-spacing'),                'position'          : 'absolute',                'z-index'           : '10000',                'left'              : '-1000px',                'top'               : '-1000px',                'background'        : '#FFCC66'            });            return tmpHtmlObject;        }        tmpHtmlObject   = tag._getTmpHtmlObject(text);        tmpWidth        = tmpHtmlObject.width();        tmpHeight       = tmpHtmlObject.height();        /*         * Add text to html object         */        htmlObject.html(text);        /*         * If autocomplete, resize the htmlobject depending on temporary html object         */        if (tag.getAttribute('data-autoWidth').getValue() === 'true') {            if (tmpWidth > 0 && tmpWidth != tagWidth) {                tag.setWidth(tmpWidth);            }            if (tmpHeight > 0 && tmpHeight != tagHeight) {                tag.setHeight(tmpHeight);            }        }        /*         * DblClick event         */        tag.dblClickFn = function tag_dblClickFn(e){            var            text,            editBox,            tmpHtmlObject,            tmpWidth,            tmpHeight,            htmlObject,            tag;            tag             = e.data && e.data.tag ? e.data.tag : D.getCurrent();            /*             * Disable key event             */            Designer.ui.core.disableKeyEvent();            Designer.api.setListenerMode(false);            tag.resize.lock(true);            YAHOO.util.Event.stopEvent(e);            $(this).prop('disabled', 'disabled');            /*             * Lock d&d             */            tag.lock();            tag.setFocus(true, false);            if (!e.data) {                D.tag.refreshPanels();            }            htmlObject  = tag.getHtmlObject();            text        = tag.getAttribute("data-text").getValue();            tmpHtmlObject   = tag._getTmpHtmlObject(text);            /*             * Create edit box with the same css as the tag             */            if (tag.getParent().getType() == 'menuItem') {                editBox = $('<input>')                    .attr('value', text);            } else {                editBox = $('<textarea>')                    .html(text);            }            editBox.css({                /*                 * Keep the same css as the tag                 */                'font-size'         : 'inherit',                'font-family'       : 'inherit',                'font-style'        : 'inherit',                'font-weight'       : 'inherit',                'text-decoration'   : 'inherit',                'text-align'        : 'inherit',                'background-color'  : 'transparent',                'border'            : 'none',                'width'             : '100%',                'height'            : '100%',                'resize'            : 'none'            });            htmlObject.html(editBox);            /*             * Select the all text on focus             */            editBox.select();            /*             * Add key events             */            editBox.bind('keydown', {}, function(e) {                var                value;                value = $(this).val();                value += e.shiftKey && e.keyCode == 13 ? '<br />' : String.fromCharCode(e.keyCode);                this.refresh = function () {                    tmpHtmlObject.html(value.replace(/\n/g, '<br />') + '-');                    /*                     * Change widget size only if auto width                     */                    if (tag.getAttribute('data-autoWidth').getValue() === 'true') {                        tmpWidth    = tmpHtmlObject.width();                        tmpHeight   = tmpHtmlObject.height();                        if (tmpWidth > 0) {                            tag.setWidth(tmpWidth, false);                        }                        if (tmpHeight > 0) {                            tag.setHeight(tmpHeight, false);                        }                    }                }                switch(e.keyCode) {                    /*                     * Save on enter key down (except holding shift)                     */                    case 13:                        if (!e.shiftKey) {                            this.blur();                        } else {                            this.refresh();                        }                        break;                    /*                     * Resize on key event                     */                    default:                        if (e.keyCode >= 37 && e.keyCode <= 40) {                            // DO NOTHING FOR ARROW KEYS                        } else {                            this.refresh();                        }                        break;                }            });            /*             * Save on blur             */            editBox.bind('blur', {tag : tag}, function(e){                var                tag,                newValue;                tag         = e.data.tag;                newValue    = $(this).val();                tag.getAttribute('data-text').setValue(newValue);                tag.update();                tag.domUpdate();                D.tag.refreshPanels();                tag.getHtmlObject().html(newValue.replace(/\n/g, '<br />'))                /*                 * unlock d&d                 */                tag.unlock();                Designer.ui.core.enableKeyEvent();                Designer.api.setListenerMode(true);                tag.resize.unlock(true);            })        }        htmlObject.bind('dblclick', { tag : tag }, tag.dblClickFn);        // calls onDesign once styles are inserted so that autoResize function may work properly        // otherwise calculations could be wrong since CSS styles (like font-size) may not have been inserted yet        // this fixes #WAK0078446        $('#waf-body').bind('onWidgetCSSLoaded', function() {            tag.onDesign(true);        });        /*         * Remove temporary objects         */        tmpHtmlObject.remove();    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/errorDiv/widget-errorDiv.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'ErrorDiv',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {    },{    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/errorDiv/widget-errorDiv-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'errorDiv',    lib         : 'WAF',    description : 'Display Error',    category    : 'Form Controls',    img         : '/walib/WAF/widget/errorDiv/icons/widget-errorDiv.png',    tag         : 'div',    attributes  : [    {        name       : 'class',        description: 'Css class'    }],    style: [    {        name        : 'width',        defaultValue: '150px'    },    {        name        : 'height',        defaultValue: '20px'    }],    events: [],    properties: {        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : false,            shadow      : true,            disabled    : []        }    },    onInit: function (config) {        var errorDiv = new WAF.widget.ErrorDiv(config);        return errorDiv;    },    onDesign: function (config, designer, tag, catalog, isResize) {    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/dataGrid/widget-dataGrid.js*//** * ---------------------------------------------------------------------------- * content of widget-dataGrid-data.js * ---------------------------------------------------------------------------- *//** * @brief			DataGrid, part of WAF/Widgets * @details			Displays data from an entity, uses Model-View-Controller architecture (MVC). DataProvider is * a model, GridView is a view, and GridController functions as controller. * * * * @author			rudolfpsenicnik * @date			February 2009 * @version			1.0 * * @include			copyright.txt */WAF.classes.DataGrid = function(config){	var rowHeight;	(WAF.PLATFORM.modulesString === "mobile") ? rowHeight = 40 : rowHeight = 27;	config.dataSource = config.dataSource || null;	if (typeof config.inDesign === 'undefined') {		config.inDesign = false;	}	config.colNames = config.colNames ? config.colNames.split(",") : null;	config.colAttributes = config.colAttributes ? config.colAttributes.split(",") : null;	options = {		columns: config.columns || null,		colNames: config.colNames,		colAttributes: config.colAttributes,		colWidth: config.colWidth,		parentNode: config.id,		cacheSize: 0,		rowHeight: rowHeight,		dataSource: WAF.source[config.dataSource],		subscriberID: config.id,		inDesign: config.inDesign,		cls: config.cls,		included: config.included,		selMode: config.selMode,		mustDisplayError: config.mustDisplayError,		errorDiv: config.errorDiv,		hideFooter: config.hideFooter,		hideHeader: config.hideHeader,		textFooter: config.textFooter	}	this.widget = $$(config.id);	// Private	this._private = {		globals: {			processingRequests: 0,			itemCount: 0,			//dataStore: null,			columnsDefinition: null,			sortColumn: null,			sortOrder: null,			errorDiv: null,			mustDisplayError: true		},		functions: {			parent: this,			checkColumnsDefinition: function(colNames, colAttributes) // old code, should not be used anymore			{				if (typeof colNames == "undefined" || typeof colAttributes == "undefined") {					return null;				}				var colNames = colNames.slice();				var colAttributes = colAttributes.slice();				var width = 130;				for (var i = 0; i < colNames.length; i++) {					// fix a bug					if (typeof options !== 'undefined') {						if (typeof options.colWidth !== 'undefined') {							width = options.colWidth[i] ? parseInt(options.colWidth[i]) : 130;						}					}					if (typeof colNames[i] === 'string') {						colNames[i] = {							sourceAttID: colAttributes[i],							colID: colAttributes[i].split(".").join("_"),							title: colNames[i],							width: width,							sortable: true,							readOnly: false,							specialEdit: false						}					}					else {						if (colAttributes[i].colID === undefined) {							colAttributes[i].colID = colAttributes[i].sourceAttID;						}						if (colAttributes[i].title === undefined) {							colAttributes[i].title = colAttributes[i].sourceAttID;						}						if (colAttributes[i].width === undefined) {							colAttributes[i].width = 130;						}						if (colAttributes[i].sortable === undefined) {							colAttributes[i].sortable = true;						}						if (colAttributes[i].readOnly === undefined || colAttributes[i].readOnly == 'false') {							colAttributes[i].readOnly = false;						}					}				}				return colNames;			},			// initializes the grid with passed options			initWithOptions: function(options){				var dataGrid = options.dataGrid;				dataGrid.dataSource = options.dataSource;				dataGrid.subscriberID = options.subscriberID;				dataGrid.isIncluded = options.included || false;				if (options.errorDiv != null)					dataGrid.widget.setErrorDiv(options.errorDiv);				if (options.mustDisplayError != null)					dataGrid.allowErrorDisplay(options.mustDisplayError);				if (options.inDesign)					dataGrid.isInDesign = true;				else					dataGrid.isInDesign = false;				if (options.columns == null) {					// then we need to call the old code					options.columns = this.checkColumnsDefinition(options.colNames ? options.colNames : options.columns, options.colAttributes ? options.colAttributes : options.columns);					if (options.columns == null && !dataGrid.isInDesign) {						options.columns = this.checkColumnsDefinition(dataSource.getAttributeNames())					}				}				else {					// now the 'data-column' generated by the studio contains a JSON represenation of the columns, so it is already almost fully good					var cols = options.columns;					var nbcol = cols.length;					for (var i = 0; i < nbcol; i++) {						var col = cols[i];						if (col.format != null && typeof(col.format) == 'string') {							col.format = {								format: col.format							};						}						if (col.colID == null && col.sourceAttID != null) {							col.colID = col.sourceAttID.split(".").join("_");						}						if (col.sortable == null)							col.sortable = true;					}				}				/*				 if (options.columns == null || options.columns.length == 0)				 {				 options.columns = [{ coldID:"col1" }];				 }				 */				//WAF.utils.debug.console.log('[DataGrid] WAF.classes.DataGrid._private.functions.initWithOptions called');				//dataGrid._private.globals.dataStore = options.dataStore;				var gridViewOptions = {					cacheSize: options.cacheSize,					columns: options.columns,					rowHeight: options.rowHeight,					cls: options.cls,					selMode: options.selMode,					hideFooter: options.hideFooter,					hideHeader: options.hideHeader,					textFooter: options.textFooter				};				dataGrid._private.globals.columnsDefinition = options.columns;				// create grid at specified node				if (!!options.parentNodeId) {					gridViewOptions.createInNode = $('#' + options.parentNodeId);				}				else					if (!!options.parentNode) {						gridViewOptions.createInNode = $('#' + options.parentNode);					}					else {						return false;					}				// init the grid				dataGrid.gridController.gridView.initWithOptions(gridViewOptions);				dataGrid.sortColumn = null;				if (dataGrid.isInDesign)					dataGrid.sortOrder = null;				else {					dataGrid.sortOrder = null;					// get data					// dataGrid._private.functions.queryEntityCollection({ dataGrid : dataGrid, query : options.query,customUrl : options.cutomUrl });					if (dataGrid.sortColumn != null) {						dataGrid.gridController.gridView.setSortIndicator(dataGrid.sortColumn, dataGrid.sortOrder);					}				}				// try to display data if already available				dataGrid.gridController.gridView.computeRowWidth();				dataGrid.redraw();			}		},		handlers: {}	};	/**	 * DataGrid.initWithOptions(options)	 * \~english	 * @brief             Initializes the grid	 * @details           Grid is initialized with options, of which most are optional.	 *	 * @param options : object	 *	 * @return this : DataGrid	 *	 * @code	 *	 * // set options for the grid	 * // create with Contacts datastore class, use default attributes	 *	 * var options = {	 * 	createInNode	: $('#myGrid'),	 * 	dataClass		: 'Contacts'	 * }	 *	 * // create a data grid	 * var myGrid = new WAF.classes.DataGrid().initWithOptions(options);	 *	 * @endcode	 */	this.initWithOptions = function(options){		//WAF.utils.debug.console.log('[DataGrid] WAF.classes.DataGrid._private.functions.initWithOptions called');		// set reference to the object		options.dataGrid = this;		this._private.functions.initWithOptions(options);		return this;	}	this.allowErrorDisplay = function(display){		if (typeof display === 'boolean')			this._private.globals.mustDisplayError = display;		return this._private.globals.mustDisplayError;	}	this.redraw = function(){		if (!this.isInDesign /*&& this._private.globals.dataStore*/) {			var itemCount = 0;			if (this.dataSource) {				itemCount = this.dataSource.length;			}			for (var rowCount = 0; rowCount < this.gridController.gridView._private.globals.rows.length; rowCount++) {				var row = this.gridController.gridView._private.globals.rows[rowCount];				row.needsDataUpdate = true;			}			// check if entity count matches row count for the grid			// if not, update grid row numbers			//if (itemCount != this.gridController.gridView.getRowCount())			//{			this._private.globals.itemCount = itemCount;			this.gridController.gridView.setRowCount(itemCount);			//}			// this._private.globals.entityCollectionResultEvent = event;			// update rows			// replace with public API			this.gridController.gridView._private.functions.updateRowPositions({				gridView: this.gridController.gridView,				forceUpdate: true			});			this.gridController.gridView._private.functions.updateVisibleRowData({				gridView: this.gridController.gridView			});			/*			 if ($("#containerLoading"))			 {			 $("#containerLoading").fadeOut('fast');			 }			 */		}	}	/*	 // Set grid controller functions	 */	this.kill = function(){		this.gridController.gridView.kill();	}	this.gridController = new WAF.classes.GridController();	this.gridController.dataGrid = this;	this.gridController.errorHandler = function(event){		var gridView = event.userData.gridView;		var gridController = gridView.gridController;		var handler = gridController.onError;		var cont = true;		if (handler != null) {			var b = handler(event);			if (b != null && b === false)				cont = false;		}		if (cont) {			var errordiv = gridController.dataGrid.widget.getErrorDiv();			event.message = event.userData.errorMessage || null;			WAF.ErrorManager.displayError(event, errordiv);		}	}	this.gridController.getColumnCount = function(grid){		var result, columnDef;		columnDef = this.dataGrid._private.globals.columnsDefinition;		if (typeof(columnDef) == 'object') {			result = columnDef.length;		}		else {			result = 0;		}		return result;	}	this.gridController.getRowCount = function(grid){		//WAF.utils.debug.console.log('[DataGrid] WAF.classes.GridController.getRowCount called');		return this.dataGrid._private.globals.itemCount;	}	this.gridController.setContentForRow = function(rowNumber){		if (!this.dataGrid.isInDesign)			//this.dataGrid._private.globals.dataStore.getEntityByPosition(rowNumber, this.parseEntity, this.dataGrid, false);			if (this.dataGrid.dataSource) {				this.dataGrid.dataSource.getElement(rowNumber, {					onSuccess: this.parseElement,					onFailure: this.parseElement,					delay: 10,					delayID: this.dataGrid.subscriberID				}, this.dataGrid)			}		// return blank array since we'll call handler that will populate this		return [];	}	this.gridController.setStyleForRow = function(rowNumber){		return {			rowStyle: ((rowNumber % 2) ? 'waf-widget-odd' : 'waf-widget-even')		};	}	this.gridController.isContentAvailableForRow = function(rowNumber){		//return this.dataGrid._private.globals.dataStore.isEntityInCache(rowNumber);		return true;	}	this.gridController.onHeaderClick = function(cell, columnNumber){		if (!this.dataGrid.isInDesign) {			//console.log(this.dataGrid._private.globals.columnsDefinition[columnNumber])			if (!this.dataGrid._private.globals.columnsDefinition[columnNumber].sortable) {				return;			}			/*			 if ($("#containerLoading"))			 {			 $("#containerLoading").show();			 }			 */			// Set the sortOrder			if (this.dataGrid.sortColumn != null) {				// Clear sortIndicator				this.dataGrid.gridController.gridView.resetSortIndicator(this.dataGrid.sortColumn);				if (columnNumber === this.dataGrid.sortColumn) {					if ((!this.dataGrid.sortOrder) | (this.dataGrid.sortOrder === 'desc')) {						this.dataGrid.sortOrder = 'asc';					}					else {						this.dataGrid.sortOrder = 'desc';					}				}				else {					this.dataGrid.sortOrder = 'asc';				}			}			else {				this.dataGrid.sortOrder = 'asc';			}			this.dataGrid.sortColumn = columnNumber;			this.dataGrid.gridController.gridView.setSortIndicator(this.dataGrid.sortColumn, this.dataGrid.sortOrder);			this.dataGrid.dataSource.orderBy(this.dataGrid._private.globals.columnsDefinition[columnNumber].sourceAttID + " " + this.dataGrid.sortOrder /*, { keepSelection: this.dataGrid.getSelection().prepareToSend()} */);		}	}	/*	 // Custom grid controller functions	 */	this.gridController.parseElement = function(event){		var dataGrid = event.data;		var rowNumber = event.position;		var elem = event.element;		var gridView = dataGrid.gridController.gridView;		if (event.error != null && event.error.length > 0) {			gridView.drawRow(rowNumber, null);		}		else {			gridView.drawRow(rowNumber, elem);		}	}	this.column = function(colRef, colSettings){		return this.gridController.gridView.column(colRef, colSettings);	}	this.columns = function(colSettings){		return this.gridController.gridView.columns(colSettings);	}	this.centerRow = function(rowNumber, options){		options = options;		var gridView = this.gridController.gridView;		gridView.centerRow(rowNumber, options);	}	this.setOptions = function(options){		var gridView = this.gridController.gridView;		gridView.setOptions(options);	}	this.setReadOnly = function(inReadOnly){		var doLock = true;		if (arguments.length > 0 && typeof inReadOnly === 'boolean') {			doLock = inReadOnly;		}		this.readOnly = doLock;		// Toolbar		if (doLock) {			$("#" + this.subscriberID + " .waf-dataGrid-footer .waf-toolbar").hide();		}		else {			$("#" + this.subscriberID + " .waf-dataGrid-footer .waf-toolbar").show();		}		// Columns		var cols = this.columns();		if (cols != null) {			cols.forEach(function(theCol, idx, arr){				theCol.readOnly = doLock;			});		}	}	this.getSortIndicator = function(){		// One or all elements may be null. order is a string, 'asc', 'desc'		return {			colNb: this.sortColumn,			order: this.sortOrder		};	}	this.setSortIndicator = function(colNum, order){		this.sortColumn = colNum;		this.sortOrder = order;		this.gridController.gridView.setSortIndicator(colNum, order);	}	this.resetSortIndicator = function(columnNb){		this.sortColumn = null;		this.sortOrder = null;		this.gridController.gridView.resetSortIndicator(columnNb);	}	// Sort only the first columns found with a sort indicator	this.sortAgain = function(options, userData) // options is optionnal. Contains the usual onSuccess/onError callbacks	{		var col = this.sortColumn !== null ? this.sortColumn : -1, order = this.sortOrder ? this.sortOrder : '';		options = options || {};		userData = userData || null;		//options.keepSelection = this.getSelection().prepareToSend();		if (col >= 0 && (order === 'asc' || order === 'desc')) {			this.dataSource.orderBy(this._private.globals.columnsDefinition[col].sourceAttID + " " + order, options, userData);		}	}	this.getSelectionMode = function(){		return this.gridController.gridView.getSelectionMode();	}	this.setSelectionMode = function(inMode){		this.gridController.gridView.setSelectionMode((inMode));	}	this.countSelected = function(){		return this.gridController.gridView.countSelected();	}	this.getSelectedRows = function(){		return this.gridController.gridView.getSelectedRows();	}	this.setSelectedRows = function(rowNumbers){		this.gridController.gridView.setSelectedRows(rowNumbers);	}	this.getSelection = function(){		return this.gridController.gridView.getSelection();	}	this.reduceToSelected = function(options, userData){		var rows;		// Handle special case (all selected)		if (this.gridController.gridView.countSelected() === this.dataSource.length) {			this.gridController.gridView.resetSelection();		}		else {			this.dataSource.buildFromSelection(this.getSelection(), options, userData);		}	}	this.setRowHeight = function(rowHeight){		this.gridController.gridView.setRowHeight(rowHeight);		this.redraw();	}	this.getRowHeight = function(){		return this.gridController.gridView._private.globals.rowHeight;	}	this.goToCell = function(rowPos, colID, handler){		this.gridController.gridView.goToCell(rowPos, colID);	}	this.stopEditing = function(handler){		this.gridController.gridView.goToCell(rowPos, colID);	}	/*	 // Constructor	 */	if (!!options) {		this.initWithOptions(options);	}	// subscribe to the dataSource if any	var gridThis = this;	if (!this.isInDesign && this.dataSource != null) {		this.dataSource.addListener("all", WAF.classes.DataGrid.gridSourceEventHandler, {			listenerID: options.subscriberID,			listenerType: 'grid'		}, {			dataGrid: this		});	}	// default behaviour	if (!this.isInDesign && this.dataSource != null) {		this.gridController.onRowClick = function(event){			//if (this.dataSource._private.subscribers.length > 0)			//gridThis.dataSource.select(position);		};	}	return this;}// -----------------------------------------------------WAF.classes.DataGrid.widgetBoolHandler = function(domObj, event, val){	var parent = $(domObj).parent();	var row = parent[0].gridRow;	var cell = parent[0].gridCell;	var dataSource = row.gridView.gridController.dataGrid.dataSource;	var sourceAtt = dataSource.getAttribute(cell.col.sourceAttID);	if (sourceAtt != null) {		row.gridView._private.globals.needAutoSave = true;		sourceAtt.setValue(val);	}}WAF.classes.DataGrid.checkBoxHandler = function(event){	var val = this.checked;	WAF.classes.DataGrid.widgetBoolHandler(this, event, val);}WAF.classes.DataGrid.radioTrueHandler = function(event){	WAF.classes.DataGrid.widgetBoolHandler(this, event, true);}WAF.classes.DataGrid.radioFalseHandler = function(event){	WAF.classes.DataGrid.widgetBoolHandler(this, event, false);}WAF.classes.DataGrid.gridSourceEventHandler = function(event) {	var grid = event.data.dataGrid;	var gridView = grid.gridController.gridView;	var gvFunctions = gridView._private.functions;	var gvars = gridView._private.globals;	if (event.eventKind == 'onCollectionChange') {		var posInSource = event.dataSource.getPosition();		//gridView.setCurrentRow(posInSource, false);		gvars.currentRow = posInSource;		gvFunctions.hideCurrentRows({			gridView : gridView		});		if (event.transformedSelection == null)			gridView.resetSelection();		grid.redraw();		gvFunctions.showCurrentRows({			gridView : gridView		});	}	if (event.eventKind == "onSelectionChange") {		gvFunctions.hideCurrentRows({			gridView : gridView		});		gvFunctions.showCurrentRows({			gridView : gridView		});	} else if (event.eventKind == "onAttributeChange") {		var posInSource = event.dataSource.getPosition();		var col = grid.column(event.attributeName);		var updateval = event.dataSource[event.attributeName];		gridView.updateCell(posInSource, event.attributeName/* faire une indirection ici pour retrouver le colID a partir de l'attribute name */, updateval);	} else if (event.eventKind == 'onBeforeCurrentElementChange') {		var posInSource = event.dataSource.getPosition();		gridView.drawRow(posInSource, event.dataSource, true);		if (gvars.needAutoSave) {			gvars.needAutoSave = false;			event.dataSource.save({				onError : gridView.gridController.errorHandler || null			});		}	} else if (event.eventKind == 'onCurrentElementChange' || event.eventKind == 'onCollectionChange') {		var mustSelectRows = null;		if (event.eventData != null)			mustSelectRows = event.eventData.mustSelectRows || null;		if (mustSelectRows != null) {			gvFunctions.hideCurrentRows({				gridView : gridView			});		}		var posInSource = event.dataSource.getPosition();		gridView.setCurrentRow(posInSource, event.transformedSelection != null);		gridView.drawRow(posInSource, event.dataSource);		if (mustSelectRows != null) {			var sel = gridView.getSelection();			sel.setSelectedRows(mustSelectRows);			gvFunctions.showCurrentRows({				gridView : gridView			});		}		var dispatcherOptions = event.dispatcherOptions;		if (WAF.PLATFORM.modulesString === "mobile") {			$("#" + grid.subscriberID + "-viewportNode").trigger('touchend');		}		if (dispatcherOptions != null) {			if (dispatcherOptions.gridView != null && dispatcherOptions.execOnEventDispatch != null) {				dispatcherOptions.execOnEventDispatch(dispatcherOptions.gridView);			}		}	} else if (event.eventKind == 'onElementSaved') {		var posInSource = event.position;		var elem = event.element;		gridView.drawRow(posInSource, elem);	}}/** * ---------------------------------------------------------------------------- * content of widget-dataGrid-view.js * ---------------------------------------------------------------------------- *//** * @brief			GridView, part of WAF/UI/Grid * @details			Infinite scrolling grid object * * * * @author			rudolfpsenicnik * @date			February 2009 * @version			1.0 * * @include			copyright.txt */if (WAF.gridUtil == null) {	WAF.gridUtil = {};}WAF.classes.GridView = function(){	var theGridView = this;	var visibleHeaderHeight = (WAF.PLATFORM.modulesString === "mobile") ? 25 : 32,		visibleFooterHeight = (WAF.PLATFORM.modulesString === "mobile") ? 25 : 30;	var rowHeight;	(WAF.PLATFORM.modulesString === "mobile") ? rowHeight = 50 : rowHeight = 27;	// Private	this._private = {		globals: {			options: {				autoScrollOnSelected: true			},			// DOM nodes			headerNode: null, // headerNode - viewport for the column titles			headerContainerNode: null, // headerContainerNode - container for header row bound horizontally to viewportContainerNode			targetNode: null, // DOM node where grid is inserted			viewportNode: null, // viewport node that holds scrollable content (rows)			viewportContainerNode: null, // container for viewports, provides system scrollbars			statusNode: null, // statusNode - viewport for status bar			// rows			rows: [], // array of row objects			pageSize: 0, // how many rows per page.			visibleRowCount: 0, // how many rows are visible on screen at one time?			visibleAndCacheRowCount: 0, // visible and cached row count			totalRowCount: 0, // how many rows should there be in total?			rowHeight: rowHeight, // used to calculate viewport height			enableAlternateRowStyling: true, //			rowContentUpdateDelayInMs: 0,			/*	miliseconds that need to pass before requesting data for row			 set to 0 to disable			 this is to prevent too many row content update requests			 while rapidly scrolling			 */			rowContentUpdateDelayEvent: null, // row content update delay window.setTimeout event			useHoverEffectForRows: true, // applies .hover class name to row when hovered over			// columns			columns: [], // array of column objects			// cells			cellNeedsUpdateHTMLContent: '&nbsp', // displayed in cell that is still waiting for data			// cache			cacheSizeInPages: 0, // how many pages of rows will be rendered off-screen			cacheSizeInRows: 0, // calculated based on number of cache pages			// flags			currentlyUpdatingRowPositions: false, // rows are being repositioned			vScrollBarWidth: 15,			resizeHasBeenStarted: false,			editHasBeenStarted: false,			currentRow: -1,			lastActiveCell: null		},		selection: {			//sel			: new WAF.Selection('single'),			cssClass: 'waf-state-active', // Centralize the name of the class			curEvt: null		},		functions: {			// initializes the grid with passed options			initWithOptions: function(options){				//WAF.utils.debug.console.log('[GridView] WAF.classes.GridView._private.functions.initWithOptions called');				var gridView = options.gridView;				if ((options.cacheSize != undefined) && (options.cacheSize != null)) {					gridView._private.globals.cacheSizeInPages = options.cacheSize;				}				if (!!options.rowHeight) {					gridView._private.globals.rowHeight = options.rowHeight;				}				if (options.selMode && options.selMode === 'multiple' || options.selMode === 'none') {					var sel = gridView.getSelection();					if (sel != null) {						sel.reset(options.selMode);					}				}				if (options.hideFooter) {					gridView._private.globals.footerHeight = 0;				}				else {					gridView._private.globals.footerHeight = visibleFooterHeight;				}				if (options.hideHeader) {					gridView._private.globals.headerHeight = 0;				}				else {					gridView._private.globals.headerHeight = visibleHeaderHeight;				}				gridView._private.globals.footerText = options.textFooter;				// create DOM node and insert basic DOM elements				gridView._private.functions.initGridDOMatNode({					node: options.createInNode,					gridView: gridView,					columns: options.columns,					cls: options.cls				});			},			// sets up grid at specified node, creates basic DOM elements			initGridDOMatNode: function(options){				//WAF.utils.debug.console.log('[GridView] WAF.classes.GridView._private.functions.initGridDOMatNode called');				var gridView = options.gridView;				// set grid node as private variable				var targetNode = options.node;				gridView._private.globals.targetNode = options.node;				targetNode.data('type', 'dataGrid').addClass('waf-widget waf-dataGrid ' + options.cls || '').empty();				// create header node				var headerNode = $('<div></div>').addClass('waf-widget-header waf-dataGrid-header waf-user-select-none');				gridView._private.globals.headerNode = headerNode;				// add header node to DOM				headerNode.appendTo(targetNode);				// add header container to DOM				var headerContainerNode = $('<div></div>').addClass('container');				gridView._private.globals.headerContainerNode = headerContainerNode;				headerContainerNode.appendTo(headerNode);				// create viewport node				var viewportNode = $('<div></div>').addClass('waf-widget-body waf-dataGrid-body');				if (WAF.PLATFORM.modulesString === "mobile") {					viewportNode.prop('id', options.node[0].id + "-viewportNode");				}				gridView._private.globals.viewportNode = viewportNode;				// add viewport node to DOM				viewportNode.appendTo(targetNode);				// bind events				viewportNode.bind('scroll', {					gridView: gridView				}, gridView._private.functions.onViewportScroll);				// add viewport container to DOM				var viewportContainerNode = $('<div></div>').addClass('container');				gridView._private.globals.viewportContainerNode = viewportContainerNode;				viewportContainerNode.appendTo(viewportNode);				//manage touch device				if (WAF.PLATFORM.modulesString === "mobile") {					viewportContainerNode[0].id = options.node[0].id + "-viewportContainerNode";					// bind touch events					viewportContainerNode.bind('touchmove', {						gridView: gridView					}, function(){						gridView._private.globals.headerContainerNode.css("margin-left", gridView._private.globals.viewportContainerNode.position().left + "px")						gridView._private.globals.containerMoved = true;						gridView._private.globals.istouch = false;					});					viewportNode.bind('touchend', {						gridView: gridView					}, gridView._private.functions.onViewportScroll);				}				// create status node				var statusNode = $('<div></div>').addClass('waf-widget-footer waf-dataGrid-footer waf-status waf-user-select-none');				gridView._private.globals.statusNode = statusNode;				// add status node to DOM				statusNode.appendTo(targetNode);				// create statusLeftContainer node				var statusLeftContainer = $('<div></div>').addClass('waf-status-element waf-status-left');				gridView._private.globals.statusLeftContainer = statusLeftContainer;				statusLeftContainer.appendTo(statusNode);				function hitPlus(event){					gridView._private.functions.endEditCell({						gridView: gridView,						saveAnyway: true,						saveHandler: function hitPlusSave(event){							WAF.gridUtil.addRow(gridView);						}					});				}				function hitMinus(event){					gridView._private.functions.endEditCell({						gridView: gridView,						saveAnyway: true,						saveHandler: function hitMinusSave(event){							WAF.gridUtil.delRow(gridView);						}					});				}				/*				 if (gridView.gridController.dataGrid.isIncluded)				 {				 // in the futur we may generate a special toolbar				 }				 else				 */				if (true) {					var toolbar = new WAF.widget.Toolbar([{						icon: {							size: 16,							type: 'plus'						},						text: '',						title: 'Add',						click: !gridView.gridController.dataGrid.isInDesign && hitPlus					}, {						icon: {							size: 16,							type: 'minus'						},						text: '',						title: 'Delete',						click: !gridView.gridController.dataGrid.isInDesign && hitMinus					}]);					toolbar.appendTo(statusLeftContainer);				}				/* if (!gridView.gridController.dataGrid.isInDesign)				 {				 toolbar.find('.waf-button').bind('click', {gridView: gridView}, function(event)				 {				 var gridView = event.data.gridView;				 WAF.gridUtil[$(this).prop('data-action')](gridView);				 });				 } */				// create statusCenterContainer node				var statusCenterContainer = $('<div></div>').addClass('waf-status-element waf-status-center');				gridView._private.globals.statusCenterContainer = statusCenterContainer;				// add statusCenterContainer node to DOM				statusCenterContainer.appendTo(statusNode);				// create statusRightContainer node				var statusRightContainer = $('<div></div>').addClass('waf-status-element waf-status-right');				gridView._private.globals.statusRightContainer = statusRightContainer;				// add statusRightContainer node to DOM				statusRightContainer.appendTo(statusNode);				// need to know column count at this point				// check with controller for column number				if (!!gridView.gridController) {					if (!!gridView.gridController.getColumnCount) {						var columnCount = gridView.gridController.getColumnCount(gridView);						if (!!columnCount) {							gridView._private.functions.setColumnCount({								gridView: gridView,								columnCount: columnCount,								columns: options.columns							});						}					}				}				// resize viewport and container				gridView._private.functions.updateHeaderSize({					gridView: gridView				});				gridView._private.functions.updateViewportSize({					gridView: gridView				});				gridView._private.functions.updateStatusSize({					gridView: gridView				});				gridView._private.functions.updateViewportContainerSize({					gridView: gridView				});				// add rows and cells				gridView._private.functions.updateDOMToMatchRowAndColumnCounts({					gridView: gridView,					columns: options.columns,					init: true				});				if (!gridView.gridController.dataGrid.isInDesign) {					if (gridView.gridController.dataGrid.dataSource == null) {						$('<div class="waf-datagrid-missingBinding">Datasource is either missing <br>or <br>invalid</div>').appendTo(viewportContainerNode);					}				}			},			refresh: function(options){				var gridView = options.gridView;				// resize viewport and container				gridView._private.functions.updateViewportContainerSize({					gridView: gridView				});				// add rows and cells				gridView._private.functions.updateDOMToMatchRowAndColumnCounts({					gridView: gridView				});				// mark all rows as needing data				for (var rowCount = 0; rowCount < gridView._private.globals.rows.length; rowCount++) {					gridView._private.globals.rows[rowCount].needsDataUpdate = true;				}				// repopulate with data				gridView.computeRowWidth();				gridView._private.functions.updateRowPositions({					gridView: gridView,					forceUpdate: true				});				gridView._private.functions.updateVisibleRowData({					gridView: gridView				});			},			setTotalRowCount: function(options){				var gridView = options.gridView;				var rowCount = options.rowCount;				var gvGlobals = gridView._private.globals;				var gvFunctions = gridView._private.functions;				gvGlobals.totalRowCount = rowCount;				// resize viewport and container				gvFunctions.updateViewportSize({					gridView: gridView				});				gvFunctions.updateViewportContainerSize({					gridView: gridView				});				// update status bar				gvGlobals.statusCenterContainer.html(rowCount + ' ' + gvGlobals.footerText);				// add rows and cells				gvFunctions.updateDOMToMatchRowAndColumnCounts({					gridView: gridView				});				//add specific scroll behavior for mobile to the viewport container				if (WAF.PLATFORM.modulesString === "mobile") {					if (gridView._private.scrollObject) {						gridView._private.scrollObject.destroy();					}					//if (!gridView._private.scrollObject && rowCount != 1) {					gridView._private.scrollObject = new iScroll(gridView._private.globals.targetNode[0].id + "-viewportNode", {						"desktopCompatibility": false					});					//}				}			},			// sets number of columns and creates column objects			setColumnCount: function(options){				var gridView = options.gridView;				var setColumnCount = options.columnCount;				gridView._private.globals.colsByID = {};				// loop with column count and create column objects				for (var columnCount = 0; columnCount < setColumnCount; columnCount++) {					// create column object					var optcol = options.columns[columnCount];					var xatt = null;					var sourceAtt = null;					var xsource = gridView.gridController.dataGrid.dataSource;					if (xsource != null) {						if (xsource.getClassAttributeByName != null) {							xatt = xsource.getClassAttributeByName(optcol.sourceAttID);							if (xatt != null)								xsource.declareDependencies(optcol.sourceAttID);						}						if (xsource.getAttribute != null) {							sourceAtt = xsource.getAttribute(optcol.sourceAttID);						}					}					var format = {};					if (xatt != null && xatt.defaultFormat != null)						format = xatt.defaultFormat;					if (optcol.format != null)						format = optcol.format;					var readOnly = false;					if (optcol.readOnly == 'false') {						optcol.readOnly = false;					}					if (optcol.readOnly || xatt == null || xatt.readOnly)						readOnly = true;					if (sourceAtt == null || !sourceAtt.isFirstLevel || !sourceAtt.simple)						readOnly = true;					var specialEdit = false;					if (xatt != null && (xatt.type === 'image' || xatt.type === 'bool'))						specialEdit = true;					var widget = options.gridView.gridController.dataGrid.widget;					var column = {						columnNumber: columnCount,						title: optcol.title,						style: optcol.style,						width: optcol.width,						format: format,						readOnly: readOnly,						specialEdit: specialEdit,						originalWidth: optcol.width,						sourceAttID: optcol.sourceAttID,						colID: optcol.colID,						gridview: gridView,						setTextSize: WAF.classes.GridColumn.setTextSize,						setFontSize: WAF.classes.GridColumn.setTextSize,						setWidth: WAF.classes.GridColumn.setWidth,						setTextColor: WAF.classes.GridColumn.setTextColor,						setColor: WAF.classes.GridColumn.setColor, // DEPRECATED						setBackgroundColor: WAF.classes.GridColumn.setBackgroundColor,						setRenderer: WAF.classes.GridColumn.setRenderer,						setFormat: WAF.classes.GridColumn.setFormat,						setAlignment: WAF.classes.GridColumn.setAlignment,						source: xsource,						att: xatt,						getFormattedValue: widget ? widget.getFormattedValue : null,						getValueForInput: widget ? widget.getValueForInput : null					};					// check for column properties					if (!!gridView.gridController.setPropertiesForColumn) {						var columnPropertiesFromController = gridView.gridController.setPropertiesForColumn(column);						if (!!columnPropertiesFromController.width) {							column.width = columnPropertiesFromController.width;						}					}					// add column object to array					gridView._private.globals.columns.push(column);					gridView._private.globals.colsByID[optcol.colID] = column;				}			},			// updates width and height for viewport container based targetNode size			updateViewportSize: function(options){				var gridView = options.gridView,					viewportTop,					viewportBottom;				viewportTop = gridView._private.globals.headerHeight;				viewportBottom = gridView._private.globals.footerHeight;				// set position of targetNode, which is DOM element where grid was created in				gridView._private.globals.viewportNode.css({					left: 0,					right: 0,					top: viewportTop + 'px',					bottom: viewportBottom + 'px'				});				// gridView._private.globals.viewportNode.height(gridView._private.globals.targetNode.height() - 25 - 20); // J.F. header code			},			// updates width and height for header container based targetNode size			updateHeaderSize: function(options){				var gridView = options.gridView;				// set position of headerNode and height to 25, which is DOM element where grid was created in				gridView._private.globals.headerNode.css({					left: 0,					right: 0				});				//gridView._private.globals.headerNode.height(32); // J.F. If customize modify updateViewportSize too "- 25"				gridView._private.globals.headerNode.height(gridView._private.globals.headerHeight);			},			// updates width and height for status container based targetNode size			updateStatusSize: function(options){				var gridView = options.gridView, statusNodeHeight;				// set position ofstatusNode and height to 15, which is DOM element where grid was created in				gridView._private.globals.statusNode.css({					left: 0,					right: 0,					bottom: 0				});				//(WAF.PLATFORM.modulesString === "mobile") ? statusNodeHeight = 25 : statusNodeHeight = 25;				statusNodeHeight = gridView._private.globals.footerHeight;				gridView._private.globals.statusNode.height(statusNodeHeight); // J.F. If customize modify updateViewportSize too "- 20"			},			// updates width and height for viewport container based on row & column properties			updateViewportContainerSize: function(options){				var gridView = options.gridView;				// width of container is width of all columns combined, calculate it				var width = 0;				for (var columnCount = 0; columnCount < gridView._private.globals.columns.length; columnCount++) {					//width += parseInt(gridView._private.globals.columns[columnCount].originalWidth);					width += parseInt(gridView._private.globals.columns[columnCount].width);				}				if (width < gridView._private.globals.viewportNode.width()) {					if (WAF.PLATFORM.modulesString === "mobile") {						// no sticky scrollbar in mobile version						width = parseInt(gridView._private.globals.viewportNode.width());					}					else {						width = parseInt(gridView._private.globals.viewportNode.width() - gridView._private.globals.vScrollBarWidth - 1);					}				}				// set container width				gridView._private.globals.viewportContainerNode.width(width);				// set header width				//gridView._private.globals.headerContainerNode.width(width + gridView._private.globals.vScrollBarWidth); // Add 50 in case vertical scrolbar is displayed				gridView._private.globals.headerContainerNode.width(width);				gridView._private.globals.headerContainerNode.height(32);				// container height is (number of rows * row height);				var numberOfRows = 0;				if (!!gridView.gridController) {					if (gridView.gridController.dataGrid.isInDesign) {						numberOfRows = 200;						gridView._private.globals.totalRowCount = numberOfRows;					}					else						if (!!gridView.gridController.getRowCount) {							var numberOfRows = gridView.gridController.getRowCount(gridView);							gridView._private.globals.totalRowCount = numberOfRows;						}				}				var height = gridView._private.globals.rowHeight * numberOfRows;				if ((height > 17895697) & (WAF.utils.environment.browser.firefox3)) {					gridView._private.globals.viewportContainerNode.height(17895697);				}				else {					gridView._private.globals.viewportContainerNode.height(height);				}			},			// updates number of row and cell DOM objects based on internal counts			updateDOMToMatchRowAndColumnCounts: function(options){				var gridView = options.gridView,					init = options.init || false;				// calculate number of visible rows				var visibleRowCount = Math.ceil(gridView._private.globals.viewportNode.height() / gridView._private.globals.rowHeight) + 1;				gridView._private.globals.pageSize = visibleRowCount;				// increase number of rows by cache page size				var rowCacheCount = Math.ceil(visibleRowCount * gridView._private.globals.cacheSizeInPages);				var visibleAndCacheRowCount = visibleRowCount + (rowCacheCount * 2);				// in case visible rows + cache page rows > total Row count				/*				 if (visibleAndCacheRowCount > gridView._private.globals.totalRowCount)				 {				 visibleAndCacheRowCount = gridView._private.globals.totalRowCount;				 }				 */				// set global variables				gridView._private.globals.visibleRowCount = visibleRowCount;				gridView._private.globals.visibleAndCacheRowCount = visibleAndCacheRowCount;				gridView._private.globals.cacheSizeInRows = rowCacheCount;				// column count for later				var numberOfColumns = gridView.gridController.getColumnCount();				// Update Header				// Check Headers				if (gridView._private.globals.headerContainerNode.cells == undefined) {					gridView._private.globals.headerContainerNode.cells = [];				}				// do we need to remove header cells?				while (gridView._private.globals.headerContainerNode.cells.length > numberOfColumns) {					var cell = gridView._private.globals.headerContainerNode.cells.pop();					cell.dom.remove();					//WAF.utils.debug.console.log('removing header cell');				}				var totalWidth = 0;				// add Header Cells				while (gridView._private.globals.headerContainerNode.cells.length < numberOfColumns) {					// Setting cell dom					var attributeCount = gridView._private.globals.headerContainerNode.cells.length;					var col = gridView._private.globals.columns[attributeCount];					var id = col.colID;					var cellWidth = col.width;					// Set last column width					if (attributeCount === numberOfColumns - 1) {						cellWidth = gridView._private.globals.viewportContainerNode.width() - totalWidth;					}					totalWidth += cellWidth;					var cell = {						dom: $('<div class="waf-dataGrid-cell waf-dataGrid-col-' + id + ' waf-dataGrid-col-' + attributeCount + '"></div>').appendTo(gridView._private.globals.headerContainerNode)					}					if (options.columns[attributeCount].sortable) {						cell.dom.addClass('clickable');					}					try {						cell.dom.width(cellWidth - parseInt(cell.dom.css('border-left-width')) - parseInt(cell.dom.css('border-right-width')) - parseInt(cell.dom.css('padding-left')) - parseInt(cell.dom.css('padding-right')) - parseInt(cell.dom.css('margin-left')) - parseInt(cell.dom.css('margin-right')));					}					catch (e) {						cell.dom.width(cellWidth);					}					// Setting sortIndicator					var sortUpIcon = new WAF.widget.Icon({						size: 16,						type: 'arrowUp',						className: 'waf-icon-sortAsc'						/*,						 state: {						 normal: {						 fill: '#fff'						 },						 hover: {						 fill: '#d00'						 },						 active: {						 fill: '#0f0'						 }						 }*/					});					var sortDescIcon = new WAF.widget.Icon({						size: 16,						type: 'arrowDown',						className: 'waf-icon-sortDesc'						/*,						 state: {						 normal: {						 fill: '#fff'						 },						 hover: {						 fill: '#d00'						 },						 active: {						 fill: '#0f0'						 }						 }*/					});					cell.sortIndicator = $('<div class="waf-sort"></div>').append(sortUpIcon.containerNode).append(sortDescIcon.containerNode);					// Setting cell title					cell.title = $('<div class="content"></div>');					// Setting cell resizeIndicator					cell.resizeIndicator = $('<div class="resize"></div>');					// Appending cell content					cell.dom.append(cell.title, cell.sortIndicator, cell.resizeIndicator);					cell.dom.width(cellWidth);					var outW = cell.dom.outerWidth();					var w = cell.dom.width();					if (outW > w)						cell.dom.width(outW + (outW - w));					cell.dom.bind('click', {						gridView: gridView,						cell: cell,						columnNumber: attributeCount					}, gridView._private.functions.onHeaderClick);					gridView._private.globals.headerContainerNode.cells.push(cell);					cell.resizeIndicator.gridView = gridView;					cell.resizeIndicator.bind('mousedown', {						gridView: gridView,						columnNumber: attributeCount					}, gridView._private.functions.startColResize);					cell.resizeIndicator.bind('click', {						gridView: gridView,						columnNumber: attributeCount					}, gridView._private.functions.onResizeClick);				}				// set Header titles				for (var columnCount = 0; columnCount < numberOfColumns; columnCount++) {					if (options.columns) {						gridView._private.globals.headerContainerNode.cells[columnCount].title.html(options.columns[columnCount].title);					}				}				// calculate width				var width = 0;				for (var columnCount = 0; columnCount < gridView._private.globals.columns.length; columnCount++) {					// Set last column width					if (columnCount === gridView._private.globals.columns.length - 1) {						var lastWidth = gridView._private.globals.viewportContainerNode.width() - width;						width += lastWidth - 1;					}					else {						width += gridView._private.globals.columns[columnCount].originalWidth;					}				}				// taking borders' width into account				width += gridView._private.globals.columns.length - 1;				if (gridView._private.globals.totalRowCount < visibleRowCount) {					// do we need to remove rows?					while (gridView._private.globals.rows.length > visibleRowCount) {						var row = gridView._private.globals.rows.pop();						row.insideDom.remove();						row.dom.remove();						//WAF.utils.debug.console.log('removing row');					}					//if (width < gridView._private.globals.viewportNode.width()) {					//	width = gridView._private.globals.viewportNode.width();					//}				}				else {					//if (width < gridView._private.globals.viewportNode.width() - gridView._private.globals.vScrollBarWidth) {					//	width = gridView._private.globals.viewportNode.width() - gridView._private.globals.vScrollBarWidth;					//}					gridView._private.globals.viewportContainerNode.width(width);				}				if (gridView.gridController.dataGrid.isInDesign) {					// Inserting 3 rows to show even & odd alternation					for (var i = 0; i < 3; i++) {						var row = {							dom: $('<div></div>').addClass('waf-widget-content waf-dataGrid-row').appendTo(gridView._private.globals.viewportContainerNode),							offsetTop: rowNumber * gridView._private.globals.rowHeight, // viewport offset used to position row							rowNumber: 0,							needsDataUpdate: false,							cells: [],							style: '',							oldStyle: ''						}						row.dom.width(width);						row.insideDom = $('<div></div>').addClass('waf-datagrid-row-inside').appendTo(row.dom);						row.insideDom.width(width);						/*						 try {						 row.dom.height(gridView._private.globals.rowHeight - parseInt(row.dom.css('border-bottom-width')) - parseInt(row.dom.css('border-top-width')) - parseInt(row.dom.css('padding-bottom')) - parseInt(row.dom.css('padding-top')) - parseInt(row.dom.css('margin-bottom')) - parseInt(row.dom.css('margin-top')));						 } catch (e) {						 row.dom.height(gridView._private.globals.rowHeight);						 }						 */						row.dom.height(gridView._private.globals.rowHeight);						for (var attributeCount = 0; attributeCount < numberOfColumns; attributeCount++) {							var col = gridView._private.globals.columns[attributeCount];							var cellWidth = col.width;							var cellStyle = col.style;							var id = col.colID;							var cell = {								dom: $('<div class="waf-dataGrid-cell waf-dataGrid-col-' + id + ' waf-dataGrid-col-' + attributeCount + '"></div>').addClass(cellStyle).appendTo(row.insideDom)							}							cell.insideCell = $('<div class="content">Text</div>').appendTo(cell.dom);							try {								cell.dom.width(cellWidth - parseInt(cell.dom.css('border-left-width')) - parseInt(cell.dom.css('border-right-width')) - parseInt(cell.dom.css('padding-left')) - parseInt(cell.dom.css('padding-right')) - parseInt(cell.dom.css('margin-left')) - parseInt(cell.dom.css('margin-right')))							}							catch (e) {								cell.dom.width(cellWidth);							}							cell.insideCell.width(cellWidth);							/* changed by L.R newHeight							 try {							 cell.dom.height(gridView._private.globals.rowHeight - parseInt(row.dom.css('border-bottom-width')) - parseInt(row.dom.css('border-top-width')) - parseInt(row.dom.css('padding-bottom')) - parseInt(row.dom.css('padding-top')) - parseInt(row.dom.css('margin-bottom')) - parseInt(row.dom.css('margin-top')) - parseInt(cell.dom.css('border-bottom-width')) - parseInt(cell.dom.css('border-top-width')) - parseInt(cell.dom.css('padding-bottom')) - parseInt(cell.dom.css('padding-top')) - parseInt(cell.dom.css('margin-bottom')) - parseInt(cell.dom.css('margin-top')));							 } catch(e) {							 cell.dom.height(gridView._private.globals.rowHeight);							 }							 */							row.cells.push(cell);						}						gridView._private.globals.rows.push(row);					}				}				else {					// do we need to add rows?					var rowNumber = gridView._private.globals.rows.length;					while (gridView._private.globals.rows.length < visibleAndCacheRowCount) {						var row = {							dom: $('<div></div>').addClass('waf-widget-content waf-dataGrid-row').appendTo(gridView._private.globals.viewportContainerNode),							offsetTop: init ? 0 : rowNumber * gridView._private.globals.rowHeight, // viewport offset used to position row							rowNumber: rowNumber,							needsDataUpdate: true,							cells: [],							style: '',							oldStyle: ''						}						row.insideDom = $('<div></div>').addClass('waf-datagrid-row-inside').appendTo(row.dom);						row.dom[0].gridRow = row;						//WAF.utils.debug.console.log('adding row ' + rowNumber);						// update row width						row.dom.width(width);						row.insideDom.width(width);						row.insideDom[0].gridRow = row;						// update row height						/*						 try {						 row.dom.height(gridView._private.globals.rowHeight - parseInt(row.dom.css('border-bottom-width')) - parseInt(row.dom.css('border-top-width')) - parseInt(row.dom.css('padding-bottom')) - parseInt(row.dom.css('padding-top')) - parseInt(row.dom.css('margin-bottom')) - parseInt(row.dom.css('margin-top')));						 } catch (e) {						 row.dom.height(gridView._private.globals.rowHeight);						 }						 */						row.dom.height(gridView._private.globals.rowHeight);						row.insideDom.height(gridView._private.globals.rowHeight);						// apply events						if (!gridView.gridController.dataGrid.isInDesign) {							if (WAF.PLATFORM.modulesString === "mobile") {								row.dom.bind('touchend', {									gridView: gridView,									row: row								}, gridView._private.functions.onRowClick);							}							else {								// apply hover styles to rows if turned on								row.dom.mouseover(function(){									var thisRow = this.gridRow;									if (thisRow == null || thisRow.rowNumber < gridView._private.globals.totalRowCount) {										// WAF.utils.debug.console.log('waf-state-hover');										//if (!gridView._private.globals.editHasBeenStarted)										$(this).addClass('waf-state-hover');									}								}).mouseout(function(){									$(this).removeClass('waf-state-hover');								} // onRowClick event								).bind('click', {									gridView: gridView,									row: row								}, gridView._private.functions.onRowClick).bind('contextmenu', {									gridView: gridView,									row: row								}, gridView._private.functions.onRowRightClick).bind('dblclick', {									gridView: gridView,									row: row								},gridView.gridController.baseDblClick );							}							// increment row number							rowNumber++;							// add cells							for (var attributeCount = 0; attributeCount < numberOfColumns; attributeCount++) {								var col = gridView._private.globals.columns[attributeCount];								var cellWidth = col.width;								var cellStyle = col.style;								var id = col.colID;								var cell = {									//dom: $('<div></div>').addClass('cellCol' + attributeCount).addClass('cell').addClass('noUserSelect').addClass(cellStyle).appendTo(row.dom)									dom: $('<div class="waf-dataGrid-cell waf-dataGrid-col-' + id + ' waf-dataGrid-col-' + attributeCount + '"></div>').addClass(cellStyle).appendTo(row.insideDom)								}								//cell.insideCell = $('<div></div>').addClass('insideCell').appendTo(cell.dom);								cell.insideCell = $('<div class="content"></div>').appendTo(cell.dom);								if (col.att != null && col.att.type === 'image')									cell.insideCell.addClass("content-img");								try {									cell.dom.width(cellWidth - parseInt(cell.dom.css('border-left-width')) - parseInt(cell.dom.css('border-right-width')) - parseInt(cell.dom.css('padding-left')) - parseInt(cell.dom.css('padding-right')) - parseInt(cell.dom.css('margin-left')) - parseInt(cell.dom.css('margin-right')))								}								catch (e) {									cell.dom.width(cellWidth);								}								cell.insideCell.width(cellWidth);								/* changed by L.R newHeight								 try {								 cell.dom.height(gridView._private.globals.rowHeight - parseInt(row.dom.css('border-bottom-width')) - parseInt(row.dom.css('border-top-width')) - parseInt(row.dom.css('padding-bottom')) - parseInt(row.dom.css('padding-top')) - parseInt(row.dom.css('margin-bottom')) - parseInt(row.dom.css('margin-top')) - parseInt(cell.dom.css('border-bottom-width')) - parseInt(cell.dom.css('border-top-width')) - parseInt(cell.dom.css('padding-bottom')) - parseInt(cell.dom.css('padding-top')) - parseInt(cell.dom.css('margin-bottom')) - parseInt(cell.dom.css('margin-top')));								 } catch(e) {								 cell.dom.height(gridView._private.globals.rowHeight);								 }								 */								row.cells.push(cell);								if (WAF.PLATFORM.modulesString === "mobile") {									/*touch start*/									cell.dom.bind('touchstart', {										gridView: gridView,										columnNumber: attributeCount,										row: row,										cell: cell									}, function(event){										gridView._private.globals.istouch = true;										//gridView._private.functions.onCellClick(event);										window.setTimeout(function(){ //delay touch to trigger the cell edition											if (gridView._private.globals.istouch) {												gridView._private.globals.istouch = false;												gridView._private.functions.onCellDblClick(event)											}										}, 200);									});									/*touch end*/									cell.dom.bind('touchend', {										gridView: gridView,										columnNumber: attributeCount,										row: row,										cell: cell									}, function(event){										var gridView = event.data.gridView;										gridView._private.globals.istouch = false;									});								}								else {									cell.dom.bind('dblclick', {										gridView: gridView,										columnNumber: attributeCount,										row: row,										cell: cell									}, gridView._private.functions.onCellDblClick);									cell.dom.bind('click', {										gridView: gridView,										columnNumber: attributeCount,										row: row,										cell: cell									}, gridView._private.functions.onCellClick);									cell.dom.bind('mouseover', function(){										$(this).addClass('waf-state-hover')									});									cell.dom.bind('mouseout', function(){										$(this).removeClass('waf-state-hover')									});								}							}						}						if (init) {							init = false;							var rowHeight = row.dom.outerHeight();							var insideHeight = row.insideDom.height();							if (rowHeight < insideHeight)								rowHeight = insideHeight;							gridView._private.globals.rowHeight = rowHeight;							row.dom.height(rowHeight);							row.insideDom.height(rowHeight);						}						gridView._private.globals.rows.push(row);					}				}				// Automatically hide/show scrollbar on need				if (gridView._private.globals.viewportContainerNode.height() <= (gridView._private.globals.viewportNode.height())) {					// if we just removed the scrollbar we need to scroll to the top in case the first line is hidden					// otherwise the user won't be able to see it since the scrollbar will be removed.					if (gridView._private.globals.viewportNode.css('overflow-y') === 'auto') {						gridView._private.globals.viewportNode.scrollTop(0);					}					gridView._private.globals.viewportNode.css('overflow-y', 'hidden');					gridView.computeRowWidth(true);				} else {					gridView._private.globals.viewportNode.css('overflow-y', 'auto');				}			},			// fires when viewport scrollbar sends onscroll event			onViewportScroll: function(event){				var gridView = event.data.gridView, gvFunctions = gridView._private.functions, gvGlobals = gridView._private.globals;				if (WAF.PLATFORM.modulesString === "mobile") {					if (!gvGlobals.rowClicked) {						var topStart = gvGlobals.viewportContainerNode.position().top, leftStart = gvGlobals.viewportContainerNode.position().left, count = 0, topVal, leftVal, timer;						timer = setInterval(function(){							topVal = gvGlobals.viewportContainerNode.position().top;							leftVal = gvGlobals.viewportContainerNode.position().left;							if (topVal != topStart || leftVal != leftStart || count == 0) {								count++;								if (leftVal != leftStart) {									gvGlobals.headerContainerNode.css("margin-left", leftVal + "px");								}								gvFunctions.hideCurrentRows({									gridView: gridView								});								gvFunctions.updateRowPositions({									gridView: gridView								});								gvFunctions.updateVisibleRowData({									gridView: gridView								});								gvFunctions.showCurrentRows({									gridView: gridView								});								topStart = topVal;							}							else {								clearInterval(timer);								var ev = event;								if (gvGlobals.containerMoved) {									window.setTimeout(function(){										gridView._private.functions.onViewportScroll(ev);									}, 50);									gvGlobals.containerMoved = false;								}							}						}, 50);					}					else {						gvGlobals.rowClicked = false;					}				}				else {					gvGlobals.headerNode.scrollLeft(event.target.scrollLeft);					var gh = gvGlobals.headerNode[0];					var actualHeaderScroll = gh.scrollLeft;					if (actualHeaderScroll < event.target.scrollLeft) {						gvGlobals.headerContainerNode.width(gvGlobals.headerContainerNode.width() + event.target.scrollLeft - actualHeaderScroll);						gvGlobals.headerNode.scrollLeft(event.target.scrollLeft);					}					$('.waf-state-hover', gridView._private.globals.targetNode).removeClass('waf-state-hover');					// Remove current selection					gvFunctions.hideCurrentRows({						gridView: gridView					});					gvFunctions.updateRowPositions({						gridView: gridView					});					gvFunctions.updateVisibleRowData({						gridView: gridView					});					gvFunctions.showCurrentRows({						gridView: gridView					});				}			},			showCurrentRows: function(options){				var gridView = options.gridView, gvGlobals = gridView._private.globals, gvSel = gridView._private.selection, sel = gridView.getSelection(), gvFunctions = gridView._private.functions, classActive = gvSel.cssClass, rowNumber, row, theRows;				if (sel != null) {					if (sel.isModeSingle()) {						rowNumber = gvGlobals.currentRow;						if (rowNumber != null && rowNumber != -1) {							row = gvFunctions.getRowByRowNumber({								gridView: gridView,								rowNumber: rowNumber							});							if (row != null) {								row.dom.addClass(classActive);							}						}					}					else						if (sel.isModeMultiple()) {							theRows = gvGlobals.rows;							for (var i = 0, max = theRows.length; i <= max; ++i) {								row = theRows[i];								if (row != null && sel.isSelected(row.rowNumber)) {									row.dom.addClass(classActive);								}							}						}				}			},			hideCurrentRows: function(options){				var gridView = options.gridView, gvSel = gridView._private.selection, sel = gridView.getSelection();				classActive = gvSel.cssClass;				if (sel != null) {					if (sel.isModeSingle()) {						$('.waf-dataGrid-row.' + classActive, gridView._private.globals.targetNode).removeClass(classActive);					}					else						if (sel.isModeMultiple()) {							$('#' + gridView.gridController.dataGrid.subscriberID + ' .waf-widget-body .container').children().removeClass(classActive);						}				}			},			// redraws rows so that they will be placed inside visible area of the viewport			updateRowPositions: function(options){				var gridView = options.gridView;				var forceUpdate = options.forceUpdate || false;				var gvar = gridView._private.globals;				var rows = gvar.rows;				var grid = gridView.gridController.dataGrid;				if (grid.dataSource == null)					return;				gridView.fixWebKitBug();				// if grid is already being populated, call this function again later				if (gvar.currentlyUpdatingRowPositions) {					window.setTimeout(function(){						gridView._private.functions.updateRowPositions(options)					}, 100);					return false;				}				else {					gvar.currentlyUpdatingRowPositions = true;				}				// get viewport top scroll position				var viewportTop;				if (WAF.PLATFORM.modulesString === "mobile") {					viewportTop = -(gridView._private.globals.viewportContainerNode.position().top);				}				else {					viewportTop = gvar.viewportNode.scrollTop();				}				// calculate what's the first row position, as well as internal position inside .rows array				// include cache size offset				// since when we're here scrolling has already been done by the browser we need to see which				// row(s) are hidden and the first visible one				var firstVisibleRowPosition = Math.floor(viewportTop / gvar.rowHeight) - gvar.cacheSizeInRows;				// make sure cache offset doesn't go behind existing row numbers				firstVisibleRowPosition = (firstVisibleRowPosition >= 0) ? firstVisibleRowPosition : 0;				// calculate internal position inside .rows array				var firstVisibleRowInternalId = firstVisibleRowPosition % rows.length;				// calculate what's the last row position, as well as internal position inside .rows array				var lastVisibleRowPosition = firstVisibleRowPosition + rows.length - 1;				// make sure cache offset doesn't go behind above row numbers				lastVisibleRowPosition = (lastVisibleRowPosition <= gvar.totalRowCount) ? lastVisibleRowPosition : gvar.totalRowCount;				// calculate internal position inside .rows array				var lastVisibleRowInternalId = lastVisibleRowPosition % rows.length;				grid.dataSource.setDisplayLimits(grid.subscriberID, firstVisibleRowPosition, lastVisibleRowPosition);				// check if first and last visible rows should currently be visible				if ((rows[firstVisibleRowInternalId].rowNumber !== firstVisibleRowPosition) ||				(rows[lastVisibleRowInternalId].rowNumber !== lastVisibleRowPosition) ||				forceUpdate) {					// it's not, reposition rows					for (var rowCount = 0; rowCount < rows.length; rowCount++) {						// what's the row position inside .rows array?						var internalRowId = ((firstVisibleRowInternalId + rowCount) < rows.length) ? (firstVisibleRowInternalId + rowCount) : (rowCount - (rows.length - firstVisibleRowInternalId));						// calculate row positions						var currentRow = rows[internalRowId];						var currentRowPosition = firstVisibleRowPosition + rowCount;						var currentRowNumber = currentRow.rowNumber;						// check if current row position matches what position should be						if (currentRowNumber !== currentRowPosition || forceUpdate) {							// row position didn't match, move it to right location							//var rowCSSTop = ((currentRowPosition * gvar.rowHeight) - (internalRowId * gvar.rowHeight));							var rowCSSTop = currentRowPosition * gvar.rowHeight;							// set row contents to blank							for (var cellCount = 0; cellCount < currentRow.cells.length; cellCount++) {								currentRow.cells[cellCount].insideCell.html(gvar.cellNeedsUpdateHTMLContent);								currentRow.cells[cellCount].dom.height(gvar.rowHeight);								currentRow.cells[cellCount].insideCell.height(gvar.rowHeight);							}							currentRow.rowNumber = currentRowPosition;							currentRow.needsDataUpdate = true;							currentRow.dom.css('top', rowCSSTop + 'px');						}					}				}				gvar.currentlyUpdatingRowPositions = false;			},			// go through the visible rows and request data from controller			updateVisibleRowData: function(options){				var gridView = options.gridView;				/*				if (false) {					// clear existing events					window.clearTimeout(gridView._private.globals.rowContentUpdateDelayEvent);					gridView._private.globals.rowContentUpdateDelayEvent = null;					// if event wasn't delayed, delay it and call this function again					if (!options.isDelayedForCache) {						// call delay on update						var delayOptions = options;						delayOptions.isDelayedForCache = true;						gridView._private.globals.rowContentUpdateDelayEvent = window.setTimeout(function(){							gridView._private.functions.updateVisibleRowData(delayOptions);						}, 20);						return;					}					// calculate internal position inside .rows array					var firstVisibleRowInternalId = firstVisibleRowPosition % gridView._private.globals.rows.length;					for (var rowCount = firstVisibleRowInternalId; rowCount < gridView._private.globals.rows.length; rowCount++) {						var row = gridView._private.globals.rows[rowCount];						if (row.needsDataUpdate) {							row.dom.removeClass('waf-state-hover');							if (!!gridView.gridController) {								if (!!gridView.gridController.setContentForRow) {									if (gridView.gridController.isContentAvailableForRow(row.rowNumber)) {										gridView._private.functions.setRowContents({											contents: gridView.gridController.setContentForRow(row.rowNumber),											rowNumber: row.rowNumber,											gridView: gridView										});										row.style = gridView.gridController.setStyleForRow(row.rowNumber).rowStyle;										if (row.style != row.oldStyle) {											row.dom.addClass(row.style);											row.dom.removeClass(row.oldStyle);											row.oldStyle = row.style;										}										row.needsDataUpdate = false;									}								}							}						}					}					for (var rowCount = 0; rowCount < firstVisibleRowInternalId; rowCount++) {						var row = gridView._private.globals.rows[rowCount];						if (row.needsDataUpdate) {							row.dom.removeClass('waf-state-hover');							if (!!gridView.gridController) {								if (!!gridView.gridController.setContentForRow) {									if (gridView.gridController.isContentAvailableForRow(row.rowNumber)) {										gridView.gridController.setContentForRow(row.rowNumber);										row.needsDataUpdate = false;									}								}							}						}					}				}*/				// check if delay is enabled				if (gridView._private.globals.rowContentUpdateDelayInMs !== 0) {					// clear existing events					window.clearTimeout(gridView._private.globals.rowContentUpdateDelayEvent);					gridView._private.globals.rowContentUpdateDelayEvent = null;					// if event wasn't delayed, delay it and call this function again					if (!options.isDelayed) {						// call delay on update						var delayOptions = options;						delayOptions.isDelayed = true;						gridView._private.globals.rowContentUpdateDelayEvent = window.setTimeout(function(){							gridView._private.functions.updateVisibleRowData(delayOptions);						}, gridView._private.globals.rowContentUpdateDelayInMs);						return;					}				}				// get viewport top scroll position				var viewportTop;				if (WAF.PLATFORM.modulesString === "mobile") {					viewportTop = -(gridView._private.globals.viewportContainerNode.position().top);				}				else {					viewportTop = gridView._private.globals.viewportNode.scrollTop();				}				// calculate what's the first row position, as well as internal position inside .rows array				// include cache size offset				var firstVisibleRowPosition = Math.floor(viewportTop / gridView._private.globals.rowHeight);				// make sure cache offset doesn't go behind existing row numbers				firstVisibleRowPosition = (firstVisibleRowPosition >= 0) ? firstVisibleRowPosition : 0;				// calculate internal position inside .rows array				var firstVisibleRowInternalId = firstVisibleRowPosition % gridView._private.globals.rows.length;				for (var rowCount = firstVisibleRowInternalId; rowCount < gridView._private.globals.rows.length; rowCount++) {					var row = gridView._private.globals.rows[rowCount];					if (row.needsDataUpdate) {						row.dom.removeClass('waf-state-hover');						if (!!gridView.gridController) {							if (!!gridView.gridController.setContentForRow) {								gridView._private.functions.setRowContents({									contents: gridView.gridController.setContentForRow(row.rowNumber),									rowNumber: row.rowNumber,									gridView: gridView								});								row.style = gridView.gridController.setStyleForRow(row.rowNumber).rowStyle;								if (row.style != row.oldStyle) {									row.dom.addClass(row.style);									row.dom.removeClass(row.oldStyle);									row.oldStyle = row.style;								}								row.needsDataUpdate = false;							}						}					}				}				for (var rowCount = 0; rowCount < firstVisibleRowInternalId; rowCount++) {					var row = gridView._private.globals.rows[rowCount];					if (row.needsDataUpdate) {						row.dom.removeClass('waf-state-hover');						if (!!gridView.gridController) {							if (!!gridView.gridController.setContentForRow) {								gridView.gridController.setContentForRow(row.rowNumber);								gridView._private.functions.setRowContents({									contents: gridView.gridController.setContentForRow(row.rowNumber),									rowNumber: row.rowNumber,									gridView: gridView								});								row.style = gridView.gridController.setStyleForRow(row.rowNumber).rowStyle;								if (row.style != row.oldStyle) {									row.dom.addClass(row.style);									row.dom.removeClass(row.oldStyle);									row.oldStyle = row.style;								}								row.needsDataUpdate = false;							}						}					}				}			},			// sets row contents based on the array			setRowContents: function(options){				var gridView = options.gridView;				var contents = options.contents;				var rowNumber = options.rowNumber;				// if no contents are passed, skip adding contents				if (!contents)					return;				// get row by row number, to make sure that we're setting contents for visible rows				var row = gridView._private.functions.getRowByRowNumber({					gridView: gridView,					rowNumber: rowNumber				});				if (!!row) {					// cycle through cells and set contents					for (var cellCount = 0; cellCount < row.cells.length; cellCount++) {						var cell = row.cells[cellCount];						cell.insideCell.html(contents[cellCount]);						// }					}				}				else {					var gdebug = ""; // break here				}			},			// gets row by row number			getRowByRowNumber: function(options){				var gridView = options.gridView;				var rowNumber = options.rowNumber;				// find row by row number				for (var rowCount = 0; rowCount < gridView._private.globals.rows.length; rowCount++) {					var row = gridView._private.globals.rows[rowCount];					if (row.rowNumber === rowNumber) {						return row;					}				}				return null;			},			// row click event			onRowClick: function(event){				var gridView = event.data.gridView;				var gvar = gridView._private.globals;				var row = event.data.row;				var okToEdit = true;				if (WAF.PLATFORM.modulesString === "mobile") {					/*if (!gridView._private.globals.containerMoved) {					 if (row.rowNumber < gvar.totalRowCount)					 gridView._private.globals.rowClicked = true;					 } else {					 okToEdit = false;					 gvar.containerMoved = false;					 gvar.rowClicked = false;					 }*/					if (gridView._private.globals.containerMoved) {						return;					}				}				if (row.rowNumber < gvar.totalRowCount) {					if (okToEdit && gridView.currentEditingRow() != row.rowNumber) {						gridView._private.functions.endEditCell({							gridView: gridView						});						// select() will load the entity and trigger an event to gridSourceEventHandler(),						// which hightlight the clicked row. At this point, the current jQuery event is lost,						// we mmust keep it somewhere						gridView._private.selection.curEvt = event;						// Now, load the entiry						var keptEvent = event;						gridView.gridController.dataGrid.dataSource.select(row.rowNumber, {							onSuccess: function(event){								if (!!gridView.gridController.onRowClick) {									gridView.gridController.onRowClick(keptEvent);								}							}						});					}				}				return true;			},			onRowRightClick: function(event){				var row, gridView, righClickEvent, rightClickReturn;				gridView = event.data.gridView;				row = event.data.row;				rightClickReturn = true;				righClickEvent = event;				gridView.gridController.dataGrid.dataSource.select(row.rowNumber, {					onSuccess: function(event){						if (!!gridView.gridController.onRowRightClick) {							rightClickReturn = gridView.gridController.onRowRightClick(righClickEvent);						}					}				});				return rightClickReturn;			},			onMouseUp: function(event){				var gridView = event.data.gridView;				var row = event.data.row;			},			onCellDblClick: function(event){				var gridView = event.data.gridView;				if (WAF.PLATFORM.modulesString === "mobile") {					gridView._private.globals.istouch = false;				}				var row = event.data.row;				if (row.rowNumber < gridView._private.globals.totalRowCount)					gridView._private.functions.startEditCell(event.data);			},			startEditCell: function(params){				var okEdit = true;				var gridView = params.gridView;				var editInfo = gridView._private.globals.editInfo;				var isCheckBox;				if (editInfo != null) {					if (params.row != null && params.row.rowNumber == editInfo.rowNumber) {						if (params.columnNumber == editInfo.column.columnNumber) {							okEdit = false; // on ne termine pas l'edition quand on se trouve sur la meme cellule						}					}				}				if (okEdit) {					if (WAF.PLATFORM.isTouch) {						isCheckBox = params.cell.insideCell.find("input[type=checkbox]");						if (isCheckBox.length != 0) {							isCheckBox.trigger("click")						}					}					gridView._private.functions.endEditCell(params);					var source = gridView.gridController.dataGrid.dataSource;					if (source != null) {						source.select(params.row.rowNumber, {							onSuccess: function(event){								var token = event.data;								var gridView = token.gridView;								var row = token.row;								var cell = token.cell;								var col = gridView.column(token.columnNumber + 1);								if (!col.readOnly && !col.specialEdit) {									// setting row states									row.dom										.removeClass('waf-state-active')										.addClass('waf-state-selected');									var w = cell.insideCell.outerWidth();									var minw = cell.dom.outerWidth();									cell.insideCell.hide();									//cell.dom.removeClass('noUserSelect');									cell.dom.addClass('editing');									//var editArea = $('<input value="" class="inputInCell"/>');									var editArea = $('<input type="text" value="" class="content-edit"/>');									var imgArea = null;									var sourceAtt = source.getAttribute(col.sourceAttID);									if (sourceAtt != null) {										editArea[0].value = sourceAtt.getValueForInput();									}									/*									 editArea.width(cell.dom.width()-2);									 editArea.height(cell.dom.height()-2);									 */									editArea.appendTo(cell.dom);									editArea.width(w);									//editArea[0].select();									//row.dom.addClass('editingRow');									/*									 editArea.bind('keypress',									 {gridView: gridView,									 row: row,									 rowNumber: row.rowNumber,									 column: col,									 cell: params.cell,									 editArea: editArea									 }, gridView._private.functions.inputKeypressHandler);									 */									editArea.bind('keydown', {										gridView: gridView,										row: row,										rowNumber: row.rowNumber,										column: col,										cell: params.cell,										editArea: editArea									}, gridView._private.functions.inputKeypressHandler);									editArea.bind('blur', {										gridView: gridView									}, gridView._private.functions.editBlurHandler);									var dataTheme = gridView._private.globals.targetNode.data('theme');									if (col.att && col.att.type == "date") {										cell.dom.css("min-width", minw + "px");										if (false) {											editArea.datepicker({												/*												 showOn: "button",												 buttonImage: "/waLib/WAF/widget/png/date-picker-trigger.png",												 buttonImageOnly: true,												 */												changeMonth: true,												changeYear: true,												onClose: function(dateText, inst){													this.dontKillOnBlur = false;												}											}).datepicker("widget").addClass(dataTheme).css("z-index", "9999");;											editArea[0].dontKillOnBlur = true;											/*											 editArea.datepicker({ onClose:function(dateText, inst)											 {											 this.dontKillOnBlur = false;											 }});											 editArea.datepicker({ onSelect:function(dateText, inst)											 {											 this.dontKillOnBlur = false;											 }});											 */										}										else {											if (WAF.PLATFORM.isTouch) {												if (WAF.PLATFORM.OS === "iOs" && WAF.PLATFORM.OSVersion >= 5) {													editArea[0].type = "date";												}												else {													editArea.scroller();												}											}											else {												var curwidth = editArea.outerWidth();												editArea.css("margin-right", "3px");												imgArea = $('<img src="/waLib/WAF/widget/png/date-picker-trigger.png" style="float:right;margin-right:5px;margin-top:4px;" />');												imgArea.appendTo(cell.dom);												editArea.width(curwidth - 7 - imgArea.outerWidth(true));												imgArea._isDataPickerLoaded = false;												imgArea.bind('click', {													gridView: gridView												}, function(event){													if (!this._isDataPickerLoaded) {														editArea[0].dontKillOnBlur = true;														editArea[0].focus();														var offset = editArea.offset();														editArea.datepicker("dialog", sourceAtt.getValue(), function(dateText, inst){															editArea[0].value = dateText;															editArea[0].dontKillOnBlur = false;															editArea[0].focus();														}, {															changeMonth: true,															changeYear: true														});														var datepickerWidger = editArea.datepicker("widget");														datepickerWidger.addClass(dataTheme);														datepickerWidger.css("opacity", "100");														datepickerWidger.css("z-index", "9999");														offset.top += editArea.outerHeight() + 2;														datepickerWidger.offset(offset);														this._isDataPickerLoaded = true;														// fix bug on invalid input														/*														var regexp = new RegExp("#dp[0-9]+");														var tagId = regexp.exec(datepickerWidger.find('a')[0].onclick);														if (tagId) {															$(tagId[0]).css('display', 'none');														}														*/													}													else {														this._isDataPickerLoaded = false;													}												});											}										}									}									if (!waf.PLATFORM.isTouch) {										editArea[0].focus();									}									else {										if (col.att && col.att.type == "date") {											editArea[0].focus();										}									}									gridView._private.globals.editInfo = {										row: row,										rowNumber: row.rowNumber,										column: col,										cell: params.cell,										editArea: editArea,										imgArea: imgArea									};									gridView._private.globals.editHasBeenStarted = true;								}							}						}, params);					}				}				if (gridView._private.globals.editInfo && waf.PLATFORM.isTouch && gridView._private.globals.editInfo.column.att.type != "date") {					gridView._private.globals.promptedValue = prompt('Update ' + gridView._private.globals.editInfo.column.title, gridView._private.globals.editInfo.cell.value);					//if(gridView._private.globals.promptedValue != null) {					gridView._private.functions.endEditCell(params);					//}				}			},			endEditCell: function(params){				function handleErrorOnSave(event){					gridView.gridController.dataGrid.redraw();					if (errorHandler != null) {						errorHandler(event);					}				}				var gridView = params.gridView;				var saveHandler = params.saveHandler || null;				var errorHandler = params.errorHandler || gridView.gridController.errorHandler;				var errorMessage = params.errorMessage || "The Grid was unable to save the entity";				if (gridView._private.globals.editHasBeenStarted) {					var editInfo = gridView._private.globals.editInfo;					if (editInfo != null) {						if (editInfo.blurTimout != null)							window.clearTimeout(editInfo.blurTimout);						var source = gridView.gridController.dataGrid.dataSource;						if (source != null) {							if (params.row != null && params.row.rowNumber == editInfo.rowNumber) {								if (params.column != null && params.column.colID == editInfo.column.colID) {									return null; // on ne termine pas l'edition quand on se trouve sur la meme cellule								}							}							if (source.getPosition() == editInfo.rowNumber) {								var sourceAtt = source.getAttribute(editInfo.column.sourceAttID);								var newvalue;								if (sourceAtt != null) {									if (WAF.PLATFORM.isTouch && WAF.PLATFORM.OS === "iOs" && WAF.PLATFORM.OSVersion >= 5) {										if (gridView._private.globals.promptedValue != null) {											newvalue = sourceAtt.normalize(gridView._private.globals.promptedValue.replace(/-/gi, "/"));											gridView._private.globals.promptedValue = null;											params.saveAnyway = true;										}										else {											if (sourceAtt.type === "date") {												var text = editInfo.editArea[0].value.replace(/-/gi, "/");												var date = new Date(text);												newvalue = sourceAtt.normalize(date);											} else {												newvalue = sourceAtt.normalize(editInfo.editArea[0].value);											}										}									}									else {										newvalue = sourceAtt.normalize(editInfo.editArea[0].value);									}									sourceAtt.setValue(newvalue);									editInfo.cell.insideCell.html(editInfo.column.getFormattedValue(sourceAtt.getValue()));								}								if (params.row == null || params.row.rowNumber != source.getPosition() || params.saveAnyway) {									if (gridView.gridController.dataGrid.readOnly) {										if (saveHandler != null)											saveHandler();									}									else {										source.save({											onSuccess: saveHandler,											onError: handleErrorOnSave										}, {											gridView: gridView,											errorMessage: errorMessage										});									}								}							}						}						// resetting row state						//editInfo.row.dom.removeClass('editingRow');						editInfo.row.dom							.removeClass('waf-state-selected')							.addClass('waf-state-active');						editInfo.cell.dom.css("min-width", "");						editInfo.cell.dom.removeClass('editing');						editInfo.editArea.remove();						if (editInfo.imgArea != null)							editInfo.imgArea.remove();						//editInfo.cell.dom.addClass('noUserSelect');						editInfo.cell.insideCell.show();						gridView._private.globals.editInfo = null;					}					gridView._private.globals.editHasBeenStarted = false;				}				else {					if (params.saveAnyway) {						var source = gridView.gridController.dataGrid.dataSource;						if (source != null && !gridView.gridController.dataGrid.readOnly) {							source.save({								onSuccess: saveHandler,								onError: handleErrorOnSave							}, {								gridView: gridView,								errorMessage: errorMessage							});						}						else							if (saveHandler) { // Execute saveHandler to append columns resize								saveHandler();							}					}				}			},			onHeaderClick: function(event){				var gridView = event.data.gridView;				var cell = event.data.cell;				var columnNumber = event.data.columnNumber;				gridView._private.functions.endEditCell({					gridView: gridView,					saveAnyway: true,					saveHandler: function saveOnHeaderClick(subevent){						if (!!gridView.gridController.onHeaderClick && !gridView._private.globals.resizeHasBeenStarted) {							gridView.gridController.onHeaderClick(cell, columnNumber);						}					}				});			},			onCellClick: function(event){				// check if alreafy an active cell				var oldcell = event.data.gridView._private.globals.lastActiveCell;				var cell = $(event.currentTarget);				if (cell && cell != oldcell) {					if (oldcell) {						oldcell.removeClass('waf-state-active');					}					cell.addClass('waf-state-active');					event.data.gridView._private.globals.lastActiveCell = cell;				}				event.data.gridView.gridController.onCellClick(event);			},			startColResize: function(event){				var gridView = event.data.gridView;				gridView._private.functions.endEditCell({					gridView: gridView,					saveAnyway: true,					saveHandler: function saveOnColResizeClick(subevent){						$(document).bind('mouseup', event.data, gridView._private.functions.endColResize);						$(document).bind('mousemove', event.data, gridView._private.functions.duringColResize);						gridView._private.globals.startX = event.screenX;						var col = gridView.column(event.data.columnNumber + 1);						gridView._private.globals.startWidth = col.width;						gridView._private.globals.resizeHasBeenStarted = true;					}				});				event.stopPropagation();			},			endColResize: function(event){				var gridView = event.data.gridView, tag = gridView.gridController.dataGrid.tag, colWidth, w, action, oldValue;				var col = gridView.column(event.data.columnNumber + 1);				var x = event.screenX;				var newWidth = parseInt(gridView._private.globals.startWidth) + (parseInt(x) - parseInt(gridView._private.globals.startX));				if (newWidth < 10) {					newWidth = 10;				}				col.setWidth(newWidth);				$(document).unbind('mouseup', gridView._private.functions.endColResize);				$(document).unbind('mousemove', gridView._private.functions.duringColResize);				gridView._private.globals.resizeHasBeenStarted = false;				if (gridView.gridController.dataGrid.isInDesign) {					// Saving the column width					Designer.beginUserAction('052');					oldValue = tag.getColumns().toString();					if (typeof oldValue === 'undefined') {						oldValue = '[]';					}					tag.getColumns().get(event.data.columnNumber).getAttribute('width').setValue(newWidth);					tag.update();					tag.domUpdate();					action = new Designer.action.ModifyProperty({						oldVal: oldValue,						val: tag.getColumns().toString(),						tagId: tag.id,						prop: 'data-column'					});					// add to the history of the Designer					Designer.getHistory().add(action);				}			},			duringColResize: function(event){				var gridView = event.data.gridView;				var col = gridView.column(event.data.columnNumber + 1);				var oldWidth = col.width;				var x = event.screenX;				var newWidth = parseInt(gridView._private.globals.startWidth) + (parseInt(x) - parseInt(gridView._private.globals.startX));				if (newWidth < 10) {					newWidth = 10;				}				col.setWidth(newWidth);				/*				 var dif = col.width - oldWidth;				 var gridWidth = parseInt(gridView._private.globals.headerNode.parent().css('width'));				 var header = gridView._private.globals.headerContainerNode;				 var containt = gridView._private.globals.viewportContainerNode;				 header.css('width', parseInt(header.css('width')) + dif + 'px');				 containt.css('width', parseInt(containt.css('width')) + dif + 'px');				 containt.children().css('width', parseInt(containt.css('width')) + 'px');				 */			},			onResizeClick: function(event){				var gridView = event.data.gridView;				gridView._private.functions.endEditCell({					gridView: gridView,					saveAnyway: true				});				event.stopPropagation();				//				gridView._private.globals.resizeHasBeenStarted = true;			},			editBlurHandler: function(event){				if (!this.dontKillOnBlur) {					var textInput = this;					var gridView = event.data.gridView;					if (gridView._private.globals.editInfo != null) {						gridView._private.globals.editInfo.blurTimout = window.setTimeout(function(){							if (!textInput.dontKillOnBlur) {								if (gridView._private.globals.editInfo != null)									gridView._private.functions.endEditCell({										gridView: gridView/*, row: gridView._private.globals.editInfo.row*/									});							}						}, 200);					}				}			},			inputKeypressHandler: function(event){				var result = true;				var gridView = event.data.gridView;				var row = event.data.row;				var rowNumber = event.data.rowNumber;				var col = event.data.column;				var keycode = event.keyCode;				if (keycode != null) {					if (keycode == 37 || keycode == 38)						event.shiftKey = true;					else						if (keycode == 39 || keycode == 40)							event.shiftKey = false;					if (keycode >= 37 && keycode <= 40) {						if (!event.ctrlKey)							keycode = 0;					}					switch (keycode) {						case 9:						case 13:						case 37:						case 38:						case 39:						case 40:							var colnum = col.columnNumber;							var cols = gridView._private.globals.columns;							var viewportNode = gridView._private.globals.viewportNode;							var rowheight = gridView._private.globals.rowHeight;							if (event.shiftKey) {								var nextcolnum;								var changerow = false;								if (keycode == 38) {									changerow = true;									nextcolnum = colnum;								}								else {									var oknext = false;									nextcolnum = colnum - 1;									while (!oknext && nextcolnum != colnum) {										if (nextcolnum < 0) {											changerow = true;											nextcolnum = cols.length - 1;										}										if (!cols[nextcolnum].readOnly)											oknext = true;										else											nextcolnum--;									}								}								if (changerow) {									rowNumber--;									if (rowNumber < 0)										row = null;									else {										gridView._private.functions.endEditCell({											gridView: gridView										});										var rowtop = row.dom.position().top;										if (rowtop < rowheight * 2) {											var curtop;											if (WAF.PLATFORM.modulesString === "mobile") {												curtop = -(gridView._private.globals.viewportContainerNode.position().top);											}											else {												curtop = viewportNode.scrollTop();											}											curtop = curtop - rowheight;											if (curtop < 0)												curtop = 0;											viewportNode.scrollTop(curtop);										}										row = gridView._private.functions.getRowByRowNumber({											gridView: gridView,											rowNumber: rowNumber										});									}								}								else {									gridView._private.functions.endEditCell({										gridView: gridView,										row: row									});								}								if (row != null)									gridView._private.functions.startEditCell({										gridView: gridView,										row: row,										cell: row.cells[nextcolnum],										columnNumber: nextcolnum									});							}							else {								var nextcolnum;								var changerow = false;								if (keycode == 40) {									changerow = true;									nextcolnum = colnum;								}								else {									var oknext = false;									nextcolnum = colnum + 1;									while (!oknext && nextcolnum != colnum) {										if (nextcolnum >= cols.length) {											changerow = true;											nextcolnum = 0;										}										if (!cols[nextcolnum].readOnly)											oknext = true;										else											nextcolnum++;									}								}								if (changerow) {									rowNumber++;									if (rowNumber >= gridView._private.globals.totalRowCount) {										//row = null;										gridView._private.functions.endEditCell({											gridView: gridView										});										WAF.gridUtil.addRow(gridView);										row = gridView._private.functions.getRowByRowNumber({											gridView: gridView,											rowNumber: rowNumber										});									}									else {										gridView._private.functions.endEditCell({											gridView: gridView										});										var rowtop = row.dom.position().top;										var h = viewportNode.height();										if (rowtop + rowheight > h) {											var curtop;											if (WAF.PLATFORM.modulesString === "mobile") {												curtop = -(gridView._private.globals.viewportContainerNode.position().top);											}											else {												curtop = viewportNode.scrollTop();											}											curtop = curtop + rowheight;											viewportNode.scrollTop(curtop);										}										row = gridView._private.functions.getRowByRowNumber({											gridView: gridView,											rowNumber: rowNumber										});									}								}								else {									gridView._private.functions.endEditCell({										gridView: gridView,										row: row									});								}								if (row != null)									gridView._private.functions.startEditCell({										gridView: gridView,										row: row,										cell: row.cells[nextcolnum],										columnNumber: nextcolnum									});							}							result = false;							event.preventDefault();							event.stopPropagation();							break;					}				}				return result;			}		},		handlers: {}	}	/**	 * GridView.initWithOptions(options)	 * \~english	 * @brief             Initializes the grid	 * @details           Grid is initialized with options, of which most are optional.	 *	 * @param options : object	 *	 * @return this : GridView	 *	 * @code	 *	 *	 * @endcode	 */	this.initWithOptions = function(options){		//WAF.utils.debug.console.log('[GridView] WAF.classes.GridView.initWithOptions called');		// set reference to the grid object		options.gridView = this;		// initialize the grid with passed options		this._private.functions.initWithOptions(options);		return this;	}	/**	 * GridView.getPageSize()	 * \~english	 * @brief             Number of rows per page	 * @details           Returns number of rows per page for this grid size.	 *	 * @param none	 *	 * @return pageSize : integer	 *	 * @code	 *	 *	 * @endcode	 */	this.getPageSize = function(){		return this._private.globals.pageSize;	}	/**	 * GridView.getVisibleRowCount()	 * \~english	 * @brief             Number of visible rows	 * @details           Returns number of visible rows on the screen.	 *	 * @param none	 *	 * @return visibleRowCount : integer	 *	 * @code	 *	 *	 * @endcode	 */	this.getVisibleRowCount = function(){		return this._private.globals.visibleRowCount;	}	/**	 * GridView.getRowCount()	 * \~english	 * @brief             Number of total rows	 * @details           Returns number of all rows	 *	 * @param none	 *	 * @return rowCount : integer	 *	 * @code	 *	 *	 * @endcode	 */	this.getRowCount = function(){		return this._private.globals.totalRowCount;	}	/**	 * GridView.setRowCount()	 * \~english	 * @brief             Sets number of total rows	 * @details           Sets number of all rows, which updates viewport height	 *	 * @param rowCount	: integer	 *	 * @return none	 *	 * @code	 *	 *	 * @endcode	 */	this.setRowCount = function(rowCount){		this._private.functions.setTotalRowCount({			rowCount: rowCount,			gridView: this		});	}	/**	 * GridView.setRowContents(rowNumber, contents)	 * \~english	 * @brief             Sets row contents	 * @details           Sets row contents with the passed array of HTML/text objects	 *	 * @param rowNumber : integer	 * @param contents : array	 *	 * @return none	 *	 * @code	 *	 *	 * @endcode	 */	this.setRowContents = function(rowNumber, contents){		this._private.functions.setRowContents({			gridView: this,			rowNumber: rowNumber,			contents: contents		});	}	/**	 * GridView.setRowContentUpdateRequestDelayInMs(requestDelay)	 * \~english	 * @brief             Sets delay for row content requests in miliseconds	 * @details           To optimize performance when user is scrolling rapidly, requestDelay will be	 *						applied before row data is requested. Setting requestDelay to 0 will disable	 *						delay and requests will be called immediately	 *	 * @param requestDelay : integer	 *	 * @return none	 *	 * @code	 *	 *	 * @endcode	 */	this.setRowContentUpdateRequestDelayInMs = function(requestDelay){	}	/**	 * GridView.refresh()	 * \~english	 * @brief             Refreshes grid data	 * @details           Requests again data for the grid, updates row number	 *	 * @param none	 *	 * @return none	 *	 * @code	 *	 *	 * @endcode	 */	this.refresh = function(){		this._private.functions.refresh({			gridView: this		});	}	// ========================= <handling_selection>	this.getSelectionMode = function(){		return this.getSelection().getMode();	}	this.setSelectionMode = function(inSelMode){		if (arguments.length > 0) {			//var gvSel = this._private.selection;			var dataSource = this.gridController.dataGrid.dataSource;			var sel = dataSource.getSelection();			if (sel.getMode() !== inSelMode)			switch (inSelMode) {				case 'none':					sel.reset('none');					break;				case 'single':					var gvFunctions = this._private.functions;					var curpos = dataSource.getPosition();					gvFunctions.hideCurrentRows({gridView:this});					sel.reset('single');					if (curpos != -1)						dataSource.select(curpos);					gvFunctions.showCurrentRows({gridView:this});					break;				case 'multiple':					var curpos = dataSource.getPosition();					sel.reset('multiple');					if (curpos != -1)						sel.select(curpos);					break;			}		}	}	this.resetSelection = function(){		var sel = this.getSelection();		if (sel != null)			sel.reset(sel.getMode());	}	this.countSelected = function(){		var sel = this.getSelection();		if (sel != null)			return this.getSelection().countSelected();		else			return 0;	}	// Returns an array or rows numbers	this.getSelectedRows = function(){		var sel = this.getSelection();		if (sel != null)			return sel.getSelectedRows();		else			return null;	}	this.setSelectedRows = function(rowNumbers){		var sel = this.getSelection();		if (sel != null) {			var gvFunctions = this._private.functions;			var dataSource = this.gridController.dataGrid.dataSource;			var currow = -1;			if (rowNumbers != null && rowNumbers.length > 0)				currow = rowNumbers[0];			if (dataSource != null && currow != -1 && dataSource.getPosition() != currow) {				var currow = rowNumbers[0];				dataSource.select(currow, { userData: {					mustSelectRows: rowNumbers				}});			}			else {				gvFunctions.hideCurrentRows({					gridView: this				});				sel.setSelectedRows(rowNumbers);				gvFunctions.showCurrentRows({					gridView: this				});			}		}	}	this.getSelection = function(){		var result = null;		/*		 if (this.getSelectionMode() == 'none')		 result = null;		 else		 */		result = this.gridController.dataGrid.dataSource.getSelection();		return result;	}	this.forgetSelection = function(){		var sel = this.getSelection();		if (sel != null) {			sel.reset(gvSel.sel.getMode());			if (sel.isModeMultiple()) {				this._private.functions.hideCurrentRows({					gridView: this				});			}		}	}	// ========================= </handling_selection>	/**	 *	 * @param {Object} html	 */	this.setStatusRight = function(html){		this._private.globals.statusRightContainer.html(html);	}	this.resetSortIndicator = function(columnNb){		var containerNode = this._private.globals.headerContainerNode;		// removing focus		containerNode.cells[columnNb].dom.removeClass('waf-state-focus');		for (var i = 0, max = this._private.globals.columns.length; i < max; ++i) {			containerNode.cells[i].sortIndicator.removeClass("waf-sort-asc waf-sort-desc");		}	}	this.setSortIndicator = function(columnNb, sortOrder){		//this._private.globals.headerContainerNode.cells[columnNb].sortIndicator.removeClass("waf-sort-asc waf-sort-desc").addClass('waf-sort-' + sortOrder);		this.resetSortIndicator(columnNb);		if (columnNb !== null && columnNb >= 0 && columnNb < this._private.globals.columns.length) {			var theCol = this._private.globals.headerContainerNode.cells[columnNb].sortIndicator.removeClass("waf-sort-asc waf-sort-desc");			this._private.globals.headerContainerNode.cells[columnNb].dom.addClass('waf-state-focus');			sortOrder = sortOrder || 'asc';			if (sortOrder !== 'asc' && sortOrder !== 'desc') {				sortOrder = 'asc';			}			theCol.addClass('waf-sort-' + sortOrder);		}	}	// constructor	this.gridController = null;	this.kill = function(){		$(this._private.globals.targetNode).html("");	}	this.column = function(colRef, colSettings){		var result = null;		if (typeof colRef == "string") {			result = this._private.globals.colsByID[colRef];		}		else {			if (colRef > 0 && colRef <= this._private.globals.columns.length) {				result = this._private.globals.columns[colRef - 1];			}		}		if (result != null && colSettings != null && typeof colSettings == "object") {			for (prop in colSettings) {				switch (prop) {					case "textSize":						result.setTextSize(colSettings[prop]);						break;					case "color":						result.setTextColor(colSettings[prop]);						break;					case "backgroundColor":						result.setBackgroundColor(colSettings[prop]);						break;					case "width":						result.setWidth(colSettings[prop]);						break;					case "format":						result.setFormat(colSettings[prop]);						break;					case "renderer":						result.setRenderer(colSettings[prop]);						break;					case "align":						result.setAlignment(colSettings[prop]);						break;				}			}		}		return result;	}	this.columns = function(colSettings){		return this._private.globals.columns;	}	this.currentEditingRow = function(){		var result = -1;		if (this._private.globals.editHasBeenStarted) {			var editInfo = this._private.globals.editInfo;			if (editInfo != null) {				result = editInfo.rowNumber;			}		}		return result;	}	this.drawRow = function(rowNumber, elem, oldValues){		var row = this._private.functions.getRowByRowNumber({			gridView: this,			rowNumber: rowNumber		});		var columns = this._private.globals.columns;		if (row != null) {			for (var i = 0; i < columns.length; ++i) {				var cell = row.cells[i];				var col = columns[i];				var value = null;				if (elem != null) {					if (oldValues)						value = elem.getOldAttributeValue(col.sourceAttID);					else						value = elem.getAttributeValue(col.sourceAttID);				}				this.drawCell(row, cell, col, value);			}			var drawhandler = this.gridController.onRowDraw;			if (drawhandler != null) {				var drawEvent = {					row: row,					dataSource: this.gridController.dataGrid.dataSource,					element: elem				}				drawhandler(drawEvent);			}		}	}	this.drawCell = function(row, cell, col, value){		var needTip = false;		var imgSrc;		var content = null;		cell.value = value;		row.gridView = this;		if (col.renderer != null) {			content = col.renderer({				value: value,				rowNumber: row.rowNumber,				dataSource: this.gridController.dataGrid.dataSource,				cellDiv: cell.insideCell			});		}		if (content == null) {			if (col.att == null) {                            if (typeof Designer === 'undefined') {				content = '##wrong reference##';                            } else {                                content = '';                            }                        } else {				if (col.att.type === "image") {					if (value != null && value.__deferred != null && value.__deferred.uri != null) {						var h = cell.dom.height() - 5;						var w = cell.dom.width();						if (h > w)							h = w;						else							w = h;						imgSrc = value.__deferred.uri;						content = '<img class="inside-img" src="' + imgSrc + '" style="max-height:' + h + 'px;max-width:' + w + 'px;" />';						needTip = true;					}					else						content = " ";				}				else					if (col.att.type === "bool") {						var parts = [""];						var format = col.format;						if (format != null)							format = format.format;						if (format != null) {							parts = format.split(";");						}						if (parts.length > 1) {							var rname = "r"+Math.random();							var html = '<input type="radio" class="waf-dataGrid-radio-true" value="true" name="'+rname+'"';							if (value)								html += ' checked="checked"';							if (col.readOnly)								html += ' disabled="true"';							html += '/>';							html += '<span class="waf-dataGrid-radio-label">';							html += parts[0];							html += '</span>';							html += '<input type="radio" class="waf-dataGrid-radio-false" value="false" name="'+rname+'"';							if (value === false)								html += ' checked="checked"';							if (col.readOnly)								html += ' disabled="true"';							html += '/>';							html += '<span class="waf-dataGrid-radio-label">';							html += parts[1];							html += '</span>';							content = html;						}						else {							var html = '<input type="checkbox" class="waf-dataGrid-checkbox"';							if (value)								html += ' checked="checked"';							if (col.readOnly)								html += ' disabled="true"';							html += '/>';							if (parts[0].length > 0){								html += '<span class="waf-dataGrid-checkbox-label">';								html += parts[0];								html += '</span>';							}							content = html;						}					}					else						content = col.getFormattedValue(value);			}		}		if (content === "")			content = "&nbsp";		cell.insideCell.html(content);		cell.insideCell[0].gridCell = cell;		cell.col = col;		cell.insideCell[0].gridRow = row;		cell.dom.height(row.gridView._private.globals.rowHeight);		cell.insideCell.height(row.gridView._private.globals.rowHeight);		if (needTip) {			//$('img', cell.insideCell).bt('<img src="' + imgSrc + '/>', { trigger: ['mouseover', 'click']});			cell.dom.bt('<img src="' + imgSrc + '" width="200" height="200" />', {				width: 200,                                fill: 'white',                                strokeStyle: 'gray',				height: 200,				trigger: ['hover', 'click'],				offsetParent: $('body')			});		}	}	this.updateCell = function(rowNumber, attName, value){		var col = this.column(attName);		if (col != null) {			var colnum = col.columnNumber;			var row = this._private.functions.getRowByRowNumber({				gridView: this,				rowNumber: rowNumber			});			if (row != null) {				var cell = row.cells[colnum];				if (cell != null) {					this.drawCell(row, cell, col, value);					/*					 var content = "";					 if (col.renderer != null) {					 content = col.renderer({					 value     : value,					 rowNumber : rowNumber,					 dataSource: this.gridController.dataGrid.dataSource,					 cellDiv   : cell.insideCell					 });					 } else {					 content = col.getFormattedValue(value);					 }					 cell.insideCell.html(content);					 */				}			}		}	}	this.setCurrentRow = function(inRowNumber, doNotAlterSelection){		var gvSel = this._private.selection, sel = this.getSelection(), gvGlobals = this._private.globals, gvFunctions = this._private.functions;		var prevRow, curRow, shiftKey, metaKey, max, oneRow, first, last, theEvt, temp, classActive = gvSel.cssClass;		if (sel.isModeSingle()) {			if (!doNotAlterSelection) {				gvFunctions.hideCurrentRows({					gridView: this				});				gvGlobals.currentRow = inRowNumber;				sel.select(inRowNumber);				gvFunctions.showCurrentRows({					gridView: this				});			}			/*			 if (gvGlobals.options.autoScrollOnSelected)			 {			 this.centerRow(inRowNumber, { doNotScrollIfVisible : true});			 }			 */		}		else			if (sel.isModeMultiple()) {				if (!doNotAlterSelection) {					theEvt = gvSel.curEvt;					shiftKey = theEvt && 'shiftKey' in theEvt && theEvt.shiftKey;					metaKey = theEvt && (('metaKey' in theEvt && theEvt.metaKey) || ('ctrlKey' in theEvt && theEvt.ctrlKey));					if (shiftKey) {						prevRow = gvFunctions.getRowByRowNumber({							gridView: this,							rowNumber: gvGlobals.currentRow						});						if (prevRow == null) {							if (gvGlobals.currentRow < 0) {								first = inRowNumber;							}							else {								first = gvGlobals.currentRow;							}							last = inRowNumber;							if (first > last) {								temp = last;								last = first;								first = temp;							}						}						else							if (prevRow.rowNumber > inRowNumber) {								first = inRowNumber;								last = prevRow.rowNumber;							}							else {								first = prevRow.rowNumber;								last = inRowNumber;							}						for (var i = first; i <= last; ++i) {							var curRow = gvFunctions.getRowByRowNumber({								gridView: this,								rowNumber: i							});							if (curRow != null) {								curRow.dom.addClass(classActive);							}						}						gvGlobals.currentRow = inRowNumber;						sel.selectRange(first, last, true);					}					else						if (metaKey) {							gvGlobals.currentRow = inRowNumber;							sel.toggle(inRowNumber);							curRow = gvFunctions.getRowByRowNumber({								gridView: this,								rowNumber: inRowNumber							});							if (curRow != null) {								curRow.dom.toggleClass(classActive);							}						}						else {							// Remove previous highlight effect							$('#' + this.gridController.dataGrid.subscriberID + ' .waf-widget-body .container').children().removeClass(classActive);							// Highlight the row							curRow = gvFunctions.getRowByRowNumber({								gridView: this,								rowNumber: inRowNumber							});							if (curRow != null) {								curRow.dom.addClass(classActive);							}							gvGlobals.currentRow = inRowNumber;							sel.select(inRowNumber);						}				}				gvSel.curEvt = null;			}			else {				gvGlobals.currentRow = inRowNumber;			}		if (gvGlobals.options.autoScrollOnSelected) {			this.centerRow(inRowNumber, {				doNotScrollIfVisible: true			});		}	}	this.centerRow = function(rowNumber, options){		options = options || {};		if (typeof rowNumber != 'number')			rowNumber = 0;		var gridView = this;		var gridvars = this._private.globals;		var gridfuncs = this._private.functions;		var actualTop;		var totalRows = gridvars.totalRowCount;		var nbRowsInPage = Math.round(gridvars.viewportNode.height() / gridvars.rowHeight);		if (rowNumber < 0)			rowNumber = 0;		if (rowNumber >= totalRows)			rowNumber = totalRows - 1;		var mustScroll = true;		if (options.doNotScrollIfVisible) {			var nbFullRowsInPage = Math.floor(gridvars.viewportNode.height() / gridvars.rowHeight);			if (WAF.PLATFORM.modulesString === "mobile") {				var curtop = -(gridView._private.globals.viewportContainerNode.position().top);				actualTop = curtop / gridvars.rowHeight;			}			else {				actualTop = gridvars.viewportNode.scrollTop() / gridvars.rowHeight;			}			if (rowNumber >= actualTop && rowNumber < Math.floor(actualTop) + nbFullRowsInPage) {				mustScroll = false;			}		}		if (mustScroll) {			var toprow = rowNumber - Math.floor(nbRowsInPage / 2);			if (toprow < 0)				toprow = 0;			if (WAF.PLATFORM.modulesString === "mobile") {				//use scrollTo, method of iScroll lib				gridView._private.scrollObject.scrollTo(0, -(toprow * gridvars.rowHeight));			}			else {				gridvars.viewportNode.scrollTop(toprow * gridvars.rowHeight);			}		}	}	this.setOptions = function(options){		if (options != null) {			if (options.autoScrollOnSelected != null) {				var gridvars = this._private.globals;				gridvars.options.autoScrollOnSelected = options.autoScrollOnSelected;			}		}	}	this.fixWebKitBug = function(){		var gvar = this._private.globals;		if (!gvar.alreadFlaggedTimoutRowHeight) {			gvar.alreadFlaggedTimoutRowHeight = true;			setTimeout(function(e){				$(".waf-dataGrid-cell", gvar.viewportContainerNode).height(gvar.rowHeight - 1);				setTimeout(function(e){					gvar.alreadFlaggedTimoutRowHeight = false;					$(".waf-dataGrid-cell", gvar.viewportContainerNode).height(gvar.rowHeight);				}, 1);			}, 1);		}	};	this.setRowHeight = function(rowHeight){		rowHeight = rowHeight || 0;		if (rowHeight < 1)			rowHeight = 1;		var gridView = this;		var gridvars = this._private.globals;		var gridfuncs = this._private.functions;		$(".inside-img", gridvars.viewportContainerNode).css({			"max-height": "1px",			"max-width": "1px"		});		var rows = gridvars.rows;		/*		if (rows.length > 0) {			rows[0].dom.height(rowHeight);			rows[0].insideDom.height(rowHeight);			rowHeight = rows[0].dom.outerHeight();			var insideHeight = rows[0].insideDom.height();			if (rowHeight < insideHeight)				rowHeight = insideHeight;		}		*/		rows.forEach(function(row){			row.dom.height(rowHeight);			row.insideDom.height(rowHeight);		});		/*		$(".inside-img", gridvars.viewportContainerNode).css({			"max-height": "",			"max-width": ""		});		*/		gridvars.rowHeight = rowHeight;		$(".waf-dataGrid-cell", gridvars.viewportContainerNode).height(rowHeight);		var numberOfRows = gridView.gridController.getRowCount(gridView);		var height = rowHeight * numberOfRows;		if ((height > 17895697) & (WAF.utils.environment.browser.firefox3)) {			gridView._private.globals.viewportContainerNode.height(17895697);		}		else {			gridView._private.globals.viewportContainerNode.height(height);		}	}	this.goToCell = function(rowPos, colID, handler){		this.gridController.gridView.goToCell(rowPos, colID);	}	this.stopEditing = function(handler){		this.gridController.gridView.goToCell(rowPos, colID);	}	/**	 *	 * Sets the width for each row, ignoring scrollbar width if noScrollBar is set to true	 *	 *	 */	this.computeRowWidth = function(noScrollBar){		var gridView = this,			gvar = this._private.globals,			width = 0,			maxw = 0,			prevWidth = 0;		for (var columnCount = 0, size = gvar.columns.length; columnCount < size; columnCount++) {			width += parseInt(gvar.columns[columnCount].width);		}		if (width < gvar.viewportNode.width()) {			if (noScrollBar) {				width = gvar.viewportNode.width();			} else {				width = gvar.viewportNode.width() - gvar.vScrollBarWidth - 1;			}		}		$(".waf-dataGrid-row", gvar.targetNode).width(width);		$(".waf-dataGrid-header > .container", gvar.targetNode).width(width).height(32);		var last = $(".waf-dataGrid-cell", gvar.headerContainerNode).filter(":last");		var antelast = last.prev();		var insideWidth = gvar.headerContainerNode.width();		if (antelast.position()) {			prevWidth = antelast.position().left + antelast.outerWidth();        }		var w = insideWidth - prevWidth;		if (gvar.columns.length > 0) {			maxw = gvar.columns[gvar.columns.length-1].width;        }		if (w > maxw)			w = maxw;		if (w > 1)			last.width(w);	}	return this;};WAF.classes.GridColumn = {	setTextSize: function(textSize){		this.textSize = textSize;		//$(".cellCol"+this.columnNumber, this.gridview._private.globals.targetNode).css("font-size", ""+textSize+"px");		$(".waf-dataGrid-col-" + this.colID, this.gridview._private.globals.targetNode).css("font-size", "" + textSize + "px");	},	setTextColor: function(color){		this.color = color;		//$(".cellCol"+this.columnNumber, this.gridview._private.globals.targetNode).css("color", color);		$(".waf-dataGrid-col-" + this.colID, this.gridview._private.globals.targetNode).css("color", color);	},	/*	 * DEPRECATED	 */	setColor: function(color){		this.setTextColor(color);	},	setBackgroundColor: function(backColor){		this.backColor = backColor;		$(".waf-dataGrid-col-" + this.colID, this.gridview._private.globals.targetNode).css("background-color", backColor);	},	setWidth: function(colWidth){		this.width = colWidth;		var gvar = this.gridview._private.globals;		/*		 var width = 0;		 for (var columnCount = 0; columnCount < gvar.columns.length; columnCount++)		 {		 width += parseInt(gvar.columns[columnCount].width);		 }		 if (width < gvar.viewportNode.width())		 {		 width = gvar.viewportNode.width()-gvar.vScrollBarWidth-1;		 }		 $(".waf-dataGrid-row", gvar.targetNode).width(width);		 */		this.gridview.computeRowWidth();		$(".waf-dataGrid-col-" + this.colID, gvar.targetNode).width(colWidth);		$(".waf-dataGrid-col-" + this.colID + " > .content", gvar.targetNode).width(colWidth);		var header = $(".waf-dataGrid-col-" + this.colID, gvar.targetNode).first();		var outW = header.outerWidth();		var w = header.width();		if (outW > w)			header.width(outW + (outW - w));		if (this.columnNumber === (gvar.columns.length-1))			this.gridview.computeRowWidth();		this.gridview.gridController.dataGrid.redraw();	},	setFormat: function(format){		if (typeof(format) == "string")			format = {				format: format			};		this.format = format;		this.gridview.gridController.dataGrid.redraw();	},	setRenderer: function(renderer){		this.renderer = renderer;		this.gridview.gridController.dataGrid.redraw();	},	setAlignment: function(align){		this.align = align;		$(".waf-dataGrid-col-" + this.colID, this.gridview._private.globals.targetNode).css("text-align", align);	}};WAF.gridUtil.addRow = function(gridView){	var source = gridView.gridController.dataGrid.dataSource;	if (source != null) {		function readyToAddRow(gridView){			if (gridView._private.globals.currentlyUpdatingRowPositions) {				window.setTimeout(function(){					readyToAddRow(gridView)				}, 100);			}			else {				window.setTimeout(function(){ // quick fix, needs to be redone					var row = gridView._private.functions.getRowByRowNumber({						gridView: gridView,						rowNumber: gridView._private.globals.totalRowCount - 1					});					gridView._private.functions.startEditCell({						gridView: gridView,						columnNumber: 0,						row: row,						cell: row.cells[0]					});				}, 200);			}		}		source.addNewElement({			gridView: gridView,			execOnEventDispatch: readyToAddRow		});	}}WAF.gridUtil.delRow = function(gridView){	var source = gridView.gridController.dataGrid.dataSource;	if (source != null) {		var errorHandler = gridView.gridController.errorHandler;		var errorMessage = "The data grid could not delete the entity";		source.removeCurrent({			onError: errorHandler		}, {			gridView: gridView,			errorMessage: errorMessage		});	}}/** * ---------------------------------------------------------------------------- * content of widget-dataGrid-controller.js * ---------------------------------------------------------------------------- *//** * @brief			GridController, part of WAF/UI/Grid * @details			Collection of functions that are called by GridView. Use this code to link a view (in this case GridView) to your data model in order to achieve Model-View-Controller (MVC)) architecture. * * * * @author			rudolfpsenicnik * @date			February 2009 * @version			1.0 * * @include			copyright.txt */WAF.classes.GridController = function(){	// Private	this._private = {		globals: {},		functions: {},		handlers: {}	};	/**	 * GridController.getColumnCount(grid)	 * \~english	 * @brief             Sets grid column count	 * @details           Return column count for the grid, usually called when grid is initialized	 *	 * @param grid : GridView	 *	 * @return columnCount : integer	 *	 * @code	 *	 *	 * @endcode	 */	this.getColumnCount = function(grid){		var columnCount = 0;		return columnCount;	}	/**	 * GridController.getRowCount(grid)	 * \~english	 * @brief             Sets grid row count	 * @details           Return number of rows, usually called when grid is initialized	 This will update viewport height, and only rows that are visible will be rendered	 *	 * @param grid : GridView	 *	 * @return rowCount : integer	 *	 * @code	 *	 *	 * @endcode	 */	this.getRowCount = function(grid){		var rowCount = 0;		return rowCount;	}	/**	 * GridController.setContentForRow(grid)	 * \~english	 * @brief             Sets row contents	 * @details           Row contents are set based on the passed array of HTML/text elements	 Returning array with length 0 will NOT erase existing contents, to do that, pass empty array.	 *	 * @param rowNumber : integer	 *	 * @return contents : array	 *	 * @code	 *	 *	 * @endcode	 */	this.setContentForRow = function(rowNumber){		var contents = [];		return contents;	}	this.isContentAvailableForRow = function(rowNumber){		return true;	}	this.setStyleForRow = function(rowNumber){		return {			rowStyle: ''		};	}	this.setPropertiesForColumn = function(columnProperties){		return {};	}	this.onRowClick = function(event){		//WAF.utils.debug.console.log("Clicked on row " + event.data.row.rowNumber);	}	this.onRowDblClick = null;	this.baseDblClick = function(event) {		var gridView = event.data.gridView;		var dblclickHandler = gridView.gridController.onRowDblClick;		if (dblclickHandler != null) {			var row = event.data.row;			if (row.rowNumber < gridView._private.globals.totalRowCount) {				gridView.gridController.onRowDblClick(event);			}		}	}	this.onRowRightClick = function(event){	}	this.onCellClick = function(event){	}	this.onHeaderClick = function(cell, columnNumber){	}	this.onRowDraw = null; // onRowDraw(event)    event: { row: GridRow, dataSource: DataSource, rowValue: entireElement }	this.onError = null; // onError(event)  usual DataProvider error event	// constructor	this.gridView = new WAF.classes.GridView();	this.gridView.gridController = this;};/** * ---------------------------------------------------------------------------- * original content of widget-dataGrid.js * ---------------------------------------------------------------------------- */WAF.Widget.provide('Grid', {	onResize: function(){	}}, function WAFWidget(config, data, shared){	var colWidth = config['data-column-width'] ? config['data-column-width'].split(',') : [], colNames = config['data-column-name'] ? config['data-column-name'].split(',') : [],	tagClass = config['class'],	sum = 0, colName = '', tagWidth = 0, diffWidth = 0, displayScroll = true, grid = null, configColumn = {}, length = 0, i = 0,	attributeName = '', column = [],	selectionMode = config['data-selection-mode'] ? config['data-selection-mode'] : 'single',	errorDiv = config['data-errorDiv'], hideFooter = false, hideHeader = false,	textFooter = config['data-footer-text'] ? config['data-footer-text'] : 'item(s)',	mustDisplayError = config['data-display-error'], theID = config['id'];	if (mustDisplayError == null) {		mustDisplayError = true;	}	else {		mustDisplayError = (mustDisplayError == '1' || mustDisplayError == 'true');	}	tagWidth = parseInt(document.getElementById(theID).style.width) - 1;	if (config['data-footer-hide'] === 'true') {		hideFooter = true;	}	if (config['data-header-hide'] === 'true') {		hideHeader = true;	}	// check for retro compatibility	if (config['data-column'] && config['data-column'] != '[]') {		configColumn = JSON.parse(config['data-column'].replace(/'/g, "\""));		// unescape value		length = configColumn.length;		for (i = 0; i < length; i++) {			column = configColumn[i];			for (attributeName in column) {				column[attributeName] = unescape(column[attributeName]);			}		}		grid = new WAF.classes.DataGrid({			inDesign: false,			id: theID,			render: theID,			dataSource: config['data-binding'],			binding: config['data-binding'],			columns: configColumn,			colWidth: colWidth,			cls: tagClass,			selMode: selectionMode,			mustDisplayError: mustDisplayError,			errorDiv: errorDiv,			hideFooter: hideFooter,			hideHeader: hideHeader,			textFooter: textFooter		});	}	else {		// old code for compatibility with very early versions		// if only one column the width is the same that the widget width		if (colNames.length === 1) {			colWidth = [tagWidth];			displayScroll = false;			// else auto resize the lastest column		}		else {			sum = 0			for (colName in colNames) {				sum += parseInt(colWidth[colName]);			}			if (sum < tagWidth) {				diffWidth = tagWidth - sum;				colWidth[colNames.length - 1] = String((parseInt(colWidth[colNames.length - 1]) + diffWidth));				displayScroll = false;			}		}		// reformat config		var tabName = [];		var tabAttribute = [];		var tabWidth = [];		if (config['data-column-name']) {			tabName = config['data-column-name'].split(',');		}		if (config['data-column-attribute']) {			tabAttribute = config['data-column-attribute'].split(',');		}		if (config['data-column-width']) {			tabWidth = config['data-column-width'].split(',');		}		length = tabAttribute.length;		column = null;		var att = '';		var label = '';		var width = '';		configColumn = [];		for (i = 0; i < length; i++) {			column = {};			att = tabAttribute[i];			try {				label = tabName[i];			}			catch (e) {				label = att;			}			try {				width = tabWidth[i];			}			catch (e) {				width = '150';			}			column['sourceAttID'] = att;			column['title'] = label;			column['width'] = width;			configColumn.push(column);		}		grid = new WAF.classes.DataGrid({			inDesign: false,			id: theID,			render: theID,			dataSource: config['data-binding'],			binding: config['data-binding'],			columns: configColumn,			colWidth: colWidth,			cls: tagClass,			selMode: selectionMode,			mustDisplayError: mustDisplayError,			errorDiv: errorDiv,			hideFooter: hideFooter,			textFooter: textFooter		});	}	// Hide vertical scrollbar if necessary	if (!displayScroll) {		$('#' + theID + ' .waf-dataGrid-body').css('overflow-x', 'hidden');	}	// Drag	$.ui['draggable'].prototype.plugins.start[4][1] = function(event, ui){		var ind = $(this).data("draggable");		if (ind.scrollParent && ind.scrollParent[0] != document && ind.scrollParent[0].tagName != 'HTML') {			ind.overflowOffset = ind.scrollParent.offset();		}	}	if (config['data-draggable'] === "true") {		$('#' + theID + ' .waf-widget-header').css('cursor', 'pointer');		$('#' + theID + ' .waf-widget-footer').css('cursor', 'pointer');		$('#' + theID).draggable("option", "cancel", '.waf-widget-body');		$('#' + theID).draggable("option", "stack", '.waf-widget');	}	// hide toolber	if (config['data-footer-hide'] === 'true') {		$('#' + theID + ' .waf-widget-footer').hide();	}	// readOnly	if (config['data-readOnly'] === "true") {		// Hide toolbar		$("#" + theID + " .waf-dataGrid-footer .waf-toolbar").hide();		// Lock columns		grid.columns().forEach(function(theCol, idx, arr){			theCol.readOnly = true;		});	}	var propName = '';	for (propName in grid) {		this[propName] = grid[propName];	}}, {	getValueForInput: function datagrid_get_value_for_input(){		var value;		if (this.sourceAtt == null) {			value = this.source.getAttribute(this.att.name).getValueForInput();		}		else {			value = this.sourceAtt.getValueForInput();		}		return value;	},	/**	 * Resize method called during resize	 * @method onResize	 */	onResize: function datagrid_resize(){		$('#' + this.id + ' .waf-widget-body').css('width', parseInt($('#' + this.id).css('width')));		var newHeight = parseInt($('#' + this.id).css('height')) - parseInt($('#' + this.id + ' .waf-widget-footer').css('height'));		newHeight -= parseInt($('#' + this.id + ' .waf-widget-header').css('height'));		$('#' + this.id + ' .waf-widget-body').css('height', newHeight + 'px');	},	/**	 * Resize method called on stop resize	 * @method onResize	 */	stopResize: function datagrid_stop_resize(){		this.gridController.gridView.refresh();	},	/**	 * Disable the dataGrid	 * @method disable	 */	disable: function datagrid_disable(){		this.setReadOnly(true);		/*		 * Call super class disable function		 */        WAF.Widget.prototype.disable.call(this);	},	/**	 * Enable the dataGrid	 * @method enable	 * @param {boolean} disable	 */	enable: function datagrid_enable(){		this.setReadOnly(false);		/*		 * Call super class enable function		 */        WAF.Widget.prototype.enable.call(this);	}});// initialize handlers once, when loading the framework$('body').delegate('.waf-dataGrid-checkbox', 'change', WAF.classes.DataGrid.checkBoxHandler);$('body').delegate('.waf-dataGrid-radio-true', 'change', WAF.classes.DataGrid.radioTrueHandler);$('body').delegate('.waf-dataGrid-radio-false', 'change', WAF.classes.DataGrid.radioFalseHandler);/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/dataGrid/widget-dataGrid-conf.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. */WAF.addWidget({	type: 'dataGrid',	lib: 'WAF',	category: 'Automatic Controls',	description: 'Grid',	img: '/walib/WAF/widget/dataGrid/icons/widget-dataGrid.png',	attributes: [{		name: 'data-binding',		description: 'Source'	}, {		name: 'data-columns',		description: 'Columns',		type: 'textarea'	}, {		name: 'class',		description: 'Css class'	}, {		name: 'data-label',		description: 'Label',		defaultValue: ''	}, {		name: 'data-label-position',		description: 'Label position',		defaultValue: 'top'	}, {		name 		: 'data-draggable',		description : 'Draggable',		type 		: 'checkbox',		platform	: 'desktop'	}, {		name 		: 'data-resizable',		description : 'Resizable',		type 		: 'checkbox',		platform	: 'desktop'	}, {		name: 'data-readOnly',		description: 'Read only',		type: 'checkbox'	}, {		name: 'data-header-hide',		description: 'Hide header',		type: 'checkbox'	}, {		name: 'data-footer-hide',		description: 'Hide footer',		type: 'checkbox'	}, {		name: 'data-selection-mode',		description: 'Selection mode',		defaultValue: 'single',		type: 'dropdown',		options: [{			key: 'single',			value: 'Single'		}, {			key: 'multiple',			value: 'Multiple'		}]	}, {		name: 'data-display-error',		description: 'Display error',		type: 'checkbox',		category: 'Error Handling',		defaultValue: 'true'	}, {		name: 'data-errorDiv',		description: 'Placeholder for error description',		category: 'Error Handling'	}, {		name: 'data-error-div',		visibility: 'hidden'	}, {		name: 'data-footer-text',		description: 'Footer count text',		defaultValue: 'item(s)'	}, {		name: 'data-column',		description: 'Columns',		type: 'grid',		defaultValue: '[]',		reloadOnChange: true,		newRowEmpty: false,		columns: [{			title: 'label',			name: 'title',			type: 'textfield'		}, {			title: 'attribute',			name: 'sourceAttID',			type: 'textfield',			typeValue: 'dataSource',			onblur: function(){				var tag, valid, htmlObject, attributeName;				tag = this.data.tag;				htmlObject = this.getHtmlObject();				/*				 * Check if attribute is valid				 */				attributeName = this.getValue();				valid = Designer.ds.isPathValid(tag.getSource() + '.' + attributeName);				if (!valid) {					htmlObject.addClass('studio-form-invalid');				}				else {					htmlObject.removeClass('studio-form-invalid');				}			},			onfocus: function(){				this.data.attID = this.getValue();			}		}],		toolbox: [{			name: 'format',			type: 'textField'		}, {			name: 'width',			type: 'textField'		}, {			title: 'read only',			name: 'readOnly',			type: 'checkbox'		}],		ready: function(){			var tag;			tag = this.data.tag;			/*			 * Hide form if no source binded			 */			if (!tag.getSource()) {				this.getForm().hide();			}		},		afterRowAdd: function(data){			/*			 * Add row with first datasource attribute			 */			var tag, dsObject, attributes, firstAttribute;			tag = this.data.tag;			dsObject = Designer.env.ds.catalog.getByName(tag.getSource());			if (dsObject && dsObject.getType().match(new RegExp('(array)|(object)'))) {				attributes = dsObject.getTag().getAttribute('data-attributes').getValue().split(',');				firstAttribute = attributes[0].split(':')[0];			}			else if (dsObject) {				attributes = dsObject.getAttributes();				if (attributes[0]) {					firstAttribute = attributes[0].name;				}			}			if (data.items[0].getValue() == '' && data.items[1].getValue() == '') {				data.items[0].setValue(firstAttribute);				data.items[1].setValue(firstAttribute);			}		},		onsave: function(data){			var tag, columns, value, check;			try {				tag = data.tag;				columns = tag.getColumns();				/*				 * Clear columns				 */				columns.clear();				/*				 * Get new rows				 */				$.each(data.value.rows, function(){					var colID, oldID, name, value, column, bodySelector, newBodySelector, headerSelector, newHeaderSelector;					column = new WAF.tags.descriptor.Column();					$.each(this, function(i){						name = this.component.name;						value = this.value;						if (name == 'sourceAttID') {							colID = value;							oldID = this.component.data.attID;							column.getAttribute('colID').setValue(value.replace(/\./g, '_'));							/*							 * Keep column css style even if attribute is changed							 */							if (oldID && colID != oldID) {								headerSelector = '#' + tag.getId() + ' .waf-widget-header .waf-dataGrid-col-' + oldID.replace(/\./g, '_');								newHeaderSelector = '#' + tag.getId() + ' .waf-widget-header .waf-dataGrid-col-' + colID.replace(/\./g, '_');								$(D.tag.style.getRules(new RegExp('^' + headerSelector + '\\b'))).each(function(i, rule){									D.tag.style.interfaceSheet.addRule(newHeaderSelector, rule.style.cssText);								});								/*								 * Delete old ones								 */								D.tag.style.deleteRules(new RegExp('^' + headerSelector + '\\b'));								bodySelector = '#' + tag.getId() + ' .waf-widget-body .waf-dataGrid-col-' + oldID.replace(/\./g, '_');								newBodySelector = '#' + tag.getId() + ' .waf-widget-body .waf-dataGrid-col-' + colID.replace(/\./g, '_');								$(D.tag.style.getRules(new RegExp('^' + bodySelector + '\\b'))).each(function(i, rule){									D.tag.style.interfaceSheet.addRule(newBodySelector, rule.style.cssText);								});								/*								 * Delete old ones								 */								D.tag.style.deleteRules(new RegExp('^' + bodySelector + '\\b'));							}						}						column.getAttribute(name).setValue(value);					});					columns.add(column);				});				/*				 * Refresh selector				 */				tag.displayInfo();			}			catch (e) {				console.log(e);			}		}	}],	events: [{		name: 'onCellClick',		description: 'On Cell Click',		category: 'Grid Events'	}, {		name: 'onRowClick',		description: 'On Row Click',		category: 'Grid Events'	}, {		name: 'onRowDblClick',		description: 'On Row Double Click',		category: 'Grid Events'	}, {		name: 'onRowRightClick',		description: 'On Row Right Click',		category: 'Grid Events'	}, {		name: 'onRowDraw',		description: 'On Row Draw',		category: 'Grid Events'	}, {		name: 'onError',		description: 'On Error Handler',		category: 'Grid Events'	}, {		name: 'onHeaderClick',		description: 'On Header Click',		category: 'Grid Events'	}],	columns: {		attributes: [{			name: 'sourceAttID'		}, {			name: 'colID'		}, {			name: 'format'		}, {			name: 'width'		}, {			name: 'title'		}],		events: []	},	properties: {		style: {			theme: {				'roundy': false			},			fClass: true,			text: true,			background: true,			border: true,			sizePosition: true,			label: true,			shadow: true,			disabled: ['border-radius']		}	},	structure: [{		description: 'cells',		selector: '.waf-dataGrid-cell',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		},		state: [{			label: 'hover',			cssClass: 'waf-state-hover',			find: '.waf-dataGrid-cell'		}, {			label: 'active',			cssClass: 'waf-state-active',			find: '.waf-dataGrid-cell'		}]	}, {		description: 'header / cells',		group: 'header',		selector: '.waf-dataGrid-header .waf-dataGrid-cell',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}, {		description: 'header',		group: 'header',		selector: '.waf-dataGrid-header',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}, {		description: 'rows / even',		group: 'rows',		selector: '.waf-dataGrid-row.waf-widget-even',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}, {		description: 'rows / odd',		group: 'rows',		selector: '.waf-dataGrid-row.waf-widget-odd',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}, {		description: 'rows',		group: 'rows',		selector: '.waf-dataGrid-row',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		},		state: [{			label: 'hover',			cssClass: 'waf-state-hover',			find: '.waf-dataGrid-row'		}, {			label: 'active',			cssClass: 'waf-state-active',			find: '.waf-dataGrid-row'		}, {			label: 'selected',			cssClass: 'waf-state-selected',			find: '.waf-dataGrid-row'		}]	}, {		description: 'body',		selector: '.waf-dataGrid-body',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}, {		description: 'footer',		selector: '.waf-dataGrid-footer',		style: {			text: true,			textShadow: true,			background: true,			border: true,			disabled: ['border-radius']		}	}],	onInit: function(config){		var grid = new WAF.widget.Grid(config);		return grid;	},	onDesign: function(config, designer, tag, catalog, isResize){		var j, columns, structure, columnsCount;		var i = 0, colWidth = tag.getAttribute('data-column-width') ? tag.getAttribute('data-column-width').getValue().split(',') : [], colName = _getAttrValue('data-column-name', ''), colAttribute = _getAttrValue('data-column-attribute', ''), colBinding = _getAttrValue('data-column-binding', ''), colColumn = _getAttrValue('data-column', ''), tagClass = tag.getAttribute('class').getValue(), grid = {}, isReadOnly = _getAttrValue('data-readOnly', 'false') === 'true', hideFooter = _getAttrValue('data-footer-hide', 'false') === 'true', hideHeader = _getAttrValue('data-header-hide', 'false') === 'true', textFooter = _getAttrValue('data-footer-text', 'item(s)'), tagID = tag.getAttribute('id').getValue();		function _getAttrValue(inName, inDefault){			inDefault = inDefault;			var attr = tag.getAttribute(inName);			return attr ? attr.getValue() : inDefault;		}		/*		 * Add datasources attributes to widget structure		 */		structure = tag.getStructures()		columns = tag.getColumns();		columnsCount = columns.count();		// Remove old structures		// TODO : Add a remove method into the descriptor API		for (i in structure._list) {			if (structure._list[i] && structure._list[i]._selector.match(new RegExp('(.waf-widget-body .waf-dataGrid-col)|(.waf-widget-header .waf-dataGrid-col)'))) {				structure._list = structure._list.slice(0, i).concat(structure._list.slice(i + 1));			}		}		for (j = 0; j < columnsCount; j += 1) {			tag.addStructure({				description: columns.get(j).getAttribute('title').getValue(),				group: 'header column',				selector: '.waf-widget-header .waf-dataGrid-col-' + columns.get(j).getAttribute('colID').getValue(),				style: {					text: true,					background: true				}			});		}		for (j = 0; j < columnsCount; j += 1) {			tag.addStructure({				description: columns.get(j).getAttribute('title').getValue(),				group: 'body column',				selector: '.waf-widget-body .waf-dataGrid-col-' + columns.get(j).getAttribute('colID').getValue(),				style: {					text: true,					background: true				}			});		}		if (!isResize) {			// check for retro compatibility			if (tag.getColumns().count() > 0) {				grid = new WAF.classes.DataGrid({					inDesign: true,					id: tagID,					render: tagID,					dataSource: colBinding,					binding: colBinding,					columns: tag.getColumns().toArray(),					colWidth: colWidth,					cls: tagClass,					hideFooter: hideFooter,					hideHeader: hideHeader,					textFooter: textFooter				});			}			else {				grid = new WAF.classes.DataGrid({					inDesign: true,					id: tagID,					render: tagID,					dataSource: colBinding,					binding: colBinding,					columns: colColumn,					colNames: colName,					colAttributes: colAttribute,					colWidth: colWidth,					cls: tagClass,					hideFooter: hideFooter,					hideHeader: hideHeader,					textFooter: textFooter				});			}			grid.tag = tag;			tag.grid = grid;			// message if not binding			if (tag.getColumns().count() === 0 && !config['data-binding']) {				if ($('#' + tag.overlay.id + ' .message-binding-grid ').length == 0) {					$('<div class="message-binding-grid ">Drop a datasource<br> here</div>').appendTo($('#' + tag.overlay.id));				}			}			else {				$(tag.overlay.element).find('.message-binding-grid ').each(function(i){					$(this).remove();				});			}			// Adding row even/odd classNames			// Could be tag.grid.gridController.gridView.refresh();			// if row.rowNumber was really updated on widget-grid-view.js L949			// (use of rowCount works)			$(tag.overlay.element).find('.waf-dataGrid-row').each(function(i){				$(this).addClass(i % 2 ? 'waf-widget-odd' : 'waf-widget-even');			});			// hide toolbar			if (hideFooter) {				$('#' + tagID + ' .waf-widget-footer').hide();			}			else {				$('#' + tagID + ' .waf-widget-footer').show();			}			// hide header			if (hideHeader) {				$('#' + tagID + ' .waf-widget-header').hide();			}			else {				$('#' + tagID + ' .waf-widget-header').show();			}			// readOnly: Show/hide buttons			if (isReadOnly) {				$("#" + tagID + " .waf-dataGrid-footer .waf-toolbar").hide();			}			else {				$("#" + tagID + " .waf-dataGrid-footer .waf-toolbar").show();			}		}		else {			tag.refresh();		}	}});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/autoForm/widget-autoForm.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    'AutoForm',    {    },    function WAFWidget(config, data, shared) {        var        i,        that,        source,        nameList,        attrList,        errorDiv,        mustDisplayError,        divID,        options,        htmlObject,        oldAF,        oldAFLength;        that                = this;        htmlObject          = $(this.containerNode);        source              = this.source;        nameList            = [];        attrList            = [];        errorDiv            = config['data-errorDiv'];        mustDisplayError    = config['data-display-error'];        divID               = config['id'];        options             = config.options ? config.options : {};        if (mustDisplayError == null) {            mustDisplayError = true;        } else {            mustDisplayError = (mustDisplayError == '1' || mustDisplayError == 'true');        }        options.mustDisplayError = mustDisplayError;        options.errorDiv = errorDiv;        /*         * Display autormform with widgets         */        if (data['withoutTable'] === "true"){            options.withoutTable = true;        }        if (data['resize-each-widget'] === "true"){            options.allowResizeInput = true;        }        if (source != null || typeof Designer !== 'undefined') {            /*             * Getting the names list             */            if(data['column-name']) {                nameList = data['column-name'].split(',')            }            /*             * Getting the attributes list             */            if(data['column-attribute']) {                attrList = data['column-attribute'].split(',')            }            if (data['columns'] != null && data['columns'] != '' && !data['column-name'] ) {                attrList = data['columns'].split(',');                nameList = data['columns'].split(',');            }            /*             * Call autoform build method             */            oldAF = WAF.AF.buildForm(divID, source, attrList, nameList, options );            /*             * Append old AF attributes and functions             */            for (i = 0; i <= oldAFLength; i += 1) {                if (!that[i]) {                     that[i] = oldAF[i];                }            }            /*             * Allow to resize subelements             */            if (this.addResizeOnSubWidgets != null) {                this.addResizeOnSubWidgets();            }            /*             * Collapse to display sub Autoforms             */            htmlObject.find('.waf-form-att-label-rel.waf-expandable,.attribute-rel').bind('click', {widget : that}, function(e) {                var                attNo,                formID,                widget,                htmlObject;                widget      = e.data.widget;                htmlObject  = $(this);                /*                 * Collapse for autoform with table                 */                if (widget.config['data-withoutTable'] == 'false') {                    htmlObject.toggleClass('expanded waf-state-active');                    attNo = parseInt(htmlObject.data("att-id"));                    that.toggleAttribute2(widget.id, attNo, e.shiftKey);                /*                 * Collapse for autoform without table                 */                } else {                    attNo   = htmlObject.data('att-id');                    formID  = widget.id;                    if (attNo != null && formID != null) {                        attNo = parseInt(attNo);                    }                    if (widget != null) {                        that.toggleAttribute(formID, attNo);                    }                }            });			htmlObject.find('.waf-form-att-label-rel.waf-expandable,.attribute-rel').each(function(index) {				$(this).prev().bind("click", function(event) {					//Simulate click on expandable icon					$(this).next().click();					event.stopPropagation();					event.preventDefault();				});			});        /*         * Display a message to indicate that the widget is not binded         */        } else {            $('<div class="waf-autoForm-missingBinding">Datasource is either missing <br>or <br>invalid</div>').appendTo(htmlObject);        }        if (data.draggable == 'true') {            htmlObject.children('.waf-widget-header,.waf-widget-footer').css('cursor', 'pointer');        }    }, {        /*         * List of the subForms         */        _subWidgets : {},        /*         * Resize method called during resize         * @method onResize         */        onResize : function autoform_resize() {            var            width,            height,            newHeight,            htmlObject;            /*             * Resize autoform body             */            htmlObject  = $(this.containerNode);            width       = htmlObject.width();            height      = htmlObject.height();            newHeight   = height - parseInt(htmlObject.find('.waf-widget-footer').css('height'));            newHeight  -= parseInt(htmlObject.find('.waf-widget-header:first').css('height'));            htmlObject.find('.waf-widget-body:first').css('width', width);            htmlObject.find('.waf-widget-body:not(:first)').css('width', '100%');            htmlObject.find('.waf-widget-body:first').css('height',  newHeight + 'px');            this.afterResize();        },        /*         * After resize method         * @method afterResize         * @param {string} formdiv         * @param {boolean} withToolBar         */        afterResize : function autoform_after_resize(formdiv, withToolBar) {            var            headerDom,            bodyDom,            footerDom,            formHeight,            headerHeight,            footerHeight;            if (formdiv == null) {                if (this.withoutTable) {                    formdiv         = this.$domNode;                    withToolBar     = this.withToolBar;                    headerDom       = this.headerDom;                    bodyDom         = this.bodyDom;                    footerDom       = this.footerDom;                }            } else {                headerDom   = $('.waf-widget-header', formdiv);                bodyDom     = $('.waf-form-body', formdiv);                footerDom   = $('.waf-widget-footer', formdiv);            }            if (formdiv != null) {                formHeight      = formdiv.height();                headerHeight    = headerDom.outerHeight();                footerHeight    = 0;                if (withToolBar) {                    footerHeight = footerDom.outerHeight();                }                bodyDom.height(formHeight-footerHeight-headerHeight);            }        },        /*         * Stop Resize method called on stop resize         * @method stopResize         */        stopResize : function autoform_stop_resize() {        },        /*         * Start Resize method called on stop resize         * @method startResize         */        startResize : function autoform_stop_resize() {        },        /*         * Remove an entity from the dataSource         * @method dropEntity         */        dropEntity  : function autoform_drop_entity() {            var            source;            source = this.source;            if (source) {                if (source.getCurrentElement() != null) {                    source.removeCurrent();                } else {                    this.clear();                }            }        },        /*         * Clear the autoform content         * @method clear         */        clear   : function autoform_clear() {            var            i,            attList,            att,            xLength,            pos,            element;            attList = this.attList;            this.purgeErrorMessagesOnForm();            for (i = 0; i < attList.length; i++) {                att = this.atts[i];                if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias"){                    element = document.getElementById(this.id + "_" + idName(attList[i]));                    if (element) {                        element.value = "";                    }                }            }            if (this.withToolBar) {                xLength = this.source.length;                    pos = 0;                    if (this.source.getCurrentElement() != null) {                        pos = (this.source.getPosition() + 1);                    }                    $('#' + this.id + ' .waf-status-right').html(pos + " / " + xLength);            }        },        /*         * Fill the autoform content         * @method fill         */        fill : function autoform_fill() {            var            i,            attList,            xLength,            sourceAtt,            htmlobj;            attList = this.attList;            this.purgeErrorMessagesOnForm();            for (i = 0; i < attList.length; i++)  {                sourceAtt   = this.sourceAtts[i];                if (sourceAtt != null) {                    if (sourceAtt.simple)  {                        htmlobj = document.getElementById(this.id + "_" + idName(attList[i]));                        if (htmlobj.isInFocus) {                            htmlobj.value = sourceAtt.getValueForInput(); //form.source[att.name];                        } else  {                            htmlobj.value = htmlobj.getFormattedValue();                        }                    }                }            }            if (this.withToolBar)   {                xLength = this.source.length;                $('#' + this.id + ' .waf-status-right').html((this.source.getPosition() + 1) + " / " + xLength);            }        },        /*         * Open the form in a panel         * @method openAsPanel         */        openAsPanel:  function autoform_open_as_panel() {            var            htmlObject,            already,            off,            h,            w,            title;            htmlObject = this.$domNode;            already = htmlObject.data("inPanel");            if (already == "1") {                htmlObject.dialog("open");            } else {                htmlObject.data("inPanel", "1");                off = htmlObject.offset();                h   = htmlObject.height();                w   = htmlObject.width();                htmlObject.css('position', 'relative');                htmlObject.css('top','0px');                htmlObject.css('left','0px');                title = htmlObject.find(".autoForm-title").html();                htmlObject.dialog({                    dialogClass : 'waf-widget-panel autoForm-panel ' + htmlObject.prop('class'),                    title       : title,                    position    : [off.left, off.top],                    width       : w,                    resize      : function(event, ui) {                        var                        h,                        offsettop,                        filler;                        offsettop   = $(this).position().top;                        filler      = $(this).find('.autoForm-filler').not('.included tr');                        filler.hide();                        h           = $(this).find('table').height() + offsettop;                        if (h < ui.size.height) {                            filler.height(ui.size.height - h);                            filler.show();                        }                    }                });                htmlObject.css('width','auto');                htmlObject.css('height','auto');            }        },        /*         * Display or hide autoform attribute widget (without table)         * @method toggleAttribute         * @param {string} divID : id of the sub element         * @param {string} attID : attribute of the sub element into the autoform         */        toggleAttribute : function autoform_toggle_attribute(divID, attID) {            var            i,            h,            w,            nb,            form,            dataTheme,            inAPanel,            tmpForm,            attribute,            subID,            subsource,            parentDivID,            maxw,            objdiv,            needrecalc,            sourceID,            subattlist,            subcolumns,            att,            expandDiv,            widget,            subWidget,            rowDiv,            imgDiv,            parentWidth;            widget      = form = this;            dataTheme   = form.dataTheme;            inAPanel    = false;            if (form == null) {                return null;            }            attribute   = form.atts[attID];            subID       = widget.id + '-subWidget' + attID;            subWidget   = widget._subWidgets[subID];            parentDivID = divID + '_' + attribute.name;            rowDiv      = $("#" + divID + "_att_" + attID);            expandDiv   = $('.waf-expandable', rowDiv);            if (!subWidget) {                expandDiv.removeClass('waf-collapsed');                expandDiv.addClass('waf-expanded');                if(attribute.kind == 'relatedEntity') {                    sourceID = subID + "_source";                    subsource = WAF.dataSource.create({                        id      : sourceID,                        binding : form.source.getID() + "." + attribute.name                    });                    // Get the id of the first form                    if (form.parent) {                        tmpForm = form;                        while(tmpForm.parent) {                            tmpForm = tmpForm.parent.form;                        }                    }                    objdiv = $('<div />');                    objdiv.prop({                        id              : subID,                        'class'         : dataTheme+" waf-autoForm"                    })                    .data('theme', dataTheme)                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border')                    });                    objdiv.appendTo('#' + parentDivID);                    if(this.config['data-resize-optimal-each-widget'] === 'true') {						objdiv.width($('#' + divID).width() - objdiv.position().left - 5);					}                    form.relForms[attribute.name]   = subWidget;                    form.relSources[sourceID]       = subsource;                    /*                     * Initialize autoform widget                     */                    subWidget     = new WAF.widget.AutoForm({                        'id'            : subID,                        'class'         : widget.config['class'],                        'data-binding'  : subsource._private.id,						'data-resize-optimal-each-widget' : this.config['data-resize-optimal-each-widget'],                        'options'       : {                            toolBarForRelatedEntity : form.level == 1,                            noToolBar               : form.level > 1,                            formTitle               : attribute.name,                            checkIdentifying        : form.level == 1,                            level                   : form.level+1,                            allReadOnly             : form.level > 1,                            included                : !inAPanel,                            inAPanel                : inAPanel,                            withoutTable            :form.withoutTable,                            allowResizeInput        : form.allowResizeInput,                            parent                  : {                                form        : form,                                att         : attribute,                                sourceAtt   : form.sourceAtts[attID]                            }                        }                    });                    if (inAPanel){                        this.openAsPanel()                    } else {                        if (subWidget.withoutTable) {                            needrecalc  = false;                            h           = objdiv.outerHeight();                            if (h > 400) {                                objdiv.height(400);                                needrecalc = true;                            }                            w       = objdiv.outerWidth() + 30;                            maxw    = form.bodyDom.innerWidth() - objdiv.position().left - 5;                            if (maxw > 150 && maxw < w){                                objdiv.width(maxw);                            } else {                                objdiv.width(w);                            }                            objdiv.resizable({                                //minHeight: parseInt($('#' + config.id).css('height')),                                //minWidth: parseInt($('#' + config.id).css('width')),                                resize : function(event, ui) {                                    var                                    newHeight;                                    $('.waf-widget-body:first', objdiv).css('width', parseInt(objdiv.css('width')));                                    $('.waf-widget-body:not(:first)', objdiv).css('width', '100%');                                    newHeight   = parseInt(objdiv.css('height')) - parseInt($('.waf-widget-footer', objdiv).css('height'));                                    newHeight  -= parseInt($('.waf-widget-header:first', objdiv).css('height'));                                    $('.waf-widget-body:first', objdiv).css('height',  newHeight+ 'px');                                    subWidget.onResize();                                }                            });                            if (subWidget.addResizeOnSubWidgets != null) {                                subWidget.addResizeOnSubWidgets();                            }                            if (needrecalc) {                                subWidget.onResize();                            }							if (this.config['data-resize-optimal-each-widget'] === 'true') {								this.resizeParentWidget(objdiv);							}                        }                    }                    subsource.resolveSource();                } else if (attribute.kind == 'relatedEntities') {                    sourceID    = subID + "_source";                    subsource   = WAF.dataSource.create({                        id      : sourceID,                        binding : form.source.getID() + "." + attribute.name                    });                    objdiv = $('<div />');                    objdiv.prop({                        id              : subID,                        'class'         : 'waf-widget waf-dataGrid AF_autoGridGen ' + dataTheme                    })                    .data({                        'type'     : 'dataGrid',                        'theme'    : dataTheme                    })                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border')                    })                    .appendTo('#' + parentDivID);                    if (form.withoutTable) {                        needrecalc  = false;                        h           = objdiv.outerHeight();                        if (h > 400) {                            objdiv.height(400);                            needrecalc = true;                        }                        w       = objdiv.outerWidth()+30;                        maxw    = form.bodyDom.innerWidth() - objdiv.position().left - 5;                        if (maxw > 200) {                            objdiv.width(maxw);                        } else {                            objdiv.width(200);                        }                    }                    subattlist = subsource._private.dataClass.getAttributes();                    subcolumns = [];                    for (i = 0, nb = subattlist.length; i < nb; i++) {                        att = subattlist[i];                        if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                            if (att.type != "image") {                                w = 150;                                switch (att.type) {                                    case 'number':                                        w = 90;                                        break;                                    case 'long':                                        w = 70;                                        break;                                    case 'byte':                                    case 'word':                                        w = 50;                                        break;                                    case 'date':                                    case 'duration':                                        w = 100;                                        break;                                    default:                                        w = 150;                                        break;                                }                                subcolumns.push({                                    colID       : att.name,                                    sourceAttID : att.name,                                    title       :att.name,                                    width       : w                                });                            }                        }                    }                    subWidget = new WAF.widget.Grid({                        id              : subID,                        'data-binding'  : sourceID,                        'data-column'   : JSON.stringify(subcolumns),                        cls             : subID                    });                    if (inAPanel){                        $("#"+subID).dialog();                    } else {                        objdiv.resizable({                            resize  : function(event, ui) {                                var                                newHeight;                                $('.waf-widget-body', objdiv).css('width', parseInt(objdiv.css('width')));                                newHeight   = parseInt(objdiv.css('height')) - parseInt($('.waf-widget-footer', objdiv).css('height'));                                newHeight  -= parseInt($('.waf-widget-header', objdiv).css('height'));                                $('.waf-widget-body', objdiv).css('height', newHeight + 'px');                            },                            stop    : function(event, ui) {                                subWidget.gridController.gridView.refresh();                            }                        });                    }                    form.relSources[sourceID]       = subsource;                    form.relGrids[attribute.name]   = {                        gridID  : subID,                        visible : true,                        grid    : subWidget                    };					if (this.config['data-resize-optimal-each-widget'] === 'true') {						this.resizeParentWidget(objdiv);					}                    subsource.resolveSource();                } else if (attribute.type == 'image') {                    parentWidth = $('#' + parentDivID).width();                    if (parentWidth < 300) {                        parentWidth = 300;                    }                    imgDiv = $('<div />');                    imgDiv.prop({                        id              : subID,                        'class'         : 'AF_autoImage waf-widget waf-image ' + dataTheme                    })                    .data({                    	'type'     : 'image',                        'theme'    : dataTheme                    })                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border'),                        'width'         : parentWidth + 'px',                        'height'            : '100px'                    })                    .appendTo('#' + parentDivID);                    subWidget     = new WAF.widget.Image({                        'id'            : subID,                        'class'         : widget.config['class'],                        'data-binding'  : form.source.getID()+'.' + attribute.name,                        'data-fit'      : '4'                    });                    if (this.allowResizeInput) {                        imgDiv.resizable({                            resize: function() {                                subWidget.refresh();                            }                        });                    }					if (this.config['data-resize-optimal-each-widget'] === 'true') {						this.resizeParentWidget(imgDiv);					}                }                widget._subWidgets[subID] = subWidget;            } else {                /*                 * Hide/Show if already displayed                 */                subWidget.toggle();                if (subWidget.$domNode.is(':hidden')) {                    expandDiv.removeClass('waf-expanded');                    expandDiv.addClass('waf-collapsed');                } else {                    expandDiv.removeClass('waf-collapsed');                    expandDiv.addClass('waf-expanded');                }            }        },        /*         * Display or hide autoform attribute widget (with table)         * @method toggleAttribute2         * @param {string} divID : id of the sub element         * @param {string} attID : attribute of the sub element into the autoform         * @param {boolean} inAPanel         */        toggleAttribute2 : function autoform_toggle_attribute_2(divID, attID, inAPanel) {            var            i,            w,            nb,            form,            dataTheme,            attribute,            subWidget,            subID,            sourceID,            subsource,            parentDivID,            subattlist,            subcolumns,            att,            imgArea,            parentWidth,            sourceAtt,            widget,            subSource;            form        = this;            dataTheme   = form.dataTheme;            widget      = $$(divID);            if (inAPanel == null) {                inAPanel = false;            }            if(form == null){                return;            }            attribute = form.atts[attID];            $('#' + divID +'_rel' + attID).toggleClass("expanded");            subID       = widget.id + '-subWidget' + attID;            subWidget   = widget._subWidgets[subID];            sourceID    = subID + "-source";            parentDivID = divID + '_' + attribute.name;            /*             * Create sub dataGrid if doesn't exists             */            if(!subWidget) {                if (attribute.kind == 'relatedEntity') {                    /*                     * Create sub datasource                     */                    subSource   = WAF.dataSource.create({                        id      : sourceID,                        binding : form.source.getID() + "." + attribute.name                    });                    /*                     * Create html object                     */                    $('<div>')                    .prop({                        id              : subID,                        'class'         : dataTheme + " waf-autoForm waf-widget"                    })                    .data('data-theme', dataTheme)                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border')                    })                    .appendTo('#' + parentDivID);                    /*                     * Initialize autoform widget                     */                    subWidget     = new WAF.widget.AutoForm({                        'id'            : subID,                        'class'         : widget.config['class'],                        'data-binding'  : subSource._private.id,                        'options'       : {                            toolBarForRelatedEntity : form.level == 1,                            noToolBar               : form.level > 1,                            formTitle               : attribute.name,                            checkIdentifying        : form.level == 1,                            level                   : form.level+1,                            allReadOnly             : form.level > 1,                            included                : !inAPanel,                            inAPanel                : inAPanel,                            withoutTable            : form.withoutTable,                            allowResizeInput        : form.allowResizeInput,                            parent                  : {                                form        : form,                                att         : attribute,                                sourceAtt   : form.sourceAtts[attID]                            }                        }                    });                    /*                     * Resolve source to fill the subForm with atrtibutes values                     */                    subSource.resolveSource();                    /*                     * Open as panel if defined                     */                    if (inAPanel) {                        subWidget.openAsPanel();                    }                } else if(attribute.kind == 'relatedEntities') {                    /*                     * Create sub datasource                     */                    subsource   = WAF.dataSource.create({                        id      : sourceID,                        binding : form.source.getID() + "." + attribute.name                    });                    parentDivID = divID + '_' + attribute.name;                    $('<div />')                    .prop({                        id              : subID,                        'class'         : 'waf-widget waf-dataGrid AF_autoGridGen ' + dataTheme                    })                    .data({                    	'type'     : 'dataGrid',                        'theme'    : dataTheme                    })                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border')                    })                    .appendTo('#' + parentDivID);                    subattlist = subsource._private.dataClass.getAttributes();                    subcolumns = [];                    for (i = 0, nb = subattlist.length; i < nb; i++) {                        att = subattlist[i];                        if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                            if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                                if (att.type != "image") {                                    w = 150;                                    switch (att.type) {                                        case 'number':                                            w = 90;                                            break;                                        case 'long':                                            w = 70;                                            break;                                        case 'byte':                                        case 'word':                                            w = 50;                                            break;                                        case 'date':                                        case 'duration':                                            w = 100;                                            break;                                        default:                                            w = 150;                                            break;                                    }                                    subcolumns.push({                                        colID       : att.name,                                        sourceAttID : att.name,                                        title       :att.name,                                        width       : w                                    });                                }                            }                        }                    }                    subWidget = new WAF.widget.Grid({                        id              : subID,                        'data-binding'  : sourceID,                        'data-column'   : JSON.stringify(subcolumns),                        cls             : subID,                        included        :true                    });                    if (inAPanel) {                        $("#"+subID).dialog();                    }                    form.relSources[sourceID]       = subsource;                    form.relGrids[attribute.name]   = {                        gridID  : subID,                        visible : true,                        grid    : subWidget                    };                    subsource.resolveSource();                } else if (attribute.type == 'image') {                    parentWidth = $('#' + parentDivID).width();                    if (parentWidth < 300) {                        parentWidth = 300;                    }                    $('<div />')                    .prop({                        id              : subID,                        'class'         : 'AF_autoImage waf-widget waf-image ' + dataTheme                    })                    .data({                    	'type'     : 'image',                        'theme'    : dataTheme                    })                    .css({                        'background-color'  : $('#' + divID).css('background-color'),                        'border'            : $('#' + divID).css('border'),                        'max-width'         : parentWidth + 'px',                        'height'            : '100px'                    })                    .appendTo('#' + parentDivID);                    subWidget     = new WAF.widget.Image({                        'id'            : subID,                        'class'         : widget.config['class'],                        'data-binding'  : form.source.getID()+'.' + attribute.name,                        'data-fit'      : '4'                    });                }                widget._subWidgets[subID] = subWidget;            } else {                /*                 * Hide/Show if already displayed                 */                subWidget.toggle();            }        },        /*         * Draw the status(pager) of the autoform in the footer         * @method drawStatud         */        drawStatus : function autoform_draw_status() {            var            pos,            xLength;            pos     = 0;            if (this.withToolBar) {                xLength = this.source.length;                if (this.source.getCurrentElement() != null ){                    pos = (this.source.getPosition() + 1);                }                $('#' + this.id + ' .waf-status-right').html(pos + " / " + xLength);            }        },        /*         * Add a new datasource entity         * @method addEntity         */        addEntity : function autoform_add_entity() {            this.source.addNewElement();        },        /*         * Go to next datasource entity         * @method nextEntity         */        nextEntity : function autoform_next_entity() {            this.source.selectNext();        },        /*         * Go to previous datasource entity         * @method prevEntity         */        prevEntity : function autoform_prev_entity() {            this.source.selectPrevious();        },        /*         * Find an entity         * @method findEntity         */        findEntity : function autoform_find_entity() {            var            i,            form,            queryString,            attList,            val;            if (this.source) {                queryString = "";                attList     = this.attList;                for (i = 0; i < attList.length; i++) {                    val = document.getElementById(this.id + "_" + idName(attList[i])).value;                    if (val != null && val != "") {                        if (queryString != "") {                            queryString += " and ";                        }                        queryString += attList[i] + ' = ' + '"' + val + '"';                    }                }                this.dataClass.query(queryString, {                    onSuccess: this.gotEntityCollection                }, {                    idval: this.id                });            }        },        /*         * Get an entity collection         * @method gotEntityCollection         * @param {object} e         */        gotEntityCollection : function autoform_got_entity_collection(e) {            var            sel,            widget;            sel     = e.entityCollection;            widget  = $$(e.userData.idval);            if (widget != null) {                widget.source.setEntityCollection(sel);            }        },        /*         * Save an entity         * @method saveEntity         */        saveEntity : function autoform_save_entity() {            var            source,            wasNew,            widget;            widget  = this;            source  = this.source;            if (source) {                if (source.getCurrentElement() != null) {                    wasNew = source.isNewElement();                    source.save({                        onSuccess   : function(event) {                            if (wasNew) {                                source.addNewElement();                            }                        },                        onError     : widget.errorHandler                    }, { // user Data                        autoForm    : widget,                        errorMessage: "The form could not save the entity"                    }                    );                } else {                    source.addNewElement();                }            }        },        /*         * Display the error handler         * @method errorHandler         * @param {object} e         */        errorHandler : function autoform_error_handler(e){            var            b,            widget,            handler,            cont,            errorDiv;            widget  = e.userData.autoForm;            handler = widget.onError;            cont    = true;            if (handler != null) {                b = handler(e);                if (b != null && b === false) {                    cont = false;                }            }            if (cont) {                errorDiv        = widget.getErrorDiv();                e.message   = e.userData.errorMessage || null;                WAF.ErrorManager.displayError(e, errorDiv);            }        },        /*         * Find related         * @method findRel         */        findRel : function autoform_find_rel() {            var            i,            widget,            queryString,            attList,            att,            val,            attName,            entityCollection;            widget = this;            queryString = "";            attList     = widget.attList;            for (i = 0; i < attList.length; i++) {                attName = attList[i];                val     = document.getElementById(widget.id + "_" + idName(attName)).value;                att     = widget.atts[i];                if (att.identifying && val != null && val != "") {                    if (queryString != "") {                        queryString += " and ";                    }                    queryString += attName + ' = ' + '"' + val + '"';                }            }            widget.dataClass.query(queryString, {                onSuccess: function(event) {                    entityCollection = event.entityCollection;                    if (entityCollection != null && entityCollection.length != 0) {                        entityCollection.getEntity(0, {                            onSuccess:function(event) {                                var                                entity;                                entity = event.entity;                                widget.source.setCurrentEntity(entity);                                if (widget.parent != null) {                                    widget.parent.form.source[widget.parent.att.name].set(widget.source);                                }                            }                        });                    } else {                        widget.source.setCurrentEntity(null);                        if (widget.parent != null) {                            widget.parent.form.source[widget.parent.att.name].set(null);                        }                    }                }            }, {                idval: widget.id            });        },        /*         * Is executed on change event on a attribute         * @method changeEntityAtt         */        changeEntityAtt : function autoform_change_entity_att(attName, i) {            var            widget,            value,            sourceAtt,            validation,            messDivName,            messDiv,            htmlObject,            htmlObjectParent;            htmlObject          = $('#' + this.id + "_" + attName);            htmlObjectParent    = htmlObject.parent();            value               = htmlObject.val();            sourceAtt           = this.sourceAtts[i];            value               = sourceAtt.normalize(value);            validation          = sourceAtt.validate(value);            messDivName         = this.id + "_" + attName + "__mess";            messDiv             = document.getElementById(messDivName);            if (messDiv == null) {                htmlObject.after('<span id="' + messDivName + '" class="AF_mess"></span>');                messDiv = document.getElementById(messDivName);            }            if (validation.valid) {                htmlObjectParent.removeClass('AF_ValueWrong');                htmlObjectParent.addClass('AF_ValueOK');                $('#' + messDivName).parent().removeClass('AF_messWrong');                $('#' + messDivName).removeClass('AF_markedWrong');                sourceAtt.setValue(value, {                    dispatcherID : this.id                });                if (messDiv != null) {                    messDiv.innerHTML = "";                }            } else {                htmlObjectParent.addClass('AF_ValueWrong');                htmlObjectParent.removeClass('AF_ValueOK');                $('#' + messDivName).parent().addClass('AF_messWrong');                $('#' + messDivName).addClass('AF_markedWrong');                sourceAtt.setValue(value, {                    dispatcherID : this.id                });                if (messDiv == null) {                    alert(validation.messages.join(" , "));                } else {                    messDiv.innerHTML = validation.messages.join(" , ");                }            }        },       /*        * Set subwidget as resizable        * @method addResizeOnSubWidgets        */        addResizeOnSubWidgets : function autoform_add_resize_on_subwidgets() {            var            htmlObject;            function ResizeHandler(event, ui) {                ui.originalElement.css({                    'width'     : '100%',                    'height'    : '100%'                });            }            htmlObject = $("#" + this.id);            if (this.allowResizeInput) {                $(".waf-form-resize-multiline", htmlObject).resizable({                    resize: ResizeHandler                });                $(".waf-form-resize", htmlObject).resizable({                    handles :"e",                    resize  : ResizeHandler                });                $(".waf-form-resize-pict", htmlObject).resizable({                    resize: function(event, ui) {                    }                });                $(".waf-form-resize", htmlObject).parent().css("padding", "0px");                $(".waf-form-resize-multiline", htmlObject).parent().css("padding", "0px");                $(".waf-form-resize,.waf-form-resize-pict,.waf-form-resize-multiline", htmlObject).each(function(index) {                    var                    parent;                    parent = $(this).parent();                    $(this).height(parent.height());                    $(this).width(parent.width());                });            }			/*			$(".waf-form-att-value-input", htmlObject).each(function(index) {	            var parent = $(this).parent();				if (parent.hasClass("ui-wrapper")) {					parent.css("display", "table-cell");				}				else {					$(this).css("display", "table-cell");				}        	});        	*/        },        /*         * Purge error message         * @method purgeErrorMessagesOnForm         */        purgeErrorMessagesOnForm : function autoform_purge_error_messages_on_form() {            var            i,            divID,            attList,            att,            sourceAtt,            objDiv,            messDivName,            attName;            divID   = this.id;            attList = this.attList;            for (i = 0; i < attList.length; i++) {                att         = this.atts[i];                sourceAtt   = this.sourceAtts[i];                objDiv      = document.getElementById(divID + "_" + idName(attList[i]));                if (objDiv != null) {                    if (sourceAtt.readOnly || att.readOnly || (this.checkIdentifying && !att.identifying) || this.allReadOnly){                        objDiv.disabled = true;                    } else {                        objDiv.disabled = false;                    }                }                if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                    attName     = idName(sourceAtt.name);                    messDivName = divID + "_" + attName + "__mess";                    $('#' + divID + "_" + attName).parent().removeClass('AF_ValueWrong');                    $('#' + divID + "_" + attName).parent().addClass('AF_ValueOK');                    $('#' + messDivName).parent().removeClass('AF_messWrong');                    $('#' + messDivName).removeClass('AF_markedWrong');                    $('#' + messDivName).html("");                }            }        },		/*		 * Resize parent widget to have only one scrollbar		 * @method resizeParentWidget		 */		resizeParentWidget : function resize_parent_auto_form_widget(currentWidget) {			var i,				widget,				parentsLength,				widgetsParent,				$parentWidget,				currentHeight,				$parentWidgetBody,				needToResizeParent;			widget = this;			widgetsParent = $(currentWidget).parents(".waf-autoForm");			parentsLength = widgetsParent.length;			needToResizeParent = true;			i = 0;			while (needToResizeParent && i < parentsLength) {				$parentWidget = $(widgetsParent[i]);				$parentWidgetBody = $parentWidget.children(".waf-autoForm-body")				//resize only sub-widget				if (widget._subWidgets.hasOwnProperty($parentWidget[0].id)) {					currentHeight = $parentWidgetBody.height();					if (currentHeight < $parentWidgetBody[0].scrollHeight) {						$parentWidgetBody.height($parentWidgetBody.outerHeight() + ($parentWidgetBody[0].scrollHeight - currentHeight));						if ($parentWidgetBody.width() < $parentWidgetBody[0].scrollWidth) {							//add scroll bar height							$parentWidgetBody.height($parentWidgetBody.outerHeight() + 16);						}					} else {						needToResizeParent = false;					}				}				i++;			}		}    });WAF.AF = {};/* * Build a form (used on design and on runtime) * @method buildForm * @param {string} divID * @param {object} dataSource * @param {object} attrList * @param {object} nameList * @param {object} options * @param {object} options * @param {object} catalog * @param {object} tag */WAF.AF.buildForm = function(divID, dataSource, attrList, nameList, options, catalog, tag) {    var    i,    j,    w,    lib,    nbatt,    isQueryForm,    autonomous,    withoutTable,    allowResizeInput,    subWidgets,    mustDisplayError,    errorDiv,    dataTheme,    existingClasses,    htmlObject,    mustResizeInputs,    dataClass,    formTitle,    otherAttInfo,    checkIdentifying,    level,    toolBarForRelatedEntity,    allReadOnly,    atts,    newlist,    sourceAtts,    attlist,    attlistLength,    attrListLength,    attname,    att,    sourceAtt,    isRel,    withTitle,    html,    headerDom,    bodyDom,    footerDom,    moreclass,    largeObject,    classMore,    htmlIDName,    binding,    maxinputsize,    multiline,    resizeClass,    withToolBar,    toolbarConfig,    toolbar,    tabDom,    maxwidth,    domobj,    nbComponent,    xcol,    operinfo,    nbx,    opertext,    attibuteRelatedIcon,    objID,    htmlobj,    enumValueList,    items,    result,    widget,    nb,    inDesign;    divID                   = divID;    htmlObject              = $('#' + divID);    lib                     = '';    isQueryForm             = false;    autonomous              = true;    withoutTable            = false;    allowResizeInput        = false;    subWidgets              = [];    mustDisplayError        = options.mustDisplayError;    errorDiv                = options.errorDiv;    dataTheme               = "";    existingClasses         = htmlObject.prop('class').split(" ");    mustResizeInputs        = htmlObject.hasClass("roundy");    checkIdentifying        = false;    level                   = 1;    toolBarForRelatedEntity = false;    allReadOnly             = false;    inDesign                = false;    atts                    = [];    newlist                 = [];    sourceAtts              = [];    existingClasses.forEach(function(className) {        if (className != "inherit" && className.substr(0,4) != "waf-") {                dataTheme += className+" ";        }    });    if (options != null && options.isQueryForm){        isQueryForm = true;    }    if (options != null && options.included){        autonomous = false;    }    if (options != null && options.withoutTable){        withoutTable = true;    }    if (options != null && options.allowResizeInput){        allowResizeInput = true;    }    dataClass = null;    /*     * If in design mode     */    if (dataSource == null) {        if (tag && tag.getAttribute('data-binding'))  {            dataClass = catalog.getByName(tag.getAttribute('data-binding').getValue());            formTitle = dataClass ? dataClass.getName() : '';        } else {            dataClass                       = {};            dataClass.getAttributes         = function(){return [];};            dataClass.getAttributeByName    = function(){return [];};            formTitle   = '';        }        inDesign = true;    } else {        /*         * Only for sources on datastore classes         */        dataClass   = dataSource.getDataClass();        formTitle   = dataSource.getClassTitle();        widget      = $$(divID);    }    if (options == null){        options = {};    }    if (options.formTitle != null){        formTitle = options.formTitle;    }    if (isQueryForm) {        formTitle = "Query on " + formTitle;        otherAttInfo = [];    }    if (options.checkIdentifying)            checkIdentifying = true;    if (options.level) {        level = options.level;    }    if (options.toolBarForRelatedEntity){        toolBarForRelatedEntity = options.toolBarForRelatedEntity;    }    if (options.allReadOnly){        allReadOnly = options.allReadOnly;    }    if (attrList == null || attrList.length == 0) {        if (dataSource == null && dataClass) {            attlist         = dataClass.getAttributes();            attrList        = [];            attlistLength   = attlist.length            for (i = 0, nb = attlistLength; i < nb; i++) {                    attrList.push(attlist[i].name);            }        } else if (dataSource) {            attrList = dataSource.getAttributeNames();        }    }    attrListLength = attrList.length;    for (i = 0, nb = attrListLength; i < nb; i++) {        attname = attrList[i];        if (dataSource == null) {            if (dataClass) {                att = dataClass.getAttributeByName(attname);            }        } else {            att = dataSource.getClassAttributeByName(attname);            sourceAtt = dataSource.getAttribute(attname);            sourceAtts.push(sourceAtt);        }        if (att != null) {            if (isQueryForm) {                if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                    isRel = false;                    if (att.type == 'image') {                            isRel = true;                    }                } else {                    isRel = true;                }                if (!isRel) {                    atts.push(att);                    newlist.push(attname);                }            } else {                atts.push(att);                newlist.push(attname);            }        }    }    attrList    = newlist;    withTitle   = !options.noTitle;    html        = '';    headerDom   = null;    bodyDom     = null;    footerDom   = null;    /*     * <With included widgets>     */    if (withoutTable) {        /*         * Form header         */        if (withTitle) {            html += '<div class="waf-form-header waf-widget-header waf-autoForm-header">';            html += 	'<div class="waf-form-header-left">';            html +=         '<div class="waf-form-header-left-inside">';            html +=         '</div>';            html +=     '</div>';            html += 	'<div class="waf-form-header-text autoForm-title-col">';            html +=         formTitle;            html +=	'</div>';            html += 	'<div class="waf-form-header-right">';            html +=     '</div>';            html += '</div>';            //html += this.config.tpl.header;        }        moreclass = "";        if (autonomous){            moreclass += ' autonomous';        } else {            moreclass += ' included';        }        html += '<div class="waf-user-select-none waf-widget-body waf-form-body waf-autoForm-body' + moreclass + '" style="overflow:auto">';        html += '<div class="waf-form-body-inside">';        for (i = 0, nb = attrList.length; i < nb; i++) {            largeObject = false;            att         = atts[i];            if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias")  {                if (att.type == 'string' && att.multiLine){                    largeObject = true;                }                isRel = false;                if (att.type == 'image') {                    isRel = true;                }            } else {                isRel = true;            }            if (isRel){                largeObject = true;            }            classMore = "";            if (largeObject) {                classMore = " waf-form-large-object";            }            htmlIDName  = idName(attrList[i]);            lib         = (nameList && nameList[i]) ? nameList[i] : attrList[i];            html        += '<div class="waf-form-row" id="' + divID +'_att_' + i + '">';            html        +=      '<div class="waf-form-att-label' + classMore + '">';            html        +=          '<div class="waf-form-att-label-text attribute-col">';            html        +=              lib;            html        +=          '</div>';            if (isRel) {                html    += 	'<div class="waf-form-att-label-rel waf-expandable waf-collapsed" data-form-id="' + divID + '" data-att-id="' + i + '">';                html    +=          '</div>';            }            html        += 	'</div>'; // fin d'un form-att-label            if (dataSource == null) {                binding = '';            } else {                binding = dataSource.getID() + '.' + attrList[i];            }            html        += 	'<div class="waf-form-att-value' + classMore + '">';            if (!isRel) {                maxinputsize = 0;                switch(att.type) {                    case "bool":                    case "byte":                            maxinputsize = 3;                            break;                    case "word":                            maxinputsize = 4;                            break;                    case "long":                            maxinputsize = 7;                            break;                    case "long64":                    case "number":                            maxinputsize = 14;                            break;                    case "date":                    case "duration":                            maxinputsize = 12;                            break;                    case "string":                            maxinputsize = 30;                            break;                }                if (att.type != "bool") {                    multiline = false;                    if (att.multiLine) {                        multiline = true;                    }                    if (multiline) {                        resizeClass  = "waf-form-resize-multiline";                        html        += '<textarea data-multiline="true" ';                    } else {                        resizeClass  = "waf-form-resize";                        html        += '<input type="text" ';                    }                    html += 'class="' + dataTheme+resizeClass + ' waf-form-att-value-input waf-widget waf-textField" id="' + divID + "_" + htmlIDName + '" ';                    if (maxinputsize != 0) {                        html += ' style="width:' + maxinputsize + 'em;';                        if (multiline) {                            html += 'height:40px;';                        }                        html += '"';                    }                    html += ' data-binding="'+binding+'" data-type="textField">';                    html += '</textarea>';                } else {					html += '<div data-lib="WAF" type="checkbox" class="'+dataTheme+'waf-form-att-value-checkbox waf-widget waf-checkbox" data-type="checkbox" style="width:16px;height:16px;position:relative;top:3px;" ';                    html += 'data-binding="'+binding+'" id="' + divID + "_" + htmlIDName + '"></div>';					/*					  "waf-checkbox-level-0 waf-level-0"                    html += '<input type="checkbox" class="'+dataTheme+'waf-form-att-value-checkbox waf-widget waf-checkbox" datatype="checkbox" ';                    html += 'data-binding="'+binding+'" id="' + divID + "_" + htmlIDName + '"/>';                    */                }                html += '<div class="errormess-div" id="' + divID + '_' + htmlIDName + '__mess"></div>';            } else {                html += '<div class="waf-form-att-value-rel" id="' + divID + "_" + htmlIDName + '" >';                html += '</div>';            }            html += 	'</div>'; // fin d'un form-att-value            html += '</div>'; // fin d'un form row        }        html += '</div>'; // fin du form body inside        html += '</div>'; // fin du form body        withToolBar = !options.noToolBar;        if (withToolBar) {            html += '<div class="waf-widget-footer waf-autoForm-footer">';            html += 	'<div class="waf-status">';            html += 		'<div class="waf-status-element waf-status-left"></div>';            html += 		'<div class="waf-status-element waf-status-center"></div>';            html += 		'<div class="waf-status-element waf-status-right"></div>';            html += 	'</div>';            html += '</div>';        }        htmlObject.data({            'type'     : isQueryForm ? 'queryForm' : 'autoForm',            'level'    : level        })        .addClass('waf-widget')        .html(html);        tabDom      = $('[data-type]', htmlObject);        maxwidth    = 70;        for (i = 0, nbComponent = tabDom.length; i < nbComponent; i++)  {            domobj          = tabDom[i];            if ($(domobj).data('type') != 'image') {                subWidgets[i]   = WAF.tags.createComponent(domobj, false);            }        }        var labelHtmlObj = $(".waf-form-att-label", htmlObject);        labelHtmlObj.each(function(index) {            w = $(this).outerWidth();            if (maxwidth < w) {                maxwidth = w;            }        });        /*         * Set label with to allow to set the text-align property         */        var sizeReduce = 35;        if (labelHtmlObj.children('.waf-expandable').length == 0) {            sizeReduce = 21;        }        labelHtmlObj.children('.waf-form-att-label-text').width(maxwidth - sizeReduce);        labelHtmlObj.width(maxwidth);        toolBarForRelatedEntity = false;        if (options.toolBarForRelatedEntity) {                toolBarForRelatedEntity = options.toolBarForRelatedEntity;        }        if (withToolBar) {            if (isQueryForm) {                toolbarConfig = [                    {icon: {size: 16, type: 'radioactive'},     title: 'Clear', click: function() { if (widget) widget.clear();}},                    {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',  click: function() { if (widget) widget.findEntity();}}                ];            } else {                if (toolBarForRelatedEntity) {                    toolbarConfig = [                        {icon: {size: 16, type: 'radioactive'},     title: 'Clear', click: function() { if (widget) widget.clear();}},                        {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',  click: function() { if (widget) widget.findRel();}}                    ];                } else {                    toolbarConfig = [                        {icon: {size: 16, type: 'arrowFullLeft'},   title: 'Previous',  click: function() { if (widget) widget.prevEntity();}},                        {icon: {size: 16, type: 'arrowFullRight'},  title: 'Next',      click: function() { if (widget) widget.nextEntity();}},                        {icon: {size: 16, type: 'plus'}, text: '',  title: 'Add',       click: function() { if (widget) widget.addEntity();}},                        {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',      click: function() { if (widget) widget.findEntity();}},                        {icon: {size: 16, type: 'floppyDisk'},      title: 'Save',      click: function() { if (widget) widget.saveEntity();}},                        {icon: {size: 16, type: 'trash'},           title: 'Delete',    click: function() { if (widget) widget.dropEntity();}}                    ];                }            }            toolbar = new WAF.widget.Toolbar(toolbarConfig);            htmlObject.find('.waf-autoForm-footer .waf-status-left').append(toolbar);        }        headerDom   = $('.waf-widget-header', htmlObject);        bodyDom     = $('.waf-form-body', htmlObject);        if (withToolBar) {            footerDom = $('.waf-widget-footer', htmlObject);        }        if (inDesign) {            var            formHeight,            headerHeight,            footerHeight;            formHeight      = htmlObject.height();            headerHeight    = headerDom.outerHeight();            footerHeight    = 0;            if (withToolBar) {                footerHeight = footerDom.outerHeight();            }            bodyDom.height(formHeight-footerHeight-headerHeight);        } else {  			if (widget != null)				widget.afterResize(htmlObject, withToolBar);        }    /*     * <Autoform displayed as table>     */    } else {        html += '<table border="0" cellpadding="0" cellspacing="0" class="autoForm-data';            if (isQueryForm) {                html += ' query-form';            }            if (autonomous){                html += ' autonomous';            } else{                html += ' included';            }        html += '">';        /* It seems the following make the tbody have a wrong width Width is now fixed on cells. */        /* if (!isQueryForm)                html += '<col /><col width="100%" />'; */        xcol = 2;        if (isQueryForm) {            xcol = 3;        }        /*         * Form header         */        if (withTitle) {            html += '<thead class="waf-widget-header waf-autoForm-header">';            html += '   <tr class="autoForm-title-row">';            html += '       <th class="autoForm-title-col" colspan="' + xcol + '"><div class="autoForm-title">' + formTitle + '</div></th>';            html += '   </tr>';            html += '</thead>';        }        html += '<tbody class="waf-widget-body waf-autoForm-body">';        for (i = 0, nb = attrList.length; i < nb; i++) {            att = atts[i];            if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                isRel = false;                if (att.type == 'image')  {                    isRel = true;                }            } else {                isRel = true;            }            html += '<tr class="waf-autoForm-row ';                if (i == 0) {                    html += 'first-child ';                }                if (i == nb - 1) {                    html += 'last-child ';                }                html += (i%2) ? 'waf-widget-even' : 'waf-widget-odd';            html += '">';            lib   = (nameList && nameList[i]) ? nameList[i] : attrList[i];            html += '<td '                if (isRel) {                    html += 'id="'+divID+'_rel'+i+'" ';                }                html += 'class="attribute-col'+ (isRel ? ' related' : '')+'"><div class="attribute-div">' + lib;                if (isRel) {                        html += '<span class="attribute-rel waf-state" data-att-id="'+i+'"></span>';                }                html += '</div>';            html += '</td>';            if (isQueryForm) {                html += '<td class="oper-col"><div class="oper-div">';                if (!isRel) {                    operinfo = options.queryData.appropriateOper(att.type);                    html += '<select id="'+ divID+ '_oper'+ i+ '" data-row-ref="' + i + '" class="oper-select" tabindex="'+ (operinfo.defaultOper+1) + '">';                        for (j = 0, nbx = operinfo.operList.length; j < nbx; j++) {                            opertext = operinfo.operList[j];                            html    += '<option value="' + (j+1) + '"';                                if (j == operinfo.defaultOper){                                    html += ' selected="selected"';                                }                            html += '>';                                html += htmlEncode(opertext, false, 4);                            html += '</option>';                        }                    html += '</select>';                    otherAttInfo[i] = {curOper : operinfo.defaultOper};                }                html += '</div></td>';            }            htmlIDName = idName(attrList[i]);            if (!isRel) {                html += '<td width="100%" class="value-col"><div class="value-div">';                html += 	'<input class="waf-inputdiv" id="' + divID + "_" + htmlIDName + '" type="text" value=""';                if (!isQueryForm && widget){                    html += ' onchange="WAF.widgets[\'' + widget.id + '\'].changeEntityAtt(\'' + htmlIDName + '\',\'' + i + '\')"';                }                if (mustResizeInputs) {                    maxinputsize = 0;                    switch(att.type) {                        case "bool":                        case "byte":                            maxinputsize = 3;                            break;                        case "word":                            maxinputsize = 4;                            break;                        case "long":                            maxinputsize = 7;                            break;                        case "long64":                        case "number":                            maxinputsize = 14;                            break;                        case "date":                        case "duration":                            maxinputsize = 12;                            break;                        case "string":                            maxinputsize = 30;                            break;                    }                    if (maxinputsize != 0) {                        html += ' style="width:'+maxinputsize+'em;"';                    }                }                html += '/>';                html += 	'<div class="errormess-div" id="' + divID + '_' + htmlIDName + '__mess"></div>';                html += '</div></td>';            } else {                html += '<td width="100%" class="value-col value-rel">';                html += 	'<div class="value-rel-div" id="' + divID + "_" + htmlIDName + '" ></div>';                html += '</td>';            }            html += '</tr>';        }        // petite ligne cachee pour aggrandir la table si necessaire        html += '<tr class="autoForm-filler" style="height:0px;">';        html += '<td class="attribute-col" style="height:0px;"><div class="attribute-div">';        html += '</div></td>';        if (isQueryForm) {            html += '<td class="oper-col" style="height:0px;"><div class="oper-div">';            html += '</div></td>';        }        html += '<td class="value-col" style="height:0px;"><div class="value-div">';        html += '</div></td>';        html += '</tr>';        // fin de la petite ligne cachee        withToolBar             = !options.noToolBar;        toolBarForRelatedEntity = false;        if (options.toolBarForRelatedEntity) {            toolBarForRelatedEntity = options.toolBarForRelatedEntity;        }        if(withToolBar) {            html += '<tfoot class="waf-widget-footer waf-autoForm-footer">';            html += 	'<tr>';            html +=         '<td colspan="'+xcol+'">';            html +=             '<div class="waf-status">';            html +=                 '<div class="waf-status-element waf-status-left"></div>';            html +=                 '<div class="waf-status-element waf-status-center"></div>';            html +=                 '<div class="waf-status-element waf-status-right"></div>';            html +=             '</div>';            html +=         '</td>';            html += 	'</tr>';            html += '</tfoot>';            if (isQueryForm) {                toolbarConfig = [                    {icon: {size: 16, type: 'radioactive'},     title: 'Clear', click: function() { if (widget) widget.clear();}},                    {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',  click: function() { if (widget) widget.findEntity();}}                ];            } else {                if (toolBarForRelatedEntity) {                    toolbarConfig = [                        {icon: {size: 16, type: 'radioactive'},     title: 'Clear', click: function() { if (widget) widget.clear();}},                        {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',  click: function() { if (widget) widget.findRel();}}                    ];                } else {                    toolbarConfig = [                        {icon: {size: 16, type: 'arrowFullLeft'},   title: 'Previous',  click: function() { if (widget) widget.prevEntity();}},                        {icon: {size: 16, type: 'arrowFullRight'},  title: 'Next',      click: function() { if (widget) widget.nextEntity();}},                        {icon: {size: 16, type: 'plus'}, text: '',  title: 'Add',       click: function() { if (widget) widget.addEntity();}},                        {icon: {size: 16, type: 'magnifyingGlass'}, title: 'Find',      click: function() { if (widget) widget.findEntity();}},                        {icon: {size: 16, type: 'floppyDisk'},      title: 'Save',      click: function() { if (widget) widget.saveEntity();}},                        {icon: {size: 16, type: 'trash'},           title: 'Delete',    click: function() { if (widget) widget.dropEntity();}}                    ];                }            }            toolbar = new WAF.widget.Toolbar(toolbarConfig);        }        html += '</table>';        htmlObject.data({            'type'     : isQueryForm ? 'queryForm' : 'autoForm',            'level'    : level        })        .addClass('waf-widget waf-autoForm')        .html(html);        attibuteRelatedIcon = new WAF.widget.Icon({            size    : 16,            type    : 'arrowSansRight',            state   : {                active      : {                    fill    : '#5e5e5e',                    rotation: 90                }            }        });        htmlObject.find('.attribute-rel').append(attibuteRelatedIcon.containerNode);        if (options.included !== false) {            htmlObject.find('tbody').css({                display         : 'block',                'overflow-x'    : 'hidden',                'overflow-y'    : (dataSource == null) ? 'hidden' : 'auto',                width           : htmlObject.width() + 'px',                height          : htmlObject.height() - htmlObject.find('thead').height() - htmlObject.find('tfoot').height() + 'px'            });        }        if(withToolBar) {            htmlObject.find('.waf-autoForm-footer .waf-status-left').append(toolbar);        }    }    for (i = 0, nbatt = attrList.length; i < nbatt; i++) {        att         = atts[i];        sourceAtt   = sourceAtts[i];        if((att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") && att.type != 'image') {            objID   = '';            htmlobj = null;            if (typeof sourceAtt !== 'undefined') {                objID   = divID + "_" + idName(sourceAtt.name);                htmlobj = $('#' + objID)[0];            }            if (htmlobj) {                htmlobj.isInFocus           = false;                htmlobj.att                 = att;                htmlobj.format              = att.defaultFormat;                htmlobj.source              = dataSource;                htmlobj.getFormattedValue   = widget.getFormattedValue;                htmlobj.sourceAtt           = sourceAtts[i];                htmlobj.isTextInput         = true;                if (!isQueryForm) {                    $(htmlobj).focus(function(event) {                        this.isInFocus   = true;                        if (this.format != null && this.format.format != null) {                            this.value = this.sourceAtt.getValueForInput();                        }                    });                    $(htmlobj).blur(function(event) {                        this.isInFocus = false;                        if (this.format != null && this.format.format != null) {                            this.value = this.getFormattedValue();                        }                    });                }                enumValueList   = [];                items           = null;                if (att.enumeration != null && !att.readOnly && !sourceAtt.readOnly) {                    items = att.enumeration.item;                    for (j = 0, nb = items.length; j < nb; j++) {                        enumValueList.push(items[j].name);                    }                }                if (enumValueList.length > 0) {                    $(htmlobj)                    .data('enumValueList', enumValueList)                    .autocomplete({                        source: function(request, response) {                            response($.grep($(this.element.context).data('enumValueList'), function(item, index) {                                return item.toLowerCase().indexOf(request.term.toLowerCase()) === 0;                            }));                        }                    })                    .autocomplete('widget')                    .addClass(dataTheme);                    if (!isQueryForm) {                        $(htmlobj).blur(function(event) {                            var                            sourceAtt;                            sourceAtt = this.sourceAtt;                            if (this.value !== sourceAtt.getValue()) {                                sourceAtt.setValue(this.value, {dispatcherID:divID});                            }                        });                    }                } else if (att.autoComplete) {                    $(htmlobj)                    .autocomplete({                        source: function(request, response) {                            $.ajax({                                url: 'rest/' + dataClass.getName() + '/' + this.element.context.att.name + '?$distinct=true&$top=20',                                data: {                                    '$filter': '"' + this.element.context.att.name + '=\'' + request.term + '@\'"'                                },                                success: function(data) {                                    response($.map(data, function(item) {                                        return {                                            value: item                                        }                                    }));                                }                            });                        }                    })                    .autocomplete('widget')                    .addClass(dataTheme);                    if (!isQueryForm) {                        $(htmlobj).blur(function(event) {                            var                            sourceAtt;                            sourceAtt = this.sourceAtt;                            if (this.value !== sourceAtt.getValue()) {                                sourceAtt.setValue(this.value, {dispatcherID:divID});                            }                        });                    }                } else {                    if (att.type == 'date') {                        $(htmlobj)                        .datepicker({							buttonImageOnly: false,							showOn: "focus"						})                        .datepicker('widget')                        .addClass(dataTheme);                    }                }            }        }    }    if (typeof (otherAttInfo) === "undefined"){        otherAttInfo = null;    }    if (widget) {        widget.withToolBar                  = withToolBar;        widget.attList                      = attrList;        widget.atts                         = atts;        widget.sourceAtts                   = sourceAtts;        widget.otherAttInfo                 = otherAttInfo;        widget.checkIdentifying             = checkIdentifying;        widget.allReadOnly                  = allReadOnly;        widget.dataClass                    = dataClass;        widget.source                       = dataSource;        widget.divID                        = divID;        widget.kind                         = 'autoForm';        widget.attList                      = attrList;        widget.atts                         = atts;        widget.sourceAtts                   = sourceAtts;        widget.relForms                     = {};        widget.relGrids                     = {};        widget.relSources                   = {};        widget.imgAreas                     = {};        widget.subWidgets                   = subWidgets;        widget.withTitle                    = withTitle;        widget.withToolBar                  = withToolBar;        widget.withoutTable                 = withoutTable;        widget.headerDom                    = headerDom;        widget.bodyDom                      = bodyDom;        widget.footerDom                    = footerDom;        widget.allowResizeInput             = allowResizeInput;        widget.toolBarForRelatedEntity      = toolBarForRelatedEntity;        widget.level                        = level;        widget.parent                       = options.parent;        widget.isQueryForm                  = isQueryForm;        widget.otherAttInfo                 = otherAttInfo;        widget.dataTheme                    = dataTheme;        widget.mustDisplayError             = mustDisplayError;        widget.onError                      = null;        widget.kill                         = function() {            var            fName;            for (fName in this.relForms) {                this.relForms[fName].kill();            }            for (fName in this.relGrids) {                this.relGrids[fName].grid.kill();            }            $('#' + this.divID).html("");        }    }    result = widget;    if (widget) {        widget.setErrorDiv(errorDiv);    }    if (dataSource != null)  {        if (isQueryForm){            dataSource.addListener("onCollectionChange", function(e) {                widget.drawStatus();            }, {                listenerID: divID,                listenerType:'form'            });        } else {            dataSource.addListener("all", function(e){                var                form,                domobj,                sourceAtt;                form = e.data.form;                if (e.eventKind == 'onCurrentElementChange' || e.eventKind == 'onCollectionChange')  {					if (!widget.withoutTable)					{	                    if (form.source.getCurrentElement() == null) {	                        form.clear();	                    } else {	                        form.fill();	                    }					}                } else  if (e.eventKind == "onAttributeChange")  {                    domobj = document.getElementById(form.id + "_" + idName(e.attributeName));                    if (domobj != null) {                        sourceAtt = e.attribute;                        if (sourceAtt.simple) {                            if (domobj.isInFocus) {                                domobj.value = sourceAtt.getValueForInput(); //form.source[notifyEvent.attName];                            } else {                                domobj.value = domobj.getFormattedValue();                            }                        }                    }                }            }, {listenerID: divID, listenerType:'form'}, {form:result});        }    }    if (!isQueryForm && dataSource) {        dataSource.dispatch('onCurrentElementChange');    }    return result;}/** * Format a name * @method idName * @param {string} text : text to format * @return  {string} formatted text */function idName(text) {    return text.split(".").join("_");}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/autoForm/widget-autoForm-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'autoForm',    lib        : 'WAF',    description: 'Auto Form',    category   : 'Utilities',    img        : '/walib/WAF/widget/autoForm/icons/widget-autoForm.png',    tag        : 'div',    attributes : [    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'data-columns',        description: 'Columns',        type       : 'textarea'    },    {        name       : 'class',        description: 'Css class'    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox'    },    {        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox'    },    {        name        : 'data-display-error',        description : 'Display error',        type        : 'checkbox',        category    : 'Error Handling',        defaultValue: 'true'    },    {        name        : 'data-errorDiv',        description : 'Placeholder for error description',        category    : 'Error Handling'    },    {        name        : 'data-error-div',        visibility  : 'hidden'    },    {        name        : 'data-withoutTable',        description : 'With included widgets',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'data-resize-each-widget',        description : 'Allow resizing of each widget',        type        : 'checkbox',        defaultValue: 'true'    },	{		name        : 'data-resize-optimal-each-widget',		description : 'Auto fit widgets',        type        : 'checkbox',        defaultValue: 'true'	},    {        name        : 'data-column-attribute',        description : 'Column attribute'    },    {        name        : 'data-column-name',        description : 'Column name'    },    {        name            : 'data-column',        description     : 'Rows',        type            : 'grid',        defaultValue    : '[]',        reloadOnChange  : true,        beforeReady     : function(){            var            i,            tag,            json,            colName,            colAttribute;            tag = this.data.tag;            if (tag.getAttribute('data-column-name') && tag.getAttribute('data-column-attribute')) {                colName         = tag.getAttribute('data-column-name').getValue().split(',');                colAttribute    = tag.getAttribute('data-column-attribute').getValue().split(',');                json            = [];                for (i in colName) {                    if (colName[i] != '') {                        json.push({                            'title'         : colName[i],                            'sourceAttID'   : colAttribute[i]                        });                    }                }            }            this.json = json;            /*             * Hide form if no source binded             */            if (!tag.getSource()) {                this.getForm().hide();            }        },        afterRowAdd    : function(data) {            /*             * Add row with first datasource attribute             */            var            tag,            dsObject,            attributes,            firstAttribute;            tag = this.data.tag;            dsObject = Designer.env.ds.catalog.getByName(tag.getSource());            if (dsObject && dsObject.getType().match( new RegExp('(array)|(object)') )) {                attributes = dsObject.getTag().getAttribute('data-attributes').getValue().split(',');                firstAttribute = attributes[0].split(':')[0];            } else if (dsObject){                attributes = dsObject.getAttributes();                if (attributes[0]) {                    firstAttribute = attributes[0].name;                }            }            if (data.items[0].getValue() == '' && data.items[1].getValue() == '') {                data.items[0].setValue(firstAttribute);                data.items[1].setValue(firstAttribute);            }        },        columns         : [{            title       : 'label',            name        : 'title',            type        : 'textfield'        },{            title       : 'attribute',            name        : 'sourceAttID',            type        : 'textfield',            typeValue   : 'dataSource',            onblur      : function() {                var                tag,                valid,                htmlObject,                attributeName;                tag         = this.data.tag;                htmlObject  = this.getHtmlObject();                /*                 * Check if attribute is valid                 */                attributeName = this.getValue();                valid = Designer.ds.isPathValid(tag.getSource() + '.' + attributeName);                if (!valid) {                    htmlObject.addClass('studio-form-invalid');                } else {                    htmlObject.removeClass('studio-form-invalid');                }            },            onfocus     : function(){                this.data.attID = this.getValue();            }        }],        onsave          : function(data) {            var            tag,            name,            attribute,            colNames,            colAttributes;            try {                tag             = data.tag;                colNames        = [];                colAttributes   = [];                /*                 * Get new rows                 */                $.each(data.value.rows, function() {                    name = this[0].value;                    attribute = this[1].value;                    if (name != '' && attribute != '') {                        colNames.push(name);                        colAttributes.push(attribute);                    }                });                //tag.getAttribute                if (colNames.length > 0 && colAttributes.length > 0) {                    tag.setAttribute('data-column-name', colNames.join(','));                    tag.setAttribute('data-column-attribute', colAttributes.join(','));                }            } catch(e) {                console.log(e);            }        }    }    ],    events: [    {        name       : 'onError',        description: 'On Error Handler',        category   : 'Form Events'    },    {        name        : 'startResize',        description : 'On Start Resize',        category    : 'Resize'    },    {        name        : 'onResize',        description : 'On Resize',        category    : 'Resize'    },    {        name        : 'stopResize',        description : 'On Stop Resize',        category    : 'Resize'    }    ],    style      : [    {        name        : 'width',        defaultValue: '250px'    },    {        name        : 'height',        defaultValue: '250px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : false,            shadow      : true,            disabled    : ['border-radius']        }    },    structure: [{        description : 'header',        selector    : '.waf-widget-header',        style: {            text        : true,            textShadow  : true,            background  : true,            border      : true,            disabled    : ['border-radius']        }    },{        description : 'body',        selector    : '.waf-widget-body',        style: {            text        : true,            textShadow  : true,            background  : true,            disabled    : ['border-radius']        }    },{        description : 'footer',        selector    : '.waf-widget-footer',        style: {            text        : true,            textShadow  : true,            background  : true,            disabled    : ['border-radius']        }    }],    onInit: function (config) {        new WAF.widget.AutoForm(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        attrList,        nameList,        htmlObject,        height,        width,        options,        borderSize;        attrList    = [];        nameList    = [];        htmlObject  = tag.getHtmlObject();        options     = {};        if(!isResize){            // Getting the names list            if (tag.getAttribute('data-column-name') && tag.getAttribute('data-column-name').getValue() != '') {                nameList = tag.getAttribute('data-column-name').getValue().split(',');            }            // Getting the attributes list            if (tag.getAttribute('data-column-attribute') && tag.getAttribute('data-column-attribute').getValue() != '') {                attrList = tag.getAttribute('data-column-attribute').getValue().split(',');            }            if (tag.getAttribute('data-columns') && tag.getAttribute('data-columns').getValue() != '' && !tag.getAttribute('data-column-name')) {                attrList = tag.getAttribute('data-columns').getValue().split(',');                nameList = tag.getAttribute('data-columns').getValue().split(',');            }            tag.resize.on('endResize', function(evt) {                setTimeout('Designer.env.tag.current.onDesign(true)', 100);            });            if (tag.getAttribute('data-withoutTable') && tag.getAttribute('data-withoutTable').getValue() === "true") {                options.withoutTable = true;            }            if (tag.getAttribute('data-resize-each-widget') && tag.getAttribute('data-resize-each-widget').getValue() === "true"){                options.allowResizeInput = true;            }            WAF.AF.buildForm(tag.getAttribute('id').getValue(), null, attrList, nameList, options, catalog, tag);            // message if not binding            if (nameList.length === 0) {                if ($('#' + tag.overlay.id + ' .message-binding-autoform').length == 0  && !config['data-binding']) {                    $('<div class="message-binding-autoform">Drop a datasource<br> here</div>').appendTo($('#' + tag.overlay.id));                } else if (config['data-binding']){                    $(tag.overlay.element).find('.message-binding-autoform').each(function(i) {                        $(this).remove();                    });                }            } else {                $(tag.overlay.element).find('.message-binding-autoform').each(function(i) {                    $(this).remove();                });            }        } else {            /*             * Resize body of the autoform             */            width       = htmlObject.get();            height      = htmlObject.height();            borderSize  = parseInt(tag.getComputedStyle('border-width', '.waf-widget-header')) + parseInt(tag.getComputedStyle('border-width'))            htmlObject.find('.waf-widget-body').css({                width   : width + 'px',                height  : height - htmlObject.find('.waf-widget-header').height() - htmlObject.find('.waf-widget-footer').height() - borderSize + 'px'            });        }        /*         * Remove scrollbar on design         */        htmlObject.find('.waf-widget-body').css('overflow', 'hidden !important');    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/queryForm/widget-queryForm.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//* * AUTOFORM USING WIDGET'S PROVIDE */WAF.Widget.provide(    'QueryForm',    {    },    function WAFWidget(config, data, shared) {        var        source,        nameList,        attrList,        mustDisplayError,        divID,        options,        htmlObject;        htmlObject          = $(this.containerNode);        source              = WAF.source[config['data-binding']];        nameList            = [];        attrList            = [];        mustDisplayError    = config['data-display-error'];        divID               = config['id'];        options             = {};        if (mustDisplayError == null) {            mustDisplayError = true;        } else {            mustDisplayError = (mustDisplayError == '1' || mustDisplayError == 'true');        }        options.mustDisplayError    = mustDisplayError;        options.isQueryForm         = true;        options.queryData           = this.queryData = config.queryData;        if (source != null) {            /*             * Getting the names list             */            if(data['column-name']) {                nameList = data['column-name'].split(',')            }            /*             * Getting the attributes list             */            if(data['column-attribute']) {                attrList = data['column-attribute'].split(',')            }            if (data['columns'] != null && data['columns'] != '' && !data['column-name'] ) {                attrList = data['columns'].split(',');                nameList = data['columns'].split(',');            }            /*             * Call queryform build method             */            WAF.AF.buildForm(divID, source, attrList, nameList, options);            /*             * DEPRECATED AFTER REFACTORING             */            WAF.widgets[this.id] = this;        /*         * Display a message to indicate that the widget is not binded         */        } else {            htmlObject.addClass('waf-autoForm')            $('<div class="waf-autoForm-missingBinding" style="top:20px;">Datasource is either missing <br>or <br>invalid</div>').appendTo(htmlObject);        }        if (data.draggable == 'true') {            htmlObject.find('.waf-widget-header,.waf-widget-footer').css('cursor', 'pointer');        }    }, {        /*         * Resize method called during resize         * @method onResize         */        onResize : function queryform_resize() {            var            width,            height,            newHeight,            htmlObject;            /*             * Resize autoform body             */            htmlObject  = $(this.containerNode);            width       = htmlObject.width();            height      = htmlObject.height();            newHeight   = height - parseInt(htmlObject.find('.waf-widget-footer').css('height'));            newHeight  -= parseInt(htmlObject.find('.waf-widget-header').css('height'));            htmlObject.find('.waf-widget-body').css('width', width);            htmlObject.find('.waf-widget-body').css('height',  newHeight + 'px');        },        /*         * Resize method called on stop resize         * @method onResize         */        stopResize : function queryform_stop_resize() {        },        /*         * Clear the queryform content         * @method clear         */        clear   : function queryform_clear() {            var            i,            attList,            att,            xLength;            attList = this.attList;            this.purgeErrorMessagesOnForm();            for (i = 0; i < attList.length; i++) {                att = this.atts[i];                if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias"){                    document.getElementById(this.id + "_" + idName(attList[i])).value = "";                }            }            if (this.withToolBar) {                xLength = this.source.length;                $('#' + this.id + ' .waf-status-right').html(xLength);            }        },        /*         * Fill the queryform content         * @method fill         */        fill : function queryform_fill() {            var            eset,            xLength;            this.purgeErrorMessagesOnForm();            if (this.withToolBar)  {                eset    = this.source.getEntityCollection();                xLength = (eset != null) ? eset.length : 0;                $('#' + this.id + ' .waf-status-right').html(xLength);            }        },        /*         * Draw the status(pager) of the queryform in the footer         * @method drawStatud         */        drawStatus : function queryform_draw_status() {            var            xLength;            xLength = this.source.length;            $('#' + this.id + ' .waf-status-right').html(xLength);        },        /*         * Find an entity         * @method findEntity         */        findEntity : function queryform_find_entity() {            var            i,            queryString,            attList,            val,            oper,            objoper;            if (this.source) {                queryString = "";                attList     = this.attList;                for (i = 0; i < attList.length; i++) {                    val = document.getElementById(this.id + "_" + idName(attList[i])).value;                    if (val != null && val != "") {                        if (queryString != "") {                            queryString += " and ";                        }                        oper    = 0;                        objoper = document.getElementById(this.id + "_oper" + i);                        if (objoper != null) {                            oper = parseInt(objoper.value) - 1;                        }                        this.otherAttInfo[i].curOper = oper;                        queryString += this.queryData.buildQueryNode(this.atts[i].name, this.atts[i].type, oper, val);                    }                }                this.source.query(queryString);            }        },        /*         * Purge error message         * @method purgeErrorMessagesOnForm         */        purgeErrorMessagesOnForm : function queryform_purge_error_messages_on_form() {            var            i,            divID,            attList,            att,            sourceAtt,            objDiv,            messDivName,            attName;            divID   = this.id;            attList = this.attList;            for (i = 0; i < attList.length; i++) {                att         = this.atts[i];                sourceAtt   = this.sourceAtts[i];                objDiv      = document.getElementById(divID + "_" + idName(attList[i]));                if (objDiv != null) {                    if (sourceAtt.readOnly || att.readOnly || (this.checkIdentifying && !att.identifying) || this.allReadOnly){                        objDiv.disabled = true;                    } else {                        objDiv.disabled = false;                    }                }                if (att.kind == "storage" || att.kind == "calculated" || att.kind == "alias") {                    attName     = idName(sourceAtt.name);                    messDivName = divID + "_" + attName + "__mess";                    $('#' + divID + "_" + attName).parent().removeClass('AF_ValueWrong');                    $('#' + divID + "_" + attName).parent().addClass('AF_ValueOK');                    $('#' + messDivName).parent().removeClass('AF_messWrong');                    $('#' + messDivName).removeClass('AF_markedWrong');                    $('#' + messDivName).html("");                }            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/queryForm/widget-queryForm-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'queryForm',    lib        : 'WAF',    description: 'Query Form',    category   : 'Utilities',    img        : '/walib/WAF/widget/queryForm/icons/widget-queryForm.png',    tag        : 'div',    attributes : [    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'data-columns',        description: 'Columns',        type       : 'textarea'    },    {        name	    : 'data-withoper',        description : 'Show Operators',        type        : 'checkbox'    },    {        name       : 'class',        description: 'Css class'    },{        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox'    },    {        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox'    },    {        name        : 'data-column-attribute',        description : 'Column attribute'    },    {        name        : 'data-column-name',        description : 'Column name'    },    {        name            : 'data-column',        description     : 'Rows',        type            : 'grid',        defaultValue    : '[]',        reloadOnChange  : true,        newRowEmpty     : false,        beforeReady     : function(){            var            i,            tag,            json,            colName,            colAttribute;            tag = this.data.tag;            if (tag.getAttribute('data-column-name') && tag.getAttribute('data-column-attribute')) {                colName         = tag.getAttribute('data-column-name').getValue().split(',');                colAttribute    = tag.getAttribute('data-column-attribute').getValue().split(',');                json            = [];                for (i in colName) {                    if (colName[i] != '') {                        json.push({                            'title'         : colName[i],                            'sourceAttID'   : colAttribute[i]                        });                    }                }            }            this.json = json;            /*             * Hide form if no source binded             */            if (!tag.getSource()) {                this.getForm().hide();            }        },        columns         : [{            title       : 'label',            name        : 'title',            type        : 'textfield'        },{            title       : 'attribute',            name        : 'sourceAttID',            type        : 'textfield',            typeValue   : 'dataSource',            onblur      : function() {                var                tag,                valid,                htmlObject,                attributeName;                tag         = this.data.tag;                htmlObject  = this.getHtmlObject();                /*                 * Check if attribute is valid                 */                attributeName = this.getValue();                valid = Designer.ds.isPathValid(tag.getSource() + '.' + attributeName);                if (!valid) {                    htmlObject.addClass('studio-form-invalid');                } else {                    htmlObject.removeClass('studio-form-invalid');                }            },            onfocus     : function(){                this.data.attID = this.getValue();            }        }],        onsave          : function(data) {            var            tag,            name,            attribute,            colNames,            colAttributes;            try {                tag             = data.tag;                colNames        = [];                colAttributes   = [];                /*                 * Get new rows                 */                $.each(data.value.rows, function() {                    name = this[0].value;                    attribute = this[1].value;                    if (name != '' && attribute != '') {                        colNames.push(name);                        colAttributes.push(attribute);                    }                });                //tag.getAttribute                if (colNames.length > 0 && colAttributes.length > 0) {                    tag.setAttribute('data-column-name', colNames.join(','));                    tag.setAttribute('data-column-attribute', colAttributes.join(','));                }            } catch(e) {                console.log(e);            }        }    }],    style      : [    {        name        : 'width',        defaultValue: '250px'    },    {        name        : 'height',        defaultValue: '150px'    }],    events: [    {        name        : 'startResize',        description : 'On Start Resize',        category    : 'Resize'    },    {        name        : 'onResize',        description : 'On Resize',        category    : 'Resize'    },    {        name        : 'stopResize',        description : 'On Stop Resize',        category    : 'Resize'    }    ],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            shadow      : true,            label       : false,            disabled    : ['border-radius']        }    },    structure: [{        description : 'header',        selector    : '.waf-widget-header',        style: {            text        : true,            textShadow  : true,            background  : true,            border      : true,            disabled    : ['border-radius']        }    },{        description : 'body',        selector    : '.waf-widget-body',        style: {            text        : true,            textShadow  : true,            background  : true,            disabled    : ['border-radius']        }    },{        description : 'footer',        selector    : '.waf-widget-footer',        style: {            text        : true,            textShadow  : true,            background  : true,            disabled    : ['border-radius']        }    }],    onInit: function (config) {        config.queryData = this.queryData;        new WAF.widget.QueryForm(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        attrList,        nameList,        elt,        options;        attrList    = [],        nameList    = [],        elt         = document.getElementById(tag.getAttribute('id').getValue());        options     = {            isQueryForm : true,            queryData   : tag._config.queryData        }        // elt.setAttribute('class', '');        elt.setAttribute('class', 'waf-widget waf-autoForm ');        // Setting the theme        if (tag.getTheme()) {            $('#' + tag.getAttribute('id').getValue()).addClass(tag.getTheme());        }        if (tag.getAttribute('class')) {            $('#' + tag.getAttribute('id').getValue()).addClass(tag.getAttribute('class').getValue().replace(',', ' '));        }        if(!isResize){            // Getting the names list            if(tag.getAttribute('data-column-name') && tag.getAttribute('data-column-name').getValue() != '') {                nameList = tag.getAttribute('data-column-name').getValue().split(',');            }            // Getting the attributes list            if(tag.getAttribute('data-column-attribute') && tag.getAttribute('data-column-attribute').getValue() != '') {                attrList = tag.getAttribute('data-column-attribute').getValue().split(',');            }            if (tag.getAttribute('data-columns') && tag.getAttribute('data-columns').getValue() != '' && !tag.getAttribute('data-column-name')) {                attrList = tag.getAttribute('data-columns').getValue().split(',');                nameList = tag.getAttribute('data-columns').getValue().split(',');            }            tag.resize.on('endResize', function(evt) {                setTimeout('Designer.env.tag.current.onDesign(true)', 100);            });            WAF.AF.buildForm(tag.getAttribute('id').getValue(), null, attrList, nameList, options, catalog, tag);            // message if not binding            if (nameList.length === 0  && !config['data-binding']) {                if ($('#' + tag.overlay.id + ' .message-binding-queryform').length == 0) {                    $('<div class="message-binding-queryform">Drop a datasource<br> here</div>').appendTo($('#' + tag.overlay.id));                }            } else {                $(tag.overlay.element).find('.message-binding-queryform').each(function(i) {                    $(this).remove();                });            }        } else {            $(elt).find('tbody').css({                width: $(elt).width() + 'px',                height: $(elt).height() - $(elt).find('thead').height() - $(elt).find('tfoot').height() + 'px'            });        }    },    queryData : {        wildchar                    : WAF.wildchar,        stringOpers                 : [            "begins with",            "=",            "!=",            ">",            ">=",            "<",            "<=",            "contains", // 7            "contains keyword" // 8        ],        stringOper_begin_with       : 0,        stringOper_contains         : 7,        stringOper_contains_keyword : 8,        numberOpers                 : [            "=",            "!=",            ">",            ">=",            "<",            "<=",            "between" // 6        ],        numberOper_between          : 6,        dateOpers                   : [            "=",            "!=",            ">",            ">=",            "<",            "<=",            "between"	// 6        ],        dateOper_between            : 6,        appropriateOper             : function(type) {            var            result;            result = {};            switch(type) {                case "number":                case "long":                case "byte":                case "word":                case "long64":                    result.operList = this.numberOpers;                    result.defaultOper = 0;                    break;                case "date":                    result.operList = this.dateOpers;                    result.defaultOper = 0;                    break;                default:                    result.operList = this.stringOpers;                    result.defaultOper = 0;                    break;            }            return result;        },        buildQueryNode              : function (attName, attType, oper, value) {            var            a,            result,            opertext;            result = "";            switch(attType) {                case "number":                case "long":                case "byte":                case "word":                case "long64":                    if (oper == this.numberOper_between) {                        a = value.split(',');                        if (a.length > 1) {                            result += '( ' + attName + ' >= ' + a[0] + ' and ' + attName + ' <= ' + a[1] + ' )';                        } else {                            result += attName + ' ' + this.numberOpers[oper] + ' '+ value;                        }                    } else {                        result += attName + ' ' + this.numberOpers[oper] + ' ' + value;                    }                    break;                case "date":                    if (oper == this.dateOper_between) {                        a = value.split(',');                        if (a.length > 1) {                                result += '( ' + attName + ' >= "' + a[0] + '" and ' + attName + ' <= "'+a[1]+'" )';                        } else {                                result += attName + ' ' + this.dateOpers[oper] + ' ' + '"' + value + '"';                        }                    } else {                            result += attName + ' ' + this.dateOpers[oper] + ' ' + '"' + value +'"';                    }                    break;                default:                    opertext = this.stringOpers[oper];                    switch(oper) {                        case this.stringOper_begin_with:                            opertext = '=';                            value = '"' + value + this.wildchar + '"';                            break;                        case this.stringOper_contains:                            opertext = '=';                            value = '"' + this.wildchar + value + this.wildchar + '"';                            break;                        case this.stringOper_contains_keyword:                            opertext = '%';                            break;                        default:                            value = '"' + value + '"';                            break;                    }                    result += attName + ' ' + opertext + ' ' + value;                    break;            }            return result;        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/image/widget-image.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Image',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        that,        xsrc,        txtHtml,        txtHmlImg,        htmlImg,        htmlObject,        sourceAtt;        that        = this;        htmlObject  = $(this.containerNode);        xsrc        = data.src;        sourceAtt   = this.sourceAtt;        if (xsrc == null || xsrc == "") {            xsrc = this._empty;        }        txtHmlImg = '<img src="' + xsrc + '" />';        /*         * IMAGE NAVIGATION         */        if (data.link) {            txtHtml = '<a href="' + data.link + '" target="' + data.target + '">' + txtHmlImg + '</a>';            htmlObject.removeAttr('data-link');        } else {            txtHtml = txtHmlImg;        }        htmlObject.html(txtHtml);        htmlImg = htmlObject.find('img');        /*         * For binded image         */        if (sourceAtt) {            sourceAtt.addListener(function(e) {                var                url;                url = e.data.widget.getFormattedValue();                if (url == null || url == "") {                    url = "/walib/WAF/widget/css/images/emptyImage.png";                }                htmlImg.attr('src', url);            },{                listenerID      : config.id,                listenerType    : 'image',                subID           : config.subID ? config.subID : null            }, {                widget:this            });            /*             * Useful when matrix is resized             */            if (this.source.getPosition() != -1) {                this.source.getElement(this.source.getPosition(), {                    onSuccess:function(e) {                        var                        value;                        value = sourceAtt.getValue();                        if (value) {                            if (value.__deferred) {                                htmlImg.attr('src', value.__deferred.uri);                            } else {                                htmlImg.attr('src', value);                            }                        }                    }                })            }        }        that.refresh();    },{        _empty : '/walib/WAF/widget/css/images/emptyImage.png',        /**         * Custom getValue function         * @method getValue         * @return {string} value         */         getValue : function image_get_value () {            return this.$domNode.children()[0].src;         },        /**         * Custom setValue function         * @method setValue         * @param {string} value         */         setValue : function image_set_value (value) {            this.$domNode.children()[0].src = value;         },        /**         * Custom clear function         * @method         */         clear : function image_clear (argument) {            this.$domNode.find('img').attr('src', this._empty);         },        /**         * Refresh the image widget         * @method refresh         */        refresh : function image_refresh () {            var            imgWidth,            imgHeight,            padding,            alignType,            thisHeight,            thisWidth,            htmlImg,            htmlObject;            htmlObject  = $(this.containerNode);            htmlImg     = htmlObject.find('img');            /*             * Resize image             */            switch (this.config['data-fit']) {                case '0':                    htmlImg.width('100%').height('100%');                    break;                case '1':                    htmlImg.width('100%');                    break;                case '2':                    htmlImg.height('100%');                    break;                case '4':                    thisHeight  = parseInt(htmlObject.css('height'));                    thisWidth   = parseInt(htmlObject.css('width'));                    htmlImg.css({                        'max-width'     : thisWidth + 'px',                        'max-height'    : thisHeight + 'px'                    });                    htmlObject.prop('align', 'center');                    htmlObject.css({                        'line-height' : htmlObject.css('height')                    });                    htmlImg.css({                        'vertical-align'    : 'middle',                        'display'           : 'inline-block'                    });                    break;                case '3':                default :                    htmlImg.load(function() {                        var                        htmlImg;                        htmlImg = $(this);                        htmlObject.css({                            width   : htmlImg.width() + 'px',                            height  : htmlImg.height() + 'px'                        });                    });                    break;            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/image/widget-image-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'image',    lib        : 'WAF',    description: 'Image',    category   : 'Misc. Controls',    img        : '/walib/WAF/widget/image/icons/widget-image.png',    attributes : [    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-src',        description: 'Src',        type       : 'file',        accept     : 'image/*'    },    {        name        : 'data-link',        description : 'Link'    },    {        name        : 'data-target',        description : 'Target',        type        : 'dropdown',        options     : ['_blank', '_self'],        defaultValue: '_blank'    },    {        name       : 'data-label',        description: 'Label',        defaultValue: ''    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-fit',        description : 'Fit',        type        : 'dropdown',        options     : [{            key : '0',            value : 'to container'        },{            key : '4',            value : 'to container (proportionately)'        },{            key : '1',            value : 'to width'        },{            key : '2',            value : 'to height'        },{            key : '3',            value : 'container to image'        }],        defaultValue: '0'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    style: [    {        name        : 'width',        defaultValue: '85px'    },    {        name        : 'height',        defaultValue: '80px'    }],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : true,            shadow      : true,            disabled    : ['border-radius']        }    },    onInit: function (config) {        var image = new WAF.widget.Image(config);        return image;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        htmlObject,        canvasId = "canvas" + tag.getId(),        width = tag.getWidth(),        height = tag.getHeight(),        thisWidth = '',        thisHeight = '',        path = '',        url = '',        img = {},        myFile = {},        cnt = {},        canBeDisplay = false;        path = Designer.env.project.path;        if (tag.getAttribute('data-src').getValue()) {            path = Designer.util.cleanPath(tag.getAttribute('data-src').getValue().replace('/', ''));            url = path.fullPath;        }        if (typeof(studio) != 'undefined' && url) {            myFile = studio.File(url);        }        htmlObject = tag.getHtmlObject();        //url = 'http://kpitalrisk.free.fr/images/stars/17000/s_toto1.jpg'        //myFile.exists = true;        // Display binding image        if (!url || !myFile.exists) {            $('#' + tag.getId()).html(' <canvas class="' + canvasId + '" width="' + width + 'px" height="' + height + 'px"></canvas>');            var canvas = $('.' + canvasId)[0];            var ctx = canvas.getContext("2d");            ctx.fillStyle = "rgb(200,0,0)";            ctx.fillRect(0, 0, width / 2, height / 2);            ctx.fillStyle = "rgba(0, 50, 200, 0.5)";            ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);        } else { // Display the real img if src is filling            document.getElementById(tag.getAttribute('id').getValue()).innerHTML = '<img src="' + url + '" class="' + canvasId + '" />';            img = $('.' + canvasId)[0];            canBeDisplay = true;            htmlObject.prop('align', 'left');            htmlObject.css('padding-top', '0px');            if (canBeDisplay) {                // Dynamic resizing of the image and his overlay                switch (tag.getAttribute('data-fit').getValue()) {                    case '0':                        thisWidth = tag.tmpWidth = tag.style.width;                        thisHeight = tag.tmpHeight = tag.style.height;                        $(img).width('100%').height('100%');                        tag.setWidth(thisWidth, false);                        tag.setHeight(thisHeight, false);                        break;                    case '1':                        thisWidth = tag.tmpWidth = tag.style.width;                        $(img).width('100%');                        tag.setWidth(thisWidth, false);                        break;                    case '2':                        thisHeight = tag.tmpHeight = tag.style.height;                        $(img).height('100%');                        tag.setHeight(thisHeight, false);                        break;                    case '3':                        thisHeight = parseInt(tag.style.height);                        thisWidth = parseInt(tag.style.width);                        tag._tagImg = img;                        img.onload = function() {                            if (img.width !== 0) {                                thisWidth = img.width;                            }                            if (img.height !== 0) {                                thisHeight = img.height;                            }                            thisWidth += parseInt(tag.getComputedStyle('borderLeftWidth')) + parseInt(tag.getComputedStyle('borderRightWidth'));                            thisHeight += parseInt(tag.getComputedStyle('borderTopWidth')) +  parseInt(tag.getComputedStyle('borderBottomWidth'));                            $('#' + tag.getId()).parent().css('height', thisHeight + 'px');                            tag.setWidth(thisWidth, false);                            tag.setHeight(thisHeight, false);                        };                        break;                    case '4':                        /*                         * Get the hightest size                         */                        thisHeight = parseInt(tag.style.height);                        thisWidth = parseInt(tag.style.width);                        img.onload = function() {                            var                            imgWidth,                            alignType,                            padding,                            imgHeight;                            if (img.width !== 0) {                                imgWidth = img.width;                            }                            if (img.height !== 0) {                                imgHeight = img.height;                            }                            if (imgHeight < imgWidth) {                                $(img).width('100%');                                alignType = '1';                                if (img.height > thisHeight) {                                    alignType = '2';                                    $(img).height('100%');                                    $(img).width('auto');                                }                            } else {                                $(img).height('100%');                                alignType = '2';                                if (img.width > thisWidth) {                                    alignType = '1';                                    $(img).width('100%');                                    $(img).height('auto');                                }                            }                            imgWidth = img.width;                            imgHeight = img.height;                            htmlObject.prop('align', 'center');                            padding = (alignType === '1') ? (thisHeight - imgHeight) / 2 : 0;                            htmlObject.css('padding-top', padding + 'px');                        }                        break;                }                Designer.ui.form.Style.refreshPosition();            }        }        tag.tmpSrc = tag.getAttribute('data-src').getValue();    },    onCreate : function (tag, param) {        /*         * Widget custom on file drop event         * Set path         */        $(tag).bind('onFileDrop', function(e, data) {            var            tag,            ext;            tag = this;            ext = data.file.extension.toLowerCase();            switch(ext) {                case 'png'  :                case 'jpg'  :                case 'jpeg' :                case 'gif'  :                case 'ico'  :                    tag.getAttribute('data-src').setValue(data.path.cropedPath);                    /*                     * Set focus                     */                    tag.setCurrent();                    tag.onDesign(true);                    tag.domUpdate();                    D.tag.refreshPanels();                    break;            }        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/label/widget-label.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Label',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        htmlObject,        forAttr,        minWidth;        htmlObject  = $(this.containerNode);        minWidth    = parseInt(htmlObject.css('min-width'));        /*         * Remove label if for is unvalid         */        forAttr     = htmlObject.prop('for');        if (forAttr) {            if ($('#' + htmlObject.prop('for')).length === 0) {                htmlObject.remove();            }        } else {            htmlObject.remove();        }        if (minWidth === 0) {            //htmlObject.css('width', 'auto');        }    }, {        ready : function () {            this.linkedWidget = $$(this.$domNode.prop('for'));            /*             * Hide label on load if associated widget is hidden             */            if (this.linkedWidget && this.linkedWidget.$domNode && this.linkedWidget.$domNode.attr('data-hideonload') === 'true') {                this.hide();            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/label/widget-label-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'label',    lib         : 'WAF',    description : 'Label',    category    : 'Hidden',    tag         : 'label',    attributes  : [    {        name : 'data-text'    },    {        name : 'data-linked' // DEPRECATED    },    {        name : 'for'    },    {        name: 'data-valign',        defaultValue: 'middle'    },    {        name: 'data-margin',        defaultValue: '5'    }],    style       : [    {        name        : 'width',        defaultValue: '75px'    },    {        name        : 'height',        defaultValue: '22px'    }],    onInit: function (config) {        return new WAF.widget.Label(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        htmlObject,        tmpHtmlObject,        tmpWidth,        tmpHeight,        width,        height,        minWidth,        maxWidth,        linked,        margin,        marginAttr,        labelTextAlign,        text;        marginAttr      = tag.getAttribute('data-margin');        margin          = marginAttr ? parseInt(marginAttr.getValue()) : 5;        htmlObject      = tag.getHtmlObject();        width           = tag.getWidth();        height          = tag.getHeight();        minWidth        = parseInt(tag.getComputedStyle('min-width'));        maxWidth        = parseInt(tag.getComputedStyle('max-width'));        linked          = tag.getLinkedTag();        text            = tag.getAttribute('data-text').getValue();        labelTextAlign  = tag.getComputedStyle('text-align');        htmlObject.prop('for', tag.getAttribute('for').getValue())        /*         * get/create the temporary html object         */        tag._getTmpHtmlObject = function tag_createTmpHtmlObject(text) {            var            tmpHtmlObject;            if ($('#waf-tmp-div').length > 0) {                tmpHtmlObject = $('#waf-tmp-div');            } else {                tmpHtmlObject   = $('<div id="waf-tmp-div">');            }            /*             * Set the temporary html object             */            tmpHtmlObject.appendTo('body');            tmpHtmlObject.html(text);            tmpHtmlObject.css({                /*                 * Keep the same css as the tag                 */                'font-size'         : this.getComputedStyle('font-size'),                'font-style'        : this.getComputedStyle('font-style'),                'font-family'       : this.getComputedStyle('font-family'),                'font-weight'       : this.getComputedStyle('font-weight'),                'text-decoration'   : this.getComputedStyle('text-decoration'),                'text-align'        : this.getComputedStyle('text-align'),                'letter-spacing'    : this.getComputedStyle('letter-spacing'),                'min-width'         : this.getComputedStyle('min-width'),                'max-width'         : this.getComputedStyle('max-width'),                'position'          : 'absolute',                'z-index'           : '10000',                'left'              : '-10000px',                'top'               : '-10000px',                'background'        : '#FFCC66'            });            return tmpHtmlObject;        }        /*         * Refreh the label position depending on the linked widget position         */        tag._refreshPosition = function label_refreshPosition() {            var            left,            top,            linked,            position,            width,            height,            padding;            left    = 0;            top     = 0;            padding = 5;            linked  = this.getLinkedTag();            width   = this.getWidth();            height  = this.getHeight();            if (!isNaN(linked.getX()) && !isNaN(linked.getY())) {                top     = linked.getY();                left    = linked.getX();            }            position = linked.getAttribute('data-label-position').getValue();            switch( position ){                case 'left' :                    left -= width + margin;                    break;                case 'top' :                    top -= height + margin;                    break;                case 'right' :                    left += linked.getWidth() + padding;                    break;                case 'bottom' :                    top += linked.getHeight() + padding;                    break;            }            if ((position === 'left' || position === 'right') && this.getAttribute('data-valign')) {                switch( this.getAttribute('data-valign').getValue() ){                    case 'top' :                        top = linked.getY();                        break;                    case 'middle' :                        top += (linked.getHeight()/2) - (height/2);                        break;                    case 'bottom' :                        top = linked.getY() + linked.getHeight() - height;                        break;                }            }            if ((position === 'top' || position === 'bottom') && labelTextAlign) {                switch( labelTextAlign ){                    case 'center' :                        left += (linked.getWidth()/2) - (width/2);                        break;                    case 'right' :                        left = linked.getX() + linked.getWidth() - width;                        break;                }            }            if (this.isFitToBottom() || this.isFitToRight()) {                this.refreshPositionWithConstraints();            } else {                this.setXY(left, top);                this.setStyle('width', width + 'px');                this.setStyle('height', height + 'px');                this.setStyle('left', left + 'px');                this.setStyle('top', top + 'px');            }            if (isResize) {                this.domUpdate();            }        }        if (linked) {            /*             * Add label text             */            //htmlObject.html(text);            htmlObject.text(text);            htmlObject.css('height', 'auto');            if (isNaN(maxWidth)) {                maxWidth = 0;            }            tmpHtmlObject   = tag._getTmpHtmlObject(text);            tmpWidth        = tmpHtmlObject.width();            tmpHeight       = tmpHtmlObject.height();            if (tmpWidth < minWidth) {                tmpWidth = minWidth;            }            if (tmpWidth > maxWidth && maxWidth > 0) {                tmpWidth = maxWidth;            }            /*             * Set the size             */            if (tmpWidth > 0 && (tmpWidth+2 != tag.getWidth())) {                tag.setWidth(tmpWidth, false);            }            if (tmpHeight > 0 && (tmpHeight != tag.getHeight())) {                tag.setHeight(tmpHeight, false);            }            /*             * Set the correct position             */            tag._refreshPosition();        }        /**         * Refresh position with contraints         * @method refreshPositionWithConstraints         */        tag.refreshPositionWithConstraints = function refreshPositionWithConstraints () {            var            pos,            linked,            parentElt,            parentBorder;            linked          = this.getLinkedTag();            parentElt       = this.getParent();            parentBorder    = 0;            if (parentElt) {                parentBorder = parseInt(parentElt.getComputedStyle('border-width')) * 2;            }            if (linked) {                if (!linked.isFitToRight() && !this.isFitToRight()) {                    // no right constraint                    if (!parentElt.isDocument()) {                        pos = parentElt.getWidth() - (this.getStyle('right') + this.getWidth());                    } else {                        pos = this.getStyle('left');                    }                    pos -= parentBorder;                    pos += 'px';                    $('#' + this.getOverlayId()).css('left', pos);                    this.style['left'] = pos;                    $('#' + this.getOverlayId()).css('right', '');                    this.style['right'] = '';                } else {                    // right constraint                    if (!linked.isFitToLeft() && !this.isFitToLeft()) {                        pos = (this.getStyle('right')) + 'px';                        // no left constraint                        $('#' + this.getOverlayId()).css('right', pos);                        this.style['right'] = pos;                        $('#' + this.getOverlayId()).css('left', '');                        this.style['left'] = '';                    } else {                    // already a left constraint                    // do nothing                    }                }                if (!linked.isFitToBottom() && !this.isFitToBottom()) {                    // no bottom constraint                    if (!parentElt.isDocument()) {                        pos = parentElt.getHeight() - (this.getStyle('bottom') + this.getHeight());                    } else {                        pos = this.getStyle('top');                    }                    pos -= parentBorder;                    pos += 'px';                    $('#' + this.getOverlayId()).css('top', pos);                    this.style['top'] = pos;                    $('#' + this.getOverlayId()).css('bottom', '');                    this.style['bottom'] = '';                } else {                    // bottom constraint                    if (!linked.isFitToTop() && !this.isFitToTop()) {                        pos = (this.getStyle('bottom')) + 'px';                        // no top contraint                        $('#' + this.getOverlayId()).css('bottom', pos);                        this.style['bottom'] = pos;                        $('#' + this.getOverlayId()).css('top', '');                        this.style['top'] = '';                    } else {                    // already a top constraint                    // do nothing                    }                }            }        }        /**         * dblClickFn events         * @method dblClickFn         * @param {event} e         */        tag.dblClickFn = function tag_dblClickFn(e){            var            text,            editBox,            linked,            tmpHtmlObject,            parentHtmlObject,            tmpWidth,            tmpHeight,            htmlObject,            tag;            tag             = e.data && e.data.tag ? e.data.tag : D.getCurrent();            linked          = tag.getLinkedTag();            /*             * Disable key event             */            Designer.ui.core.disableKeyEvent();            Designer.api.setListenerMode(false);            tag.resize.lock(true);            YAHOO.util.Event.stopEvent(e);            $(this).prop('disabled', 'disabled');            /*             * Lock d&d             */            tag.lock();            tag.setFocus(true, false);            //linked.currentSelector = 'waf-label';            linked.setFocus(false, false);            htmlObject          = tag.getHtmlObject();            text                = tag.getAttribute("data-text").getValue();            if (htmlObject[0].tagName == 'LABEL') {                tag._tmpHtmlObj    = htmlObject[0].outerHTML;            }            tmpHtmlObject       = tag._getTmpHtmlObject(text);            parentHtmlObject    = htmlObject.parent();            parentHtmlObject.css('overflow', 'hidden');            /*             * Create edit box with the same css as the tag             */            editBox = $('<textarea>');            editBox.prop('id', tag.getId())            editBox.css({                /*                 * Keep the same css as the tag                 */                'font-size'         : tag.getComputedStyle('font-size'),                'font-family'       : tag.getComputedStyle('font-family'),                'font-style'        : tag.getComputedStyle('font-style'),                'font-weight'       : tag.getComputedStyle('font-weight'),                'text-decoration'   : tag.getComputedStyle('text-decoration'),                'text-align'        : tag.getComputedStyle('text-align'),                'background-color'  : tag.getComputedStyle('background-color'),                'background-image'  : tag.getComputedStyle('background-image'),                'text-shadow'       : tag.getComputedStyle('text-shadow'),                'letter-spacing'    : tag.getComputedStyle('letter-spacing'),                'border'            : 'none',                'width'             : '100%',                'height'            : '100%',                'resize'            : 'none',                'overflow'          : 'hidden'            });            //editBox.html(text);            editBox.text(text);            parentHtmlObject.html(editBox);            /*             * Select the all text on focus             */            editBox.select();            /*             * Add key events             */            editBox.bind('keydown', {}, function(e) {                var                value;                value = $(this).val();                value += e.shiftKey && e.keyCode == 13 ? '<br />' : String.fromCharCode(e.keyCode);                this.refresh = function () {                    tmpHtmlObject.html(value.replace(/\n/g, '<br />') + '.');                    /*                     * Change widget size only if auto width                     */                    tmpWidth    = tmpHtmlObject.width();                    tmpHeight   = tmpHtmlObject.height();                    if (tmpWidth > 0) {                        tag.setWidth(tmpWidth, false);                    }                    if (tmpHeight > 0) {                        tag.setHeight(tmpHeight, false);                    }                    /*                     * Set the correct position                     */                    tag._refreshPosition();                }                switch(e.keyCode) {                    /*                     * Save on enter key down                     */                    case 13:                        this.blur();                        //linked.setFocus(true, true);                        //linked.updateProperty();                        break;                    /*                     * Resize on key event                     */                    default:                        if (e.keyCode >= 37 && e.keyCode <= 40) {                        // DO NOTHING FOR ARROW KEYS                        } else {                            this.refresh();                        }                        break;                }            });            /*             * Save on blur             */            editBox.bind('blur', {                tag : tag            }, function(e){                var                tag,                linked,                parent,                newValue,                htmlObject;                tag         = e.data.tag;                newValue    = $(this).val();                linked      = tag.getLinkedTag();                htmlObject  = tag.getHtmlObject();                parent      = htmlObject.parent();                tag.getAttribute('data-text').setValue(newValue);                linked.getAttribute('data-label').setValue(newValue);                tag.update();                tag.domUpdate();                parent.html(tag._tmpHtmlObj);                tag.getHtmlObject().html(newValue.replace(/\n/g, '<br />'))                /*                 * unlock d&d                 */                tag.unlock();                Designer.ui.core.enableKeyEvent();                Designer.api.setListenerMode(true);                tag.resize.unlock(true);                /*                 * Reload label                 */                if (newValue == '') {                    Designer.tag.deleteWidgets(tag);                } else {                    tag.onDesign();                    tag.setFocus(true);                }            })        }        htmlObject.bind('dblclick', {            tag : tag        }, tag.dblClickFn);        /*         * Automatically add a class depending on linked tag type         */        if (linked) {            tag.addClass('waf-label-' + linked.getType());        }        /**         * Change the position of the label         * @function changePosition         * @param {string} pos new position         */        tag.changePosition = function label_change_position (pos) {            var            linked;            linked = this.getLinkedTag();            linked.getAttribute('data-label-position').setValue(pos);            linked.domUpdate();            linked.onDesign(true);            /*             * Trigger custom evet             */            $(this).trigger('onPositionChange');        }        // calls onDesign once styles are inserted so that autoResize function may work properly        // otherwise calculations could be wrong since CSS styles (like font-size) may not have been inserted yet        $('#waf-body').bind('onWidgetCSSLoaded', function() {            Designer.env.enableModificationNotification = false;            tag.onDesign(false);            Designer.env.enableModificationNotification = true;        });    },    onCreate : function label_on_create (tag, param) {    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/slider/widget-slider.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Slider',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        that,        sliderConfig,        htmlObject;        that            = this;        htmlObject      = $(this.containerNode);        sliderConfig    = {};        this._sliderConfig = sliderConfig;        $.extend(that._sliderConfig, {            min         : parseInt(data['minValue'])    || 0,            max         : parseInt(data['maxValue'])    || 0,            step        : parseInt(data['step'])        || 1,            range       : data['range']                 || false,            orientation : data['orientation']        });        /*         * If widget is binded         */		if (this.sourceAtt) {            var            sliderConfig;            /*             * Extend slider config to set slide and start functions             */            $.extend(that._sliderConfig, {                slide: function(e, ui) {                    var                    widget,                    value,                    sourceAtt;                    widget      = WAF.widgets[this.id];                    value       = ui.value;                    sourceAtt   = widget.source.getAttribute(widget.att.name);                    sourceAtt.setValue(value, {                        dispatcherID    :   widget.id                    });                },                start : function (e, ui) {                    var                    dsPos,                    widget;                    dsPos = $(this).parent().data('dspos');                    if (dsPos) {                        widget = WAF.widgets[this.id];                        widget.source.select(parseInt(dsPos));                    }                }            });            this.sourceAtt.addListener(function(e) {                var                widget,                isParentMatrix,                htmlObject,                widgetID;                widget          = e.data.widget;                widgetID        = widget.id;                htmlObject      = $('#' + widgetID);                isParentMatrix  = htmlObject.parents('.waf-matrix');                /*                 * Set value depending on datasource value                 */                if (isParentMatrix.length == 0 || (e.subID && isParentMatrix.length != 0)) {                    widget._sliderConfig.value = widget.sourceAtt.getValue();                    /*                     * Create jquery ui slider depending on the platform                     */                     if ( WAF.PLATFORM.modulesString === "mobile" ) {                         htmlObject.slider(sliderConfig).addTouch();                     } else {                         htmlObject.slider(sliderConfig);                     }                     widget._initValue = widget.getValue();                }                if (widget._sliderConfig.orientation === 'horizontal') {                    htmlObject.find('.ui-slider-handle').css({                        height      : htmlObject.height() + 14 + 'px',                        lineHeight  : htmlObject.height() + 10 + 'px'                    });                } else {                    htmlObject.find('.ui-slider-handle').width(htmlObject.width() + 14);                }            },{                listenerID      : config.id,                listenerType    : 'slider',                subID           : config.subID ? config.subID : null            }, {                widget          :this,                sliderConfig    : that._sliderConfig            });        } else {            /*             * Create jquery ui slider depending on the platform             */            if ( WAF.PLATFORM.modulesString === "mobile" ) {                //could look at  WAF.PLATFORM.type (tablet, phone...) to go deeper on a platform-specific code                //call addTouch defined in jquery.ui.ipad.altfix.js                htmlObject.slider(that._sliderConfig).addTouch();            } else {                htmlObject.slider(that._sliderConfig);            }            this._initValue = this.getValue();			this._redrawHandle(data.orientation);        }    },{		_redrawHandle: function(orientation) {			var htmlObject = this.$domNode;			 if (orientation === 'horizontal') {                htmlObject.find('.ui-slider-handle').css({                    height      : htmlObject.height() + 14 + 'px',                    lineHeight  : htmlObject.height() + 10 + 'px'                });            } else {                htmlObject.find('.ui-slider-handle').width(htmlObject.width() + 14);            }		},        ready : function slider_ready () {        },        /**         * Custom getValue function         * @method getValue         * @return {number|array} value or values (if many handle)         */        getValue : function slider_get_value() {            var            result;            if (this.$domNode.slider('option', 'values')) {                result = this.$domNode.slider('option', 'values');            } else {                result = this.$domNode.slider('value');            }            return result;        },        /**         * Add a new handle on the slide         * @method addHandle         */        addHandle : function slider_add_handle(number) {            var            value,            handle1,            handle2;            value   = this.getValue();            if (typeof(value) == 'object') {                this._sliderConfig.value    = number;                this._sliderConfig.values   = null;                this._sliderConfig.step   = null;                this._sliderConfig.range   = this.config['data-range'];            } else {                handle1 = value;                handle2 = number;                if (handle1 > handle2) {                    handle2 = handle1;                    handle1 = number;                }                this._sliderConfig.range    = true;                this._sliderConfig.values   = [handle1, handle2];                this._sliderConfig.value    = null;            }			this._sliderConfig.orientation = this.getOrientation();            this.$domNode.slider('destroy');            this.$domNode.slider(this._sliderConfig);        },        /**         * Disable the slider         * @method disable         */        disable : function slider_disable () {            this.$domNode.slider('disable');            /*             * Call super class enable function             */            WAF.Widget.prototype.disable.call(this);        },        /**         * Enable the slider         * @method enable         * @param {boolean} disable         */        enable : function slider_enable () {            this.$domNode.slider('enable');            /*             * Call super class enable function             */            WAF.Widget.prototype.enable.call(this);        },        /**         * Get the minimum value of the slider         * @method getMin         */        getMin: function slider_get_min() {            return this.$domNode.slider( "option", "min" );        },        /**         * Get the maximum value of the slider         * @method getMin         */        getMax: function slider_get_max() {            return this.$domNode.slider( "option", "max" );        },        /**         * Get the step value of the slider         * @method getStep         */        getStep: function slider_get_step() {            return this.$domNode.slider( "option", "step" );        },        /**         * Get the range of the slider         * @method getRange         */        getRange: function slider_get_range() {            return this.$domNode.slider( "option", "range" );        },        /**         * Get the range of the slider         * @method getRange         */        getOrientation: function slider_get_orientation() {            return this.$domNode.slider( "option", "orientation" );        },        /**         * Set the minimum value of the slider         * @method setMin         * @param {number} value         */        setMin: function slider_set_min(value) {            this.$domNode.slider( "option", "min", value );        },        /**         * Set the maximum value of the slider         * @method setMin         * @param {number} value         */        setMax: function slider_set_max(value) {            this.$domNode.slider( "option", "max", value );        },        /**         * Set the step value of the slider         * @method setStep         * @param {number} value         */        setStep: function slider_set_step(value) {            this.$domNode.slider( "option", "step", value );        },        /**         * Set the range of the slider         * @method setRange         * @param {number} value         */        setRange: function slider_set_range(range) {            var            rangeHtml;            rangeHtml = this.$domNode.children('.ui-slider-range');            if (range == 'min') {                rangeHtml.show();                rangeHtml.removeClass('ui-slider-range-max');                rangeHtml.addClass('ui-slider-range-min');            }            if (range == 'max') {                rangeHtml.show();                rangeHtml.removeClass('ui-slider-range-min');                rangeHtml.addClass('ui-slider-range-max');            }            if (range == 'none') {                rangeHtml.hide();            }            this.$domNode.slider( "option", "range", range );            /*             * Force set value to rebuild range             */            this.setValue(this.getValue());        },        /**         * Change the orientation of the slider         * @method setOrientation         * @param {string|boolean} value         */        setOrientation: function slider_set_orientation(value) {            var            width,            height;            value = value.toLowerCase();            if (this.getOrientation() != value) {                width   = this.getWidth();                height  = this.getHeight();                this.setWidth(height);                this.setHeight(width);                if (value == 'vertical') {                    this.$domNode.children('.ui-slider-range').css({                        width : '100%',                        left : '0%',                        top: ''                    });                } else {                    this.$domNode.children('.ui-slider-range').css({                        height : '100%',                        top : '0%',                        left: ''                    });                }				this._redrawHandle(value);            }            this.$domNode.slider( "option", "orientation", value );        },        /**         * Enable to set values when there is many handles         * @method setValues         * @param {array} values         */        setValues : function slider_set_values (values) {            var            i,            length;            length = values.length;            if (!this.isDisabled()) {                for (i = 0; i < length; i += 1) {                    this.$domNode.slider( "values" , i , values[i]);                }            }        },        /**         * Custom clear function         * @method clear         */        clear : function slider_clear () {            if (typeof this._initValue == 'object') {                this.setValues(this._initValue);            } else {                this.setValue(this._initValue);            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/slider/widget-slider-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'slider',    lib        : 'WAF',    description: 'Slider',    category   : 'Form Controls',    img        : '/walib/WAF/widget/slider/icons/widget-slider.png',    tag        : 'div',    attributes : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'class',        description : 'Css class'    },    {        name        : 'data-errorDiv',        description : 'Display Error'    },    {        name        : 'data-minValue',        description : 'Minimum Value',        defaultValue: '0',        typeValue   : 'integer'    },    {        name        : 'data-maxValue',        description : 'Maximum Value',        defaultValue: '100',        typeValue   : 'integer'    },    {        name        : 'data-step',        description : 'Step',        defaultValue: '1',        typeValue   : 'integer'    },    {        name        : 'data-orientation',        description : 'Orientation',        type        : 'dropdown',        options     : [{                key     : 'vertical',                value   : 'Vertical'        },{                key     : 'horizontal',                value   : 'Horizontal'        }],        defaultValue: 'horizontal'    }    ,    {        name        : 'data-range',        description : 'Range',        type        : 'dropdown',        options     : [{                key     : '',                value   : 'None'        },{                key     : 'min',                value   : 'Min'        },{                key     : 'max',                value   : 'Max'        }],        defaultValue: 'min'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: ''    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    }],    events: [     {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchmove',        description: 'On Touch Move',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    },    {        name       : 'slidecreate',        description: 'On Create',        category   : 'Slider Events'    },    {        name       : 'slidestart',        description: 'On Start',        category   : 'Slider Events'    },    {        name       : 'slide',        description: 'On Slide',        category   : 'Slider Events'    },    {        name       : 'slidechange',        description: 'On Change',        category   : 'Slider Events'    },    {        name       : 'slidestop',        description: 'On Stop',        category   : 'Slider Events'    }    ],    style: [    {        name        : 'width',        defaultValue: '162px'    },    {        name        : 'height',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "11px";                } else {                    result = "6px";                }                return result;            }        }.call()    }],    properties: {        style: {            theme        : {                roundy  : false            },            fClass       : true,            text         : false,            background   : true,            border       : true,            sizePosition : true,            label        : true,            shadow       : false,            disabled     : ['border-radius']        },        state : [{                label   : 'disabled',                cssClass: 'waf-state-disabled'        }]    },    structure: [{        description : 'range',        selector    : '.ui-slider-range',        style: {            background  : true        }    },{        description : 'handle',        selector    : '.ui-slider-handle',        style: {            background  : true        },        state : [{                label   : 'hover',                cssClass: 'ui-state-hover',                find    : '.ui-slider-handle'        },{                label   : 'active',                cssClass: 'ui-state-active',                find    : '.ui-slider-handle'        }]    }],    onInit: function (config) {        var slider = new WAF.widget.Slider(config);        return slider;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var slider,            tmpValue = '',            orientation;        slider      = tag.getHtmlObject();        orientation = tag.getAttribute('data-orientation').getValue();        if (!isResize) {            // change style size if orientation has changed            if ( tag.tmpOrientation && tag.tmpOrientation != orientation ){                tmpValue = tag.style.width;                tag.style.width = tag.style.height;                tag.style.height = tmpValue;                tag.tmpOrientation = orientation;                $("#" + tag.overlay.id).css({                    width: tag.style.width,                    height: tag.style.height                });                tag.update();            }            $(slider)            .slider('destroy')            .slider({                disabled: true,                range: tag.getAttribute('data-range').getValue(),                //step: 5,                'orientation': orientation,                value: 36            })            .addClass('waf-widget waf-slider ' + tag.getTheme());            tag.tmpOrientation = orientation;        }		/**		 * Redraw the handle of the slider		 * @function _redrawHandle		 */		tag._redrawHandle = function slider_redraw_handle () {			var			width,			height,			orientation;			slider      = this.getHtmlObject();			orientation = this.getAttribute('data-orientation').getValue();			if (orientation === 'horizontal') {				height  = slider.innerHeight() + 12;				$(slider).find('.ui-slider-handle').css({					height      : height + 'px',					lineHeight  : parseInt(this.style.height, 10) + 10 + 'px'				});			} else {				width  = slider.innerWidth() + 12;				$(slider).find('.ui-slider-handle').width(width);			}		};		$(tag).on('onResize', function() {			this._redrawHandle();		});        if (tag._redrawHandle) {            tag._redrawHandle();        }    },    onCreate : function (tag, param) {    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/textField/widget-textField.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. */WAF.Widget.provide(/** * * @class TODO: give a name to this class (ex: WAF.widget.DataGrid) * @extends WAF.Widget */'TextField', {}, /** * @constructor * @param {Object} inConfig configuration of the widget *//** * The constructor of the widget * * @shared * @property constructor * @type Function **/function WAFWidget(config, data, shared){	var that, htmlObject;	that = this;	htmlObject = $(this.containerNode);	/*	 * To prevent browser input autofill	 */	htmlObject.prop("name", that.id + parseInt(Math.random() * 100000));	/*	 * Add placeholder if specified (simultating it if needed	 */	if (config['placeholder'] !== undefined) {		htmlObject.attr('placeholder', config['placeholder']);		// simulates placeholder if needed		if (WAF.PLATFORM.html5Support[this.domNode.tagName.toLowerCase()]['placeholder'] === false) {			// html5 schim for feature-less browsers (ie: IE9)			htmlObject.focus(function() {				  var input = $(this);				  if (input.val() == input.attr('placeholder')) {					input.val('');				  }			}).blur(function() {				  var input = $(this);				  if (input.val() == '' || input.val() == input.attr('placeholder')) {					input.val(input.attr('placeholder'));				  }			}).blur();			$('[placeholder]').parents('form').submit(function() {				  $(this).find('[placeholder]').each(function() {					var input = $(this);					if (input.val() == input.attr('placeholder')) {					  input.val('');					}				  })			});		}	// /placeholder	}	/*	 * Transform somes value into boolean	 */	data['datapicker-on'] = WAF.utils.getBoolValue(data['datapicker-on']);	data['datapicker-icon-only'] = WAF.utils.getBoolValue(data['datapicker-icon-only']);	data['password'] = WAF.utils.getBoolValue(data['password']);	var dataTheme = htmlObject.data("theme");	if (dataTheme == null || dataTheme == "") {		dataTheme = "";		var existingClasses = htmlObject.prop('class');		existingClasses.split(" ").forEach(function(className){			if (className != "inherit" && className.substr(0, 4) != "waf-") {				dataTheme += className + " ";			}		});	}	/*	 * ------------ <MOUSE EVENTS> ------------	 * To change status	 */	htmlObject.hover(function(){		if (that.getState() != 'focus') {            that.setState('hover');        }	}, function(){        if (that.getState() == 'focus') {            that.setState('focus');        } else {            that.setState('default');        }	});	htmlObject.unbind('focusin');	htmlObject.unbind('focusout');	htmlObject.bind('focusin', {}, function(e){		that.setState('focus');	});	htmlObject.bind('focusout', {}, function(e){        that.removeState('focus');	});	/*	 * ------------ </MOUSE EVENTS> ------------	 */	/*	 * Set input as password field if defined	 */	if (data.password) {		document.getElementById(config.id).setAttribute('type', 'password');	}	/*	 * If widget is binded	 */	var text, widget, widgetID, items, enumValueList, mustAutoComplete, dateOptions, autoCompleteWidget, dateIcon, htmlObject, isParentMatrix, dateIconLeft;	widget = that;	widgetID = widget.id;	enumValueList = [];	htmlObject = $('#' + widgetID);	if (this.sourceAtt) {		this.sourceAtt.addListener(function(e){			var widget = e.data.widget;			var widgetID = widget.id;			var htmlObject = $('#' + widgetID);			widget.clearErrorMessage();			/*			 * change input type for mobile depending on attribute's type			 */			if (WAF.PLATFORM.isTouch) {				switch (widget.att.type) {					case "date":						if (WAF.PLATFORM.OS === "iOs" && WAF.PLATFORM.OSVersion >= 5) {							htmlObject.get()[0].type = "date";						}						else {							htmlObject.scroller();						}						break;					default:				}			}			/*			 * Set the value			 */			if (!widget.att.simple) {				text = "";				// case of dataSource var/array/object				if (widget && widget.source && widget.source._private && widget.source._private.sourceType &&				(widget.source._private.sourceType == 'scalar' || widget.source._private.sourceType == 'array' || widget.source._private.sourceType == 'object')) {					if (widget.isInFocus) {						text = widget.sourceAtt.getValueForInput();					}					else {						text = widget.getFormattedValue();					}				}			}			else {				if (widget.isInFocus) {					text = widget.sourceAtt.getValueForInput();				}				else {					text = widget.getFormattedValue();				}			}			/*			 *  specific task if mobile & date			 */			if (widget.att.type === 'date' && WAF.PLATFORM.isTouch && WAF.PLATFORM.OS === "iOs" && WAF.PLATFORM.OSVersion >= 5) {				var date = new Date(text), y = date.getFullYear(), d = date.getDate(), m = date.getMonth() + 1;				if (d < 10) {					d = "0" + d;				}				if (m < 10) {					m = "0" + m;				}				text = y + "-" + m + "-" + d;			}			htmlObject.val(text);		}, {			listenerID: config.id,			listenerType: 'textInput',			subID: config.subID ? config.subID : null		}, {			widget: this		});		// end of onAttributeChange		isParentMatrix = htmlObject.parents('.waf-matrix');		if (widget.att.enumeration != null && !widget.att.readOnly && !widget.sourceAtt.readOnly) {			items = widget.att.enumeration.item;			for (var i = 0, nb = items.length; i < nb; i++) {				enumValueList.push(items[i].name);			}		}		mustAutoComplete = false;		if (widget.att.autoComplete) {			mustAutoComplete = true;		}		if (data.autocomplete != null && !data.autocomplete) {			mustAutoComplete = false;		}		if (enumValueList.length > 0) {			if (isParentMatrix.length == 0 || (typeof e != 'undefined' && e.subID && isParentMatrix.length != 0)) {				htmlObject.data('enumValueList', enumValueList).autocomplete({					source: function(request, response){						response($.grep($(this.element.context).data('enumValueList'), function(item, index){							return item.toLowerCase().indexOf(request.term.toLowerCase()) === 0;						}));					}				});				autoCompleteWidget = htmlObject.autocomplete('widget');				if (isParentMatrix.length == 0) {					htmlObject.blur(that.autocompleteBlur);				}			}		}		else if (mustAutoComplete) {			if (isParentMatrix.length == 0 || (typeof e != 'undefined' && e.subID && isParentMatrix.length != 0)) {				htmlObject.autocomplete({					source: function(request, response){						$.ajax({							url: '/rest/' + widget.source.getDataClass().getName() + '/' + widget.att.name + '?$distinct=true&$top=20',							data: {								'$filter': '"' + widget.att.name + '=\'' + request.term + WAF.wildchar + '\'"'							},							success: function(data){								response($.map(data, function(item){									return {										value: item									}								}));							}						});					}				});				autoCompleteWidget = htmlObject.autocomplete('widget');				autoCompleteWidget.addClass(dataTheme);				if (isParentMatrix.length == 0) {					htmlObject.blur(that.autocompleteBlur);				}			}			/*			 * case of calendar			 */		}		else {			if (widget.att.type == 'date') {				var lang = WAF.utils.getBrowserLang();				dateOptions = $.datepicker.regional[lang] || {};				$.datepicker.setDefaults(dateOptions);				var dateInputFormat = dateOptions.dateFormat || "m/d/yy";				dateOptions.changeMonth = true;				dateOptions.changeYear = true;				if (data['datapicker-on']) {					if (!WAF.PLATFORM.isTouch || WAF.PLATFORM.OS != "iOs") {						/*						 * If icon only active => add calendar button						 */						if (data['datapicker-icon-only']) {							dateOptions.showOn = "button";							dateOptions.buttonImage = "/waLib/WAF/widget/png/date-picker-trigger.png?id=" + widgetID;							dateOptions.buttonImageOnly = true;						}						else {							dateOptions.buttonImageOnly = false;							dateOptions.showOn = "focus";						}						dateOptions.onClose = function(dateText, inst){							var value, sourceAtt;							if (widget.format != null && widget.format.format != null) {								sourceAtt = widget.sourceAtt;								if (sourceAtt != null) {									value = sourceAtt.getValue();								}								this.value = widget.getFormattedValue(value);							}						}						/*						 * Fix bug on calendar on textfield into a matrix						 */						if (isParentMatrix.length == 0 || (e.subID && isParentMatrix.length != 0)) {							htmlObject.datepicker(dateOptions);							htmlObject.datepicker("widget").addClass(dataTheme);							if (false) {								var dateVal;								if (widget.sourceAtt != null)									dateVal = widget.sourceAtt.getValue() || new Date();								else									dateVal = new Date();								htmlObject.bind('blur', function(event){									setTimeout(function(evv){										htmlObject.DatePickerHide();									}, 500);								});								htmlObject.bind('keyup', function(event){									var val = htmlObject.val();									var tempDate = $.fn.DatePickerParse(val, dateInputFormat);									if (tempDate.isValid())										htmlObject.DatePickerSetDate(tempDate, true);								});								htmlObject.DatePicker({									format: 'm/d/yy',									date: dateVal,									current: dateVal,									starts: 1,									position: 'bottom',									onBeforeShow: function(){										var dateVal;										if (widget.sourceAtt != null)											dateVal = widget.sourceAtt.getValue() || new Date();										else											dateVal = new Date();										htmlObject.DatePickerSetDate(dateVal, true);									},									onChange: function(formated, dates){										if (widget.sourceAtt != null)											widget.sourceAtt.setValue(dates);										htmlObject.DatePickerHide();									}								});								var datapickerid = htmlObject.data("datepickerId");								var datepickobj = $("#" + datapickerid);								datepickobj.addClass("waf-calendar");							}						}						/*						 * Get linked calendar button						 */						if (data['datapicker-icon-only'] && htmlObject[0]) {							dateIcon = $('img[src="/waLib/WAF/widget/png/date-picker-trigger.png?id=' + widgetID + '"]');							dateIconLeft = (parseInt(htmlObject.css('left')) + htmlObject[0].offsetWidth);							dateIcon.css({								'position': 'absolute',								'left': dateIconLeft + 'px',								'top': htmlObject.css('top'),								'cursor': 'pointer'							});						}					}				}			}		}		/*		 * Set the same as the htmlobject css to the autocomplete		 */		if (autoCompleteWidget != null) {			["font-family", "font-size", "font-style", "font-variant", "font-weight", "text-align", "letter-spacing", "background-color", "color"].forEach(function(elem){				autoCompleteWidget.css(elem, htmlObject.css(elem));			});		}		/*		 * Change datasource value on change event		 */		htmlObject.unbind('change', that.change)		htmlObject.bind('change', {}, that.change);		if (WAF.PLATFORM.isTouch && widget.att.type === 'date') {			htmlObject.unbind('blur', that.blur)			htmlObject.bind('blur', {}, that.blur);		}		/*		 * Remove formatted value on focus		 */		htmlObject.bind('focus', function(event){			var widget, sourceAtt;			widget = WAF.widgets[this.id];			widget.isInFocus = true;			if (widget.format != null && widget.format.format != null) {				sourceAtt = widget.sourceAtt;				if (sourceAtt != null) {					/*					 * change input type for mobile depending on attribute's type just before editing					 */					if (WAF.PLATFORM.isTouch) {						switch (widget.att.type) {							case "number":								htmlObject.get()[0].type = "number";								break;							default:						}					}					this.value = sourceAtt.getValueForInput();				}			}		});		/*		 * Reset formatted value on blur		 */		htmlObject.bind('blur', function(event){			var widget, value, sourceAtt;			widget = WAF.widgets[this.id];			value = '';			widget.isInFocus = false;			if (widget.format != null && widget.format.format != null) {				sourceAtt = widget.sourceAtt;				if (sourceAtt != null) {					value = sourceAtt.getValue();				}				/*				 * change back input type for mobile depending on attribute's type after edition				 */				if (WAF.PLATFORM.isTouch) {					switch (widget.att.type) {						case "number":							htmlObject.get()[0].type = "text";							break;						default:					}				}				this.value = widget.getFormattedValue(value);			}		});		/*		 * Active/Desactive input depending on readOnly attribute		 */		if (widget.att.readOnly || widget.sourceAtt.readOnly) {			htmlObject.disabled = true;		}		else {			htmlObject.disabled = false;		}	}	else {		this._tmpVal = htmlObject.prop('value');		if (this._tmpVal && this._tmpVal.replace()) {			this._tmpVal = this._tmpVal.replace(/&quot;/g, '"');		}		text = this.getFormattedValue(htmlObject.val());		if (text && text.replace()) {			text = text.replace(/&quot;/g, '"');		}		htmlObject.val(text);		htmlObject.focusin(function(){			if (that._tmpVal) {				$(this).val(that._tmpVal);			}		});		htmlObject.focusout(function(){			that._tmpVal = $(this).val();			if (that._tmpVal) {				$(this).val(that.getFormattedValue(that._tmpVal));			}		});	}}, {	/*	 * TextField widget blur event function for Mobile	 */	blur: function(){		WAF.widgets[this.id].change();	},	/*	 * TextField widget change event function	 */	change: function(){		var widget, value, sourceAtt, validation;		widget = WAF.widgets[this.id];		if (widget != null) {			if (widget.doNotUpdate) {				widget.doNotUpdate = false;			}			else {				sourceAtt = widget.sourceAtt;				if (WAF.PLATFORM.isTouch && widget.att.type === "date") {					var date = new Date(document.getElementById(this.id).value.replace(/-/gi, "/"));					value = sourceAtt.normalize(date);				} else {					value = sourceAtt.normalize(this.value);				}				validation = sourceAtt.validate(value);				if (validation.valid) {					if (WAF.PLATFORM.isTouch) {						window.setTimeout(function(){							sourceAtt.setValue(value, {								dispatcherID: widget.divID							});							widget.clearErrorMessage();						},0);					} else {						sourceAtt.setValue(value, {							dispatcherID: widget.divID						});						widget.clearErrorMessage();					}				}				else {					sourceAtt.setValue(value, {						dispatcherID: widget.divID					});					widget.setErrorMessage({						message: validation.messages.join(", "),						tooltip: false					});				}			}		}	},	/*	 * TextField autocomplete widget blur event function	 */	autocompleteBlur: function(event){		var widget, sourceAtt;		widget = WAF.widgets[this.id];		sourceAtt = widget.sourceAtt;		if (this.value !== sourceAtt.getValue()) {			sourceAtt.setValue(this.value, {				dispatcherID: this.id			});		}	},	/**	 * Custom setValue	 * @param {string} value new value	 */	setValue : function (value) {    	if (!this.isDisabled()) {            this.$domNode.val(value);            this._tmpVal = value;		}	    /*	     * Trigger change event	     */	    this.$domNode.trigger('change');	}});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/textField/widget-textField-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'textField',    lib        : 'WAF',    description: 'Text Input',    category   : 'Form Controls',    img        : '/walib/WAF/widget/textField/icons/widget-textField.png',    tag        : 'input',    attributes : [    {        name        : 'type',        defaultValue: 'text'    },    {        name       : 'data-binding',        description: 'Source'    },    {        name       : 'data-errorDiv',        description: 'Display Error'    },    {        name       : 'value',        description: 'Default Value'    },    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-format',        description: 'Format'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name       : 'data-autocomplete',        description: 'Autocomplete',        type        : 'checkbox'    },    {        name        : 'data-multiline',        description : 'Multiline',        type        : 'checkbox',        defaultValue: 'false'    },    {        name        : 'data-password',        description : 'Password field',        type        : 'checkbox',        defaultValue: 'false'    },    {        name        : 'data-datapicker-on',        description : 'Enable datepicker',        type        : 'checkbox',        typeValue   : 'bool',        defaultValue: 'true'    },    {        name        : 'data-datapicker-icon-only',        description : 'Show datepicker button',        type        : 'checkbox',        typeValue   : 'bool',        defaultValue: 'false'    },    {        name		: 'tabindex',        description : 'Tabindex',        typeValue   : 'integer'    },	{		name		: 'placeholder',		description	: 'Input placeholder',		type		: 'string'	}],    events: [    {        name       : 'blur',        description: 'On Blur',        category   : 'Focus Events'    },    {        name       : 'change',        description: 'On Change',        category   : 'Focus Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'focus',        description: 'On Focus',        category   : 'Focus Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'keydown',        description: 'On Key Down',        category   : 'Keyboard Events'    },    {        name       : 'keyup',        description: 'On Key Up',        category   : 'Keyboard Events'    },    {        name       : 'select',        description: 'On Select',        category   : 'Keyboard Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    style: [    {        name        : 'width',        defaultValue: '130px'    },    {        name                : 'height',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "40px";                } else {                    result = "22px";                }                return result;            }        }.call()    }],    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            dropShadow  : true,            innerShadow : true,            textShadow  : true,            disabled    : []        },        state : [{            label   : 'hover',            cssClass: 'waf-state-hover'        },{            label   : 'focus',            cssClass: 'waf-state-focus'        },{            label   : 'disabled',            cssClass: 'waf-state-disabled'        }]    },    onInit: function (config) {        var widget = new WAF.widget.TextField(config);        // add in WAF.widgets        widget.kind     = config['data-type']; // kind of widget        widget.id       = config['id']; // id of the widget        widget.renderId = config['id']; // id of the tag used to render the widget        widget.ref      = document.getElementById(config['id']); // reference of the DOM instance of the widget        WAF.widgets[config['id']] = widget;        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        value,        multiline,        htmlObject,        htmlElement;        htmlObject  = tag.getHtmlObject();        htmlElement = htmlObject[0];        multiline   = tag.getAttribute('data-multiline').getValue(),		placeHolder = tag.getAttribute('placeholder').getValue(),        value       = tag.getAttribute('value').getValue();        /*         * Change tag type into textarea if multiline         */        if (tag._config.changeType && htmlElement.tagName == "INPUT" && multiline == 'true') {            tag._config.changeType(tag, 'textarea');        }        /*         * Change tag type into input if not multiline         */        if(tag._config.changeType && htmlElement.tagName == "TEXTAREA" && multiline == 'false') {            tag._config.changeType(tag, 'input');        }        /*         * Add default value         */        if (value) {            htmlObject.val(value);        } else if (tag.getSource()) {            htmlObject.val('[' + tag.getSource() + ']');        } else {            htmlObject.val('');        }		htmlObject.attr('placeholder', placeHolder);    },    onCreate : function (tag, param) {        var        htmlObject;        htmlObject = tag.getHtmlObject();        /*         * Dblclick event         */        htmlObject.bind('dblclick', {tag : tag}, function (e) {            var            tag,            source,            htmlObject;            tag         = e.data.tag;            htmlObject  = $(this);            source      =  tag.getSource();            if (htmlObject.val() === '[' + source + ']') {                htmlObject.val('');            }            htmlObject.css('cursor', 'text');            /*             * Force focus on widget             */            tag.setFocus(true);            /*             * Lock d&d             */            tag.lock();            htmlObject.css('cursor ', 'text');            /*             * Disable the events key             */            Designer.ui.core.disableKeyEvent();            Designer.api.setListenerMode(false);            tag.resize.lock(true);            YAHOO.util.Event.stopEvent(e);            htmlObject.focus();            htmlObject.select();            /*             * Force focus on widget on click             */            htmlObject.unbind('click');            htmlObject.bind('click', {}, function(e){                tag.setFocus(true)            });            htmlObject.unbind('keydown');            htmlObject.bind('keydown', function (e) {                if (e.keyCode === 13 && (!e.shiftKey || tag.getAttribute('data-multiline').getValue() === 'false')) {                    $(this).blur();                }            });            htmlObject.unbind('blur');            htmlObject.bind('blur', {}, function(e){                var                htmlObject;                htmlObject = $(this);                htmlObject.css('cursor', 'move');                if (D.getCurrent() && D.getCurrent() === tag) {                    tag.setResizable(true);                }                tag.getAttribute('value').setValue(htmlObject.val());                tag.save(false, true, false);                Designer.ui.core.enableKeyEvent();                Designer.api.setListenerMode(true);                tag.resize.unlock(true);                /*                 * Unlock d&d                 */                tag.unlock();                htmlObject.css('cursor ', 'move');            });        });    },    /**     * Change the widget tag type     * @method changeType     * @param {object} tag     * @param {string} type     */    changeType : function (tag, type){        var        i,        tagId,        value,        event,        events,        source,        newStyle,        newClass,        htmlObject,        tmpHtmlObject;        tagId           = tag.getId();        htmlObject      = $('#' + tagId);        value           = tag.getAttribute('value').getValue();        source          = tag.getSource();        newClass        = htmlObject.attr('class');        newStyle        = htmlObject.attr('style');        events          = htmlObject.data('events');        tmpHtmlObject   = $('<' + type + '/>').attr('id', 'tmp-' + tagId);        tmpHtmlObject.appendTo('#' + tag.overlay.id + ' .bd');        tmpHtmlObject.addClass(newClass);        tmpHtmlObject.attr('style', newStyle);        if (!value && source) {            value = '[' + source + ']';        }        htmlObject.remove();        if (type === 'textarea') {            tmpHtmlObject.html(value);        } else {            tmpHtmlObject.val(value);            document.getElementById('tmp-' + tagId).setAttribute('type', 'text')        }        tmpHtmlObject.prop('id', tagId);        /*         * Reapply events         */        for (i in events) {            event = events[i][0];            tmpHtmlObject.bind(event.type, event.data, event.handler);        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/googleMap/widget-googleMap.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*//*** @author       The Wakanda Team* @date		august 2010* @version	0.1**/WAF.Widget.provide(    'GoogleMap',    {},    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        config                  = config                  || {};        config['id']            = config['id']            || {};        config['data-mapType']  = config['data-mapType']  || '0';        config['data-position'] = config['data-position'] || '0';        if (this.source) {            this.source.addListener(                'onAttributeChange',                function(event) {                    var widget = event.data.widget;                    if (widget != null) {                        // base url of static google map                        var map = 'http://maps.google.com/maps/api/staticmap?sensor=false';                        // fix the position on wich is centered the map                        map += '&center=' + event.dataSource.getAttribute(widget.att.name).getValue();                        // fix a zoom value                        map += '&zoom=' + $('#' + widget.divID).data('zoom');                        // Map type :                        map += '&maptype=' + $('#' + widget.divID).data('mapType');                        // fix the size of the image                        map += '&size=' + $('#' + widget.divID).css('width').replace('px', '') + 'x' + $('#' + widget.divID).css('height').replace('px', '');                        // add a marker on the map                        map += '&markers=color:' + $('#' + widget.divID).data('marker-color') + '|size:' + $('#' + widget.divID).data('marker-size') + '|label:' + $('#' + widget.divID).data('marker-label') + '|' + event.dataSource.getAttribute(widget.att.name).getValue();                        event.data.domNode.src = map;                    }                },                {                    attributeName: this.att.name                },                {                    widget : this,                    domNode: document.getElementById(config.id)                });        } else {            var map = 'http://maps.google.com/maps/api/staticmap?sensor=false';            // fix the position on wich is centered the map            map += '&center=' + config['data-position'];            // fix a zoom value            map += '&zoom=' + config['data-zoom'];            // Map type :            map += '&maptype=' + $('#' + config.id).data('mapType');            // fix the size of the image            map += '&size=' + $('#' + config.id).css('width').replace('px','') + 'x' + $('#' + config.id).css('height').replace('px','');            // add a marker on the map            map += '&markers=color:' + $('#' + config.id).data('marker-color') + '|size:' + $('#' + config.id).data('marker-size') + '|label:' + $('#' + config.id).data('marker-label') + '|' + config['data-position'];            document.getElementById(config.id).src = map;        }    },{    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/googleMap/widget-googleMap-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'googleMap',    lib         : 'WAF',    description : 'Google Maps',    category    : 'External',    img         : '/walib/WAF/widget/googleMap/icons/widget-googleMap.png',    tag         : 'img',    attributes  : [    {        name         : 'data-binding',        defaultValue : '',        description  : 'Source'    },    {        name         : 'data-position',        defaultValue : '',        description  : 'Location'    },    {        name        : 'data-mapType',        type        : 'dropdown',        options     : [        {            key     : 'HYBRID',            value   : 'Hybrid'        },        {            key     : 'ROADMAP',            value   : 'Roadmap'        },        {            key     : 'SATELLITE',            value   : 'Satellite'        },        {            key     : 'TERRAIN',            value   : 'Terrain'        }],        defaultValue: 'hybrid',        description  : 'Type'    },    {        name         : 'data-zoom',        defaultValue : '10',        description  : 'Zoom'    },    {        name         : 'data-label',        description  : 'Label',        defaultValue : ''    },    {        name         : 'data-label-position',        description  : 'Label position',        defaultValue : 'left'    },    {        name         : 'data-marker-color',        description  : 'Color',        type         : 'dropdown',        options      : ['black', 'brown', 'green', 'purple', 'yellow', 'blue', 'gray', 'orange', 'red', 'white'],        defaultValue : 'red',        category     : 'Marker'    },    {        name         : 'data-marker-size',        description  : 'Size',        type         : 'dropdown',        options      : [        {            key     : '',            value   : ''        },        {            key     : 'tiny',            value   : 'tiny'        },        {            key     : 'mid',            value   : 'mid'        },        {            key     : 'small',            value   : 'small'        },        ],        defaultValue : '',        category     : 'Marker'    },    {        name         : 'data-marker-label',        description  : 'Label',        type         : 'dropdown',        options      : ['', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A','B','C','D','E','F','G','H','I','J','K','L','M','N','0','P','Q','R','S','T','U','V','W','X','Y','Z'],        defaultValue : '',        category     : 'Marker'    }    ],    style: [    {        name         : 'width',        defaultValue : '338px'    },    {        name         : 'height',        defaultValue : '200px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    properties : {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            dropShadow  : true,            border      : true,            sizePosition: true,            label       : true,            disabled    : ['border-radius']        }    },    onInit: function(config) {        var widget = new WAF.widget.GoogleMap(config);        return widget;    },    onDesign: function(config, designer, tag, catalog, isResize) {        document.getElementById(tag.getAttribute('id').getValue()).src = "../walib/WAF/widget/googleMap/images/googleMap.jpg";    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/yahooWeather/widget-yahooWeather.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * TODO: Write a description of this WAF widget     *     * @class WAF.Widget.YahooWeather     * @extends WAF.Widget     */    'YahooWeather',    {        // Shared private properties and methods        // NOTE: "this" is NOT available in this context to access the current to widget instance        // These methods and properties are available from the constrctor through "shared"        /**         * YQL params         *         * @private         * @shared         * @property shared.yql         * @type Object         */        yql: {            url: 'http://query.yahooapis.com/v1/public/yql',            sql: 'select * from weather.forecast where location = ',            query: {                q: '',                format: 'json',                callback: ''            }        },        /**         * Format url to use in ajax call to YQL         *         * @private         * @shared         * @method urlFormat         */        urlFormat: function() {            return this.yql.url + '?' + $.param(this.yql.query);        },        /**         * Retrieve and format forecast         *         * @private         * @shared         * @method getForecast         */        getForecast: function getForecast(event) {            var self = this,            html,            zipCode,            weather,            weatherConditionIcon;            if (this.widget.source.getCurrentElement() !== null) {                // Get the zipCode                zipCode = this.widget.sourceAtt.getValue();                // Set the query                this.yql.query.q = this.yql.sql + zipCode + ' and u="' + this.widget.settings.units.temperature + '"';                // Initiate the HTTP GET request                $.getJSON(this.urlFormat(), function(data) {                    html = '';                    try {                        // Get results                        weather = data.query.results.channel;                        // Point to the condition icon                        weatherConditionIcon = 'http://l.yimg.com/a/i/us/nws/weather/gr/' + weather.item.condition.code + 'd.png';                        // Html injection                        html += '<div class="condition icon" style="background-image: url(' + weatherConditionIcon + ')"></div>';                        html += '<h2>' + weather.item.condition.temp + '&deg;<span>' + weather.units.temperature + '</span></h2>';                        html += '<h4>' + weather.location.city + ', ' + weather.location.region + '</h4>';                        html += '<table>';                        html +=     '<col width="25%" />';                        html +=     '<col width="25%" />';                        html +=     '<col width="25%" />';                        html +=     '<col width="25%" />';                        html +=     '<tr>';                        html +=         '<th colspan="2">' + weather.item.forecast[0].day + '</th>';                        html +=         '<th colspan="2">' + weather.item.forecast[1].day + '</th>';                        html +=     '</tr>';                        html +=     '<tr>';                        html +=         '<td colspan="2" align="center">' + weather.item.forecast[0].text + '</td>';                        html +=         '<td colspan="2" align="center">' + weather.item.forecast[1].text + '</td>';                        html +=     '</tr>';                        html +=     '<tr>';                        html +=         '<td rowspan="2"><div class="icon" style="background-position: -' + (61 * weather.item.forecast[0].code) + 'px 0;"></div></td>';                        html +=         '<td>High:&nbsp;<span class="high">' + weather.item.forecast[0].high + '&deg;</span></td>';                        html +=         '<td rowspan="2"><div class="icon" style="background-position: -' + (61 * weather.item.forecast[1].code) + 'px 0;"></div></td>';                        html +=         '<td>High:&nbsp;<span class="high">' + weather.item.forecast[1].high + '&deg;</span></td>';                        html +=     '</tr>';                        html +=     '<tr>';                        html +=         '<td>Low:&nbsp;<span class="low">' + weather.item.forecast[0].low + '&deg;</span></td>';                        html +=         '<td>Low:&nbsp;<span class="low">' + weather.item.forecast[1].low + '&deg;</span></td>';                        html +=     '</tr>';                        html += '</table>';                        html += '<a href="' + weather.item.link + '" target="_blank" class="full">Full Forecast at Yahoo! Weather</a>';                        html += '<a href="javascript:void(0);" class="settings">Settings</a>';                        self.widget.front.html(html);                    } catch(E) {                        // Something wrong occured                        self.widget.front.html('<h4>Sorry ! An error occured</h4>');                    }                });            }        },        yahooWeatherEventHandler: function(event) {            var shared = event.data.shared;            $(shared.widget.containerNode).removeClass('flip');            shared.getForecast();        }    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default WAF.widget.YahooWeather     **/    function (config, data, shared) {        var        /**             *             * @private             * @property widget             * @type WAF.widget.YahooWeather             **/        widget = this,        /**             *             * @private             * @property html             * @type String             **/        html = '';        shared.widget = this;        // Html injection        html += '<div class="front"></div>';        html += '<div class="back">';        html +=     '<h4>Settings</h4>';        html +=     '<form>';        html +=     '<fieldset>';        html +=         '<legend>Units</legend>';        html +=         'Temperature: <select name="units[temperature]"><option value="f" selected>Fahrenheit</option><option value="c">Celsius</option></select>';        html +=     '</fieldset>';        html +=     '</form>';        html +=     '<a href="javascript:void(0);" class="settings">Settings</a>';        html += '</div>';        $(this.containerNode).html(html);        // Public instance properties        this.settings = {            units: {                temperature: 'f'            }        }        this.front = $(this.containerNode).children('.front');        this.back = $(this.containerNode).children('.back');        this.back.children('form').change(function(event) {            widget.settings.units.temperature = $(this).find('select[name="units[temperature]"] option:selected').val();            shared.getForecast(widget);        });        // Events        // Click on settings        $(this.containerNode).delegate('.settings', 'click', function(){            $(widget.containerNode).toggleClass('flip');        });        // Source attribute change        if (typeof this.source !== 'undefined') {            //this.source.addListener("onAttributeChange", shared.yahooWeatherEventHandler, {attributeName: this.att.name}, {widget:this, shared: shared, getForecast:shared.getForecast});            this.source.addListener("onAttributeChange", shared.yahooWeatherEventHandler, {                attributeName: this.att.name                }, {                shared: shared            });        }    },    {    // [Prototype]    // The public shared properties and methods inherited by all the instances    // NOTE: "this" is available in this context    // These methods and properties are available from the constructor through "this"    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/yahooWeather/widget-yahooWeather-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'yahooWeather',    lib         : 'WAF',    description : 'Yahoo! Weather',    category    : 'External',    img         : '/walib/WAF/widget/yahooWeather/icons/widget-yahooWeather.png',    include     : [],    tag         : 'div',    attributes  : [    {        name         : 'data-binding',        defaultValue : '',        description  : 'Source'    },    {        name         : 'data-label',        description  : 'Label',        defaultValue : ''    },    {        name         : 'data-label-position',        description  : 'Label position',        defaultValue : 'left'    }],    style: [    {        name         : 'width',        defaultValue : '264px'    },    {        name         : 'height',        defaultValue : '209px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    properties : {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : true,            disabled    : ['border-radius']        }    },    onInit: function(config) {        var widget = new WAF.widget.YahooWeather(config);        $('#' + config['id']).addClass('waf-widget waf-yahooWeather').children('div').addClass('waf-container');        return widget;    },    onDesign: function(config, designer, tag, catalog, isResize) {        var className;        className = tag.getTheme();        if (tag.getAttribute('class')) {            className += ' ' + tag.getAttribute('class').getValue().replace(',', ' ')        }        $('#' + tag.getAttribute('id').getValue())        .append(            $('<img />')            .attr({                src: '../walib/WAF/widget/yahooWeather/png/preview.png',                width: 264,                height: 253            })            .css({                position: 'absolute',                top: '-45px'            })            )        .addClass(className);    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/progressBar/widget-progressBar.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'ProgressBar',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var htmlObject,        dontdisplayempty,        ss,        clone,        cloneMsg;        htmlObject  = $(this.containerNode);        dontdisplayempty        = false;        ss                      = data['no-empty-display'];        this.progressInfo     = data['progressinfo'];        this.toph             = 25;        this.barh             = 20;        this.spaceh           = 5;        this.nblevel          = 0;        this.stillWaiting     = false;        this.parent           = htmlObject.parent();        this.top              = htmlObject.css('top');        clone                   = htmlObject.clone();        cloneMsg                = $('[for=' + this.id + ']').clone();        /*         * Remove original progressBar         */        htmlObject.hide();        $('[for=' + this.id + ']').hide();        this.clone = {            progress : clone,            msg : cloneMsg        }        if (ss != null) {            if (typeof(ss) == 'string') {                dontdisplayempty = ss.toLowerCase() == 'true';            } else {                dontdisplayempty = ss;            }        }        this.atLeastOne = !dontdisplayempty;        this.timerStarted = false;        if (this.atLeastOne) {            this.updateWithInfo({                SessionInfo: [{                    fMessage    : "",                    fValue      : 0,                    fMax        : 100                }]            })        }    },{	 	progress : function(value, max, message) {	 		value = value || 0;	 		if (max == null)	 		{	 			max = this.topMax || 100;	 		}	 		if (message == null)	 		{	 			if (this.topMessage == null)	 				this.topMessage = this.clone.msg.html();		 		message = this.topMessage || "";	 		}	 		this.topValue = value;	 		this.topMax = max;	 		this.topMessage = message;    		var config = { SessionInfo:[{fValue: value, fMax: max, fMessage: message}]};    		this.updateWithInfo(config);    	},    	stopProgress: function() {    		var config = { SessionInfo:[{fValue: 0, fMax: 100, fMessage: "", stop:true}]};    		this.updateWithInfo(config);    	},    	setValue : function(value, max, message) {    		this.progress(value, max, message)    	},    	getValue : function()        {        	return this.topValue || 0;        },        updateWithInfo  : function (config) {            var            i,            widget,            range,            sessions,            nblevel,            top,            newProgress,            newMsg,            session,            message,            reg,            percent;            config          = config || {};            widget          = this;            range           = {};            sessions        = config.SessionInfo;            nblevel         = sessions == null ? 0 : sessions.length;            top             = 0;            newProgress     = {};            newMsg          = {};            widget.nbsessions   = 0;            widget.nbsessions   = nblevel;            for (i = 0; i < nblevel; i++) {                session = sessions[i];                message = session.fMessage;                reg     = new RegExp("({curValue})", "g");                percent	= Math.round((session.fValue/session.fMax)*100) + '%';                if ($('.' + widget.id + '-progress-' + i).length === 0) {                    newProgress = widget.clone.progress.clone();                    newMsg = widget.clone.msg.clone();                    newProgress.addClass(widget.id + '-progress-' + i);                    newMsg.addClass(widget.id + '-msg-' + i);                    widget.parent.append(newProgress);                    widget.parent.append(newMsg);                } else {                    newProgress = $('.' + widget.id + '-progress-' + i);                    newMsg = $('.' + widget.id + '-msg-' + i);                    if (session.stop) {                        if (widget.atLeastOne && i === 0) {                        }                        else {                            newProgress.remove();                            newMsg.remove();                            return false;                        }                    }                }                newProgress.css('top', widget.top + 'px');                if (newMsg.offset()) {                    newMsg.css('top', widget.top + top + 'px');                }                range = newProgress.children('.waf-progressBar-range');                widget.stillWaiting = false;                message = message.replace(reg, '<b>'+WAF.utils.formatNumber(session.fValue, {                    format:"###,###,###,###,###"                })+'</b>');                reg = new RegExp("({maxValue})", "g");                message = message.replace(reg, WAF.utils.formatNumber(session.fMax, {                    format:"###,###,###,###,###"                }));                // get linked label and change the description                newMsg.html(message);                if (range.length === 0) {                    // add range div                    var height	= newProgress.height();                    range = $('<div class="waf-progressBar-range" style="line-height: ' + height + 'px;-webkit-background-size: ' + height + 'px ' + height + 'px;-moz-background-size: ' + height + 'px ' + height + 'px; -webkit-animation: waf-progressBar-animation 10s linear infinite;"><span>' + percent + '</span></div>')                    .appendTo(newProgress);                }                range.css({                    'width' : percent                })                .children('span').html(percent);                top += widget.toph;                top += widget.barh+widget.spaceh;            }        },        startListening  : function (interval) {            var            widget;            widget = this;            if (interval == null) {                interval = 1000;            }            if (!widget.timerStarted) {                widget.stillWaiting = true;            }            widget.timeOutId = setInterval(function() {                var                xhr;                if (!widget.requestStarted) {                    xhr = new XMLHttpRequest();                    xhr.onreadystatechange = function() {                        var                        rep,                        pinfo;                        if (xhr.readyState  == 4) {                            widget.nbsessions = 0;                            rep = xhr.responseText;                            if (rep != null) {                                pinfo = JSON.parse(rep);                                if (pinfo.ProgressInfo != null) {                                    widget.updateWithInfo(pinfo.ProgressInfo[0]);                                }                                widget.requestStarted = false;                            }                        }                    };                    widget.requestStarted = true;					if (window.location.origin != null)						xhr.open("GET", window.location.origin+"/rest/$info/progressinfo/" + widget.progressInfo, true);					else						xhr.open("GET", "/rest/$info/progressinfo/" + widget.progressInfo, true);                    xhr.send();                }            }, interval);            widget.timerStarted = true;        },        stopListening  : function () {            var            widget;            widget = this;            if (widget.timerStarted && widget.timeOutId != null) {                clearInterval(widget.timeOutId);                widget.timeOutId    = null;                widget.timerStarted = false;                widget.stillWaiting = false;                if (widget.atLeastOne) {                    widget.updateWithInfo({                        SessionInfo: [{                            fMessage: "",                            fValue: 0,                            fMax: 100,                            stop: true                        }]                    });                } else {                    widget.updateWithInfo({});                }            }        },        setProgressInfo  : function (config) {            var            widget;            widget = this;            widget.stopListening();            widget.progressInfo = config;        },        userBreak  : function () {            var            widget,            xhr;            widget  = this;            xhr     = new XMLHttpRequest();            xhr.open("GET", "rest/$info/progressinfo/"+widget.progressInfo+'?$stop="true"', true);            xhr.send();        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/progressBar/widget-progressBar-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'progressBar',    lib        : 'WAF',    description: 'Progress Bar',    category   : 'Misc. Controls',    img        : '/walib/WAF/widget/progressBar/icons/widget-progressBar.png',    tag        : 'div',    attributes : [    {        name       : 'data-progressinfo',        description: 'Progress Reference'    },    {        name       : 'class',        description: 'css class'    },    {        name        : 'data-showstop',        description : 'Show Stop Button',        type        : 'checkbox',        defaultValue: 'false'    },    {        name	    : 'data-no-empty-display',        description : "Hide if Inactive",        type	    : 'checkbox',        defaultValue: 'false'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Progress on {curValue} out of {maxValue}'    },    {        name        : 'data-label-position',        description : 'label position',        defaultValue: 'top'    }    ],    style: [    {        name        : 'width',        defaultValue: '300px'    },    {        name        : 'height',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D && D.isMobile) {                    result = "11px";                } else {                    result = "10px";                }                return result;            }        }.call()    }],    properties: {        style: {            theme        : true,            fClass       : true,            text         : false,            background   : true,            border       : true,            sizePosition : true,            shadow       : true,            disabled     : ['border-radius']        }    },    structure: [{        description : 'range',        selector    : '.waf-progressBar-range',        style: {            background  : true,            text        : true        }    }],    onInit: function (config) {        var progress = new WAF.widget.ProgressBar(config);        return progress;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var height = tag.getHeight(),        label = tag.getLabel();        if (label) {            label.getAttribute('data-text').setValue(tag.getAttribute('data-label').getValue());            label.onDesign();        }        if (!isResize){            /*             * add range div             */            $('<div class="waf-progressBar-range"><span>30%</span></div>')            .css({                width                       : '30%',                lineHeight                  : height + 'px',                '-webkit-background-size'   : height + 'px ' + height + 'px',                '-moz-background-size'      : height + 'px ' + height + 'px',                backgroundSize              : height + 'px ' + height + 'px'            }).appendTo('#' + tag.getId());        } else {            $('#' + tag.getId()).children('.waf-progressBar-range')            .css({                lineHeight                  : height + 'px',                '-webkit-background-size'   : height + 'px ' + height + 'px',                '-moz-background-size'      : height + 'px ' + height + 'px',                backgroundSize              : height + 'px ' + height + 'px'            })        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/matrix/widget-matrix.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Matrix',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        that,        htmlObject,        scrollSpeed,        matrix,        tmpBinding,        split;        that                = this;        htmlObject          = $(this.containerNode);        /*         * To prevent bug on preview into webcomponent         */        if (this.$domNode.parents('#cms-body').length > 0) {            return false;        }        matrix              = {};        that.subIDPrefix    = config.id + '-clone-';        that.containerId    = config.id + '-container';        that.scrollSpeed    = 500;        /*         * {Object} this.params parameters of the matrix         */        that.params         = {};        /*         * {Array} this.clones array of cloned elements of the matrix         */        that.clones         = [];        /*         * {String} this.scrolling scroll direction         */        that.scrolling      = data.scrolling || '';        if (that.scrolling === 'vertical') {            htmlObject.css({                'overflow-y' : 'auto',                'overflow-x' : 'hidden'            });        } else {            htmlObject.css({                'overflow-y' : 'hidden',                'overflow-x' : 'auto'            });        }        if (data.scrollbar === 'false') {            htmlObject.css({                'overflow-y' : 'hidden',                'overflow-x' : 'hidden'            });        }        /*         * Add the in_array function for arrays         * @method in_array         * @param {string} val value to find         */        Array.prototype.in_array = function(val) {            var            i,            l;            for( i = 0, l = this.length; i < l; i++) {                if(this[i] == val) {                    return true;                }            }            return false;        };        /*         * Get at least one source of the matrix children to associate it to matrix         */        tmpBinding = $($('#' + config.id + ' [data-binding]')[0]).attr('data-binding');        if (tmpBinding && tmpBinding.length > 0) {            split = tmpBinding.split('.');            if (split.length > 1) {                tmpBinding = split[0];            }            this.source = sources[tmpBinding];        }        that.tmpElt = 0;        that.tmp = 0;        that.scrollDirection = null;    },{        ready : function () {            $(WAF).bind('onWAFReady', {widget: this}, function(e) {                e.data.widget.create();            });        },        onComponentLoad : function(){            var that = this;            this.create();            setTimeout(function(){                that._rebuild();            }, 0);        },        _rebuild : function () {            /*             * Force matrix rebuild => loadComponent             */            if (this.source.ID) {                this.source.dispatch('onCollectionChange');            }        },        /*         * Resize method called on stop resize         * @method onResize         */        onResize : function matrix_on_resize() {            if (this.eventData) {                this.display(this.eventData);            }        },        getPosByRow : function matrix_get_pos_by_row (row) {            var            that,            result;            that    = this;            result  = (row * (that.elt[that.typeSize] + that.margin[that.typePos])) + that.margin[that.typePos];            return result;        },        getRowByPos : function matrix_get_row_by_pos (pos) {            var            that,            result,            totalRow;            that         = this;            totalRow    = Math.ceil(that.sourceRef.length/that.limit2);            result      = Math.floor((totalRow/that.sourceRef.length) * pos);            if (result < 0 ) {                result = 0;            }            return result;        },        getDisplayedRow : function matrix_get_displayed_row () {            var            that,            result,            scrollPosition;            that            = this;            if( WAF.PLATFORM.isTouch ) {                scrollPosition  = that.scrolling === 'vertical' ? -($("#mainContainer-"+that.config.id).position().top) : -($("#mainContainer-"+that.config.id).position().left);            } else {                scrollPosition  = that.scrolling === 'vertical' ? $('#' + that.config.id).scrollTop() : $('#' + that.config.id).scrollLeft();            }            // determine what is the row displayed depending on the scroll bar            result = Math.floor(scrollPosition / (that.elt[that.typeSize] + (that.margin[that.typePos])));            return result;        },        ucfirst : function ucfirst (str) {            var            f;            f = str.charAt(0).toUpperCase();            return f + str.substr(1);        },        /*         * Create the matrix         * @namespace WAF.widget.Matrix         * @method create         */        create  : function matrix_create() {            var            htmlObject,            currentSource,            nbSources,            widget,            thisSource,            aSource,            otherSources,            result,            elt,            i,            tmpID,            child,            that,            config,            params,            matrixChildren,            children,            thisId,            widgetContainer,            widgetLabel,            width,            height,            label,            margin,            otherSourcesLength,            containerConfig;            widget          = {};            thisSource      = [];            aSource         = [];            otherSources    = [];            result          = {};            elt             = {};            i               = 0;            that            = this;            config          = this.config;            params          = config;            htmlObject      = this.$domNode;            matrixChildren  = htmlObject.children();            that.tmpSubID   = 0;            that.ChildrenEvent = function() {};            /*             * Get ondraw event             */            var evt;            if (WAF.events[config.id] && WAF.events[config.id][0] && WAF.events[config.id][0].fn) {                for (i in WAF.events) {                    for (j = 0; j < WAF.events[i].length; j += 1) {                        evt = WAF.events[i][j];                        if (evt.name == "ChildrenDraw") {                            that.ChildrenEvent =evt.fn;                        }                    }                }            }            tmpID = 'waf-tmp-container-' + that.id;            // Get the matrix children to find a datasource            matrixChildren.each(function(e) {                var                subChild;                child = $(this);                if (child.attr('data-type') === 'container') {                    elt = {                        id      : child.attr('id'),                        widget  : WAF.widgets[child.attr('id')],                        width   : parseInt(child.css('width'), 10),                        height  : parseInt(child.css('height'), 10),                        left    : parseInt(child.css('left'), 10),                        top     : parseInt(child.css('top'), 10),                        htmlObj : $('#' + child.attr('id')),                        children: []                    };                    //children = $('#' + child.attr('id') + ' [data-binding]');                    children = $('#' + child.attr('id') + ' .waf-widget');                    // Get the container children                    children.each(function(e) {                        subChild = $(this);                        /*                         * Remove draggable and resizable to prevent function duplication                         */                        subChild.resizable('destroy');                        subChild.draggable('destroy');                        widget = WAF.widgets[subChild.attr('id')];                        if (subChild.attr('data-binding') && widget.source) {                            // Get the source of widget                            thisSource.push(widget.source);                        }                        elt.children.push(widget);                    });                } else {                    if (child.attr('data-binding')) {                        containerConfig = {                            id          : tmpID,                            'data-type' : 'container',                            'data-lib'  : 'WAF'                        };                        thisId          = child.attr('id');                        widgetContainer = new WAF.widget['Container'](containerConfig);                        width           = child[0].offsetWidth;                        height          = child[0].offsetHeight;                        label           = $("[for='" + thisId+ "']");                        margin          = params['data-margin'] ? parseInt(params['data-margin'], 10) : 10;                        $('<div />').attr({                            'id'        : tmpID,                            'data-type' : 'container'                        }).css('position', 'absolute').appendTo('#' + config.id).append(child);                        widgetContainer.config = containerConfig;                        // Get the source of widget                        widget = WAF.widgets[child.attr('id')];                        thisSource.push(widget.source);                        elt = {                            id      : containerConfig.id,                            widget  : widgetContainer,                            left    : margin,                            top     : margin,                            htmlObj : $('#' + containerConfig.id),                            children: []                        };                        elt.children.push(widget);                        if (label.length > 0) {                            $('#' + tmpID).append(label);                            widgetLabel = WAF.widgets[label.attr('id')];                            elt.children.push(widgetLabel);                            switch (child.attr('data-label-position')) {                                case 'top':                                case 'bottom':                                    height += parseInt(document.getElementById(label.attr('id')).offsetHeight, 10);                                    break;                                case 'left':                                case 'right':                                    width += parseInt(document.getElementById(label.attr('id')).offsetWidth, 10);                                    break;                            }                        }                        $('#' + tmpID).children().each(function(e) {                            subChild = $(this);                            subChild.css('left', parseInt(subChild.css('left'), 10) - margin + 'px');                            subChild.css('top', parseInt(subChild.css('top'), 10) - margin + 'px');                        });                        $('#' + tmpID).addClass('waf-widget');                        elt.width = width;                        elt.height = height;                    }                }            });            nbSources = thisSource.length;            // Get the data source name            if (nbSources > 0) {                aSource = thisSource[0];                if (nbSources > 1) {                    for (i = 0; i < nbSources; i += 1) {                        currentSource = thisSource[i];                        if (currentSource && currentSource._private.sourceType == 'dataClass' && currentSource._private.sourceType == 'relatedEntity') {                            aSource = currentSource;                        }                        if (currentSource._private.sourceType === "scalar") {                            otherSources.push(currentSource);                        }                    }                }                params.elt = elt;                otherSourcesLength = otherSources.length;                for (i = 0; i < otherSourcesLength; i += 1){                    otherSources[i].addListener("onCurrentElementChange", function(e) {                        e.dataSource.dispatch('onCurrentElementChange', {                            subID : that.tmpSubID,                            attributeName : e.attributeName                            }, {});                    });                }                if (!that._tmpListeners) {                    that._tmpListeners = {};                }                if (aSource.ID) {                    that._tmpListeners[aSource.ID] = true;                }                if (that._tmpListeners[aSource.ID] && !that.$domNode.parents('waf-component')) {                    return;                }                aSource.addListener("all", function(e) {                    /*                     * Do not execute listener function if matrix is disabled                     */                    if (e.data.that.isDisabled()) {                        return;                    }                    /*                     * Do not interact with hidden matrix                     */                    if (!e.dispatcherID) {                        var                        pos,                        element,                        displayedRow,                        calcul,                        row,                        firstPos,                        subIDValue,                        userData;                        pos             = e.dataSource.getPosition();                        element         = $('#' + config.id + ' [data-dspos="' + pos + '"]');                        subIDValue      = that.subIDPrefix + $('#' + element.attr('id')).attr('data-area');                        switch (e.eventKind) {                            case 'onBeforeCurrentElementChange' :                                // Do not automatically save if it's a slider                                if ($('#' + e.dispatcherID).attr('data-type') != 'slider' && e.data.that.clickOnElement) {                                    e.dataSource.save({                                        subID : subIDValue                                    });                                }                                e.data.that.clickOnElement = false;                                break;                            case 'onAttributeChange' :                                userData = e.userData || null;                                e.dataSource.dispatch('onAttributeChange', {                                    subID : subIDValue,                                    attributeName : e.attributeName                                    }, userData);                                break;                            case 'onCurrentElementChange' :                                if (!e.data.that.elt) {                                } else {                                    displayedRow            = e.data.that.getDisplayedRow();                                    calcul                  = (displayedRow + e.data.that.limit1) - 1;                                    row                     = e.data.that.getRowByPos(pos);                                    e.data.that.selectedDS     = pos;                                    e.data.that.currentPos     = pos;                                    // add selected class                                    element.addClass('waf-matrix-element waf-state-selected');                                    $('#' + config.id + ' .waf-container[data-dspos!="' + pos + '"]').removeClass('waf-state-selected');                                    // Scroll ony if the element is not already displayed                                    if ( element.length > 0 && row >= displayedRow && row <= calcul) {                                    // DO NOTHING                                    } else if (e.data.that.isVisible()){                                        e.data.that.goTo(pos);                                    }                                    userData = e.userData || null;                                    e.dataSource.dispatch('onCurrentElementChange', {                                        subID : subIDValue                                    }, userData);                                }                                break;                            case 'onCollectionChange' :                                if (e.dataSource.length === 0) {                                    /*                                     * Clear the matrix                                     */                                    e.data.that.clear();                                    /*                                     * Prevent code execution                                     */                                    return;                                }                                firstPos = e.dataSource.getPosition();                                e.data.that.selectedDS = firstPos;                                e.changeDs = true;                                e.data.that.display(e);                                // force select on the first element                                e.dataSource.select(firstPos, {                                    dispatcherID : config.id                                });                                /*                                 * Unbind scroll events                                 */                                htmlObject                                    .unbind('scroll')                                    .unbind('scrollstop');                                /*                                 * ADD SCROLL EVENTS                                 */                                htmlObject.bind('scroll', function matrix_scroll(e){                                    var                                    displayedRow,                                    i,                                    j,                                    orderLength,                                    num,                                    pos,                                    thisRowLength,                                    firstEltPos,                                    firstEltIndex,                                    currentRow,                                    currentContainer,                                    thisRow,                                    order,                                    firstEltDisplayed,                                    totalRows,                                    totalRealRow,                                    eltPos,                                    subIDValue,                                    limit2,                                    typePos,                                    sourceRef,                                    thatHtml;                                    thatHtml            = $(this);                                    displayedRow        = 0;                                    i                   = 0;                                    j                   = 0;                                    orderLength         = 0;                                    num                 = 0;                                    pos                 = 0;                                    thisRowLength       = 0;                                    firstEltPos         = 0;                                    firstEltIndex       = 0;                                    currentRow          = {};                                    currentContainer    = {};                                    thisRow             = {};                                    order               = [];                                    firstEltDisplayed   = null;                                    totalRows           = (that.limit1 + that.moreToShow);                                    totalRealRow        = Math.ceil(that.sourceRef.length/that.limit2);                                    eltPos              = 0;                                    sourceRef           = that.sourceRef;                                    limit2              = that.limit2;                                    typePos             = that.typePos;                                    /*                                     * Fix resize handle moving on scroll                                     */                                    if (thatHtml.attr('data-resizable')) {                                        if (that.scrolling == 'vertical') {                                            thatHtml.find('.ui-resizable-s,.ui-resizable-se').css('bottom', - thatHtml.scrollTop() + 'px');                                        } else {                                            thatHtml.find('.ui-resizable-e,.ui-resizable-se').css('right', - thatHtml.scrollLeft() + 'px');                                        }                                    }                                    /*                                     * Do not move containers if they are all displayed                                     */                                    if (totalRealRow <= totalRows) {                                        return false;                                    }                                    /*                                     * determine what is the row displayed depending on the scroll bar                                     */                                    displayedRow = that.getDisplayedRow();                                    if (displayedRow !== that.tmp) {                                        that.nbTmp += 1;                                        if (that.nbTmp === 1){                                            that.nbTmp = 0;                                            firstEltPos = that.getPosByRow(displayedRow);                                            /*                                             * To improve live scrolling                                             */                                            sourceRef.setDisplayLimits(that.divID, displayedRow*limit2, (displayedRow*limit2 + (totalRows*limit2)) );                                            /*                                             * Get the first element that must be displayed depending on the scroll                                             */                                            for (i = 0; i < totalRows; i += 1,firstEltIndex +=1) {                                                currentRow = $('#' + config.id + " [data-pos=" + i + "][data-type!=label]");                                                if ( parseInt(currentRow.css(typePos), 10) === firstEltPos) {                                                    firstEltDisplayed = currentRow;                                                    break;                                                }                                            }                                            if (firstEltDisplayed === null) {                                                firstEltIndex = -1;                                            }                                            order = [];                                            /*                                             * Get next element to order them                                             */                                            for (i = firstEltIndex + 1; i < totalRows; i += 1) {                                                num += 1;                                                order.push($('#' + config.id + " [data-pos=" + i + "][data-type!=label]"));                                            }                                            /*                                             * Get previous element to order them                                             */                                            for (i = 0; i < firstEltIndex; i += 1) {                                                order.push($('#' + config.id + " [data-pos=" + i + "][data-type!=label]"));                                            }                                            num = 0;                                            orderLength = order.length;                                            /*                                             * change first element position attribute                                             */                                            if (firstEltDisplayed && !firstEltDisplayed.is(':hidden')) {                                                firstEltDisplayed.attr('data-pos', num);                                            } else {                                                orderLength -= 1;                                                order[orderLength].show();                                                order[orderLength].css(typePos, firstEltPos + 'px');                                                order[orderLength].attr('data-pos', num);                                                order[orderLength].attr("data-dspos", displayedRow);                                                thisRowLength = order[orderLength].length;                                                for (j = 0; j <= thisRowLength; j += 1){                                                    currentContainer = $(order[orderLength][j]);                                                    if (currentContainer.attr('data-type') === 'container') {                                                        pos = ((displayedRow*limit2) + j);                                                        currentContainer.show();                                                        currentContainer.attr("data-dspos", pos);                                                        currentContainer.onDraw = that.ChildrenEvent;                                                        subIDValue = that.subIDPrefix + currentContainer.attr("data-area");                                                        var                                                        widget;                                                        widget = WAF.widgets[currentContainer.attr('id')];                                                        if (widget.setSplitPosition) {                                                            widget.setSplitPosition(WAF.widgets[currentContainer.attr('data-ref')].getSplitPosition());                                                        }                                                        $.each(currentContainer.children(), function() {                                                            var                                                            thatHtml,                                                            refHtml,                                                            currentWidget;                                                            currentWidget   = WAF.widgets[this.id];                                                            thatHtml        = $(this);                                                            refHtml         = $('#' + thatHtml.attr('data-ref'));                                                            if (currentWidget && currentWidget.kind != 'container') {                                                                if (currentWidget.source) {                                                                    currentWidget.clear(false);                                                                }                                                            }                                                            if (currentWidget && currentWidget.setSplitPosition) {                                                                currentWidget.setSplitPosition(WAF.widgets[thatHtml.attr('data-ref')].getSplitPosition());                                                            }                                                            if (thatHtml.attr('data-resizable') && thatHtml.attr('data-resizable') == 'true') {                                                                thatHtml.width(refHtml.width());                                                                thatHtml.height(refHtml.height());                                                            }                                                            if (thatHtml.attr('data-draggable') && thatHtml.attr('data-draggable') == 'true') {                                                                thatHtml.css('top', refHtml.css('top'));                                                                thatHtml.css('left', refHtml.css('left'));                                                            }                                                        });                                                        if (sourceRef.getPosition() == pos &&  that.currentPos == pos) {                                                            sourceRef.dispatch('onCurrentElementChange', {                                                                subID : subIDValue                                                            });                                                        }                                                        that.sourceSelect(sourceRef, pos, subIDValue, currentContainer);                                                    }                                                }                                            }                                            /*                                             * Order elements                                             */                                            for (i = 0; i < orderLength; i += 1) {                                                num += 1;                                                order[i].attr('data-pos', num );                                                thisRow = (displayedRow+num);                                                thisRowLength = order[i].length;                                                eltPos  = that.getPosByRow(thisRow);                                                /*                                                 * Move only those wrongly positioned                                                 */                                                if (parseInt(order[i].css(typePos), 10) != eltPos){                                                    for (j = 0; j <= thisRowLength; j += 1){                                                        currentContainer = $(order[i][j]);                                                        if (currentContainer.attr('data-type') === 'container') {                                                            pos = ((thisRow*limit2) + j);                                                            if (pos >= sourceRef.length) {                                                                currentContainer.hide();                                                            } else {                                                                currentContainer.show();                                                            }                                                            if (currentContainer.attr("data-dspos") != pos) {                                                                currentContainer.attr("data-dspos", pos);                                                                currentContainer.onDraw = that.ChildrenEvent;                                                                subIDValue = that.subIDPrefix +  currentContainer.attr("data-area");                                                                var                                                                widget;                                                                widget = WAF.widgets[currentContainer.attr('id')];                                                                if (widget.setSplitPosition) {                                                                    widget.setSplitPosition(WAF.widgets[currentContainer.attr('data-ref')].getSplitPosition());                                                                }                                                                $.each(currentContainer.children(), function() {                                                                    var                                                                    thatHtml,                                                                    refHtml,                                                                    currentWidget;                                                                    currentWidget   = WAF.widgets[this.id];                                                                    thatHtml        = $(this);                                                                    refHtml         = $('#' + thatHtml.attr('data-ref'));                                                                    if (currentWidget && currentWidget.kind != 'container') {                                                                        if (currentWidget.source) {                                                                            currentWidget.clear(false);                                                                        }                                                                    }                                                                    if (currentWidget && currentWidget.setSplitPosition) {                                                                        currentWidget.setSplitPosition(WAF.widgets[thatHtml.attr('data-ref')].getSplitPosition());                                                                    }                                                                    if (thatHtml.attr('data-resizable') && thatHtml.attr('data-resizable') == 'true') {                                                                        thatHtml.width(refHtml.width());                                                                        thatHtml.height(refHtml.height());                                                                    }                                                                    if (thatHtml.attr('data-draggable') && thatHtml.attr('data-draggable') == 'true') {                                                                        thatHtml.css('top', refHtml.css('top'));                                                                        thatHtml.css('left', refHtml.css('left'));                                                                    }                                                                });                                                                if (sourceRef.getPosition() == pos &&  that.currentPos == pos) {                                                                    sourceRef.dispatch('onCurrentElementChange', {                                                                        subID : subIDValue                                                                    });                                                                } else {                                                                    that.sourceSelect(sourceRef, pos, subIDValue, currentContainer);                                                                }                                                            }                                                        }                                                    }                                                    /*                                                     * Margin for the first element of the matrix                                                     */                                                    if (thisRow >= sourceRef.length || (thisRow*limit2) >= sourceRef.length) {                                                    // DO NOTHING                                                    } else {                                                        order[i].css(typePos, eltPos + 'px' );                                                        order[i].children().blur();                                                    }                                                }                                            }                                            $('#' + that.matrix.id + ' [data-dspos="' + that.selectedDS + '"][data-type!="checkbox"]').addClass('waf-matrix-element waf-state-selected');                                            $('#' + that.matrix.id + ' [data-dspos!="' + that.selectedDS + '"][data-type!="checkbox"]').removeClass('waf-state-selected');                                            /*sourceRef.select(that.selectedDS, {                                                dispatcherID : config.id                                            });*/                                        }                                        that.tmp = displayedRow;                                    }                                });                                /*                                 * Scrollstop event                                 */                                htmlObject.bind('scrollstop', function matrix_scroll_stop(e){                                    var                                    sourceRef;                                    sourceRef = that.sourceRef;                                    $.each($(this).find('.waf-matrix-element'), function(i){                                        var                                        currentContainer,                                        pos,                                        subIDValue;                                        currentContainer = $(this);                                        subIDValue = that.subIDPrefix + currentContainer.attr("data-area");                                        pos = currentContainer.attr('data-dspos');                                        currentContainer.onDraw = that.ChildrenEvent;                                        that.sourceSelect(sourceRef, pos, subIDValue, currentContainer);                                    });                                });                                /*                                 * TOUCH EVENTS                                 */                                if( WAF.PLATFORM.isTouch ) {                                    htmlObject                                        /*                                         * unbind touchmove events                                         */                                        .unbind('touchmove')                                        .unbind('touchend')                                        /*                                         * touchmove event                                         */                                        .bind('touchmove', function(){                                            $('#' + that.config.id).trigger('scroll');                                        })                                        /*                                         * touchend event                                         */                                        .bind('touchend', function() {                                            var                                            cont        = $("#mainContainer-"+that.config.id),                                            direction   = that.scrolling,                                            topStart,                                            count       = true,                                            topVal,                                            timer;                                            if (direction === "vertical") {                                                topStart    = cont.position().top;                                            } else {                                                topStart    = cont.position().left;                                            }                                            timer = setInterval( function() { //add interval in order to handle inertie scrolling                                                if (direction === "vertical") {                                                    topVal = cont.position().top;                                                } else {                                                    topVal = cont.position().left;                                                }                                                if( topVal != topStart || count ) {                                                    if( !count ) {                                                        $('#' + that.config.id).trigger('scroll');                                                    }                                                    count = false;                                                    topStart = topVal;                                                } else {                                                    clearInterval(timer);                                                    $('#' + that.config.id).trigger('scrollstop');                                                }                                            }, 200);                                        } );                                }                                break;                        }                    }                    that.eventData = e;                    if (that.config['data-draggable'] == 'true') {                        that.$domNode.draggable('option', 'handle', '.matrix-container');                    }                }, {                }, {                    widget  : result,                    params  : params,                    source  : aSource,                    that    : that                })            }        },        /**         * Go to indicated position         * @namespace WAF.widget.Matrix         * @method goTo         */        goTo : function matrix_goto(pos) {            var            that,            htmlObject,            row,            scrollPosition,            scrollConfig;            /*             * To prevent scrolling on matrix init             * + Do not move into the matrix if widget is disabled             */            if ((this._currentPos && this._currentPos == pos) || pos == -1 || this.isDisabled()) {                return;            }            this._currentPos = pos;            that            = this;            htmlObject      = $(this.containerNode);            row             = that.getRowByPos(pos);            scrollPosition  = that.getPosByRow(row) - that.margin[that.typePos2];            scrollConfig    = {};            scrollConfig    = that.scrolling === 'vertical' ? {scrollTop : scrollPosition} : {scrollLeft : scrollPosition};            //trigger touch end because no native scoll event is fired            if( WAF.PLATFORM.isTouch ) {                if (that.scrolling === 'vertical') {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(0px, -"+scrollPosition+"px, 0px) scale(1)";                } else {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(-"+scrollPosition+"px, 0px, 0px) scale(1)";                }                window.setTimeout(function(){$('#' + that.config.id).trigger('touchmove');},0);            } else {                htmlObject.animate(scrollConfig, that.scrollSpeed);            }        },        /**         * Go to first position         * @namespace WAF.widget.Matrix         * @method goToFirst         */        goToFirst : function matrix_goto_first() {            var            that;            that = this;            that.goTo(0);        },        /**         * Go to last position         * @namespace WAF.widget.Matrix         * @method goToLast         */        goToLast : function matrix_goto_last() {            var            that;            that = this;            that.goTo(that.sourceRef.length);        },        /**         * Go to next         * @namespace WAF.widget.Matrix         * @method goNext         */        goToNextPage : function matrix_goto_next_page() {            var            that,            htmlObject,            currentRow,            currentPos,            scrollConfig,            scrollPosition;            that            = this;            htmlObject      = $(this.containerNode);            currentRow      = that.getDisplayedRow();            currentPos      = that.getPosByRow(currentRow + (that.limit1));            scrollConfig    = {};            scrollPosition  = currentPos - 10;            scrollConfig    = that.scrolling === 'vertical' ? {scrollTop : scrollPosition} : {scrollLeft : scrollPosition};            //trigger touch end because no native scoll event is fired            if( WAF.PLATFORM.isTouch ) {                if (that.scrolling === 'vertical') {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(0px, -"+scrollPosition+"px, 0px) scale(1)";                } else {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(-"+scrollPosition+"px, 0px, 0px) scale(1)";                }                window.setTimeout(function(){$('#' + that.config.id).trigger('touchmove');},0);            } else {                htmlObject.animate(scrollConfig, that.scrollSpeed);            }        },        /**         * Go to previous         * @namespace WAF.widget.Matrix         * @method goPrevious         */        goToPreviousPage : function matrix_goto_previous_page() {            var            that,            htmlObject,            currentRow,            currentPos,            scrollConfig,            scrollPosition;            that            = this;            htmlObject      = $(this.containerNode);            currentRow      = that.getDisplayedRow();            currentPos      = that.getPosByRow(currentRow - that.limit1);            scrollConfig    = {};            scrollPosition  = currentPos - 10;            scrollConfig    = that.scrolling === 'vertical' ? {scrollTop : scrollPosition} : {scrollLeft : scrollPosition};            //trigger touch end because no native scoll event is fired            if( WAF.PLATFORM.isTouch ) {                if (that.scrolling === 'vertical') {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(0px, -"+scrollPosition+"px, 0px) scale(1)";                } else {                    $("#mainContainer-"+that.config.id).get()[0].style.webkitTransform = "translate3d(-"+scrollPosition+"px, 0px, 0px) scale(1)";                }                window.setTimeout(function(){$('#' + that.config.id).trigger('touchmove');},0);            } else {                htmlObject.animate(scrollConfig, that.scrollSpeed);            }        },        /**         * Get the total number of pages         * @namespace WAF.widget.Matrix         * @method getTotalPages         */        getTotalPages : function matrix_get_total_pages() {            var            that,            totalRows,            result;            that        = this;            totalRows   = Math.ceil(that.sourceRef.length/that.limit2);            result      = Math.ceil(totalRows/that.limit1);            return result;        },        /**         * Get the current page         * @namespace WAF.widget.Matrix         * @method getCurrentPage         */        getCurrentPage : function matrix_get_current_page() {            var            that,            totalRows,            totalPages,            currentRow,            result;            that        = this;            totalRows   = Math.ceil(that.sourceRef.length/that.limit2);            totalPages  = that.getTotalPages();            currentRow  = that.getDisplayedRow();            result      = (currentRow*totalPages)/totalRows;            return result;        },        /**         * Clone widgets events         * @namespace WAF.widget.Matrix         * @method cloneEvents         */        cloneEvents : function matrix_clone_events(id, element) {            var            k,            events;            events  = WAF.events[id];            if (events) {                for (k = 0; k < events.length; k += 1) {                    element.bind(events[k].name, {k : k}, function (e) {                        var                        widget;                        widget              = $$(this.id);                        if (widget) {                            widget._tmpEventsFn = events[e.data.k].fn;                            widget._tmpEventsFn(e);                        }                    });                }            }        },        /**         * Display the  matrix         * @namespace WAF.widget.Matrix         * @method display         */        display : function matrix_display(e) {            var            thisConfig,            cloneConfig,            childConfig,            children,            container,            childrenHtml,            dsPos,            limit1,            limit2,            pos1,            pos2,            columns,            rows,            i,            j,            c,            n,            tmpID,            moreToShow,            params,            scrolling,            sourceRef,            typePos,            typePos2,            typeSize,            typeSize2,            elt,            eltHtml,            containerClone,            margin,            matrix,            oldID,            childrenConfig,            allChildren,            focusOnElement,            subIDValue,            oldChild,            inputElements,            that,            htmlObject,            config,            idList,            totalRow,            currentRow,            childrenLength,            eltChildrenLength;            that            = this;            htmlObject      = $('#' + this.id);            config          = this.config;            thisConfig      = {};            cloneConfig     = {};            childConfig     = {};            children        = {};            container       = {};            childrenHtml    = {};            dsPos           = 0;            limit1          = 0;            limit2          = 0;            pos1            = 0;            pos2            = 0;            columns         = 0;            rows            = 0;            moreToShow      = 2;            params          = e.data.params;            scrolling       = params['data-scrolling'];            sourceRef       = e.data.source;            typePos         = scrolling === 'vertical' ? 'top' : 'left';            typePos2        = scrolling === 'vertical' ? 'left' : 'top';            typeSize        = scrolling === 'vertical' ? 'height' : 'width';            typeSize2       = scrolling === 'vertical' ? 'width' : 'height';            elt             = params.elt;            eltHtml         = elt.htmlObj;            containerClone  = null;            margin          = {                left : params['data-margin'] ? parseInt(params['data-margin']) : 10,                top : params['data-margin'] ? parseInt(params['data-margin']) : 10            }            matrix          = {                id      : params.id,                margin  : margin,                width   : parseInt($('#' + params.id).css('width')),                height  : parseInt($('#' + params.id).css('height'))            };            // Calcul how many widgets can be had,            columns = Math.floor(matrix.width / (elt.width + margin.left));            rows    = Math.floor(matrix.height / (elt.height + margin.top));            thisConfig = params.elt.widget.config;            // Get the widget config            for (n in thisConfig) {                cloneConfig[n] = thisConfig[n];            }            pos2 = margin.top;            pos1 = margin.left;            // First : remove all created clones            $('#' + thisConfig.id).show();            that.original = $('#' + matrix.id + " #" + thisConfig.id).addClass('waf-widget-matrix-original');            //$('#' + matrix.id + " #" + thisConfig.id).appendTo('body');            if (scrolling === 'vertical') {                limit1 = rows;                limit2 = columns;            } else {                limit1 = columns;                limit2 = rows;            }            /*             * Set variables as attribute of the matrix widget             */            that.elt            = elt;            that.typePos        = typePos;            that.typePos2       = typePos2;            that.typeSize       = typeSize;            that.typeSize2      = typeSize2;            that.margin         = margin;            that.scrolling      = scrolling;            that.limit2         = limit2;            that.limit1         = limit1;            that.moreToShow     = moreToShow;            that.sourceRef      = sourceRef;            /*             * FOR MATRIX RESIZE             */            if (that.tmpColumns != columns || that.tmpRows != rows) {                // DO NOTHING                if (typeof(that.tmpColumns) != 'undefined') {                    currentRow  = that.getDisplayedRow();                    totalRow    = Math.ceil(that.sourceRef.length/that.limit2);                    /*                     * To prevent resize bug when on last row                     */                    if (currentRow > totalRow) {                        currentRow = totalRow                    }                    dsPos   = currentRow * that.limit2;                    pos2    = that.getPosByRow(currentRow);                    if (dsPos >= sourceRef.length) {                        dsPos = (sourceRef.length-1) - (that.limit2*(that.limit1 + moreToShow));                    }                    sourceRef.setDisplayLimits(that.divID, currentRow*that.limit2, (currentRow*that.limit2 + (currentRow*that.limit2)) );                }                /*                 * Remove existing listeners                 */                idList = []                $.each(htmlObject.find('.waf-widget'), function() {                    idList.push($(this).attr('id'))                })                $.each(sourceRef._private.listeners, function() {                    if (this.id && new RegExp(this.id).test(idList.join(','))) {                        //sourceRef.removeListener(this)                    }                });            } else if (!e.changeDs){                eltHtml.hide();                return;            }            that.tmpRows = rows;            that.tmpColumns = columns;            htmlObject.children(':not(.waf-widget-matrix-original,.ui-resizable-handle)').remove();            tmpID = 'waf-temp-container-' + that.id;            var tmpContainer = $('<div/>').prop('id', tmpID).css({                'height' : '100%',                'width' : '100%'            }).appendTo(htmlObject);            // Container is used to define the scroll size            container = $('<div/>').addClass('matrix-container').appendTo(tmpContainer);            if( WAF.PLATFORM.isTouch ) {                container.get()[0].id = "mainContainer-"+matrix.id;                that.tempContainerId = "waf-temp-container-"+matrix.id;                setTimeout(function () {                    scrollObj = new iScroll(tmpID);                }, 100);            }            that.totalSize = ((elt[typeSize] + margin[typePos]) * Math.ceil(sourceRef.length/limit2));            container.css(typeSize, that.totalSize + margin[typePos2] + 'px');            container.css(typeSize2, matrix[typeSize2] - 30 + 'px');            for (i = 0; i < limit1 + moreToShow; i += 1) {                pos1 = margin[typePos2];                for (j = 0; j < limit2; j += 1) {                    cloneConfig.id = 'clone-' + thisConfig.id + '-' + i + '-' + j;                    subIDValue = that.subIDPrefix + i + '-' + j;                    // if container, also clone children                    if (elt.widget.kind === 'container' && elt.children && elt.children.length > 0 ) {                        if (dsPos < sourceRef.length) {                            /// Clone html element                            eltHtml.clone().attr('id', cloneConfig.id).appendTo(container);                            containerClone = $('#' + cloneConfig.id);                            containerClone.children('.waf-splitter').remove();                            // Add on draw function on the matrix                            containerClone.onDraw = that.ChildrenEvent;                            containerClone.css(typePos, pos2 + 'px');                            containerClone.css(typePos2, pos1 + 'px');                            // Add events                            that.cloneEvents(thisConfig.id, containerClone);                            containerClone.css({                                'width'     : elt.width + 'px',                                'height'    : elt.height + 'px',                                'position'  : 'absolute'                            })                            // Set cloneConfig row/column position                            .attr({                                'data-area' : i + '-' + j,                                'data-pos'  : i,                                'data-dspos': dsPos,                                'data-ref'  : thisConfig.id                            })                            // Add class                            .addClass('waf-matrix-element waf-matrix-clone waf-clone-' + elt.id);                            // Clone widget                            new WAF.widget[that.ucfirst(elt.widget.kind)](cloneConfig);                            children = $('#' +  cloneConfig.id + ' [id]');                            childrenLength = children.length;                            var                            width,                            height;                            for (c = 0; c < childrenLength; c += 1) {                                childrenHtml    = $(children[c]);                                oldID           = childrenHtml.attr('id');                                oldChild        = $('#' + oldID);                                width           = oldChild.outerWidth() + 'px';                                height          = oldChild.outerHeight() + 'px';                                if (oldChild.attr('data-constraint-right') == 'true' && oldChild.attr('data-constraint-left') == 'true') {                                    width = 'auto';                                }                                if (oldChild.attr('data-constraint-top') == 'true' && oldChild.attr('data-constraint-bottom') == 'true') {                                    height = 'auto';                                }                                // fix clones position                                childrenHtml.css({                                    'top'       : oldChild.css('top'),                                    'left'      : oldChild.css('left'),                                    'right'     : oldChild.css('right'),                                    'bottom'    : oldChild.css('bottom'),                                    'position'  : oldChild.css('position'),                                    'width'     : width,                                    'height'    : height                                });                                // add class                                childrenHtml.addClass('waf-clone-' + oldID);                                // change id                                childrenHtml.attr({                                    'id'        : 'clone-' + oldID + '-' + i + '-' + j,                                    'data-ref'  : oldID                                });                                childrenHtml.addClass('waf-matrix-clone');                                // Add events                                that.cloneEvents(oldID, childrenHtml);                            }                            eltChildrenLength = elt.children.length;                            for (c = 0; c < eltChildrenLength; c += 1) {                                // Get the widget config                                childConfig = {};                                childrenConfig = elt.children[c];                                for (n in elt.children[c].config) {                                    childConfig[n] = childrenConfig.config[n];                                }                                // Clone children element only if there is a DS                                if (childrenConfig.config && childrenConfig.source && (dsPos <  childrenConfig.source.length)) {                                    childConfig.subID = subIDValue;                                }                                childConfig.id = 'clone-' + childrenConfig.config.id + '-' + i + '-' + j;                                new WAF.widget[that.ucfirst(childrenConfig.kind)](childConfig);                                // CASE OF SOURCE IS RELATED                                if (childrenConfig.source && childrenConfig.source._private.sourceType != 'dataClass' && childrenConfig.source._private.sourceType != 'relatedEntity') {                                    // Clone children element only if there is a DS                                    childConfig.id = 'clone-' + childrenConfig.config.id + '-' + i + '-' + j;                                    childConfig.subID = subIDValue;                                    new WAF.widget[that.ucfirst(childrenConfig.kind)](childConfig);                                }                            }                            // dispatch value to widgets                            if (sourceRef) {                                that.sourceSelect(sourceRef, dsPos, subIDValue, containerClone);                            }                            //return;                            inputElements = $('#' + containerClone.attr('id') + ' input[data-binding],textarea[data-binding]');                            inputElements.unbind('blur');                            inputElements.bind('blur', {}, function(e) {                                that.focused = null;                            });                            var focusFunction = function matrix_children_focus(e) {                                this.textInputChanged = WAF.widgets[this.id].change;                                $(this).bind('change', {}, function() {                                    this.textInputChanged();                                });                                focusOnElement(e);                                that.focused = this;                            }                            focusOnElement = function focusOnElement (e) {                                var                                thatElt,                                source;                                if (that.focused && $(that.focused).parent().attr('data-dsPos') != $(this).attr('data-dsPos') && that.focused != this ) {                                    // remove change event for text input                                    $(that.focused).unbind('change');                                    that.focused.textInputChanged = WAF.widgets[that.focused.id].change;                                    that.focused.textInputChanged();                                    that.focused = null;                                }                                thatElt    = e.data.element;                                source     = e.data.source;                                that.clickOnElement = true;                                source.select(parseInt(thatElt.attr('data-dsPos')));                            }                            inputElements.unbind('focusin', focusFunction);                            inputElements.bind('focusin', {                                source  : sourceRef,                                element : containerClone                            }, focusFunction);                            // Add click event on container                            containerClone.bind('mousedown', {                                source  : sourceRef,                                element : containerClone                            }, focusOnElement);                            allChildren = $('#' + containerClone.attr('id') + ' *');                            // Add click event on all children                            allChildren.bind('mousedown', {                                source  : sourceRef,                                element : containerClone                            }, focusOnElement);                        }                    }                    // Increment position                    pos1 += (elt[typeSize2] + margin[typePos2]);                    // Increment position of element in the DS                    dsPos += 1;                    if (containerClone) {                        containerClone.addClass("waf-clone-" + elt.id);                    }                }                // Increment position                pos2 += (elt[typeSize] + margin[typePos]);            }            // Do not display the originale element            $('#' + thisConfig.id).hide();            //eltHtml.css('left', '-100000px')            // Reset tmp variables            that.tmp     = 0;            that.nbTmp   = 0;            that.matrix = matrix;            that.matrix.limit1 = limit1;            that.matrix.limit2 = limit2;            that.matrix.elt = elt;        },        /**         * select and display         * @namespace WAF.widget.Matrix         * @method sourceSelect         */        sourceSelect : function matrix_source_select(source, pos, subId, container){            var            that;            that = this;            pos = parseInt(pos);            source.select(pos, {                subID: subId,                stop: true,                onSuccess   : function(e) {                    that.tmpSubID = e.data.subID;                    e.data.htmlObject.onDraw();                },                delay   : 10,                delayID : that.divID            },{                htmlObject : container,                subID      : subId            });        },        /**         * DEPRECATED         */        goToNext : function(){            return this.goToNextPage()        },        /**         * DEPRECATED         */        goToPrevious : function(){            return this.goToPreviousPage()        },        /**         * Custom getChildren function         * @method getChildren         */        getChildren : function matrix_getChildren() {            var            widget,            children,            htmlObject;            htmlObject  = this.$domNode;            children    = [];            $.each(htmlObject.find('.matrix-container').children(), function(i) {                widget = $$($(this).attr('id'));                if (widget) {                    children.push(widget);                }            });            return children;        },        /**         * Custom disable function (disable sub widgets)         * @method disable         */        disable : function matrix_disable() {            var            i,            children,            childrenLength;            children = this.getChildren();            childrenLength = children.length;            /*             * Disable all sub widgets             */            for (i = 0; i < childrenLength; i += 1) {                children[i].disable();            }            /*             * Call super class enable function             */            WAF.Widget.prototype.disable.call(this);            /*             * Remove scrollbar             */            this.$domNode.css('overflow', 'hidden');            /*             * hide resize handle             */            this.$domNode.children('.ui-resizable-handle').hide();        },        /**         * Custom enable function (enable sub widgets)         * @method enable         */        enable : function matrix_enable() {            var            i,            children,            childrenLength;            children = this.getChildren();            childrenLength = children.length;            /*             * Enable all sub widgets             */            for (i = 0; i < childrenLength; i += 1) {                children[i].enable();            }            /*             * Call super class enable function             */            WAF.Widget.prototype.enable.call(this);            /*             * Display scrollbar             */            if (this.scrolling === 'vertical') {                this.$domNode.css({                    'overflow-y' : 'auto',                    'overflow-x' : 'hidden'                });            } else {                this.$domNode.css({                    'overflow-y' : 'hidden',                    'overflow-x' : 'auto'                });            }            /*             * Display resize handle             */            this.$domNode.children('.ui-resizable-handle').show();        },        clear : function matrix_clear() {            this.$domNode.children().hide();        }    });/* * ScrollStart & ScrollStop special events */$.event.special.scrollstart = {    setup: function() {        var timer,        handler =  function(evt) {            var _self = this,            _args = arguments;            if (timer) {                clearTimeout(timer);            } else {                evt.type = 'scrollstart';                $.event.handle.apply(_self, _args);            }            timer = setTimeout( function(){                timer = null;            }, $.event.special.scrollstop.latency);        };        jQuery(this).bind('scroll', handler).data('D' + (+new Date()), handler);    },    teardown: function(){        jQuery(this).unbind( 'scroll', jQuery(this).data('D' + (+new Date())) );    }};$.event.special.scrollstop = {    latency: 300,    setup: function() {        var timer,        handler = function(evt) {            var _self = this,            _args = arguments;            if (timer) {                clearTimeout(timer);            }            timer = setTimeout( function(){                timer = null;                evt.type = 'scrollstop';                $.event.handle.apply(_self, _args);            }, $.event.special.scrollstop.latency);        };        jQuery(this).bind('scroll', handler).data('D' + (+new Date() + 1), handler);    },    teardown: function() {        jQuery(this).unbind( 'scroll', jQuery(this).data('D' + (+new Date() + 1)) );    }};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/matrix/widget-matrix-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'matrix',    lib         : 'WAF',    description : 'Matrix',    category    : 'Containers/Placeholders',    img         : '/walib/WAF/widget/matrix/icons/widget-matrix.png',    tag         : 'div',    attributes  : [    {        name        : 'class',        description : 'Css class'    },    {        name        : 'data-margin',        description : 'Margin',        defaultValue: 10,        typeValue   : 'integer',        slider      : {            min : 0,            max : 50        }    },    {        name        : 'data-fit',        description : 'Auto Fit',        type        : 'checkbox',        defaultValue: 'false',        onclick   : function (argument) {            if (this.getValue() == true) {                this.data.tag.getAttribute('data-fit').setValue('true');            } else {                this.data.tag.getAttribute('data-fit').setValue('false');            }            this.data.tag.rebuild();        }    },    {        name        : 'data-scrolling',        description : 'Scrolling',        type        : 'dropdown',        options     : [{                key     : 'vertical',                value   : 'Vertical'        },{                key     : 'horizontal',                value   : 'Horizontal'        }],        defaultValue: 'vertical'    },    {        name        : 'data-scrollbar',        description : 'Scrollbar',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox',        platform    : 'desktop'    },    {        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox',        platform    : 'desktop'    }],    style: [    {        name        : 'width',        defaultValue: '500px'    },    {        name        : 'height',        defaultValue: '500px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'onChildrenDraw',        description: 'On Draw',        category   : 'Matrix Children Events'    },    {        name        : 'startResize',        description : 'On Start Resize',        category    : 'Resize'    },    {        name        : 'onResize',        description : 'On Resize',        category    : 'Resize'    },    {        name        : 'stopResize',        description : 'On Stop Resize',        category    : 'Resize'    }],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : false,            dropShadow  : true,            innerShadow : true,            disabled    : []        }    },    structure: [],    onInit: function (config) {        return new WAF.widget.Matrix(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {    },    onCreate : function (tag, param) {        /**         * Clean the matrix content         * @function clean         */        tag.clean = function () {            var            child,            except;            child   = this._childTag;            if (child) {                except  = '[id!="' + child.getOverlayId() + '"]';                if (child.getLinkedTag()) {                    except += '[id!="' + child.getLinkedTag().getOverlayId() + '"]';                }                this.getHtmlObject().children( except ).remove();                if(this._childTag) {                    this._childTag._matrix = null;                    this._childTag = null;                }            }        }        /**         * Rebuild the matrix and create clones         * @function rebuild         */        tag.rebuild = function() {            if (this._childTag && !this._childTag.isLabel()) {                var                i,                j,                top,                left,                rows,                child,                width,                label,                height,                except,                margin,                calcul,                columns,                autoFit,                cloneId,                topLabel,                matrixId,                initWidth,                marginTop,                leftLabel,                idToClone,                marginLeft,                initHeight,                overlayHtml,                matrixWidth,                resizeWidth,                matrixHeight,                initTopLabel,                resizeHeight,                initMarginTop,                initLeftLabel,                initMarginLeft;                this.isRebuild  = true;                autoFit         = this.getAttribute('data-fit').getValue() === true || this.getAttribute('data-fit').getValue() === 'true' ? true : false;                child   = this._childTag;                except  = '[id!="' + child.getOverlayId() + '"]';                if (child.getLinkedTag()) {                    except += '[id!="' + child.getLinkedTag().getOverlayId() + '"]';                }                // clean the matrix                $('#' + this.getId()).children( except ).remove();                // set the element position                margin          = tag.getAttribute('data-margin') ? parseInt(this.getAttribute('data-margin').getValue()) : 0;                initMarginLeft  = margin;                initMarginTop   = margin;                marginLeft      = 0;                marginTop       = 0;                width           = child.getWidth();                height          = child.getHeight();                left            = 0;                top             = 0;                matrixHeight    = tag.getHeight();                matrixWidth     = tag.getWidth();                rows            = 0;                columns         = 0;                initHeight      = 0;                initWidth       = 0;                cloneId         = '';                topLabel        = 0;                leftLabel       = 0;                initTopLabel    = 0;                initLeftLabel   = 0;                matrixId        = tag.getId();                idToClone       = child.getOverlayId();                resizeWidth     = 0;                resizeHeight    = 0;                marginLeft      = initMarginLeft;                marginTop       = initMarginTop;                label           = child.getLabel();                // Link the tag to the current matrix                child._matrix = this;                if (label) {                    label._matrix = this;                    switch (child.getAttribute('data-label-position').getValue()) {                        case 'top':                            marginTop   += label.getHeight();                            height      += label.getHeight();                            break;                        case 'right':                            width       += label.getWidth();                            break;                        case 'bottom':                            height      += label.getHeight();                            break;                        case 'left':                            marginLeft  += label.getWidth();                            width       += label.getWidth();                            break;                    }                }                child.setXY(marginLeft, marginTop, true);                initHeight  = (parseInt(initMarginTop) + height);                initWidth   = (parseInt(initMarginLeft) + width);                /*                 * Calcul number of elements for the height                 */                calcul      = matrixHeight / initHeight;                rows        = Math.ceil(calcul) - 1;                if (calcul%1==0) {                    rows += 1;                }                /*                 * Calcul number of elements for the width                 */                calcul      = matrixWidth / initWidth;                columns     = Math.ceil(matrixWidth / initWidth) - 1;                if (calcul%1==0) {                    columns += 1;                }                /*                 * Resize the matrix to appropriate size                 */                if (autoFit) {                    if (columns === 0) {                        columns = 1;                    }                    if (rows === 0) {                        rows = 1;                    }                    resizeWidth     = (initWidth*columns) + parseInt(initMarginLeft);                    resizeHeight    = (initHeight*rows) + parseInt(initMarginTop);                    if (this.getAttribute('data-scrollbar').getValue() !== 'false') {                        if (this.getAttribute('data-scrolling').getValue() === 'vertical') {                            resizeWidth += 15;                        } else {                            resizeHeight += 15;                        }                    }                    resizeWidth     += 'px';                    resizeHeight    += 'px';                    overlayHtml = $('#' + this.getOverlayId());                    overlayHtml.css('width', resizeWidth);                    overlayHtml.css('height', resizeHeight);                    this.setStyle('width', resizeWidth);                    this.setStyle('height', resizeHeight);                    this.domUpdate();                }                // Add clone class for WYSIWYG                $('#' + idToClone + ' .waf-widget').each(function(e) {                    var                    thisHtml;                    thisHtml = $(this);                    thisHtml.addClass('waf-matrix-element waf-clone-' + thisHtml.prop('id'));                });                var createClone = function( matrixId, idToClone, cloneId, newTop, newLeft ) {                    var                    elt,                    clone;                    elt     = $('#' + idToClone);                    elt.clone(false, true).prop('id', cloneId).appendTo('#' + matrixId);                    clone   = $('#' + cloneId);                    clone.unbind('click');                    clone.unbind('dblclick');                    clone.unbind('mousedown');                    clone.unbind('mouseup');                    clone.ready(function() {                        var                        $that,                        ctx,                        canvas,                        width,                        height,                        $all;                        $that   = clone;                        $all    = $('#' + cloneId + ' *');                        // remove useless elements                        $that.find('.yui-resize-handle').remove();                        $that.removeClass('waf-focus');                        $all.addClass('waf-matrix-clone');                        $all.removeProp('id');                        $that.css({                            'top'       : newTop + 'px',                            'left'      : newLeft + 'px',                            'opacity'   : '0.5',                            'outline'   : 'none'                        });                        canvas = clone.find('canvas');                        if (canvas.length > 0) {                            width   = canvas.width();                            height  = canvas.height();                            canvas  = canvas[0];                            ctx     = canvas.getContext("2d");                            ctx.fillStyle = "rgb(200,0,0)";                            ctx.fillRect(0, 0, width/2, height / 2);                            ctx.fillStyle = "rgba(0, 50, 200, 0.5)";                            ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);                        }                    });                }                if (child.getLabel()) {                    initTopLabel    = child.getLabel().getY();                    initLeftLabel   = child.getLabel().getX();                }                for (i = 0; i < rows; i += 1) {                    cloneId     = 'waf_ghost_' + child.getOverlayId() + '_' + i,                    newTop      = (initHeight * i) + marginTop,                    newLeft     = parseInt(left) + marginLeft;                    topLabel    = initTopLabel + (initHeight * i);                    if ( i != 0) {                        createClone( matrixId, idToClone, cloneId, newTop, newLeft );                        if (child.getLabel()) {                            createClone( matrixId, child.getLabel().getOverlayId(), cloneId + '_' + child.getLabel().getId(), topLabel, initLeftLabel );                        }                    }                    for (j = 1; j < columns; j += 1) {                        cloneId = 'waf_ghost_' + child.getOverlayId() + '_' + i + '_' + j,                        newLeft = (initWidth * j) + marginLeft;                        createClone( matrixId, idToClone, cloneId, newTop, newLeft );                        if (child.getLabel()) {                            leftLabel = initLeftLabel + (initWidth * j);                            createClone( matrixId, child.getLabel().getOverlayId(), cloneId + '_' + child.getLabel().getId(), topLabel, leftLabel );                        }                    }                }                this.isRebuild =  false;            }        }        /*         * Custom on resize event         */        $(tag).bind('onResize', function () {            this.rebuild();        })    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/toolbar/widget-toolbar.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.widget.Toolbar = function(elements) {    var toolbarNode = $('<ul class="waf-toolbar"></ul>');    $(elements).each(function(i, element) {        var elementNode = $('<li class="waf-toolbar-element ' + [].concat(element.className).join(' ') + '" title="' + element.title + '"></li>');        if (element.icon) {            var icon = new WAF.widget.Icon(element.icon);            elementNode.append(icon.containerNode);        }        if (element.text) {            elementNode.append(element.text);        }        if (element.click) {            elementNode.click(element.click);        }        toolbarNode.append(elementNode);    });    return toolbarNode;};/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/combobox/widget-combobox.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Combobox',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        source,        widget,        options,        firstInit,        htmlObject,        optionsLength;        widget              = this;        htmlObject          = $(this.containerNode);        this._combobox      = htmlObject.children('select');        this._key           = data['binding-key'];        this._autoDispatch  = !data['autoDispatch'] || data['autoDispatch'] == 'false' ? false : true;        this._limit         = !data['limit'] ? this._limit : parseInt(data['limit']);        source = this.source;        if (source) {            options         = data['binding-options'].replace(/\[/g, '').replace(/\]/g, '').split(' ');            this._options   = [];            for (i = 0; i < options.length; i += 1) {                if (options[i]) {                    this._options.push(options[i])                }            }            optionsLength   = options.length;            this._combobox.html('');            source.addListener('all', function(e) {                var                i,                ds,                dsID,                kind,                attr,                value,                index,                widget,                dsLength,                dataSource;                widget      = e.data.widget;                kind        = e.eventKind;                dataSource  = e.dataSource;                dsID        = e.dataSource.getID();                switch(kind) {                    case 'onCollectionChange' :                        widget.clear();                        firstInit   = true;                        dsLength    = dataSource.length;                        widget._tmp = {};                        for (i = 0; i < dsLength; i += 1) {                            index = i;                            if (!widget._limit || i < widget._limit) {                                dataSource.getElement(i, {                                    onSuccess : function(e){                                        var                                        i,                                        ds,                                        value,                                        widget,                                        option,                                        attribute,                                        identifier;                                        ds      = e.data.source;                                        option  = [];                                        widget  = e.data.widget;                                        if (e.element) {                                            for (i = 0; i < optionsLength; i += 1) {                                                attribute   = options[i];                                                if (attribute) {                                                    value = e.element[attribute];                                                    /*                                                     * Format value depending on ds attribute format                                                     */                                                    if (e.dataSource && e.dataSource.getAttribute(attribute).dataClassAtt) {                                                        format  = e.dataSource.getAttribute(attribute).dataClassAtt.defaultFormat;                                                        value   = WAF.utils.formatString(value, format);                                                    }                                                    option.push(value);                                                }                                            }                                            if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                                                widget._primary = ds._private.attNameList[0];                                            }                                            attr = (!widget._key || dsID == widget._key) ? widget._primary : widget._key;                                            if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                                                identifier  = e.position;                                            } else {                                                identifier = e.element[widget._primary];                                            }                                            widget._tmp[index] = identifier;                                            widget.addOption(e.element[attr], option.join(' '));                                        }                                    }                                }, {                                    source : dataSource,                                    widget : widget                                });                            }                        }                        /*                         * Select sourceout value after sourcein has been loaded                         */                        if (widget._tmpValue && widget.sourceOut) {                            widget.setValue(widget._tmpValue);                        }                        break;                    case 'onCurrentElementChange' :                        if (widget._autoDispatch) {                            ds      = e.dataSource;                            if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                                widget._primary = ds._private.attNameList[0];                            }                            attr    = (!widget._key || dsID == widget._key) ? widget._primary : widget._key;                            value   = e.dataSource.getAttributeValue(attr);                            /*                             * If value is not into the limit of displayed options                             */                            if (value !== null && widget.$domNode.find('option[value="' + value + '"]').length === 0) {                                var                                i,                                pos,                                first,                                count,                                collection;                                i           = 0;                                count       = 0;                                pos         = ds.getPosition();                                collection  = ds.getEntityCollection();                                widget._tmp = {};                                widget.clear();                                if (!collection) {                                    return;                                }                                if (pos + 5 > collection.length) {                                    first = collection.length - 5;                                } else {                                    first = pos;                                }                                widget._posInCombo = {};                                collection.each(function(elt) {                                    var                                    j,                                    values;                                    if (i >= first && count < widget._limit) {                                        values = [];                                        for (j = 0; j < optionsLength; j += 1) {                                            attribute   = options[j];                                            if (attribute) {                                                values.push(elt.entity[attribute].value);                                            }                                        }                                        widget._posInCombo[elt.position] = count;                                        attr = (!widget._key || dsID == widget._key) ? widget._primary : widget._key;                                        if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                                            identifier  = elt.position;                                        } else {                                            identifier = elt.entity[widget._primary].value;                                        }                                        widget._tmp[count] = identifier;                                        widget.addOption(elt.entity[attr].value, values.join(' '));                                        count += 1;                                    }                                    i += 1;                                });                            }                            widget.setValue(value);                            /*                             * To prevent first dispatch if widget is binded                             * on source out                             */                            if (firstInit && widget.sourceOut) {                                // DO NOTHING                            } else {                                /*                                 * Case of source out                                 */                                if (widget.sourceOut) {                                    switch (widget._sourceOutInfo.dataClassAtt.kind) {                                        case 'relatedEntity':                                            break;                                        default :                                            widget.sourceOut.getAttribute(widget._sourceOutInfo.attName).setValue(value);                                            break;                                    }                                }                            }                        }                        firstInit = false;                        break;                    /*                     * Change combobox value on attribute change                     */                    case 'onAttributeChange' :                        this._attributeHasChanged = true;                        break;                    /*                     * Change combobox option on save                     */                    case 'onElementSaved' :                        var                        i,                        ds,                        attr,                        label,                        option,                        values,                        position,                        identifier;                        ds          = e.dataSource;                        attr        = (!widget._key || dsID == widget._key) ? widget._primary : widget._key;                        values      = [];                        position    = e.position;                        if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                            identifier  = position;                        } else {                            identifier = e.entity[widget._primary].value;                        }                        if (widget._posInCombo) {                            position = widget._posInCombo[position];                        }                        widget._tmp[position] = identifier;                        for (i = 0; i < optionsLength; i += 1) {                            attribute   = options[i];                            if (attribute) {                                values.push(e.entity[attribute].value);                            }                        }                        label = WAF.utils.formatString(values.join(' '), widget.format);                        /*                         * Find the option into the combo                         */                        option = widget.$domNode.find('option').eq(position);                        /*                         * Change option value and label                         */                        option                            .html(label)                            .val(e.entity[attr].value);                        break;                }            }, {            }, {                widget : this            });        }    },    {        _primary        : 'ID',        _limit          : 20,        _key            : null,        _input          : null,        _button         : null,        _list           : null,        _combobox       : null,        _isBuilt        : false,        _sourceOutInfo  : null,        _tmpValue       : null,        _autoDispatch   : false,        _tmp            : {},        sourceOut       : null,        /**         * Get the related attribute depending on the binding datasource         * @method _getRelatedAttribute         * @param {object} source         * @param {string} attr         */        _getRelatedAttribute : function combobox_get_related_attribute(source, attr) {            var            i,            result,            widget,            currentSource;            widget = this;            for (i in source) {                currentSource = source[i];                if (currentSource && currentSource.emAtt) {                    if (WAF.utils.ucFirst(attr) == currentSource.emAtt.path) {                        result = currentSource                    }                }            }            return result;        },        /**         * Custom ready function         * @method ready         */        ready : function combobox_ready() {            var            that,            list,            layout,            tagWidth,            buttonSize;            that            = this;            buttonSize      = 25,            tagWidth        = this.getWidth();            this._editable  = !this.config['data-editable'] || this.config['data-editable'] == 'false' ? false : true;            if (this.config['data-binding-out']) {                this._sourceOutInfo = WAF.dataSource.solveBinding(this.config['data-binding-out']);                if (this._sourceOutInfo) {                    this.sourceOut = this._sourceOutInfo.dataSource;                }            }            this._combobox = this._combobox || this.$domNode.children('select');            if (this._combobox && this._combobox.length > 0) {                /*                 * Set select as combobox                 */                this._combobox.combobox();                /*                 * Resize combo components                 */                this._input     = this.$domNode.children('input');                this._button    = this.$domNode.children('button');                this._input.css({                    'width'     : (tagWidth - (buttonSize + 2)) + 'px',                    'height'    : '100%'                });                this._button.css({                    'width'     : buttonSize + 'px',                    'height'    : '100%'                });                /*                 * Add class to list                 */                this._list = this._input.autocomplete( "widget" );                this._list.addClass('waf-combobox-list-' + this.id + ' waf-combobox-list ' + this.getTheme());                /*                 * Change datasource onchange event                 */                this._input.bind( "autocompleteselect", {sourceOut : that.sourceOut, widget : that}, function(e, ui) {                    var                    i,                    evt,                    that,                    value,                    index,                    event,                    source,                    option,                    events,                    widget,                    eventsL,                    htmlObject,                    successFunction;                    evt         = e;                    widget      = e.data.widget;                    option      = $(ui.item.option)                    value       = option.attr('value');                    index       = option.index();                    htmlObject  = $(this);                    widget._changeFromCombo = true;                    /*                     * Get on change event to execute it after autocomplete                     * select event                     */                    events  =  WAF.events[widget.id];                    if (events) {                        eventsL = events.length;                        for (i = 0; i < eventsL; i += 1) {                            event = events[i];                            if (event.name == 'change') {                                widget._callbackChange = event.fn;                            }                        }                    }                    if (widget.source && widget._autoDispatch) {                        successFunction = function(e) {                            var                            widget,                            source;                            widget = e.data.widget;                            /*                             * Case of source out                             */                            if (widget.sourceOut) {                                switch (widget._sourceOutInfo.dataClassAtt.kind) {                                    case 'relatedEntity':                                        source = widget._getRelatedAttribute(widget.sourceOut, widget.source.getID());                                        if (source) {                                            widget.source.getDataClass().getEntity(widget._tmp[index], {                                                onSuccess: function(e) {                                                    e.userData.source.set(e.entity);                                                }                                            }, {source : source})                                        }                                        break;                                    default :                                        widget.sourceOut.getAttribute(widget._sourceOutInfo.attName).setValue(value);                                        break;                                }                            }                            if (widget._callbackChange) {                                widget._callbackChange(evt);                            }                        };                        if (widget.source._private.sourceType == 'dataClass' || widget.source._private.sourceType == 'relatedEntities') {                            widget.source.selectByKey(widget._tmp[index], {                                onSuccess : successFunction                            }, {                                widget : widget                            });                        } else {                            widget.source.select(widget._tmp[index], {                                onSuccess : successFunction                            }, {                                widget : widget                            });                        }                    } else {                        widget.setValue($(ui.item.option).val());                        if (widget.sourceOut) {                            switch (widget._sourceOutInfo.dataClassAtt.kind) {                                case 'relatedEntity':                                    source = widget._getRelatedAttribute(widget.sourceOut, widget.source.getID());                                    if (source) {                                        widget.source.getDataClass().getEntity(widget._tmp[index], {                                            onSuccess: function(e) {                                                source.set(e.entity);                                            }                                        })                                        //source.set(widget.source);                                    }                                    break;                                default :                                    widget.sourceOut.getAttribute(widget._sourceOutInfo.attName).setValue(value);                                    break;                            }                        }                    }                });                // ********* <STATES EVENTS> *********                this.$domNode.hover(                    function () {                        if (that.getState() != 'active') {                            that.setState('hover');                        }                        that._hasOver = true;                    },                    function () {                        if (that.getState() == 'active') {                            that.setState('active');                        } else {                            that.setState('default');                        }                        that._hasOver = false;                    }                );                this._input.focusin(function() {                    that.setState('active');                })                .focusout(function() {                    that.removeState('active');                });                this._input.bind( "autocompleteopen", function(event, ui) {                    $(this).focus();                    that.$domNode.addClass("waf-state-active");                });                this._input.bind( "autocompleteclose", function(event, ui) {                    that.removeState('active');                });                // ********* </STATES EVENTS> ********                /*                 * If not editable, create a clickable layout to prevent focus                 * on autocomplete input                 */                if (!this._editable) {                    layout = $('<div>').css({                        'position'      : "absolute",                        'width'         : this._input.width(),                        'height'        : this._input.height(),                        'top'           : 0,                        'left'          : 0,                        'background'    : 'transparent',                        'cursor'        : 'pointer'                    });                    this.$domNode.append(layout);                    layout.bind('mousedown', function(){                        that._button.click();                        return false;                    });                    this._input.css({'cursor' : 'pointer'});                    this._input.attr('readonly', 'readonly');                    this._input.attr('disabled', 'disabled');                }                /*                 * Execute query to find into combobox                 */                if (this.source) {                    this._input.bind( "keyup", function(event, ui) {                        var                        i,                        attr,                        value,                        input,                        attrType,                        optionsL,                        valToFind,                        queryString;                        if (that._limit < that.source.length) {                            /*                             * Do not execute query if up or down key                             */                            if (event.keyCode == 40 || event.keyCode == 38) {                                return;                            }                            input = $(this);                            value = input.val();                            queryString = [];                            optionsL    = that._options.length;                            for (i = 0; i < optionsL; i += 1) {                                attr = that._options[i];                                queryString.push(attr + ' = :1');                            }                            queryString = queryString.join(' OR ');                            that.source.getEntityCollection().query(queryString, {                                limit : 1,                                onSuccess : function(e){                                    var                                    count;                                    count = 0;                                    if (that._tmpFindedLength != e.result.length) {                                        that.clear(false);                                        e.result.forEach(function(e){                                            if ( e.entity && count < that._limit ){                                                var                                                i,                                                attr,                                                label,                                                option,                                                length;                                                label   = [];                                                length  = that._options.length;                                                for (i = 0; i < length; i += 1) {                                                    option = that._options[i];                                                    if (option) {                                                        label.push(e.entity[option].getValue());                                                    }                                                }                                                attr = !e.entity[that._key] ? that._primary : that._key;                                                that.addOption(e.entity[attr].getValue(), label.join(' '));                                                that._tmp[count] = e.entity.getKey();                                            }                                            count += 1;                                        },{                                            limit : that._limit                                        });                                    }                                    that._tmpFindedLength = e.result.length;                                    input.autocomplete( "search" , value );                                },                                params: [value + WAF.wildchar]                            });                        }                    });                }            }            if (that.sourceOut) {                that.sourceOut.addListener('all', function(e){                    var                    kind,                    value,                    widget;                    widget  = e.data.widget;                    kind    = e.eventKind;                    if (!widget._changeFromCombo) {                        switch(kind) {                            case 'onElementSaved' :                                widget._changeFromCombo = true;                                break;                            case 'onAttributeChange' :                            case 'onCurrentElementChange' :                                value = e.dataSource.getAttribute(widget._sourceOutInfo.attName).getValue();                                if (value && typeof(value) == 'object' && value[widget._primary]) {                                    value = value[widget._primary];                                } else if (value && typeof(value) == 'object') {                                    // @DIRTY : find another way to get related attribute primary value                                    value = value.__deferred.__KEY;                                }                                if (typeof value === 'undefined') {                                    value = '';                                }                                widget.setValue(value);                                widget._tmpValue = value;                                that._changeFromCombo = false;                                break;                        }                    } else {                        that._changeFromCombo = false;                    }                }, {                }, {                    widget : that                })            }            /*             * Also format not binded combobox             */            if (!this.source && this._input) {                var                value;                value = this._input.val();                value = WAF.utils.formatString(value, this.format);                this._input.val(value);                $.each(this.$domNode.find('option'), function() {                    var                    label;                    label = $(this).html();                    label = WAF.utils.formatString(label, that.format);                    $(this).html(label)                })            }        },        /**         * Custom setValue function         * @method setValue         * @param {string} value         */        setValue : function combobox_set_value(value) {            var            i,            event,            events,            eventsL;            if (this.isDisabled()) {                return this.getValue();            }            if (typeof value == 'undefined' || value === '') {                this._input.val('');            } else {                this._combobox.combobox('setValue', value);            }            /*             * Trigger change event             */            if (!this._callbackChange) {                events  =  WAF.events[this.id];                if (events) {                    eventsL = events.length;                    for (i = 0; i < eventsL; i += 1) {                        event = events[i];                        if (event.name == 'change') {                            this._callbackChange = event.fn;                        }                    }                }            }            if (this._callbackChange) {                this._callbackChange();            }        },        /**         * Add an option to the combobox         * @method addOption         * @param {string} value         * @param {string} label         * @param {boolean} selected         */        addOption : function combobox_add_option(value, label, selected) {            label = label || value;            if (this.source) {                if (this.source.getAttribute(this._key)) {                    switch (this.source.getAttribute(this._key).type) {                        case 'long':                        case 'long64':                        case 'number':                            value = parseInt(value);                            break;                    }                }                if (this._options.length == 1) {                    switch (this.source.getAttribute(this._options[0]).type) {                        case 'long':                        case 'long64':                        case 'number':                            label = parseInt(label);                            break;                    }                }            }            label = this.getFormattedValue(label);            this._combobox.append($('<option value=\'' + value + '\'>').html(label));            if (selected) {                this._combobox.combobox('setValue', value);            }        },        /**         * Remove an option to the combobox         * @method removeOption         * @param {number} index         */        removeOption : function combobox_remove_option(index) {            var            option,            currentIndex;            option = $(this._combobox.children('option').get(index - 1));            if (option.val() == this.getValue()) {                this.setValue('');            }            if (option.length > 0) {                option.remove();            }            /*if (currentIndex == index) {                this.setValue('');            }*/        },        /**         * Custom clear function         * @method clear         * @param {boolean} clearInput         */        clear : function (clearInput) {            clearInput = typeof(clearInput) == 'undefined' ? true : clearInput;            if (clearInput && this._input) {                this._input.val('');            }            if (this._combobox) {                this._combobox.children().remove();            }        },        /**         * Disable the slider         * @method disable         */        disable : function combo_disable () {            this._input.attr('disabled', 'disabled')            this._input.autocomplete('disable');            /*             * Call super class disable function             */            WAF.Widget.prototype.disable.call(this);        },        /**         * Enable the slider         * @method enable         * @param {boolean} disable         */        enable : function combo_enable () {            this._input.removeAttr('disabled')            this._input.autocomplete('enable');            /*             * Call super class enable function             */            WAF.Widget.prototype.enable.call(this);        },        /**         * Custom widget set state function         * @function setState         * @param {string} value         */        setState : function setState (value) {            var            label,            nState,            htmlObject;            label = this.getLabel();            value = value || 'default';            if (!this._disabled) {                htmlObject = this.$domNode;                htmlObject.addClass('waf-state-' + value);                if (value == 'hover') {                    htmlObject.removeClass('waf-state-active');                }                if (value == 'active') {                    htmlObject.removeClass('waf-state-hover');                    this._input.addClass("waf-state-focus");                }                if (value == 'default') {                    htmlObject.removeClass('waf-state-hover');                    htmlObject.removeClass('waf-state-active');                    htmlObject.removeClass('waf-state-focus');                    htmlObject.removeClass('waf-state-disabled');                    this._tmpState = nState;                }            }            if (label) {                this.getLabel().setState(value);            }            this._currentState = value;        },        /**         * Custom widget remove state function         * @function removeState         * @param {string} value         */        removeState : function setState (value) {            this.$domNode.removeClass('waf-state-' + value);            if (value == 'focus') {                this.removeState('active');            }            if (value == 'active') {                if (this._hasOver) {                    this.setState('hover');                }            }            this._currentState = null;        },        /**         * Custom widget getValue function         * @function getValue         * @return {string|number} value         */        getValue : function () {            var            value;            value = $('#' + this.id + ' select').val();            /*             * Check if value a number (depending on datasource)             */            if (this.source) {                switch (this.source.getAttribute(this._key).type) {                    case 'long':                    case 'long64':                    case 'number':                        value = parseInt(value);                        break;                }            }            return value;        }    });/* * Fig bug on combobox list doesn't disappear */$(document).bind('click', function(e) {    var    id,    target;    target = $(e.target);    parents = target.parents('.waf-combobox');    isCombo = target.is('.waf-combobox');    if (parents.length > 0 || isCombo) {        id = isCombo ? target.prop('id') : parents.prop('id');        $('.waf-combobox-list').not('.waf-combobox-list-' + id + '').hide();    } else {        $('.waf-combobox-list').hide();    }})/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/combobox/widget-combobox-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'combobox',    lib         : 'WAF',    description : 'Combo Box',    category    : 'Form Controls',    img         : '/walib/WAF/widget/combobox/icons/widget-combobox.png',    tag         : 'div',    attributes  : [    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-binding',        description: 'Choice Source'    },    {        name       : 'data-binding-out',        description: 'Value Source',        typeValue  : 'datasource'    },    {        name       : 'data-binding-options',        visibility : 'hidden'    },    {        name       : 'data-binding-key',        description: 'Key',        type       : 'dropdown',        options    : ['']    },    {        name       : 'data-format',        description: 'Format'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-autoDispatch',        description : 'Auto Dispatch',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'tabindex',        description : 'Tabindex',        typeValue   : 'integer'    },    {        name        : 'data-editable',        description : 'Autocomplete',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'data-limit',        description : 'Display Limit',        type        : 'textField',        defaultValue: '20'    }],    events: [    {        name       : 'blur',        description: 'On Blur',        category   : 'Focus Events'    },    {        name       : 'change',        description: 'On Change',        category   : 'Focus Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'focus',        description: 'On Focus',        category   : 'Focus Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'onmouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    style: [    {        name        : 'width',        defaultValue: '164px'    },    {        name        : 'height',        defaultValue: '24px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            gradient    : true,            border      : true,            sizePosition: true,            shadow      : true,            disabled    : []        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover'        },{                label   : 'active',                cssClass: 'waf-state-active'        },{                label   : 'disabled',                cssClass: 'waf-state-disabled'        }]    },    structure: [{        description : 'input',        selector    : 'input',        style: {            text        : true,            background  : true,            gradient    : true,            textShadow  : true,            innerShadow : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover'        },{                label   : 'active',                cssClass: 'waf-state-active'        },{                label   : 'disabled',                cssClass: 'waf-state-disabled'        }]    },{        description : 'button',        selector    : 'button',        style       : {            background  : true,            gradient    : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'ui-state-hover',                find    : '.ui-button'        },{                label   : 'active',                cssClass: 'ui-state-active',                find    : '.ui-button'        },{                label   : 'disabled',                cssClass: 'ui-state-disabled',                find    : '.ui-button'        }]    },{        description : 'list',        selector    : '.waf-combobox-list',        style: {            text        : true,            background  : true,            gradient    : true,            textShadow  : true,            innerShadow : true,            border      : true        }    }],    onInit: function (config) {        var widget = new WAF.widget.Combobox(config);        // add in WAF.widgets        widget.kind     = config['data-type']; // kind of widget        widget.id       = config['id']; // id of the widget        widget.renderId = config['id']; // id of the tag used to render the widget        widget.ref      = document.getElementById(config['id']); // reference of the DOM instance of the widget        WAF.widgets[config['id']] = widget;        return widget;    },    onDesign : function (config, designer, tag, catalog, isResize) {        var        htmlObject,        htmlSelect,        htmlInput,        htmlButton,        borderSize,        buttonSize,        tagWidth,        tagHeight,        options;        tagWidth    = tag.getWidth();        tagHeight    = tag.getHeight();        htmlObject  = $('#' + tag.getId());        buttonSize  = 29;        borderSize  = parseInt(tag.getComputedStyle('border-width'), 10) * 2;        tag.showList = function combobox_show_list () {            // body...        };        htmlObject.children().remove();        htmlSelect  = $('<select>').appendTo(htmlObject);        options     = tag.getOptions();        for (var i in options) {            var attr = {                value: options[i].value            };            if (options[i].selected) {                attr.selected = 'selected';            }            htmlSelect.append( $('<option/>').prop(attr).html(options[i].label) );        }        htmlSelect.combobox();        htmlInput   = htmlObject.children('input');        htmlButton  = htmlObject.children('button');        htmlObject.parent().css({            'overflow'    : 'hidden'        });        htmlInput.css({            'width'     : (tagWidth - buttonSize - borderSize) + 'px',            'height'    : (tagHeight - borderSize) + 'px',            'cursor'    : 'move'        });        htmlButton.css({            'width'     : buttonSize + 'px',            'height'    : (tagHeight - borderSize) + 'px',            'cursor'    : 'move'        });        htmlButton.bind('click', {}, function(e) {            htmlInput.autocomplete('close');        });        htmlInput.autocomplete( "widget" ).remove();        if (tag.currentSelector && tag.currentSelector != -1) {            D.tag.showComboboxAutocomplete(/waf-combobox-list/.test(tag.currentSelector) ? true : false);        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/select/widget-select.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Select',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        dataBinding,        comboboxHtml,        comboboxID,        htmlObject,        _key,        sourceIn,        sourceOut,        autoDispatch,        options,        primary,        inputHtmlObject,        buttonHtmlObject,        listHtmlObject,        listClass,        buttonSize,        widget,        i,        visibleText = "...",        selectLabel,        selectElement,        optionsLength;        this._limit     = !data['limit'] ? this._limit : parseInt(data['limit']);        this._autoDispatch  = !data['autoDispatch'] || data['autoDispatch'] == 'false' ? false : true;        widget          = this;        htmlObject      = $(this.containerNode);        theme           = $.trim(this.getTheme().replace('inherited', ''));        comboboxID      = config.id;        selectElement   = htmlObject.find("select");        selectMask      = $('<div class="waf-select-mask"></div>');        selectLabel     = $('<span class="waf-select-label"></span>');        selectButton    = $('<span class="waf-select-button"></span>');        selectIcon      = $('<span class="waf-icon waf-icon-svg waf-select-icon">');        selectIcon.svg({            loadURL: '/walib/WAF/widget/select/skin/' + theme + '/svg/widget-select-skin-' + theme + '.svg',            onLoad: function(svg) {                svg.configure({                        width: '100%',                        height: '100%',                        preserveAspectRatio: 'none'                });            }        });        selectButton.append(selectIcon);        dataBinding = config['data-binding'];        _key        = data['binding-key'];        if (_key === null) {            _key = widget._primary;        }        this.key = _key;        this.dataBinding = dataBinding;        if (data['binding-options'] != null && dataBinding != null) {            options = data['binding-options'].replace(/\[/g, '').replace(/\]/g, '').split(' ');        } else {            options = selectElement.html();        }        optionsLength   = options.length;        htmlObject            .empty()            .append(selectMask, '<select name="">' + options + '</select>');        //selectElement.html(options);        selectElement   = htmlObject.find("select");        selectLabel            .css('line-height', this.getHeight() + 'px')            .html(this.getValue());        selectMask.append(selectLabel, selectButton);         // ********* <STATES EVENTS> *********         htmlObject.bind("onChange", this, function(event) {            //event.data.onChange(event);         })        if (WAF.PLATFORM.isTouch) {            htmlObject.bind({                touchstart: function() {                    $(this).addClass('waf-state-active');                },                focusout: function() {                    $(this).removeClass('waf-state-active');                }            });        }        //  else {        //     htmlObject.bind({        //         mousedown: function() {        //             console.log('mousedown')        //             $(this).addClass('waf-state-active');        //         }        //     });        // }         // ********* </STATES EVENTS> ********        selectElement.change(function(){            selectLabel.html($(this).find('option:selected').text());            //htmlObject.trigger("onChange");            // htmlObject.removeClass('waf-state-active');        });        sourceIn        = data['binding'];        autoDispatch    = data['autoDispatch'];        sourceOut       = data['binding-out'];          this.createSelect= function(divID, binding, params){            if (widget.sourceAtt) {                var listenerConfig = {                    listenerID  :divID,                    listenerType:'dropDown',                    subID       : params.subID ? params.subID : null                };                //result.source.addListener("all", function(e) {                widget.sourceAtt.addListener(function(e) {                    var dsID        = e.dataSource.getID(),                        kind        = e.eventKind;                        dataSource  = e.dataSource;                        dsID        = e.dataSource.getID();                    switch(e.eventKind) {                        case  'onCurrentElementChange' :                            function manageValue() {                                widget.setValue(value);                                if ((autoDispatch && autoDispatch !== 'false' )|| autoDispatch === 'true') {                                    if (sourceOut) {                                        value = e.dataSource.getAttribute(_key).getValue();                                    } else {                                        if (dsID !== _key && _key) {                                            value = e.dataSource.getAttribute(_key).getValue();                                        }                                    }                                    selectElement.find("option[value='"+value+"']").prop("selected", "selected");                                    selectLabel.html(selectElement.find("option:selected").text());                                }                            }                            if (widget._autoDispatch) {                                ds = dataSource;                                if (ds._private.sourceType != 'dataClass' && ds._private.sourceType != 'relatedEntities') {                                    widget._primary = ds._private.attNameList[0];                                }                                value = e.dataSource.getAttribute(_key).getValue();                                if (widget.$domNode.find('option[value="' + value + '"]').length == 0) {                                    var                                    i,                                    pos,                                    first,                                    count,                                    collection,                                    selOptions;                                    i           = 0;                                    count       = 0;                                    pos         = ds.getPosition();                                    collection  = ds.getEntityCollection();                                    widget._tmp = {};                                    selectElement.html("");                                    if (!collection) {                                        return;                                    }                                    if (pos + 5 > collection.length) {                                        first = collection.length - 5;                                    } else {                                        first = pos;                                    }                                    widget._posInCombo = {};                                    selectElement.html("");                                    selOptions = "";                                    collection.each(function(elt) {                                        var                                        j,                                        values;                                        if (i >= first && count < widget._limit) {                                            values = [];                                            for (j = 0; j < optionsLength; j += 1) {                                                attribute   = options[j];                                                if (attribute) {                                                    values.push(elt.entity[attribute].value);                                                }                                            }                                            selOptions = selOptions + '<option value="'+elt.entity[_key].value+'">'+values.join(' ')+'</option>';                                            count += 1;                                        }                                        if (collection.length === i+1 ) {                                            selectElement.html(selOptions);                                            manageValue();                                        }                                        i += 1;                                    });                                } else {                                    manageValue();                                }                            } else {                                manageValue();                            }                            break;                        case  'onCollectionChange' :                        case  'onAttributeChange' :                            if (sourceIn) {                                selectElement.children().remove();                                var dsLength    = dataSource.length,                                    i,                                    selOptions  = "";                                for (i = 0; i < dsLength; i += 1) {                                    if (dataSource._private.sourceType === "array" || (!widget._limit || i < widget._limit)) {                                        dataSource.getElement(i, {                                            onSuccess : function(e){                                                var                                                i,                                                option;                                                option = [];                                                for (i = 0; i < optionsLength; i += 1) {                                                    if (options[i]) {                                                        option.push(e.element[options[i]]);                                                    }                                                }                                                selOptions = selOptions + '<option value="'+e.element[_key]+'">'+option.join(' ')+'</option>';                                                if (e.position === dsLength-1 || e.position === widget._limit-1) {                                                    selectElement.html(selOptions);                                                    if (e.dataSource && _key) {                                                       selectLabel.html(selectElement.find("option[value='"+dataSource.getAttribute(_key).getValue()+"']").text());                                                    }                                                    /*                                                     * Select sourceout value after sourcein has been loaded                                                     */                                                    if (widget._tmpValue && widget.sourceOut) {                                                        widget.setValue(widget._tmpValue);                                                    }                                                }                                            }                                        });                                    }                                }                            }                            break;                    }                }, listenerConfig, {                    widget:widget                });                // Change current entity on change event                selectElement.bind( "change", function(event, ui) {                    //var value = widget.source[_key];                    var value = selectElement.find('option:selected', this)[0].value;                    if ((autoDispatch && autoDispatch !== 'false' )|| autoDispatch === 'true' ) {                        if (!dataSource.selectByKey) {                            widget.source.select(selectElement.find('option:selected', this).index());                        } else {                            dataSource.selectByKey(value);                        }                    }                    // Save value if binding "out" is defined                    if (sourceOut) {                        var bindingInfo = WAF.dataSource.solveBinding(sourceOut);                        if (typeof(value) === 'undefined' && widget.source.getID() === _key) {                            //widget.source.select(selectElement.find('option:selected', this).index());                            widget.source.selectByKey(value);                            bindingInfo.dataSource[widget.source.getID()].set(widget.source);                        } else {                            //bindingInfo.dataSource.getAttribute(bindingInfo.attName).setValue(event.target.value);                            widget._sourceOutInfo = WAF.dataSource.solveBinding(config['data-binding-out']);                            switch (widget._sourceOutInfo.dataClassAtt.kind) {                                case 'relatedEntity':                                    source = widget._getRelatedAttribute(widget._sourceOutInfo.dataSource, widget.source.getID());                                    if (source) {                                        widget.source.getDataClass().getEntity(value, {                                            onSuccess: function(e) {                                                e.userData.source.set(e.entity);                                            }                                        }, {source : source})                                    }                                    break;                                default :                                    bindingInfo.dataSource.getAttribute(widget._sourceOutInfo.attName).setValue(value);                                    break;                            }                        }                    }                });                /*if (sourceOut) {                    var bindingInfo = WAF.dataSource.solveBinding(sourceOut);                    var thisDS = bindingInfo.dataSource;                    thisDS.addListener('onCurrentElementChange', function(e) {                        var value = e.dataSource.getAttribute(bindingInfo.attName).getValue();                        if (e.data.source.getID() === e.data.search) {                            e.dataSource[e.data.source.getID()].load({                                onSuccess : function(e) {                                    if (e.entity) {                                        //comboboxHtml.combobox('setValue', e.entity[primary].getValue());                                    }                                }                            });                        } else {                            //comboboxHtml.combobox('setValue', value);                        }                        if ((autoDispatch && autoDispatch !== 'false' )|| autoDispatch === 'true' ) {                            widget.source.select($('option:selected', selectElement).index());                        }                    }, {}, {                        search : _key,                        source : widget.source                    })                }*/            } else {                // Change current entity on change event                selectElement.bind( "change", function(event, ui) {                    // Save value if binding "out" is defined                    if (sourceOut) {                        var bindingInfo = WAF.dataSource.solveBinding(sourceOut);                        bindingInfo.dataSource.getAttribute(bindingInfo.attName).setValue(selectElement.val());                    }                });            }       }          this.createSelect(comboboxID, sourceIn ? sourceIn : '', config);    },    {        /**         * Get the related attribute depending on the binding datasource         * @method _getRelatedAttribute         * @param {object} source         * @param {string} attr         */        _getRelatedAttribute : function select_get_related_attribute(source, attr) {            var            i,            result,            widget,            currentSource;            widget = this;            for (i in source) {                currentSource = source[i];                if (currentSource && currentSource.emAtt) {                    if (WAF.utils.ucFirst(attr) == currentSource.emAtt.path) {                        result = currentSource                    }                }            }            return result;        },        /**        * getValue        *        * @/shared        * @/method getValue        **/        getValue: function getValue() {           if (this.dataBinding) {                return source[this.dataBinding].getAttribute(this.key).getValue();           } else {                return $(this.containerNode).find('option:selected').text();           }        },        /**        * setValue        *        * @/shared        * @/method setValue        * @returns selectedValue (can be the previous one if itemValue couldn't be found)        **/        setValue: function setValue(itemValue){            var cont = $(this.containerNode),                label = '',                returnValue = this.getValue(),                matchedOption = null;            // don't do anything if widget is disabled, or its value is undefined/invalid            if (!this.isDisabled() && typeof(itemValue) != 'undefined' && itemValue !== returnValue) {                // first check we have a valid itemValue                matchedOption = cont.find('select option[value=' + itemValue + ']');                if (matchedOption.length) {                    returnValue = itemValue;                    // set standard select object's value                    cont.find("select").val(itemValue);                    label = cont.find('option:selected').text();                    cont.find(".waf-select-label").get(0).innerHTML = label;                    // only trigger the change event if the value could be changed                    this.$domNode.trigger('change');                }            }            return returnValue;        },        /**        * onChange        *        * @/shared        * @/method onChange        **/        onChange: function onChange(event) {            //event code        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/select/widget-select-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'select',    lib         : 'WAF',    description : 'Select',    category    : 'Form Controls',    img         : '/walib/WAF/widget/select/icons/widget-select.png',    tag         : 'div',    attributes  : [    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-binding',        description: 'Choice Source'    },    {        name       : 'data-binding-out',        description: 'Value Source',        typeValue  : 'datasource'    },    {        name       : 'data-binding-options',        visibility : 'hidden'    },    {        name       : 'data-binding-key',        description: 'Key',        type       : 'dropdown',        options    : ['']    },    {        name       : 'data-errorDiv',        description: 'Display Error'    },    {        name       : 'data-format',        description: 'Format'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-autoDispatch',        description : 'Auto Dispatch',        type        : 'checkbox',        defaultValue: 'true'    },    {        name        : 'data-limit',        description : 'Display Limit',        type        : 'textField',        defaultValue: '20'    }/*,    {          name         : 'data-options',          description  : 'Options',          type         : 'grid',          defaultValue : '[]',          reloadOnChange  : true,          displayEmpty    : true, // if false grid is hidden if empty          newRowEmpty     : false,          columns      : [              {                  name  : 'Value',                  type  : 'textField'              },              {                  name  : 'Label',                  type  : 'textField'              },              {                  name  : 'Selected',                  type  : 'radio'              }          ],          onRowClick : function(data) {          },          afterRowAdd : function(data) {          },          afterRowDelete : function(data) {          },          ready       : function() {          }      }*/],    events: [    {        name       : 'blur',        description: 'On Blur',        category   : 'Focus Events'    },    {        name       : 'change',        description: 'On Change',        category   : 'Focus Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'focus',        description: 'On Focus',        category   : 'Focus Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'onmouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }],    style: [    {        name        : 'width',        defaultValue: '196px'    },    {        name        : 'height',        defaultValue: '20px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            gradient    : true,            border      : true,            sizePosition: true,            shadow      : true,            disabled    : []        },        state : [/*{                label   : 'hover',                cssClass: 'waf-state-hover'        },*/{                label   : 'active',                cssClass: 'waf-state-active'        }]    }/*,    structure: [{        description : 'Text',        selector    : '.waf-select-label',        style: {            text        : true,            background  : true,            gradient    : true,            textShadow  : true,            innerShadow : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover'        },{                label   : 'active',                cssClass: 'waf-state-active'        }]    },{        description : 'Background',        selector    : '.waf-select-mask',        style       : {            background  : true,            gradient    : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'ui-state-hover',                find    : '.ui-button'        },{                label   : 'active',                cssClass: 'ui-state-active',                find    : '.ui-button'        }]    }]*/,    onInit: function (config) {        var widget = new WAF.widget.Select(config);        // add in WAF.widgets        widget.kind     = config['data-type']; // kind of widget        widget.id       = config['id']; // id of the widget        widget.renderId = config['id']; // id of the tag used to render the widget        widget.ref      = document.getElementById(config['id']); // reference of the DOM instance of the widget        WAF.widgets[config['id']] = widget;        return widget;    },    onDesign : function (config, designer, tag, catalog, isResize) {        var        htmlObject,        htmlSelect,        htmlInput,        htmlButton,        borderSize,        buttonSize,        tagWidth,        tagHeight,        options = [],        markup,        visibleTextField,        visibleText = "...",        selectMask,        selectLabel,        selectButton,        selectIcon,        selectElement;        tagWidth    = tag.getWidth();        tagHeight   = tag.getHeight();        tagTheme    = $.trim(tag.getTheme().replace('inherited', ''));        htmlObject  = $('#' + tag.getId());        buttonSize  = 25;        borderSize  = parseInt(tag.getComputedStyle('border-width')) * 2;        if (config["data-binding"] === "" && config["data-binding-options"] != null) {            tag.getAttribute("data-binding-options").setValue("");        }        options     = tag.getOptions();        // markup =        // '<div class="waf-select-mask"><span class="waf-select-label"></span><span class="waf-select-icon"></span></div>'+        // '<select name="">';        selectMask = $('<div class="waf-select-mask"></div>');        selectLabel = $('<span class="waf-select-label"></span>');        selectButton = $('<span class="waf-select-button"></span>');        selectIcon = $('<span class="waf-icon waf-icon-svg waf-select-icon">');        selectIcon.svg({            loadURL: '/walib/WAF/widget/select/skin/' + tagTheme + '/svg/widget-select-skin-' + tagTheme + '.svg',            onLoad: function(svg) {                svg.configure({                        width: '100%',                        height: '100%',                        preserveAspectRatio: 'none'                });            }        });        selectButton.append(selectIcon);        selectElement = '<select name="">';        if (options && (options != undefined || options.length != 0)) {            $.each(options, function(index, val) {                if (index === 0) {                    visibleText = val["label"];                }                if (val.Selected) {                    select += '<option value="'+val["value"]+'" selected>'+val["label"]+'</option>';                    visibleText = val["label"];                } else {                    selectElement += '<option value="'+val["value"]+'">'+val["label"]+'</option>';                }            });        } else {            visibleText = "...";        }        selectElement += '</select>';        selectLabel            .css('line-height', tagHeight - borderSize + 'px')            .html(visibleText);        selectMask.append(selectLabel, selectButton);        htmlObject            .empty()            .append(selectMask, selectElement);    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/radiogroup/widget-radiogroup.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'RadioGroup',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var        that,        listenerConfig,        htmlObject,        key,        sourceOut,        autoDispatch,        options,        primary,        themes,        classes,        theme,        icon,        icons,        definedTheme,        radioLabel;        that            = this;        config          = config || {};        htmlObject      = this.$domNode;        key             = data['binding-key'];        sourceOut       = data['binding-out'];        autoDispatch    = data['autoDispatch'];        options         = data['binding-options'];        primary         = "ID";        classes         = htmlObject.prop('class');        themes          = [];        definedTheme    = '';        this._primary   = key;        this.binding    = data['binding'];        for (i in WAF.widget.themes) {            theme = WAF.widget.themes[i].key;            if (classes.match(theme)) {                themes.push(theme);                if (theme != 'inherited') {                    definedTheme = theme;                }            }        }        /*         * Add display class         */        htmlObject.removeClass('waf-direction-horizontal waf-direction-vertical');        htmlObject.addClass('waf-direction-' + data.display);        this.tmpIcon = null;        this.dimension   = config['data-display'] === 'horizontal' ? 'width' : 'height';        this.value       = 100 / htmlObject.children().length + '%';        /*         * Create a radio input         * @method _createRadio         */        this._createRadio = function radiogroup_createradio(li, svg, icons) {            var            i,            radioLi,            radioDiv,            radioIcon,            radioInput,            imgHtml,            cssClass,        	obj,            radioElem,            halfRadioHeight;            radioLi         = li;            radioInput      = radioLi.children('input');            radioLabel      = radioLi.children('label');            radioLi.children('.waf-widget.waf-radio').remove();            radioDiv = $('<div class="waf-widget waf-radio">');            radioDiv.addClass(themes.join(' '));            var radioBox = $('<div class="waf-radio-box">').appendTo(radioDiv);            cssClass    = 'waf-icon waf-radio-icon';            if (svg) {                cssClass += ' waf-icon-svg';            } else {                cssClass += ' waf-icon-image';            }            /*             * To prevent many svg load requests             */            radioIcon    = $('<div class="' + cssClass + '">');            /*             * Img icon             */            if (icons) {                for (i = 0; i < icons.length; i += 1) {                    imgHtml = $('<img>');                    imgHtml.addClass(icons[i].cssClass);                    imgHtml.prop({                        src : icons[i].value                    });                    imgHtml.appendTo(radioIcon);                }            /*             * Svg icon             */            }  else {                radioIcon.html($(svg).html());            }            radioIcon.appendTo(radioBox);            radioInput.appendTo(radioDiv);            radioDiv.appendTo(radioLi);            radioDiv.find('input').before(radioLabel);           	 /* set elements sizes  */            var elemHeight,                label;            if (this.binding === null) {                radioLi.css(this.dimension, this.value);               	radioLi.css("line-height", radioDiv.get()[0].offsetHeight + "px");               	radioElem = radioLi.find(".waf-radio-box");               	halfRadioHeight = radioElem.get()[0].offsetHeight / 2;               	radioElem.css("margin-top", "-"+halfRadioHeight+"px");            } else {               	label = radioLi.find("label");               	label.css("height", "auto");               	elemHeight = parseInt(label.get()[0].offsetHeight);               	radioLi.css("height", elemHeight+20 + "px");               	radioLi.css("line-height", elemHeight+20 + "px");               	radioElem = radioLi.find(".waf-radio-box");               	halfRadioHeight = radioElem.get()[0].offsetHeight / 2;               	radioElem.css("margin-top", "-"+halfRadioHeight+"px");            }            if (!WAF.PLATFORM.isTouch) {                /*                 * Hover States events for radios & label                 */                radioInput.hover(					function (e) {						radioDiv.addClass("waf-state-hover");					},					function (e) {						radioDiv.removeClass("waf-state-hover waf-state-active");					}                );                /*                 * Mouse down States events for radios & label                 */                radioInput.bind('mousedown', {widget : this}, function(e) {                    if (!e.data.widget.$domNode.hasClass('waf-state-disabled')) {                        //htmlObject.find('.waf-radio').removeClass("waf-state-selected");                        radioDiv.addClass("waf-state-active");                    }                });                /*                 * Mouse up States events for radios                 */                radioInput.bind('mouseup', {widget : this}, function(e) {                    if (!e.data.widget.$domNode.hasClass('waf-state-disabled')) {                        /*radioDiv                            .addClass("waf-state-selected")                            .removeClass("waf-state-active");*/                        window.setTimeout(function(){                            radioDiv.removeClass("waf-state-active");                        },0);                    }                });                radioInput.focusin(function() {                    radioDiv.addClass("waf-state-focus");                });                radioInput.focusout(function() {                    radioDiv.removeClass("waf-state-focus");                });            } else {                radioInput.bind({                	touchstart : function() {	                    radioDiv.addClass("waf-state-active");	                },	                touchend : function() {                        window.setTimeout(function(){                            radioDiv.removeClass("waf-state-active");                        },0);                        //htmlObject.find('.waf-radio').removeClass("waf-state-selected");	                }                });            }            /*             * To force radio state change even if click on label             */            radioInput.bind('change', {}, function (e) {                that._checkRadio($(this));            });            if (this._value && this._value == radioInput.val()) {                radioInput[0].setAttribute('checked', 'checked')                //this._value = null;            }            if (radioInput && radioInput[0] && radioInput[0].getAttribute('checked')) {                radioDiv.addClass('waf-state-selected');            }        }        icons   = [];        if (data['icon-default'])    icons.push({cssClass : 'waf-radio-icon-default',  value : data['icon-default']});        if (data['icon-hover'])      icons.push({cssClass : 'waf-radio-icon-hover',    value : data['icon-hover']});        if (data['icon-active'])     icons.push({cssClass : 'waf-radio-icon-active',   value : data['icon-active']});        if (data['icon-selected'])   icons.push({cssClass : 'waf-radio-icon-selected', value : data['icon-selected']});        if (icons.length > 0) {            $.each(htmlObject.children(), function(){                that._createRadio($(this), null, icons);            });        	this._setPosition();        } else {            $('<div>').svg({                loadURL: '/walib/WAF/widget/radiogroup/skin/' + definedTheme + '/svg/widget-radiogroup-skin-' + definedTheme + '.svg',                onLoad: function(svg) {                    var                    thisSvg;                    thisSvg = this;                    svg.configure({                            width: '100%',                            height: '100%',                            preserveAspectRatio: 'none'                    });                    $.each(htmlObject.children(), function(){                        that._createRadio($(this), thisSvg);                    });                    that._setPosition();                }            });        }        listenerConfig = {                listenerID      :this.id,                listenerType    :'radioGroup',                subID           : config.subID ? config.subID : null        };        /*         * Check a radio and add appropriated classes         */        this._checkRadio = function radiogroup__checkRadio(radio) {            if (!this.$domNode.hasClass('waf-state-disabled')) {                radio.prop("checked", "checked");                htmlObject.find('.waf-radio').removeClass("waf-state-selected");                radio.parent().addClass("waf-state-selected");                this._value = radio.val();            }        }        if (this.sourceAtt) {            /*             * Save value if binding "in" is defined             */            this.sourceAtt.addListener(function(e) {                var                dsID,                thatDs,                widget;                dsID    = e.dataSource.getID();                thatDs  = {};                widget  = e.data.widget;                switch(e.eventKind) {                    case  'onCurrentElementChange' :                        /*                         * Save value if binding "in" is defined                         */                        if ((autoDispatch && autoDispatch !== 'false' )|| autoDispatch === 'true') {                            if (sourceOut) {                                var bindingInfo = WAF.dataSource.solveBinding(sourceOut);                                if (dsID === key) {                                    bindingInfo.dataSource[dsID].set(e.dataSource);                                    that._checkRadio($('#' + htmlObject.prop('id') + ' input[value="' + e.dataSource.getAttribute(primary).getValue() + '"]'));                                } else {                                    value = e.dataSource.getAttribute(key).getValue();                                    bindingInfo.dataSource.getAttribute(bindingInfo.attName).setValue(value);                                    that._checkRadio($('#' + htmlObject.prop('id') + ' input[value="' + value + '"]'));                                }                            } else {                                if (dsID !== key) {                                    value = e.dataSource.getAttribute(key).getValue();                                   that._checkRadio($('#' + htmlObject.prop('id') + ' input[value="' + value + '"]'));                                }                            }                        }                        break;                    case  'onCollectionChange' :                    case  'onAttributeChange' :                        /*                         * Add a radio for each data                         */                        thatDs.addRadio = function (thisSvg, icons) {                            that._build(e.dataSource, thisSvg, icons)                        }                        if (icons.length > 0) {                            thatDs.addRadio(null, icons);                        } else {                            $('<div>').svg({                                loadURL: '/walib/WAF/widget/radiogroup/skin/' + definedTheme + '/svg/widget-radiogroup-skin-' + definedTheme + '.svg',                                onLoad: function(svg) {                                    var                                    thisSvg;                                    thisSvg = this;                                    svg.configure({                                            width: '100%',                                            height: '100%',                                            preserveAspectRatio: 'none'                                    });                                    thatDs.addRadio(thisSvg);                                }                            });                        }                        break;                }            }, listenerConfig, {widget : this});            /*             * Change current entity on change event             */            htmlObject.bind('change', {source : this.source, search : key}, function(e) {                var                value,                bindingInfo,                htmlObj;                value   = e.data.source[e.data.search];                htmlObj = $(e.target);                if ((autoDispatch && autoDispatch !== 'false') || autoDispatch === 'true' ) {                    e.data.source.select(parseInt(htmlObj.data('num')))                }                /*                 * Save value if binding "out" is defined                 */                if (sourceOut) {                    bindingInfo = WAF.dataSource.solveBinding(sourceOut);                    if (typeof(value) === 'undefined' && e.data.source.getID() === e.data.search) {                        e.data.source.select(htmlObj.data('num'));                        bindingInfo.dataSource[e.data.source.getID()].set(e.data.source);                    } else {                        bindingInfo.dataSource.getAttribute(bindingInfo.attName).setValue(e.target.value);                    }                }            });            /*             * Change value of defined source out             */            if (sourceOut) {                var                bindingInfo,                thisDS;                bindingInfo = WAF.dataSource.solveBinding(sourceOut);                thisDS      = bindingInfo.dataSource;                thisDS.addListener('onCurrentElementChange', function(e) {                    var value;                    value = e.dataSource.getAttribute(bindingInfo.attName).getValue();                    if (e.data.source.getID() === e.data.search) {                        e.dataSource[e.data.source.getID()].load({                            onSuccess : function(e) {                                if (e.entity) {                                    that._checkRadio($('#' + htmlObject.prop('id') + ' [data-num=' + (e.entity[primary].getValue()-1) + ']'));                                }                            }                        });                    } else {                        that._checkRadio($('#' + htmlObject.prop('id') + ' input[value="' + value + '"]'));                    }                }, {}, {                    search : key,                    source : this.source                })            }        /*         * Unbinded radio         */        } else {            /*             * Change current entity on change event             */            htmlObject.bind('change', {widget : this}, function(e) {                var bindingInfo                /*                 * Save value if binding "out" is defined                 */                if (sourceOut && !e.data.widget._preventChange) {                    bindingInfo = WAF.dataSource.solveBinding(sourceOut);                    bindingInfo.dataSource.getAttribute(bindingInfo.attName).setValue(e.target.value);                }            });        }    },{        ready : function radio_ready() {            var            that;            that = this;            if (this.config['data-binding-out']) {                this._sourceOutInfo = WAF.dataSource.solveBinding(this.config['data-binding-out']);                if (this._sourceOutInfo) {                    this.sourceOut = this._sourceOutInfo.dataSource;                }            }            if (this.sourceOut) {                this.sourceOut.addListener('all', function(e){                    var                    kind,                    value,                    widget;                    widget  = e.data.widget;                    kind    = e.eventKind;                    switch(kind) {                        case 'onAttributeChange' :                        case 'onCurrentElementChange' :                            value = e.dataSource.getAttribute(widget._sourceOutInfo.attName).getValue();                            if (value && typeof(value) == 'object' && value[widget._primary]) {                                value = value[widget._primary];                            }                            /*                             * Prevent on change event script execution                             */                            that._preventChange = true;                            widget.setValue(value);                            that._preventChange = false;                            widget._tmpValue = value;                            break;                    }                }, {                }, {                    widget : that                })            }        },        /**         * Select a radio of the radiogroup depending on a value         * @method select         * @param {String} value         */        select : function radio_select(value) {            var            radio,            htmlObject;            htmlObject = $(this.containerNode);            radio = htmlObject.find('[value="' + value + '"]');            if (radio.length > 0) {                this._value = value;                this._checkRadio(radio);            }        },        _setPosition : function () {			var			radios       = this.$domNode.find('.waf-radio'),			radiosLength = radios.length,            $radio;			// Setting position			radios && radios.map(function(i, radio) {				if (!radio) {					return;				}				$radio = $(radio);				if (i == 0) {					$radio.addClass('waf-position-first');				} else {					$radio.removeClass('waf-position-first');				}				if (i == radiosLength - 1) {					$radio.addClass('waf-position-last');				} else {					$radio.removeClass('waf-position-last');				}			});        },        /**         * Build the widget         * @method _build         * @param {object} ds : datasource         */        _build : function (ds, thisSvg, icons) {            var            i,            key,            liCss,            options,            primary,            widget,            config,            htmlObject;            widget      = this;            config      = this.config;            htmlObject  = this.$domNode;            key         = this.config['data-binding-key'];            options     = this.config['data-binding-options'];            primary     = "ID";            htmlObject.children().remove();            for (i = 0; i <= ds.length; i += 1) {                if (i <= 100) {                    ds.getElement(i, {                        onSuccess: function(e){                            var                            i,                            li,                            nb,                            val,                            split,                            label,                            value,                            display,                            dimension;                            display = false;                            if (e.element) {                                split = options.split(' ');                                label = '';                                value = e.element.getAttributeValue(key);                                li    = $('<li>');                                if (typeof(value) === 'undefined') {                                    value = e.element.getAttributeValue(primary);                                }                                nb = 0;                                for (i = 0; i < split.length; i += 1) {                                    if (split[i] !== '') {                                        nb += 1;                                        val = e.element.getAttributeValue(split[i].replace('[', '').replace(']', ''));                                        label += val + ' ';                                        if (val != null) {                                            display = true;                                        }                                    }                                }                                /*                                 *  Format if label is a number                                 */                                if (nb === 1 && label.replace(/ /g, '').match('^\\d+$') && !label.replace(/ /g, '').match('-')) {                                    label = e.data.widget.getFormattedValue(parseInt(label));                                }                                if (display) {                                    li.append($('<input/>').attr({                                        'type'    : 'radio',                                        'name'    : config.id,                                        'data-num': e.position,                                        'id'      : config.id + '-' + e.position,                                        'value'   : value                                    }));                                    li.append($('<label/>').prop('for', config.id + '-' + e.position).html(label));                                    htmlObject.append(li);                                    widget._createRadio(li, thisSvg, icons);                                    /*dimension   = config['data-display'] === 'horizontal' ? 'width' : 'height';                                    value       = 100 / htmlObject.children().length + '%';                                    htmlObject.children().map(function() {                                            //$(this).css(dimension, value);                                    });*/                                }                            }                        }                    }, {                        widget : this                    });                }            }            var childrenLi;            childrenLi = this.$domNode.children('li');            //if (WAF.PLATFORM.isTouch) {                if (this.dimension == 'width') {                    liCss = {                        'width'         : 100 / ds.length + '%',                        'height'        : this.$domNode.css('height'),                        'line-height'   : this.$domNode.css('height')                    }                } else {                    liCss = {                        'height'         : 100 / ds.length + '%',                        'width'        : this.$domNode.css('width')                    }                }                childrenLi.css(liCss);            //}            if (!WAF.PLATFORM.isTouch && this.dimension != 'width') {                var childHeight;                childHeight = childrenLi.outerHeight();                this.$domNode.find('label').css({                    'height'        : childHeight + 'px',                    'line-height'   : childHeight + 'px'                });            }            this._setPosition();        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/radiogroup/widget-radiogroup-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'radioGroup',    lib         : 'WAF',    description : 'Radio Button Group',    category    : 'Form Controls',    img         : '/walib/WAF/widget/radiogroup/icons/widget-radiogroup.png',    tag         : 'ul',    attributes  : [    {        name       : 'class',        description: 'Css class'    },    {        name       : 'data-binding',        description: 'Choice Source'    },    {        name       : 'data-binding-out',        description: 'Value Source',        typeValue  : 'datasource'    },    {        name        : 'data-display',        description : 'Display',        type        : 'dropdown',        options     : [{            key : 'vertical',            value : 'Vertical'        }, {            key : 'horizontal',            value : 'Horizontal'        }],        defaultValue: 'vertical'    },    {        name       : 'data-binding-options',        visibility : 'hidden'    },    {        name        : 'data-binding-key',        description : 'Key',        type        : 'dropdown',        options     : ['']    },    {        name       : 'data-format',        description: 'Format'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-autoDispatch',        description : 'Auto Dispatch',        type        : 'checkbox',        defaultValue: 'true'    },    {        name       : 'tabindex',        description: 'Tabindex',        typeValue   : 'integer'    },    {        name        : 'data-icon-default',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file',        ready       : function () {            var            selector;            selector = this.data.tag.currentSelector;            if (selector != '.waf-radio-box') {                this.formPanel.hide();            }        }    },    {        name        : 'data-icon-hover',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    },    {        name        : 'data-icon-active',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    },    {        name        : 'data-icon-selected',        description : 'Source',        tab         : 'style',        tabCategory : 'Icon',        type        : 'file'    }],    events: [    {        name       : 'change',        description: 'On Change',        category   : 'Focus Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'onmouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    style: [    {        name        : 'width',        defaultValue: '100px'    },    {        name        : 'height',        defaultValue: '25px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            textShadow  : false,            dropShadow  : true,            innerShadow : true,            label       : true        }    },    structure: [{        description : 'radio button area',        selector    : '.waf-radio',        style: {            background  : true,            gradient    : true,            border      : true,            text        : true,            textShadow  : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio',                mobile  : true        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio',                mobile  : true        }]    },{        description : 'radio button area - first',        selector    : '.waf-radio.waf-position-first',        style: {            background  : true,            gradient    : true,            border      : true,            text        : true,            textShadow  : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio',                mobile  : true        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio',                mobile  : true        }]    },{        description : 'radio button area - last',        selector    : '.waf-radio.waf-position-last',        style: {            background  : true,            gradient    : true,            border      : true,            text        : true,            textShadow  : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio'        }]    },{        description : 'radio button',        selector    : '.waf-radio-box',        style: {            background  : true,            gradient    : true,            border      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio'        }]    }    /*,{        description : 'radio text',        selector    : 'label',        style: {            text        : true,            textShadow  : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio'        }]    },{        description : 'icon',        selector    : '.waf-radio-icon',        style: {            background  : true,            shadow      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-radio'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-radio'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-radio'        }]    }*/],    onInit: function (config) {        return new WAF.widget.RadioGroup(config);    },    onDesign : function (config, designer, tag, catalog, isResize) {        var        icon,        theme,        states,        $radio,        radios,        options,        htmlObject,        currentState,        radiosLength,        radioGroupLength;        options     = tag.getOptions();        htmlObject  = tag.getHtmlObject();        theme       = $.trim(tag.getTheme().replace('inherited', ''));        htmlObject.children().remove();        /*         * Add display class         */        htmlObject.removeClass('waf-direction-horizontal waf-direction-vertical');        htmlObject.addClass('waf-direction-' + tag.getAttribute("data-display").getValue());        var dimension   = config['data-display'] === 'horizontal' ? 'width' : 'height',         	value,         	obj,            radioElem,            halfRadioHeight;        /*         * Create a radio input         * @method createRadio         */        tag.createRadio = function(option) {            var            radioLi,            radioInput,            radioLabel,            radioDiv,            attr,            path,            url,            imgHtml,            icons,            cssClass,            itemHeight;            option = option || {};            attr = {                type    : 'radio',                name    : tag.getId(),                value   : option.value            }            radioLi = $('<li>');            radioDiv = $('<div class="waf-widget waf-subElement waf-radio ' + tag.getTheme()+ '">');            var radioBox = $('<div class="waf-radio-box">').appendTo(radioDiv);            /*             * Svg icon             */            icons = [];            if (config['data-icon-default'])    icons.push({cssClass : 'waf-radio-icon-default',  value : config['data-icon-default']});            if (config['data-icon-hover'])      icons.push({cssClass : 'waf-radio-icon-hover',    value : config['data-icon-hover']});            if (config['data-icon-active'])     icons.push({cssClass : 'waf-radio-icon-active',   value : config['data-icon-active']});            if (config['data-icon-selected'])   icons.push({cssClass : 'waf-radio-icon-selected', value : config['data-icon-selected']});            cssClass    = 'waf-icon waf-radio-icon';            if (icons.length == 0) {                cssClass += ' waf-icon-svg';            } else {                cssClass += ' waf-icon-image';            }            icon = $('<div class="' + cssClass + '">');            if (icons.length > 0) {                for (i = 0; i < icons.length; i += 1) {                    path = Designer.util.cleanPath(icons[i].value.replace('/', ''));                    url = path.fullPath;                    imgHtml = $('<img>');                    imgHtml.addClass(icons[i].cssClass);                    imgHtml.prop({                        src : url                    });                    imgHtml.appendTo(icon);                }            } else {                icon.svg({                    loadURL: '/walib/WAF/widget/radiogroup/skin/' + theme + '/svg/widget-radiogroup-skin-' + theme + '.svg',                    onLoad: function(svg) {                            svg.configure({                                    width: '100%',                                    height: '100%',                                    preserveAspectRatio: 'none'                            });                    }                });            }            icon.appendTo(radioBox);            if (option.selected) {                attr.checked = 'checked';                radioDiv.addClass('waf-state-selected')            }            radioInput = $('<input>').attr(attr);            radioInput.appendTo(radioDiv);            radioDiv.appendTo(radioLi);            if (option.label) {                radioLabel = $('<label>').prop('for', attr.name).addClass(tag.getTheme()).html(option.label);                //radioLabel.appendTo(radioLi);                radioDiv.find('input').before(radioLabel);            }            return radioLi;        }        /*         * If only one radio         */        if (!options || (options&& options.length === 0)) {            tag.createRadio().appendTo(htmlObject);        } else {            for (var i in options) {                tag.createRadio(options[i]).appendTo(htmlObject);            }        }        window.setTimeout(function(){            radioGroupLength = htmlObject.children().length;            value = 100 / radioGroupLength + '%';            htmlObject.children().map(function(i) {            	obj = $(this);            	obj.css(dimension, value);                itemHeight = obj.get()[0].offsetHeight;            	obj.css("line-height", itemHeight + "px");            	radioElem = obj.find(".waf-radio-box");            	halfRadioHeight = radioElem.get()[0].offsetHeight / 2;            	radioElem.css("margin-top", "-"+halfRadioHeight+"px");            });        }, 0);        currentState = tag.getCurrentState();        states       = tag.getStates();        radios       = tag.getHtmlObject().find('.waf-radio');        radiosLength = radios.length;        ID           = tag.getId();        // Setting position        tag._setPosition = function( ID ) {            var radios;            var radiosLength;            radios          = $("#"+ID).find(".waf-radio");            radiosLength    = radios.length;            radios && radios.map(function(i, radio) {                if (!radio) {                    return;                }                $radio = $(radio);                if (i == 0) {                    $radio.addClass('waf-position-first');                } else {                    $radio.removeClass('waf-position-first');                }                if (i == radiosLength - 1 ) {                    $radio.addClass('waf-position-last');                } else {                    $radio.removeClass('waf-position-last');                }            });        }        window.setTimeout (function(){            tag._setPosition(ID);        },0)        // Setting state        for (i = 0; i < states.length; i += 1) {            radios.removeClass(states[i].cssClass);        }        if (currentState) {            radios.addClass(currentState.cssClass);        }    },    onCreate : function(tag, param) {    	var radios = tag.getHtmlObject().find('.waf-radio');        tag._setPosition(tag.getId());        if (param._isLoaded) {            /*             * Execute script when widget is entirely loaded (with linked tags)             */            $(tag).bind('onReady', function(){            });        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/menubar/widget-menubar.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * WAF Menu widget     *     * @class WAF.widget.Menu     * @extends WAF.Widget     */    'MenuBar',    {        // Shared private properties and methods        // NOTE: "this" is NOT available in this context    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @property constructor     * @type Function     * @default WAF.widget.GoogleMap     **/    function (inConfig, inData, shared) {        var        i,        theme,        level,        themes,        classes,        direction,        isSubmenu,        tabMargin,        parentsBar,        htmlObject,        parentClasses,        htmlObjectItem,        htmlObjectItems,        htmlObjectItemsLenght;        htmlObject          = this.$domNode;        htmlObjectItems     = htmlObject.children('.waf-menuItem');        htmlObjectItemsLength = htmlObjectItems.length;        level				= inData.level || 0;        classes             = htmlObject.prop('class');        isSubmenu           = level > 0;        parentsBar          = htmlObject.parents('.waf-menuBar');        parentClasses       = isSubmenu ? htmlObject.parents('.waf-menuBar').prop('class') : '';        tabMargin           = inData['tab-margin'] || 0;        level               = parentsBar.length;        htmlObject.addClass('waf-menuBar-' + inData.display);        /*if (WAF.PLATFORM.modulesString == "mobile") {            htmlObject[0].style.width = "100% !important";        }*/        // Setting the theme        if (inData.theme) {           htmlObject.addClass(inData.theme);        }        themes = [];        for (i in WAF.widget.themes) {            theme = WAF.widget.themes[i].key;            if (classes.match(theme)) {               if (isSubmenu) {                   htmlObject.removeClass(theme);                   htmlObjectItems.removeClass(theme);               }            }            if (parentClasses.match(theme)) {                themes.push(theme);            }        }        if (isSubmenu) {            htmlObject.addClass(themes.join(' '));            htmlObjectItems.addClass(themes.join(' '));        }		// Setting classes		for (var i = 0; i < htmlObjectItemsLength; i++) {			htmlObjectItem = htmlObjectItems.eq(i);            // Setting position first			if (i == 0) {				htmlObjectItem.addClass('waf-menuItem-first');			} else {				htmlObjectItem.removeClass('waf-menuItem-first');			}            htmlObjectItem                // Setting level    			.addClass('waf-menuItem-level-' + level)                // Setting direction                .removeClass('waf-menuItem-horizontal waf-menuItem-vertical')                .addClass('waf-menuItem-' + inData.display);            // Setting position last			if (i == (htmlObjectItemsLength - 1)) {				htmlObjectItem.addClass('waf-menuItem-last');			} else {				htmlObjectItem.removeClass('waf-menuItem-last');			}		}        /*         * @DEPRECATED : Add margin (margin is now set into the css style sheet)         */        if (tabMargin) {            switch (inData.display) {                case 'horizontal':                    htmlObject.children('li:not(:last-child)').css({'margin-right': tabMargin + 'px'});                    break;                case 'vertical':                    htmlObject.children('li:not(:last-child)').css({'margin-bottom': tabMargin + 'px'});                    break;            }        }    }, {        /**         * Get the menu items of the menubar         * @method getMenuItems         * @return {array} list of menu items         */        getMenuItems : function menubar_get_menuitems () {            var            items;            items = [];            $.each(this.$domNode.children(), function() {                items.push($$($(this).prop('id')));            });            return items;        },        /**         * Get a specific menu item         * @method getMenuItem         * @return {object} menu item         */        getMenuItem : function menubar_get_menuitem (index) {            return this.getMenuItems()[index];        },        setWidth : function menuitem_set_width(value) {            /*             * Set dom node width             */            this.$domNode.css('cssText', 'width:' +  value + 'px !important')            /*             * Call resize function             */            this._callResizeEvents('stop');        },        setHeight : function menuitem_set_height(value) {            /*             * Set dom node width             */            this.$domNode.css('cssText', 'height:' +  value + 'px !important')            /*             * Call resize function             */            this._callResizeEvents('stop');        },        /**         * Get the selected menu item         * @method getSelectedMenuItem         * @return {object} selected menu item         */        getSelectedMenuItem : function getSelectedMenuItem () {            var            index,            result;            index = this.$domNode.children('li').index(this.$domNode.children('.waf-state-selected'));            if (index != -1) {                result = this.getMenuItem(index);            } else {                result = null;            }            return result;        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/menubar/widget-menubar-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'menuBar',    lib         : 'WAF',    description : 'Menu Bar',    category    : 'Misc. Controls',    img         : '/walib/WAF/widget/menuBar/icons/widget-menuBar.png',    tag         : 'ul',    attributes  : [    {        name       : 'class',        description: 'Css class'    },    {        name        : 'data-level',        visibility  : 'hidden'    },    {        name        : 'data-display',        description : 'Display',        type        : 'dropdown',        options     : [{                key     : 'vertical',                value   : 'Vertical'        },{                key     : 'horizontal',                value   : 'Horizontal'        }],        defaultValue: 'horizontal',        saveHistory : false,        onchange    : function (argument) {            this.data.tag.changeOrientation(this.getValue());        }    },    {        name        : 'data-subMenuShow',        description : 'Show Submenus',        type        : 'dropdown',        options     : [{            key     : 'hover',            value   : 'On Mouse Over'        },{            key     : 'click',            value   :'On Mouse Click'        }],        defaultValue: 'hover'    },    {        name        : 'data-tab-margin',        description : 'Items Margin',        defaultValue: 0,        typeValue   : 'integer',        slider      : {            min : -10,            max : 10        },        saveHistory : false,        ready       : function() {            var            i,            tag,            selection,            selectionL;            tag         = this.data.tag;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                tag._tmpMargin = tag.getAttribute('data-tab-margin').getValue();            } else {                tag._tmpMargin = D.ui.selection.getAttribute('data-tab-margin').getValue();            }        },        beforechange    : function () {            var            i,            tag,            selection,            selectionL;            tag         = this.data.tag;            selection   = Designer.env.tag.selection;            selectionL  = selection.count();            if (selectionL <= 0) {                tag._tmpMargin = tag.getAttribute('data-tab-margin').getValue();            } else {                tag._tmpMargin = D.ui.selection.getAttribute('data-tab-margin').getValue();            }        },        onchange    : function () {            if (Designer.env.enableHistory) {                this.data.tag.setMargin(this.getValue(), true, false);            }        }    },    {        name        : 'data-items',        description : 'Menu items',        type        : 'grid',        domAttribute: false,        columns     : [{            type        : 'button',            buttonType  : 'image',            icon        : 'edit'        }, {            type        : 'textField'        }],        ready       : function () {            var            i,            tag,            item,            items,            itemsL;            tag     = this.data.tag;            items   = tag.getItems();            itemsL  = items.length;            for (i = 0; i < itemsL; i += 1) {                item = items[i];                this.addRow([{                    type        : 'button',                    buttonType  : 'image',                    icon        : 'edit',                    data        : { item    : item },                    onclick     : function () {                        this.data.item.setCurrent();                        D.tag.refreshPanels();                    }                }, {                    type        : 'textField',                    value       : item.getText ? item.getText() : '',                    data        : { item    : item },                    onchange    : function () {                        this.data.item.setText(this.getValue());                    }                }], false, true, false);            }        },        afterRowAdd : function(data) {            var            input,            newItem;            input = data.items[1];            /*             * Add new menu item             */            newItem = this.data.tag.addMenuItem();            data.items[0].htmlObject.bind('click', {item: newItem}, function (e) {                e.data.item.setCurrent();                D.tag.refreshPanels();            });            /*             * Change input value             */            input.setValue(newItem.getText());            input.data = {                item : newItem            };            input.onchange = function  (argument) {                this.data.item.setText(this.getValue());            };        },        afterRowDelete : function(data) {            var            menuItem;            menuItem = data.items[1].data.item;            menuItem.remove(false);        },        afterRowSort : function(data) {            /*             * Call menubar sort function             */            this.data.tag.sort(data.movedIndex, data.index);        }    }],    events : [{        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'onmouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    style : [    {        name        : 'width',        defaultValue: function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "180px";                } else {                    result = "332px";                }                return result;            }        }.call()    },    {        name        : 'height',        defaultValue: '52px'    }],    properties : {        style: {            theme       : true,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : true,            shadow      : true,            disabled    : ['border-radius']        }    },    structure: [{        group       : 'all menu items',        description : 'all menu items',        selector    : '.waf-menuItem',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem'        }]    },{        group       : 'all menu items',        description : 'all menu items - first',        selector    : '.waf-menuItem-first',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem-first'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem-first'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem-first'        }]    },{        group       : 'all menu items',        description : 'all menu items - last',        selector    : '.waf-menuItem-last',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem-last'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem-last'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem-last'        }]    },{        group       : 'main menu items',        description : 'main menu items',        selector    : '.waf-menuItem-level-0',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem-level-0'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem-level-0'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem-level-0'        }]    },{        group       : 'main menu items',        description : 'main menu items - first',        selector    : '.waf-menuItem-level-0.waf-menuItem-first',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem-level-0.waf-menuItem-first'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem-level-0.waf-menuItem-first'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem-level-0.waf-menuItem-first'        }]    },{        group       : 'main menu items',        description : 'main menu items - last',        selector    : '.waf-menuItem-level-0.waf-menuItem-last',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem-level-0.waf-menuItem-last'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem-level-0.waf-menuItem-last'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem-level-0.waf-menuItem-last'        }]    },{        group       : 'submenu items',        description : 'submenu items',        selector    : '.waf-menuItem .waf-menuItem',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem .waf-menuItem'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem .waf-menuItem'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem .waf-menuItem'        }]    },{        group       : 'submenu items',        description : 'submenu items - first',        selector    : '.waf-menuItem .waf-menuItem-first',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem .waf-menuItem-first'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem .waf-menuItem-first'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem .waf-menuItem-first'        }]    },{        group       : 'submenu items',        description : 'submenu items - last',        selector    : '.waf-menuItem .waf-menuItem-last',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem .waf-menuItem-last'        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem .waf-menuItem-last'        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem .waf-menuItem-last'        }]    }],    menu : [{        icon        : '/walib/WAF/widget/menubar/icons/round_plus.png',        title       : 'Add an item',        callback    : function(){            /*             * Add a menu item to the menu bar             */            this.addMenuItem();            /*             * Refresh property panel             */            Designer.tag.refreshPanels();        }    }],    onInit: function (config) {        var widget  = new WAF.widget.MenuBar(config);        return widget;    },    onDesign : function (config, designer, tag, catalog, isResize) {        var        htmlObject,        orientation;        htmlObject  = tag.getHtmlObject();        orientation = tag.__oldOrientation = tag.getAttribute('data-display').getValue();        /*         * Set widget class depending on orientation         */        htmlObject.addClass('waf-menuBar-' + orientation);    },    onCreate : function (tag, param) {        var        i,        level,        jQTag;        param.data  = param.data || {};        firstClass  = 'waf-menuItem-first';        lastClass   = 'waf-menuItem-last';        jQTag       = $(tag);        /**         * Get the menubar items margin         * @function getMargin         * @return {number}         */        tag.getMargin = function menubar_get_margin () {            return parseInt(this.getAttribute('data-tab-margin').getValue());        }        /**         * Set the menubar items margin         * @function setMargin         * @param {number} value         * @param {boolean} save to save menubar size         * @param {boolean} force to foce data-tab-margin attribute to be setted         */        tag.setMargin = function menubar_set_margin (value, save, force) {            var            i,            items,            itemsL,            oldVal,            history,            cssProp,            iCssProp,            htmlObject,            addToWidth;            items       = this.getItems();            itemsL      = items.length;            htmlObject  = this.getHtmlObject();            save        = typeof save   == 'undefined' ? true : save;            force       = typeof force  == 'undefined' ? true : force;            history     = false;            Designer.beginUserAction('083');            oldVal = typeof this._tmpMargin != 'undefined' ? this._tmpMargin : this.getMargin();            if (D.env.enableHistory) {                history = true;                var action = new Designer.action.setMargin({                        val         : value,                        oldVal      : oldVal,                        tagId       : this.id,                        data        : {                            oldWidth   : this.getWidth(),                            oldHeight  : this.getHeight()                        }                });                Designer.getHistory().add(action);                Designer.disableHistory();            }            this._tmpMargin = null;            if (force) {                this.getAttribute('data-tab-margin').setValue(value);            }            if (this.getOrientation() == 'horizontal') {                cssProp     = 'margin-right';                iCssProp    = 'margin-bottom';            } else {                cssProp     = 'margin-bottom';                iCssProp    = 'margin-right';            }            /*             * Remove old margin             */            this.setCss(cssProp, value + 'px', '> .waf-menuItem:not(.waf-menuItem-last)');            this.setCss(iCssProp, '0px', '> .waf-menuItem');            addToWidth = this.getItems().length * value;            /*             * Resize menu bar if necessary             */            if (save) {                this.checkSize();            }            if (history) {                Designer.enableHistory();            }        }        /**         * Chech the margin and resize if necessary         * @function checkMargin         * @param {boolean} save to save menubar size         */        tag.checkMargin = function menubar_check_margin (save) {            var            margin;            margin = this.getMargin();            save    = typeof save   == 'undefined' ? true : save;            /*             * Check if a margin is defined on create             */            if (margin) {                this.setMargin(margin, save, false);            }        }        /**         * Get the level of the menubar         * @function getLevel         * @return {number}         */        tag.getLevel = function menubar_get_level () {            var            parents,            htmlObject;            htmlObject  = this.getHtmlObject();            if (typeof this.level == 'undefined') {                parents     = htmlObject.parents('.waf-' + this.getType());                this.level  = parents.length;            }            if (this.level > 0) {                htmlObject.addClass('waf-subWidget')            }            return this.level;        }        /**         * Sort the menu items of the menu bar         * @function sort         * @param {number} from source index number         * @param {number} to destination index number         */        tag.sort = function menubar_sort (from, to)  {            var            ref,            item,            input,            where,            domEltLi1,            domEltLi2,            domEltBar,            tmpDomElt,            htmlObject;            item        = this.getItems()[from];            htmlObject  = item.getHtmlObject();            ref         = htmlObject.parent().children('li:not(:hidden)').eq(to);            where       = to > from ? 'after' : 'before';            /*             * Get dom object (from dom API)             */            domEltLi1 = Designer.env.document.getElementsByAttribute('li', 'id', item.getId())[0];            domEltLi2 = Designer.env.document.getElementsByAttribute('li', 'id', ref.prop('id'))[0];            domEltBar = Designer.env.document.getElementsByAttribute('ul', 'id', this.getId())[0];            tmpDomElt = domEltLi1;            Designer.beginUserAction('068');            var action = new Designer.action.SortMenuItem({                   val      : '0',                   oldVal   : '1',                   tagId    : this.id,                   data      : {                        oldIndex    : from,                        newIndex    : to,                        item        : item,                        where       : where                   }            });            Designer.getHistory().add(action);            domEltLi1.remove();            /*             * Move into dom             */            if (where == 'after')  {                ref.after(htmlObject);                /*                 * Move into dom api                 */                domEltBar.insertAfter(tmpDomElt, domEltLi2);            } else {                ref.before(htmlObject);                /*                 * Move into dom api                 */                domEltBar.insertBefore(tmpDomElt, domEltLi2);            }            this._setClasses();        }        /**         * Add class on menu items dom element         * @function _setClasses         */        tag._setClasses = function menubar_set_classes () {            var            level,            items,            menuBar,            levelClass,            orientation;            menuBar     = this;            orientation = this.getOrientation();            items       = this.getItems();            level       = menuBar.getLevel();            levelClass  = 'waf-menuItem-level-' + level;            $.each(items, function (i) {                var                classes,                htmlObject;                classes     = [];                htmlObject  = this.getHtmlObject();                classes.push('waf-menuItem-' + orientation);                if (i == 0) {                    classes.push(firstClass);                } else {                    htmlObject.removeClass(firstClass);                }                if (i == items.length-1) {                    classes.push(lastClass);                } else {                    htmlObject.removeClass(lastClass);                }                /*                 * Default add level class                 * @DEPRECATED                 */                if (!htmlObject.hasClass(levelClass)) {                    classes.push(levelClass);                }                htmlObject.addClass(classes.join(' '));            });        }        /**         * Get the orientation of the widget         * @function getOrientation         * @return {string} horizontal|vertical         */        tag.getOrientation = function menubar_get_orientation () {            return this.getAttribute('data-display').getValue();        }        /**         * Change widget orientation         * @function changeOrientation         * @param {string} orientation         */        tag.changeOrientation = function menubar_change_orientation (orientation, sizes) {            var            size,            parent,            borders,            newSize,            itemsInfo,            classToAdd,            classToRemove;            sizes   = sizes || {};            size    = this.getSize();            Designer.beginUserAction('069');            if (D.env.enableHistory) {                var action = new Designer.action.ChangeMenubarOrientation({                        val         : orientation,                        oldVal      : orientation == 'horizontal' ? 'vertical' : 'horizontal',                        tagId       : this.id,                        data        : {                            width   : size.width,                            height  : size.height                        }                });                Designer.getHistory().add(action);            }            tag.getAttribute('data-display').setValue(orientation);            classToAdd  = 'waf-menuItem-' + orientation;            itemsInfo   = this.itemsInfo({                resizeHandles : orientation == 'horizontal' ? 'e, w' : 'n, s'            });            borders     = this.getBorders();            parent = this.getParent();            switch (orientation) {                case 'horizontal':                    this.minWidth   = itemsInfo.size + borders.LR;                    this.minHeight  = null;                    classToRemove   = 'waf-menuItem-vertical';                    if (WAF.PLATFORM.modulesString === "touch" && parent && parent.getType() == 'tabView') {                        this.setWidth(parent.getWidth());                    } else {                        this.setWidth(sizes.width || this.minWidth);                    }                    this.setHeight(sizes.height || itemsInfo.maxHeight + borders.TB);                    this.getHtmlObject().removeClass('waf-menuBar-vertical')                    break;                case 'vertical':                    this.minHeight = itemsInfo.size + borders.LR;                    this.minWidth  = 2;                    if (WAF.PLATFORM.modulesString === "touch" && parent && parent.getType() == 'tabView') {                        this.setHeight(parent.getHeight());                    } else {                        this.setHeight(sizes.height || this.minHeight);                    }                    newSize = sizes.width || itemsInfo.maxWidth + borders.TB;                    this.setWidth(newSize);                    classToRemove   = 'waf-menuItem-horizontal';                    this.getHtmlObject().removeClass('waf-menuBar-horizontal');                    break;            }            /*             * Remove orientation class on children             */            this.getHtmlObject().children('li')                                    .removeClass(classToRemove)                                    .addClass(classToAdd);            this.checkMargin(false);        }        /**         * Add a menu item widget         * @function addMenuItem         * @param {object}         * @return {object} menuItem         */        tag.addMenuItem = function menubar_add_menu_item (param) {            var            width,            height,            parent,            borders,            menuItem,            itemsInfo,            orientation;            borders     = this.getBorders();            param       = param || {};            orientation = this.getOrientation();            if (param.optimize !== false) {                Designer.env.enableModificationNotification = false;            }            /*             * History for menu item add             */            if (!param.menuBarInit) {                Designer.beginUserAction('040');                var action = new Designer.action.AddMenuItem({                       val      : '0',                       oldVal   : '1',                       tagId    : this.id,                       data      : {                            selectedTab : param.currentIndex,                            orientation : orientation,                            size        : orientation == 'horizontal' ? this.getWidth() : this.getHeight()                       }                });                Designer.getHistory().add(action);            }            if (param.width) {                width       = param.width;                width      -= borders.LR;            }            if (param.height) {                height       = param.height;                height      -= borders.TB;            }            parent = tag.getParent();            switch (orientation) {                case 'horizontal':                    height      = this.getHeight();                    // @DIRTY                    if (WAF.PLATFORM.modulesString === "touch" && parent && parent.getType() == 'tabView' && borders.TB == 0) {                       borders.TB = 2;                    }                    height     -= borders.TB;                    if (param.parentPadding) {                        this._parentPadding = param.parentPadding * 2;                        height -= this._parentPadding;                    }                    break;                case 'vertical':                    width      = this.getWidth();                    // @DIRTY                    if (WAF.PLATFORM.modulesString === "touch" && parent && parent.getType() == 'tabView' && borders.LR == 0) {                       borders.LR = 2;                    }                    width     -= borders.LR;                    if (param.parentPadding) {                        this._parentPadding = param.parentPadding * 2;                        width -= this._parentPadding;                    }                    break;            }            menuItem = D.createTag({                type        : 'menuItem',                height      : height,                width       : width,                silentMode  : true,                parent      : tag            });            itemsInfo   = this.itemsInfo();            switch (orientation) {                case 'horizontal':                    this.minWidth = itemsInfo.size + borders.LR;                    break;                case 'vertical':                    this.minHeight = itemsInfo.size + borders.TB;                    break;            }            param.focusOnMenu = typeof param.focusOnMenu != 'undefined' ? param.focusOnMenu : true;            if (param.focusOnMenu && this.getParent().getType() != 'tabView') {                this.setResizable(true);            }            this._setClasses();            $(this).trigger('afterAddItem', [menuItem, true]);            if (param.optimize !== false) {                Designer.env.enableModificationNotification = true;                D.studio.setDirty();            }            return menuItem;        }        /**         * Check if the menu items are out of menubar         * @function checkSize         * @return {object} menu items info         */        tag.checkSize = function menubar_check_size () {            var            info,            borders,            menuBarSize,            menuItemsSize;            info            = this.itemsInfo();            menuItemsSize   = info.size;            borders         = this.getBorders();            switch (info.orientation) {                case 'horizontal':                    menuBarSize = this.getWidth();                    if (menuItemsSize > menuBarSize) {                        this.setWidth(menuItemsSize + borders.LR);                    }                    this.minWidth = info.size + borders.LR;                    break;                case 'vertical':                    menuBarSize = this.getHeight();                    if (menuItemsSize > menuBarSize) {                        this.setHeight(menuItemsSize + borders.TB);                    }                    this.minHeight = info.size + borders.TB;                    break;            }            return info;        }        /**         * Get children menu items info         * @function itemsInfo         * @return {object} info         */        tag.itemsInfo = function menubar_get_items_info(param) {            var            i,            size,            width,            height,            margin,            menuItem,            maxWidth,            maxHeight,            menuItems,            menuItemsL,            orientation,            menuItemsWidth,            menuItemsHeight;            param           = param || {};            menuItems       = this.getItems();            menuItemsL      = menuItems.length;            menuItemsHeight = 0;            menuItemsWidth  = 0;            maxHeight       = 0;            maxWidth        = 0;            orientation     = this.getOrientation();            margin          = this.getMargin();            for (i = 0; i < menuItemsL; i += 1) {                menuItem        = menuItems[i];                size            = menuItem.getSize(true);                width           = size.width;                height          = size.height;                menuItemsWidth  += width;                menuItemsHeight += height;                /*                 * Add margin to size                 */                if (i != menuItemsL - 1) {                    if (orientation == 'horizontal') {                        menuItemsWidth += margin;                    } else {                        menuItemsHeight += margin;                    }                }                if (height > maxHeight) {                    maxHeight = height;                }                if (width > maxWidth) {                    maxWidth = width;                }                if (menuItem._additionalHeight) {                    maxHeight -= menuItem._additionalHeight;                }                if (menuItem._additionalWidth) {                    maxWidth -= menuItem._additionalWidth;                }                if (param.resizeHandles) {                    menuItem.resizeHandles = param.resizeHandles;                }            }            if (orientation == 'horizontal') {                size        = menuItemsWidth;                if (this._parentPadding) {                    maxHeight  += this._parentPadding;                }            } else {                size        = menuItemsHeight;                if (this._parentPadding) {                    maxWidth   += this._parentPadding;                }            }            return {                length      : menuItemsL,                size        : size,                orientation : orientation,                maxHeight   : maxHeight,                maxWidth    : maxWidth            }        }        /**         * Get children menu items         * @function getMenuItems         * @return {object} list of menu items         */        tag.getItems = function menubar_get_items(force) {            return this.getChildren(false)        }        /**         * Get the widget borders info         * @function getBorders         * @return {object}         */        tag.getBorders = function menubar_get_borders () {            var            top,            left,            right,            bottom;            left    = parseInt(this.getComputedStyle('border-width'));            top     = left;            right   = left;            bottom  = left;            return {                left    : left,                top     : top,                right   : right,                bottom  : bottom,                LR      : left + right,                TB      : top + bottom            }        }        if (!param._isLoaded) {            jQTag.bind('onReady', {menuItem : tag}, function (e, data) {                if (data && data.from == 'redo') {                    return;                }                if (param.data.optimize !== false) {                    Designer.env.enableModificationNotification = false;                }                /*                 * Indicate that the menubar is a submenu                 */                if (this.getParent().getType() === 'menuItem') {                    this._isSubMenu = true;                }                /*                 * Check menubar items margin and resize if necessary                 */                this.checkMargin(true);                if (!param.data.noItems) {                    /*                     * Auto create 3 menu items                     */                    for (i = 0; i < 3; i += 1) {                        tag.addMenuItem({                            menuBarInit : true,                            width       : param.data.itemsWidth,                            optimize    : false                        });                    }                }                if (param.data.optimize !== false) {                    Designer.env.enableModificationNotification = true;                    D.studio.setDirty();                }                /*                 * Auto resize menubar on mobile (same size of menu items total size)                 */                if (WAF.PLATFORM.modulesString == "touch" && this.getOrientation() == "horizontal") {                    var                    info,                    borders;                    info    = this.itemsInfo();                    borders = this.getBorders();                    this.setWidth(info.size + borders.LR,false);                }            });        } else {            jQTag.bind('onReady', {menuItem : tag}, function (e) {                var                info,                item,                items,                itemsL,                borders,                htmlObject;                info        = this.itemsInfo();                borders     = this.getBorders();                items       = this.getItems();                itemsL      = items.length;                htmlObject  = this.getHtmlObject();                levelClass  = 'waf-menuBar-level' + this.getLevel();                if (info.orientation == 'horizontal') {                    this.minWidth = info.size + borders.LR;                } else {                    this.minHeight = info.size + borders.TB;                }                this._setClasses();                /*                 * Indicate that the menubar is a submenu                 */                if (this.getParent().getType() === 'menuItem') {                    this._isSubMenu = true;                }                /*                 * Default add level class                 * @DEPRECATED                 */                if (!htmlObject.hasClass(levelClass)) {                    htmlObject.addClass(levelClass);                }                /*                 * Check menubar items margin                 */                this.checkMargin(true);            });        }        /*         * Resize menu items on menubar resize         */        jQTag.bind('onResize', {menuItem : tag}, function (e, sizeParams) {            var            i,            item,            items,            width,            height,            itemsL,            subMenu,            borders,            newWidth,            newHeight,            orientation;            items       = this.getItems();            borders     = this.getBorders();            itemsL      = items.length;            orientation = this.getOrientation();            newHeight   = sizeParams.height;            newWidth    = sizeParams.width;            D.env._prevenItemstResize = true;            for (i = 0; i < itemsL; i += 1) {                item    = items[i];                subMenu = item.getSubMenu();                switch (orientation) {                    case 'horizontal':                        if (newHeight) {                            height = newHeight;                            if (this._parentPadding) {                                height -= this._parentPadding;                            }                            item.setHeight(height - borders.TB);                        }                        /*                         * Reset position of sub menu                         */                        if (subMenu) {                            subMenu.setXY(0, newHeight);                        }                        break;                    case 'vertical':                        if (newWidth) {                            width = newWidth;                            if (this._parentPadding) {                                width -= this._parentPadding;                            }                            item.setWidth(width - borders.LR);                        }                        /*                         * Reset position of sub menu                         */                        if (subMenu) {                            subMenu.setXY(newWidth, 0);                        }                        break;                }            }            /*             * Auto resize menubar on mobile (same size of menu items total size)             */            if (WAF.PLATFORM.modulesString == "touch" && orientation == "horizontal") {                var                info;                info = this.itemsInfo();                this.setWidth(info.size + borders.LR,false);            }            D.env._prevenItemstResize = false;        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/menuitem/widget-menuitem.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * WAF Menu widget     *     * @class WAF.widget.Menu     * @extends WAF.Widget     */    'MenuItem',    {        // Shared private properties and methods        // NOTE: "this" is NOT available in this context    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @property constructor     * @type Function     * @default WAF.widget.GoogleMap     **/    function (inConfig, inData, shared) {        var        htmlObject,        height,        width,        paragraphe,        padding,        fnShow,        fnHide,        subMenuShow,        parentSubMenuShow,        parentBars,        except,        objHtmlText,        widget,        exceptItem;        widget              = this;        htmlObject          = $(this.containerNode);        parentBars          = htmlObject.parents('.waf-menuBar');        objHtmlText         = htmlObject.children('.waf-menuItem-text');        height              = htmlObject.outerHeight();        width               = htmlObject.outerWidth();        paragraphe          = htmlObject.children('p');        padding             = parseInt(htmlObject.css('padding-left'), 10);        width               = (parseInt(width, 10) - (padding*2));        height              = (parseInt(height, 10) - (padding*2));        subMenuShow         = $(parentBars[parentBars.length - 1]).attr('data-subMenuShow');        /*        * force event type for mobile        */        if (waf.PLATFORM.isTouch) {            subMenuShow = "click";        }        if (inData.theme) {           htmlObject.addClass(inData.theme);        }        paragraphe.css({            height  : height + 'px',            width   : width + 'px'        });        objHtmlText.html() && objHtmlText.html(objHtmlText.html().replace(/\n/g, '<br/>'));        // Setting the theme        if (inData.theme) {           htmlObject.addClass(inData.theme);        }        /**         * Display a submenu         */        fnShow = function fnShow (e) {            var            that,            ul;            that    = $(this);            ul      = that.children('ul');            /*             * Prevent script execution if disabled             */            if (widget.isDisabled()) {                return false;            }            if (e.type === 'click') {                except      = '';                exceptItem  = '';                $('#' + widget.getParent().id +' .waf-menuItem .waf-menuBar').each(function(){                    var thisBarId = $(this).prop('id');                    parentBars.each(function() {                        var thatElt = $(this);                        if (thatElt.prop('id') === thisBarId) {                            except += '[id!=' + thisBarId + ']';                            exceptItem += '[id!=' + thatElt.parent().prop('id') + ']';                        }                    })                });                $('#' + widget.getParent().id +' .waf-menuItem .waf-menuBar' + except + '').fadeOut(200);                $('#' + widget.getParent().id +' .waf-menuItem' + exceptItem + '').removeClass('waf-state-selected');                that.addClass('waf-state-selected');            } else {                !(that.hasClass('waf-state-selected') || that.hasClass('waf-state-active'))  && that.addClass('waf-state-hover');            }            $('#' + that.prop('id') + '>ul>li>p').css('width', that.outerWidth() + 'px')            ul.stop(true, true).fadeIn(100);        }        /**         * Hide a submenu         */        fnHide = function fnHide (e) {            var            that,            ul;            /*             * Prevent script execution if disabled             */            if (widget.isDisabled()) {                return false;            }            that    = $(this);            ul      = that.children('ul');            ul.stop(true, true).fadeOut(200);            if (e.type !== 'click') {                that.removeClass('waf-state-hover waf-state-active');            }        }        switch (subMenuShow) {            case 'click' :                htmlObject.click(fnShow);                // Add hover class on hover                htmlObject.hover(                    function(e){                        !($(this).hasClass('waf-state-selected') || $(this).hasClass('waf-state-active')) && $(this).addClass('waf-state-hover')                    },                    function(e){                        $(this).removeClass('waf-state-hover')                    }                );                break;            default :                htmlObject.mouseenter(fnShow);                htmlObject.mouseleave(fnHide);                break;        }        /*         * Active state on mouse down         */        htmlObject.bind('mousedown', function(e) {            var            widget,            htmlObject;            htmlObject  = $(this);            htmlObject                .removeClass('waf-state-hover')                .addClass('waf-state-active');            e.stopPropagation();        });        /*         * Remve state on mouse down         */        htmlObject.bind('mouseup', function(e) {            var            widget,            htmlObject;            htmlObject  = $(this);            htmlObject.removeClass('waf-state-active');            (subMenuShow !== 'click') && htmlObject.addClass('waf-state-hover')        });        htmlObject.bind('click', function(e) {            var            id,            widget,            htmlObject;            htmlObject  = $(this);            id          = htmlObject.prop('id');            widget      = $$(id);            if (widget.onClick) {                widget.onClick();            }            e.stopPropagation();        });    }, {        ready : function (argument) {            var            richText;            richText = this.$domNode.children('.waf-richText');            richText.addClass('waf-menuItem-text');            /*             * @DEPRECATED: Remove old paragraphe (paragraphes are deprecated)             */            if (richText.length > 0) {                this.$domNode.find('p').remove();                if (richText.css('top') != '0px') {                    richText.css({                        'top'   : '0px',                        'left'  : '0px'                    })                }            }        },        /**         * Get the index of the menu item         * @method getIndex         * @return {number} index         */        getIndex : function menuitem_get_index() {           return this.$domNode.index();        },        /**         * Change the menu item         */        renameMenuItem : function menuitem_rename_menuItem(label) {            var            richText;            richText = this.$domNode.children('.waf-menuItem-text');            richText.html(label);        },        setWidth : function menuitem_set_width(value) {            var            tabs,            menuBar,            totalWidth,            menuBarMargin;            menuBar     = this.getParent();            /*             * Set dom node width             */            this.$domNode.width(value);            /*             * Call resize function             */            this._callResizeEvents('stop');            /*             * Resize menuItem             */            tabs            = menuBar.$domNode.children('.waf-menuItem');            totalWidth      = 0;            menuBarMargin   = parseInt(menuBar.config['data-tab-margin']);            $.each(tabs, function(i){               totalWidth += tabs.outerWidth();               if (i != tabs.length-1) {                    totalWidth += menuBarMargin;               }            });            /*             * Update only if the size is smaller than total size             */            if (totalWidth >= menuBar.getWidth()) {                menuBar.setWidth(totalWidth);            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/menuitem/widget-menuitem-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'menuItem',    lib         : 'WAF',    description : 'Menu Item',    category    : 'Hidden',    img         : '/walib/WAF/widget/menuItem/icons/widget-menuItem.png',    tag         : 'li',    hasOverlay  : false,    attributes  : [{        name        : 'data-text',        description : 'Text',        ready       : function () {            var            tag;            tag = this.data.tag;            this.setValue(tag.getText());        },        onchange    : function () {            var            tag;            tag = this.data.tag;            tag.setText(this.getValue());        }    },{        name        : 'data-icon',        type        : 'file',        description : 'Icon',        ready       : function () {            var            tag,            contentWidget;            tag             = this.data.tag;            contentWidget   = tag.getContentWidget();            if (contentWidget && contentWidget.getType() == 'icon') {                this.setValue(contentWidget.getPath());            }        },        onchange    : function () {            var            tag;            tag             = this.data.tag;            tag.setIcon(this.getValue());        }    },{        name        : 'data-items',        description : 'Menu items',        type        : 'grid',        domAttribute: false,        columns     : [{            type        : 'button',            buttonType  : 'image',            icon        : 'edit'        }, {            type : 'textField'        }],        ready       : function (argument) {            var            i,            tag,            item,            items,            itemsL,            subMenu;            tag     = this.data.tag;            subMenu = tag.getSubMenu();            /*             * Do not display if menu item is inside a tabview             */            if (tag.getParent().getParent().getType() == 'tabView') {                this.formPanel.htmlObject.hide();            }            if (subMenu) {                items   = subMenu.getItems();                itemsL  = items.length;                for (i = 0; i < itemsL; i += 1) {                    item = items[i];                    this.addRow([{                        type        : 'button',                        buttonType  : 'image',                        icon        : 'edit',                        data        : { item    : item },                        onclick     : function () {                            this.data.item.setCurrent();                            D.tag.refreshPanels();                        }                    }, {                        type        : 'textField',                        value       : item.getText ? item.getText() : '',                        data        : { item    : item },                        onchange    : function (argument) {                            this.data.item.setText(this.getValue());                        }                    }], false, true, false);                }            }        },        afterRowAdd : function(data) {            var            input,            newItem;            input   = data.items[1];            /*             * Add new menu item             */            newItem = this.data.tag.addMenuItem();            data.items[0].htmlObject.bind('click', {item: newItem}, function (e) {                e.data.item.setCurrent();                D.tag.refreshPanels();            });            /*             * Change input value             */            input.setValue(newItem.getText());            input.data = {                item : newItem            };            input.onchange = function  (argument) {                this.data.item.setText(this.getValue());            };        },        afterRowDelete : function(data) {            var            menuItem;            menuItem = data.items[1].data.item;            menuItem.remove(false);        },        afterRowSort : function(data) {            var            tag,            subMenu;            tag     = this.data.tag;            subMenu = tag.getSubMenu();            /*             * Call menubar sort function             */            subMenu.sort(data.movedIndex, data.index);        }    }],    events: [{        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'onmouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    style: [{        name        : 'width',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "60px";                } else {                    result = "110px";                }                return result;            }        }.call()    },    {        name        : 'height',        name        : 'height',        defaultValue: function (config) {            var devaultValue = '22px';            if (config && config.parent && config.parent.getLevel() == 0) {                devaultValue = '50px';            }            return devaultValue;        }.call()    }],    properties: {        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            textShadow  : true,            innerShadow : true,            shadow      : true,            disabled    : ['left', 'top', 'z-index']        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                mobile  : true        },{                label   : 'selected',                cssClass: 'waf-state-selected',                mobile  : true        },{                label   : 'disabled',                cssClass: 'waf-state-disabled',                mobile  : true        }]    },    structure: [{        description : 'submenu bars',        selector    : '.waf-menuBar',        style: {            theme       : true,            fClass      : true,            text        : false,            background  : true,            border      : true,            label       : true,            shadow      : true,            disabled    : ['border-radius']        }    },{        description : 'submenu items',        selector    : '.waf-menuItem',        style: {            theme       : false,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            textShadow  : true,            innerShadow : true,            shadow      : true        },        state : [{                label   : 'hover',                cssClass: 'waf-state-hover',                find    : '.waf-menuItem',                mobile  : false        },{                label   : 'active',                cssClass: 'waf-state-active',                find    : '.waf-menuItem',                mobile  : true        },{                label   : 'selected',                cssClass: 'waf-state-selected',                find    : '.waf-menuItem',                mobile  : true        },{                label   : 'disabled',                cssClass: 'waf-state-disabled',                find    : '.waf-menuItem',                mobile  : true        }]    }],    onInit: function (config) {        var widget  = new WAF.widget.MenuItem(config);        return widget;    },    onDesign : function (config, designer, tag, catalog, isResize) {    },    onCreate : function (tag, param) {        var        jQTag,        menuBar,        lastClass,        borderTop,        firstClass,        menuItemsI,        borderLeft,        menuBarSize,        menuItemsSize;        firstClass  = 'waf-menuItem-first';        lastClass   = 'waf-menuItem-last';        menuBar     = tag.getParent();        jQTag       = $(tag);        defaultText = menuBar.getParent().getType() == 'tabView' ? '[Tab {1}]' : '[Item {1}]';        /**         * Get the formatted default text of the menu item         * @function getDefaultText         * @param {number} index menu item index         * @return {string}         */        tag.getDefaultText = function menuitem_get_default_text (index) {            return defaultText.replace('{1}', index);        }        /*         * To prevent default resize actions         */        tag._preventResizeActions = true;        /**         * Get the content widget (richtext or icon)         * @function getContentWidget         * @return {object} widget         */        tag.getContentWidget   = function menuitem_get_content_widget () {            var            type,            child,            result,            children,            childrenL;            children    = this.getChildren();            childrenL   = children.length;            for (i = 0; i < childrenL; i += 1) {                child   = children[i];                if (child) {                    type    = child.getType();                    if (!child.isDeleted() && (type == 'icon' || type == 'richText')) {                        result = child;                        break;                    }                }            }            return result;        }        /**         * Get the index of the widget into the menubar         * @function getIndex         * @return {number} index         */        tag.getIndex = function menuitem_get_index () {            var            i,            result,            menuItems;            menuItems   = menuBar.getItems(false);            menuItemsL  = menuItems.length;            for (i  = 0; i < menuItemsL; i += 1) {                if (menuItems[i] == this) {                    result = i;                    break;                }            }            return result;        }        /**         * Custom resize function         * @function _resize         * @param {object}         */        tag._resize = function menuitem_resize (params) {            var            dif,            index,            menuBar,            barSizes,            prevItem,            newWidth,            newHeight,            orientation,            contentWidget;            newHeight       = params.height;            newWidth        = params.width;            oldHeight       = params.oldHeight;            oldWidth        = params.oldWidth;            menuBar         = this.getParent();            barSizes        = menuBar.getSize();            contentWidget   = this.getContentWidget();            orientation     = menuBar.getOrientation();            index           = this.getIndex();            if (!D.env._prevenItemstResize) {                Designer.beginUserAction('070');                D.env._prevenItemstResize = true;                var action = new Designer.action.ResizeMenuItem({                        val         : 1,                        oldVal      : 0,                        tagId       : this.id,                        data        : {                            moveX       : D.env._MoveX,                            moveY       : D.env._MoveY,                            barSizes    : barSizes,                            newSizes    : {                                width   : newWidth,                                height  : newHeight                            },                            oldSizes    : {                                width   : oldWidth,                                height  : oldHeight                            }                        }                });                Designer.getHistory().add(action);                prevItem = menuBar.getItems()[index-1];                /*                 * Change menubar min size                 */                switch (menuBar.getOrientation()) {                    case 'horizontal':                        if (newWidth) {                            dif                 = oldWidth - newWidth;                            menuBar.minWidth   -= dif;                            if (D.env._MoveX) {                                D.env._MoveX    = null;                                if (index == 0) {                                    menuBar.setX(menuBar.getX() + dif);                                    menuBar.setWidth(menuBar.getWidth() - dif);                                } else if (prevItem) {                                    prevItem.setWidth(prevItem.getWidth() + dif);                                }                            }                        }                        break;                    case 'vertical':                        if (newHeight) {                            dif                 = oldHeight - newHeight;                            menuBar.minHeight  -= dif;                            if (D.env._MoveY) {                                D.env._MoveY    = null;                                if (index == 0) {                                    menuBar.setY(menuBar.getY() + dif);                                    menuBar.setHeight(menuBar.getHeight() - dif);                                } else if (prevItem) {                                    prevItem.setHeight(prevItem.getHeight() + dif);                                }                            }                        }                        break;                }                /*                 * Resize menubar if necessary                 */                menuBar.checkSize();                D.env._prevenItemstResize = false;            }            /*             * Reset text widget size line height             */            if (contentWidget && contentWidget.getType() == 'richText') {                if (newHeight) {                    contentWidget.setHeight(newHeight);                }                if (newWidth) {                    contentWidget.setWidth(newWidth);                }            }        }        /**         * Private clean content widget function         * @function _cleanContentWidget         * @param {object} content widget [optional]         */        tag._cleanContentWidget = function (widget) {            var            that,            size,            subMenu,            orientation,            contentWidget;            that            = this;            contentWidget   = widget || this.getContentWidget();            subMenu         = this.getSubMenu();            if (contentWidget) {                /*                 * On file drop, automatically trigger menuitem drop event                 */                if (contentWidget.getType() == 'richText') {                    /*                     * Remove overlay                     */                    if (contentWidget.hasOverlay()) {                        contentWidget.removeOverlay();                    }                    contentWidget.getHtmlObject().addClass('waf-menuItem-text');                    /*                     * Remove resize handle on content widget                     */                    contentWidget.resizeHandles = 'none';                    $(contentWidget).bind('onWidgetFocus', function (e, type) {                        /*                         * Auto focus on content widget's parent                         */                        if (this.getParent().getType() != 'document') {                            this.getParent().setCurrent();                        }                    });                    $(contentWidget).bind('onFileDrop', {tag : this}, function(e, data) {                        /*                         * Trigger menu item file drop                         */                        if (this.getType() != 'icon') {                            $(e.data.tag).trigger('onFileDrop', data);                        }                    });                } else {                    /*                     * On icon destroy, set label as text                     */                    $(contentWidget)                        .bind('onWidgetDestroy', {tag : this}, function(e) {                            var                            text,                            label;                            label = this.getLabel();                            text    = label ? label.getAttribute('data-text').getValue() : that.getDefaultText('');                            e.data.tag.setText(text);                        })                        .bind('onCreateLabel', {tag : this}, function(e, label) {                            var                            tag;                            tag = e.data.tag;                            tag.resetIconPosition();                            $(label)                                /*                                 * Refresh icon position on label position change                                 */                                .bind('onPositionChange', { tag : tag }, function (e) {                                    e.data.tag.resetIconPosition();                                })                                /*                                 * Refresh icon position on label destroy                                 */                                .bind('onWidgetDestroy', { tag : tag }, function (e) {                                    e.data.tag.resetIconPosition();                                });                        });                }                /*                 * Force subMenu position to fix bug                 */                if (subMenu) {                    orientation = this.getParent().getOrientation();                    size = this.getSize();                    if (orientation == 'horizontal') {                        subMenu.getHtmlObject().css({                            'top'   : size.height + 'px',                            'left'  : '0px'                        });                    } else {                        subMenu.getHtmlObject().css({                            'left'  : size.width + 'px',                            'top'   : '0px'                        });                    }                    /*                     * Remove overlay on submenu                     */                    if (subMenu.hasOverlay()) {                        subMenu.removeOverlay();                    }                }            }        }        /**         * Get the text value         * @function getText         * @return {string} value         */        tag.getText = function menuItem_get_text () {            var            value,            contentLabel,            contentWidget;            contentWidget   = this.getContentWidget();            if (contentWidget) {                if (contentWidget.getType() == 'richText') {                    value = contentWidget.getAttribute('data-text').getValue();                } else {                    contentLabel = contentWidget.getLabel();                    if (contentLabel){                        value = contentLabel.getAttribute('data-text').getValue();                    }                }            }            return value;        }        /**         * Set the text value         * @function setText         * @param {string} value         */        tag.setText = function menuItem_set_text (value) {            var            size,            width,            height,            contentConfig,            contentWidget;            size            = this.getSize();            width           = size.width;            height          = size.height;            contentWidget   = this.getContentWidget();            if (contentWidget && contentWidget.getType() != 'container') {                if (contentWidget.getType() == 'richText') {                    contentWidget.getAttribute('data-text').setValue(value);                    contentWidget.onDesign(true);                    contentWidget.domUpdate();                }            } else {                contentConfig = {                    type        : 'richText',                    parent      : this,                    silentMode  : true,                    hasOverlay  : false,                    width       : width,                    height      : height,                    attr        : {                        'data-text'         : value,                        'data-autoWidth'    : 'false'                    }                }                contentWidget = D.createTag(contentConfig);                $(contentWidget).bind('onReady', {menuItem : this}, function (e, data) {                    var                    menuItem,                    firstParent;                    menuItem    = e.data.menuItem;                    firstParent = menuItem.getParent().getParent();                    if (data.from == 'redo') {                        /*                         * Force table cell display on redo                         */                        this.getHtmlObject().css('display', 'table-cell');                        /*                         * Force focus on menu item if submenu                         */                        if (firstParent.getType() == 'menuItem') {                            firstParent.setCurrent();                        }                    }                })                contentWidget.link(this);                this.link(contentWidget);                this._cleanContentWidget(contentWidget);            }            return contentWidget;        }        /**         * Set the icon of the widget         * @function setIcon         * @param {string} path [optional]         * @param {string} label [optional]         * @param {string} labelPos [optional]         */        tag.setIcon = function menuItem_set_icon (path, label, labelPos) {            var            size,            width,            height,            labelWidget,            contentConfig,            contentWidget;            size            = this.getSize();            width           = size.width;            height          = size.height;            contentWidget   = this.getContentWidget();            orientation     = this.getParent().getOrientation();            if (contentWidget) {                /*                 * If content widget already exists => destroy it                 * and create an icon widget                 */                if (contentWidget.getType() == 'richText') {                    if (typeof label == 'undefined') {                        label = this.getText();                    }                    contentWidget.remove();                    tag.setIcon(path, label);                } else if (path) {                    contentWidget.getAttribute('data-image-state1').setValue(path);                    contentWidget.domUpdate();                    contentWidget.onDesign(true);                }            } else {                contentConfig = {                    type        : 'icon',                    parent      : this,                    silentMode  : true,                    attr        : {                        'data-label'            : label,                        'data-label-position'   : labelPos ? labelPos : orientation == 'horizontal' ? 'bottom' : 'right'                    }                }                if (path) {                    contentConfig.attr['data-image-state1'] = path;                }                contentWidget = D.createTag(contentConfig);                labelWidget = contentWidget.getLabel();                $(labelWidget)                    /*                     * Refresh icon position on label position change                     */                    .bind('onPositionChange', { tag : this }, function (e) {                        e.data.tag.resetIconPosition();                    })                    /*                     * Refresh icon position on label destroy                     */                    .bind('onWidgetDestroy', { tag : this }, function (e) {                        e.data.tag.resetIconPosition();                    });                this.resetIconPosition(contentWidget, width, height, orientation);                contentWidget.link(this);                this.link(contentWidget);                this._cleanContentWidget(contentWidget);            }            contentWidget.setAsSubWidget(true);            contentWidget.lock();            this.unlock();            contentWidget.getHtmlObject().bind('click', {contentWidget : contentWidget}, function (e) {                e.data.contentWidget.unlock();            });            return contentWidget;        }        /**         * Reset the icon widget position         * @function resetIconPosition         * @param {object} icon [optional]         * @param {number} width [optional]         * @param {number} height [optional]         * @param {string} orientation [optional]         */        tag.resetIconPosition = function menuitem_reset_icon_position (icon, width, height, orientation) {            var            top,            left,            width,            label,            height,            iconSize;            icon        = icon          || this.getContentWidget();            orientation = orientation   || this.getParent().getOrientation();            if (!width && !height) {                size    = this.getSize();                height  = size.height;                width   = size.width;            }            if (icon && icon.getType() == 'icon') {                iconSize    = icon.getSize();                label       = icon.getLabel();                labelPos    = icon.getAttribute('data-label-position').getValue();                /*                 * Position icon widget                 */                top     = (height - iconSize.height)/2;                left    = (width - iconSize.width)/2;                if (label && !label.isDeleted()) {                    switch (labelPos) {                        case 'top':                            top += (label.getHeight() / 2);                            break;                        case 'bottom':                            top -= (label.getHeight() / 2);                            break;                        case 'left':                            left += (label.getWidth() / 2);                            break;                        case 'right':                            left -= (label.getWidth() / 2);                            break;                    }                }                icon.setXY(left, top, true);                /*                 * Refresh label position                 */                if (label) {                    label._refreshPosition();                }            }        }        /**         * Add a menuitem to the submenu of the menu item         * @function addSubMenu         */        tag.addMenuItem = function menuItem_add_menuitem() {            var            newItem,            subMenu,            menuBar,            subConfig,            itemSizes,            orientation;            menuBar     = this.getParent();            orientation = menuBar.getOrientation() == 'horizontal' ? 'vertical' : 'horizontal';            /*             * Get submenu if exists             */            subMenu     = this.getSubMenu();            itemSizes   = this.getSize();            /*             * Create submenu if doesn't exists             */            if (!subMenu) {                subConfig   = {                    type        : 'menuBar',                    parent      : this,                    silentMode  : true,                    width       : itemSizes.width,                    height      : 10,                    hasOverlay  : false,                    data        : {                        'noItems'   : true                    },                    attr        : {                        'data-display' : 'vertical'                    }                };                switch (orientation) {                    case 'horizontal':                        subConfig.left      = itemSizes.width;                        break;                    case 'vertical':                        subConfig.top       = itemSizes.height;                        break;                }                subMenu     = D.createTag(subConfig);                subMenu.getHtmlObject().show();            }            newItem = subMenu.addMenuItem({                focusOnMenu : false            });            return newItem;        };        /**         * Get the last index of the menubar         * @return {number} last index         */        tag.getLastIndex = function menuitem_get_last_index () {            var            item,            parent,            itemIndex,            menuBarItems;            parent          = this.getParent();            menuBarItems    = parent.getItems();            item            = menuBarItems[menuBarItems.length-2];            if (item &&item.getText) {                itemIndex = item.getText().match(/[0-9]+/);            }            if (itemIndex) {                itemIndex = parseInt(itemIndex[0], 10);            } else {                itemIndex = menuBar._lastIndex || 0;            }            itemIndex += 1;            return itemIndex;        };        /**         * Get the submenu of the menu item if exists         * @function getSubMenu         * @return {object}         */        tag.getSubMenu = function menuitem_get_submenu () {            var            i,            child,            result,            children,            childrenL;            children    = this.getChildren();            childrenL   = children.length;            for (i = 0; i < childrenL; i += 1) {                child = children[i];                if (child && child.getType() == 'menuBar') {                    result = child;                    break;                }            }            return result;        }        if (!param._isLoaded) {            menuItemsI  = menuBar.checkSize();            tag.setText( tag.getDefaultText(tag.getLastIndex()) );        }        /*         * On resize event         */        jQTag.bind('onResize', function (e, sizeParams){            var            menuBar,            subMenu;            subMenu     = this.getSubMenu();            menuBar     = this.getParent();            this._resize(sizeParams);            /*             * Resize submenu             */            if (subMenu) {                switch (menuBar.getOrientation()) {                    case 'horizontal':                        subMenu.setY(this.getHeight());                        break;                    case 'vertical':                        subMenu.setX(this.getWidth());                        break;                }            }            /*             * Resize content widget if it is an icon             */            this.resetIconPosition();        });        /*         * On Widget Destroy event         */        jQTag.bind('onWidgetDestroy', {menuBar : menuBar}, function (e){            var            info,            borders,            menuBar,            prevItem,            nextItem,            menuItems,            menuItemsL;            menuBar     = e.data.menuBar;            menuItems   = menuBar.getItems();            menuItemsL  = menuItems.length;            prevItem    = menuItems[menuItemsL - 1];            /*             * Change menubar min size             */            switch (menuBar.getOrientation()) {                case 'horizontal':                    menuBar.minWidth -= this._tmpSizeWidth;                    break;                case 'vertical':                    menuBar.minHeight -= this._tmpSizeHeight;                    break;            }            /*             * If latest menu item => destroy menubar             */            if (menuItemsL == 0) {                menuBar.remove();            }            menuBar._setClasses();            /*             * Resize menubar if it's a submenu             */            if (menuBar._isSubMenu) {                info    = menuBar.itemsInfo();                borders = menuBar.getBorders();                if (info.orientation == 'horizontal') {                    menuBar.setWidth(info.size + borders.LR);                } else {                    menuBar.setHeight(info.size + borders.TB);                }                if (D.getCurrent() == this) {                }            }        });        /*         * Icon label custom on file drop event         * Trigger icon onFileDrop event         */        jQTag.bind('onFileDrop', function(e, data) {            var            iconWidget,            contentWidget;            contentWidget   = this.getContentWidget();            if (contentWidget.getType() == 'icon') {                iconWidget = contentWidget;            } else {                iconWidget = this.setIcon();            }            data.keepSize = true;            $(iconWidget).trigger('onFileDrop', data);        });        /*         * On focus event         * Remove absolute position and set menu item as sub widget         */        jQTag.bind('onWidgetFocus', function (e){            var            subMenu;            subMenu = this.getSubMenu();            if (subMenu) {                subMenu.getHtmlObject().show();            }        });        /*         * On ready event         * Remove absolute position and set menu item as sub widget         */        jQTag.bind('onReady', {isLoaded : param._isLoaded}, function (e, data){            var            i,            j,            that,            child,            pClass,            menuBar,            subChild,            children,            childrenL,            iconValue,            textValue,            subChildren,            labelWidget,            orientation,            pClassSplit,            subChildrenL,            contentWidget;            that        = this;            menuBar     = this.getParent();            orientation = menuBar.getOrientation ? menuBar.getOrientation() : '';            data        = data || {};            if (e.data.isLoaded) {                menuBar._lastIndex = menuBar._lastIndex || 0;                menuBar._lastIndex += 1;            }            /*             * @DEPRECATED : to keep retrocompatibility             */            if (data.from == 'load' && data.children) {                children    = data.children;                childrenL   = children.length;                for (i = 0; i < childrenL; i += 1) {                    child = children[i];                    if (child.tagName === 'p') {                        // Get the icon position class                        pClass              = child.getAttribute('class');                        pClassSplit         = pClass.split('waf-menuItem-icon-');                        pClass              = pClassSplit[1] ? pClassSplit[1] : ''                        subChildren         = children[i].getChildNodes();                        subChildrenL        = subChildren.length;                        for (j= 0; j < subChildrenL; j += 1) {                            subChild = subChildren[j];                            if (subChild.tagName === "span") {                                textValue = subChild._json.childNodes[0].nodeValue;                            } else if (subChild.tagName === "img"){                                iconValue = subChild.getAttribute('src');                            }                        }                        if (iconValue) {                            if (pClass == 'right')  pClass = 'left';                            else if (pClass == 'left')   pClass = 'right';                            else if (pClass == 'top')    pClass = 'bottom';                            else if (pClass == 'bottom') pClass = 'top';                            this.setIcon(iconValue, textValue, pClass);                        } else {                            this.setText(textValue);                        }                    }                }            }            if (e.data.isLoaded) {                this._cleanContentWidget();            }            this.getHtmlObject()                /*                 * To fix focus bugs                 */                .bind('mouseover', function function_name (e) {                    var                    htmlObject;                    htmlObject = $(this);                    Designer.env.subElement.hover = {                        elt : this,                        tag : that                    }                    if (e.altKey) {                        D.ui.focus.overFeedback.show(htmlObject.parent());                    } else {                        D.ui.focus.overFeedback.show(htmlObject);                    }                    return false;                })                .bind('click', function function_name (e) {                    if (e.altKey) {                        that.getParent().setCurrent();                        D.tag.refreshPanels();                        return false;                    }                })                .css('position' , 'relative');            /*             * Set element as subWidget             */            this.setAsSubWidget(true);            /*             * Set resize handle to left and right only             */            switch (orientation) {                case 'horizontal':                    this.resizeHandles = 'e, w';                    break;                case 'vertical':                    this.resizeHandles = 'n, s';                    break;            }            contentWidget   = this.getContentWidget();            if (contentWidget) {                labelWidget     = contentWidget.getLabel();                if (labelWidget) {                    $(labelWidget)                        /*                         * Refresh icon position on label position change                         */                        .bind('onPositionChange', { tag : this }, function (e) {                            e.data.tag.resetIconPosition();                        })                        /*                         * Refresh icon position on label destroy                         */                        .bind('onWidgetDestroy', { tag : this }, function (e) {                            e.data.tag.resetIconPosition();                        });                }                if (contentWidget.getType() == 'icon') {                    contentWidget.setAsSubWidget(true);                    contentWidget.lock();                    this.unlock();                    contentWidget.getHtmlObject().bind('click', {contentWidget : contentWidget}, function (e) {                        e.data.contentWidget.unlock();                    });                }            }            if (data.from == 'redo' && menuBar._setClasses) {                menuBar._setClasses();            }        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/login/widget-login.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Login',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var loginManager = this;        var htmlObject = $(this.containerNode);		loginManager.labels = {};		loginManager.labels.userLabel = config['data-user-label'] || "";		loginManager.labels.passwordLabel = config['data-password-label'] || "";		loginManager.labels.loginButton = config['data-login-button'] || "";		loginManager.labels.loginTitle = config['data-login-title'] || "";		loginManager.labels.userDisplay = config['data-user-display'] || "";		loginManager.labels.noUserDisplay = config['data-no-user-display'] || "";		loginManager.labels.loginAction = config['data-login-action'] || "";		loginManager.labels.logoutAction = config['data-logout-action'] || "";		loginManager.inDesign = config.inDesign || false;		loginManager.dialogWidget = null;		loginManager.dialog = null;		if (loginManager.inDesign)			loginManager.refresh();		else			setTimeout( function() { loginManager.refresh() }, 100 );    },{        showLoginDialog: function login_show_login_dialog() {			var loginManager = this;			var htmlObject  = $(this.containerNode);			var html = "";			function loginButton(event)			{				var userNameRef = $(".waf-login-dialog-user input", loginManager.dialog);				var userName = userNameRef.val();				var passwordRef = $(".waf-login-dialog-password input", loginManager.dialog);				var password = passwordRef.val();				passwordRef.val("");				loginManager.dialog.dialog("close");				loginManager.login(userName, password);			}			if (loginManager.dialog == null)			{				var dataTheme = "";				var existingClasses = htmlObject.prop('class')+" waf-login-dialog";				 existingClasses.split(" ").forEach(function(className) {			        if (className != "inherit" && className.substr(0,4) != "waf-") {			                dataTheme += className+" ";			        }			    });				html += '<div class="waf-widget-body waf-login-body '+dataTheme+'" title="'+loginManager.labels.loginTitle+'">';				html += '<form class="waf-login-form" action="#" methos="POST">';				html += '<div class="waf-login-div waf-login-dialog-user">';				html += '<label class="waf-widget waf-label waf-login-label '+dataTheme+'">' + loginManager.labels.userLabel + '</label>';				html += '<div><input id="name_login_'+loginManager.divID+'" type="text" data-type="textField" data-lib="WAF" class="waf-widget waf-textField '+dataTheme+'" size="20"/></div>';				html += '</div>';				html += '<div class="waf-login-div waf-login-dialog-password">';				html += '<label class="waf-widget waf-label waf-login-label '+dataTheme+'">' + loginManager.labels.passwordLabel + '</label>';				html += '<div>';				html += '<input id="password_login_'+loginManager.divID+'" type="password" data-type="textField" data-lib="WAF" class="waf-widget waf-textField '+dataTheme+'" size="20"/>';				html += '<button id="button_login_'+loginManager.divID+'" class="waf-login-button waf-widget waf-button '+dataTheme+'" data-lib="WAF" data-type="button" data-text="'+loginManager.labels.loginButton+'">';				html += '<span>' + loginManager.labels.loginButton + '</span>';				html += '</button>';				html += '</div>';				html += '</form>';				html += '</div>';				html += '</div>';				var $html = $(html);				$html.addClass(existingClasses);				$html.removeClass("waf-login");				$html.dialog({modal: true, resizable: false});				var dialogWidget = $html.dialog("widget");				dialogWidget					.addClass(dataTheme+" waf-widget waf-login-dialog ")					.find('.ui-widget-header').addClass("waf-widget-header").removeClass('ui-corner-all');				dialogWidget.removeClass("waf-login");				var tabDom      = $('[data-type]', $html);        		for (var i = 0, nbComponent = tabDom.length; i < nbComponent; i++)  {            		var domobj  = tabDom[i];		            WAF.tags.createComponent(domobj, false);        		}				loginManager.dialog = $html;				loginManager.dialogWidget = dialogWidget;				$(".waf-login-button", $html).bind("click", function (event) {					event.preventDefault();					loginButton(event);				});				$(".waf-login-form", $html).bind("submit", function (event) {					event.preventDefault();					loginButton(event);				});			}			else			{				loginManager.dialog.dialog("open");			}		},                /*                 * DEPRECATED                 */                showLogin : function(){                    this.showLoginDialog();                },		login: function login_login(userName, password)		{			var loginManager = this;			WAF.directory.login({onSuccess:function(event) {				loginManager.refresh();				if (event.result === true)				{					if (loginManager.onlogin != null)					{						loginManager.onlogin();					}				}				else					alert("Wrong user or password");			}}, userName, password)		},		logout: function login_logout() {			var loginManager = this;			WAF.directory.logout({onSuccess:function(event) {				loginManager.refresh();				if (loginManager.onlogout != null)				{					loginManager.onlogout();				}			}});		},		refresh : function login_refresh () {        	var  htmlObject  = $(this.containerNode);			var loginManager = this;			function displayLoggedUser(user)			{				var html = "";				if (user == null)				{					html += '<div class="waf-login-user">' + loginManager.labels.noUserDisplay + '</div>'					html += '<div class="waf-login-login"> <a>' + loginManager.labels.loginAction + '</a> </div>';				}				else				{					var text = user.fullName;					if (text == null || text === "")						text = user.userName;					html += '<div class="waf-login-user">' + loginManager.labels.userDisplay + text + '</div>'					html += '<div class="waf-login-logout"><a>' + loginManager.labels.logoutAction + '</a> </div>';				}				htmlObject.html(html);			}			if (loginManager.inDesign)			{				displayLoggedUser({userName:'"userName"', fullName:'"userName"'});			}			else			{	       		WAF.directory.currentUser({onSuccess:function(event)				{					var user = event.result;					displayLoggedUser(user);					var aaa = $('a', htmlObject);					function installClickHandler()					{						aaa = $('a', htmlObject);						if (user == null)						{							aaa.click(function(event) {								loginManager.showLoginDialog();								return false;							});						}						else						{							aaa.click(function(event) {								loginManager.logout();								return false;							});						}					}					if (aaa.length == 0)					{						var xdebug = 1;						setTimeout(installClickHandler, 10);					}					else					{						installClickHandler();					}				}});			}        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/login/widget-login-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'login',    lib        : 'WAF',    description: 'Login Dialog',    category   : 'Automatic Controls',    img        : '/walib/WAF/widget/login/icons/widget-login.png',    attributes : [    {        name        : 'data-user-label',        description : 'User label',		defaultValue: 'User: ',		category   	: 'Login Dialog'    },	{        name        : 'data-password-label',        description : 'Password label',		defaultValue: 'Password: ',		category   	: 'Login Dialog'    }, 	{        name        : 'data-login-button',        description : 'Login button',		defaultValue: 'Login',		category   	: 'Login Dialog'    }, 	{        name        : 'data-login-title',        description : 'Login dialog title',		defaultValue: 'Login Dialog',		category   	: 'Login Dialog'    },    {        name        : 'data-user-display',        description : 'Current user display',		defaultValue: 'Signed in as ',		category   	: 'Login Status'    },    {        name        : 'data-no-user-display',        description : 'Not logged in display',		defaultValue: '',		category   	: 'Login Status'    }, 	{        name        : 'data-login-action',        description : 'Login text',		defaultValue: 'Login',		category   	: 'Login Status'    },    {        name        : 'data-logout-action',        description : 'Logout text',		defaultValue: 'Logout',		category   	: 'Login Status'    }],    events: [    {        name       : 'login',        description: 'On Login',        category   : 'Login Events'    },    {        name       : 'logout',        description: 'On Logout',        category   : 'Login Events'    }],    style: [    {        name        : 'width',        defaultValue: '185px'    },    {        name        : 'height',        defaultValue: '80px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            shadow      : true        }    },    onInit: function (config) {        var login = new WAF.widget.Login(config);        return login;    },    onDesign: function (config, designer, tag, catalog, isResize) {		if (!isResize)		{			config.inDesign = true;			var login = new WAF.widget.Login(config); 		}    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/chart/widget-chart-conf.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. */WAF.addWidget({    /**     *  Widget Descriptor     *     */    /* PROPERTIES */    // {String} internal name of the widget    type        : 'chart',    test        : "this is a test",    // {String} library used ('waf', 'jquery', 'extjs', 'yui') (optional)    lib         : 'WAF',    // {String} display name of the widget in the GUI Designer    description : 'Chart',    // {String} category in which the widget is displayed in the GUI Designer    category    : 'Misc. Controls',//'Reporting',    // {Array} css file needed by widget (optional)    css         : [],    // {Array} script files needed by widget (optional)    include     : [],    // {String} type of the html tag ('div' by default)    tag         : 'div',    // {Array} attributes of the widget. By default, we have 3 attributes: 'data-type', 'data-lib', and 'id', so it is unnecessary to add them    //    // @property {String} name, name of the attribute (mandatory)    // @property {String} description, description of the attribute (optional)    // @property {String} defaultValue, default value of the attribute (optional)    // @property {'string'|'radio'|'checkbox'|'textarea'|'dropdown'|'integer'} type, type of the field to show in the GUI Designer (optional)    // @property {Array} options, list of values to choose for the field shown in the GUI Designer (optional)    attributes  : [    {        name        : 'data-binding',        description : 'Source',        type        : 'string'    }, {        name        : 'data-axisLabel',        visibility  : 'hidden'    }, {        name        : 'data-chartType',        defaultValue: 'Pie Chart',        visibility  : 'hidden'    }, {        name        : 'data-chartLineType',        defaultValue: 'basic',        visibility  : 'hidden'    }, {        name        : 'data-tooltipDisplay',        visibility  : 'hidden',        defaultValue: 'true'    }, {        name        : 'data-tooltipType',        visibility  : 'hidden',        defaultValue: 'blob'    }, {        name        : 'data-tooltipAngle',        visibility  : 'hidden',        defaultValue: '90'    },{        name        : 'data-limitlength',        description : 'Limit length',        type        : 'integer',        defaultValue: '100'    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox',        defaultValue: 'false'    },  {        name        : 'data-linkedWidgets',        visibility  : 'hidden'    }, {        name        : 'data-oldSource',        visibility  : 'hidden',        type        : 'string',        defaultValue: ''    },  {        name        : 'data-ymin',        visibility  : 'hidden'    },  {        name        : 'data-ymax',        visibility  : 'hidden'    },  {        name        : 'data-yinterval',        visibility  : 'hidden',        defaultValue: 'Step Count'    },  {        name        : 'data-xstepvalue',        visibility  : 'hidden',        defaultValue: ''    },  {        name        : 'data-ystepvalue',        visibility  : 'hidden',        defaultValue: ''    },  {        name        : 'data-labelAngle',        visibility  : 'hidden',        defaultValue: '90'    },  {        name        : 'data-labelAlign',        visibility  : 'hidden',        defaultValue: 'middle'    },    {        name            : 'data-column',        description     : 'Data Series',        type            : 'grid',        defaultValue    : '[]',        reloadOnChange  : true,        displayEmpty    : false, // if false grid is hidden if empty        newRowEmpty     : false,        editable        : false,        beforeReady     : function(){            var            tag,            chartType;            tag = this.data.tag;            tag.axisColumns = this;            chartType = tag.getAttribute('data-chartType').getValue();            switch(chartType) {                case 'Pie Chart':                    this.editable               = false;                    this.sortable               = false;                    this.buttons.visible        = false;                    if(this._itemsMdl.length > 2){                        this._itemsMdl.pop();                        this._header.pop();                    }                    //                    this._itemsMdl[0].disabled  = true;                    //                    this._itemsMdl[1].disabled  = true;                    break;                default:                    this.editable           = true;                    this.sortable           = true;                    this.buttons.visible    = true;                    break;            }        },        sortable        : false,        columns         : [{            title       : 'label',            name        : 'title',            type        : 'textfield'        },{            title       : 'attribute',            name        : 'sourceAttID',            type        : 'textfield',            typeValue   : 'dataSource',            onchange    : function(){                var                htmlObj = this.htmlObject,                parent  = htmlObj.parent(),                prevNode= parent.prev(),                title   = prevNode.find('input');                title.val(this.getValue());            }        },{            title       : 'color',            name        : 'color',            type        : 'color',            defaultValue: 'rgba(255,0,0,1)'        }],        toolbox         : [{            name    : 'format',            type    : 'textfield'        }],        beforeRowAdd     : function(){            var            tag     = this.data.tag,            count   = this.getRows().length;            this._itemsMdl[2].value = tag._colors[count % tag._colors.length];        },        onsave          : function(data) {            var            tag,            attrib,            columns,            value;            try {                tag     = data.tag;                columns = tag.getColumns();                /*                     * Clear columns                     */                columns.clear();                /*                     * Get new rows                     */                $.each(data.value.rows, function() {                    var                    row,                    name,                    value,                    check,                    column;                    row     = this;                    check   = true;                    column  = new WAF.tags.descriptor.Column();                    $.each(this, function(i) {                        name    = this.component.name;                        value   = this.value;                        if (name == 'sourceAttID') {                            column.getAttribute('colID').setValue(value.replace(/\./g, '_'));                            /*                                 * Check if the new attribute is valid                                 */                            attrib = Designer.env.ds.catalog.getByName(tag.getSource()).getAttributeByName(value);                            if (attrib && attrib.type && attrib.type.match(new RegExp('(^number$)|(^long$)|(^long64$)|(^float$)|(^duration$)'))) {                            // DO NOTHING                            } else {                                check = false;                                row[1].component.getHtmlObject().addClass('studio-form-invalid');                            }                        }                        else if(name == "color" && !column.getAttribute(name)){                            column._attributes.add(new WAF.tags.descriptor.AttributeColumn({                                name    : "color"                            }));                        }                        column.getAttribute(name).setValue(value);                    });                    //                    if (check) {                    columns.add(column);                //                    }                });            } catch(e) {                console.log(e);            }        }    }    ],    columns: {        attributes : [        {            name       : 'format'        }        ],        events: []    },    // {Array} default height and width of the container for the widget in the GUI Designer    //    // @property {String} name, name of the attribute    // @property {String} defaultValue, default value of the attribute    style: [    {        name        : 'width',        defaultValue: '480px'    },    {        name        : 'height',        defaultValue: '300px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Data Point Events'    },{        name       : 'dblclick',        description: 'On Double Click',        category   : 'Data Point Events'    },{        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Data Point Events'    },{        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Data Point Events'    },{        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Data Point Events'    },{        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Data Point Events'    },{        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Data Point Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }    ],    // {JSON} panel properties widget    //    // @property {Object} enable style settings in the Styles panel in the Properties area in the GUI Designer    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            shadow      : true,            label       : false,            disabled    : []        }    },    // (optional area)    //    // {Array} list of sub elements for the widget    //    // @property {String} label of the sub element    // @property {String} css selector of the sub element    structure: [],    /* METHODS */    /*     * function to call when the widget is loaded by WAF during runtime     *     * @param {Object} config contains all the attributes of the widget     * @result {WAF.widget.Rifox} the widget     */    onInit: function (config) {        var widget = new WAF.widget.Chart(config);        if (config['data-draggable'] === "true") {            $('#' + config.id).draggable({});            $('#' + config.id).css('cursor', 'pointer');        }        return widget;    },    /**     * function to call when the widget is displayed in the GUI Designer     *     * @param {Object} config contains all the attributes for the widget     * @param {Designer.api} set of functions used to be managed by the GUI Designer     * @param {Designer.tag.Tag} container of the widget in the GUI Designer     * @param {Object} catalog of dataClasses defined for the widget     * @param {Boolean} isResize is a resize call for the widget (not currently available for custom widgets)     */    onDesign: function (config, designer, tag, catalog, isResize) {        var columns = tag.getColumns().toArray();        var r;        var values  = function(){            var res = [];            for(var i = 1 ; i <= columns.length ; i++){                res.push([10*i,30*i,100*i,20*i]);            }            return res;        }.call(),        labels          = function(){            var result = [];            for(var item in values[0]){                result.push((tag.getSource() ? tag.getSource() + ' Entity ' : 'Fake Data ') + item)            }            return result;        }.call(),        colors = [];        if(!tag._subWidgets){            return;        }        /*         * Initialization of the graph         */        r = tag._graph;        r.setSize(tag.getWidth(),tag.getHeight());        r.clear();        var subWidgets  = tag._subWidgets();        /*         * Designing the legendary         */        if(subWidgets.title && tag.getAttribute('data-oldSource').getValue() !== tag.getSource()){            subWidgets.title.getAttribute('data-text').setValue(tag.getSource() + " Chart");            subWidgets.title.refresh();            tag.getAttribute('data-oldSource').setValue(tag.getSource());        }        if(subWidgets.legendary){            var legendary = subWidgets.legendary;            if (legendary) {                $('#' + legendary.getId()).empty();            }        }        if(labels.length == 0 || values.length == 0){            r.text(r.width/2,r.height/2,'Drop a datasource here').attr({                'font-size':20            });            return;        }        /*         * Drawing The legendary for Bar and Line Chart         */        tag.createLengendary = function(){            if(legendary){                var legendaryC = $('#' + legendary.getId());                legendaryC.empty();                var legTable = $('<table></table>').appendTo('#' + legendaryC.prop('id'));                for(var i = 0 ; i < values.length ; i++){                    var htmlObj = $('<TR>' +                        '<TD style="padding:1px">' +                        '<DIV id = "' + legendaryC.prop('id') + '-legendary-item-' + i + '"></DIV></TD></TR>');                    htmlObj.appendTo(legTable);                    $('<TD style="padding-left:3px">' + tag.getColumns().toArray()[i].title  + '</TD>').appendTo(htmlObj);                    Raphael(legendaryC.prop('id') + '-legendary-item-' + i , 20 , 20).rect(0,0,20,20).attr({                        fill:colors[i]                    });                }            }        }        switch(tag.getAttribute('data-chartType').getValue()){            case 'Line Chart':            case 'Bar Chart' :                for(i = 0 ; column = columns[i] ; i++){                    colors.push(column.color);                }                break;            case 'Pie Chart':                colors = ["hsb(0.34,0.69,0.65)","hsb(0.19,0.82,0.81)","hsb(0.15,1,1)","hsb(0.10,0.91,0.97)","hsb(0.06,0.85,0.92)","hsb(0.02,0.83,0.90)","hsb(0.98,0.85,0.79)","hsb(0.82,0.71,0.51)","hsb(0.76,0.68,0.51)","hsb(0.69,0.65,0.52)","hsb(0.57,1,0.65)","hsb(0.46,1,0.61)"];                break;        }        tag.chart = null;        /*         * Drawing the graph         */        switch(tag.getAttribute('data-chartType').getValue()){            /*             * Drawing the pie chart             */            case 'Pie Chart' :                var radius  = Math.min(tag.getWidth(), tag.getHeight())/2 - 50,                opts    = {                    colors      : colors,                    stroke      : null,                    strokewidth : null,                    init        : null,                    href        : null,                    legend      : null,                    legendmark  : null,                    legendothers: null,                    legendpos   : null                };                tag.chart     = r.g.piechart(r.width/2, r.height/2, radius, values[0],opts);                if(tag.getAttribute('data-tooltipDisplay').getValue() == 'true'){                    tag.chart.hover(function () {                        this.tag = r.g[tag.getAttribute('data-tooltipType').getValue()](this.cx + (radius + 2)*Math.cos(this.mangle*Math.PI / 180),this.cy-(radius + 2)*Math.sin(this.mangle*Math.PI / 180), labels[this.sector.value.order] + "\n" + this.sector.value.value, this.mangle).insertBefore(this.cover);                        this.tag[0].attr({                            fill : colors[this.sector.index],                            stroke : "#000"                        });                    }, function () {                        this.tag.animate({                            opacity: 0                        }, 300, function () {                            this.remove();                        });                    });                }                var i = 0;                tag.chart.each(function(){                    this.sector.index = i++;                });                delete i;                if (subWidgets.legendary){                    legendary = subWidgets.legendary;                    var legTable = $('<table></table>').appendTo('#' + legendary.getId());                    for(i = 0 ; i < labels.length ; i++){                        var htmlObj = $('<TR>' +                            '<TD style="padding:1px">' +                            '<DIV id = "' + tag.getId() + '-legendary-item-' + i + '"></DIV></TD></TR>');                        htmlObj.appendTo(legTable);                        $('<TD style="padding-left:3px">' + labels[tag.chart.series[i].value.order] + '</TD>').appendTo(htmlObj);                        var legItem = Raphael(tag.getId() + '-legendary-item-' + i , 20 , 20).rect(0,0,20,20);                        legItem.attr({                            fill:colors[tag.chart.series[i].index]                        });                        delete legItem;                    }                }                break;            case 'Line Chart':                if(columns.length == 0){                    return;                }                labels = [0,1,2,3];                var                offset = 20,                opts    = {                    vgutter     : null,                    shade       : null,                    nostroke    : false,                    axis        : "0 0 1 1",                    axisstep    : null,                    width       : null,                    dash        : null,                    smooth      : false,                    symbol      : "o",                    colors      : colors,                    gutter      : 5                };                // Sorting the data :                for (i = 0; i < labels.length; i++) {                    labels[i] = {                        value: labels[i],                        order: i,                        valueOf: function () {                            return this.value;                        }                    };                    for(var j = 0 ; j<values.length ; j++){                        if(max < values[j][i]){                            max = values[j][i];                        }                        values[j][i] = {                            value: values[j][i],                            order: i,                            valueOf: function () {                                return this.value;                            } ,                            label : labels[i]                        };                    }                }                for(i = 0 ; i<values.length ; i++){                    values[i].sort(function (a, b) {                        return labels[a.order].value - labels[b.order].value;                    });                }                labels.sort(function (a, b) {                    return a.value - b.value;                });                tag.chart = r.g.linechart(offset, offset, r.width - offset - 30 , r.height - offset - 20 , labels , values, opts);                tag.createLengendary();                break;            case 'Bar Chart' :                r.rect(0,0,r.width,r.height).attr({                    'stroke-width' : 2                })                if(columns.length == 0){                    return;                }                opts = {                    type    : tag.getAttribute('data-chartLineType').getValue() == 'basic' ? 'soft' : 'square',                    colors  : colors,                    gutter  : 0,                    vgutter : 0,                    to      : null,                    stacked : tag.getAttribute('data-chartLineType').getValue() != 'basic'                };                var                max = values[0][0],                textMax     = 0,                textSet     = r.set(),                y           = 25,                barvgutter  = opts.vgutter ,                textTemp    = r.text(0,0,max).hide(),                x           = textTemp.getBBox().width + 15,                gutter      = opts.gutter || 10,                barhgutter  = (r.width - x)*gutter/(labels.length*(100+gutter)+gutter),                barwidth    = barhgutter*100/gutter,                posTemp     = x + barhgutter,                labelAngle  = parseInt(tag.getAttribute('data-labelAngle').getValue()),                valuesPer   = [],                arraySum    = new Array(values[0].length);                textTemp.remove();                if(tag.getAttribute('data-chartLineType').getValue() == 'percentage'){                    for (i = 0; i < values.length; i++) {                        for(j = 0 ; j<values[i].length ; j++){                            if(arraySum[j] === undefined){                                arraySum[j] = values[i][j];                            }                            else{                                arraySum[j] += values[i][j];                            }                            if(max < values[i][j]){                                max = values[i][j];                            }                        }                    }                    for (i = 0; i < values.length; i++) {                        valuesPer.push([]);                        for(j = 0 ; j<values[i].length ; j++){                            if(i == 0){                                valuesPer[i].push(100*values[i][j]/arraySum[j]);                            }                            else{                                valuesPer[i].push(100*values[i][j]/arraySum[j] + valuesPer[i-1][j]);                            }                        }                    }                }                else{                    for (i = 0; i < values.length; i++) {                        for(j = 0 ; j<values[i].length ; j++){                            if(max < values[i][j]){                                max = values[i][j];                            }                        }                    }                }                for(i = 0 ; i < labels.length ; i++){                    textTemp = r.text(0,0,labels[i]).hide();                    if(textMax<textTemp.getBBox().width){                        textMax = parseInt(textTemp.getBBox().width*Math.sin(Raphael.rad(labelAngle))) + textTemp.getBBox().height + 4;                    }                }                for (i = 0; i < labels.length; i++) {                    switch(tag.getAttribute('data-labelAlign').getValue()){                        case 'start' :                            point = {                                x           : posTemp,                                y           : r.height - textMax + textTemp.getBBox().height/2 + 2,                                textAnchor  : tag.getAttribute('data-labelAlign').getValue(),                                angle       : labelAngle                            }                            break;                        case 'middle' :                            point = {                                x : posTemp + barwidth/2,                                y : r.height - textMax/2,                                textAnchor  : tag.getAttribute('data-labelAlign').getValue(),                                angle       : -labelAngle                            };                            break;                        case 'end' :                            point = {                                x : posTemp,                                y : r.height - textTemp.getBBox().height/2 -2,                                textAnchor  : 'start',                                angle       : -labelAngle                            }                            break;                        default:                            point = {                                x : posTemp + barwidth/2,                                y : r.height - textMax/2,                                textAnchor  : tag.getAttribute('data-labelAlign').getValue(),                                angle       : -labelAngle                            };                            break;                    }                    textTemp = r.text(point.x, point.y , labels[i]).attr({                        'text-anchor' : point.textAnchor                    }).rotate(point.angle, point.x, point.y);                    textSet.push(textTemp);                    posTemp += barwidth + barhgutter;                }                if(tag.getAttribute('data-chartLineType').getValue() == 'percentage'){                    tag.chart = r.g.barchart(x , y, r.width - x, r.height - textMax - y, valuesPer,opts);                    r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , 0 , 100 , 10 , 1 );                }                else{                    tag.chart = r.g.barchart(x , y, r.width - x, r.height - textMax - y,values ,opts);                    r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , 0 , max , 10 , 1 );                }                r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.width - x - barhgutter, 0 , 1 , labels.length , 2 ).text.remove();                tag.createLengendary();                break;        }        if(tag.getAttribute('data-chartType').getValue() === 'Bar Chart' || tag.getAttribute('data-chartType').getValue() === 'Line Chart'){            try{                var pos = {                    x : tag.getWidth()/2,                    y : tag.getHeight()/2                }                switch(tag.getAttribute('data-chartType').getValue()){                    case 'Line Chart':                        pos = {                            x : parseInt(tag.chart.symbols[0][2].attr('cx')),                            y : parseInt(tag.chart.symbols[0][2].attr('cy'))                        };                        break;                    case 'Bar Chart':                        pos = {                            x : parseInt(tag.chart.bars[0][2].x),                            y : parseInt(tag.chart.bars[0][2].y)                        };                        break;                }                var dirs = ['South','West','North','East'];                tag.tooltip = r.g[tag.getAttribute('data-tooltipType').getValue()](pos.x,tag.getAttribute('data-tooltipType').getValue() === 'label'?pos.y - 15 :pos.y,tag.getAttribute('data-tooltipType').getValue() === "popup"?dirs[parseInt(tag.getAttribute('data-tooltipAngle').getValue())%360]:parseInt(tag.getAttribute('data-tooltipAngle').getValue()%360 + ""),parseInt(tag.getAttribute('data-tooltipAngle').getValue())-360).attr([{                    fill: colors[0] ,                    stroke : '#000'                }, {                    fill: '#000'                }]);            }            catch(e){            }        }    },    onCreate : function(tag , param){        var        title,        group,        action,        classes,        container,        legendary;        tag._classes    = {            container   : 'waf-chart-container',            legendary   : 'waf-chart-legendary',            title       : 'waf-chart-title'        }        tag._colors = ["#198c1e" , "#a4bb12" , "#ffe500" , "#ec920b" , "#d95911" , "#d12a13" , "#ba0f23" , "#67126f" , "#46146d" , "#23176d" , "#0060a5" , "#009b76"];        /**         * add widget         * @method _addWidget         */        tag._addWidget = function add_widget(config){            var            group,            widget,            groupId,            allFits,            reloadTag,            defaultConfig,            camelCaseFits;            allFits         = ['top' , 'left' , 'right' , 'bottom'];            camelCaseFits   = ['Top' , 'Left' , 'Right' , 'Bottom']            groupId         = tag.getGroupId();            group           = Designer.getGroup(groupId);            reloadTag       = false;            defaultConfig   = {                fit         : ['top' , 'left'],                height      : null,                width       : null,                left        : null,                top         : null,                type        : 'button',                parent      : this,                'class'     : null,                attribs     : null,                'z-index'   : null,                subElem     : true            };            config = $.extend(true, defaultConfig , config);            widget = Designer.createTag({                type        : config.type,                width       : config.width,                height      : config.height,                fit         : config.fit,                silentMode  : true,                parent      : config.parent            });            if(config['class']){                widget.addClass(config['class']);            }            for(var i = allFits.length - 1 , fit ; fit = allFits[i] ; i-- ){                if($.inArray(fit, config.fit) >= 0 && i > 1){                    action = new Designer.action['Add' + camelCaseFits[i] + 'Constraint']({                        tagId       : widget.id,                        tagHtmlId   : widget.getId(),                        oldVal      : 1                    });                    Designer.getHistory().add(action);                }                else if($.inArray(fit, config.fit) < 0 && i <= 1){                    action = new Designer.action['Remove' + camelCaseFits[i] + 'Constraint']({                        tagId       : widget.id,                        tagHtmlId   : widget.getId(),                        oldVal      : 1                    });                    Designer.getHistory().add(action);                }            }            for(i = 0 , fit ; fit = allFits[i] ; i++ ){                if($.inArray(fit, config.fit) >= 0){                    widget.savePosition(fit, config[fit], false, false);                    action = new Designer.action.ModifyStyleInline({                        val         : config[fit],                        oldVal      : 0.001,                        tagId       : widget.id,                        tagHtmlId   : widget.getId(),                        prop        : fit                    });                    Designer.getHistory().add(action);                }                else{                    widget['setFitTo' + camelCaseFits[i]](false);                    widget.savePosition(fit, null);                }            }            if(config.attribs){                for(var attr in config.attribs){                    widget.getAttribute(attr).setValue(config.attribs[attr]);                }                reloadTag = true;            }            if(config['z-index']){                widget.updateZindex(-1);                reloadTag = true;            }            if(reloadTag){                widget.refresh();            }            if(config.subElem){                widget.setAsSubElement(true);            }            this.link(widget);            group.add(widget);            return widget;        }        /**         * Get linked Widgets         * @method _subWidgets         */        tag._subWidgets = function(){            var            res,            classes,            linkedTags;            classes = tag._classes;            if(this._private && this._private.subWidgets){                return this._private.subWidgets;            }            res = {                container   : null,                legendary   : null,                title       : null            };            linkedTags = tag.getLinks();            for(var i = 0 , widget; widget = linkedTags[i] ; i++ ){                var                htmlObj;                htmlObj = widget.getHtmlObject();                if(htmlObj.hasClass(classes.container)){                    res.container = widget;                    continue;                }                else if(htmlObj.hasClass(classes.legendary)){                    res.legendary = widget;                    continue;                }                else if(htmlObj.hasClass(classes.title)){                    res.title = widget;                    continue;                }            }            this._private = this._private || {};            this._private.subWidgets = res;            return res;        }        tag._graph  = Raphael(tag.getId(),tag.getWidth(),tag.getHeight());        /*         *Initialization of the structure of the widget         */        if(!param._isLoaded) {            classes = tag._classes;            /**             * Create the group             */            group   = new Designer.ui.group.Group();            group.add(tag);            container = tag._addWidget({                height      : tag.getHeight() + 90,                width       : tag.getWidth() + 190,                left        : param.x || param.pos.x,                top         : param.y || param.pos.y,                'class'     : classes.container,                parent      : tag.getParent(),                type        : 'container',                subElem     : false            });            action = new Designer.action.ModifyStyleInline({                val         : parseInt(param.y || param.pos.y),                oldVal      : 0,                tagId       : container.id,                tagHtmlId   : container.getId(),                prop        : "top"            });            Designer.getHistory().add(action);            action = new Designer.action.ModifyStyleInline({                val         : parseInt(param.x || param.pos.x),                oldVal      : 0,                tagId       : container.id,                tagHtmlId   : container.getId(),                prop        : "left"            });            Designer.getHistory().add(action);            title = tag._addWidget({                fit         : ['top' , 'left' , 'right'],                height      : 40,                top         : 10,                left        : 0,                right       : 0,                'class'     : classes.title,                parent      : container,                type        : 'richText',                attribs : {                    'data-text'     : 'Wakanda Chart',                    'data-autoWidth': 'false'                }            });            action = new Designer.action.ModifyStyleInline({                val         : container.getWidth(),                oldVal      : container.getWidth() - 1,                tagId       : title.id,                tagHtmlId   : title.getId(),                prop        : "width"            });            Designer.getHistory().add(action);            tag._addWidget({                height      : 155,                width       : 160,                left        : 470,                top         : 80,                right       : 15,                'class'     : classes.legendary,                type        : 'container',                fit         : ['right' , 'top'],                parent      : container            });            tag.setParent(container);            tag.forceBottomConstraint();            tag.forceRightConstraint();            tag.savePosition('bottom', 0 , false , false);            tag.savePosition('right', 180 , false , false);            tag.savePosition('top', 85 , false , false);            tag.savePosition('left', 15 , false , false);            $(container).bind('onFocusSizeChange' , function(){                tag.onDesign(true);                if(Designer.env.createMode){                    tag.onDesign(true);                    if(container.getHeight() > 90){                        tag.setHeight(container.getHeight() - 90 , true);                    }                    if(container.getWidth() > 190){                        tag.setWidth(container.getWidth() - 190 , true);                    }                }                else if(!tag._private.constraintFixed){                    if(tag.isFitToBottom()){                        tag.removeBottomConstraint();                        tag.forceBottomConstraint();                    }                    if(tag.isFitToRight()){                        tag.removeRightConstraint();                        tag.forceRightConstraint();                    }                    tag._private.constraintFixed = true;                }            });            $(tag).bind('onFocusSizeChange' , function(){                if(Designer.env.createMode){                    container.setCurrent();                    tag.setXY(15,85 , true);                }            });        }        else {            /*             * Execute script when widget is entirely loaded (with linked tags)             */            $(tag).bind('onReady', function(){                tag.onDesign(true);                if(tag.getAttribute('data-chartType').getValue() == 'Line Chart' && tag.getEvents().count() < 8){                    var evts = [];                    evts.push({                        name       : 'clickColumn',                        description: 'On Click',                        category   : 'Data Column Events'                    },{                        name       : 'dblclickColumn',                        description: 'On Double Click',                        category   : 'Data Column Events'                    },{                        name       : 'mousedownColumn',                        description: 'On Mouse Down',                        category   : 'Data Column Events'                    },{                        name       : 'mousemoveColumn',                        description: 'On Mouse Move',                        category   : 'Data Column Events'                    },{                        name       : 'mouseoutColumn',                        description: 'On Mouse Out',                        category   : 'Data Column Events'                    },{                        name       : 'mouseoverColumn',                        description: 'On Mouse Over',                        category   : 'Data Column Events'                    },{                        name       : 'mouseupColumn',                        description: 'On Mouse Up',                        category   : 'Data Column Events'                    });                    for(var item in evts){                        tag.getEvents().add(new WAF.tags.descriptor.Event(evts[item]));                    }                    Designer.tag.refreshPanels();                }            });        }    }});// Replaced by the finger gRaphael API////(function () {//    Raphael.fn.g.legendaryItem = function(opts){//        var//        res         = this.set(),//        defaultOpts = {//            x       : 0,//            y       : 0,//            width   : 100,//            height  : 100,//            arrowH  : 20//        };////        opts    = $.extend(true, defaultOpts , opts);//        res.push(this.path("M" + opts.x + " " + (opts.y + opts.arrowH) +//                 "L" + (opts.x + opts.width/2) + " " + opts.y +//                 "L" + (opts.x + opts.width) + " " + (opts.y + opts.arrowH) +//                 "L" + (opts.x + opts.width) + " " + (opts.y + opts.height) +//                 "L" + opts.x + " " + (opts.y + opts.height) +//                 "Z"));//        return res;//    }//}());///*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/chart/widget-chart.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. */// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /** * WAF Google Chart widget * * @class WAF.widget.Chart * @extends WAF.Widget */    'Chart',    {        classes     : {            container   : 'waf-chart-container',            legendary   : 'waf-chart-legendary',            title       : 'waf-chart-title'        }    },    /** * @constructor * @param {Object} inConfig configuration of the widget */    /** * The constructor of the widget * * @property constructor * @type Function * @default WAF.widget.Chart **/    function(inConfig, inData, shared) {    },    {        _getLinkedWidgets   : function(classes){            var            res,            linkedTags;            if(this._private && this._private.subWidgets){                return this._private.subWidgets;            }            res = {                container   : null,                legendary   : null,                title       : null            };            linkedTags = this.getLinks();            for(var i = 0 , widget; widget = linkedTags[i] ; i++ ){                var                htmlObj;                htmlObj = widget.$domNode;                if(htmlObj.hasClass(classes.container)){                    res.container = widget;                    continue;                }                else if(htmlObj.hasClass(classes.legendary)){                    res.legendary = widget;                    continue;                }                else if(htmlObj.hasClass(classes.title)){                    res.title = widget;                    continue;                }            }            this._private = this._private || {};            this._private.subWidgets = res;            return res;        },        getLabels : function(){            return this._private.labels;        },        getValues : function(){            var            values,            res;            values = this._private.values;            res = [];            $.each(values, function(){                if(Raphael.is(this,'array')){                    var                    resTemp;                    resTemp = [];                    $.each(this, function(){                        resTemp.push(this.value);                    })                    res.push(resTemp);                }                else{                    res.push(this.value);                }            });            return res;        },        getChartType: function(){            return this.config['data-chartType'];        },        setFormat   : function(format){            if(!format){                format = "";            }            this.format = {                format : unescape(format)            }        },        recreateChart : function(labels,values){            var            r,            that,            source,            columns,            inConfig,            linkedWidgets;            that            = this;            inConfig        = that.config;            columns         = that.columns;            source          = that.source;            r               = that._private.r;            linkedWidgets   = that._private.linkedWidgets;            if(!labels && !values && that._private && that._private.labels && that._private.values){                labels = that._private.labels;                values = [];                var valuesClone = that.$domNode.data('values');                for(var _i = 0 ; _i<valuesClone.length ; _i++){                    if(valuesClone[_i].length){                        values[_i] = [];                    }                    for(var _j = 0 ; _j<valuesClone[_i].length ; _j++){                        values[_i][_j] = valuesClone[_i][_j];                    }                }            }            if(!labels || !values){                return false;            }            r.setSize($("#" + inConfig.id).width(),$("#" + inConfig.id).height());            r.clear();            switch(inConfig['data-chartType']){                case 'Pie Chart':                    var radius  = Math.min($("#" + inConfig.id).width(),$("#" + inConfig.id).height())/2 - 60,                    opts    = {                        colors      : that.colors,                        stroke      : null,                        strokewidth : null,                        init        : null,                        href        : null,                        legend      : null,                        legendmark  : null,                        legendothers: null,                        legendpos   : null                    };                    that.chart     = r.g.piechart(r.width/2, r.height/2, radius, values[0] , opts);                    that.chart.selected = -1;                    that.isEmpty = false;                    var i = 0;                    that.chart.each(function(){                        var c = that.chart.series[i].clone().hide().translate(10*Math.cos(that.chart.series[i].mangle*Math.PI / 180),-10*Math.sin(that.chart.series[i++].mangle*Math.PI / 180));                        this.cover.posSelect = c.attr('path');                        this.cover.posOrigin = this.sector.attr('path');                        this.sector.index = i-1;                        c.remove();                    });                    that.chart.select = function(i){                        if(i >= values[0].length || i < 0){                            return;                        }                        for(var j = 0 ; j<values[0].length ; j++){                            if(values[0][j].order == i){                                i = j;                                break;                            }                        }                        if(this.selected == i){                            this.selected = -1;                            this.series[i].animate({                                path : this.covers[i].posOrigin                            } , 1000 , 'bounce');                            return;                        }                        if(this.selected != -1){                            this.series[this.selected].animate({                                path : this.covers[this.selected].posOrigin                            } , 1000 , 'bounce');                        }                        this.series[i].animate({                            path : this.covers[i].posSelect                        } , 1000 , 'bounce');                        this.selected = i;                    }                    that.chart.click(function(){                        that.source.select(this.sector.value.order);                    });                    // Set the format :                    source.getAttribute(columns[0].sourceAttID) && source.getAttribute(columns[0].sourceAttID).dataClassAtt && source.getAttribute(columns[0].sourceAttID).dataClassAtt.defaultFormat && that.setFormat(source.getAttribute(columns[0].sourceAttID).dataClassAtt.defaultFormat.format);                    if(columns[0] && columns[0].format){                        that.setFormat(columns[0].format);                    }                    if(inConfig['data-tooltipDisplay']==='true'){                        that.chart.hover(function () {                            this.tag = r.g.blob(this.cx + (radius + 2)*Math.cos(this.mangle*Math.PI / 180),this.cy-(radius + 2)*Math.sin(this.mangle*Math.PI / 180), labels[this.sector.value.order] + "\n" + that.getFormattedValue(this.sector.value.value), this.mangle).insertBefore(this.cover);                            this.tag[0].attr({                                fill : that.colors[this.sector.index%that.colors.length],                                stroke : "#000"                            });                            this.tag[0].scale(1.25 , 1.25);                        }, function () {                            this.tag.animate({                                opacity: 0                            }, 300, function () {                                this.remove();                            });                        });                    }                    try{                        var legendaryC = linkedWidgets.legendary.$domNode;                        legendaryC.empty();                        legendaryC.css('overflow','auto');                        var legTable = $('<table class="waf-chart-legendary-table"></table>').appendTo('#' + legendaryC.prop('id'));                        for(i = 0 ; i < values[0].length ; i++){                            var htmlObj = $('<TR>' +                                '<TD>' +                                '<DIV id = "' + legendaryC.prop('id') + '-legendary-item-' + i + '"></DIV></TD></TR>');                            htmlObj.appendTo(legTable);                            $('<TD>' + labels[that.chart.series[i].value.order] + '</TD>').appendTo(htmlObj);                            var legItem = Raphael(legendaryC.prop('id') + '-legendary-item-' + i , 20 , 20).rect(0,0,20,20).attr({                                fill:that.chart.series.length==1?that.chart.series[0].attr('fill'):that.chart.series[i].attr('fill'),                                cursor : 'pointer'                            });                            legItem.index = that.chart.series[i].value.order;                            legItem.click(function(e){                                that.source.select(this.index);                                if(that.events && that.events.click){                                    that.events.click.call(that , e);                                }                            });                        }                    }catch(e){                        return;                    }                    break;                case 'Line Chart' :                    var offset  = 20,                    max     = values[0][0];                    opts    = {                        vgutter     : null,                        shade       : null,                        nostroke    : false,                        axis        : "0 0 1 1",                        axisxstep   : isNaN(parseInt(inConfig['data-xstepvalue']))?null:parseInt(inConfig['data-xstepvalue']),                        axisystep   : isNaN(parseInt(inConfig['data-ystepvalue']))?null:parseInt(inConfig['data-ystepvalue']),                        width       : null,                        dash        : null, //                        smooth      : false,                        symbol      : "o",                        colors      : that.colors,                        gutter      : 5                    };                    that.isEmpty = false;                    // Sorting the data :                    for (i = 0; i < labels.length; i++) {                        var lab = labels[i];                        labels[i] = {                            value: labels[i] ,                            valueDes : lab ,                            order: i,                            valueOf: function () {                                return this.valueDes;                            }                        };                        for(var j = 0 ; j<values.length ; j++){                            var val = values[j][i];                            if(max < values[j][i]){                                max = values[j][i];                            }                            values[j][i] = {                                value: values[j][i],                                valueDes : val ,                                order: i ,                                column : j ,                                valueOf: function () {                                    return this.valueDes;                                } ,                                label : labels[i]                            };                        }                    }                    offset = r.text(0,0,max).hide().getBBox().width + 10;                    for(i = 0 ; i<values.length ; i++){                        values[i].sort(function (a, b) {                            return labels[a.order].value - labels[b.order].value;                        });                    }                    labels.sort(function (a, b) {                        return a.value - b.value;                    });                    // Drawing the chart                    that.chart = r.g.linechart(offset, 20, r.width - offset - 30 , r.height - 40 , labels , values, opts);                    that.chart.clickColumn(function(e){                        that.source.select(this.values[0].order);                        if(that.events && that.events.clickColumn){                            that.events.clickColumn.call(that , e);                        }                    });                    that.chart.click(function(e){                        that.source.select(this.value.order);                        if(that.events && that.events.click){                            that.events.click.call(that , e);                        }                    });                    if(inConfig['data-tooltipDisplay'] == 'true'){                        that.chart.hover(function(){                            source.getAttribute(columns[this.value.column].sourceAttID) && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat && that.setFormat(source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat.format);                            if(columns[this.value.column].format){                                that.setFormat(columns[this.value.column].format);                            }                            else if(source.getAttribute(columns[this.value.column].sourceAttID) && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat){                                that.setFormat(source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat.format);                            }                            else{                                that.setFormat(columns[this.value.column].format);                            }                            this.line.attr({                                'stroke-width' : 3                            });                            this.tags = r.set();                            this.tags.push(r.g[inConfig['data-tooltipType']](this.x,inConfig['data-tooltipType'] === "label"?this.y-15:this.y, that.getFormattedValue(this.value.value) || "0",parseInt(inConfig['data-tooltipAngle'])-360).insertBefore(this).attr([{                                fill: this.symbol.attr("fill") ,                                stroke : '#000'                            }, {                                fill: '#000'                            }]));                        },function(){                            this.tags && this.tags.remove();                            this.line.attr({                                'stroke-width' : 2                            });                        });                    }                    that.createLengendary();                    break;                case 'Bar Chart'  :                    that.isEmpty = false;                    opts = {                        type    : that.config['data-chartLineType']  == 'basic' ? 'soft' : 'square',                        colors  : that.colors,                        gutter  : 10,                        vgutter : 5,                        to      : isNaN(parseFloat(inConfig['data-ymax']))?null:parseFloat(inConfig['data-ymax']) - (isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin'])),                        stacked : that.config['data-chartLineType']  != 'basic'                    };                    max = values[0][0];                    var                    step,                    vstep       = 10,                    arraySum    = new Array(values[0].length),                    valuesPer   = [],                    maxStacked  = values[0][0];                    step = isNaN(parseInt(inConfig['data-ystepvalue']))?null:parseInt(inConfig['data-ystepvalue']);                    switch(that.config['data-chartLineType']){                        case 'percentage':                            opts.to = null;                            for (i = 0; i < values.length; i++) {                                for(j = 0 ; j<values[i].length ; j++){                                    if(arraySum[j] === undefined){                                        arraySum[j] = values[i][j];                                    }                                    else{                                        arraySum[j] += values[i][j];                                    }                                    if(max < values[i][j]){                                        max = values[i][j];                                    }                                }                            }                            for (i = 0; i < values.length; i++) {                                valuesPer.push([]);                                for(j = 0 ; j<values[i].length ; j++){                                    var per = 100*values[i][j]/arraySum[j];                                    if(i == 0){                                        valuesPer[i].push(per);                                    }                                    else{                                        valuesPer[i].push(per);                                    }                                    valuesPer[i][j] = {                                        value: values[i][j],                                        valueDes : valuesPer[i][j],                                        order: j,                                        column : i,                                        valueOf: function () {                                            return this.valueDes;                                        },                                        percentage  : Math.round(per*100)/100,                                        getLabel : function(){                                            return this.value + '\n' + this.percentage + ' %';                                        }                                    };                                }                            }                            break;                        case 'basic' :                            var sum = [];                            for (j = 0; j < values.length; j++) {                                for(i = 0 ; i<values[j].length ; i++){                                    var                                    temp,                                    ymin,                                    ymax;                                    val     = values[j][i];                                    ymin    = isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin']);                                    ymax    = isNaN(parseFloat(inConfig['data-ymax']))?false:parseFloat(inConfig['data-ymax']);                                    if(max < val){                                        max = val;                                    }                                    switch(true){                                        case ymax && val > ymax:                                            temp = ymax - ymin;                                            break;                                        case val <= ymin:                                            temp = 0;                                            break;                                        default:                                            temp = val - ymin;                                            break;                                    }                                    values[j][i] = {                                        value: val,                                        valueDes : temp,                                        order: i,                                        column : j,                                        valueOf: function () {                                            return this.valueDes;                                        },                                        getLabel : function(){                                            return this.value;                                        }                                    };                                }                            }                            break;                        case 'stacked' :                            sum = [];                            opts.to = null;                            for (j = 0; j < values.length; j++) {                                for(i = 0 ; i<values[j].length ; i++){                                    val     = values[j][i];                                    if(sum[i] == undefined){                                        sum.push(val);                                    }                                    else{                                        sum[i] += val;                                    }                                    values[j][i] = {                                        value: val,                                        valueDes : val,                                        order: i,                                        column : j,                                        valueOf: function () {                                            return this.valueDes;                                        },                                        getLabel : function(){                                            return this.value;                                        }                                    };                                }                            }                            maxStacked = Math.max.apply(Math , sum);                            break;                    }                    if(inConfig['data-yinterval'] === 'Steps'){                        vstep = isNaN(parseInt(inConfig['data-ystepvalue']))?vstep:parseInt(inConfig['data-ystepvalue']);                    }                    else if(inConfig['data-yinterval'] === 'Range'){                        ymax = ymax?ymax:max;                        vstep = isNaN((ymax - ymin)/step)?vstep:parseFloat((ymax - ymin)/step);                    }                    var                    barvgutter  = opts.vgutter || 20 ,                    textSet     = r.set(),                    y           = 35,                    textMax     = 0,                    textTemp    = r.text(0,0,max).hide(),                    x           = textTemp.getBBox().width + 15,                    gutter      = opts.gutter || 10,                    barhgutter  = (r.width - x)*gutter/(labels.length*(100+gutter)+gutter),                    barwidth    = barhgutter*100/gutter,                    posTemp     = x + barhgutter,                    labelAngle  = parseInt(inConfig['data-labelAngle']);                    textTemp.remove();                    for(i = 0 ; i < that.source.length ; i++){                        textTemp = r.text(0,0,labels[i]).hide();                        if(textMax<textTemp.getBBox().width){                            textMax = parseInt(textTemp.getBBox().width*Math.sin(Raphael.rad(labelAngle))) + textTemp.getBBox().height + 4;                        }                    }                    if(that.config['data-chartLineType'] == 'percentage'){                        that.chart = r.g.barchart(x , y, r.width - x, r.height - textMax - y, valuesPer,opts);                        r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , 0 , 100 , 10 , 1 );                    }                    else if(that.config['data-chartLineType'] == 'stacked'){                        that.chart = r.g.barchart(x , y, r.width - x, r.height - textMax - y, values,opts);                        r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , 0 , maxStacked , vstep , 1 );//                        r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin']) , isNaN(parseFloat(opts.to))?max:opts.to+(isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin'])) , vstep , 1 );                    }                    else if(that.config['data-chartLineType'] == 'basic'){                        that.chart = r.g.barchart(x , y, r.width - x, r.height - textMax - y, values,opts);                        r.g.axis(x + barhgutter/2 , r.height - textMax - barvgutter , r.height - textMax - y - 2*barvgutter , isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin']) , isNaN(parseFloat(opts.to))?max:opts.to+(isNaN(parseFloat(inConfig['data-ymin']))?0:parseFloat(inConfig['data-ymin'])) , vstep , 1 );                    }                    that.chart.click(function(e){                        that.source.select(this.value.order);                        if(that.events && that.events.click){                            that.events.click.call(that , e);                        }                    });                    if(inConfig['data-tooltipDisplay'] == 'true'){                        that.chart.hover(function () {                            var                            value   = this.bar.value;                            if(columns[this.value.column].format){                                that.setFormat(columns[this.value.column].format);                            }                            else if(source.getAttribute(columns[this.value.column].sourceAttID) && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt && source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat){                                that.setFormat(source.getAttribute(columns[this.value.column].sourceAttID).dataClassAtt.defaultFormat.format);                            }                            else{                                that.setFormat(columns[this.value.column].format);                            }                            this.tag = r.g[inConfig['data-tooltipType']](this.bar.x,inConfig['data-tooltipType'] === "label"?this.bar.y-15:this.bar.y, this.value.getLabel(),parseInt(inConfig['data-tooltipAngle'])-360).insertBefore(this).attr([{                                fill: this.bar.attr("fill") ,                                stroke : '#000'                            }, {                                fill: '#000'                            }]);                        }, function () {                            this.tag.animate({                                opacity: 0                            }, 300, function () {                                this.remove();                            });                        });                    }                    /**                 * Add the labels and the axis labels                 *                 **/                    var                    width = 0,                    oldX,                    point,                    options;                    i = labels.length;                    j = 0;                    that.chart.each(function(){                        if(j == values.length - 1){                            if(i==labels.length){                                width *= 2;                            }                            options = {                                m : {                                    x : this.bar.x - this.attr('width')/2 - barhgutter/2,                                    y : r.height - textMax - barvgutter + 1                                },                                width : width,                                height: -3                            };                            r.g.axisItem(options);                            switch(inConfig['data-labelAlign']){                                case 'start' :                                    point = {                                        x           : options.m.x,                                        y           : r.height - textMax + textTemp.getBBox().height/2 + 2,                                        textAnchor  : inConfig['data-labelAlign'],                                        angle       : labelAngle                                    }                                    break;                                case 'middle' :                                    point = {                                        x : options.m.x + options.width/2,                                        y : r.height - textMax/2,                                        textAnchor  : inConfig['data-labelAlign'],                                        angle       : -labelAngle                                    };                                    break;                                case 'end' :                                    point = {                                        x : options.m.x,                                        y : r.height - textTemp.getBBox().height/2 -2,                                        textAnchor  : 'start',                                        angle       : -labelAngle                                    }                                    break;                                default :                                    point = {                                        x : options.m.x + options.width/2,                                        y : r.height - textMax/2,                                        textAnchor  : inConfig['data-labelAlign'],                                        angle       : -labelAngle                                    };                                    break;                            }                            textTemp = r.text(point.x, point.y , labels[i-1]).attr({                                'text-anchor' : point.textAnchor                            }).rotate(point.angle, point.x, point.y);                            textSet.push(textTemp);                            posTemp += barwidth + barhgutter;                            j = 0;                            width = 0;                            i--;                        }                        else{                            j++;                            if(!oldX){                                oldX = this.bar.x + this.attr('width')/2 + barhgutter/2;                            }                            width += oldX - this.bar.x;                            oldX = this.bar.x;                        }                    })                    that.createLengendary();                    break;            }            for(var evt in this.events){                switch(evt){                    case 'dblclick':                        this.chart.dblclick(function(e){                            that.events.dblclick.call( that , e);                        });                        break;                    case 'click':                        this.chart.click(function(e){                            that.events.click.call( that , e);                        });                        break;                    case 'dblclickColumn':                        this.chart.dblclickColumn(function(e){                            that.events.dblclickColumn.call( that , e);                        });                        break;                    case 'mousedown':                        this.chart.mousedown(function(e){                            that.events.mousedown.call( that , e);                        });                        break;                    case 'mousedownColumn':                        this.chart.mousedownColumn(function(e){                            that.events.mousedownColumn.call( that , e);                        });                        break;                    case 'mousemove':                        this.chart.mousemove(function(e){                            that.events.mousemove.call( that , e);                        });                        break;                    case 'mousemoveColumn':                        this.chart.mousemoveColumn(function(e){                            that.events.mousemoveColumn.call( that , e);                        });                        break;                    case 'mouseout':                        this.chart.mouseout(function(e){                            that.events.mouseout.call( that , e);                        });                        break;                    case 'mouseoutColumn':                        this.chart.mouseoutColumn(function(e){                            that.events.mouseoutColumn.call( that , e);                        });                        break;                    case 'mouseover':                        this.chart.mouseover(function(e){                            that.events.mouseover.call( that , e);                        });                        break;                    case 'mouseoverColumn':                        this.chart.mouseoverColumn(function(e){                            that.events.mouseoverColumn.call( that , e);                        });                        break;                    case 'mouseup':                        this.chart.mouseup(function(e){                            that.events.mouseup.call( that , e);                        });                        break;                    case 'mouseupColumn':                        this.chart.mouseupColumn(function(e){                            that.events.mouseupColumn.call( that , e);                        });                        break;                }                this.chart[evt](function(e){                    });            }        },        ready : function(){            this._private = this._private || {};            var that = this;            var            labels          = [],            values          = [],            valuesClone     = [],            source          = this.source,            shared          = {                classes     : {                    container   : 'waf-chart-container',                    legendary   : 'waf-chart-legendary',                    title       : 'waf-chart-title'                }            },            linkedWidgets   = this._getLinkedWidgets(shared.classes),            columns,            minLength,            inConfig;            inConfig = this.config;            columns= JSON.parse(inConfig['data-column'].replace(/'/g,'"'));            this.isEmpty                = true;            this.columns                = columns;            this._private.linkedWidgets = linkedWidgets;            /*         * Drawing The legendary for Bar and Line Chart         */            that.createLengendary = function(){                try{                    var legendaryC = linkedWidgets.legendary.$domNode;                    legendaryC.empty();                    legendaryC.css('overflow','auto');                    var legTable = $('<table></table>')                    .appendTo('#' + legendaryC.prop('id'))                    .addClass('waf-chart-legendary-table');                    for(var i = 0 ; i < values.length ; i++){                        var htmlObj = $('<TR>' +                            '<TD style="padding:1px">' +                            '<DIV id = "' + legendaryC.prop('id') + '-legendary-item-' + i + '"></DIV></TD></TR>');                        htmlObj.appendTo(legTable);                        $('<TD style="padding-left:3px">' + unescape(columns[i].title) + '</TD>').appendTo(htmlObj);                        Raphael(legendaryC.prop('id') + '-legendary-item-' + i , 20 , 20).rect(0,0,20,20).attr({                            fill:that.colors[i]                        });                    }                }catch(e){                    return;                }            }            var r = Raphael(inConfig.id,$("#" + inConfig.id).width(),$("#" + inConfig.id).height());            this._private.r = r;            switch(inConfig['data-chartType']){                case 'Line Chart':                case 'Bar Chart' :                    that.colors = [];                    for(i = 0 ; column = columns[i] ; i++){                        that.colors.push(unescape(column.color));                    }                    break;                case 'Pie Chart':                    that.colors = ["hsb(0.34,0.69,0.65)","hsb(0.19,0.82,0.81)","hsb(0.15,1,1)","hsb(0.10,0.91,0.97)","hsb(0.06,0.85,0.92)","hsb(0.02,0.83,0.90)","hsb(0.98,0.85,0.79)","hsb(0.82,0.71,0.51)","hsb(0.76,0.68,0.51)","hsb(0.69,0.65,0.52)","hsb(0.57,1,0.65)","hsb(0.46,1,0.61)"];                    break;            }            if(source && inConfig['data-axisLabel'] && columns.length > 0){                source.addListener("all",function(e){                    switch(e.eventKind){                        case "onElementSaved" :                        case "onCollectionChange" :                            labels          = [];                            values          = [];                            valuesClone     = [];                            for(var j = 0 ; j<columns.length ; j++){                                values[j]       = [];                                valuesClone[j]  = [];                            }                            minLength = Math.min(parseInt(inConfig['data-limitlength']), source.length);                            for(var i = 0 ; i < minLength ; i++){                                source.getElement(i, {                                    onSuccess : function(event){                                        var item = event.element;                                        labels.push(item[inConfig['data-axisLabel']]);                                        for(j = 0 ; j < columns.length ; j++){                                            values[j].push(isNaN(parseFloat(item[columns[j].sourceAttID]))?0:parseInt(item[columns[j].sourceAttID]));                                            valuesClone[j].push(isNaN(parseFloat(item[columns[j].sourceAttID]))?0:parseInt(item[columns[j].sourceAttID]));                                        }                                        if(event.userData.onLastEntity){                                            that._private.labels    = labels;                                            that._private.values    = values;                                            that.$domNode.data({                                                labels: labels,                                                values: valuesClone                                            });                                            that.recreateChart(labels,values);                                        }                                    }                                },{                                    onLastEntity  : i == Math.min(parseInt(inConfig['data-limitlength']), source.length)-1,                                    order         : i                                }                                );                            }                            break;                        case "onCurrentElementChange" :                            switch(inConfig['data-chartType']){                                case 'Pie Chart' :                                    try{                                        that.chart.select(that.source.getPosition());                                    }catch(e){                                    }                                    break;                            }                            break;                    }                });            }        },        stopResize : function(){            var            labels,            values;            labels = this.getLabels();            values = this.getValues();            this.recreateChart(labels,values);        }    }    );(function () {    Raphael.fn.g.axisItem = function(opts){        var        res         = this.set(),        defaultOpts = {            m : {                x : 0,                y : 0            },            width   : 100,            height  : -10,            v       : 0        };        opts    = $.extend(true, defaultOpts , opts);        res.push(this.path("M" + opts.m.x + " " + opts.m.y +            "L" + (opts.m.x + opts.width) + " " + opts.m.y +            "L" + (opts.m.x + opts.width) + " " + (opts.m.y + opts.height)            ));        return res;    }}());/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/fileUpload/widget-fileUpload-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    /**     *  Widget Descriptor     *     */    /* PROPERTIES */    // {String} internal name of the widget    type        : 'fileUpload',    // {String} library used ('waf', 'jquery', 'extjs', 'yui') (optional)    lib         : 'WAF',    // {String} display name of the widget in the GUI Designer    description : 'File Upload',    // {String} category in which the widget is displayed in the GUI Designer    category    : 'Form Controls',    // {String} image of the tag to display in the GUI Designer (optional)    img         : '/walib/WAF/widget/fileUpload/icons/widget-fileUpload.png',    // {Array} css file needed by widget (optional)    css         : [],    // {Array} script files needed by widget (optional)    include     : [],    // {String} type of the html tag ('div' by default)    tag         : 'div',    // {Array} attributes of the widget. By default, we have 3 attributes: 'data-type', 'data-lib', and 'id', so it is unnecessary to add them    //    // @property {String} name, name of the attribute (mandatory)    // @property {String} description, description of the attribute (optional)    // @property {String} defaultValue, default value of the attribute (optional)    // @property {'string'|'radio'|'checkbox'|'textarea'|'dropdown'|'integer'} type, type of the field to show in the GUI Designer (optional)    // @property {Array} options, list of values to choose for the field shown in the GUI Designer (optional)    attributes  : [    {        name       : 'data-binding',        description: 'Source',        onchange   : function(){            Designer.tag.refreshPanels();        }    },{        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },{               name        : 'data-label-position',               description : 'Label position',               defaultValue: 'left'       },{        name        : 'data-action',        visibility  : 'hidden',        defaultValue: 'false',        type        : 'checkbox'    },{        name        : 'data-text',        description : 'Text',        defaultValue: 'Drag your file(s) here'    },{        name        : 'data-maxfilesize',        visibility  : 'hidden',        defaultValue: '-1'    },{        name        : 'data-maxfilesize-unity',        visibility  : 'hidden',        defaultValue: 'KB'    },{        name        : 'data-maxfiles',        visibility  : 'hidden',        defaultValue: '-1'    },{        name        : 'data-folder',        visibility  : 'hidden',        defaultValue: 'tmp'    },{        name        : 'data-autoUpload',        visibility  : 'hidden',        defaultValue: 'false'    },{        name        : 'data-userAction',        visibility  : 'hidden',        defaultValue: 'Ask the user'    },{        name        : 'data-notification',        description : 'Display notification',        type        : 'checkbox',        defaultValue: 'true'    },{        name        : 'data-listStyle',        description : 'Display file list as',        type        : 'radiogroup',        options     : [{            key : 'popup',            value : 'Popup'        }, {            key : 'menu',            value : 'List'        }],        defaultValue: 'menu'    }    ],    // {Array} default height and width of the container for the widget in the GUI Designer    //    // @property {String} name, name of the attribute    // @property {String} defaultValue, default value of the attribute    style: [    {        name        : 'width',        defaultValue: '240px'    },    {        name        : 'height',        defaultValue: '35px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'filesUploaded',        description: 'On After Upload',        category   : 'Upload Events'    },    {        name       : 'filesExists',        description: 'On File Exists',        category   : 'Upload Events'    }],    // {JSON} panel properties widget    //    // @property {Object} enable style settings in the Styles panel in the Properties area in the GUI Designer    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            shadow      : true,            textShadow  : true,            innerShadow : true,            label       : false        },        state : [{            label   : 'hover',            cssClass: 'waf-state-dragover',            find    : ''        },{            label   : 'active',            cssClass: 'waf-state-notempty',            find    : ''        }]    },    // (optional area)    //    // {Array} list of sub elements for the widget    //    // @property {String} label of the sub element    // @property {String} css selector of the sub element    structure: [    //    {    //        description : 'Files container',    //        selector    : '.waf-fileUpload-tabContainer',    //        style: {    //            fClass      : true,    //            text        : false,    //            background  : true,    //            border      : true,    //            sizePosition: true,    //            dropShadow  : true,    //            innerShadow : true,    //            label       : false,    //            disabled    : []    //        }    //    },    //    {    //        description : 'File Item',    //        selector    : '.waf-fileUpload-fileItem',    //        style: {    //            fClass      : true,    //            text        : false,    //            background  : true,    //            border      : true,    //            sizePosition: true,    //            dropShadow  : true,    //            innerShadow : true,    //            label       : false,    //            disabled    : []    //        },    //        state : [    //        {    //            label   : 'hover',    //            cssClass: 'waf-state-hover',    //            find    : ''    //        }    //        ]    //    }    ],    /* METHODS */    /*     * function to call when the widget is loaded by WAF during runtime     *     * @param {Object} config contains all the attributes of the widget     * @result {WAF.widget.Template} the widget     */    onInit: function (config) {        new WAF.widget.FileUpload(config);    },    /**     * function to call when the widget is displayed in the GUI Designer     *     * @param {Object} config contains all the attributes for the widget     * @param {Designer.api} set of functions used to be managed by the GUI Designer     * @param {Designer.tag.Tag} container of the widget in the GUI Designer     * @param {Object} catalog of dataClasses defined for the widget     * @param {Boolean} isResize is a resize call for the widget (not currently available for custom widgets)     */    onDesign: function (config, designer, tag, catalog, isResize) {        var        htmlObj,        paragraph,        linkedTags;        /**         * CSS classes object         */        tag.classes = {            btnBrowse   : 'waf-fileUpload-btnBrowse',            btnUpload   : 'waf-fileUpload-btnUpload',            btnDelete   : 'waf-fileUpload-btnDelete',            btnCardinal : 'waf-fileUpload-btnCardinal',            filesList   : {                classname   : 'waf-fileUpload-fileList',                children    : {                    table   : 'waf-fileUpload-fileList-table',                    tr      : 'waf-fileUpload-fileItem',                    tdname  : 'waf-fileUpload-fileItem-name',                    tdbutton: 'waf-fileUpload-fileItem-button'                },                states      : {                    popup   : 'waf-fileUpload-fileList-popup',                    menu    : 'waf-fileUpload-fileList-menu'                }            },            tag         : {                classname   : 'waf-fileUpload',                children    : {                    paragraph   : 'waf-fileUpload-paragraph'                }            }        }        if(!tag.getFULinkedWidgets){            return;        }        htmlObj         = tag.getHtmlObject();        linkedTags      = tag.getFULinkedWidgets();        paragraph       = htmlObj.children('p').length == 0 ? $('<p>').appendTo(htmlObj) : $(htmlObj.children('p')[0]);        paragraph.addClass(tag.classes.tag.children.paragraph);        paragraph.css({            'padding-top'   : tag.getHeight()/2 - 7        });        paragraph.html(tag.getAttribute('data-text').getValue() || '');        // Fill the table container        if(isResize || tag._firstCreation){            if(linkedTags.filesList && tag.refreshFileList){                var                fileList    = linkedTags.filesList;                fileList.setWidth(tag.getWidth())                fileList.setY(tag.getHeight(), true, false);                tag._firstCreation--;            }        }        tag.refreshFileList();        if(tag._firstCreation == 0){            delete tag._firstCreation;        }    },    onCreate : function(tag,param){        var        group,        btnUpload,        btnDelete,        filesList,        btnBrowse,        paragraph,        btnCardinal;        tag._oldSource  = tag.getSource();        group           = new Designer.ui.group.Group();        /*         * Apply theme on widget theme's change         */        tag.onChangeTheme = function(theme) {            var            group;            group = D.getGroup(this.getGroupId());            if (group) {                group.applyTheme(theme, this);            }        }        /**         * get linked widgets         * @method getLinkedWidgets         * @return {object} widgets         */        tag.getFULinkedWidgets = function get_linked_widgets(){            var            widgets,            linkedTags,            tag = this;            linkedTags  = tag.getLinks();            widgets     = {            };            for (var i = 0, widget; widget = linkedTags[i]; i++) {                var htmlObj = widget.getHtmlObject();                if(htmlObj.hasClass(tag.classes.filesList.classname)){                    widgets.filesList = widget;                }                else if(htmlObj.hasClass(tag.classes.btnBrowse)){                    widgets.btnBrowse = widget;                }                else if(htmlObj.hasClass(tag.classes.btnUpload)){                    widgets.btnUpload = widget;                }                else if(htmlObj.hasClass(tag.classes.btnDelete)){                    widgets.btnDelete = widget;                }                else if(htmlObj.hasClass(tag.classes.btnCardinal)){                    widgets.btnCardinal = widget;                }            }            return widgets;        }        /**         * get refresh the fileList         * @method refreshFileList         * @return null         */        tag.refreshFileList = function refresh_file_list(){            var linkedTags      = tag.getFULinkedWidgets();            if(linkedTags && linkedTags.filesList){                var                fileList        = linkedTags.filesList,                tabContainer    = fileList.getHtmlObject().empty(),                filesTab        = $('<table>').appendTo(tabContainer).addClass(tag.classes.filesList.children.table),                files           = ['File 1.png' , 'File 2.pdf' , 'File 3.jpg'];                for (var i = 0 , f; f = files[i]; i++) {                    var tr = $('<tr>').addClass(tag.classes.filesList.children.tr).appendTo(filesTab);                    $('<td>').addClass(tag.classes.filesList.children.tdname).html(f).appendTo(tr);                    $('<td>').addClass(tag.classes.filesList.children.tdbutton).html($('<button>')).appendTo(tr);                }                switch(tag.getAttribute('data-listStyle').getValue()){                    case 'menu' :                        fileList.addClass( tag.classes.filesList.classname + ' ' + tag.classes.filesList.states.menu);                        break;                    case 'popup' :                        fileList.addClass( tag.classes.filesList.classname + ' ' + tag.classes.filesList.states.popup);                        break;                }                fileList.domUpdate();            }        }        /**         * Add buttons to the FU widget         * @method _addButtons         */        tag._addButton = function add_button(parent , position , config){            var            button;            config.text         = config.text || "";            config.fitToRight   = config.direction || true;            button = Designer.createTag({                type        : 'button',                fit         : ['right' , 'top' , 'bottom'],                silentMode  : true,                parent      : parent,                width       : config.width,                height      : config.height            });            config.fitToRight && button.setFitToLeft(false);            button.getAttribute('class').setValue( config['class'] );            button.getAttribute('data-text').setValue(config.text);            button.savePosition('left', position.left);            button.savePosition('top', position.top);            button.savePosition('right', position.right);            button.savePosition('bottom', position.bottom);            parent.link(button);            button.domUpdate();            return button;        }        if (!param._isLoaded) {            group.add(tag);            btnBrowse = tag._addButton(                tag,                {                    left    : null,                    top     : 6,                    right   : 4,                    bottom  : null                } ,{                    text    : "...",                    'class' : tag.classes.btnBrowse,                    width   : 23,                    height  : 23                }                );            group.add(btnBrowse);            btnUpload = tag._addButton(                tag,                {                    left    : null,                    top     : 6,                    right   : 31,                    bottom  : null                } ,{                    text    : " ",                    'class' : tag.classes.btnUpload,                    width   : 21,                    height  : 24                }                );            group.add(btnUpload);            btnCardinal = tag._addButton(                tag,                {                    left    : null,                    top     : 11,                    right   : 54,                    bottom  : null                } ,{                    text    : "n",                    'class' : tag.classes.btnCardinal,                    width   : 15,                    height  : 15                }                );            group.add(btnCardinal);            btnDelete = tag._addButton(                tag,                {                    left    : null,                    top     : 11,                    right   : 71,                    bottom  : null                } ,{                    text    : "x",                    'class' : tag.classes.btnDelete,                    width   : 15,                    height  : 15                }                );            group.add(btnDelete);            filesList = Designer.createTag({                type        : 'container',                width       : tag.getWidth(),                height      : 50,                left        : -1,                top         : tag.getHeight()-1,                silentMode  : true,                parent      : tag            });            //filesList.getAttribute('class').setValue( tag.classes.filesList.classname + ' ' + tag.classes.filesList.states.menu);            filesList.addClass(tag.classes.filesList.classname + ' ' + tag.classes.filesList.states.menu);            tag.link(filesList);            filesList.link(tag);            filesList.refresh();            group.add(filesList);            Designer.ui.group.save();            tag._firstCreation = 2;        }        else {            /*             * Execute script when widget is entirely loaded (with linked tags)             */            $(tag).bind('onReady', function(){                tag.refreshFileList();            });        }        tag.refresh();    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/fileUpload/widget-fileUpload.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'FileUpload',    {    },    function(config, data, shared) {        this._private = {            classes : {                btnBrowse   : 'waf-fileUpload-btnBrowse',                btnUpload   : 'waf-fileUpload-btnUpload',                btnDelete   : 'waf-fileUpload-btnDelete',                btnCardinal : 'waf-fileUpload-btnCardinal',                filesList   : {                    classname   : 'waf-fileUpload-fileList',                    children    : {                        table   : 'waf-fileUpload-fileList-table',                        tr      : 'waf-fileUpload-fileItem',                        tdname  : 'waf-fileUpload-fileItem-name',                        tdbutton: 'waf-fileUpload-fileItem-button'                    },                    states      : {                        popup   : 'waf-fileUpload-fileList-popup',                        menu    : 'waf-fileUpload-fileList-menu'                    }                },                tag         : {                    classname   : 'waf-fileUpload',                    children    : {                        paragraph   : 'waf-fileUpload-paragraph'                    }                }            },            Files : function(files , theList){                this.setFiles(files);                this.setList(theList);            }        };    },    {        ready : function(){            /**             * Init runtime variables             */            var            that            = this,            config          = that.config,            htmlObj         = that.$domNode,            _linkedWidgets  = that._getFULinkedWidgets(),            classes         = that._private.classes,            paragraph       = $('<p>' + (config['data-text']||'') + '</p>').addClass(classes.tag.children.paragraph),            btnBrowse       = _linkedWidgets.btnBrowse ? _linkedWidgets.btnBrowse.css('z-index',1) : false,            btnUpload       = _linkedWidgets.btnUpload ? _linkedWidgets.btnUpload.css('z-index',1) : false,            btnDelete       = _linkedWidgets.btnDelete ? _linkedWidgets.btnDelete.css('z-index',1) : false,            btnCardinal     = _linkedWidgets.btnCardinal ? _linkedWidgets.btnCardinal.css('z-index',1) : false,            tabContainer    = _linkedWidgets.filesList ? _linkedWidgets.filesList.css('z-index',1).css('height','auto').css('overflow','visible') : false,            upload          = $('<input id="' + that.id + '-upload" type="file" name="' + that.id + '-upload" multiple="true" style="opacity:0;position:absolute;z-index:0"></input>').appendTo(htmlObj),            extraConfig     = {                folder      : that.getFolderName(),                replace     : false            },            extensionRegEx  = /.jpg$|.jif$|.jpeg$|.jpe$|.png$|.bmp$|.dib$|.rle$|.gif$|.tif$|.tiff$|.emf$|.pdf$|.svg$/i;            if (that.source && that.source.getDataClass() && that.source.getDataClass().getName) {                extraConfig.datasource  = {                    dsname  : that.source.getDataClass().getName(),                    id      : that.source.getCurrentElement()?that.source.getCurrentElement().getKey():null,                    field   : that.sourceAtt.name,                    saveOnDS: config['data-action'] === 'true'                }            }            switch(config['data-listStyle']){                case 'menu' :                    break;                case 'popup' :                    if(!btnCardinal && tabContainer){                         tabContainer.remove();                         break;                    }                    if(!tabContainer){                        break;                    }                    var position =  btnCardinal.position();                    tabContainer.appendTo(btnCardinal.parent());                    tabContainer.css('left',position.left + btnCardinal.width()/2 - tabContainer.width()/2);                    tabContainer.css('top',position.top + btnCardinal.height() + 15);                    btnCardinal.parent().css('overflow','visible');                    break;            }            /**             * init the shared.files class :             */            this._private.Files.prototype = {                getFiles : function(){                    return this._files;                },                setFiles : function(files){                    var                    maxSize,                    maxFiles,                    fileUnity,                    tempFiles;                    maxFiles    = parseInt(config['data-maxfiles']);                    maxSize     = parseInt(config['data-maxfilesize']);                    fileUnity   = config['data-maxfilesize-unity'].toLowerCase();                    switch(fileUnity){                        case 'mb' :                            maxSize *= 1024;                        case 'kb' :                            maxSize *= 1024;                            break;                    }                    if(maxFiles > -1 || maxSize > -1){                        tempFiles = [];                        if(maxFiles > -1){                            for (var i = 0,f; (f = files[i]) && (i < maxFiles); i++) {                                if(maxSize > -1){                                	if(f.fileSize && f.fileSize <= maxSize) {                                		tempFiles.push(f);                                	} else if(f.size && f.size < maxSize) {										tempFiles.push(f);                                	}                                }                                else{                                   tempFiles.push(f);                                }                            }                        }                        else{                            for (i = 0,f; f = files[i]; i++) {                                if(maxSize > -1){                                    if(f.fileSize && f.fileSize <= maxSize) {                                		tempFiles.push(f);                                	} else if(f.size && f.size < maxSize) {										tempFiles.push(f);                                	}                                }                                else{                                   tempFiles.push(f);                                }                            }                        }                        files = tempFiles;                    }                    if(that.source && files.length > 0){                        var res = [];                        for (i = 0,f; f = files[i]; i++) {                            if(f.name.match(extensionRegEx)){                                res.push(f);                                break;                            }                        }                        files = res;                    }                    this._files     = this.toArray(files);                    this._length    = this._files.length;                    btnCardinal && btnCardinal.data('text','' + this._length) && btnCardinal.html(this._length);                    if(this._length > 0 ){                        btnDelete && btnDelete.show();                        btnCardinal && btnCardinal.show();                        btnUpload && btnUpload.show();                        if(tabContainer){                            tabContainer.show();                            tabContainer.css('opacity',1);                            if(tabContainer.hasClass(classes.filesList.states.popup)){                                tabContainer.stop();                                tabContainer.animate({                                    opacity : 0                                },2000,function(){                                    tabContainer.hide();                                });                            }                        }                        htmlObj.removeClass('waf-state-dragover');                        htmlObj.addClass('waf-state-notempty');                    }                    else if( this._length == 0){                        btnDelete && btnDelete.hide();                        btnCardinal && btnCardinal.hide();                        tabContainer && tabContainer.hide();                        btnUpload && btnUpload.hide();                        htmlObj.removeClass('waf-state-dragover waf-state-notempty');                    }                    this.refreshList();                },                getList : function(){                    return this._list;                },                setList : function(theList){                    this._list = theList;                    this._list.addClass(classes.filesList.classname);                },                removeIndex : function(index){                    var files   = this.getFiles(),                    temp    = [];                    for (var i = 0, f; f = files[i]; i++) {                        if(i!=index){                            temp.push(f);                        }                    }                    this.setFiles(                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              temp);                },                appendFiles : function(files){                    files = this.toArray(files).concat(this.getFiles());                    this.setFiles(files);                },                refreshList : function(){                    var theList = this.getList(),                    files   = this.getFiles();                    if(!theList){                        return;                    }                    theList.empty();                    for (var i = 0, f; f = files[i]; i++) {                        var                        tr,                        btn;                        tr  = $('<tr>').addClass(classes.filesList.children.tr);                        btn = $('<button>').hide();                        tr.append($('<td>' + f.name + '</td>').addClass(classes.filesList.children.tdname));                        tr.append($('<td>').addClass(classes.filesList.children.tdbutton).append(btn));                        btn.click(function(e){                            var trClosest   = $(this).closest('tr'),                            fileInfo        = trClosest.data('fileInfo');                            that.fileSet.removeIndex(trClosest.index());                        });                        tr.data('fileInfo' , {                            file : f                        });                        btn.data('trClosest' , tr);                        theList.append(tr);                    }                },                removeAll : function(){                    var                    uploadTmp,                    tmp;                    this.setFiles([]);                    tmp         = document.getElementsByName(that.id + "-upload")[0];                    tmp.value   = "";                    uploadTmp   = tmp.cloneNode(false);                    uploadTmp.onchange= tmp.onchange;                    tmp.parentNode.replaceChild(uploadTmp,tmp);                    upload = uploadTmp;                },                toArray : function(files){                    if(!files){                        return this._files;                    }                    var res = [];                    for (var i = 0, f; f = files[i]; i++) {                        res.push(f);                    }                    return res;                },                getFilesInfo : function(){                    var res     = {                        folder  : that.getFolderName(),                        files   : []                    },                    files   = this.getFiles();                    for (var i = 0, f; f = files[i]; i++) {                        var item = {                            name    : f.name,                            size    : f.size,                            type    : f.type                        };                        res.files.push(item);                    }                    return res;                },                uploadFiles : function() {                	that._sendFiles(that.fileSet.getFilesInfo() , that.fileSet.getFiles() , extraConfig);                }            }            that.filesTab       = $('<table></table>').addClass(classes.filesList.children.table);            that.fileSet        = new that._private.Files([] , that.filesTab);            /**             * Init the design :             */            paragraph.css({                'padding-top'   : that.getHeight()/2 - 7            });            that._private.paragraph = paragraph;            paragraph.appendTo(htmlObj);            that.filesTab.appendTo(tabContainer);            /**             * Init events :             */            $('.' + classes.filesList.children.tr).live({                'mouseenter' : function(e){                    $(this).children('.' + classes.filesList.children.tdbutton).children().show();                    $(this).addClass('waf-state-hover');                },                'mouseleave' : function(e){                    $(this).children('.' + classes.filesList.children.tdbutton).children().hide();                    $(this).removeClass('waf-state-hover');                }            });            btnUpload && btnUpload.click(function(){                extraConfig.folder = that.getFolderName();                that._sendFiles(that.fileSet.getFilesInfo() , that.fileSet.getFiles() , extraConfig);            });            btnDelete && btnDelete.click(function(){                that.fileSet.removeAll();            });            btnBrowse && btnBrowse.click(function(){                upload.click();            });            $('#' + that.id + '-upload').live({                change : function(e){                    that.fileSet.appendFiles(this.files);                    if(config['data-autoUpload'] === 'true'){                        extraConfig.folder = that.getFolderName();                        that._sendFiles(that.fileSet.getFilesInfo() , that.fileSet.getFiles() , extraConfig);                    }                }            });            btnCardinal && btnCardinal.hover(function(e){                if(tabContainer && tabContainer.hasClass(classes.filesList.states.popup)){                    tabContainer.stop();                    tabContainer.show();                    tabContainer.css('opacity',1)                }            },function(){                if(tabContainer && tabContainer.hasClass(classes.filesList.states.popup)){                    tabContainer.stop();                    tabContainer.animate({                        opacity : 0                    },1000,function(){                        tabContainer.hide();                    });                }            })            $('.' + classes.filesList.states.popup).hover(function(e){                $(this).stop();                $(this).show();                $(this).css('opacity',1);            },function(){                $(this).stop();                $(this).animate({                    opacity : 0                },1000,function(){                    $(this).hide();                });            })            function handleFileSelect(evt) {                evt.stopPropagation();                evt.preventDefault();                var files = evt.dataTransfer.files; // FileList object.                that.fileSet.appendFiles(files);                if(config['data-autoUpload'] === 'true'){                    extraConfig.folder = that.getFolderName();                    that._sendFiles(that.fileSet.getFilesInfo() , that.fileSet.getFiles() , extraConfig);                }            }            function handleDragOver(evt) {                htmlObj.addClass('waf-state-dragover');                evt.stopPropagation();                evt.preventDefault();            }            var dropZone = document.getElementById(this.id);            dropZone.addEventListener('dragover', handleDragOver, false);            dropZone.addEventListener('drop', handleFileSelect, false);        },        _notify: function ( title, text ) {            if ($('#waf-notify-container').length == 0) {                $('<div>').prop('id', 'waf-notify-container').appendTo('body');            }            if ($('#waf-notify').length == 0) {                $('<div>').prop('id', 'waf-notify').appendTo('#waf-notify-container');                $('#waf-notify').html('<a class="ui-notify-close ui-notify-cross" href="#">x</a><h1>#{title}</h1><p>#{text}</p>');            }            var $container = $("#waf-notify-container").notify();            $container.notify("create", 'waf-notify', {                title: title,                text: text            });        },        _sendFiles : function(filesInfo, files, config){            var that = this;            if(that.source && config.datasource){                config.datasource.id = that.source.getCurrentElement().getKey();            }            if(files.length < 1) {                alert("Select a file to upload.")            } else {                var theForm     = new FormData(),                xhr             = that._getXMLHttpRequest();                for(var i = 0, max = files.length; i < max; ++i) {                    theForm.append("filesToUpload", files[i]);                }                xhr.addEventListener("load", function (evt) {                    var                    responseObj = {                        response : JSON.parse(evt.target.responseText)                    }                    if(that.config['data-notification'] === 'true'){                            that._notify('File(s) uploaded','File(s) uploaded successfully');                    }                    that.events && that.events.filesUploaded && that.events.filesUploaded(responseObj);                    that.source && that.source.serverRefresh();                    that.fileSet.removeAll([]);                }, false);                xhr.addEventListener("error", function(evt) {                    alert("An error occurred while trying to upload the file.");                }, false);                xhr.addEventListener("abort", function(evt) {                    alert("The upload was cancelled by the user or the connection was interrupted by the browser.");                }, false);                // Open xhr                xhr.open('post', '/waUpload/upload', true);                if(that.config['data-userAction'] === 'Ask the user'){                    $.ajax({                        type: 'POST',                        url: '/waUpload/verify',                        data: {                            filesInfo : JSON.stringify(filesInfo)                        },                        success: function(data, textStatus, jqXHR){                            var serverResponse  = JSON.parse(jqXHR.responseText),                            opts = {                                yesOption : function(){                                    config.replace = true;                                    theForm.append('config',JSON.stringify(config));                                    xhr.send(theForm);                                },                                noOption : function(){                                    config.replace = false;                                    theForm.append('config',JSON.stringify(config));                                    xhr.send(theForm);                                }                            }                            if(serverResponse && serverResponse.conflits && serverResponse.conflits.length && serverResponse.conflits.length > 0 ){                                that.events && that.events.filesExists && that.events.filesExists(serverResponse);                                that._confirm('Server Message',serverResponse.message,opts);                            }                            else{                                theForm.append('config',JSON.stringify(config));                                xhr.send(theForm);                            }                        }                    });                }                else{                    config.replace = that.config['data-userAction'] === 'Replace';                    theForm.append('config',JSON.stringify(config));                    xhr.send(theForm);                }            }        },        _getXMLHttpRequest : function() {            var xhr = null;            if (window.XMLHttpRequest || window.ActiveXObject) {                if (window.ActiveXObject) {                    try {                        xhr = new ActiveXObject("Msxml2.XMLHTTP");                    } catch(e) {                        xhr = new ActiveXObject("Microsoft.XMLHTTP");                    }                } else {                    xhr = new XMLHttpRequest();                }            } else {                alert("Your browser does not support the XMLHTTPRequest object...");                return null;            }            return xhr;        },        _confirm : function(title , message , opts){            var that = this,            dialog = $('#waf-confirm-container');            if ($('#waf-confirm-container').length == 0) {                dialog = $('<div>');                dialog.prop('id', 'waf-confirm-container');                dialog.prop('title', title);                dialog.appendTo($('#'+that.id));            }            dialog.empty();            $('<p>' + message + '</p>').appendTo(dialog);            $('#waf-confirm-container').dialog({                width   : 400,                close     : function(event, ui) {                    $(this).dialog('destroy');                },                buttons: [                {                    text: "Replace",                    click: function(){                        opts.yesOption.call();                        $(this).dialog('close');                    }                },                {                    text: "Rename",                    click: function(){                        opts.noOption.call();                        $(this).dialog('close');                    }                },                {                    text: "Cancel",                    click : function(){                        $(this).dialog('close');                    }                }                ]            });        },        _getFULinkedWidgets : function(){            var            widgets,            linkedTags,            tag = this,            classes = tag._private.classes;            if(tag._private.FULinkedWidgets){                return tag._private.FULinkedWidgets;            }            linkedTags  = tag.getLinks();            widgets     = {            };            for (var i = 0, widget; linkedTags && linkedTags.length && i<linkedTags.length ; i++) {                widget = linkedTags[i];                if(!widget){                    continue;                }                var htmlObj = widget.$domNode;                if(htmlObj.hasClass(classes.filesList.classname)){                    widgets.filesList = widget.$domNode;                }                else if(htmlObj.hasClass(classes.btnBrowse)){                    widgets.btnBrowse = widget.$domNode;                }                else if(htmlObj.hasClass(classes.btnUpload)){                    widgets.btnUpload = widget.$domNode;                }                else if(htmlObj.hasClass(classes.btnDelete)){                    widgets.btnDelete = widget.$domNode;                }                else if(htmlObj.hasClass(classes.btnCardinal)){                    widgets.btnCardinal = widget.$domNode;                }            }            return widgets;        },        uploadFiles : function() {        	return this.fileSet.uploadFiles();        },        getFiles : function(){            return this.fileSet.getFiles();        },        setFiles : function(files){            return this.fileSet.setFiles(files);        },        getList : function(){            return this.fileSet.getList();        },        setList : function(list){            this.fileSet.setList(list);        },        removeFile : function(index){            return this.fileSet.removeIndex(index - 1);        },        appendFiles : function(files){            return this.fileSet.appendFiles(files);        },        refreshList : function(){            return this.fileSet.refreshList();        },        removeAll : function(){            return this.fileSet.removeAll();        },        toArray : function(files){            return this.fileSet.toArray(files);        },        getFileUploadText: function(){            return this.config['data-text'];        },        setFileUploadText: function(desc){            this.config['data-text'] = desc;            this._private && this._private.paragraph && this._private.paragraph.html(this.config['data-text']);        },        setNotificationStatus : function(status){            if(status){                this.config['data-notification'] = 'true';            }            else{                this.config['data-notification'] = 'false';            }        },        setFolderName : function(folder){            this.config['data-folder'] = folder;        },        getFolderName : function(){            return this.config['data-folder'];        },        getMaximumFiles : function(){            if(this.config['data-maxfiles'] == '-1'){                return 'unlimited';            }            return this.config['data-maxfiles'];        },        setMaximumFiles : function(max){            var            files   = this.getFiles();            if(isNaN(max)){                throw 'Error: the maximum must be a valid number';            }            this.config['data-maxfiles'] = max;            this.setFiles(files);        },        getMaximumFileSize : function(){            if(this.config['data-maxfilesize'] == '-1'){                return 'unlimited';            }            return this.config['data-maxfilesize'] + ' ' + this.config['data-maxfilesize-unity'];        },        setMaximumFileSize : function(max, unity){            var            files   = this.getFiles();            // if unity is not passed or '' => no change            // Example:	setMaximumFileSize(300, 'kb'); => max 300 kb            // then 	setMaximumFileSize(200) => max 200 Kb            unity = unity ? unity : this.config['data-maxfilesize-unity'];            this.config['data-maxfilesize'] = max;            this.config['data-maxfilesize-unity'] = unity;            this.setFiles(files);        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/navigationView/widget-navigationView.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * TODO: Write a description of this WAF widget     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'navigationView', // TODO: set the widget constructor name in CamelCase (ex: "DataGrid")    {    // Shared private properties and methods    // NOTE: "this" is NOT available in this context to access the current to widget instance    // These methods and properties are available from the constrctor through "shared"    // /**    //  * A Private shared Method    //  *    //  * @/private    //  * @/shared    //  * @/method privateSharedMethod    //  * @/param {String} inWidget    //  **/    // privateSharedMethod: function privateSharedMethod(inWidget) {    //    can work on the widget instance through inWidget    // }    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default TODO: set to the name to this class (ex: WAF.widget.DataGrid)     **/    function WAFWidget(config, data, shared) {        var        containerID = config.id,        $container  = $('#'+containerID),        that        = this,        $header,        childs,        $content,        val,        span,        vIndex,        dataJSON,        viewsList;        this.hasBackButton = false;        that.$container         = $container;        //$content                = $("#"+containerID+"_content");        $content                = $container.find(".waf-navigationView-content"),        that.visibleView        = 1;        that.previousVisible    = [];        childs                  = $content.children(),        dataJSON                = data.views.replace(/\'/gi, "\"");        viewsList               = jQuery.parseJSON(dataJSON);        that.viewsList          = viewsList;        $.each(viewsList, function(idx, val) {            $view =  that.$container.find(".waf-navigation-view"+val.Index);            $header = $container.find(".waf-widget-header");            $view.css({                width: $container.width()+"px",                height: $container.height()+"px"            });            if (idx != 0) {                $view.css("left", "-"+$container.width()+"px");                $view.find("input").prop('disabled', true);                $view.find("select").prop('disabled', true);                $view.find("textarea").prop('disabled', true);            } else {                that.visibleView = val.Index;                $view.find(".waf-navigationView-header-back-button").hide();            }        });        if (WAF.PLATFORM.isTouch) {            $("#"+containerID+" .waf-navigationView-header-back-button").bind("touchend", function(){                waf.widgets[containerID].goToPreviousView();            })        } else {            $("#"+containerID+" .waf-navigationView-header-back-button").bind("click", function(){                waf.widgets[containerID].goToPreviousView();            })        }        var eventHandlerFunction = function(event)        {            var widget = event.data.widget;            var source = event.dataSource;            // PUT THE CODE TO EXECUTE WHEN THE EVENT HAPPENS HERE        }        if ('source' in this) {            /*this.source.addListener("attributeChange", eventHandlerFunction, {                attributeName: this.att.name                }, {                widget:this            });*/        /*            this.source.subscribe(                {                    widget: this,                    id: this.id,                    eventKind: 'attributeChange', // event to listen                    attributeName: this.att.name,                    notify: function notify(inNotifyEvent) {                            // PUT THE CODE TO EXECUTE WHEN THE EVENT HAPPENS HERE                    }                }            );	*/        }    },    {    // [Prototype]    // The public shared properties and methods inherited by all the instances    // NOTE: "this" is available in this context    // These methods and properties are available from the constructor through "this"    // NOTE 2: private properties and methods are not available in this context    /**     * Custom ready function     * @method ready     */    ready : function navigationView_ready(){        var widID = this.id;        $($$(this.id)).bind('widgetResize', function(e, type){            window.setTimeout(function(){                $$(widID).onContainerResize();            }, 100);        });        //force resize & backfaceVisibility value at the end of the process        window.setTimeout(function(){            $$(widID).onContainerResize();            $("#"+widID).get()[0].style.backfaceVisibility = "hidden";        }, 0);    },    onResize: function() {    },    /**    * onContainerResize    *    * @/shared    * @/method onContainerResize    **/    onContainerResize: function onContainerResize() {        var        $container  = this.$container,        val,        left;        //var childs = $("#"+this.id+"_content").children();        var childs = $("#"+this.id+" .waf-navigationView-content").children();        $.each(childs, function(index, view) {            $view =  $(view);            left = parseInt($view.css("left"))            if (left != 0) {                if( left > 0) {                    $view.css("left", $container.width()+"px");                } else {                    $view.css("left", "-"+$container.width()+"px");                }            }            $view.css({           	    width: $container.width()+"px",           	    height: $container.height()+"px"            });        });    },    slideToNextView: function slideToNextView() {    },    onTouchStart: function onTouchStart() {        //this.currentPos    },    /**    * goToView    *    * @param {number} viewIndex index of the view    * @param {string} backButtonLabel allow to override the label of the backbutton    * @/shared    * @/method goToView    **/    goToView: function goToView( viewIndex, backButtonLabel ) {        if (parseInt(this.visibleView) === viewIndex) {            return false;        }        var        containerWidth  = this.$container.width(),        //visibleView     = $("#"+this.id+"_view"+this.visibleView).get()[0],        $visibleView    = this.$container.find(".waf-navigation-view"+this.visibleView),        visibleView     = $visibleView.get()[0],        title,        $elem,        backButton,        transformVis,        transformNew,        tp,        $toDisplay,        toDisplay,        elem,        that;        $visibleView.find("input").prop('disabled', true);        $visibleView.find("select").prop('disabled', true);        $visibleView.find("textarea").prop('disabled', true);        if (viewIndex) {            $elem           = this.$container.find(".waf-navigation-view"+viewIndex);//$("#"+this.id+"_view"+viewIndex);            backButton      = $elem.find(".waf-navigationView-header-back-button");            $elem.get()[0].style.webkitTransition   = '-webkit-transform 0.5s';            visibleView.style.webkitTransition      = '-webkit-transform 0.5s';            if (backButtonLabel) {                backButton.find("span").get()[0].textContent = backButtonLabel;            }            backButton.show();            this.hasBackButton = true;            transformNew = parseInt(getComputedStyle($elem.get()[0], null).webkitTransform.split(",")[4]);            if (transformNew && transformNew !== 0) {                tp = containerWidth+(-transformNew);                $elem.css("left", tp+"px");                $elem.get()[0].style.webkitTransform = 'translateX(-'+tp+'px)';            } else {                $elem.css("left", containerWidth+"px");                $elem.get()[0].style.webkitTransform = 'translateX(-'+containerWidth+'px)';            }            transformVis = parseInt(getComputedStyle(visibleView, null).webkitTransform.split(",")[4]); //$("#"+this.id+"_view"+this.visibleView).get()[0]            if (transformVis) {                tp = containerWidth+(-transformVis);                visibleView.style.webkitTransform = 'translateX(-'+tp+'px)';            } else {                visibleView.style.webkitTransform = 'translateX(-'+containerWidth+'px)';            }            $toDisplay = this.$container.find(".waf-navigation-view"+this.visibleView);//$("#"+this.id+"_view"+this.visibleView);            toDisplay = $toDisplay.get()[0];            elem = $elem.get()[0];            that = this;            window.setTimeout(function(){                elem.style.webkitTransition = '-webkit-transform 0s';                elem.style.webkitTransform = 'none';                $elem.css("left", "0px");                toDisplay.style.webkitTransition = '-webkit-transform 0s';                toDisplay.style.webkitTransform = 'none';                $toDisplay.css("left", -containerWidth+"px");                $elem.find("input").prop('disabled', false);                $elem.find("select").prop('disabled', false);                $elem.find("textarea").prop('disabled', false);            },500);            this.previousVisible.push(this.visibleView);            this.visibleView = viewIndex;        }    },    /**    * goToPreviousView    *    * @/shared    * @/method goToPreviousView    **/    goToPreviousView: function goToPreviousView() {        var        viewToDisplay   = this.previousVisible.pop(),        containerWidth  = this.$container.width(),        $toDisplay      = this.$container.find(".waf-navigation-view"+viewToDisplay),//$("#"+this.id+"_view"+viewToDisplay),        toDisplay       = $toDisplay.get()[0],        $elem           = this.$container.find(".waf-navigation-view"+this.visibleView),//$("#"+this.id+"_view"+this.visibleView),        elem            = $elem.get()[0],        backButton      = $toDisplay.find(".waf-navigationView-header-back-button"),        res             = false,        title,        transformNew,        transformVis,        computedStype,        tp;        if (viewToDisplay) {            $elem.find("input").prop('disabled', true);            $elem.find("select").prop('disabled', true);            $elem.find("textarea").prop('disabled', true);            res = true;            computedStype   = getComputedStyle(toDisplay, null);            transformNew    = parseInt(computedStype.webkitTransform.split(",")[4]);            toDisplay.style.webkitTransition = '-webkit-transform 0.5s';            elem.style.webkitTransition = '-webkit-transform 0.5s';            toDisplay.style.webkitTransform = 'translateX('+containerWidth+'px)';            elem.style.webkitTransform = 'translateX('+containerWidth+'px)';            var that = this;            window.setTimeout(function(){                toDisplay.style.webkitTransition = '-webkit-transform 0s';                toDisplay.style.webkitTransform = 'none';                $toDisplay.css("left", "0px");                elem.style.webkitTransition = '-webkit-transform 0s';                elem.style.webkitTransform = 'none';                $elem.css("left", -containerWidth+"px");                $toDisplay.find("input").prop('disabled', false);                $toDisplay.find("select").prop('disabled', false);                $toDisplay.find("textarea").prop('disabled', false);            }, 600);            this.visibleView = viewToDisplay;            if(  this.previousVisible.length === 0 ) { //viewToDisplay === 1 &&                backButton.hide();                this.hasBackButton = false;            }        }        return res;    },    /**    * goToNextView    *    * @/shared    * @/method goToNextView    **/    goToNextView: function goToNextView() {        var        that            = this,        currentIndex    = null,        viewIndex       = null,        res             = false,        nextIndex;        $.each(that.viewsList, function(idx, val) {            if (val.Index+"" === that.visibleView+"") {                currentIndex = idx;                return false;            }        });        nextIndex = currentIndex + 1;        if (that.viewsList[nextIndex]) {            viewIndex = that.viewsList[nextIndex].Index;            that.goToView(viewIndex);            res = true;        }        return res;    }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/navigationView/widget-navigationView-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    /**    *  Widget Descriptor    *    */    /* PROPERTIES */    // {String} internal name of the widget    type        : 'navigationView',    // {String} library used ('waf', 'jquery', 'extjs', 'yui') (optional)    lib         : 'WAF',    // {String} display name of the widget in the GUI Designer    description : 'Navigation View',    // {String} category in which the widget is displayed in the GUI Designer    category    : 'Containers/Placeholders',    // {String} image of the tag to display in the GUI Designer (optional)    img         : '/walib/WAF/widget/navigationView/icons/widget-navigationView.png',    // {Array} css file needed by widget (optional)    css         : [],    // {Array} script files needed by widget (optional)    include     : [],    // {String} type of the html tag ('div' by default)    tag         : 'div',    // {Array} attributes of the widget. By default, we have 3 attributes: 'data-type', 'data-lib', and 'id', so it is unnecessary to add them    //    // @property {String} name, name of the attribute (mandatory)    // @property {String} description, description of the attribute (optional)    // @property {String} defaultValue, default value of the attribute (optional)    // @property {'string'|'radio'|'checkbox'|'textarea'|'dropdown'|'integer'} type, type of the field to show in the GUI Designer (optional)    // @property {Array} options, list of values to choose for the field shown in the GUI Designer (optional)    attributes  : [    {        name            : 'data-theme',        visibility      : 'hidden',        defaultValue    : 'cupertino'    },    {        name        : '',        description : '',        defaultValue: '',        type        : '',        options     : []    },    {        name         : 'data-title',        defaultValue : '',        description  : 'Title'    },    {          name         : 'data-views',          description  : 'Views',          type         : 'grid',          defaultValue : "[{'Description':'New View', 'Index':'1'}]",          //defaultValue : "[]",          reloadOnChange  : true,          displayEmpty    : true, // if false grid is hidden if empty          newRowEmpty     : false,          columns      : [              {                  name  : 'Description',                  type  : 'textField'              },              {                  name  : 'Index',                  type  : 'textField',                  disabled : true              }          ],          onRowClick : function(data) {            var            index         = data.getIndex(),            tag           = this.getData().tag,            widID         = tag.getId(),            viewIndex     = data._items[1].getValue(),            viewTag       = Designer.tag.getTagById($("#"+widID).find(".waf-navigation-view"+viewIndex).prop("id")),            views         = tag.getAttribute("data-views"),            viewsValue    = JSON.parse(views.getValue().replace(/'/g, '"')),            viewID,            tags,            theID;            $('#waform-form-gridmanager-views-grid tr').removeClass('waform-state-selected');            tag._selectedRow = index;            $('#waform-form-gridmanager-views-grid tr[data-position=' + index + ']').addClass('waform-state-selected');            tags = $("#"+widID).find(".waf-navigation-view"+viewIndex);            $.each(tags, function(i, v) {                if (v.id.split("-")[3] != "deleted") {                    Designer.tag.getTagById(v.id).show();                }            });            $.each(viewsValue, function(index, value) {                tags = $("#"+widID).find(".waf-navigation-view"+value.Index);                $.each(tags, function(i, v) {                    theID = $(v).prop("id");                    if (theID.split("-")[3] != "deleted") {                        viewID = theID;                    }                });                //viewID = $("#"+widID).find(".waf-navigation-view"+value.Index).prop("id");                if (viewID.split("-")[3] != "deleted" && value.Index != viewIndex) {                    Designer.tag.getTagById(viewID).hide();                }            });          },          beforeRowAdd : function(data) {          },          afterRowAdd : function(data) {            var            tag     = this.getData().tag,            widID   = tag.getId(),            action;            Designer.beginUserAction('072');            action = new Designer.action.AddNavigationView({               val      : '0',               oldVal   : '1',               tagId    : this.id,               data      : {                    widgetId: widID,                    widgetData: data               }            });            Designer.getHistory().add(action);            this.data.tag.addNewView( data );          },          beforeRowDelete : function(data) {            var            tag     = this.getData().tag,            widID   = tag.getId(),            action;            Designer.beginUserAction('073');            action = new Designer.action.deleteNavigationView({                val      : '0',                oldVal   : '1',                tagId    : this.id,                data      : {                    widgetId: widID,                    widgetData: data                }            });            Designer.getHistory().add(action);          },          afterRowDelete : function(data) {            this.data.tag.deleteView( data );          },          ready       : function() {                var                tag         = this.getData().tag;                if (tag._selectedRow === null) {                } else {                    window.setTimeout(function(){ $('#waform-form-gridmanager-views-grid tr[data-position=' + tag._selectedRow + ']').addClass('waform-state-selected'); }, 0);                }            }      }    ],    // {Array} default height and width of the container for the widget in the GUI Designer    //    // @property {String} name, name of the attribute    // @property {String} defaultValue, default value of the attribute    style: [    {        name        : 'width',        defaultValue: '40px'    },    {        name        : 'height',        defaultValue: '40px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    // {JSON} panel properties widget    //    // @property {Object} enable style settings in the Styles panel in the Properties area in the GUI Designer    properties: {        style: {            theme       : true,                 // false to not display the "Theme" option in the "Theme & Class" section            //    theme : {            //    	roundy: false		//all the default themes are displayed by default. Pass an array with the            //   }				//themes to hide ('default', 'inherited', roundy, metal, light)            fClass      : true,                 // true to display the "Class" option in the "Theme & Class" section            text        : true,                 // true to display the "Text" section            background  : true,                 // true to display widget "Background" section            border      : true,                 // true to display widget "Border" section            sizePosition: true,                 // true to display widget "Size and Position" section            label       : true,                 // true to display widget "Label Text" and "Label Size and Position" sections            // For these two sections, you must also define the "data-label" in the Attributes array            disabled     : ['border-radius']     // list of styles settings to disable for this widget        }    },	structure: [        {            description : 'header',            selector    : '.waf-navigationView-header',            style: {                background  : true,                gradient    : true,                border      : true,				text        : true,				textShadow  : true            }        },        {            description : 'content',            selector    : '.waf-navigationView-view',            style: {                background  : true,                gradient    : true            }        },        {            description : 'footer',            selector    : '.waf-navigationView-footer',            style: {                background  : true,                gradient    : true,                border      : true,				text        : true,				textShadow  : true            }        }    ],    /* METHODS */    /*    * function to call when the widget is loaded by WAF during runtime    *    * @param {Object} config contains all the attributes of the widget    * @result {WAF.widget.Template} the widget    */    onInit: function (config) {        var widget = new WAF.widget.navigationView(config);        return widget;    },    /**    * function to call when the widget is displayed in the GUI Designer    *    * @param {Object} config contains all the attributes for the widget    * @param {Designer.api} set of functions used to be managed by the GUI Designer    * @param {Designer.tag.Tag} container of the widget in the GUI Designer    * @param {Object} catalog of dataClasses defined for the widget    * @param {Boolean} isResize is a resize call for the widget (not currently available for custom widgets)    */    onDesign: function (config, designer, tag, catalog, isResize) {        if(tag.previousID){            if (tag.previousID != config.id) {                tag.previousID = config.id;                var newID = config.id;                 /**                 * allow to set a widget as current widgets (select)                 * @method selectWidget                 * @param {string} widID : widget's id                 */                 tag.selectWidget  = null;                tag.selectWidget = function() {                    window.setTimeout(function(){                        var tag = Designer.tag.getTagById(newID);                        tag.setCurrent();                        Designer.tag.refreshPanels();                    }, 0);                }            }        }         /*         * Apply theme on widget theme's change         */        tag.onChangeTheme = function(theme) {            var            group;            group = D.getGroup(this.getGroupId());            if (group) {                group.applyTheme(theme, this);            }        }         /*if (tag.addBackButton) {             tag.addBackButton();         }*/    },    /**     * call the first time in order to build the widget     * @param {Designer.tag.Tag} container of the widget in the GUI Designer     */    onCreate: function ( wid, param ) {        $(wid).bind("onReady", function(){            this.fix();            this.resizeHandles = 'none';            var linkedWidget = this.getLinks();            $.each(linkedWidget, function(index, value) {                value.fix();                value.resizeHandles = 'none';            });        });        wid.previousID = wid.getId();        if (!wid.addNewView) {            wid.selectFromOutline = function(view) {                var widget      = wid,                    viewIndex,                    widID       = widget.getId(),                    viewTag     = view,                    views       = widget.getAttribute("data-views"),                    viewsValue  = JSON.parse(views.getValue().replace(/'/g, '"')),                    classes     = $("#"+view.getId()).get()[0].className.split(" "),                    that        = this,                    sp,                    viewID,                    theID,                    index,                    tags;                $.each(classes, function(index, value) {                    sp = value.split("waf-navigation-view");                    if (sp[1] != undefined) {                        that.index = parseInt(sp[1]);                        return false;                    }                });                viewIndex = this.index;                tags = $("#"+widID).find(".waf-navigation-view"+viewIndex);                $.each(tags, function(i, v) {                    if (v.id.split("-")[3] != "deleted") {                        Designer.tag.getTagById(v.id).show();                    }                });                $.each(viewsValue, function(index, value) {                    tags = $("#"+widID).find(".waf-navigation-view"+value.Index);                    $.each(tags, function(i, v) {                        theID = $(v).prop("id");                        if (theID.split("-")[3] != "deleted") {                            viewID = theID;                        }                    });                    if (viewID.split("-")[3] != "deleted" && value.Index != viewIndex) {                        Designer.tag.getTagById(viewID).hide();                    }                    if (parseInt(value.Index) === viewIndex) {                        widget._selectedRow = index;                    }                });                wid.selectWidget(view.getId());            }           /**            * build a new view into the widget            * @method addNewView            * @param {object} data : data-views            */            wid.addNewView = function(data) {                var                wid             = this,                view,                views           = wid.getAttribute("data-views"),                viewsValue      = JSON.parse(views.getValue().replace(/'/g, '"')),                viewIndex       = 1,                group           = Designer.getGroup(wid.getGroupId()),                containerDef    = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('container')),                titleDef        = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('richText')),                buttonDef       = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('button')),                widID           = wid.getId(),                body,                title,                header,                titleDef,                backButton,                indexArray,                viewID;                /*                * just compare 2 values                */                function compare(a,b) {                    return a-b;                }                if (wid._selectedRow != null) {                    $('#waform-form-gridmanager-views-grid tr').removeClass('waform-state-selected');                    //$('#waform-form-gridmanager-views-grid tr[data-position=' + wid._selectedRow + ']').removeClass('waform-state-selected');                    $.each(viewsValue, function(index, value) {                        if (index ===  wid._selectedRow) {                            viewID = $("#"+widID).find(".waf-navigation-view"+value.Index).prop("id");                            if (viewID.split("-")[3] != "deleted") {                                Designer.tag.getTagById(viewID).hide();                            }                        }                     });                }                wid._selectedRow = viewsValue.length;                $('#waform-form-gridmanager-views-grid tr[data-position=' + wid._selectedRow + ']').addClass('waform-state-selected');                //find available index to use                indexArray = [];                $.each(viewsValue, function(index, value) {                    indexArray.push(parseInt(value["Index"]));                });                indexArray.sort(compare);                //set index value                if (data) {                    $.each(indexArray, function(idx, val) {                        if (val === viewIndex) {                            viewIndex++;                        }                    });                    data.items[1].setValue(viewIndex);                }                // view                view = new Designer.tag.Tag(containerDef);                view.create({                    id         : D.tag.getNewId("view"),					width      : wid.getWidth(),					height     : wid.getHeight(),					silentMode : true                });                view._linkedWidget = wid//._content;                view.setXY( 0, 0, true );                view.addClass('waf-navigationView-view waf-navigation-view'+viewIndex); //                view.setParent( wid.getChildren()[0] ); //wid._content                view.forceTopConstraint();                view.forceBottomConstraint();                view.forceLeftConstraint();                view.forceRightConstraint();                view.setPositionBottom( "0px", false, false );                view.setPositionRight( "0px", false, false );                group.add(view);                wid.link(view);                wid.resizeHandles = 'none';                $("#"+view.getId()).click(                    function(e){                        if (!e.altKey) {                            event.stopPropagation();                            event.preventDefault();                            wid.selectWidget(widID);                        }                    }                );                //lock the widget                view.fix();                //header                header  = new Designer.tag.Tag(containerDef);                header.create({                    id         : D.tag.getNewId("header"),					width      : wid.getWidth(),					height     : "44px",					silentMode : true                });                header._linkedWidget = view;                header.setXY( 0, 0, true );                header.addClass('waf-navigationView-header waf-widget-header'); //                header.setParent( view );                header.forceTopConstraint();                header.forceRightConstraint();                header.forceLeftConstraint();                header.setPositionRight( "0px", false, false );                group.add(header);                wid.link(header);                header.resizeHandles = 'none';                $("#"+header.getId()).click(                   function(e){                        if (!e.altKey) {                            event.stopPropagation();                            event.preventDefault();                            wid.selectWidget(widID);                        }                   }                );                //lock the widget                header.fix();                //title                title = new Designer.tag.Tag(titleDef);                title.create({                    id         : D.tag.getNewId("title"),					width      : wid.getWidth(),					height     : "44px",					silentMode : true                });                title.getAttribute("data-text").setValue("View "+viewIndex);                title.getAttribute("data-autoWidth").setValue("false");                title.setXY( 0, 0, true );                title.addClass('waf-navigationView-title');                title.setParent( header );                title.forceTopConstraint();                title.forceRightConstraint();                title.forceLeftConstraint();                title.forceBottomConstraint();                group.add(title);                wid.link(title);                title.resizeHandles = 'none';                //lock the widget                title.fix();                //back button                backButton = new Designer.tag.Tag(buttonDef);                backButton.create({                id      : D.tag.getNewId("back-button"),                width   : "50px",                height  : "29px",                silentMode : true                });                backButton.getAttribute("data-text").setValue("Back");                backButton.addClass('waf-navigationView-header-back-button');                backButton.setXY( 20, 7, true );                backButton.setParent( header );                backButton.resizeHandles = 'none';                //content of the view                body  = new Designer.tag.Tag(containerDef);                body.create({                    id         : D.tag.getNewId("body"),                    width      : wid.getWidth(),                    height     : wid.getHeight(),                    silentMode : true                });                body._linkedWidget = view;                body.setXY( 0, 44, true );                body.addClass('waf-widget-body waf-navigationView-body');                body.setParent( view );                body.forceRightConstraint();                body.forceLeftConstraint();                body.forceBottomConstraint();                body.setPositionBottom( "0px", false, false );                group.add(body);                wid.link(body);                body.resizeHandles = 'none';                $("#"+body.getId()).click(                   function(e) {                        if (!e.altKey) {                            event.stopPropagation();                            event.preventDefault();                            wid.selectWidget(widID);                        }                   }                );                //lock the widget                body.fix();                /*                * Apply theme                */                group.applyTheme(wid.getTheme(), wid);                Designer.ui.group.save();                $.each(viewsValue, function(index, value) {                    viewID = $("#"+widID).find(".waf-navigation-view"+value.Index).prop("id");                    if (viewID.split("-")[3] != "deleted") {                        if (value.Index != viewIndex) {                            Designer.tag.getTagById(viewID).hide();                        } else {                            Designer.tag.getTagById(viewID).show();                        }                    }                });            };            /**             * remove a view from the widget             * @method deleteView             * @param {object} data : data-views             */            wid.deleteView = function(data) {                /*var                tag     = this.getData().tag,                widID   = tag.getId(),                action;*/                var                wid             = this,                widID           = wid.getId(),                viewIndexToRm   = data.items[1].getValue(),                viewID,          //= $("#"+widID).find(".waf-navigation-view"+viewIndexToRm).prop("id"),                tag,             //= Designer.tag.getTagById(viewID),                newIndex,                views,                viewsValue,                tags;                tags = $("#"+widID).find(".waf-navigation-view"+viewIndexToRm);                $.each(tags, function(i, v) {                    theID = $(v).prop("id");                    if (theID.split("-")[3] != "deleted") {                        viewID = theID;                    }                });                tag = Designer.tag.getTagById(viewID);                Designer.tag.deleteWidgets(tag, true, true);                $("#"+viewID).parent().parent().remove();                Designer.tag.setCurrent(wid);                Designer.tag.refreshPanels();                wid.setResizable(true);                views       = wid.getAttribute("data-views");                viewsValue  = JSON.parse(views.getValue().replace(/'/g, '"'));                if (!viewsValue[data.index]) {                    newIndex = data.index-1;                } else {                    newIndex = data.index;                }                newIndex = parseInt(newIndex);                if (newIndex != undefined && newIndex >= 0 ) {                    viewTag = Designer.tag.getTagById($("#"+widID).find(".waf-navigation-view"+viewsValue[newIndex].Index).prop("id"));                    tag._selectedRow    = newIndex;                    $('#waform-form-gridmanager-views-grid tr[data-position=' + newIndex + ']').addClass('waform-state-selected');                    viewTag.show();                }            };            /**             * allow to set a widget as current widgets (select)             * @method selectWidget             * @param {string} widID : widget's id             */            wid.selectWidget = function(widID) {                window.setTimeout(function(){                    var tag = Designer.tag.getTagById(widID);                    tag.setCurrent();                    Designer.tag.refreshPanels();                }, 0);            }        }        var htmlObj = wid.getHtmlObject();        /**         * add back button markup to all views         * @method addBackButton         */        /*wid.addBackButton = function() {          var views = JSON.parse(wid.getAttribute("data-views").getValue().replace(/'/g, '"'));          var widID = wid.getId();          var $header;          $.each(views, function(index, value) {              if (index != 0) {                  $header = $("#"+widID+"_header"+value.Index +" .bd");                  $header.append('<div class="waf-navigationView-header-back-button"><span>Back</span></div>');              }          });        }*/        /*        * Create structure if no init has been done else apply events        */        if (!param._isLoaded) { //!wid.getAttribute("data-initDone")            $(wid).bind("onWidgetDrop", function(){                this.setXY( 0, 0, true, true );            });            wid.setPositionRight( "0px", false, false );            wid.setPositionBottom( "0px", false, false );            wid.forceTopConstraint();            wid.forceLeftConstraint();            wid.forceBottomConstraint();            wid.forceRightConstraint();            wid.setXY( 0, 0, true, true );            wid.updateZindex (0);            //wid.addAttribute("data-initDone");            //wid.getAttribute("data-initDone").setValue("true");            createStructure();        } else {            window.setTimeout(function(){                var views   = JSON.parse(wid.getAttribute("data-views").getValue().replace(/'/g, '"')),                    widID   = wid.getId(),                    $wid    = $("#"+widID);                $.each(views, function(i, value) {                    Designer.tag.getTagById($wid.find(".waf-navigation-view"+value.Index).attr("id"))._linkedWidget = wid;                    $wid.find(".waf-navigationView-view").click(                         function(e){                            if (!e.altKey) {                                event.stopPropagation();                                event.preventDefault();                                wid.selectWidget(widID);                            }                         }                    );                    $wid.find(".waf-widget-header").click(                           function(e){                                if (!e.altKey) {                                    event.stopPropagation();                                    event.preventDefault();                                    wid.selectWidget(widID);                                }                           }                    );                    $wid.find(".waf-navigationView-body").click(                           function(e){                                if (!e.altKey) {                                    event.stopPropagation();                                    event.preventDefault();                                    wid.selectWidget(widID);                                }                           }                      );                });                $wid.find(".waf-navigationView-content").click(                     function(e){                        if (!e.altKey) {                            event.stopPropagation();                            event.preventDefault();                            wid.selectWidget(widID);                        }                     }                );                $wid.find(".waf-widget-footer").click(                     function(e){                        if (!e.altKey) {                            event.stopPropagation();                            event.preventDefault();                            wid.selectWidget(widID);                        }                     }                );            /*            * Select first views            */            wid._selectedRow = 0;            var elem;            var done = false;            $.each(views, function(index, value) {                //elem =  $wid.find(".view"+value.Index);                 //if (elem.length != 0) {                if (done) {                    Designer.tag.getTagById($("#"+widID).find(".waf-navigation-view"+value.Index).prop("id")).hide();                } else {                    done = true;                }                 //}            });            /*elem = $wid.find(".view1");            if (elem.length != 0) {                Designer.tag.getTagById(elem.prop("id"));            }*/            //wid.addBackButton();            },0);        }       /**        * build main widget structure        * @method createStructure        */        function createStructure () {            var            containerDef    = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('container')),            container       = new Designer.tag.Tag(containerDef),            header,            content,            footer,            group,            widID = wid.getId();            wid.resizeHandles = 'none';            //the group            if (param.group) {                wid.group = param.group;            } else {                wid.group = new Designer.ui.group.Group();            }            group = wid.group;            group.add(wid);            //content            content = new Designer.tag.Tag(containerDef);            content.create({                id         : D.tag.getNewId("view-manager"),                width      : wid.getWidth(),                height     : "418px",                silentMode : true            });            //content._linkedWidget = container;            content.setXY( 0, 0, true );            content.addClass('waf-navigationView-content');            content.setParent( wid );//container            content.forceTopConstraint();            content.forceBottomConstraint();            content.forceLeftConstraint();            content.forceRightConstraint();            content.setPositionBottom( "44px", true, false );            content.setPositionRight( "0px", false, false );            group.add(content);            wid.link(content);            content.resizeHandles = 'none';            $("#"+content.getId()).click(                 function(e){                    if (!e.altKey) {                        event.stopPropagation();                        event.preventDefault();                        wid.selectWidget(widID);                    }                 }            );            //lock the widget            content.fix();            wid._content = content;            //footer            footer       = new Designer.tag.Tag(containerDef);            footer.create({               id           : D.tag.getNewId("footer"),               width        : wid.getWidth(),               height       : "47px",               silentMode   : true            });            //footer._linkedWidget = container;            footer.setXY( 0, 416, true );            footer.addClass('waf-widget-footer waf-navigationView-footer');            footer.setParent( wid ); //container            footer.forceBottomConstraint();            footer.forceRightConstraint();            footer.removeTopConstraint();            footer.setPositionBottom( "0px", true, false );            group.add(footer);            wid.link(footer);            footer.resizeHandles = 'none';            //lock the widget            footer.fix();            $("#"+footer.getId()).click(                 function(e){                    if (!e.altKey) {                        event.stopPropagation();                        event.preventDefault();                        wid.selectWidget(widID);                    }                 }            );            Designer.ui.group.save();            window.setTimeout(function(){                wid.addNewView();            }, 0);       };    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/tabview/widget-tabview.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     * TODO: Write a description of this WAF widget     *     * @extends WAF.Widget     */    'TabView',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default TODO: set to the name to this class (ex: WAF.widget.DataGrid)     **/    function WAFWidget(config, data, shared) {        this.padding = data.padding ? parseInt(data.padding) : 5;        /*         * Add orientation class         */        this.$domNode.addClass('waf-tabView-menu-position-' + data['menu-position'].replace(/\s+/g, '-'));        this._position = data['menu-position'];        switch(this._position) {            case 'top left':            case 'top right':            case 'bottom left':            case 'bottom right':                this._display = 'horizontal';                break;            case 'left top':            case 'right top':            case 'left bottom':            case 'right bottom':                this._display = 'vertical';                break;        }        this._closableTabs = !data['closable-tabs'] || data['closable-tabs'] == 'false' ? false : true;    },{        _menuBar            : null,        _closableTabs       : false,        _containers         : [],        _componentsLoaded   : {},        _menuItemLastWidth  : 0,        _menuItemLastHeight : 0,        _closeButtonMarge   : 10,        _selected           : null,        _position           : null,        _tabWidth           : null,        _tabSelectedWidth   : null,        _tabHeight          : null,        _tabSelectedHeight  : null,        /**         * Executed when the widget is ready         * @method ready         */        ready : function tabview_ready () {            var            tabView,            menuBar,            menuItems,            containers,            closeButton;            tabView     = this;            menuBar     = this._getMenuBar();            if (menuBar) {                containers  = this._getContainers();                menuItems   = menuBar.getMenuItems();                /*                 * Default select the first tab                 */                tabView.selectTab(1);                /*                 * Add onclick function on menu items                 */                $.each(menuItems, function(i){                    /*                     * Select the correct tab on menu item click                     */                    this.onClick = function () {                        tabView.selectTab(this.$domNode.parent().find('li').index(this.$domNode) + 1);                    }                    this.$domNode.addClass('waf-tabView-tab');					if (this.getWidth(true) > tabView._menuItemLastWidth) {						tabView._menuItemLastWidth = this.getWidth(true);					}                    tabView._menuItemLastHeight = this.getHeight();                    /*                     * Add close button                     */                    if (tabView._closableTabs) {                        tabView._addCloseButton(this);                    }                });                /*                 * Add resizable cosntraints                 */                this.$domNode.resizable( "option", "minWidth", menuBar.$domNode.width() + (this.padding * 2) + 2);                this.$domNode.resizable( "option", "minHeight", menuBar.$domNode.height());                /*                 * Add resizable cosntraints                 */                if (WAF.PLATFORM.modulesString === "mobile") {                    if (this._display === 'horizontal') {                        this.$domNode.find(".waf-tabView-menuBar").css("width", "100% !important");                    } else {                        //wait for onResize event to work !!                        //this.$domNode.find(".waf-tabView-menuBar").css("height", this.$domNode.height()+"px !important");                    }                }            }        },        /**         * Add a close button on the menu item         * @method _addCloseButton         * @param {object} menuItem         */        _addCloseButton : function tabview_addCloseButton (menuItem) {            var            marge,            closeButton;            marge = this._closeButtonMarge;            /*             * Append close button             */            closeButton = $('<button>');            closeButton                .addClass('waf-tabView-closeButton')                .css('top', (menuItem.getHeight()/2) - 4 +'px')                .bind('click', {menuItem : menuItem, tabView : this}, function(e){                    e.data.tabView.removeTab(e.data.menuItem.getIndex() + 1);                });            menuItem.$domNode                .append(closeButton);            /*             * Resize menu items width             */            menuItem.setWidth(menuItem.getWidth() + marge);        },        /**         * Select a tabview tab         * @method selectTab         * @param {number} index : index of the tab to select         */        selectTab : function tabview_select_tab (index) {            var            i,            tabView,            menuItem,            menuItems,            container,            menuItemsL,            containerChildren,            selectedMenuItem;            tabView = this;            /*             * Hide existing date picker             */            $('.hasDatepicker').datepicker('hide');            $.each(this._getContainers(), function(i){                if (i != (index - 1)) {                    this.hide('visibility');                    $("#"+this.id).css("zIndex", -1);                } else {                    this.show();                    $("#"+this.id).css("zIndex", 1);                }            });            /*             * Add active state on menu item             */            menuItems   = this._getMenuBar().getMenuItems();            menuItemsL  = menuItems.length;            /*             * Remove state on other             */            if (WAF.PLATFORM.modulesString === "mobile") {                for (i = 0; i < menuItemsL; i += 1) {                    menuItem = menuItems[i];                    if (i == (index-1)) {                        menuItem.$domNode                            .addClass('waf-state-selected')                        selectedMenuItem = menuItem;                    } else {                        menuItem.$domNode                            .removeClass('waf-state-selected')                    }                }            } else {                var                menuItemWidth,                menuItemHeight;                for (i = 0; i < menuItemsL; i += 1) {                    menuItem        = menuItems[i];                    menuItemWidth   = menuItem.$domNode.outerWidth();                    menuItemHeight  = menuItem.$domNode.outerHeight();                    if (!tabView._tabSelectedHeight)    tabView._tabSelectedHeight  = menuItemHeight + 1;                    if (!tabView._tabHeight)            tabView._tabHeight          = menuItemHeight;                    if (!tabView._tabSelectedWidth)     tabView._tabSelectedWidth   = menuItemWidth + 1;                    if (!tabView._tabWidth)             tabView._tabWidth           = menuItemWidth;                    if (i == (index-1)) {                        menuItem.$domNode                            .addClass('waf-state-selected')                            if (tabView._display == 'horizontal') {                                menuItem.$domNode.css('height', tabView._tabSelectedHeight + 'px');                            } else {                                menuItem.$domNode.css('width', tabView._tabSelectedWidth + 'px');                            }                            if (tabView._position == 'bottom right' || tabView._position == 'bottom left') {                                menuItem.$domNode.css('top', '-1px');                            }                            if (tabView._position == 'right top' || tabView._position == 'right bottom') {                                menuItem.$domNode.css('left', '-1px');                            }                        selectedMenuItem = menuItem;                    } else {                        menuItem.$domNode                            .removeClass('waf-state-selected')                            if (tabView._display == 'horizontal') {                                menuItem.$domNode.css('height', tabView._tabHeight + 'px');                            } else {                                menuItem.$domNode.css('width', tabView._tabWidth + 'px');                            }                            if (tabView._position == 'bottom right' || tabView._position == 'bottom left') {                                menuItem.$domNode.css('top', '0px');                            }                            if (tabView._position == 'right top' || tabView._position == 'right bottom') {                                menuItem.$domNode.css('left', '0px');                            }                    }                }            }            /*             * If children is a component => load it             */            container           = this.getContainer(index);            containerChildren   = container.getChildren();            $.each(containerChildren, function() {                if (this.kind == 'component' && !tabView._componentsLoaded[this.id]) {                    tabView._componentsLoaded[this.id] = true;                    this.loadComponent();                }            });            this._selected = index;            if (this.onSelect) {                this.onSelect(index, selectedMenuItem, container);            }        },        /**         * Get the menuBar linked widget of the tabview         * @method _getMenuBar         */        _getMenuBar : function tabview_get_menu_bar () {            var            menuBar;            if (!this._menuBar) {                $.each(this.getLinks(), function(){                    if (this.kind == 'menuBar') {                        menuBar = this;                    }                });                this._menuBar = menuBar;            } else {                menuBar = this._menuBar;            }            return menuBar;        },        /**         * Get the containers linked widgets of the tabview         * @method _getContainers         */        _getContainers : function tabview_get_containers () {            var            i,            j,            k,            that,            link,            item,            links,            itemsL,            linksL,            result,            itemLinks,            itemLinksL;            that    = this;            result  = [];            if (this._containers.length == 0) {                links   = this.getLinks();                linksL  = links.length;                for (i = 0; i < linksL; i += 1) {                    link = links[i];                    if (link && link.kind == 'menuBar') {                        items   = link.getMenuItems();                        itemsL  = items.length;                        for (j = 0; j < itemsL; j += 1) {                            item        = items[j];                            itemLinks   = item.getLinks();                            itemLinksL  = itemLinks.length;                            for (k = 0; k < itemLinksL; k += 1) {                                if (itemLinks[k].kind == 'container') {                                    result.push(itemLinks[k]);                                    break;                                }                            }                        }                        break;                    }                };                this._containers = result;            } else {                result = this._containers;            }            return result;        },        /**         * Get a specific container of the tabview         * @method getContainer         * @param {number} index : index of the tab to select         * @return {object} container         */        getContainer : function tabview_get_container (index) {            var            result;            if (this._containers) {                result = this._containers[index - 1];            }            return result;        },        /**         * Resize method called during resize         * @method onResize         */        onResize : function tabview_resize() {            $.each(this.getLinks(), function(){                if (this.onResize) {                    this.onResize();                }            });        },        /**         * Add a tab         * @method addTab         * @param {string} label : label of the new tab         */        addTab : function tabview_add_tab(label, closable) {            var tabs,				tabLi,				tabId,				calcul,				tabCss,				newSize,				tabView,				menuBar,				tabWidth,				menuItem,				tabHeight,				tabWidget,				containers,				totalWidth,				totalHeight,				containerId,				menuBarWidth,				containerDiv,				menuBarHeight,				menuBarMargin,				containerInfo,				containerWidget;            tabView         = this;            menuBar         = this._getMenuBar();            containerId     = WAF.Widget._generateId('container');            tabId           = WAF.Widget._generateId('menuItem');            menuBarMargin   = parseInt(menuBar.config['data-tab-margin']);            containers      = this.$domNode.children('.waf-container');            tabs            = menuBar.$domNode.children('.waf-menuItem');            index           = containers.length + 1;            tabWidth        = tabs.outerWidth();            tabHeight       = menuBar.$domNode.height();            tabCss          = {};            totalWidth      = 0;            totalHeight     = 0;            $.each(tabs, function(i){                var                that;                that = $(this);                totalWidth   += that.outerWidth();                totalHeight  += that.outerHeight();                if (i != tabs.length - 1) {                   totalWidth  += menuBarMargin;                   totalHeight += menuBarMargin;                }            });            /*             * Get containers size and position             */            containerInfo   = {                left    : containers.css('left'),                top     : containers.css('top'),                bottom  : containers.css('bottom'),                right   : containers.css('right')            }            /*             * Create tab             */            tabLi = $('<li id="' + tabId + '" data-type="menuItem" data-lib="WAF"/>');			// last child isn't the last one anymore since we add a new one: remove the class to stay coherent			// and to prevent the use of hacks in width calculation			//			menuBar.$domNode.find('.waf-menuItem:last-child').removeClass('waf-menuItem-last');            if (tabView._display == 'horizontal') {                tabCss['margin-left']   = 0;	//parseInt($(tabs[tabs.length-1]).css('margin-right')) == 0 ? menuBarMargin + 'px' : '0px';                tabHeight               = menuBar.$domNode.height();                tabWidth                = this._menuItemLastWidth;                /*                 * resize menuBar                 */                if (closable) {                    tabWidth += tabView._closeButtonMarge;                }                menuBarWidth    = menuBar.getWidth();                calcul          = (totalWidth + tabWidth + menuBarMargin);                if (calcul >= menuBarWidth) {                    menuBar.setWidth(calcul);                }            } else {                tabCss['margin-top']    = parseInt($(tabs[tabs.length-1]).css('margin-bottom')) == 0 ? menuBarMargin + 'px' : '0px';                tabWidth                = menuBar.$domNode.width();                tabHeight               = tabs._menuItemLastHeight;                /*                 * resize menuBar                 */                menuBarHeight  = menuBar.getHeight() + tabHeight + menuBarMargin;                menuBar.setHeight(menuBarHeight);            }            tabCss.width    = tabView._menuItemLastWidth + 'px';            tabCss.height   = tabView._menuItemLastHeight + 'px';            tabLi.css(tabCss);            tabLi.prop('class', tabs.prop('class').replace(/waf-state-active|waf-menuItem-first/g, 'waf-menuItem-last'));			// TODO: menuItems added by the designer have a <div class="waf-richText..."> instead of this <p/>			//		 there should be only one menuItem type...            tabLi.html('<p class="waf-menuItem-text waf-menuItem-icon-top" style="height:20px;width:90px">' + label + '</p>')            tabLi.appendTo(menuBar.$domNode);			menuItem = new WAF.widget.MenuItem({id: tabId});            /*             * Add close button             */            if (closable) {                tabView._addCloseButton(menuItem);            }            tabWidget = $$(tabId);            /*             * Add tabview select function on click event             */            tabWidget.onClick = function () {                tabView.selectTab(this.$domNode.parent().find('li').index(this.$domNode) + 1);            }            /*             * Create Container             */            containerDiv = $('<div id="' + containerId + '" data-type="container" data-lib="WAF" data-constraint-top="true" data-constraint-right="true" data-constraint-left="true" data-constraint-bottom="true" >');            containerDiv.css({                bottom      : containerInfo.bottom,                right       : containerInfo.right,                left        : containerInfo.left,                top         : containerInfo.top,                position    : 'absolute'            });            containerDiv.prop('class', containers.prop('class'));            containerDiv.appendTo(this.$domNode);            new WAF.widget.Container({id: containerId});            containerWidget = $$(containerId);            containerWidget.hide('visibility');            this._containers.push(containerWidget);            /*             * Link widget each other             */            this.link(containerWidget);            tabWidget.link(containerWidget);            containerWidget.link(tabWidget);            /*             * Resize tabview             */            if (tabView._display == 'horizontal') {                newSize = menuBar.getWidth() + menuBarMargin + this.padding;                if (newSize > tabView.getWidth()) {                    tabView.setWidth(newSize);                }            } else {                newSize = menuBar.getHeight() + menuBarMargin + this.padding;                if (newSize > tabView.getHeight()) {                    tabView.setHeight(newSize);                }            }            /*             * Update resizable limit             */            this.$domNode.resizable( "option", "minWidth", menuBar.$domNode.width() + (this.padding * 2) + 2);            this.$domNode.resizable( "option", "minHeight", menuBar.$domNode.height());            /*             * Select the new tab             */            this.selectTab(this.countTabs());        },        /**         * Remove a tab         * @method removeTab         * @param {number} index : index of the tab to remove         */        removeTab : function tabview_remove_tab(index) {            var            i,            tab,            tabs,            links,            menuBar,            newLink,            tabLinks,            newLinks,            toSelect,            newLinksL,            container,            menuItem1,            menuItem2,            iToSelect,            containers;            index      -= 1;            menuBar     = this._getMenuBar();            tabs        = this._getMenuBar().getChildren();            tab         = tabs[index];            tabLinks    = tab.getLinks();            for (i = 0; i < tabLinks.length; i += 1) {                if (tabLinks[i].kind == "container") {                    container = tabLinks[i];                }            }            iToSelect   = this.getSelectedTab().index;            if (iToSelect == tabs.length) {                toSelect = iToSelect - 1;            } else {                toSelect = iToSelect;            }            /*             * Prevent last menu item delete             */            if (tabs.length == 1) {                return false;            }            /*             * Call custom before remove function             */            if(this.beforeRemove) {                this.beforeRemove((index + 1), tab, container);            }            /*             * Destroy tab             */            tab.destroy();            /*             * Destroy container             */            if (container) {                container.destroy();            }            /*             * Remove reference from attribute             */            links       = [];            containers  = [];            newLinks    = this.getLinks();            newLinksL   = newLinks.length;            for (i = 0; i < newLinksL; i += 1) {                newLink =  newLinks[i];                links.push(newLink.id);                if (this.kind == 'container') {                    containers.push(containers);                }            }            this._containers = containers;            this.$domNode.data('linked-tag', links.join(','));            this.selectTab(toSelect);            menuItem1 = menuBar.getMenuItem(index-1);            menuItem2 = menuBar.getMenuItem(index);            if (menuItem1 && menuItem2) {                if (parseInt(menuItem1.$domNode.css('margin-right'), 10) !== 0 && parseInt(menuItem2.$domNode.css('margin-left'), 10) !== 0) {                    menuItem2.$domNode.css('margin-left', 0);                }            } else if (!menuItem1 && menuItem2) {                menuItem2.$domNode.css('margin-left', 0);            }        },        /**         * Get the number of tabs         * @metod counTabs         * @return {number} number of tabs         */        countTabs : function tabview_count_tabs(){            return this._getContainers().length;        },        /**         * Get the selected tab and container         * @method getSelected         * @return {object} : index, tab, container         */        getSelectedTab : function tabview_get_selected(){            return {                index       : this._selected,                menuItem    : this._getMenuBar().getMenuItems()[this._selected-1],                container   : this.getContainer(this._selected)            }        },        /**         * Get the selected container         * @method getSelectedContainer         * @return {object} container         */        getTabContainer : function tabview_get_selected_container(){            return this.getSelectedTab().container;        },        _tmpVisible : [],        /**         * Custom hide function         * @method hide         * @param {string} type         */        hide : function tabview_hide ( type ) {            var            i,            link,            links,            linksLength;            this._tmpVisible = [];            if (type && type == 'visibility') {                links = this.getLinks();                linksLength = links.length;                for (i = 0; i < linksLength; i += 1) {                    link = links[i];                    if (link.$domNode.css('visibility') == 'visible') {                        link.hide('visibility');                        this._tmpVisible.push(link);                    }                }            }            /*             * Call super class disable function             */            WAF.Widget.prototype.hide.call(this);        },        /**         * Custom show function         * @method hide         */        show : function tabview_show () {            var            i,            link,            linksLength;            linksLength = this._tmpVisible.length;            for (i = 0; i < linksLength; i += 1) {                link = this._tmpVisible[i];                link.show();            }            /*             * Call super class disable function             */            WAF.Widget.prototype.show.call(this);        },        /**         * Custom disable function (disable sub widgets)         * @method disable         * @param {number} index : tab to disable (optional)         */        disable : function tabview_disable(index) {            var            i,            children,            menuItem,            container,            childrenLength;            /*             * If index, disable selected tab             */            if (index) {                container = this.getContainer(index);                if (container) {                    menuItem = container.getLinks()[0];                    container.disable();                    menuItem.disable();                }            } else {                children = this.getChildren();                childrenLength = children.length;                /*                 * Disable all sub widgets                 */                for (i = 0; i < childrenLength; i += 1) {                    children[i].disable();                }                /*                 * Call super class disable function                 */                WAF.Widget.prototype.disable.call(this);            }        },        /**         * Custom enable function (enable sub widgets)         * @method enable         * @param {number} index : tab to enable (optional)         */        enable : function tabview_enable(index) {            var            i,            children,            menuItem,            container,            childrenLength;            /*             * If index, disable selected tab             */            if (index) {                container = this.getContainer(index);                if (container) {                    menuItem = container.getLinks()[0];                    container.enable();                    menuItem.enable();                }            } else {                children = this.getChildren();                childrenLength = children.length;                /*                 * Enable all sub widgets                 */                for (i = 0; i < childrenLength; i += 1) {                    children[i].enable();                }                /*                 * Call super class enable function                 */                WAF.Widget.prototype.enable.call(this);            }        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/tabview/widget-tabview-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'tabView',    lib         : 'WAF',    description : 'Tab View',    category    : 'Containers/Placeholders',    img         : '/walib/WAF/widget/tabview/icons/widget-tabview.png',    tag         : 'div',    containArea : true,    attributes  : [    {        name        : 'class',        description : 'Css class'    },    {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox',        platform    : 'desktop'    },    {        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox',        platform    : 'desktop'    },    {        name        : 'data-padding',        description : 'Padding',        defaultValue        : function() {            var result;            if (typeof D != "undefined") {                if (D.isMobile) {                    result = "0";                } else {                    result = "5";                }                return result;            }        }.call(),        typeValue   : 'integer',        slider      : {            min : 0,            max : 50        },        reloadTag   : true    },    {        name        : 'data-menu-position',        description : 'Tab Position',        type        : 'combobox',        options     : [{            key     : 'top left',            value   : 'Top Left'        },{            key     : 'top right',            value   : 'Top Right'        },{            key     : 'bottom left',            value   : 'Bottom Left'        },{            key     : 'bottom right',            value   : 'Bottom Right'        },{            key     : 'left top',            value   : 'Left Top'        },{            key     : 'left bottom',            value   : 'Left Bottom'        },{            key     : 'right top',            value   : 'Right Top'        },{            key     : 'right bottom',            value   : 'Right Bottom'        }],        defaultValue: 'top left',        reloadTag   : true,        saveHistory : false,        beforechange : function() {            var            tag;            tag = this.data.tag;            tag._oldMenuPos = tag.getAttribute('data-menu-position').getValue();        },        onchange    :function(data){            var            tag,            value;            tag     = this.data.tag;            value   = this.getValue();            var action = new Designer.action.setTabMenuPosition({                    val         : "0",                    oldVal      : "1",                    tagId       : tag.id,                    data        : {                        oldPos  : tag._oldMenuPos,                        newPos  : value                    }            });            Designer.getHistory().add(action);            Designer.disableHistory();            tag.setMenuPosition(value);            Designer.enableHistory();        }    },    {        name        : 'data-tabs',        description : 'Tabs',        type        : 'grid',        domAttribute: false,        columns     : [],        onRowClick  : function( item ) {            var            tag,            index;            tag             = this.getData().tag;            index           = item.getIndex();            tag._currentTab = index;            tag.select(index);        },        afterRowAdd : function(data) {            var            tag,            label,            newItem;            tag     = this.getData().tag;            newItem = tag.addTab();            menu    = tag.getMenuBar();            label   = data.items[0];            label.data = {                tab : newItem,                menu : menu            };            label.setValue('[Tab ' + (newItem.getLastIndex()) + ']');        },        afterRowDelete : function(data) {            var            i,            menuBar,            menuItem,            menuItems,            menuItemsL;            menuItem    = data.items[0].data.tab;            menuBar     = menuItem.getParent();            /*             * Delete menu item             */            D.tag.deleteWidgets(menuItem, false);        },        afterRowSort : function(data) {            var            tag;            tag     = this.data.tag;            menu    = tag.getMenuBar();            /*             * Call menubar sort function             */            menu.sort(data.movedIndex, data.index);        },        ready       : function() {            var            i,            j,            tag,            linkedTag,            linkedTags,            linkedTagsL,            menuItem,            menuItems,            menuItemsL;            this.getHtmlObject().addClass('waf-form-tab-grid');            tag         = this.getData().tag;            linkedTags  = tag.getLinks();            linkedTagsL = linkedTags.length;            for (i = 0; i < linkedTagsL; i += 1) {                linkedTag = linkedTags[i];                if (linkedTag.isMenuBar()) {                    menuItems   = linkedTag.getItems();                    menuItemsL  = menuItems.length;                    for (j = 0; j < menuItemsL; j += 1) {                        menuItem = menuItems[j];                        this.addRow([{                            type        : 'label',                            html        : menuItem.getText(),                            data        : {                                tab     : menuItem,                                menu    : linkedTag,                                index   : j                            }                        }], false, true, false);                    }                    break;                }            }            /*             * Select the current row             */            this.getHtmlObject().find('tr[data-position=' + tag._currentTab + ']').addClass('waform-state-selected');        }    },    {        name        : 'data-closable-tabs',        description : 'Closable Tabs',        type        : 'checkbox'    }],    style: [    {        name        : 'width',        defaultValue: '500px'    },    {        name        : 'height',        defaultValue: '500px'    }],    events: [],    properties: {        style: {            theme       : {                'roundy'    : false            },            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            dropShadow  : true,            innerShadow : true,            label       : false        }    },    structure: [],    menu : [{        icon        : '/walib/WAF/widget/menubar/icons/round_plus.png',        title       : 'Add a tab',        callback    : function(){            var            menuBar,            labelText,            menuItems,            nbMenuItems,            parentPadding,            itemWidth;            if (WAF.PLATFORM.modulesString === "touch") {                parentPadding = "5";                itemWidth = "55";            } else {                parentPadding = "0";                itemWidth = "66";            }            menuBar = this.getMenuBar();            /*             * Get the number of submenu to format menu item text             */            menuItems   = menuBar.getItems();            nbMenuItems = menuItems.length + 1;            this.addTab();            /*             * Refresh property panel             */            Designer.tag.refreshPanels();        }    }],    onInit: function (config) {        return new WAF.widget.TabView(config);    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        i,        top,        info,        left,        group,        right,        index,        width,        height,        calcul,        bottom,        menuBar,        menuInfo,        tagTheme,        linkedTag,        menuItems,        menuItemsL,        tabPadding,        linkedTags,        menuBarWidth,        menuBarHeight,        containersInfo,        linkedTagsLength,        menuItemsL,        menuItems,        totalWidth = 0,        totalHeight = 0,        orientation;        tabPadding  = parseInt(tag.getAttribute('data-padding').getValue());        /*         * Resize menu and container         */        if (isResize) {            linkedTags          = tag.getLinks();            linkedTagsLength    = linkedTags.length;            calcul              = tabPadding*2;            /*             * Prevent resize if new size is smaller than menubar             */            menuBar     = tag.getMenuBar();            menuItems   = menuBar.getItems();            menuItemsL  = menuItems.length;            orientation = menuBar.getOrientation();            for (i = 0; i < menuItemsL; i += 1) {                totalWidth += menuItems[i].getWidth();                totalHeight += menuItems[i].getHeight();            }            if (WAF.PLATFORM.modulesString == "touch") {                if (orientation == "vertical") {                    menuBar.setHeight(totalHeight, false);                } else {                    menuBar.setWidth(totalWidth, false);                }            }            menuBarWidth    = menuBar.getWidth() + calcul;            info            = tag.getLinksInfo();            menuInfo        = info.menuBar;            containersInfo  = info.containers;            if (tag.getWidth() < menuBarWidth) {                tag.setWidth(menuBarWidth);            }            D.env._preventResize = true;            for (i = 0; i < linkedTagsLength; i += 1) {                linkedTag   = linkedTags[i];                /*                 * Resize container height & width                 */                if (linkedTag.isContainer()) {                    if (/top|bottom/.test(info.orientation[0])) {                        height = tag.getHeight() - menuInfo.height - calcul;                        linkedTag.setHeight(height);                        //console.log(tag.getHeight() , menuInfo.height, calcul, '=', height)                        linkedTag.setWidth(tag.getWidth() - calcul);                    } else {                        width = tag.getWidth() - menuInfo.width - calcul;                        linkedTag.setWidth(width);                        linkedTag.setHeight(tag.getHeight() - calcul);                    }                    top     = typeof(containersInfo.top)    != 'undefined' ? containersInfo.top     : null;                    left    = typeof(containersInfo.left)   != 'undefined' ? containersInfo.left    : null;                    right   = typeof(containersInfo.right)  != 'undefined' ? containersInfo.right   : null;                    bottom  = typeof(containersInfo.bottom) != 'undefined' ? containersInfo.bottom  : null;                } else {                    top     = typeof(menuInfo.top)          != 'undefined' ? menuInfo.top           : null;                    left    = typeof(menuInfo.left)         != 'undefined' ? menuInfo.left          : null;                    right   = typeof(menuInfo.right)        != 'undefined' ? menuInfo.right         : null;                    bottom  = typeof(menuInfo.bottom)       != 'undefined' ? menuInfo.bottom        : null;                }                linkedTag.savePosition('left', left, false, false);                linkedTag.savePosition('right', right, false, false);                linkedTag.savePosition('top', top, false, false);                linkedTag.savePosition('bottom', bottom, false, false);            }            D.env._preventResize = null;            tag._resizeMenuBarTouch(menuBar, info);        }    },    onCreate : function (tag, param) {        var        i,        menu,        group,        jQTag,        menuPos,        menuBar,        container,        menuItem,        menuItems,        linkedTag,        linkedTags,        menuItemsL,        tabPadding,        menuItemTag,        linkedTagsLength,        tabHeight,        parentPadding,        itemWidth;        tag._lastIndex = 0;        if (WAF.PLATFORM.modulesString === "touch") {            parentPadding   = "5";            itemWidth       = "55";        } else {            parentPadding   = "0";            itemWidth       = "66";        }        tabPadding  = tag.getAttribute('data-padding').getValue();        menuPos     = tag.getAttribute('data-menu-position').getValue();        jQTag       = $(tag);        tag._resizeMenuBarTouch = function tabview_resize_menubar_touch (menuBar, info) {            var            info,            menuBar,            orientation,            containersInfo;            /*             * call again getValue because of a wrong value (to double check)             */            if (WAF.PLATFORM.modulesString == "touch") {                menuBar         = menuBar   || this.getMenuBar();                info            = info      || this.getLinksInfo();                menuInfo        = info.menuBar;                containersInfo  = info.containers;                orientation     = menuBar.getOrientation();                if (orientation == "vertical") {                    menuBar.setHeight(containersInfo.height, false);                } else {                    menuBar.setWidth(containersInfo.width, false);                }            }        }        /**         * Display one of the tab of the tabview widget         * @method select         * @param {number} index : index of the tab to display         */        tag.select = function tabview_select (index) {            var            i,            tab,            link,            width,            height,            menuBar,            menuItem,            menuItems,            linkedTags,            menuItemsL,            menuBarPos,            borderSize,            menuItemCss,            linkedTagsLength,            menuItemCssSelected;            linkedTags          = this.getLinks();            linkedTagsLength    = linkedTags.length;            menuBar             = this.getMenuBar();            menuBarPos          = this.getAttribute('data-menu-position').getValue().split(' ')[0];            if (!menuBar) {                return;            }            menuItems           = menuBar.getItems();            tab                 = this.getTab(index);            /*             * Hide other containers             */            for (i = 1; i < linkedTagsLength; i += 1) {                link = linkedTags[i];                if (link != tab.container) {                    link.hide();                }            }            if (!tab.container) {                return;            }            borderSize          = tab.container.getComputedStyle('border-width');            /*             * Display current container             */            tab.container.show();            menuItemCss         = {                top             : 'auto',                right           : 'auto',                bottom          : 'auto',                left            : 'auto'            };            if (WAF.PLATFORM.modulesString === "touch") {                menuItemCssSelected = menuItemCss;            } else {                switch (menuBarPos) {                    case 'top':                        height = menuBar.getHeight();                        menuItemCssSelected = $.extend({}, menuItemCss, {                            height          : height + 1 + 'px',                            top             : '0px'                        });                        menuItemCss.height = height + 'px';                    break;                    case 'right':                        width = menuBar.getWidth();                        menuItemCssSelected = $.extend({}, menuItemCss, {                            width           : width + 1 + 'px',                            left            : '-' + borderSize                        });                        menuItemCss.width = width + 'px';                    break;                    case 'bottom':                        height = menuBar.getHeight();                        menuItemCssSelected = $.extend({}, menuItemCss, {                            height          : height + 1 + 'px',                            top             : '-' + borderSize                        });                        menuItemCss.height = height + 'px';                    break;                    case 'left':                        width = menuBar.getWidth();                        menuItemCssSelected = $.extend({}, menuItemCss, {                            width           : width + 1 + 'px',                            left            : '0px'                        });                        menuItemCss.width = width + 'px';                    break;                }            }            /*             * Add state class on current widget             */            menuItemsL = menuItems.length;            for (i = 0; i < menuItemsL; i += 1) {                menuItem = menuItems[i];                if (i == index) {                    menuItem.getHtmlObject()                        .addClass('waf-state-selected')                        .css(menuItemCssSelected);                    if (WAF.PLATFORM.modulesString === "touch") {                        // DO NOTHING                    } else {                        if (menuBarPos == 'top' || menuBarPos == 'bottom') {                            menuItem._additionalHeight = parseInt(borderSize);                        }                        if (menuBarPos == 'left' || menuBarPos == 'right') {                            menuItem._additionalWidth = parseInt(borderSize);                        }                    }                } else {                    menuItem.getHtmlObject()                        .removeClass('waf-state-selected')                        .css(menuItemCss);                    menuItem._additionalHeight = null;                    menuItem._additionalWidth = null;                }            }            tag._currentTab = index;            /*             * Display current tab into the form properties             */            $('#waform-form-gridmanager-tabs-grid tr[data-position!=' + index + ']').removeClass('waform-state-selected');            $('#waform-form-gridmanager-tabs-grid tr[data-position=' + index + ']').addClass('waform-state-selected');        }        /**         * Get active tab container         * @method getActiveContainer         * @return {object} active container         */        tag.getActiveContainer = function tabview_get_active_container() {            return tag.getTab(tag._currentTab).container;        }        /**         * Get tab widgets         * @method getTab         * @param {number} index : index of the tab to display         * @return {object} widgets         */        tag.getTab = function tabview_get_tab (index) {            var            i,            link,            menuBar,            menuItem,            menuItems,            container,            linkedTags,            tabMenuItem,            tabContainer,            linkedTagsLength,            containerLinkegTags;            menuBar     = this.getMenuBar();            menuItems   = menuBar.getItems();            menuItem    = menuItems[index];            if (menuItem) {                linkedTags          = menuItem.getLinks();                linkedTagsLength    = linkedTags.length;                for (i = 0; i < linkedTagsLength; i += 1) {                    link = linkedTags[i];                    if (link.getType() == 'container') {                        container = link;                        break;                    }                }            }            return {                container   : container,                menuItem    : menuItem            }        }        /**         * Add a new tab on the tabview widget         * @method addTab         */        tag.addTab = function tabview_add_tab (params) {            var            newItem,            menuBar;            menuBar = this.getMenuBar();            newItem = menuBar.addMenuItem({                width           : itemWidth,                parentPadding   : parentPadding,                currentIndex    : this._currentTab,                focusOnMenu     : false            });            this.select(newItem.getIndex());            this._lastIndex += 1;            return newItem;        }        /**         * Get the menubar of the tabview widget         * @method getMenuBar         * return {object} menubar         */        tag.getMenuBar = function tabview_get_menubar() {            var            i,            widget,            menuBar,            linkedTags,            linkedTagsL;            linkedTags  = tag.getLinks();            linkedTagsL = linkedTags.length;            for (i = 0; i < linkedTagsL; i += 1) {                widget = linkedTags[i];                if (widget.isMenuBar()) {                    menuBar = widget;                    break;                }            }            return menuBar;        }        tag.getLinksInfo = function (position, changeOrientation) {            var            pos,            menu,            calcul,            position,            tabBorder,            container,            menuWidth,            menuHeight,            htmlObject,            tabPadding;            container   = {};            menu        = {};            tag         = this;            menuBar     = tag.getMenuBar();            tabPadding  = parseInt(tag.getAttribute('data-padding').getValue());            tabBorder   = parseInt(tag.getComputedStyle('border-width'));            position    = position || tag.getAttribute('data-menu-position').getValue();            pos         = position.split(' ');            htmlObject  = this.getHtmlObject();            calcul      = ((tabPadding * 2) + tabBorder);            menuHeight  = menuBar.getHeight();            switch(pos[0]) {                case 'left':                    menu.height      = menuHeight;                    menu.top         = tabPadding;                    menu.left        = tabPadding;                    container.top    = tabPadding;                    menu.width       = menuBar.getWidth();                    container.width  = tag.getWidth() -  menu.width - calcul;                    container.height = tag.getHeight() - calcul;                    container.left   =  menu.width + tabPadding - tabBorder;                    /*                     * Resize tabview                     */                    menuHeight = menuBar.getHeight();                    if (menuHeight > container.height) {                        tag.setHeight(menuHeight + calcul);                        container.height = menuHeight;                    }                    break;                case 'right':                    menu.height      = menuHeight;                    menu.top         = tabPadding;                    container.top    = tabPadding;                    menu.width       = menuBar.getWidth();                    container.width  = tag.getWidth() -  menu.width - calcul;                    menu.left        = tabPadding + container.width;                    container.height = tag.getHeight() - calcul;                    container.left   = tabPadding;                    /*                     * Resize tabview                     */                    menuHeight = menuBar.getHeight();                    if (menuHeight > container.height) {                        tag.setHeight(menuHeight + calcul);                        container.height = menuHeight;                    }                    break;                case 'bottom':                    menu.height         = menuHeight;                    container.height    = tag.getHeight() - menu.height - calcul;                    container.width     = tag.getWidth() - calcul;                    menu.top            = tabPadding + container.height;                    container.top       = tabPadding;                    /*                     * Resize tabview                     */                    menuWidth = menuBar.getWidth();                    if (menuWidth > container.width) {                        tag.setWidth(menuWidth + calcul);                        container.width = menuWidth;                    }                    break;                case 'top':                    menu.height         = menuHeight;                    menu.top            = tabPadding;                    container.top       = menu.height + tabPadding;                    container.height    = tag.getHeight() - menu.height - calcul;                    container.width     = tag.getWidth() - calcul;                    /*                     * Resize tabview                     */                    menuWidth = menuBar.getWidth();                    if (menuWidth > container.width) {                        tag.setWidth(menuWidth + calcul);                        container.width = menuWidth;                    }                    break;            }            // Setting classes            htmlObject                .removeClass('waf-tabView-menu-position-top-left waf-tabView-menu-position-top-right waf-tabView-menu-position-right-top waf-tabView-menu-position-right-bottom waf-tabView-menu-position-bottom-right waf-tabView-menu-position-bottom-left waf-tabView-menu-position-left-bottom waf-tabView-menu-position-left-top')                .addClass('waf-tabView-menu-position-' + pos.join('-'));            menuBar.getHtmlObject()                .removeClass('waf-tabView-menuBar-top-left waf-tabView-menuBar-top-right waf-tabView-menuBar-right-top waf-tabView-menuBar-right-bottom waf-tabView-menuBar-bottom-right waf-tabView-menuBar-bottom-left waf-tabView-menuBar-left-bottom waf-tabView-menuBar-left-top')                .addClass('waf-tabView-menuBar-' + pos.join('-'));            switch(pos[1]) {                case 'left':                    menu.left       = tabPadding;                    container.left  = tabPadding;                    break;                case 'right':                    menu.right      = tabPadding                    container.right = tabPadding;                    break;                case 'bottom':                    menu.bottom      = tabPadding;                    menu.top         = null;                    container.bottom = tabPadding;                    container.top    = null;                    break;                case 'top':                    menu.top        = tabPadding                    container.top   = tabPadding;                    break;            }            return {                menuBar     : menu,                containers  : container,                orientation : [pos[0], pos[1]]            }        }        /**         * Display the tabview menu into a defined position         * @method setMenuPosition         * @param {string} position         */        tag.setMenuPosition = function tabview_set_menu_position(position) {            var            info,            links,            widget,            menuBar,            menuInfo,            linksLength,            containersInfo;            menuBar = this.getMenuBar();            switch (position) {                case 'top left':                case 'top right':                case 'bottom left':                case 'bottom right':                    this.getMenuBar().changeOrientation('horizontal');                    break;                case 'left top':                case 'left bottom':                case 'right top':                case 'right bottom':                    this.getMenuBar().changeOrientation('vertical');                    break;            }            info            = this.getLinksInfo(position);            menuInfo        = info.menuBar;            containersInfo  = info.containers;            menuBar.savePosition('top', menuInfo.top);            menuBar.savePosition('bottom', menuInfo.bottom);            if (menuInfo.right) {                menuBar.setFitToLeft(false);                menuBar.setFitToRight(true);                menuBar.savePosition('right', menuInfo.right);                menuBar.savePosition('left', null);            } else {                menuBar.setFitToLeft(true);                menuBar.setFitToRight(false);                menuBar.savePosition('left', menuInfo.left);                menuBar.savePosition('right', null);            }            links       = tag.getLinks();            linksLength = links.length;            for (i = 1; i < linksLength; i += 1) {                widget = links[i];                widget.savePosition('top', containersInfo.top);                widget.savePosition('bottom', containersInfo.bottom);                if (containersInfo.width) {                    widget.setWidth(containersInfo.width);                }                if (containersInfo.height) {                    widget.setHeight(containersInfo.height);                }                if (containersInfo.left) {                    widget.savePosition('left', containersInfo.left);                }            }            this.select(this._currentTab);        }        /*         * Apply theme on widget theme's change         */        tag.onChangeTheme = function(theme) {            var            group;            group = D.getGroup(this.getGroupId());            if (group) {                group.applyTheme(theme, this);            }        }        /**         * Set component start on load         * @method _containerDropFn         * @param {object} tag : tab to be drop over the container         */        tag._containerDropFn = function(component){            /*             * If drop a component widget over the tab             * resize component to the container size             */            if (component.isComponent()) {                /*                 * Unchek component load on startup                 */                component.getAttribute('data-start-load').setValue('false');                D.tag.refreshPanels();            }        }        /**         * Destroy a linked component and focus on next tab         * @method containerAfterDestroy         */        tag._containerAfterDestroy = function() {            var            links,            tabView,            linkItem;            tabView     = this.getParent();            links       = this.getLinks();            if (tabView.status != 'destroy') {                if (links.length > 0) {                    linkItem    = links[0];                    D.tag.deleteWidgets(linkItem);                }                /*                 * delete tabview if no more tab                 */                if (tabView.getMenuBar().getItems().length == 0) {                    D.tag.deleteWidgets(tabView);                } else {                    /*                     * Focus on next tab                     */                    tabView.select(0);                    /*                     * Set tabview as current and refresh panels                     */                    tabView.setCurrent();                    tabView.setResizable(true);                    D.tag.refreshPanels();                }            }        }        /**         * Destroy a linked component and focus on next tab         * @method _menuItemAfterDestroy         */        tag._menuItemAfterDestroy = function() {            var            linkItem;            linkItem    = this.getLinks()[0];            if (linkItem) {                linkItem.remove();            }        }        /**         * Sub widget click function         * @method _subWidgetsClickFn         */        tag._subWidgetsClickFn = function() {            var            tabView;            tabView = this.getParent();            if (D.getCurrent() != tabView) {                tabView.setCurrent();                D.tag.refreshPanels();            }            return false;        }        tag._menuResizeFn = function() {            var            tabView;            tabView = this.getParent();            if (tabView.status != 'destroy') {                tabView.onDesign(true);            }        }        tag._containerResize = function (e, paramSize) {            var            i,            link,            links,            linksL,            tabView;            if (D.env._preventResize  == true) {                return;            }            tabView = this.getParent();            /*             * Also resize other containers             */            if (tabView.status != 'destroy') {                links   = tabView.getLinks();                linksL  = links.length;                D.env._preventResize = true;                tabView.onDesign(true);                D.env._preventResize = null;            }        }        if (!param._isLoaded) {            var            item,            group,            jQMenu;            Designer.env.enableModificationNotification = false;            /*             * Create a group             */            group = new Designer.ui.group.Group();            group.add(tag);            tabHeight = 23;            if (D.isMobile) {                tabHeight = 49;            }            /*             * Create a menuBar             */            menu = Designer.createTag({                type        : 'menuBar',                height      : tabHeight,                width       : 200,                left        : tabPadding,                top         : tabPadding,                silentMode  : true,                parent      : tag,                attr        : {                    'data-tab-margin' : '5'                },                data        : {                    noItems     : true,                    itemsWidth  : 66,                    optimize    : false                }            });            jQMenu = $(menu);            jQMenu.bind('afterAddItem', tag._config.afterAddTab);            menu.updateZindex(3);            menu.getAttribute('class').setValue('waf-tabView-menuBar waf-tabView-menuBar-' + tag.getAttribute('data-menu-position').getValue().replace(/\s+/g, '-'));            /*             * Disable sub menus             */            menu._subMenu = false;            group.add(menu);            /*             * Save the group             */            Designer.ui.group.save();            /*             * Force focus on tabview and refresh panels             */            tag.setCurrent();            D.tag.refreshPanels();            /*             * Add menu and container to the linked widgets list             */            tag.link(menu);            menu.link(tag);            /*             * Auto create 3 menu items             */            for (i = 0; i < 3; i += 1) {                item = menu.addMenuItem({                    menuBarInit     : true,                    width           : itemWidth,                    parentPadding   : parentPadding,                    optimize        : false                });            }            tag.select(0);            D.tag.refreshPanels();            jQMenu                .on('onResize', tag._menuResizeFn);            Designer.env.enableModificationNotification = true;            D.studio.setDirty();            tag._resizeMenuBarTouch();        } else {            /*             * Execute script when widget is entirely loaded (with linked tags)             */            jQTag                .on('onReady', function(){                    /*                     * Disable domUpdate                     */                    D.tag.preventDomUpdate();                    var                    i,                    menu,                    that,                    group,                    groupId,                    newGroup,                    menuItem,                    menuItems,                    container,                    jQMenuItem,                    menuItemsL,                    linkedTags,                    menuItemTag,                    linkedTagsL;                    that        = this;                    linkedTags  = this.getLinks();                    linkedTagsL = linkedTags.length;                    menu        = linkedTags[0];                    menuItems   = menu.getItems();                    menuItemsL  = menuItems.length;                    groupId     = tag.getGroupId();                    newGroup    = false;                    $(menu).bind("afterAddItem", this._config.afterAddTab);                    /*                     * Disable sub menus                     */                    menu._subMenu = false;                    /*                     * Add containers functions                     */                    for (i = 1; i < linkedTagsL; i += 1) {                        container           = linkedTags[i];                        container.onDrop    = this._containerDropFn;                        /*                         * Force constraints (retrocompatibility)                         */                        container.setFitToLeft(true);                        container.setFitToTop(true);                        container.setFitToRight(true);                        container.setFitToBottom(true);                        /*                         * Also destroy linked menu item                         */                        $(container)                            .bind('onWidgetDestroy', this._containerAfterDestroy)                            .bind('onResize', tag._containerResize);                    }                    for (i = 0; i < menuItemsL; i += 1) {                        menuItem    = menuItems[i];                        jQMenuItem  = $(menuItem);                        /*                         * Also destroy container on menu item destroy                         */                        jQMenuItem.bind('onWidgetDestroy', this._menuItemAfterDestroy);                        /*                         * Display container linked to the menu item                         */                        jQMenuItem.bind('onWidgetFocus', {tag: tag}, function (e, type) {                            e.data.tag.select(this.getIndex());                        })                    }                    $(menu).bind('onResize', this._menuResizeFn);                    menu.getHtmlObject()                        .removeClass('waf-tabView-menuBar-top-left waf-tabView-menuBar-top-right waf-tabView-menuBar-bottom-right waf-tabView-menuBar-bottom-left')                        .addClass('waf-tabView-menuBar-' + this.getAttribute('data-menu-position').getValue().replace(/\s+/g, '-'));                    /*                     * Default display the first tab                     */                    $(menuItem).bind('onReady', {tab : this}, function (e) {                        e.data.tab.select(0);                    });                    /*                     * Enable domUpdate                     */                    D.tag.preventDomUpdate(false);                });        }        /*         * Add position class on widget         */        tag.getHtmlObject().addClass('waf-tabView-menu-position-' + tag.getAttribute('data-menu-position').getValue().replace(/\s+/g, '-'));    },    afterAddItem : function(){    },    /**     * Executed after a new menu item has been created     * @method afterAddTab     * @param {object} e     * @param {object} menuBar     * @param {object} menuItem     */    afterAddTab : function(e, menuItem, silentMode) {        var        i,        tag,        info,        group,        widget,        itemTag,        groupId,        tabBorder,        padCalcul,        container,        tabPadding,        linkedTags,        jQMenuItem,        linkedTagsL,        jQContainer,        menuBarWidth,        tabViewWidth,        containersInfo;        tag             = this.getParent();        groupId         = tag.getGroupId();        group           = Designer.getGroup(groupId);        menuBarWidth    = this.getWidth();        tabViewWidth    = tag.getWidth();        tabPadding      = parseInt(tag.getAttribute('data-padding').getValue());        tabBorder       = parseInt(tag.getComputedStyle('border-width'));        padCalcul       = (tabPadding*2) +  tabBorder;        info            = tag.getLinksInfo();        containersInfo  = info.containers;        /*         * Check the size of the bar then resize tabview widget         */        if ((menuBarWidth + padCalcul) > (tabViewWidth)) {            tag.setWidth(menuBarWidth + padCalcul);            /*             * Also resize containers             */            linkedTags  = tag.getLinks();            linkedTagsL = linkedTags.length;            for (i = 0; i < linkedTagsL; i += 1) {                widget = linkedTags[i];                if (widget.isContainer()) {                    if (/top|bottom/.test(info.orientation[0])) {                        widget.setWidth(menuBarWidth);                    }                }            }            tabViewWidth = menuBarWidth + padCalcul;        }        /*         * Create a container for each new menu item         */        container = Designer.createTag({            type        : 'container',            width       : menuBarWidth > containersInfo.width ? menuBarWidth : containersInfo.width,            height      : containersInfo.height,            fit         : ['left', 'top', 'right', 'bottom'],            top         : containersInfo.top,            left        : containersInfo.left,            silentMode  : true,            parent      : tag        });        jQContainer = $(container);        container.addClass("waf-tabView-container-level-0");        group.add(container);        jQContainer            .on('onReady', {item: menuItem, tabView: tag}, function(e, data) {                /*                 * Force link on tabview widgets after redo                 */                if (data.from == 'redo') {                    e.data.item.link(this);                    this.link(e.data.item);                    e.data.tabView.link(this);                }            })            .on('onWidgetDestroy', tag._containerAfterDestroy)            .on('onResize', tag._containerResize);        /*         * Save the group         */        Designer.ui.group.save();        tag.link(container);        container.link(menuItem);        menuItem.link(container);        container.onDrop    = tag._containerDropFn;        jQMenuItem          = $(menuItem);        /*         * Display container linked to the menu item         */        jQMenuItem.bind('onWidgetFocus', {tag: tag}, function (e, type) {            var            index;            index = this.getIndex() || 0;            e.data.tag.select(index);        });        /*         * Also destroy container on menu item destroy         */        jQMenuItem.bind('onWidgetDestroy', tag._menuItemAfterDestroy);        if (!silentMode) {            tag.select(itemTag._menuIndex);        }        /*         * Apply theme         */        group.applyTheme(tag.getTheme(), tag);        /*         * To fix bug on items classes & widget focus         */        $(container)            .on('onReady', {menuBar : this, tabView: tag}, function(e, data) {                if (data.from == 'redo') {                    /*                     * Reset menubar items classes                     */                    if (Designer.action._redoMenuItem) {                        e.data.menuBar._setClasses();                        /*                         * Force select on redo tab                         */                        index = this.getLinks()[0].getIndex();                        e.data.tabView.select(index);                    }                    /*                     * Set tabview as current element                     */                    e.data.tabView.setCurrent();                    D.tag.refreshPanels();                    Designer.action._redoMenuItem = false;                }            })    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/dialog/widget-dialog.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'Dialog',    {        classes : {            titlebar    : {                classname   : 'waf-widget-header waf-dialog-header',                subwidgets  : {                    iconimage   : 'waf-dialog-header-icon',                    title       : 'waf-dialog-header-title',                    buttons     : 'waf-dialog-header-buttons',                    close       : 'waf-dialog-header-close',                    minimize    : 'waf-dialog-header-minimize',                    maximize    : 'waf-dialog-header-maximize'                }            },            content     : {                classname   : 'waf-widget-body waf-dialog-body'            },            toolbar     : {                classname   : 'waf-widget-footer waf-dialog-footer'            }        },        minimizedInfo : {            height          : 28,            width           : 165,            'margin-top'    : 10,            'margin-left'   : 10        },        minimizePosition : [],        refreshMinimized : function(parent){            var            shared,            minInfo,            position,            dialogSet;            shared      = this;            dialogSet   = parent.children('.waf-dialog.minimized');            //            dialogSet   = dialogSet.reverse();            minInfo     = shared.minimizedInfo;            position    = {                bottom  : minInfo['margin-top'],                left    : minInfo['margin-left']            };            $.each(dialogSet, function(){                var                widget,                htmlObj;                widget  = $$($(this).prop('id'));                htmlObj = widget.$domNode;                htmlObj.css({                    bottom  : position.bottom,                    left    : position.left                });                if(position.left + minInfo.width > parent.width()){                    position.left   =  minInfo['margin-left'];                    position.bottom += minInfo.height + minInfo['margin-top'];                }                else{                    position.left +=  minInfo.width + minInfo['margin-left'];                }            })        },        /**          * A Private shared Method          *          * @/private          * @/shared          * @/method privateMinimize          * @/param {String} inWidget          **/        privateMinimize: function privateMinimize(inWidget) {            var            i,            pos,            utils,            shared,            htmlObj,            oldInfo,            minInfo,            position,            subWidgets,            widgetParent,            minimizePosition;            shared              = this;            minimizePosition    = shared.minimizePosition;            minInfo             = shared.minimizedInfo;            htmlObj             = inWidget.$domNode;            widgetParent        = htmlObj.parent();            oldInfo             = inWidget._private.oldInfo;            pos                 = inWidget.getPosition();            utils               = inWidget._private.utils;            subWidgets          = inWidget._subWidgets();            for(i = 0 ; position = minimizePosition[i] ; i++){                if(position.parent.equals(widgetParent)){                    if(!oldInfo.minimized){                        if(position.left + minInfo.width > widgetParent.width() && position.left != minInfo['margin-left']){                            position.left   =  minInfo['margin-left'];                            position.bottom += minInfo.height + minInfo['margin-top'];                        }                        inWidget._setOldInfo({                            height	: inWidget.getHeight(),                            width	: inWidget.getWidth(),                            left	: pos.left,                            top         : pos.top,                            right       : pos.right,                            bottom      : pos.bottom                        });                        htmlObj.bind({                            click : function(e){                                var                                target  = e.target,                                minBtn  = subWidgets.titlebar.subwidgets.minimize;                                if(minBtn && target.id !== minBtn.id && target.parentElement.id !== minBtn.id){                                    inWidget.minimizeDialog();                                }                            },                            mouseover : function(){                                htmlObj.css({                                    opacity : 0.9                                });                            },                            mouseout : function(){                                htmlObj.css({                                    opacity : 1                                });                            }                        });                        subWidgets.titlebar.subwidgets.close && subWidgets.titlebar.subwidgets.close.$domNode.hide();                        subWidgets.titlebar.subwidgets.minimize && subWidgets.titlebar.subwidgets.minimize.$domNode.hide();                        subWidgets.titlebar.subwidgets.maximize && subWidgets.titlebar.subwidgets.maximize.$domNode.hide();                        htmlObj.css({                            width   : minInfo.width,                            height  : minInfo.height,                            top     : 'auto',                            bottom  : position.bottom,                            left    : position.left,                            cursor  : 'pointer'                        });                        if(position.left + minInfo.width > widgetParent.width()){                            position.left   =  minInfo['margin-left'];                            position.bottom += minInfo.height + minInfo['margin-top'];                        }                        else{                            position.left +=  minInfo.width + minInfo['margin-left'];                        }                        if(utils.isResizable()){                            inWidget.resizable(false);                        }                        if(utils.isDraggable()){                            inWidget.draggable(false);                            if(subWidgets.titlebar.tag){                                var                                titlebar;                                titlebar = subWidgets.titlebar.tag.$domNode;                                titlebar.css({                                    cursor : 'pointer'                                });                            }                        }                        htmlObj.addClass('minimized');                    }                    else{                        htmlObj.css({                            width   : oldInfo.width,                            height  : oldInfo.height,                            top     : oldInfo.top,                            left    : oldInfo.left,                            bottom  : oldInfo.bottom,                            cursor  : 'auto',                            opacity : 1                        });                        if(utils.isResizable()){                            utils.makeResizable();                        }                        if(utils.isDraggable()){                            utils.makeDraggable();                        }                        htmlObj.unbind('click');                        htmlObj.unbind('mouseover');                        htmlObj.unbind('mouseout');                        subWidgets.titlebar.subwidgets.close && subWidgets.titlebar.subwidgets.close.$domNode.show();                        subWidgets.titlebar.subwidgets.minimize && subWidgets.titlebar.subwidgets.minimize.$domNode.show();                        subWidgets.titlebar.subwidgets.maximize && subWidgets.titlebar.subwidgets.maximize.$domNode.show();                        position.left -= minInfo.width + minInfo['margin-left'];                        htmlObj.removeClass('minimized');                        shared.refreshMinimized(htmlObj.parent());                    }                    break;                }            }            if(i === minimizePosition.length){                minimizePosition.push({                    parent  : widgetParent,                    bottom  : minInfo['margin-top'],                    left    : 2*minInfo['margin-left'] + minInfo.width                });                subWidgets.titlebar.subwidgets.close && subWidgets.titlebar.subwidgets.close.$domNode.hide();                subWidgets.titlebar.subwidgets.minimize && subWidgets.titlebar.subwidgets.minimize.$domNode.hide();                subWidgets.titlebar.subwidgets.maximize && subWidgets.titlebar.subwidgets.maximize.$domNode.hide();                inWidget._setOldInfo({                    height	: inWidget.getHeight(),                    width	: inWidget.getWidth(),                    left	: pos.left,                    top         : pos.top,                    right       : pos.right,                    bottom      : pos.bottom                });                htmlObj.css({                    width   : minInfo.width,                    height  : minInfo.height,                    top     : 'auto',                    bottom  : minInfo['margin-top'],                    left    : minInfo['margin-left'],                    cursor  : 'pointer'                });                if(utils.isResizable()){                    inWidget.resizable(false);                }                if(utils.isDraggable()){                    inWidget.draggable(false);                    htmlObj.css({                        cursor : 'auto'                    });                    if(subWidgets.titlebar.tag){                        titlebar = subWidgets.titlebar.tag.$domNode;                        titlebar.css({                            cursor : 'pointer'                        });                    }                }                htmlObj.bind({                    click : function(e){                        var                        target  = e.target,                        minBtn  = subWidgets.titlebar.subwidgets.minimize;                        if(minBtn && target.id !== minBtn.id && target.parentElement.id !== minBtn.id){                            inWidget.minimizeDialog();                        }                    },                    mouseover : function(){                        htmlObj.css({                            opacity : 0.9                        });                    },                    mouseout : function(){                        htmlObj.css({                            opacity : 1                        });                    }                });                htmlObj.addClass('minimized');            }            inWidget._private.oldInfo.minimized = !inWidget._private.oldInfo.minimized;        }    },    function WAFWidget(config, data, shared) {        var        that    = this,        classes = shared.classes,        htmlObj = $('#' + config.id);        that._private           = that._private || {};        that._private.classes   = classes;        that._private.shared    = shared;        that._private.buttons   = [];        that._private.oldInfo   = {            maximized : false,            minimized : false        };        $.fn.equals = $.fn.equals || function(compareTo) {            if (!compareTo || this.length != compareTo.length) {                return false;            }            for (var i = 0; i < this.length; ++i) {                if (this[i] !== compareTo[i]) {                    return false;                }            }            return true;        };        that._private.utils = {            isModal : function(){                return config['data-modal'] === 'true';            },            isDraggable : function(){                return config['data-draggable'] === 'true';            },            isResizable : function(){                return config['data-resizable'] === 'true';            },            toFront     : function(){                return config['data-front'] === 'true';            },            makeDraggable : function(){                var                utils,                subWidgets;                utils       = that._private.utils;                subWidgets  = that._private.subWidgets;                htmlObj.draggable({                    cancel: "." + classes.content.classname + ", ." + classes.titlebar.subwidgets.close + " , ." + classes.titlebar.subwidgets.maximize + " , ." + classes.titlebar.subwidgets.maximize + " , ." + classes.titlebar.subwidgets.iconimage,                    handle: "." + classes.titlebar.classname.split(' ')[0] + "." + classes.titlebar.classname.split(' ')[1],                    containment: "document",                    zIndex  : function(){                        if(utils.isModal() ){                             return 100001;                        }                        return null;                    }.call(),                    stop: function(event, ui) {                        if(utils.isModal() ){                            htmlObj.css({                                'z-index' : 100001                            });                        }                    }                });                htmlObj.css({                    cursor : 'auto'                });                if(subWidgets.titlebar.tag){                    var                    titlebar;                    titlebar = subWidgets.titlebar.tag.$domNode;                    titlebar.css({                        cursor : 'move'                    });                }            },            makeResizable : function(){                htmlObj.resizable();            },            makeModal : function(){                var                modal;                modal   = $('#waf-dialog-fade');                if(modal.length == 0){                    modal = $('<div id="waf-dialog-fade"></div>');                }                if(config['data-hideOnOutsideClick'] == 'true'){                    modal.click(function(){                        $('.waf-dialog-ismodal').each(function(){                            var widget = $(this).data('widget');                            if(widget){                                widget.closeDialog();                            }                        });                    });                }                htmlObj.css('z-index', '100001');                htmlObj.addClass('waf-dialog-ismodal');                htmlObj.data('widget' , that);                $('body').append(modal);                modal.css({                    'filter': 'alpha(opacity=50)'                }).fadeIn();            },            bringToFront : function(){                if(this.isModal()){                    htmlObj.css('z-index', '100001');                }                else{                    htmlObj.css('z-index', '99999');                }            }        }    },    {        ready   : function(){            var            content,            that,            utils,            config,            classes,            htmlObj,            subWidgets;            this._private.subWidgets = this._subWidgets(classes);            classes     = this._private.classes;            utils       = this._private.utils;            subWidgets  = this._private.subWidgets;            config      = this.config;            htmlObj     = this._getHtmlObject();            content     = subWidgets.content.tag;            that        = this;            if (utils.isDraggable()){                utils.makeDraggable();            }            if (utils.isResizable()){                utils.makeResizable();            }            if (utils.isModal() && config['data-hideonload'] !== 'true' && typeof Designer === 'undefined'){                utils.makeModal();            }            if (utils.toFront()){                utils.bringToFront();            }            if (config['data-load'] && config['data-load'] != '' && content){                var                frame,                bodyHTMLobj;                bodyHTMLobj = content.$domNode;                bodyHTMLobj.empty();                frame      = $('<iframe>');                frame.prop({                    src     : config['data-load']                });                frame.addClass('waf-dialog-iframe');                frame.appendTo(bodyHTMLobj);            }            // Auto open :            if (config['data-hideonload'] === 'true'){                this.closeDialog();            }            htmlObj            .prop( "tabIndex", -1)            .keydown(function( event ) {                if ( !event.isDefaultPrevented() && event.keyCode && event.keyCode === $.ui.keyCode.ESCAPE ) {                    that.closeDialog();                    event.preventDefault();                }            });            if (subWidgets.titlebar.subwidgets.maximize){                WAF.addListener(subWidgets.titlebar.subwidgets.maximize.id, "click", this.maximizeDialog , "WAF");            }            if (subWidgets.titlebar.subwidgets.minimize){                WAF.addListener(subWidgets.titlebar.subwidgets.minimize.id, "click", this.minimizeDialog , "WAF");            }            if (subWidgets.titlebar.subwidgets.close){                WAF.addListener(subWidgets.titlebar.subwidgets.close.id, "click", this.closeDialog , "WAF");            }        },        _subWidgets : function(){            var            res,            linkedTags,            classes;            if(this._private && this._private.subWidgets){                return this._private.subWidgets;            }            classes = this._private.classes;            res = {                titlebar    : {                    tag         : null,                    subwidgets  : {                        iconimage   : null,                        title       : null,                        close       : null,                        minimize    : null,                        maximize    : null                    }                },                content     : {                    tag         : null                },                toolbar     : {                    tag         : null                }            };            linkedTags = this.getLinks();            for(var i = 0 , widget; widget = linkedTags[i] ; i++ ){                var                htmlObj;                htmlObj = widget.$domNode;                widget._private = widget._private || {};                widget._private.dialogWidget = this;                if(htmlObj.hasClass(classes.titlebar.classname)){                    res.titlebar.tag = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.iconimage)){                    res.titlebar.subwidgets.iconimage = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.title)){                    res.titlebar.subwidgets.title = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.close)){                    res.titlebar.subwidgets.close = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.minimize)){                    res.titlebar.subwidgets.minimize = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.maximize)){                    res.titlebar.subwidgets.maximize = widget;                    continue;                }                else if(htmlObj.hasClass(classes.content.classname)){                    res.content.tag = widget;                    continue;                }                else if(htmlObj.hasClass(classes.toolbar.classname)){                    res.toolbar.tag = widget;                    continue;                }            }            this._private = this._private || {};            this._private.subWidgets    = res;            return res;        },        closeDialog : function(){            var            htmlObj,            modal,            dw;            if(this.kind === 'dialog'){                dw = this;            }            else if(this._private && this._private.dialogWidget){                dw = this._private.dialogWidget;            }            htmlObj = dw._getHtmlObject();            modal = $('#waf-dialog-fade');            htmlObj.hide();            if($('.waf-dialog-ismodal:visible').length == 0){                modal.hide();            }        },        displayDialog : function(){            var            htmlObj,            modal,            utils,            dw;            if(this.kind === 'dialog'){                dw = this;            }            else if(this._private && this._private.dialogWidget){                dw = this._private.dialogWidget;            }            htmlObj = dw._getHtmlObject();            modal   = $('#waf-dialog-fade');            utils   = dw._private.utils;            if(utils.isModal()){                utils.makeModal();            }            htmlObj.show();        },        destroy : function(){            var childrens = this.getChildren(),            length = childrens.length,            i = 0,            children = null;            for (i = 0; i < length; i++) {                children = childrens[i];                if (children.id) {                    delete WAF.widgets[children.id];                }            }            delete WAF.widgets[this.id]            this.$domNode.remove();            $('#waf-dialog-fade').hide();        },        maximizeDialog : function(){            var            dw,            pos,            oldInfo,            htmlObj,            utils,            subWidgets;            if(this.kind === 'dialog'){                dw = this;            }            else{                dw = this._private.dialogWidget;            }            if(!dw){                return false;            }            htmlObj     = dw._getHtmlObject();            oldInfo     = dw._private.oldInfo;            utils       = dw._private.utils;            subWidgets  = dw._subWidgets();            if(!oldInfo.maximized){                pos     = dw.getPosition();                dw._setOldInfo({                    height	: dw.getHeight(),                    width	: dw.getWidth(),                    left	: pos.left,                    top         : pos.top,                    right       : pos.right,                    bottom      : pos.bottom                });                htmlObj.css({                    width   : '100%',                    height  : '100%',                    top     : 0,                    left    : 0                });                if(utils.isResizable()){                    dw.resizable(false);                }                if(utils.isDraggable()){                    dw.draggable(false);                    htmlObj.css({                        cursor : 'auto'                    });                    if(subWidgets.titlebar.tag){                        var                        titlebar;                        titlebar = subWidgets.titlebar.tag.$domNode;                        titlebar.css({                            cursor : 'auto'                        });                    }                }            }            else{                htmlObj.css({                    width   : oldInfo.width,                    height  : oldInfo.height,                    top     : oldInfo.top,                    left    : oldInfo.left                });                if(utils.isResizable()){                    utils.makeResizable();                }                if(utils.isDraggable()){                    utils.makeDraggable();                }            }            dw._private.oldInfo.maximized = !dw._private.oldInfo.maximized;        },        minimizeDialog : function(){            var            dw;            if(this.kind === 'dialog'){                dw = this;            }            else{                dw = this._private.dialogWidget;            }            if(!dw){                return;            }            dw._private.shared.privateMinimize(dw);        },        _setOldInfo : function(info){            this._private.oldInfo = info;        },        _getOldInfo : function(){            return this._private.oldInfo;        },        _getHtmlObject : function(){            return this.$domNode;        },        _createNew : function(config){            var            temp,            that,            title,            classes,            htmlObj,            content,            toolbar,            titlebar,            contentW,            btnClose,            imageIcon,            defaultConf,            titleWidget,            btnMaximize,            btnMinimize;            classes = this._private.classes;            defaultConf = {                title           : 'Dialog Title',                icon            : {                    url     : '/walib/WAF/widget/dialog/images/alert.png',                    display : true                },                buttons         : [],                content         : null,                toolBar         : true,                titleBar        : true,                closeButton     : true,                maximizeButton  : true,                minimizeButton  : true            }            config = $.extend(true, defaultConf , config);            for(var i in defaultConf){                if(config[i] == 'undefined' || config[i] == null){                    config[i] = defaultConf[i];                }            }            htmlObj = this._getHtmlObject();            that    = this;            function addButtonToToolbar(i , config){                var                button;                config.title    = config.title      || 'Button ' + i;                config['class'] = config['class']   || '';                button = $('<button>').prop({                    'id'                    : that.id + '_button' + i,                    'class'                 : 'waf-widget waf-button default inherited'                })                .data({                	'text'             : config.title,                    'constraint-right' : "true",                    'constraint-bottom': "false",                    'constraint-left'  : "false",                    'constraint-top'   : "true"                });                button.css({                    width       : 100,                    height      : 30,                    top         : 5,                    right       : 5 + (5 + 100)*i,                    position    : 'absolute'                });                button.addClass(config['class']);                button.bind(config);                button.appendTo(toolbar);                new WAF.widget.Button({                    'id'        : that.id + '_button' + i,                    'class'     : 'waf-widget waf-button default inherited',                    'data-theme': 'metal inherited',                    'data-text' : config.title                });            }            if(config.titleBar){                var                xButton = 8;                titlebar = $('<div>').prop({                    id                      : this.id + '_titlebar',                    'class'                 : "waf-widget waf-container default inherited " + classes.titlebar.classname                })                .data({                    'constraint-right' : "true",                    'constraint-bottom': "false",                    'constraint-left'  : "true",                    'constraint-top'   : "true"                });                titlebar.css({                    top     : 0,                    height  : 28,                    left    : 0,                    right   : 0,                    position: 'absolute'                });                titlebar.appendTo(htmlObj);                new WAF.widget.Container({                    'id'        : this.id + '_titlebar',                    'class'     : 'waf-widget waf-container default inherited ' + classes.titlebar.classname,                    'data-theme': 'metal inherited'                });                title = $('<div>').prop({                    id                      : this.id + '_title',                    'class'                 : "waf-widget waf-richText default inherited " + classes.titlebar.subwidgets.title                })                .data({                    'constraint-right' : "true",                    'constraint-bottom': "false",                    'constraint-left'  : "true",                    'constraint-top'   : "true",                    'autowidth'        : "false"                });                title.css({                    top     : 6,                    height  : 14,                    left    : 0,                    right   : 0,                    position: 'absolute'                });                title.appendTo(titlebar);                titleWidget = new WAF.widget.RichText({                    'id'            : this.id + '_title',                    'class'         : 'waf-widget waf-richText default inherited ' + classes.titlebar.subwidgets.title,                    'data-theme'    : 'metal inherited',                    'data-autowidth': "false",                    'data-text'     : config.title                });                titleWidget.setValue(config.title);                if(config.icon.display){                    imageIcon = $('<div>').prop({                        id                      : this.id + '_icon',                        'class'                 : "waf-widget waf-image default inherited " + classes.titlebar.subwidgets.iconimage                    })                    .data({                        'constraint-right' : "false",                        'constraint-bottom': "false",                        'constraint-left'  : "true",                        'constraint-top'   : "true",                        'src'              : config.icon.url,                        'fit'              : '0'                    });                    imageIcon.css({                        top     : 2,                        height  : '20px',                        width   : '20px',                        left    : 2,                        position: 'absolute'                    });                    imageIcon.appendTo(titlebar);                    new WAF.widget.Image({                        'id'        : this.id + '_icon',                        'class'     : 'waf-widget waf-image default inherited ' + classes.titlebar.subwidgets.iconimage,                        'data-theme': 'metal inherited',                        'data-src'  : config.icon.url || defaultConf.icon.url,                        'data-fit'  : '0'                    });                }                if(config.closeButton){                    btnClose = $('<button>').prop({                        'id'                    : this.id + '_close',                        'class'                 : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.close                    })                    .data({                        'text'             : 'x',                        'constraint-right' : "true",                        'constraint-bottom': "false",                        'constraint-left'  : "false",                        'constraint-top'   : "true"                    });                    btnClose.css({                        width       : 15,                        height      : 15,                        top         : 5,                        right       : xButton,                        position    : 'absolute',                        'z-index'   : 4                    });                    btnClose.appendTo(titlebar);                    xButton += 19;                    new WAF.widget.Button({                        'id'        : this.id + '_close',                        'class'     : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.close,                        'data-theme': 'metal inherited',                        'data-text' : 'x'                    });                }                if(config.maximizeButton){                    btnMaximize = $('<button>').prop({                        'id'                    : this.id + '_maximize',                        'class'                 : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.maximize                    })                    .data({                    	'text'             : '+',                        'constraint-right' : "true",                        'constraint-bottom': "false",                        'constraint-left'  : "false",                        'constraint-top'   : "true"                    });                    btnMaximize.css({                        width       : 15,                        height      : 15,                        top         : 5,                        right       : xButton,                        position    : 'absolute',                        'z-index'   : 4                    });                    btnMaximize.appendTo(titlebar);                    xButton += 19;                    new WAF.widget.Button({                        'id'        : this.id + '_maximize',                        'class'     : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.maximize,                        'data-theme': 'metal inherited',                        'data-text' : '+'                    });                }                if(config.minimizeButton){                    btnMinimize = $('<button>').prop({                        'id'                    : this.id + '_minimize',                        'class'                 : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.minimize                    })                    .data({                        'text'             : '+',                        'constraint-right' : "true",                        'constraint-bottom': "false",                        'constraint-left'  : "false",                        'constraint-top'   : "true"                    });                    btnMinimize.css({                        width       : 15,                        height      : 15,                        top         : 5,                        right       : xButton,                        position    : 'absolute',                        'z-index'   : 4                    });                    btnMinimize.appendTo(titlebar);                    xButton += 19;                    new WAF.widget.Button({                        'id'        : this.id + '_minimize',                        'class'     : 'waf-widget waf-button default inherited ' + classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.minimize,                        'data-theme': 'metal inherited',                        'data-text' : '-'                    });                }            }            content = $('<div>').prop({                id                      : this.id + '_content',                'class'                 : "waf-widget waf-container default inherited " + classes.content.classname            })            .data({                'constraint-right' : "true",                'constraint-bottom': "true",                'constraint-left'  : "true",                'constraint-top'   : "true"            });            if(config.titleBar){                content.css({                    top     : 30,                    left    : 0,                    right   : 0,                    bottom  : 42,                    position: 'absolute'                });            }            else{                content.css({                    top     : 0,                    left    : 0,                    right   : 0,                    bottom  : 42,                    position: 'absolute'                });            }            content.appendTo(htmlObj);            contentW = new WAF.widget.Container({                'id'        : this.id + '_content',                'class'     : 'waf-widget waf-container default inherited ' + classes.content.classname,                'data-theme': 'metal inherited'            });            if(config.toolBar){                toolbar = $('<div>').prop({                    id                      : this.id + '_toolbar',                    'class'                 : "waf-widget waf-container default inherited " + classes.toolbar.classname                })                .data({                    'constraint-right' : "true",                    'constraint-bottom': "true",                    'constraint-left'  : "true",                    'constraint-top'   : "false"                });                toolbar.css({                    height  : 40,                    left    : 0,                    right   : 0,                    bottom  : 0,                    position: 'absolute'                });                toolbar.appendTo(htmlObj);                new WAF.widget.Container({                    'id'        : this.id + '_toolbar',                    'class'     : 'waf-widget waf-container default inherited ' + classes.toolbar.classname,                    'data-theme': 'metal inherited'                });                if(Raphael.is(config.buttons , 'array')){                    $.each(config.buttons , function(key , value){                        addButtonToToolbar(key , value);                    })                }            }            else{                contentW.setHeight('100%');                contentW.setWidth('100%');            }            this.ready();        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/dialog/widget-dialog-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'dialog',    lib         : 'WAF',    description : 'Dialog',    category    : 'Containers/Placeholders',    img         : '/walib/WAF/widget/dialog/icons/widget-dialog.png',    tag         : 'div',    containArea : true,    attributes  : [    {        name        : 'data-load',        description : 'HTML file to include'    },{        name        : 'data-resizable',        description : 'Resizable',        type        : 'checkbox',        onclick     : function(){            var            checked,            tag;            tag = this.data.tag;            checked = tag.getAttribute('data-resizable').getValue() === 'true';            checked = !checked;            tag.getAttribute('data-resizable').setValue(checked + "");            D.tag.refreshPanels();        }    }, {        name        : 'data-draggable',        description : 'Draggable',        type        : 'checkbox'    }, {        name        : 'data-modal',        description : 'Modal',        type        : 'checkbox',        onclick     : function(){            var            tag;            tag = this.data.tag;            if(this.getValue()){                tag.getAttribute('data-front').setValue('true');                tag.getAttribute(this.data.aName).setValue('true');            }            else{                tag.getAttribute(this.data.aName).setValue('false');            }            D.tag.refreshPanels();        }    }, {        name        : 'data-hideOnOutsideClick',        visibility  : 'hidden',        defaultValue: 'false',        type        : 'checkbox'    },{        name        : 'data-front',        description : 'Float on top',        type        : 'checkbox',        defaultValue: 'true'    }    ],    style: [    {        name        : 'width',        defaultValue: '294px'    },    {        name        : 'height',        defaultValue: '211px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    properties: {        style: {            theme       : true,                 // false to not display the "Theme" option in the "Theme & Class" section            //    theme : {            //    	roundy: false		//all the default themes are displayed by default. Pass an array with the            //   }				//themes to hide ('default', 'inherited', roundy, metal, light)            fClass      : true,                 // true to display the "Class" option in the "Theme & Class" section            text        : false,                 // true to display the "Text" section            background  : false,                 // true to display widget "Background" section            border      : true,                 // true to display widget "Border" section            sizePosition: true,                 // true to display widget "Size and Position" section            label       : true,                 // true to display widget "Label Text" and "Label Size and Position" sections            // For these two sections, you must also define the "data-label" in the Attributes array            disabled     : []     // list of styles settings to disable for this widget        }    },    structure: [],    onInit: function (config) {        var widget = new WAF.widget.Dialog(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        /*         * Apply theme on widget theme's change         */        tag.onChangeTheme = function(theme) {            var            group;            group = D.getGroup(this.getGroupId());            if (group) {                group.applyTheme(theme, this);            }        }    },    onCreate: function(tag , param){        var        event,        title,        group,        content,        toolbar,        classes,        titleBar,        btnClose,        iconImage,        btnMaximize,        btnMinimize,        btnOK,        btnCancel;        /**         *Classes name         */        tag.getAttribute('class').setValue(tag.getAttribute('class').getValue() + ' ' + 'waf-container');        tag._classes = {            titlebar    : {                classname   : 'waf-widget-header waf-dialog-header',                subwidgets  : {                    iconimage   : 'waf-dialog-header-icon',                    title       : 'waf-dialog-header-title',                    buttons     : 'waf-dialog-header-buttons',                    close       : 'waf-dialog-header-close',                    minimize    : 'waf-dialog-header-minimize',                    maximize    : 'waf-dialog-header-maximize'                }            },            content     : {                classname   : 'waf-widget-body waf-dialog-body'            },            toolbar     : {                classname   : 'waf-widget-footer waf-dialog-footer'            }        }        /**         * Sub widget click function         * @method _subWidgetsClickFn         */        tag._subWidgetsClickFn = function() {            if (D.getCurrent() != tag) {                tag.setCurrent();                D.tag.refreshPanels();            }            return false;        }        /**         * Get linked Widgets         * @method _subWidgets         */        tag._subWidgets = function(){            var            res,            classes,            linkedTags;            classes = tag._classes;            if(this._private && this._private.subWidgets){                return this._private.subWidgets;            }            res = {                titlebar    : {                    tag         : null,                    subwidgets  : {                        iconimage   : null,                        title       : null,                        close       : null,                        minimize    : null,                        maximize    : null                    }                },                content     : {                    tag         : null                },                toolbar     : {                    tag         : null                }            };            linkedTags = tag.getLinks();            for(var i = 0 , widget; widget = linkedTags[i] ; i++ ){                var                htmlObj;                htmlObj = widget.getHtmlObject();                if(htmlObj.hasClass(classes.titlebar.classname)){                    res.titlebar.tag = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.iconimage)){                    res.titlebar.subwidgets.iconimage = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.title)){                    res.titlebar.subwidgets.title = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.close)){                    res.titlebar.subwidgets.close = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.minimize)){                    res.titlebar.subwidgets.minimize = widget;                    continue;                }                else if(htmlObj.hasClass(classes.titlebar.subwidgets.maximize)){                    res.titlebar.subwidgets.maximize = widget;                    continue;                }                else if(htmlObj.hasClass(classes.content.classname)){                    res.content.tag = widget;                    continue;                }                else if(htmlObj.hasClass(classes.toolbar.classname)){                    res.toolbar.tag = widget;                    continue;                }            }            this._private = this._private || {};            this._private.subWidgets = res;            return res;        }        /**         * add widget         * @method _addWidget         */        tag._addWidget = function add_widget(config){            var            group,            widget,            groupId,            allFits,            reloadTag,            defaultConfig,            camelCaseFits;            allFits         = ['top' , 'left' , 'right' , 'bottom'];            camelCaseFits   = ['Top' , 'Left' , 'Right' , 'Bottom']            groupId         = tag.getGroupId();            group           = Designer.getGroup(groupId);            reloadTag       = false;            defaultConfig   = {                fit         : [],                height      : null,                width       : null,                left        : null,                top         : null,                type        : 'button',                parent      : this,                'class'     : null,                attribs     : null,                'z-index'   : null            };            config = $.extend(true, defaultConfig , config);            widget = Designer.createTag({                type        : config.type,                width       : config.width,                height      : config.height,                fit         : config.fit,                silentMode  : true,                parent      : config.parent            });            if(config['class']){                widget.addClass(config['class']);            }            for(var i = 0 , fit ; fit = allFits[i] ; i++ ){                if($.inArray(fit, config.fit) >= 0){                    widget.savePosition(fit, config[fit], false, false);                }                else{                    widget['setFitTo' + camelCaseFits[i]](false);                    widget.savePosition(fit, null);                }            }            if(config.attribs){                for(var attr in config.attribs){                    widget.getAttribute(attr).setValue(config.attribs[attr]);                }                reloadTag = true;            }            if(config['z-index']){                widget.updateZindex(-1);                reloadTag = true;            }            if(reloadTag){                widget.refresh();            }            widget.setAsSubElement(true);            this.link(widget);            group.add(widget);            return widget;        }        if(!param._isLoaded){            var            toolbarHeight   = 25,            titlebarHeight  = 25;            classes = tag._classes;            /**             * Create the group             */            group = new Designer.ui.group.Group();            group.add(tag);            titleBar = tag._addWidget({                fit     : ['top' , 'left' , 'right'],                height  : titlebarHeight,                top     : 0,                left    : 0,                right   : 0,                'class' : classes.titlebar.classname,                parent  : tag,                type    : 'container'            });            tag._addWidget({                fit         : ['top' , 'left' , 'right'],                height      : 14,                top         : 6,                left        : 0,                right       : 0,                'class'     : classes.titlebar.subwidgets.title,                parent      : titleBar,                type        : 'richText',                'z-index'   : -1,                attribs : {                    'data-text'     : 'Dialog Title',                    'data-autoWidth': 'false'                }            });            tag._addWidget({                fit     : ['top' , 'left'],                height  : 20,                top     : 2,                left    : 2,                'class' : classes.titlebar.subwidgets.iconimage,                parent  : titleBar,                width   : 20,                type    : 'image',                attribs : {                    'data-src'  : '/walib/WAF/widget/dialog/images/alert.png'                }            });            tag._addWidget({                type        : 'button',                width       : 15,                height      : 15,                right       : 27,                top         : 5,                fit         : ['right' , 'top'],                parent      : titleBar,                'class'     : classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.maximize,                attribs     : {                    'data-text' : '+'                }            });            tag._addWidget({                type        : 'button',                width       : 15,                height      : 15,                right       : 46,                top         : 5,                fit         : ['right' , 'top'],                parent      : titleBar,                'class'     : classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.minimize,                attribs     : {                    'data-text' : '-'                }            });            tag._addWidget({                type        : 'button',                width       : 15,                height      : 15,                right       : 8,                top         : 5,                fit         : ['right' , 'top'],                parent      : titleBar,                'class'     : classes.titlebar.subwidgets.buttons + ' ' + classes.titlebar.subwidgets.close,                attribs     : {                    'data-text' : 'x'                }            });            tag._addWidget({                fit     : ['top' , 'left' , 'right' , 'bottom'],                top     : titlebarHeight,                left    : 0,                right   : 0,                bottom  : toolbarHeight,                'class' : classes.content.classname,                parent  : tag,                type    : 'container'            });            toolbar = tag._addWidget({                fit     : ['bottom' , 'left' , 'right'],                height  : toolbarHeight,                bottom  : 0,                left    : 0,                right   : 0,                top     : null,                'class' : classes.toolbar.classname,                parent  : tag,                type    : 'container'            });            btnCancel = tag._addWidget({                type        : 'button',                width       : 60,                height      : 20,                right       : 73,                top         : 2,                fit         : ['right' , 'top'],                parent      : toolbar,                attribs     : {                    'data-text' : 'Cancel'                }            });            Designer.studio.createEvent('' , btnCancel.getLib() , btnCancel.getId() , 'click' , btnCancel.getType() , undefined , false);            Designer.studio.setScriptEvent(btnCancel.getId() , btnCancel.getType() , 'click' , "\t\t$$('" + tag.getAttribute('id').getValue() + "').closeDialog(); //cancel button");            btnCancel.getEvent('click').setHandlerName('click');            btnOK = tag._addWidget({                type        : 'button',                width       : 60,                height      : 20,                right       : 8,                top         : 2,                fit         : ['right' , 'top'],                parent      : toolbar,                attribs     : {                    'data-text' : 'OK'                }            });            Designer.studio.createEvent('' , btnOK.getLib() , btnOK.getId() , 'click' , btnOK.getType() , undefined , false);            Designer.studio.setScriptEvent(btnOK.getId() , btnOK.getType() , 'click' , "\t\t$$('" + tag.getAttribute('id').getValue() + "').closeDialog(); //ok button");            btnOK.getEvent('click').setHandlerName('click');            D.ui.group.save();            tag.onDesign(true);        } else {            /*             * Execute script when widget is entirely loaded (with linked tags)             */            $(tag).bind('onReady', function(){                var                linkedWidgets;                linkedWidgets = tag.getLinks();                for(var i = 0 , widget ; widget = linkedWidgets[i] ; i++){                    widget.setAsSubElement(true);                }            });        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/tinymce/widget-tinymce.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'TinyMCE',    {    },    function WAFWidget(config, data, shared) {    },    {        ready : function(){            var            that,            config,            source,            parent,            htmlObj,            position,            elements,            textArea,            wysiwygConf,            tinyMCEinst,            domAttributes;            config      = this.config;            htmlObj     = this.$domNode;            position    = {                top     : htmlObj.css('top'),                left    : htmlObj.css('left'),                right   : htmlObj.css('right'),                bottom  : htmlObj.css('bottom')            };            parent          = htmlObj.parent();            domAttributes   = htmlObj[0].attributes;            textArea = $('<textarea>');            for(var i = 0 ; i<domAttributes.length ; i++){                var                attr        = domAttributes[i];                if(attr.name != 'data-elements'){                    textArea[0].setAttribute(attr.name, attr.value);                }            }            htmlObj.remove();            textArea.appendTo(parent)            source          = this.source;            that            = this;            that.$domNode   = textArea;            elements = JSON.parse(config['data-elements'].replace(/'/g,'"'));            wysiwygConf = {                mode : "exact",                elements : textArea.prop('id'),                plugins : "autolink,lists,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,\n\                            insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,\n\                                nonbreaking,xhtmlxtras,template",                theme : "advanced",                theme_advanced_toolbar_location : config['data-toolbar-location'],                theme_advanced_toolbar_align : config['data-toolbar-align'],                theme_advanced_resizing : false,                theme_advanced_statusbar_location : "bottom",                constrain_menus : true,                skin : "o2k7",                skin_variant : "silver",                save_enablewhendirty : true,                save_onsavecallback : function save_it(){                    if(source && tinyMCEinst){                        var cm = that.getControlManager();                        if(config['data-save'] === 'true'){                            that.sourceAtt.setValue(tinyMCEinst.getContent());                            cm.setDisabled('save' , true);                        }                        else{                            source.save({                                onSuccess : function(){                                    cm.setDisabled('save' , true);                                }                            });                        }                    }                },                onchange_callback : function(){                    source && that.sourceAtt.setValue(tinyMCEinst.getContent());                },                content_css : "/walib/WAF/widget/tinymce/css/content.css",                oninit : function(){                    var                    parent;                    parent      = $('#' + that.id + '_parent');                    parent.css({                        'top'       : position.top,                        'left'      : position.left,                        'bottom'    : position.bottom,                        'right'     : position.right,                        'position'  : 'absolute'                    });                    if(config['data-draggable'] === 'true'){                        parent.draggable({                            handle  : '#' + that.id + '_toolbargroup',                            cancel  : '.mceIcon'                        });                    }                    // Add attribs                    tinyMCEinst     = that.getWysiwygInstance();                    // Setup events                    var evts = that.events;                    for(i in evts){                        switch(i){                            case 'onInit'               :                                tinyMCEinst.onInit.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onInit && evts.onInit(e);                                });                                break;                            case 'onClick'              :                                tinyMCEinst.onClick.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onClick && evts.onClick(e);                                });                            case 'onPaste'              :                                tinyMCEinst.onPaste.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onPaste && evts.onPaste(e);                                });                                break;                            case 'onKeyUp'              :                                tinyMCEinst.onKeyUp.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onKeyUp && evts.onKeyUp(e);                                });                                break;                            case 'onSubmit'             :                                tinyMCEinst.onSubmit.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onSubmit && evts.onSubmit(e);                                });                                break;                            case 'onMouseUp'            :                                tinyMCEinst.onMouseUp.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onMouseUp && evts.onMouseUp(e);                                });                                break;                            case 'onKeyDown'            :                                tinyMCEinst.onKeyDown.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onKeyDown && evts.onKeyDown(e);                                });                                break;                            case 'onKeyPress'           :                                tinyMCEinst.onKeyPress.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onKeyPress && evts.onKeyPress(e);                                });                                break;                            case 'onActivate'           :                                tinyMCEinst.onActivate.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onActivate && evts.onActivate(e);                                });                                break;                            case 'onDblClick'           :                                tinyMCEinst.onDblClick.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onDblClick && evts.onDblClick(e);                                });                                break;                            case 'onMouseDown'          :                                tinyMCEinst.onMouseDown.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onMouseDown && evts.onMouseDown(e);                                });                                break;                            case 'onSetContent'         :                                tinyMCEinst.onSetContent.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onSetContent && evts.onSetContent(e);                                });                                break;                            case 'onContextMenu'        :                                tinyMCEinst.onContextMenu.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onContextMenu && evts.onContextMenu(e);                                });                                break;                            case 'onBeforeGetContent'   :                                tinyMCEinst.onBeforeGetContent.add(function(ed, e) {                                    var  evts = that.events;                                    evts.onBeforeGetContent && evts.onBeforeGetContent(e);                                });                                break;                        }                    }                    if(source){                        var                        cm,                        content;                        cm = that.getControlManager();                        content = that.sourceAtt.getValue() || "";                        tinyMCEinst.setContent(content);                        source.addListener("all",function(e){                            switch(e.eventKind){                                case "onElementSaved"           :                                case "onCollectionChange"       :                                case "onCurrentElementChange"   :                                    content = that.sourceAtt.getValue() || "";                                    tinyMCEinst.setContent(content);                                    cm.setDisabled('save' , true);                                    break;                            }                        });                    }                    /**                     *                     */                    var                    htmlParent  = that.$domNode.parent(),                    domNode     = $('#' + that.id),                    pos         = that.getPosition(),                    resizeH     = domNode.attr('data-constraint-top') == 'true' && domNode.attr('data-constraint-bottom') == 'true',                    resizeW     = domNode.attr('data-constraint-left') == 'true' && domNode.attr('data-constraint-right') == 'true';                    if(( resizeH || resizeW ) && htmlParent.prop('id') == $('body').prop('id')){                        $(window).resize(function(){                            if(tinyMCEinst){                                var                                mceFirst    = $('#' + that.id + '_parent').find('.mceFirst'),                                mceLast     = $('#' + that.id + '_parent').find('.mceLast');                                if(resizeH && resizeW){                                    tinyMCEinst.theme.resizeTo($(this).width() - pos.left - pos.right , $(this).height() - pos.top - pos.bottom - mceFirst.height() - mceLast.height());                                }                                else if(resizeH){                                    tinyMCEinst.theme.resizeTo($(this).width() , $(this).height() - pos.top - pos.bottom - mceFirst.height() - mceLast.height());                                }                                else if(resizeW){                                    tinyMCEinst.theme.resizeTo($(this).width() - pos.left - pos.right , $(this).height() - mceFirst.height() - mceLast.height());                                }                            }                        });                    }                },                // Events                inline_styles : true,                convert_fonts_to_spans : true            };            for(var i = 0 , element , j = 1 , k = 0 ; element = elements[i] ; i++ , k++){                wysiwygConf['theme_advanced_buttons' + j] = wysiwygConf['theme_advanced_buttons' + j] || "";                if(element.key === '_'){                    j++;                    k = -1;                    continue;                }                if(k>0){                    wysiwygConf['theme_advanced_buttons' + j] += ',';                }                wysiwygConf['theme_advanced_buttons' + j] += element.key;            }            wysiwygConf['theme_advanced_buttons' + (j + 1)] = "";            if(config['data-resizable'] === 'true'){                wysiwygConf.theme_advanced_resizing = true;            }            tinyMCE.init(wysiwygConf);        },        getWysiwygInstance : function(){            return tinyMCE.getInstanceById(this.id);        },        getControlManager : function(){            var            cm,            inst;            inst = this.getWysiwygInstance();            cm = inst.controlManager;            return cm;        },        getValue : function(){            return this.getWysiwygInstance().getContent();        },        setValue : function(content){            return this.getWysiwygInstance().setContent(content);        },        onResize : function(){            var            inst        = this.getWysiwygInstance(),            parent      = this.getParent(),            domNode     = $('#' + this.id),            position    = this.getPosition(),            resizeH     = domNode.attr('data-constraint-top') == 'true' && domNode.attr('data-constraint-bottom') == 'true',            resizeW     = domNode.attr('data-constraint-left') == 'true' && domNode.attr('data-constraint-right') == 'true',            div         = $('#' + this.id + '_over').length == 0 ? $('<div>').attr('id' , this.id + '_over') : $('#' + this.id + '_over');            div.css({                top     : 0,                left    : 0,                width   : $('#wysiwyg1_tbl').width(),                height  : $('#wysiwyg1_tbl').height(),                position: 'absolute'            }).appendTo($('#' + this.id + '_parent'));            if(inst){                var                mceFirst    = $('#' + this.id + '_parent').find('.mceFirst'),                mceLast     = $('#' + this.id + '_parent').find('.mceLast');                if(resizeH && resizeW){                    inst.theme.resizeTo(parent.getWidth() - position.left - position.right , parent.getHeight() - position.top - position.bottom - mceFirst.height() - mceLast.height());                }                else if(resizeH){                    inst.theme.resizeTo(this.getWidth() , parent.getHeight() - position.top - position.bottom - mceFirst.height() - mceLast.height());                }                else if(resizeW){                    inst.theme.resizeTo(parent.getWidth() - position.left - position.right , this.getHeight() - mceFirst.height() - mceLast.height());                }            }        },        stopResize : function(){            $('#' + this.id + '_over').length != 0 && $('#' + this.id + '_over').remove();        },        getParent : function(){            var            parentHtml;            parentHtml = $('#' + this.id + '_parent').parent();            return $$(parentHtml.prop('id'));        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/tinymce/widget-tinymce-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'wysiwyg',    lib         : 'WAF',    description : 'WYSIWYG Editor',    category    : 'Form Controls',    img         : '/walib/WAF/widget/tinymce/icons/widget-tinymce.png',    tag         : 'div',    attributes  : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {               name        : 'data-label-position',               description : 'Label position',               defaultValue: 'left'       },    {        name            : 'data-toolbar-location',        description     : 'Toolbar location',        type            : 'comboBox',        options         : [        {            key     : 'top',            value   : 'Top'        },        {            key     : 'bottom',            value   : 'Bottom'        }        ],        defaultValue    : 'top'    },    {        name            : 'data-toolbar-align',        description     : 'Align toolbar',        type            : 'comboBox',        options         : [        {            key     : 'left',            value   : 'Left'        },        {            key     : 'right',            value   : 'Right'        }        ],        defaultValue    : 'left'    },    {        name            : 'data-save',        description     : 'Save automatically',        type            : 'checkbox',        defaultValue    : 'true'    },    {        name            : 'data-draggable',        description     : 'Draggable',        type            : 'checkbox'    },    {        name            : 'data-resizable',        description     : 'Resizable',        type            : 'checkbox'    },    {        name            : 'data-elements',        description     : 'Elements',        type            : 'grid',        defaultValue    : "[{'key':'newdocument','value':'New Document'},{'key':'save','value':'Save'},{'key':'|','value':'Separator'},{'key':'bold','value':'Bold'},{'key':'italic','value':'Italic'},{'key':'underline','value':'Underline'},{'key':'|','value':'Separator'},{'key':'justifyleft','value':'Justify To Left'},{'key':'justifycenter','value':'Justify To Center'},{'key':'justifyright','value':'Justify To Right'},{'key':'justifyfull','value':'Full Justify'},{'key':'|','value':'Separator'},{'key':'cut','value':'Cut'},{'key':'copy','value':'Copy'},{'key':'|','value':'Separator'},{'key':'undo','value':'Undo'},{'key':'redo','value':'Redo'},{'key':'|','value':'Separator'},{'key':'forecolor','value':'Text Color'}]",        domAttribute    : true,        header          : [],        newRowEmpty     : false,        onRowClick      : function( item ) {        },        afterRowAdd     : function(data) {        },        afterRowDelete  : function(data) {            var            tag;            tag = this.data.tag;            this._executeSave();            tag.onDesign(true);        },        afterRowSort    : function(data) {            var            tag;            tag = this.data.tag;            this._executeSave();            tag.onDesign(true);        },        beforeReady : function(){            var            rows;            this.buttons.visible = false;            rows = this.getRows();            for(var i = 0 ; i < rows.length ; i++){                this.removeRow(i);            }        },        ready   : function() {            var            tag,            that,            parent,            placeHolder,            elements;            placeHolder = this.buttons.placeHolder;            parent      = $(placeHolder);            that        = this;            tag         = that.getData().tag;            // C'est un contournement,  voir avec Maxime            this.json = null;            new waForm.Button({                parent      : parent,                buttonType  : 'image',                icon        : 'add',                onclick     : function() {                    tag.addElements && tag.addElements();                },                css         : {                    'float'   : that.buttons.align || 'right'                }            });            elements = JSON.parse(tag.getAttribute('data-elements').getValue().replace(/'/g , '"'));            this._htmlObject.children('thead').remove();            Designer.disableTransaction();            for(var i = 0 , elm ; elm = elements[i] ; i++){                var                row,                htmlBtnObj,                htmlLabelObj;                this.addRow([{                    'type'          : 'button',                    'buttonType'    : 'image',                    status          : elm.key                },{                    type        : 'label',                    html        : elm.value,                    value       : elm.value                }], false, false);                row = this.getRows()[i];                row._htmlObject.children('td').css({                    padding : 0                });                row._element = elm;                htmlBtnObj = row.getItems()[0].htmlObject;                if(elm.key == '|'){                    htmlBtnObj.addClass('mce_separator');                    htmlBtnObj.css('background-image' , 'url(/walib/WAF/widget/tinymce/icons/separator.png) !important');                }                else if(elm.key == '_'){                    htmlBtnObj.addClass('mce_line');                    htmlBtnObj.css('background-image' , 'url(/walib/WAF/widget/tinymce/icons/line.png) !important');                }                else if(elm.key in {                    'forecolor' :  '' ,                    'backcolor' :  '' ,                    'fontselect' :  '' ,                    'fontsizeselect' :  '' ,                    'formatselect' :  '' ,                    'styleselect' :  '' ,                    'tablecontrols' :  ''                } ){                    htmlBtnObj.addClass('mce_' + elm.key);                    htmlBtnObj.css('background-image' , 'url(/walib/WAF/widget/tinymce/icons/' + elm.key + '.png) !important');                    if(elm.key in {                        'fontselect' :  '' ,                        'fontsizeselect' :  '' ,                        'formatselect' :  '' ,                        'styleselect' :  ''                    }){                        htmlBtnObj.width(60);                    }                }                else{                    htmlBtnObj.addClass('mce_' + elm.key);                    htmlBtnObj.css('background-image' , 'url(/walib/WAF/widget/tinymce/icons/icons.gif) !important');                }                htmlLabelObj = row.getItems()[1].htmlObject;                htmlLabelObj.parent().css({                    'text-align'    : 'left'                });            }            Designer.enableTransaction();        },        columns         : [{            title       : 'icon',            name        : 'key',            type        : 'button'        },{            title       : 'description',            name        : 'value',            type        : 'label'        }],        onsave    : function(data){        },        onchange : function(){        }    }    ],    style: [    {        name        : 'width',        defaultValue: '660px'    },    {        name        : 'height',        defaultValue: '280px'    }],    events: [    {        name       : 'onClick',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'onDblClick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'onMouseDown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'onMouseUp',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'onKeyDown',        description: 'On Key Down',        category   : 'Key Events'    },    {        name       : 'onKeyPress',        description: 'On Key Press',        category   : 'Key Events'    },    {        name       : 'onKeyUp',        description: 'On Key Up',        category   : 'Key Events'    },    {        name       : 'onInit',        description: 'On Init',        category   : 'Editor Events'    },    {        name       : 'onActivate',        description: 'On Activate',        category   : 'Editor Events'    },    {        name       : 'onContextMenu',        description: 'On Contextual Menu',        category   : 'Editor Events'    },    {        name       : 'onSubmit',        description: 'On Submit',        category   : 'Editor Events'    },    {        name       : 'onPaste',        description: 'On Paste',        category   : 'Editor Events'    },    {        name       : 'onBeforeGetContent',        description: 'On Before Get Content',        category   : 'Editor Events'    },    {        name       : 'onSetContent',        description: 'On Set Content',        category   : 'Editor Events'    }    ],    properties: {        style: {            theme       : false,                 // false to not display the "Theme" option in the "Theme & Class" section            fClass      : true,                 // true to display the "Class" option in the "Theme & Class" section            text        : false,                 // true to display the "Text" section            background  : false,                 // true to display widget "Background" section            border      : true,                 // true to display widget "Border" section            sizePosition: true,                 // true to display widget "Size and Position" section            label       : true,                 // true to display widget "Label Text" and "Label Size and Position" sections            disabled     : ['border-radius']     // list of styles settings to disable for this widget        }    },    structure: [],    onInit: function (config) {        var widget = new WAF.widget.TinyMCE(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        wysiwygConf,        elements,        textArea,        htmlObj;        textArea = $('<textarea>');        htmlObj = tag.getHtmlObject();        htmlObj.empty();        textArea.prop('id' , htmlObj.prop('id') + '-textarea');        textArea.appendTo(htmlObj);        elements = JSON.parse(config['data-elements'].replace(/'/g,'"'));        // Init the tinyMCE        wysiwygConf = {            mode : "exact",            elements : textArea.prop('id'),            resizable : "no",            plugins : "autolink,lists,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,autosave",            theme : "advanced",            theme_advanced_toolbar_location : config['data-toolbar-location'],            theme_advanced_toolbar_align : config['data-toolbar-align'],            theme_advanced_resizing : false,            width   : '100%',            height  : '100%',            constrain_menus : true,            skin : "o2k7",            skin_variant : "silver",            oninit : function(){                var                cm,                inst;                $('#' + config['id'] + '-textarea_ifr').remove();                $('.mceIcon').click(function(){                    return false;                });                inst    = tinyMCE.getInstanceById(htmlObj.prop('id') + '-textarea');                cm      = inst.controlManager;                cm.setDisabled('forecolor',true);                cm.setDisabled('styleselect',true);                cm.setDisabled('formatselect',true);                cm.setDisabled('fontselect',true);                cm.setDisabled('fontsizeselect',true);                cm.setDisabled('backcolor',true);            }        };        for(var i = 0 , element , j = 1 , k = 0 ; element = elements[i] ; i++ , k++){            wysiwygConf['theme_advanced_buttons' + j] = wysiwygConf['theme_advanced_buttons' + j] || "";            if(element.key === '_'){                j++;                k = -1;                continue;            }            if(k>0){                wysiwygConf['theme_advanced_buttons' + j] += ',';            }            wysiwygConf['theme_advanced_buttons' + j] += element.key;        }        wysiwygConf['theme_advanced_buttons' + (j + 1)] = "";        tinyMCE.init(wysiwygConf);    },    onCreate : function(tag, param){        var        label    = tag.getLabel();        tinyMCEScript = Designer.env.document.getElementsByAttribute('script', 'src', '/waLib/WAF/lib/tiny_mce/tiny_mce.js');        if(!param._isLoaded){            label.getAttribute('data-valign')&& label.getAttribute('data-valign').setValue('top');            label.onDesign(true);            label.domUpdate();        }        if(tinyMCEScript.length === 0){            var script = Designer.env.document.createElement('script');            script.setAttribute('type', 'text/javascript');            script.setAttribute('src', '/waLib/WAF/lib/tiny_mce/tiny_mce.js');            Designer.env.document.body.appendChild(script);        }        tag.allElements = [        {            'key'	: 'save',            'value'	: 'Save'        },{            'key'	: 'newdocument',            'value'	: 'New Document'        },{            'key'	: 'bold',            'value'	: 'Bold'        },{            'key'	: 'italic',            'value'	: 'Italic'        },{            'key'	: 'underline',            'value'	: 'Underline'        },{            'key'	: 'strikethrough',            'value'	: 'Strike Through'        },{            'key'	: 'justifyleft',            'value'	: 'Justify To Left'        },{            'key'	: 'justifycenter',            'value'	: 'Justify To Center'        },{            'key'	: 'justifyright',            'value'	: 'Justify To Right'        },{            'key'	: 'justifyfull',            'value'	: 'Full Justify'        },{            'key'	: 'styleselect',            'value'	: 'Style Selector'        },{            'key'	: 'formatselect',            'value'	: 'Format Selector'        },{            'key'	: 'fontselect',            'value'	: 'Font Selector'        },{            'key'	: 'fontsizeselect',            'value'	: 'Font Size Selector'        },{            'key'	: 'cut',            'value'	: 'Cut'        },{            'key'	: 'copy',            'value'	: 'Copy'        },{            'key'	: 'paste',            'value'	: 'Paste'        },{            'key'	: 'pastetext',            'value'	: 'Paste as Plain Text'        },{            'key'	: 'pasteword',            'value'	: 'Paste from Word'        },{            'key'	: 'search',            'value'	: 'Find'        },{            'key'	: 'replace',            'value'	: 'Find/Replace'        },{            'key'	: 'bullist',            'value'	: 'Bulleted List'        },{            'key'	: 'numlist',            'value'	: 'Numbred List'        },{            'key'	: 'outdent',            'value'	: 'Decrease Indent'        },{            'key'	: 'indent',            'value'	: 'Increase Indent'        },{            'key'	: 'blockquote',            'value'	: 'Block Quote'        },{            'key'	: 'undo',            'value'	: 'Undo'        },{            'key'	: 'redo',            'value'	: 'Redo'        },{            'key'	: 'link',            'value'	: 'Links'        },{            'key'	: 'unlink',            'value'	: 'Unlink'        },{            'key'	: 'anchor',            'value'	: 'Anchors'        },{            'key'	: 'image',            'value'	: 'Images'        },{            'key'	: 'cleanup',            'value'	: 'Cleanup Messy Code'        },{            'key'	: 'help',            'value'	: 'Help'        },{            'key'	: 'code',            'value'	: 'HTML Source'        },{            'key'	: 'insertdate',            'value'	: 'Insert Date'        },{            'key'	: 'inserttime',            'value'	: 'Insert Time'        },{            'key'	: 'preview',            'value'	: 'Preview'        },{            'key'	: 'forecolor',            'value'	: 'Text Color'        },{            'key'	: 'backcolor',            'value'	: 'Background Color'        },{            'key'	: 'tablecontrols',            'value'	: 'Table Controls'        },{            'key'	: 'hr',            'value'	: 'Horizontal Line'        },{            'key'	: 'removeformat',            'value'	: 'Remove Formatting'        },{            'key'	: 'visualaid',            'value'	: 'show/Hide Elements'        },{            'key'	: 'sub',            'value'	: 'Subscript'        },{            'key'	: 'sup',            'value'	: 'Superscript'        },{            'key'	: 'charmap',            'value'	: 'Special Character'        },{            'key'	: 'emotions',            'value'	: 'Emotions'        },{            'key'	: 'iespell',            'value'	: 'iespell'        },{            'key'	: 'media',            'value'	: 'Embedded Media'        },{            'key'	: 'advhr',            'value'	: 'Horizontal Line'        },{            'key'	: 'print',            'value'	: 'Print'        },{            'key'	: 'ltr',            'value'	: 'Left To Right'        },{            'key'	: 'rtl',            'value'	: 'Right To Left'        },{            'key'	: 'fullscreen',            'value'	: 'Full Screen'        },{            'key'	: 'insertlayer',            'value'	: 'Layers'        },{            'key'	: 'moveforward',            'value'	: 'Move Forward'        },{            'key'	: 'movebackward',            'value'	: 'Move Backward'        },{            'key'	: 'absolute',            'value'	: 'Absolute'        },{            'key'	: 'styleprops',            'value'	: 'Style Properties'        },{            'key'	: 'spellchecker',            'value'	: 'Spell Checker'        },{            'key'	: 'cite',            'value'	: 'Citation'        },{            'key'	: 'abbr',            'value'	: 'Abbreviation'        },{            'key'	: 'acronym',            'value'	: 'Acronym'        },{            'key'	: 'del',            'value'	: 'Deletion'        },{            'key'	: 'ins',            'value'	: 'Insertion'        },{            'key'	: 'attribs',            'value'	: 'Attributes'        },{            'key'	: 'visualchars',            'value'	: 'Visual Control Characters'        },{            'key'	: 'nonbreaking',            'value'	: 'Non-Breaking Space Character'        },{            'key'	: 'template',            'value'	: 'Template'        },{            'key'	: 'blockquote',            'value'	: 'Block Quotes'        },{            'key'	: 'pagebreak',            'value'	: 'Page Break'        },{            'key'   : '_',            'value' : 'New Line'        },{            'key'   : '|',            'value' : 'Separator'        }];        /**         *         */        tag.getElementByKey = function get_element_by_key(key){            for(var i = 0 , item ; item = tag.allElements[i] ; i++){                if(item.key === key){                    return item;                }            }            return null;        }        /**         *         */        tag.afterDestroy = function after_destroy(key){            var tinyMCEScripts = Designer.env.document.getElementsByAttribute('script', 'src', '/waLib/WAF/lib/tiny_mce/tiny_mce.js');            if(Designer.env.tag.list.countByType(this.getType()) === 0){                $.each(tinyMCEScripts , function(){                    this.remove();                })            }        }        /**         *         */        tag.getDisplayedElements = function get_displayed_elements(){            var            elements;            elements = JSON.parse(tag.getAttribute('data-elements').getValue().replace(/'/g , '"'));            return elements;        }        /**         *         */        tag.getDisplayedByKey = function get_displayed_by_key(key){            var            displayedElements;            displayedElements = tag.getDisplayedElements();            for(var i = 0 , item ; item = displayedElements[i] ; i++){                if(item.key === key){                    return item;                }            }            return null;        }        /**         *         */        tag.getAllElements = function get_all_elements(){            var            i,            res,            element,            elements,            displayedElements;            res = [];            elements = tag.allElements;            displayedElements = tag.getDisplayedElements();            for(i = 0 ; element = displayedElements[i] ; i++){                element.display = true;                res.push(element);            }            for(i = 0 ; element = elements[i] ; i++){                if(tag.getDisplayedByKey(element.key)){                    continue;                }                else {                    element.display = false;                    res.push(element);                }            }            return res;        }        /**         *         */        tag.addElements = function add_elemets(){            var            id,            body,            dialog,            elements,            divElements;            dialog      = null;            body        = $('<div>');            divElements = $('<div>').prop({                'class' : "divElements"            }).appendTo(body);            elements = $('<ul>').prop({                'class' : "defaultSkin"            }).appendTo(divElements);            elements.sortable();            id  = 'waf-dialog-tinymce-modify-elements';            if (document.getElementById(id)) {                dialog = $("#" + id);            } else {                dialog = $('<div>');            }            dialog.prop({                "id"        : id,                "class"     : 'waf-form waf-tinymce-dialog',                "title"     : 'Select the elements to include and click OK'            });            dialog.appendTo($('body'));            //Construct the elements            $.each(tag.getAllElements(),function(key,item){                var                li,                span;                li = $('<li>').appendTo(elements);                span = $('<span>').appendTo(li);                span.prop('title' , item.value)                if(item.key != '|' && item.key != '_'){                    span.addClass('mce_' + item.key);                }                else if(item.key == '|'){                    span.addClass('mce_separator');                }                else if(item.key == '_'){                    span.addClass('mce_line');                }                else if(item.key == 'forecolor'){                    span.addClass('mce_forecolor');                }                span.click(function(){                    $(this).toggleClass('selected');                })                .data({                    key     : item.key,                    value   : item.value                });                if(item.display){                    span.addClass('selected');                }            });            dialog.            html(body).            dialog({                resizable : false,                modal     : true,                width     : 500,                minHeight : 0,                close     : function(event, ui) {                    $(this).dialog('destroy');                },                buttons: {                    'Select All' : function(){                        var                        nbNewLines;                        nbNewLines = elements.find('li span.mce_line').length;                        if(nbNewLines <= 1){                            var                            nbElements;                            nbElements = elements.find('span').length;                            for(var i = 1 ; i*20 < nbElements ; i++ ){                                var                                li,                                span;                                li = $('<li>');                                span = $('<span>').appendTo(li);                                span                                .addClass('mce_line selected')                                .click(function(){                                    $(this).toggleClass('selected');                                })                                .data({                                    key     : '_',                                    value   : 'New Line'                                });                                li.insertAfter(elements.find('li').eq(i*20));                            }                        }                        elements.find('span').addClass('selected');                    },                    'Deselect All' : function(){                        elements.find('span').removeClass('selected');                    },                    'Insert Line' : function(){                        var                        li,                        span;                        li = $('<li>').appendTo(elements);                        span = $('<span>').appendTo(li);                        span                        .addClass('mce_line selected')                        .click(function(){                            $(this).toggleClass('selected');                        })                        .data({                            key     : '_',                            value   : 'New Line'                        });                    },                    'Insert Separator' : function(){                        var                        li,                        span;                        li = $('<li>').appendTo(elements);                        span = $('<span>').appendTo(li);                        span                        .addClass('mce_separator selected')                        .click(function(){                            $(this).toggleClass('selected');                        })                        .data({                            key     : '|',                            value   : 'Separator'                        });                    },                    'Cancel'  : function() {                        $(this).dialog('destroy');                    },                    'OK' : function() {                        var                        selected,                        newElems;                        selected = elements.find('.selected');                        newElems = [];                        $.each(selected , function(){                            var                            data;                            data = $(this).data();                            newElems.push({                                key     : data.key,                                value   : data.value                            })                        });                        tag.getAttribute('data-elements').setValue(JSON.stringify(newElems));                        D.tag.refreshPanels();                        tag.onDesign(true);                        $(this).dialog('destroy');                    }                }            });            return dialog;        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/frame/widget-frame.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'Frame',    {    },    function WAFWidget(config, data, shared) {        var        url,        that,        frame,        htmlObj,        sourceAtt;        htmlObj     = this.$domNode;        frame       = $('#' + config.id + '-frame');        sourceAtt   = this.sourceAtt;        that        = this;        if(frame.length < 1 ){            frame     = $('<iframe>');            frame.attr({                id      : config.id + '-frame',                src     : config['data-src'],                width   : '100%',                height  : '100%'            });            frame.css({                top         : 0,                left        : 0            });            htmlObj.append(frame);            frame.load(function(e){                var                myEvent = $.extend(true, e, $.Event("onLoad"));                $(that).trigger(myEvent);            });            if (sourceAtt) {                sourceAtt.addListener(function(e) {                    var                    widget;                    widget  = e.data.widget;                    url     = widget.getFormattedValue();                    frame.attr('src' , url);                    if(widget.events && widget.events.onLoad){                        frame.load(that.events.onLoad);                    }                },{},{                    widget:this                });            }        }    },    {        getFrame : function(){            return $('#' + this.id + '-frame');        },        getSourcePage : function(){            return this.getFrame().attr('src');        },        load : function(url){            this.getFrame().attr('src' , url);        },        clear : function(){            this.getFrame().removeAttr('src');        },        setValue : function(url){            this.load(url);        },        getValue : function(){            return this.getSourcePage();        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/frame/widget-frame-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'frame',    lib         : 'WAF',    description : 'Frame',    category    : 'Containers/Placeholders',    css         : [],    include     : [],    tag         : 'div',    attributes  : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'top'    },    {        name        : 'data-src',        description : 'Source Page'    }    ],    style: [    {        name        : 'width',        defaultValue: '200px'    },    {        name        : 'height',        defaultValue: '200px'    }],    events: [        {            name       : 'onLoad',            description: 'On Load',            category   : 'UI Events'        }    ],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : true,            disabled     : []        }    },    structure: [],    onInit: function (config) {        var widget = new WAF.widget.Frame(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        div,        link,        frame,        htmlObj;        htmlObj = tag.getHtmlObject();        div     = $('#' + tag.getId() + '-div');        frame   = $('#' + tag.getId() + '-frame');        if(frame.length < 1 ){            frame     = $('<iframe>');            frame.attr({                id      : tag.getId() + '-frame',                src     : tag.getAttribute('data-src').getValue(),                width   : '100%',                height  : '100%'            });            frame.css({                top         : 0,                left        : 0            });            htmlObj.append(frame);        }        if(div.length < 1 ){            div     = $('<div>');            div.attr({                id      : tag.getId() + '-div'            });            div.css({                position    : 'absolute',                top         : 0,                left        : 0,                bottom      : 0,                right       : 0            });            htmlObj.append(div);        }        if (tag.getAttribute('data-src').getValue() != '') {            htmlObj.attr({                src     : tag.getAttribute('data-src').getValue()            })        }    },    onCreate : function (tag, param) {        /*         * Widget custom on file drop event         * Set path         */        $(tag).bind('onFileDrop', function(e, data) {            var            tag;            tag = this;            tag.getAttribute('data-src').setValue(data.path.cropedPath);            /*             * Set focus             */            tag.setCurrent();            tag.onDesign(true);            tag.domUpdate();            D.tag.refreshPanels();        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/video/widget-video.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'Video',    {    },    function WAFWidget(config, data, shared) {        var        url,        link,        video,        htmlObj,        sourceAtt;        htmlObj     = this.$domNode;        sourceAtt   = this.sourceAtt;        htmlObj.empty();        switch(config['data-from']){            case 'local' :                config['data-local-url']        = config['data-local-url']          || '';                config['data-local-poster']     = config['data-local-poster']       || '';                config['data-local-preload']    = config['data-local-preload']      == 'true';                config['data-local-muted']      = config['data-local-muted']        == 'true';                config['data-autoplay']         = config['data-autoplay']           == 'true';                config['data-loop']             = config['data-loop']               == 'true';                config['data-controls']         = config['data-controls']           == 'true';                video   = $('<video>');                video.attr({                    width   : '100%',                    height  : '100%'                });                if(config['data-local-muted'] && config['data-local-muted'] != ''){                    video.attr('muted', 'muted');                }                if(config['data-local-poster'] && config['data-local-poster'] != ''){                    video.attr('poster', config['data-local-poster']);                }                if(config['data-local-preload'] && config['data-local-preload'] != ''){                    video.attr('preload', 'preload');                }                if(config['data-autoplay'] && config['data-autoplay'] != ''){                    video.attr('autoplay', 'autoplay');                }                if(config['data-loop'] && config['data-loop'] != ''){                    video.attr('loop', 'loop');                }                if(config['data-controls'] && config['data-controls'] != ''){                    video.attr('controls', 'controls');                }                if(config['data-local-url'] != ''){                    video.attr('src',config['data-local-url']);                }                video.appendTo(htmlObj);                break;            case 'youtube' :                config['data-youtube-id']       = config['data-youtube-id']         || '';                config['data-youtube-start']    = config['data-youtube-start']      || '0';                config['data-youtube-autohide'] = config['data-youtube-autohide']   == 'true' ? 1 : 0;                config['data-autoplay']         = config['data-autoplay']           == 'true' ? 1 : 0;                config['data-loop']             = config['data-loop']               == 'true' ? 1 : 0;                config['data-controls']         = config['data-controls']           == 'true' ? 1 : 0;                video   = $('<iframe>');                video.attr({                    width   : '100%',                    height  : '100%'                });                if(config['data-youtube-id'] != ''){                    link    = 'http://www.youtube.com/embed/';                    link    += config['data-youtube-id'];                    link    += '?autohide=' + config['data-youtube-autohide'];                    link    += '&autoplay=' + config['data-autoplay'];                    link    += '&loop='     + config['data-loop'];                    link    += '&controls=' + config['data-controls'];                    link    += '&start='    + config['data-youtube-start'];                    link    += '&theme=light';                    video.attr('src',link);                }                if (sourceAtt) {                    sourceAtt.addListener(function(e) {                        link = e.data.widget.getFormattedValue();                        if(link == ""){                            return;                        }                        link    = 'http://www.youtube.com/embed/' + link;                        link    += '?autohide=' + config['data-youtube-autohide'];                        link    += '&autoplay=' + config['data-autoplay'];                        link    += '&loop='     + config['data-loop'];                        link    += '&controls=' + config['data-controls'];                        link    += '&start='    + config['data-youtube-start'];                        link    += '&theme=light';                        video.attr({                            src : link                        });                    },{},{                        widget:this                    });                }                video.appendTo(htmlObj);                break;            case 'vimeo' :                config['data-vimeo-id']       = config['data-vimeo-id']         || '';                config['data-vimeo-title']    = config['data-vimeo-title']      == 'true' ? 1 : 0;                config['data-vimeo-byline']   = config['data-vimeo-byline']     == 'true' ? 1 : 0;                config['data-vimeo-portrait'] = config['data-vimeo-portrait']   == 'true' ? 1 : 0;                config['data-autoplay']       = config['data-autoplay']         == 'true' ? 1 : 0;                config['data-loop']           = config['data-loop']             == 'true' ? 1 : 0;                video   = $('<iframe>');                video.attr({                    width   : '100%',                    height  : '100%'                });                if(config['data-vimeo-id'] != ''){                    link    = 'http://player.vimeo.com/video/';                    link    += config['data-vimeo-id'];                    link    += '?autohide=' + config['data-vimeo-autohide'];                    link    += '&title='    + config['data-vimeo-title'];                    link    += '&byline='   + config['data-vimeo-byline'];                    link    += '&portrait=' + config['data-vimeo-portrait'];                    link    += '&autoplay=' + config['data-autoplay'];                    link    += '&loop='     + config['data-loop'];                    video.attr('src',link);                    video.appendTo(htmlObj);                }                if (sourceAtt) {                    sourceAtt.addListener(function(e) {                        link = e.data.widget.getFormattedValue();                        if(link == ""){                            return;                        }                        link    = 'http://player.vimeo.com/video/' + link;                        link    += config['data-vimeo-id'];                        link    += '?autohide=' + config['data-vimeo-autohide'];                        link    += '&title='    + config['data-vimeo-title'];                        link    += '&byline='   + config['data-vimeo-byline'];                        link    += '&portrait=' + config['data-vimeo-portrait'];                        link    += '&autoplay=' + config['data-autoplay'];                        link    += '&loop='     + config['data-loop'];                        video.attr({                            src : link                        });                    },{},{                        widget:this                    });                }                video.appendTo(htmlObj);                break;        }    },    {    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/video/widget-video-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'video',    lib         : 'WAF',    description : 'Video',    category    : 'Misc. Controls',    css         : [],    include     : [],    tag         : 'div',    attributes  : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'top'    },    {        name        : 'data-from',        description : 'From',        defaultValue: 'youtube',        type        : 'combobox',        options     : [        {            key     : 'local',            value   : 'Local Source'        },        {            key     : 'youtube',            value   : 'YouTube'        },        {            key     : 'vimeo',            value   : 'Vimeo'        }        ],        onchange    : function(e){            var            tag;            tag = this.data.tag;            tag.getAttribute(this.data.aName).setValue(this.getValue());            D.tag.refreshPanels();        }    },    {        name        : 'data-autoplay',        visibility  : 'hidden'    },    {        name        : 'data-loop',        visibility  : 'hidden'    },    {        name        : 'data-controls',        visibility  : 'hidden'    },    {        name        : 'data-local-url',        visibility  : 'hidden'    },    {        name        : 'data-local-muted',        visibility  : 'hidden'    },    {        name        : 'data-local-poster',        visibility  : 'hidden'    },    {        name        : 'data-local-preload',        visibility  : 'hidden'    },    {        name        : 'data-youtube-id',        visibility  : 'hidden'    },    {        name        : 'data-youtube-start',        visibility  : 'hidden'    },    {        name        : 'data-youtube-autohide',        visibility  : 'hidden'    },    {        name        : 'data-vimeo-id',        visibility  : 'hidden'    },    {        name        : 'data-vimeo-title',        visibility  : 'hidden',        defaultValue: 'true'    },    {        name        : 'data-vimeo-byline',        visibility  : 'hidden',        defaultValue: 'true'    },    {        name        : 'data-vimeo-portrait',        visibility  : 'hidden',        defaultValue: 'true'    }    ],    style: [    {        name        : 'width',        defaultValue: '500px'    },    {        name        : 'height',        defaultValue: '280px'    }],    events: [    ],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            label       : true,            disabled     : []        }    },    structure: [],    onInit: function (config) {        var widget = new WAF.widget.Video(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        link,        video,        htmlObj,        overlay;        htmlObj = tag.getHtmlObject();        htmlObj.empty();        switch(config['data-from']){            case 'local' :                config['data-local-url']        = config['data-local-url']          || '';                config['data-local-muted']      = config['data-local-muted']        || '0';                config['data-local-poster']     = config['data-local-poster']       == 'true';                config['data-local-preload']    = config['data-local-preload']      == 'true';                config['data-autoplay']         = config['data-autoplay']           == 'true';                config['data-loop']             = config['data-loop']               == 'true';                config['data-controls']         = config['data-controls']           == 'true';                if(config['data-local-url'] != ''){                    if (config['data-local-url']) {                        link    = Designer.util.cleanPath(config['data-local-url'].replace('/', ''));                        link    = link.fullPath;                    }                    video   = $('<video>');                    video.attr({                        width   : '100%',                        height  : '100%',                        src     : link                    });                    if(config['data-local-muted'] && config['data-local-muted'] != ''){                        video.attr('muted', 'muted');                    }                    if(config['data-local-poster'] && config['data-local-poster'] != ''){                        link    = Designer.util.cleanPath(config['data-local-poster'].replace('/', ''));                        link    = link.fullPath;                        video.attr('poster', link);                    }                    if(config['data-local-preload'] && config['data-local-preload'] != ''){                        video.attr('preload', 'preload');                    }                    if(config['data-loop'] && config['data-loop'] != ''){                        video.attr('loop', 'loop');                    }                    if(config['data-controls'] && config['data-controls'] != ''){                        video.attr('controls', 'controls');                    }                    video.appendTo(htmlObj);                }                else{//                    var//                    img;////                    img = $('<img>').css({//                        'vertical-align'    : 'middle',//                        'display'           : 'inline-block'//                    });////                    img.attr({//                        'src'       : '/walib/WAF/widget/video/icons/html5.png',//                        'width'     : '100%',//                        'height'    : '100%'//                    })////                    img.appendTo(htmlObj);                }                break;            case 'youtube' :                config['data-youtube-id']       = config['data-youtube-id']         || '';                config['data-youtube-start']    = config['data-youtube-start']      || '0';                config['data-youtube-autohide'] = config['data-youtube-autohide']   == 'true' ? 1 : 0;                config['data-autoplay']         = config['data-autoplay']           == 'true' ? 1 : 0;                config['data-loop']             = config['data-loop']               == 'true' ? 1 : 0;                config['data-controls']         = config['data-controls']           == 'true' ? 1 : 0;                if(config['data-youtube-id'] != ''){                    video   = $('<iframe>');                    overlay = $('#' + tag.getId() + '-div');                    link    = 'http://www.youtube.com/embed/';                    link    += config['data-youtube-id'];                    link    += '?autohide=' + config['data-youtube-autohide'];                    link    += '&loop='     + config['data-loop'];                    link    += '&controls=' + config['data-controls'];                    link    += '&start='    + config['data-youtube-start'];                    link    += '&theme=light';                    video.attr({                        width   : '100%',                        height  : '100%',                        src     : link                    });                    overlay.css({                        width   : '100%',                        height  : '100%',                        top     : 0,                        left    : 0                    });                    video.appendTo(htmlObj);                    if(overlay.length < 1 ){                        overlay     = $('<div>');                        overlay.attr({                            id      : tag.getId() + '-div'                        });                        overlay.css({                            position    : 'absolute',                            top         : 0,                            left        : 0,                            bottom      : 0,                            right       : 0                        });                        htmlObj.append(overlay);                    }                }                else{                    img = $('<img>').css({                        'vertical-align'    : 'middle',                        'display'           : 'inline-block'                    });                    img.attr({                        'src'       : '/walib/WAF/widget/video/icons/youtube.png',                        'width'     : '100%',                        'height'    : '100%'                    })                    img.appendTo(htmlObj);                }                break;            case 'vimeo' :                config['data-vimeo-id']       = config['data-vimeo-id']         || '';                config['data-vimeo-title']    = config['data-vimeo-title']      == 'true' ? 1 : 0;                config['data-vimeo-byline']   = config['data-vimeo-byline']     == 'true' ? 1 : 0;                config['data-vimeo-portrait'] = config['data-vimeo-portrait']   == 'true' ? 1 : 0;                config['data-autoplay']       = config['data-autoplay']         == 'true' ? 1 : 0;                config['data-loop']           = config['data-loop']             == 'true' ? 1 : 0;                if(config['data-vimeo-id'] != ''){                    video   = $('<iframe>');                    overlay = $('#' + tag.getId() + '-div');                    link    = 'http://player.vimeo.com/video/';                    link    += config['data-vimeo-id'];                    link    += '?autohide=' + config['data-vimeo-autohide'];                    link    += '&title='    + config['data-vimeo-title'];                    link    += '&byline='   + config['data-vimeo-byline'];                    link    += '&portrait=' + config['data-vimeo-portrait'];                    link    += '&loop='     + config['data-loop'];                    video.attr({                        width   : '100%',                        height  : '100%',                        src     : link                    });                    video.appendTo(htmlObj);                    if(overlay.length < 1 ){                        overlay     = $('<div>');                        overlay.attr({                            id      : tag.getId() + '-div'                        });                        overlay.css({                            position    : 'absolute',                            top         : 0,                            left        : 0,                            bottom      : 0,                            right       : 0                        });                        htmlObj.append(overlay);                    }                }                else{                    img = $('<img>').css({                        'vertical-align'    : 'middle',                        'display'           : 'inline-block'                    });                    img.attr({                        'src'       : '/walib/WAF/widget/video/icons/vimeo.png',                        'width'     : '100%',                        'height'    : '100%'                    })                    img.appendTo(htmlObj);                }                break;        }    },    onCreate : function (tag, param) {        /*         * Widget custom on file drop event         * Set path         */        $(tag).bind('onFileDrop', function(e, data) {            var            tag,            ext,            path;            tag     = this;            path    = data.path.cropedPath;            ext     = data.file.extension.toLowerCase();            switch(ext) {                /*                 * Case of image files                 */                case 'png'  :                case 'jpg'  :                case 'jpeg' :                case 'gif'  :                case 'ico'  :                    if(tag.getAttribute('data-from').getValue() === 'local'){                        tag.getAttribute('data-local-poster').setValue(path);                    }                    break;                /*                 * Case of video files                 */                case 'webm' :                case 'ogv'  :                case 'ogg'  :                case 'mp4'  :                    if(tag.getAttribute('data-from').getValue() === 'local'){                        tag.getAttribute('data-local-url').setValue(path);                    }                    break;            }            /*             * Set focus             */            tag.setCurrent();            tag.onDesign(true);            tag.domUpdate();            D.tag.refreshPanels();        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/canvas/widget-canvas.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'Canvas',    {    },    function WAFWidget(config, data, shared) {        var        url,        ctx,        that,        width,        height,        canvas,        sourceAtt;        that        = this;        sourceAtt   = that.sourceAtt;        canvas      = that.getCanvas();        $(canvas).attr({            width   : that.getWidth(),            height  : that.getHeight()        });        width       = canvas.width;        height      = canvas.height;        ctx         = that.get2DContext();        ctx.clearRect(0, 0, width, height);        if (sourceAtt) {            sourceAtt.addListener(function(e) {                url = e.data.widget.getFormattedValue();                ctx.clearRect(0, 0, width, height);                if (url == null || url == "") {                    ctx.fillStyle = "rgb(200,0,0)";                    ctx.fillRect(0, 0, width / 2, height / 2);                    ctx.fillStyle = "rgba(0, 50, 200, 0.5)";                    ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);                }                else{                    var img = new Image();                    img.onload = function(){                        ctx.drawImage(img,0,0,width,height);                    };                    img.src = url;                }            },{},{                widget:this            });        }        else if(config['data-src'] && config['data-src'] != ''){            url     = config['data-src'];            var img = new Image();            img.onload = function(){                ctx.drawImage(img,0,0,width,height);            };            img.src = url;        }        else{            ctx.fillStyle = "rgb(200,0,0)";            ctx.fillRect(0, 0, width / 2, height / 2);            ctx.fillStyle = "rgba(0, 50, 200, 0.5)";            ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);        }    },    {        get2DContext : function(){            var            ctx,            canvas;            canvas  = this.$domNode[0];            ctx     = canvas.getContext("2d");            return ctx;        },        getCanvas : function(){            return this.$domNode[0];        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/canvas/widget-canvas-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type        : 'canvas',    lib         : 'WAF',    description : 'Canvas',    category    : 'Misc. Controls',    css         : [],    include     : [],    tag         : 'canvas',    attributes  : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'top'    },    {        name       : 'data-src',        description: 'Src',        type       : 'file',        accept     : 'image/*'    }    ],    style: [    {        name        : 'width',        defaultValue: '294px'    },    {        name        : 'height',        defaultValue: '211px'    }],    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mousemove',        description: 'On Mouse Move',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    },    {        name       : 'touchstart',        description: 'On Touch Start',        category   : 'Touch Events'    },    {        name       : 'touchend',        description: 'On Touch End',        category   : 'Touch Events'    },    {        name       : 'touchcancel',        description: 'On Touch Cancel',        category   : 'Touch Events'    }    ],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            dropShadow  : true,            innerShadow : true,            sizePosition: true,            label       : true,            disabled     : []        }    },    structure: [],    onInit: function (config) {        var widget = new WAF.widget.Canvas(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        ctx,        url,        path,        width,        canvas,        height,        myFile,        imgSource;        imgSource   = tag.getAttribute('data-src').getValue();        myFile      = {};        canvas      = tag.getHtmlObject()[0];        width       = canvas.width;        height      = canvas.height;        ctx         = canvas.getContext("2d");        ctx.clearRect(0, 0, width, height);        if (imgSource) {            path    = Designer.util.cleanPath(imgSource.replace('/', ''));            url     = path.fullPath;        }        if (typeof(studio) != 'undefined' && url) {            myFile = studio.File(url);        }        if (url && myFile.exists){            var img = new Image();            img.onload = function(){                ctx.drawImage(img,0,0,width,height);            };            img.src = url;        }        else{            ctx.fillStyle = "rgb(200,0,0)";            ctx.fillRect(0, 0, width / 2, height / 2);            ctx.fillStyle = "rgba(0, 50, 200, 0.5)";            ctx.fillRect(width / 2 - width / 6, height / 2 - height / 6, width / 2 + width / 6, height / 2 + height / 6);        }    },    onCreate : function (tag, param) {        /*         * Widget custom on file drop event         * Set path         */        $(tag).bind('onFileDrop', function(e, data) {            var            tag,            ext;            tag = this;            ext = data.file.extension.toLowerCase();            switch(ext) {                case 'png'  :                case 'jpg'  :                case 'jpeg' :                case 'gif'  :                case 'ico'  :                    tag.getAttribute('data-src').setValue(data.path.cropedPath);                    /*                     * Set focus                     */                    tag.setCurrent();                    tag.onDesign(true);                    tag.domUpdate();                    D.tag.refreshPanels();                    break;            }        });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/login/widget-login.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.Widget.provide(    /**     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'Login',    {    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var loginManager = this;        var htmlObject = $(this.containerNode);		loginManager.labels = {};		loginManager.labels.userLabel = config['data-user-label'] || "";		loginManager.labels.passwordLabel = config['data-password-label'] || "";		loginManager.labels.loginButton = config['data-login-button'] || "";		loginManager.labels.loginTitle = config['data-login-title'] || "";		loginManager.labels.userDisplay = config['data-user-display'] || "";		loginManager.labels.noUserDisplay = config['data-no-user-display'] || "";		loginManager.labels.loginAction = config['data-login-action'] || "";		loginManager.labels.logoutAction = config['data-logout-action'] || "";		loginManager.inDesign = config.inDesign || false;		loginManager.dialogWidget = null;		loginManager.dialog = null;		if (loginManager.inDesign)			loginManager.refresh();		else			setTimeout( function() { loginManager.refresh() }, 100 );    },{        showLoginDialog: function login_show_login_dialog() {			var loginManager = this;			var htmlObject  = $(this.containerNode);			var html = "";			function loginButton(event)			{				var userNameRef = $(".waf-login-dialog-user input", loginManager.dialog);				var userName = userNameRef.val();				var passwordRef = $(".waf-login-dialog-password input", loginManager.dialog);				var password = passwordRef.val();				passwordRef.val("");				loginManager.dialog.dialog("close");				loginManager.login(userName, password);			}			if (loginManager.dialog == null)			{				var dataTheme = "";				var existingClasses = htmlObject.prop('class')+" waf-login-dialog";				 existingClasses.split(" ").forEach(function(className) {			        if (className != "inherit" && className.substr(0,4) != "waf-") {			                dataTheme += className+" ";			        }			    });				html += '<div class="waf-widget-body waf-login-body '+dataTheme+'" title="'+loginManager.labels.loginTitle+'">';				html += '<form class="waf-login-form" action="#" methos="POST">';				html += '<div class="waf-login-div waf-login-dialog-user">';				html += '<label class="waf-widget waf-label waf-login-label '+dataTheme+'">' + loginManager.labels.userLabel + '</label>';				html += '<div><input id="name_login_'+loginManager.divID+'" type="text" data-type="textField" data-lib="WAF" class="waf-widget waf-textField '+dataTheme+'" size="20"/></div>';				html += '</div>';				html += '<div class="waf-login-div waf-login-dialog-password">';				html += '<label class="waf-widget waf-label waf-login-label '+dataTheme+'">' + loginManager.labels.passwordLabel + '</label>';				html += '<div>';				html += '<input id="password_login_'+loginManager.divID+'" type="password" data-type="textField" data-lib="WAF" class="waf-widget waf-textField '+dataTheme+'" size="20"/>';				html += '<button id="button_login_'+loginManager.divID+'" class="waf-login-button waf-widget waf-button '+dataTheme+'" data-lib="WAF" data-type="button" data-text="'+loginManager.labels.loginButton+'">';				html += '<span>' + loginManager.labels.loginButton + '</span>';				html += '</button>';				html += '</div>';				html += '</form>';				html += '</div>';				html += '</div>';				var $html = $(html);				$html.addClass(existingClasses);				$html.removeClass("waf-login");				$html.dialog({modal: true, resizable: false});				var dialogWidget = $html.dialog("widget");				dialogWidget					.addClass(dataTheme+" waf-widget waf-login-dialog ")					.find('.ui-widget-header').addClass("waf-widget-header").removeClass('ui-corner-all');				dialogWidget.removeClass("waf-login");				var tabDom      = $('[data-type]', $html);        		for (var i = 0, nbComponent = tabDom.length; i < nbComponent; i++)  {            		var domobj  = tabDom[i];		            WAF.tags.createComponent(domobj, false);        		}				loginManager.dialog = $html;				loginManager.dialogWidget = dialogWidget;				$(".waf-login-button", $html).bind("click", function (event) {					event.preventDefault();					loginButton(event);				});				$(".waf-login-form", $html).bind("submit", function (event) {					event.preventDefault();					loginButton(event);				});			}			else			{				loginManager.dialog.dialog("open");			}		},                /*                 * DEPRECATED                 */                showLogin : function(){                    this.showLoginDialog();                },		login: function login_login(userName, password)		{			var loginManager = this;			WAF.directory.login({onSuccess:function(event) {				loginManager.refresh();				if (event.result === true)				{					if (loginManager.onlogin != null)					{						loginManager.onlogin();					}				}				else					alert("Wrong user or password");			}}, userName, password)		},		logout: function login_logout() {			var loginManager = this;			WAF.directory.logout({onSuccess:function(event) {				loginManager.refresh();				if (loginManager.onlogout != null)				{					loginManager.onlogout();				}			}});		},		refresh : function login_refresh () {        	var  htmlObject  = $(this.containerNode);			var loginManager = this;			function displayLoggedUser(user)			{				var html = "";				if (user == null)				{					html += '<div class="waf-login-user">' + loginManager.labels.noUserDisplay + '</div>'					html += '<div class="waf-login-login"> <a>' + loginManager.labels.loginAction + '</a> </div>';				}				else				{					var text = user.fullName;					if (text == null || text === "")						text = user.userName;					html += '<div class="waf-login-user">' + loginManager.labels.userDisplay + text + '</div>'					html += '<div class="waf-login-logout"><a>' + loginManager.labels.logoutAction + '</a> </div>';				}				htmlObject.html(html);			}			if (loginManager.inDesign)			{				displayLoggedUser({userName:'"userName"', fullName:'"userName"'});			}			else			{	       		WAF.directory.currentUser({onSuccess:function(event)				{					var user = event.result;					displayLoggedUser(user);					var aaa = $('a', htmlObject);					function installClickHandler()					{						aaa = $('a', htmlObject);						if (user == null)						{							aaa.click(function(event) {								loginManager.showLoginDialog();								return false;							});						}						else						{							aaa.click(function(event) {								loginManager.logout();								return false;							});						}					}					if (aaa.length == 0)					{						var xdebug = 1;						setTimeout(installClickHandler, 10);					}					else					{						installClickHandler();					}				}});			}        }    });/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/login/widget-login-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    type       : 'login',    lib        : 'WAF',    description: 'Login Dialog',    category   : 'Automatic Controls',    img        : '/walib/WAF/widget/login/icons/widget-login.png',    attributes : [    {        name        : 'data-user-label',        description : 'User label',		defaultValue: 'User: ',		category   	: 'Login Dialog'    },	{        name        : 'data-password-label',        description : 'Password label',		defaultValue: 'Password: ',		category   	: 'Login Dialog'    }, 	{        name        : 'data-login-button',        description : 'Login button',		defaultValue: 'Login',		category   	: 'Login Dialog'    }, 	{        name        : 'data-login-title',        description : 'Login dialog title',		defaultValue: 'Login Dialog',		category   	: 'Login Dialog'    },    {        name        : 'data-user-display',        description : 'Current user display',		defaultValue: 'Signed in as ',		category   	: 'Login Status'    },    {        name        : 'data-no-user-display',        description : 'Not logged in display',		defaultValue: '',		category   	: 'Login Status'    }, 	{        name        : 'data-login-action',        description : 'Login text',		defaultValue: 'Login',		category   	: 'Login Status'    },    {        name        : 'data-logout-action',        description : 'Logout text',		defaultValue: 'Logout',		category   	: 'Login Status'    }],    events: [    {        name       : 'login',        description: 'On Login',        category   : 'Login Events'    },    {        name       : 'logout',        description: 'On Logout',        category   : 'Login Events'    }],    style: [    {        name        : 'width',        defaultValue: '185px'    },    {        name        : 'height',        defaultValue: '80px'    }],    properties: {        style: {            theme       : true,            fClass      : true,            text        : true,            background  : true,            border      : true,            sizePosition: true,            label       : true,            shadow      : true        }    },    onInit: function (config) {        var login = new WAF.widget.Login(config);        return login;    },    onDesign: function (config, designer, tag, catalog, isResize) {		if (!isResize)		{			config.inDesign = true;			var login = new WAF.widget.Login(config); 		}    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/splitView/widget-splitView.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    /**     * TODO: Write a description of this WAF widget     *     * @class TODO: give a name to this class (ex: WAF.widget.DataGrid)     * @extends WAF.Widget     */    'splitView', // TODO: set the widget constructor name in CamelCase (ex: "DataGrid")    {    // Shared private properties and methods    // NOTE: "this" is NOT available in this context to access the current to widget instance    // These methods and properties are available from the constrctor through "shared"    // /**    //  * A Private shared Method    //  *    //  * @/private    //  * @/shared    //  * @/method privateSharedMethod    //  * @/param {String} inWidget    //  **/    // privateSharedMethod: function privateSharedMethod(inWidget) {    //    can work on the widget instance through inWidget    // }    },    /**     * @constructor     * @param {Object} inConfig configuration of the widget     */    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     * @default TODO: set to the name to this class (ex: WAF.widget.DataGrid)     **/    function WAFWidget(config, data, shared) {        /*var        containerID = config.id,        $container  = $('#'+containerID),        that        = this;*//*        var eventHandlerFunction = function(event)        {            var widget = event.data.widget;            var source = event.dataSource;        }        if ('source' in this) {        }*/    },    {    /**     * Custom ready function     * @method ready     */    ready : function splitView_ready(){        /*        * put all waf-navigationView-view to 100% to solve resize issue, to double check        */        var widID           = this.id,            $cont           = $("#"+widID),            navViewWidgets  = $(document.body).find(".waf-navigationView"),            navParent       = navViewWidgets.parent();        $.each(navParent, function(index, value) {            window.setTimeout(function(){                 $("#"+value.children[0].id).find(".waf-navigationView-view").get()[0].style.height = "100%";            }, 100);        });    },    onResize: function() {       /* var widID           = this.id,            $cont           = $("#"+widID),            navViewWidgets  = $(document.body).find(".waf-navigationView"),            navParent       = navViewWidgets.parent();        $.each(navParent, function(index, value) { console.log(value.style.visibility)             if ($(value).hasClass("waf-container-split-mobile")) {                window.setTimeout(function(){                    $$(value.children[0].id).onContainerResize();                }, 0);             }        });*/        /*if (backButton.length != 0) {            backButtonWidth = parseInt(backButton.css("width").split("px")[0]);        }        window.setTimeout(function(){            if (!$$(navID).hasBackButton) {                $(menuButton).css("left", "0px");            } else {                $(menuButton).css("left", backButtonWidth + 20 + "px");            }        }, 100);    */    },    // [Prototype]    // The public shared properties and methods inherited by all the instances    // NOTE: "this" is available in this context    // These methods and properties are available from the constructor through "this"    // NOTE 2: private properties and methods are not available in this context    // /**    //  * A Public shared Property    //  *    //  * @/shared    //  * @/property publicSharedProperty    //  **/    // publicSharedProperty: 12,    /**    * goToPreviousView    *    * @/shared    * @/method goToPreviousView    **/    publicMeth: function publicMeth( ) {     }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/splitView/widget-splitView-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    /**    *  Widget Descriptor    *    */    /* PROPERTIES */    // {String} internal name of the widget    type        : 'splitView',    // {String} library used ('waf', 'jquery', 'extjs', 'yui') (optional)    lib         : 'WAF',    // {String} display name of the widget in the GUI Designer    description : 'Split View',    // {String} category in which the widget is displayed in the GUI Designer    category    : 'Containers/Placeholders',    // {String} image of the tag to display in the GUI Designer (optional)    img         : '/walib/WAF/widget/splitView/icons/widget-splitView.png',    // {Array} css file needed by widget (optional)    css         : [],    // {Array} script files needed by widget (optional)    include     : [],    // {String} type of the html tag ('div' by default)    tag         : 'div',    containArea : true,    // {Array} attributes of the widget. By default, we have 3 attributes: 'data-type', 'data-lib', and 'id', so it is unnecessary to add them    //    // @property {String} name, name of the attribute (mandatory)    // @property {String} description, description of the attribute (optional)    // @property {String} defaultValue, default value of the attribute (optional)    // @property {'string'|'radio'|'checkbox'|'textarea'|'dropdown'|'integer'} type, type of the field to show in the GUI Designer (optional)    // @property {Array} options, list of values to choose for the field shown in the GUI Designer (optional)    attributes  : [    {        name            : 'data-theme',        visibility      : 'hidden',        defaultValue    : 'cupertino'    }    ],    // {Array} default height and width of the container for the widget in the GUI Designer    //    // @property {String} name, name of the attribute    // @property {String} defaultValue, default value of the attribute    style: [    {        name        : 'width',        defaultValue: '40px'    },    {        name        : 'height',        defaultValue: '40px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    // {JSON} panel properties widget    //    // @property {Object} enable style settings in the Styles panel in the Properties area in the GUI Designer    properties: {        style: {            theme       : true,                 // false to not display the "Theme" option in the "Theme & Class" section            //    theme : {            //    	roundy: false		//all the default themes are displayed by default. Pass an array with the            //   }				//themes to hide ('default', 'inherited', roundy, metal, light)            fClass      : true,                 // true to display the "Class" option in the "Theme & Class" section            text        : true,                 // true to display the "Text" section            background  : true,                 // true to display widget "Background" section            border      : true,                 // true to display widget "Border" section            sizePosition: true,                 // true to display widget "Size and Position" section            label       : true,                 // true to display widget "Label Text" and "Label Size and Position" sections            // For these two sections, you must also define the "data-label" in the Attributes array            disabled     : ['border-radius']     // list of styles settings to disable for this widget        }    },	structure: [    ],    /* METHODS */    /*    * function to call when the widget is loaded by WAF during runtime    *    * @param {Object} config contains all the attributes of the widget    * @result {WAF.widget.Template} the widget    */    onInit: function (config) {        var widget = new WAF.widget.splitView(config);        return widget;    },    /**    * function to call when the widget is displayed in the GUI Designer    *    * @param {Object} config contains all the attributes for the widget    * @param {Designer.api} set of functions used to be managed by the GUI Designer    * @param {Designer.tag.Tag} container of the widget in the GUI Designer    * @param {Object} catalog of dataClasses defined for the widget    * @param {Boolean} isResize is a resize call for the widget (not currently available for custom widgets)    */    onDesign: function (config, designer, tag, catalog, isResize) {         /*         * Apply theme on widget theme's change         */         tag.onChangeTheme = function(theme) {            var            group;            group = D.getGroup(this.getGroupId());            if (group) {                group.applyTheme(theme, this);            }        }    },    /**     * call the first time in order to build the widget     * @param {Designer.tag.Tag} container of the widget in the GUI Designer     */    onCreate: function ( tag , param) {        $(tag).bind("onReady", function(){            this.fix();            var linkedWidget = this.getLinks();            $.each(linkedWidget, function(index, value) {                value.fix();                console.log(value.getId())            });        });         if (!param._isLoaded) {            $(tag).bind("onWidgetDrop", function(){                this.setXY( 0, 0, true, true );            });            tag.setPositionRight( "0px", false, false );            tag.setPositionBottom( "0px", false, false );            tag.forceTopConstraint();            tag.forceLeftConstraint();            tag.forceBottomConstraint();            tag.forceRightConstraint();            tag.setXY( 0, 0, true, true );            tag.updateZindex (0);            window.setTimeout(function(){                createStructure();            }, 0);         }        function createStructure() {            var            containerDef    = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('container')),            buttonDef       = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('button')),            navViewDef      = Designer.env.tag.catalog.get(Designer.env.tag.catalog.getDefinitionByType('navigationView')),            container       = new Designer.tag.Tag(containerDef),            widID           = tag.getId(),            content,            splittedContainer0,            splittedContainer1;            //the group            tag.group = new Designer.ui.group.Group();            group = tag.group;            group.add(tag);            //content            content = new Designer.tag.Tag(containerDef);            content.create({            width      : tag.getWidth(),            height     : tag.getHeight(),            silentMode : true            });            content.setXY( 0, 0, true );            content.getAttribute("data-hideSplitter").setValue("true");            content.setParent( tag );            content.forceTopConstraint();            content.forceLeftConstraint();            content.setPositionBottom( "0px", false, false );            content.setPositionRight( "0px", false, false );            content.forceBottomConstraint();            content.forceRightConstraint();            group.add(content);            content.fix();            tag.link(content);            //split the main container            content.split({                position: 300            });            //get both the new containers created            splittedContainer0 = content._containers[0];            splittedContainer1 = content._containers[1];            tag.link(splittedContainer0);            tag.link(splittedContainer1);            //navigation view            nav = new Designer.tag.Tag(navViewDef);            nav.create({            width      : splittedContainer0.getWidth(),            height     : splittedContainer0.getHeight(),            silentMode : true,            group      : group            });            nav.setXY( 0, 0, true );            nav.setParent( splittedContainer0 );            nav.forceTopConstraint();            nav.forceLeftConstraint();            nav.forceRightConstraint();            nav.forceBottomConstraint();            nav.setPositionBottom( "0px", false, false );            nav.setPositionRight( "0px", false, false );            //group.add(nav);            //navigation view            nav2 = new Designer.tag.Tag(navViewDef);            nav2.create({            width      : splittedContainer1.getWidth(),            height     : splittedContainer1.getHeight(),            silentMode : true,            group      : group            });            nav2.setXY( 1, 0, true );            nav2.setParent( splittedContainer1 );            nav2.forceTopConstraint();            nav2.forceBottomConstraint();            nav2.forceLeftConstraint();            nav2.forceRightConstraint();            nav2.setPositionBottom( "0px", false, false );            nav2.setPositionRight( "0px", false, false );            //group.add(nav2);            //button            button = new Designer.tag.Tag(buttonDef);            button.create({                width:60,                silentMode : true            });            button.getAttribute("data-text").setValue("Menu");            button.getAttribute("class").setValue("waf-splitView-menuButton")            button.setXY( 100, 7, true );            button.setParent( splittedContainer1 );            //group.add(button);            //set button role            content.getAttribute("data-popup-display-button").setValue(button.getId());            //save group            Designer.ui.group.save();            /*            * Apply theme            */            group.applyTheme(tag.getTheme(), tag);        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/calendar/widget-calendar.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. *///// "use strict";/*global WAF,window*//*jslint white: true, browser: true, onevar: true, undef: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, newcap: true, immed: true, strict: true */WAF.Widget.provide(    'Calendar', // TODO: set the widget constructor name in CamelCase (ex: "DataGrid")    {    },    function WAFWidget(config, data, shared) {        var        that,        sourceAtt,        htmlObject;        that        = this;        htmlObject  = that.$domNode;        sourceAtt   = this.sourceAtt;        htmlObject.DatePicker({            flat        : true,            format      : config['data-format']?config['data-format']:"dd/mm/yy",            date        : config['data-mode'] == "single"?"":[],            calendars   : config['data-calendars'],            mode        : config['data-mode'],            starts      : config['data-start'],            onChange: function(formated , dates) {                if(sourceAtt){                    sourceAtt.setValue(that.getValue());                    if(config['data-save'] === 'true'){                        that.source.save();                    }                }                that.events && that.events.onChange && that.events.onChange({                    formatted : formated ,                    dates : dates                });            },            onShow : function(){                that.events && that.events.onShow && that.events.onShow(arguments)            },            onBeforeShow : function(){                that.events && that.events.onBeforeShow && that.events.onBeforeShow(arguments)            },            onHide : function(){                that.events && that.events.onHide && that.events.onHide(arguments)            },            onViewChange : function(e){                that._update_size();            }        });        if (sourceAtt) {            sourceAtt.addListener(function(e) {                var                widget;                widget  = e.data.widget;                if(widget._modified){                    widget._modified = false;                    return;                }                if(sourceAtt.getValue() && sourceAtt.getValue().getTime() != widget.getValue().getTime()){                    widget.setValue(sourceAtt.getValue() , true);                }            },{},{                widget:this            });        }    },    {        _getDatePicker : function(){            return this.$domNode;        },        _getDatePickerData : function(){            var            htmlObj;            htmlObj = this._getDatePicker();            if(htmlObj){                return htmlObj.children('.datepicker').data('datepicker');            }            return htmlObj;        },        _prepareDate : function (options) {            var tmp, that = this;            if (options.mode == 'single') {                tmp = new Date(options.date);                return [that._formatDate(tmp, options.format), tmp, options.el];            } else {                tmp = [[],[], options.el];                $.each(options.date, function(nr, val){                    var date = new Date(val);                    tmp[0].push(that._formatDate(date, options.format));                    tmp[1].push(date);                });                return tmp;            }        },        _formatDate : function(date, format) {            return $.datepicker.formatDate(format, date);        },        _update_size : function(){            var            htmlObj,            datepicker,            dpContainer;            htmlObj     = this.$domNode;            datepicker  = htmlObj.find('.datepicker');            dpContainer = datepicker.find('.datepickerContainer');            htmlObj.height($(dpContainer.find('tr').get(0)).height() + datepicker.find('.datepickerBorderT').height() + datepicker.find('.datepickerBorderB').height());            htmlObj.width($(dpContainer.find('tr').get(0)).width() + datepicker.find('.datepickerBorderL').width() + datepicker.find('.datepickerBorderR').width());        },        _getCalOptions : function(){            var            cal,            htmlObj;            htmlObj = this._getDatePicker();            cal     = $('#' + htmlObj.data('datepickerId'));            return cal.data('datepicker');        },        setValue : function(date , shiftTo){            var            data,            htmlObj;            if(date == null){                this.clear();                return;            }            htmlObj = this._getDatePicker();            shiftTo = shiftTo == null ? true : shiftTo;            data    = this._getDatePickerData();            if(htmlObj){                htmlObj.DatePickerSetDate(date, shiftTo);                data.onChange.apply(htmlObj.children('.datepicker'), this._prepareDate(data));            }        },        getValue : function(formated){            var            htmlObj;            htmlObj = this._getDatePicker();            if(htmlObj){                return htmlObj.DatePickerGetDate(formated);            }            return htmlObj;        },        show : function(){            var            htmlObj;            htmlObj = this._getDatePicker();            this.$domNode.show();            this.getLabel() && this.getLabel().show();            if(htmlObj){                htmlObj.DatePickerShow();            }        },        hide : function(){            var            htmlObj;            htmlObj = this._getDatePicker();            if(htmlObj){                htmlObj.DatePickerHide();            }            this.$domNode.hide();            this.getLabel() && this.getLabel().hide();        },        clear : function(){            var            htmlObj;            htmlObj = this._getDatePicker();            if(htmlObj){                var                opts;                opts    = this._getCalOptions();                if(opts.mode != 'single'){                    htmlObj.DatePickerClear();                }                else{                    opts.date = null;                    htmlObj.find('.datepickerSelected').removeClass('datepickerSelected');                }            }        },        getSelectionMode : function(){            var            data;            data = this._getDatePickerData();            return data.mode;        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/calendar/widget-calendar-conf.js*//* * This file is part of Wakanda software, licensed by 4D under *  (i) the GNU General Public License version 3 (GNU GPL v3), or *  (ii) the Affero General Public License version 3 (AGPL v3) or *  (iii) a commercial license. * This file remains the exclusive property of 4D and/or its licensors * and is protected by national and international legislations. * In any event, Licensee's compliance with the terms and conditions * of the applicable license constitutes a prerequisite to any use of this file. * Except as otherwise expressly stated in the applicable license, * such license does not include any other license or rights on this file, * 4D's and/or its licensors' trademarks and/or other proprietary rights. * Consequently, no title, copyright or other proprietary rights * other than those specified in the applicable license is granted. */WAF.addWidget({    type        : 'calendar',    description : 'Calendar',    category    : 'Misc. Controls',    tag         : 'div',    attributes  : [    {        name        : 'data-binding',        description : 'Source'    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {        name        : 'data-label-position',        description : 'Label position',        defaultValue: 'left'    },    {        name        : 'data-calendars',        description : 'Views',        defaultValue: 1,        typeValue   : 'integer',        slider      : {            min : 1,            max : 12        },        reloadTag   : true    },    {        name        : 'data-start',        description : 'Start on',        type        : 'combobox',        defaultValue: 1,        options     : [{            key     : 1,            value   : 'Monday'        },{            key     : 2,            value   : 'Tuesday'        },{            key     : 3,            value   : 'Wednesday'        },{            key     : 4,            value   : 'Thursday'        },{            key     : 5,            value   : 'Friday'        },{            key     : 6,            value   : 'Saturday'        },{            key     : 7,            value   : 'Sunday'        }]    },    {        name        : 'data-mode',        description : 'Selection mode',        type        : 'combobox',        options     : [{            key     : 'single',            value   : 'Single'        },{            key     : 'multiple',            value   : 'Multiple'        },{            key     : 'range',            value   : 'Range'        }]    },    {        name        : 'data-format',        description : 'Format',        defaultValue: 'dd/mm/yy',        autocomplete: {            minLength   : 0,            source      :  [            {                value : "MM d, yy",                description : "March 1, 2011"            },            {                value : "d MM yy",                description : "1 March 2011"            },            {                value : "dd/mm/y",                description : "01/03/11"            },            {                value : "dd/mm/yy",                description : "01/03/2011"            },            {                value : "mm/dd/y",                description : "03/01/11"            },            {                value : "mm/dd/yy",                description : "03/01/2011"            },            {                value : "dd/mm",                description : "03/01"            },            {                value : "yy mm dd",                description : "2011 03 03"            },            {                value : "y mm dd",                description : "11 03 03"            }            ],            focus: function( event, ui ) {                $(this).val( ui.item.value );                return false;            },            select: function( event, ui ) {                $(this).val( ui.item.value );                return false;            },            custom: 'catcomplete'        }    },    {        name            : 'data-save',        description     : 'Save automatically',        type            : 'checkbox',        defaultValue    : 'true'    }    ],    style: [    {        name        : 'width',        defaultValue: '180px'    },    {        name        : 'height',        defaultValue: '150px'    }],    events: [    {        name       : 'onShow',        description: 'On Show',        category   : 'Calendar Events'    },    {        name       : 'onBeforeShow',        description: 'On Before Show',        category   : 'Calendar Events'    },    {        name       : 'onHide',        description: 'On Hide',        category   : 'Calendar Events'    },    {        name       : 'onChange',        description: 'On Change',        category   : 'Calendar Events'    },    {        name       : 'click',        description: 'On Click',        category   : 'Mouse Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Mouse Events'    },    {        name       : 'mousedown',        description: 'On Mouse Down',        category   : 'Mouse Events'    },    {        name       : 'mouseout',        description: 'On Mouse Out',        category   : 'Mouse Events'    },    {        name        : 'mouseover',        description: 'On Mouse Over',        category   : 'Mouse Events'    },    {        name       : 'mouseup',        description: 'On Mouse Up',        category   : 'Mouse Events'    }],    structure : [    {        description : 'header',        selector    : '.datepickerHeader span',        style: {            text        : true,            textShadow  : true,            background  : false,            border      : false,            disabled    : ['border-radius' , 'line-height' , 'letter-spacing']        }    },    {        description : 'day name header',        selector    : '.datepickerDoW span',        style: {            text        : true,            textShadow  : true,            background  : false,            border      : false,            disabled    : ['border-radius','line-height' , 'letter-spacing']        }    },       {        description : 'days in month',        group       : 'day view',        selector    : '.datepickerInMonth span',        style: {            text        : true,            textShadow  : true,            background  : false,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    },    {        description : 'days not in month',        group       : 'day view',        selector    : '.datepickerNotInMonth span',        style: {            text        : true,            textShadow  : true,            background  : false,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    },    {        description : 'week numbers',        group       : 'day view',        selector    : '.datepickerWeek span',        style: {            text        : true,            textShadow  : true,            background  : false,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    },    {        description : 'selected day(s)',        group       : 'day view',        selector    : '.datepickerSelected span',        style: {            text        : true,            textShadow  : true,            background  : true,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    },    {        description : 'month',        group       : 'month view',        selector    : '.datepickerMonths tr td a span',        style: {            text        : true,            textShadow  : true,            background  : true,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    },    {        description : 'year',        group       : 'year view',        selector    : '.datepickerYears tr td a span',        style: {            text        : true,            textShadow  : true,            background  : true,            border      : false,            disabled    : ['line-height' , 'letter-spacing']        }    }    ],    properties: {        style: {            theme       : false,            fClass      : true,            text        : false,            background  : true,            border      : true,            sizePosition: true,            dropShadow  : true,            innerShadow : true,            label       : false,            disabled    : []        }    },    menu : [{        icon        : '/walib/WAF/widget/calendar/icons/round_select.png',        title       : 'Select View',        callback    : function(){            var tag = this;            var callback = function(){                var                data        = $(this).data(),                menu        = $('#selectcalendarview' + tag.getId()),                styleSelect = $("#studio-form-select-structure"),                oldVal      = tag._getView();                tag._selectView(data.view);                D.env.form.tabview.selectTab(3)                styleSelect.val(data.selector);                styleSelect.change();                tag._updateSize();                menu.hide();                D.tag.setCurrent(tag);                Designer.beginUserAction('084');                var action = new Designer.action.setCalendarView({                    val         : data.view,                    oldVal      : oldVal,                    tagId       : tag.id                });                Designer.getHistory().add(action);                return false;            }            tag._createMenu('selectcalendarview' + tag.getId(), {                'top'   : 25,                'left'  : tag.getWidth(),                items   : [                {                    text    : '"Day" view',                    onclick : callback,                    data    : {                        view    : 'datepickerViewDays',                        tag     : tag,                        selector: '.datepickerSelected span',                        value   : 'day'                    }                },                {                    text    : '"Month" view',                    onclick : callback,                    data    : {                        view    : 'datepickerViewMonths',                        tag     : tag,                        selector: '.datepickerMonths tr td a span',                        value   : 'month'                    }                },                {                    text    : '"Year" view',                    onclick : callback,                    data    : {                        view    : 'datepickerViewYears',                        tag     : tag,                        selector: '.datepickerYears tr td a span',                        value   : 'year'                    }                }                ]            });        }    }],    onInit: function (config) {        var widget = new WAF.widget.Calendar(config);        return widget;    },    onDesign: function (config, designer, tag, catalog, isResize) {        var        htmlObject;        if(tag._styleChanged){            tag._updateSize && tag._updateSize();            tag._styleChanged = false;            return;        }        htmlObject  = tag.getHtmlObject();        htmlObject.empty();        htmlObject.DatePicker({            flat: true,            calendars: config['data-calendars'],            date: new Date(config['data-date']),            starts: config['data-start'],            view: 'days',            format: config['data-format'],            mode: config['data-mode']        });        htmlObject.DatePickerSetDate(new Date() , true);        htmlObject.append($('<div>').css({            position: 'absolute',            top     : 0,            left    : 0,            height  : '100%',            width   : '100%'        }));        if(isResize){            var            width,            height,            datepicker,            dpContainer;            datepicker  = htmlObject.find('.datepicker');            dpContainer = datepicker.find('.datepickerContainer');            height  = $(dpContainer.find('tr').get(0)).height() + datepicker.find('.datepickerBorderT').height() + datepicker.find('.datepickerBorderB').height();            width   = $(dpContainer.find('tr').get(0)).width() + datepicker.find('.datepickerBorderL').width() + datepicker.find('.datepickerBorderR').width();            if(tag.getWidth() != width){                tag._private.width = width;                tag.setWidth(width);            }            if(tag.getHeight() != height){                tag._private.height = height;                tag.setHeight(height);            }        }        else if(tag._updateSize){            tag._updateSize();        }    },    onCreate: function (tag, param) {        tag._private         = tag._private || {};        tag._private.width   = tag.getWidth();        tag._private.height  = tag.getHeight();        tag._createMenu = function create_menu(id , config){            var            div     = $('<div>'),            bdDiv   = $('<div>').addClass('bd'),            ul      = $('<ul>').addClass('first-of-type');            $('#' + id).remove();            div.prop({                'id'    : id            });            div.addClass('yui-module yui-overlay yuimenu visible');            div.css({                'top'       : config.top,                'left'      : config.left,                'position'  : 'absolute',                'z-index'   : 1,                'visibility': 'visible'            });            for(var i = 0 , item; item = config.items[i] ; i++){                var                li  = $('<li>'),                a   = $('<a>');                li.addClass('yuimenuitem calendarview');                a.addClass('yuimenuitemlabel');                a.prop({                    href    : '#'                });                a.html(item.text);                li.bind({                    click   : item.onclick,                    mouseup : item.mouseup                });                li.data(item.data);                a.appendTo(li);                li.appendTo(ul);            }            $('.calendarview').live({                'mouseover' : function(){                    $(this).addClass('yuimenuitem-selected');                    $(this).children().addClass('yuimenuitemlabel-selected');                },                'mouseout'  : function(){                    $(this).removeClass('yuimenuitem-selected');                    $(this).children().removeClass('yuimenuitemlabel-selected');                }            });            ul.appendTo(bdDiv);            bdDiv.appendTo(div);            div.appendTo($('#waf-focus-menu-' + tag.getId()));        }        tag._selectView = function select_view(viewName){            var            th      = tag.getHtmlObject().find('.datepickerMonth'),            el      = th.children(),            tblEl   = th.parent().parent().parent(),            view    = tblEl.className;            if(viewName != view){                tblEl.attr('class' , viewName);            }        };        tag._getView = function get_view(){            var            th      = tag.getHtmlObject().find('.datepickerMonth'),            el      = th.children(),            tblEl   = th.parent().parent().parent(),            view    = $(tblEl).prop('class');            return view;        }        tag._updateSize = function update_the_size(){            var            overlay,            htmlObj,            datepicker,            dpContainer;            overlay     = tag.getOverlayHtmlObject();            htmlObj     = tag.getHtmlObject();            datepicker  = htmlObj.find('.datepicker');            dpContainer = datepicker.find('.datepickerContainer');            overlay.height($(dpContainer.find('tr').get(0)).height() + datepicker.find('.datepickerBorderT').height() + datepicker.find('.datepickerBorderB').height());            overlay.width($(dpContainer.find('tr').get(0)).width() + datepicker.find('.datepickerBorderL').width() + datepicker.find('.datepickerBorderR').width());            tag.setFocus(false);            tag.setFocus(true);        }        if(!$.fn.catcomplete){            $.widget( "custom.catcomplete", $.ui.autocomplete, {                _renderMenu: function( ul, items ) {                    $.each( items, function( index, item ) {                        $( "<li></li>" )                        .data( "item.autocomplete", item )                        .append( "<a>" + item.value + "<br><span class='waf-calendar-acDescription'>" + item.description + "</span></a>" )                        .appendTo( ul );                    });                }            });        }    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/calendar/js/datepicker.js*//** * * Date picker * Author: Stefan Petre www.eyecon.ro * * Dual licensed under the MIT and GPL licenses * */(function ($) {    var DatePicker = function () {        var	ids = {},        views = {            years: 'datepickerViewYears',            moths: 'datepickerViewMonths',            days: 'datepickerViewDays'        },        tpl = {            wrapper: '<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',            head: [            '<td>',            '<table cellspacing="0" cellpadding="0">',            '<thead>',            '<tr class="datepickerHeader">',            '<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>',            '<th colspan="6" class="datepickerMonth"><a href="#"><span></span></a></th>',            '<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',            '</tr>',            '<tr class="datepickerDoW">',            '<th><span><%=week%></span></th>',            '<th><span><%=day1%></span></th>',            '<th><span><%=day2%></span></th>',            '<th><span><%=day3%></span></th>',            '<th><span><%=day4%></span></th>',            '<th><span><%=day5%></span></th>',            '<th><span><%=day6%></span></th>',            '<th><span><%=day7%></span></th>',            '</tr>',            '</thead>',            '</table></td>'            ],            space : '<td class="datepickerSpace"><div></div></td>',            days: [            '<tbody class="datepickerDays">',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>',            '<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>',            '<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>',            '<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>',            '<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>',            '<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>',            '<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>',            '<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',            '</tr>',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>',            '<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>',            '<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>',            '<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>',            '<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>',            '<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>',            '<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>',            '<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',            '</tr>',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>',            '<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>',            '<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>',            '<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>',            '<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>',            '<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>',            '<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>',            '<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',            '</tr>',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>',            '<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>',            '<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>',            '<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>',            '<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>',            '<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>',            '<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>',            '<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',            '</tr>',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>',            '<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>',            '<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>',            '<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>',            '<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>',            '<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>',            '<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>',            '<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',            '</tr>',            '<tr>',            '<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>',            '<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>',            '<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>',            '<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>',            '<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>',            '<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>',            '<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>',            '<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',            '</tr>',            '</tbody>'            ],            months: [            '<tbody class="<%=className%>">',            '<tr>',            '<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',            '</tr>',            '<tr>',            '<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',            '</tr>',            '<tr>',            '<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>',            '<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',            '</tr>',            '</tbody>'            ]        },        defaults = {            flat: false,            starts: 1,            prev: '&#9664;',            next: '&#9654;',            lastSel: false,            mode: 'single',            view: 'days',            calendars: 1,            format: 'Y-m-d',            position: 'bottom',            eventName: 'click',            onRender: function(){                return {};        },        onChange: function(){            return true;        },        onShow: function(){            return true;        },        onBeforeShow: function(){            return true;        },        onHide: function(){            return true;        },        locale: {            days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],            daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],            daysMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"],            months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],            monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],            weekMin: 'wk'        }    },    fill = function(el) {        var options = $(el).data('datepicker');        var cal = $(el);        var currentCal = Math.floor(options.calendars/2), date, data, dow, month, cnt = 0, week, days, indic, indic2, html, tblCal;        cal.find('td>table tbody').remove();        for (var i = 0; i < options.calendars; i++) {            date = new Date(options.current);            date.addMonths(-currentCal + i);            tblCal = cal.find('table').eq(i+1);            switch (tblCal[0].className) {                case 'datepickerViewDays':                    dow = formatDate(date, 'MM yy');                    break;                case 'datepickerViewMonths':                    dow = date.getFullYear();                    break;                case 'datepickerViewYears':                    dow = (date.getFullYear()-6) + ' - ' + (date.getFullYear()+5);                    break;            }            tblCal.find('thead tr:first th:eq(1) span').text(dow);            dow = date.getFullYear()-6;            data = {                data: [],                className: 'datepickerYears'            }            for ( var j = 0; j < 12; j++) {                data.data.push(dow + j);            }            html = tmpl(tpl.months.join(''), data);            date.setDate(1);            data = {                weeks:[],                test: 10            };            month = date.getMonth();            var dow = (date.getDay() - options.starts) % 7;            date.addDays(-(dow + (dow < 0 ? 7 : 0)));            week = -1;            cnt = 0;            while (cnt < 42) {                indic = parseInt(cnt/7,10);                indic2 = cnt%7;                if (!data.weeks[indic]) {                    week = date.getWeekNumber();                    data.weeks[indic] = {                        week: week,                        days: []                    };                }                data.weeks[indic].days[indic2] = {                    text: date.getDate(),                    classname: []                };                if (month != date.getMonth()) {                    data.weeks[indic].days[indic2].classname.push('datepickerNotInMonth');                }                else{                    data.weeks[indic].days[indic2].classname.push('datepickerInMonth');                }                if (date.getDay() == 0) {                    data.weeks[indic].days[indic2].classname.push('datepickerSunday');                }                if (date.getDay() == 6) {                    data.weeks[indic].days[indic2].classname.push('datepickerSaturday');                }                var fromUser = options.onRender(date);                var val = date.valueOf();                if (fromUser.selected || options.date == val || $.inArray(val, options.date) > -1 || (options.mode == 'range' && val >= options.date[0] && val <= options.date[1])) {                    data.weeks[indic].days[indic2].classname.push('datepickerSelected');                }                if (fromUser.disabled) {                    data.weeks[indic].days[indic2].classname.push('datepickerDisabled');                }                if (fromUser.className) {                    data.weeks[indic].days[indic2].classname.push(fromUser.className);                }                data.weeks[indic].days[indic2].classname = data.weeks[indic].days[indic2].classname.join(' ');                cnt++;                date.addDays(1);            }            html = tmpl(tpl.days.join(''), data) + html;            data = {                data: options.locale.monthsShort,                className: 'datepickerMonths'            };            html = tmpl(tpl.months.join(''), data) + html;            tblCal.append(html);        }    },    parseDate = function (date, format) {        if (date.constructor == Date) {            return new Date(date);        }        var parts = date.split(/\W+/);        var against = format.split(/\W+/), d, m, y, h, min, now = new Date();        for (var i = 0; i < parts.length; i++) {            switch (against[i].toLowerCase()) {                case 'd':                case 'dd':                case 'e':                    d = parseInt(parts[i],10);                    break;                case 'm':                case 'mm':                    m = parseInt(parts[i], 10)-1;                    break;                case 'yy':                case 'y':                    y = parseInt(parts[i], 10);                    y += y > 100 ? 0 : (y < 29 ? 2000 : 1900);                    break;                case 'h':                case 'i':                case 'k':                case 'l':                    h = parseInt(parts[i], 10);                    break;                case 'p':                    if (/pm/i.test(parts[i]) && h < 12) {                        h += 12;                    } else if (/am/i.test(parts[i]) && h >= 12) {                        h -= 12;                    }                    break;                case 'min':                    min = parseInt(parts[i], 10);                    break;            }        }        return new Date(            y === undefined ? now.getFullYear() : y,            m === undefined ? now.getMonth() : m,            d === undefined ? now.getDate() : d,            h === undefined ? now.getHours() : h,            min === undefined ? now.getMinutes() : min,            0            );    },    formatDate = function(date, format) {        format = format ? format : "";        return $.datepicker.formatDate(format, date);    },    extendDate = function(options) {        if (Date.prototype.tempDate) {            return;        }        Date.prototype.tempDate = null;        Date.prototype.months = options.months;        Date.prototype.monthsShort = options.monthsShort;        Date.prototype.days = options.days;        Date.prototype.daysShort = options.daysShort;        Date.prototype.getMonthName = function(fullName) {            return this[fullName ? 'months' : 'monthsShort'][this.getMonth()];        };        Date.prototype.getDayName = function(fullName) {            return this[fullName ? 'days' : 'daysShort'][this.getDay()];        };        Date.prototype.addDays = function (n) {            this.setDate(this.getDate() + n);            this.tempDate = this.getDate();        };        Date.prototype.addMonths = function (n) {            if (this.tempDate == null) {                this.tempDate = this.getDate();            }            this.setDate(1);            this.setMonth(this.getMonth() + n);            this.setDate(Math.min(this.tempDate, this.getMaxDays()));        };        Date.prototype.addYears = function (n) {            if (this.tempDate == null) {                this.tempDate = this.getDate();            }            this.setDate(1);            this.setFullYear(this.getFullYear() + n);            this.setDate(Math.min(this.tempDate, this.getMaxDays()));        };        Date.prototype.getMaxDays = function() {            var tmpDate = new Date(Date.parse(this)),            d = 28, m;            m = tmpDate.getMonth();            d = 28;            while (tmpDate.getMonth() == m) {                d ++;                tmpDate.setDate(d);            }            return d - 1;        };        Date.prototype.getFirstDay = function() {            var tmpDate = new Date(Date.parse(this));            tmpDate.setDate(1);            return tmpDate.getDay();        };        Date.prototype.getWeekNumber = function() {            var tempDate = new Date(this);            tempDate.setDate(tempDate.getDate() - (tempDate.getDay() + 6) % 7 + 3);            var dms = tempDate.valueOf();            tempDate.setMonth(0);            tempDate.setDate(4);            return Math.round((dms - tempDate.valueOf()) / (604800000)) + 1;        };        Date.prototype.getDayOfYear = function() {            var now = new Date(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);            var then = new Date(this.getFullYear(), 0, 0, 0, 0, 0);            var time = now - then;            return Math.floor(time / 24*60*60*1000);        };    },    layout = function (el) {        var options = $(el).data('datepicker');        var cal = $('#' + options.id);        if (!options.extraHeight) {            var divs = $(el).find('div');            options.extraHeight = divs.get(0).offsetHeight + divs.get(1).offsetHeight;            options.extraWidth = divs.get(2).offsetWidth + divs.get(3).offsetWidth;        }        var tbl = cal.find('table:first').get(0);        var width = tbl.offsetWidth;        var height = tbl.offsetHeight;        cal.css({            width: width + options.extraWidth + 'px',            height: height + options.extraHeight + 'px'        }).find('div.datepickerContainer').css({            width: width + 'px',            height: height + 'px'        });    },    click = function(ev) {        if ($(ev.target).is('span')) {            ev.target = ev.target.parentNode;        }        var el = $(ev.target);        if (el.is('a')) {            //					ev.target.blur(); // remove by L.R , June 7th 2012            if (el.hasClass('datepickerDisabled')) {                return false;            }            var options = $(this).data('datepicker');            var parentEl = el.parent();            var tblEl = parentEl.parent().parent().parent();            var tblIndex = $('table', this).index(tblEl.get(0)) - 1;            var tmp = new Date(options.current);            var changed = false;            var fillIt = false;            if (parentEl.is('th')) {                if (parentEl.hasClass('datepickerWeek') && options.mode == 'range' && !parentEl.next().hasClass('datepickerDisabled')) {                    var val = parseInt(parentEl.next().text(), 10);                    tmp.addMonths(tblIndex - Math.floor(options.calendars/2));                    if (parentEl.next().hasClass('datepickerNotInMonth')) {                        tmp.addMonths(val > 15 ? -1 : 1);                    }                    tmp.setDate(val);                    options.date[0] = (tmp.setHours(0,0,0,0)).valueOf();                    tmp.setHours(23,59,59,0);                    tmp.addDays(6);                    options.date[1] = tmp.valueOf();                    fillIt = true;                    changed = true;                    options.lastSel = false;                } else if (parentEl.hasClass('datepickerMonth')){                    tmp.addMonths(tblIndex - Math.floor(options.calendars/2));                    switch (tblEl.get(0).className) {                        case 'datepickerViewDays':                            tblEl.get(0).className = 'datepickerViewMonths';                            el.find('span').text(tmp.getFullYear());                            break;                        case 'datepickerViewMonths':                            tblEl.get(0).className = 'datepickerViewYears';                            el.find('span').text((tmp.getFullYear()-6) + ' - ' + (tmp.getFullYear()+5));                            break;                        case 'datepickerViewYears':                            tblEl.get(0).className = 'datepickerViewDays';                            el.find('span').text(formatDate(tmp, 'MM yy'));                            break;                    }                    if(options.onViewChange){                        ev.currentView  = tblEl.get(0).className;                        options.onViewChange(ev);                    }                } else if (parentEl.parent().parent().is('thead')) {                    switch (tblEl.get(0).className) {                        case 'datepickerViewDays':                            options.current.addMonths(parentEl.hasClass('datepickerGoPrev') ? -1 : 1);                            break;                        case 'datepickerViewMonths':                            options.current.addYears(parentEl.hasClass('datepickerGoPrev') ? -1 : 1);                            break;                        case 'datepickerViewYears':                            options.current.addYears(parentEl.hasClass('datepickerGoPrev') ? -12 : 12);                            break;                    }                    fillIt = true;                }            } else if (parentEl.is('td') && !parentEl.hasClass('datepickerDisabled')) {                switch (tblEl.get(0).className) {                    case 'datepickerViewMonths':                        options.current.setMonth(tblEl.find('tbody.datepickerMonths td').index(parentEl));                        options.current.setFullYear(parseInt(tblEl.find('thead th.datepickerMonth span').text(), 10));                        options.current.addMonths(Math.floor(options.calendars/2) - tblIndex);                        tblEl.get(0).className = 'datepickerViewDays';                        break;                    case 'datepickerViewYears':                        options.current.setFullYear(parseInt(el.text(), 10));                        tblEl.get(0).className = 'datepickerViewMonths';                        break;                    default:                        var val = parseInt(el.text(), 10);                        tmp.addMonths(tblIndex - Math.floor(options.calendars/2));                        if (parentEl.hasClass('datepickerNotInMonth')) {                            tmp.addMonths(val > 15 ? -1 : 1);                        }                        tmp.setDate(val);                        switch (options.mode) {                            case 'multiple':                                val = (tmp.setHours(0,0,0,0)).valueOf();                                if ($.inArray(val, options.date) > -1) {                                    $.each(options.date, function(nr, dat){                                        if (dat == val) {                                            options.date.splice(nr,1);                                            return false;                                        }                                    });                                } else {                                    options.date.push(val);                                }                                break;                            case 'range':                                if (!options.lastSel) {                                    options.date[0] = (tmp.setHours(0,0,0,0)).valueOf();                                }                                val = (tmp.setHours(23,59,59,0)).valueOf();                                if (val < options.date[0]) {                                    options.date[1] = options.date[0] + 86399000;                                    options.date[0] = val - 86399000;                                } else {                                    options.date[1] = val;                                }                                options.lastSel = !options.lastSel;                                break;                            default:                                options.date = tmp.valueOf();                                break;                        }                        break;                }                fillIt = true;                changed = true;            }            if (fillIt) {                fill(this);            }            if (changed) {                options.onChange.apply(this, prepareDate(options));            }        }        return false;    },    prepareDate = function (options) {        var tmp;        if(options.date == null){            return [null , null , options.el];        }        if (options.mode == 'single') {            tmp = new Date(options.date);            return [formatDate(tmp, options.format), tmp, options.el];        } else {            tmp = [[],[], options.el];            $.each(options.date, function(nr, val){                var date = new Date(val);                tmp[0].push(formatDate(date, options.format));                tmp[1].push(date);            });            return tmp;        }    },    getViewport = function () {        var m = document.compatMode == 'CSS1Compat';        return {            l : window.pageXOffset || (m ? document.documentElement.scrollLeft : document.body.scrollLeft),            t : window.pageYOffset || (m ? document.documentElement.scrollTop : document.body.scrollTop),            w : window.innerWidth || (m ? document.documentElement.clientWidth : document.body.clientWidth),            h : window.innerHeight || (m ? document.documentElement.clientHeight : document.body.clientHeight)        };    },    isChildOf = function(parentEl, el, container) {        if (parentEl == el) {            return true;        }        if (parentEl.contains) {            return parentEl.contains(el);        }        if ( parentEl.compareDocumentPosition ) {            return !!(parentEl.compareDocumentPosition(el) & 16);        }        var prEl = el.parentNode;        while(prEl && prEl != container) {            if (prEl == parentEl)                return true;            prEl = prEl.parentNode;        }        return false;    },    show = function (ev) {        var cal = $('#' + $(this).data('datepickerId'));        if (!cal.is(':visible')) {            var calEl = cal.get(0);            fill(calEl);            var options = cal.data('datepicker');            options.onBeforeShow.apply(this, [cal.get(0)]);            var pos = $(this).offset();            var viewPort = getViewport();            var top = pos.top;            var left = pos.left;            var oldDisplay = $.curCSS(calEl, 'display');            cal.css({                visibility: 'hidden',                display: 'block'            });            layout(calEl);            switch (options.position){                case 'top':                    top -= calEl.offsetHeight;                    break;                case 'left':                    left -= calEl.offsetWidth;                    break;                case 'right':                    left += this.offsetWidth;                    break;                case 'bottom':                    top += this.offsetHeight;                    break;            }            if (top + calEl.offsetHeight > viewPort.t + viewPort.h) {                top = pos.top  - calEl.offsetHeight;            }            if (top < viewPort.t) {                top = pos.top + this.offsetHeight + calEl.offsetHeight;            }            if (left + calEl.offsetWidth > viewPort.l + viewPort.w) {                left = pos.left - calEl.offsetWidth;            }            if (left < viewPort.l) {                left = pos.left + this.offsetWidth            }            cal.css({                visibility: 'visible',                display: 'block',                top: top + 'px',                left: left + 'px'            });            if (options.onShow.apply(this, [cal.get(0)]) != false) {                cal.show();            }            $(document).bind('mousedown', {                cal: cal,                trigger: this            }, hide);        }        return false;    },    hide = function (ev) {        if (ev.target != ev.data.trigger && !isChildOf(ev.data.cal.get(0), ev.target, ev.data.cal.get(0))) {            if (ev.data.cal.data('datepicker').onHide.apply(this, [ev.data.cal.get(0)]) != false) {                ev.data.cal.hide();            }            $(document).unbind('mousedown', hide);        }    };    return {        parseDate: function (date, format) {            return parseDate(date, format);        },        init: function(options){            options = $.extend({}, defaults, options||{});            extendDate(options.locale);            options.calendars = Math.max(1, parseInt(options.calendars,10)||1);            options.mode = /single|multiple|range/.test(options.mode) ? options.mode : 'single';            return this.each(function(){                if (!$(this).data('datepicker')) {                    options.el = this;                    if (options.date.constructor == String) {                        options.date = parseDate(options.date, options.format);                        options.date.setHours(0,0,0,0);                    }                    if (options.mode != 'single') {                        if (options.date.constructor != Array) {                            options.date = [options.date.valueOf()];                            if (options.mode == 'range') {                                options.date.push(((new Date(options.date[0])).setHours(23,59,59,0)).valueOf());                            }                        } else {                            for (var i = 0; i < options.date.length; i++) {                                options.date[i] = (parseDate(options.date[i], options.format).setHours(0,0,0,0)).valueOf();                            }                            if (options.mode == 'range') {                                options.date[1] = ((new Date(options.date[1])).setHours(23,59,59,0)).valueOf();                            }                        }                    } else {                        options.date = options.date.valueOf();                    }                    if (!options.current) {                        options.current = new Date();                    } else {                        options.current = parseDate(options.current, options.format);                    }                    options.current.setDate(1);                    options.current.setHours(0,0,0,0);                    var id = 'datepicker_' + parseInt(Math.random() * 1000), cnt;                    options.id = id;                    $(this).data('datepickerId', options.id);                    var cal = $(tpl.wrapper).attr('id', id).bind('click', click).data('datepicker', options);                    if (options.className) {                        cal.addClass(options.className);                    }                    var html = '';                    for (var i = 0; i < options.calendars; i++) {                        cnt = options.starts;                        if (i > 0) {                            html += tpl.space;                        }                        html += tmpl(tpl.head.join(''), {                            week: options.locale.weekMin,                            prev: options.prev,                            next: options.next,                            day1: options.locale.daysMin[(cnt++)%7],                            day2: options.locale.daysMin[(cnt++)%7],                            day3: options.locale.daysMin[(cnt++)%7],                            day4: options.locale.daysMin[(cnt++)%7],                            day5: options.locale.daysMin[(cnt++)%7],                            day6: options.locale.daysMin[(cnt++)%7],                            day7: options.locale.daysMin[(cnt++)%7]                        });                    }                    cal                    .find('tr:first').append(html)                    .find('table').addClass(views[options.view]);                    fill(cal.get(0));                    if (options.flat) {                        cal.appendTo(this).show().css('position', 'relative');                        layout(cal.get(0));                    } else {                        cal.appendTo(document.body);                        $(this).bind(options.eventName, show);                    }                    if(options.onViewChange){                        this.currentView  = 'datepickerView' + options.view.charAt(0).toUpperCase() + options.view.substr(1);                        options.onViewChange(this);                    }                }            });        },        showPicker: function() {            return this.each( function () {                if ($(this).data('datepickerId')) {                    show.apply(this);                }            });        },        hidePicker: function() {            return this.each( function () {                if ($(this).data('datepickerId')) {                    $('#' + $(this).data('datepickerId')).hide();                }            });        },        setDate: function(date, shiftTo){            return this.each(function(){                if ($(this).data('datepickerId')) {                    var cal = $('#' + $(this).data('datepickerId'));                    var options = cal.data('datepicker');                    options.date = date;                    if (options.date.constructor == String) {                        options.date = parseDate(options.date, options.format);                        options.date.setHours(0,0,0,0);                    }                    if (options.mode != 'single') {                        if (options.date.constructor != Array) {                            options.date = [options.date.valueOf()];                            if (options.mode == 'range') {                                options.date.push(((new Date(options.date[0])).setHours(23,59,59,0)).valueOf());                            }                        } else {                            for (var i = 0; i < options.date.length; i++) {                                options.date[i] = (parseDate(options.date[i], options.format).setHours(0,0,0,0)).valueOf();                            }                            if (options.mode == 'range') {                                options.date[1] = ((new Date(options.date[1])).setHours(23,59,59,0)).valueOf();                            }                        }                    } else {                        options.date = options.date.valueOf();                    }                    if (shiftTo) {                        options.current = new Date (options.mode != 'single' ? options.date[0] : options.date);                    }                    fill(cal.get(0));                }            });        },        getDate: function(formated) {            if (this.size() > 0) {                return prepareDate($('#' + $(this).data('datepickerId')).data('datepicker'))[formated ? 0 : 1];            }        },        clear: function(){            return this.each(function(){                if ($(this).data('datepickerId')) {                    var cal = $('#' + $(this).data('datepickerId'));                    var options = cal.data('datepicker');                    if (options.mode != 'single') {                        options.date = [];                        fill(cal.get(0));                    }                }            });        },        fixLayout: function(){            return this.each(function(){                if ($(this).data('datepickerId')) {                    var cal = $('#' + $(this).data('datepickerId'));                    var options = cal.data('datepicker');                    if (options.flat) {                        layout(cal.get(0));                    }                }            });        }    };}();    $.fn.extend({        DatePicker: DatePicker.init,        DatePickerHide: DatePicker.hidePicker,        DatePickerShow: DatePicker.showPicker,        DatePickerSetDate: DatePicker.setDate,        DatePickerGetDate: DatePicker.getDate,        DatePickerClear: DatePicker.clear,        DatePickerLayout: DatePicker.fixLayout,        DatePickerParse: DatePicker.parseDate    });})(jQuery);(function(){    var cache = {};    this.tmpl = function tmpl(str, data){        // Figure out if we're getting a template, or if we need to        // load the template - and be sure to cache the result.        var fn = !/\W/.test(str) ?        cache[str] = cache[str] ||        tmpl(document.getElementById(str).innerHTML) :        // Generate a reusable function that will serve as a template        // generator (and which will be cached).        new Function("obj",            "var p=[],print=function(){p.push.apply(p,arguments);};" +            // Introduce the data as local variables using with(){}            "with(obj){p.push('" +            // Convert the template into pure JavaScript            str            .replace(/[\r\t\n]/g, " ")            .split("<%").join("\t")            .replace(/((^|%>)[^\t]*)'/g, "$1\r")            .replace(/\t=(.*?)%>/g, "',$1,'")            .split("\t").join("');")            .split("%>").join("p.push('")            .split("\r").join("\\'")            + "');}return p.join('');");        // Provide some basic currying to the user        return data ? fn( data ) : fn;    };})();/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/googleMaps/widget-googleMaps.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*///// "use strict";/*global WAF,window*/WAF.Widget.provide(    'GoogleMaps',    {},    /**     * The constructor of the widget     *     * @shared     * @property constructor     * @type Function     **/    function WAFWidget(config, data, shared) {        var widget = this;        if (!waf.__googleMaps__) {            waf.__googleMaps__ = {                isLoaded: false,                isFirstMap: true            };        } else {            waf.__googleMaps__.isFirstMap = false;        }        waf.__googleMaps__[widget.id] = function () {            widget._initialize();            waf.__googleMaps__.isLoaded = true;        }        this._gmap = {            map: {},            overlay: [],            selectedOverlay: {},            events: [],            interval: {}        };        if (waf.__googleMaps__.isFirstMap) {            // JavaScript Maps API link + parameters            // for exemple link = http://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&sensor=SET_TO_TRUE_OR_FALSE            var link;            //build script url            link = "http://maps.googleapis.com/maps/api/js?";            // google api file            // The key parameter contains the application's API key            link += "&key=" + data.key;            //Google Private key            // localization of google map            if (data.language != 'default') {                link += "&language=" + data.language;            }            link += "&sensor=false";            //we instruct the API to only execute the initit() function after the API has fully loaded by passing callback=initit to the Maps API bootstrap:            link += "&callback=waf.__googleMaps__." + widget.id;            // Prepare the JavaScript code which loads all symbols and definitions we need in order to use Google Maps API            var oScript = $("<script>");            oScript.prop({                type: "text/javascript",                src: link            });            // add the script to the <head>            $("head")[0].appendChild(oScript[0]);        } else {            // The javascript file of gmaps is not loaded yet. We call isGMapsLoaded every 0.5 seconds until the js is loaded.            // We clear the interval inside isGMapsLoaded function            this._gmap.interval = window.setInterval('waf.widgets.' + this.id + '._isGMapsLoaded()', 500);        }        if(this.source){            this.source.addListener("all", function(e) {                if (!waf.__googleMaps__.isLoaded) {                    widget._gmap.events.push({                        e: e,                        type: e.eventKind                    });                }            });        }    },    {        setIconMarker: function setIconMarker(id, icon) {            var overlay = this._getOverlay(id);            if (overlay && overlay.marker) {                overlay.marker.setIcon(icon);            }        },        setCenter: function setCenter(position) {            if (position.match(/\b-?\d+\.\d+,\s?-?\d+\.\d+\b/)) {                var coord = position.split(',');                var lnglat = new google.maps.LatLng(parseFloat(coord[0]), parseFloat(coord[1]));                this._gmap.map.panTo(lnglat);            } else {                var widget = this;                var geocoder = new google.maps.Geocoder();                geocoder.geocode({                    'address': position                }, function(results, status) {                    if (status == google.maps.GeocoderStatus.OK) {                        widget._gmap.map.panTo(results[0].geometry.location);                    }                });            }        },        setZoom: function setZoom(zoomLevel) {            this._gmap.map.setZoom(zoomLevel);        },        setMarker: function setMarker(id, position, options) {            var widget = this;            var entity;            var marker = new google.maps.Marker({                map: widget._gmap.map            });            widget.source.getEntityCollection().findKey( id , {                onSuccess : function(e){                    e.entityCollection.getEntity(e.result,{                        onSuccess : function(e1){                            entity = e1.entity;                        }                    })                }            });            google.maps.event.addListener(marker, 'click', (function(){                return function(e) {                    var event = $.Event('markerClick', {                        e: e,                        marker: marker,                        entity: entity                    });                    $(widget).trigger(event);                }            })()                );            google.maps.event.addListener(marker, 'dblclick', (function() {                return function(e) {                    var event = $.Event('markerDblclick', {                        e: e,                        marker: marker,                        entity: entity                    });                    $(widget).trigger(event);                }            })());            google.maps.event.addListener( marker, 'mouseover', (function() {                return function(e) {                    var event = $.Event('markerMouseover', {                        e: e,                        marker: marker,                        entity: entity                    });                    $(widget).trigger(event);                }            })());            if (position.match(/\b-?\d+\.\d+,\s?-?\d+\.\d+\b/)) {                var coord = position.split(',');                var lnglat = new google.maps.LatLng(parseFloat(coord[0]), parseFloat(coord[1]));                // set marker postion to the returned result                marker.setPosition(lnglat);                if (options) {                    if (options.icon) {                        marker.setIcon(options.icon);                    }                    if (options.title) {                        marker.setTitle(options.title);                    }                    if (options.infoWindowText) {                        var infoWindow = new google.maps.InfoWindow();                        infoWindow.setContent(options.infoWindowText);                        google.maps.event.addListener(marker, 'click', (function(marker) {                            return function() {                                infoWindow.open(widget._gmap.map, marker);                            }                        })(marker));                    }                }                widget._gmap.overlay.push({                    marker: marker,                    infoWindow: infoWindow,                    address: lnglat,                    entityKey: id                });                return marker;            } else {                var geocoder = new google.maps.Geocoder();                return geocoder.geocode({                    'address': position                }, function(results, status) {                    if (status == google.maps.GeocoderStatus.OK) {                        // set marker postion to the returned result                        marker.setPosition(results[0].geometry.location);                        if (options) {                            if (options.icon) {                                marker.setIcon(options.icon);                            }                            if (options.title) {                                marker.setTitle(options.title);                            }                            if (options.infoWindowText) {                                var infoWindow = new google.maps.InfoWindow();                                infoWindow.setContent(options.infoWindowText);                                google.maps.event.addListener(marker, 'click', (function(marker) {                                    return function() {                                        infoWindow.open(widget._gmap.map, marker);                                    }                                })(marker));                            }                        }                        widget._gmap.overlay.push({                            marker: marker,                            infoWindow: infoWindow,                            address: lnglat,                            entityKey: id                        });                        google.maps.event.addListener(marker, 'click', (function() {                            return function() {                                widget.source.selectByKey(id);                            }                        })());                        return marker;                    } else {                        return null;                    }                });            }        },        /**         * Deletes all markers in the array by removing references to them         */        _deleteOverlays: function _deleteOverlays() {            var overlaySize = this._gmap.overlay.length;            if (overlaySize !== 0) {                for (var i = 0; i < overlaySize; i++) {                    if ('setMap' in this._gmap.overlay[i].marker) {                        this._gmap.overlay[i].marker.setMap(null);                    }                }                this._gmap.overlay.length = 0;            }        },        /**         * Get object that conaintes markers, address, infoWindow and position of the selected element         * @param {int} entityKey         * @return  {object}         */        _getOverlay: function _getOverlay(entityKey) {            if (this._gmap.overlay) {                for (var i in this._gmap.overlay) {                    if (this._gmap.overlay[i].entityKey == entityKey) {                        return this._gmap.overlay[i];                    }                }            }            return null;        },        /**         *         */        _initialize: function _initialize() {            var            widget,            markerNb;            if (!this.source) {                return;            }            // How many markers we can display in the map, default value is 1            widget      = this;            markerNb    = parseInt(this.config['data-marker-number'], 10);            this._setMap();            if (widget.source.getPosition() >= 0) {                widget.lower = 0;                widget.upper = ((widget.lower + markerNb) < this.source.length) ? widget.lower + markerNb: this.source.length;                this._setOverLay(widget.lower, widget.upper, widget.source.getCurrentElement().getKey(), false);                if (widget._gmap.events && widget._gmap.events.length > 0) {                    for (var i = 0; i < widget._gmap.events.length; i++) {                        if (widget._gmap.events[i].type === "onCurrentElementChange") {                            widget._onCurrentElementChange(widget._gmap.events[i].e, widget, markerNb);                        } else if (widget._gmap.events[i].type === "onCollectionChange") {                            if(widget.source._private.currentEntity){                                var entityKey = widget.source._private.currentEntity.getKey();                                widget.lower = 0;                                widget.upper = ((widget.lower + markerNb) < widget.source.length) ? widget.lower + markerNb: widget.source.length;                                widget.source.select(0);                                widget._deleteOverlays();                                var selectedEntity = widget._getOverlay(entityKey);                                if (selectedEntity != null) {                                    widget._updateSelected(selectedEntity);                                }                            }                            widget._deleteOverlays();                        } else if (widget._gmap.events[i].type === "onCurrentElementSaveEvents") {                            widget._onCurrentElementSave(e, widget, markerNb);                        }                    }                }                this.source.addListener("all", function(e) {                    switch (e.eventKind) {                        case "onCurrentElementChange":                            widget._onCurrentElementChange(e, widget, markerNb);                            break;                        case "onCollectionChange":                            if(widget.source._private.currentEntity){                                var entityKey = widget.source._private.currentEntity.getKey();                                widget.lower = 0;                                widget.upper = ((widget.lower + markerNb) < widget.source.length) ? widget.lower + markerNb: widget.source.length;                                widget.source.select(0);                                widget._deleteOverlays();                                var selectedEntity = widget._getOverlay(entityKey);                                if (selectedEntity != null) {                                    widget._updateSelected(selectedEntity);                                }                            }                            widget._deleteOverlays();                            break;                        case "onElementSaved":                            widget._onCurrentElementSave(e, widget, markerNb);                            break;                    }                });            }        },        /**             * this function is called every 0.5 seconds until the google map api is loaded. then it clears interval             */        _isGMapsLoaded: function _isGMapsLoaded() {            if (waf.__googleMaps__.isLoaded) {                window.clearInterval(this._gmap.interval);                this._initialize();            }        },        _onCurrentElementChange: function _onCurrentElementChange(e, widget, markerNb) {            var            mFlag,            entityKey,            selectedEntity,            currentposition;            currentposition = widget.source.getPosition();            if (currentposition >= 0) {                // we show markerNb on map, if the selected element in the datasource is already displayed,                // then we do not refreash the map.                // otherwise, we alter the upper and lower limits, we set the mFlag idicator to true and                // we put markers of each element betweeen lower and upper.                mFlag       = false;                entityKey   = e.dataSource._private.currentEntity.getKey();                if (currentposition >= widget.upper) {                    widget.upper = ((currentposition + markerNb) < widget.source.length) ? currentposition + markerNb: widget.source.length;                    widget.lower = widget.upper - markerNb;                    mFlag = true;                }                if (currentposition < widget.lower) {                    widget.upper = (currentposition - markerNb + 1) >= 0 ? currentposition + 1: markerNb;                    widget.lower = widget.upper - markerNb;                    mFlag = true;                }                if (mFlag || widget._gmap.overlay.length == 0) {                    //add new markers                    widget._setOverLay(widget.lower, widget.upper, entityKey, true);                }                selectedEntity = widget._getOverlay(entityKey);                if (selectedEntity != null) {                    widget._updateSelected(selectedEntity);                }            }        },        _onCurrentElementSave: function _onCurrentElementSave(e, widget, markerNb) {            var            entityKey,            currentposition;            entityKey       = e.dataSource._private.currentEntity.getKey();            currentposition = e.position;            if (currentposition >= 0) {                if (currentposition >= widget.upper) {                    widget.upper = ((currentposition + markerNb) < widget.source.length) ? currentposition + markerNb: widget.source.length;                    widget.lower = widget.upper - markerNb;                }                if (currentposition < widget.lower) {                    widget.upper = (currentposition - markerNb + 1) >= 0 ? currentposition + 1: markerNb;                    widget.lower = widget.upper - markerNb;                }                //add new marker                widget._setOverLay(widget.lower, widget.upper, entityKey, true);            }        },        /**             * Build infowindow's text             * @param e {object} event contains a summarized copy of the retrieved entity from datasource             * @param infoWindowSource {object} : containes one or too many attributes name, it might be sourended by html tags and string             * @return {string} : infowindow text             */        _parseInfoWindow: function _parseInfoWindow(e, infoWindowSource) {            /* infoWindow could be:                 * attribute                 * attribute.relatedAtt                 * left<%attribute%>right                 * left<%attribute.relatedAtt%>right                 * right and left may contains html tags                */            var            left = '',            right = '',            content = '', // source.attribute            attribute = '', // attribute || attribute.relatedAtt            infoWindowTxt = '', // infowWindowTxt = left + content + right            infoWindowRows;            infoWindowRows = infoWindowSource.split('+,');            for (var j = 0; j < infoWindowRows.length; j++) {                var                cell            = infoWindowRows[j].split('+:'),                attributeTxt    = cell[0],                endLine         = cell[1],                leftIndex       = attributeTxt.indexOf("<%");                // if the source is written between <% %>                if (leftIndex != -1) {                    var rightIndex;                    rightIndex = attributeTxt.indexOf("%>");                    left = attributeTxt.substring(0, leftIndex);                    right = attributeTxt.substring(rightIndex + 2, cell[0].length);                    attribute = attributeTxt.substring(leftIndex + 2, rightIndex);                //attribute   = attribute.split('.');                } else {                    //bubbleSource = cell[0].split('.');                    attribute = attributeTxt;                }                // in case the attribute is written as attribute.attribute                if (attribute.indexOf(".") != -1) {                    var arr = attribute.split('.');                    // the first attribute is the name of the source, we can ommited                    if (arr[0] == this.config['data-binding']) {                        attribute = arr[1];                        content = e.element[attribute];                    }                    // in case of related attribute                    else {                        var dataClass = this.source.getDataClass();                        if (dataClass[arr[0]].kind == "relatedEntity") {                            var className = this.source.getClassTitle().toLowerCase();                            var relatedAtt = arr[0];                            var att = arr[1];                            sources[className][relatedAtt].load({                                onSuccess: function(event)                                // only if there is a current entity in the person datasource                                {                                    content = event.entity[att].getValue();                                },                                sync: true                            });                        }                    }                } else {                    content = e.element[attribute] ? e.element[attribute] : '';                }                infoWindowTxt = infoWindowTxt + left + content + right;                left = '';                right = '';                if (endLine === 'true') {                    infoWindowTxt += '<br />';                }            }            return infoWindowTxt;        },        /**         *         */        _updateSelected: function _updateSelected(selectedEntity) {            var selectedMarkerIcon = this.config['data-marker-icon-selected'];            var markerIcon = this.config['data-marker-icon'];            if (!markerIcon) {                markerIcon = '/walib/WAF/widget/googleMaps/icons/red-dot.png';            }            if (!selectedMarkerIcon) {                selectedMarkerIcon = '/walib/WAF/widget/googleMaps/icons/blue-dot.png';            }            // rest icon and infoWindow of the old selected marker            if (this._gmap.selectedOverlay && this._gmap.selectedOverlay.marker) {                this._gmap.selectedOverlay.marker.setIcon(markerIcon);                this._gmap.selectedOverlay.marker.setZIndex(undefined);            }            if (this._gmap.selectedOverlay && this._gmap.selectedOverlay.infoWindow) {                this._gmap.selectedOverlay.infoWindow.close();            }            if (selectedEntity && selectedEntity.marker) {                // change icon                selectedEntity.marker.setIcon(selectedMarkerIcon);                selectedEntity.marker.setZIndex(9999);            }            if (selectedEntity ){                if (selectedEntity.marker) {                    // change icon                    selectedEntity.marker.setIcon(selectedMarkerIcon);                    selectedEntity.marker.setZIndex(9999);                }                if (selectedEntity.address) {                    //Changes the center of the map to the given LatLng. If the change is less than both the width and height of the map,                    //the transition will be smoothly animated.                    this._gmap.map.panTo(selectedEntity.address);                }                // Open infoWindow if autodisplay is true                if (selectedEntity.infoWindow && this.config['data-infowindow-display'] === 'true') {                    selectedEntity.infoWindow.open(this._gmap.map, selectedEntity.marker);                }                this._gmap.selectedOverlay = selectedEntity;            }            if (!selectedEntity && parseInt(this.config['data-marker-number'], 10) == 1){                this._deleteOverlays();            }        },        /**         * Add infoWindow to a marker if there is         * @param {object} e:  event contains a summarized copy of the retrieved entity from datasource         * @param {object} marker: a geographic coordinate         * @return {object} return the created infowindow if there is binding, null otherwise         */        _setInfoWindow: function _setInfoWindow(e, marker) {            var widget = this;            var infoWindowSource = this.config['data-infowindow'];            if (!infoWindowSource) {                return null;            }            var infoWindow = new google.maps.InfoWindow();            var text = widget._parseInfoWindow(e, infoWindowSource);            if (text) {                infoWindow.setContent(text);                google.maps.event.addListener(marker, 'click', (function(marker) {                    return function() {                        infoWindow.open(widget._gmap.map, marker);                    }                })(marker));            }            return infoWindow;        },        /**         *         */        _setMap: function _setMap() {            var            widget,            mapType,            panCtrl,            mapZoom,            zoomCtrl,            scaleCtrl,            myOptions,            streetViewCtrl;            widget          = this;            mapType         = this.config["data-mapType"];            mapZoom         = parseInt(this.config["data-zoom"]);            panCtrl         = this.config["data-panControl"];            zoomCtrl        = this.config["data-zoomControl"];            scaleCtrl       = this.config["data-scaleControl"];            streetViewCtrl  = this.config["data-streetView"];            myOptions       = {                mapTypeId           : mapType,                zoom                : mapZoom,                center              : new google.maps.LatLng(0, 0),                panControl          : ("true" === panCtrl),                zoomControl         : ("true" === zoomCtrl),                scaleControl        : ("true" === scaleCtrl),                streetViewControl   : ("true" === streetViewCtrl)            };            this._gmap.map  = new google.maps.Map(document.getElementById(this.id), myOptions);            google.maps.event.addListener(this._gmap.map, 'click', function(e) {                var event = $.Event('click', {                    e: e,                    map: widget._gmap.map                });                $(widget).trigger(event);            });            google.maps.event.addListener(this._gmap.map, 'dblclick', function(e) {                var event = $.Event('dblclick', {                    e: e,                    map: widget._gmap.map                });                $(widget).trigger(event);            });            google.maps.event.addListener(this._gmap.map, 'mouseover', function(e) {                var event = $.Event('mouseover', {                    e: e,                    map: widget._gmap.map                });                $(widget).trigger(event);            });        },        /**         * @param {object} e:  event contains a summarized copy of the retrieved entity from datasource         * @param {object} langlat: a geographic coordinate         * @return {object} return the created marker         */        _setMarker: function _setMarker(e, langlat) {            var            marker,            widget,            markerIcon,            tooltipSource;            widget          = this;            markerIcon      = this.config['data-marker-icon'] || '';            tooltipSource   = this.config['data-binding-tooltip'] || '';            marker          = new google.maps.Marker({                map: widget._gmap.map  // initiate the marker with our map            });            if(tooltipSource.indexOf('.') != -1) {                tooltipSource = tooltipSource.substr(tooltipSource.indexOf('.') +1);            }            if (!markerIcon) {                markerIcon = '/walib/WAF/widget/googleMaps/icons/red-dot.png';            }            // set marker postion to the returned result            marker.setPosition(langlat);            marker.setIcon(markerIcon);            if (tooltipSource) {                var tooltip = e.element[tooltipSource];                if (tooltip && tooltip.length > 0) {                    marker.setTitle(e.element[tooltipSource]);                }            }            google.maps.event.addListener(marker, 'click', (function() {                return function(event) {                    widget.source.select(e.position);                    var jQueryEvent = $.Event('markerClick', {                        e: event,                        marker: marker,                        entity : e.element._private.currentEntity                    });                    $(widget).trigger(jQueryEvent);                }            })());            google.maps.event.addListener(marker, 'dblclick', (function() {                return function(event) {                    widget.source.select(e.position);                    var jQueryEvent = $.Event('markerDblclick', {                        e: event,                        marker: marker,                        entity : e.element._private.currentEntity                    });                    $(widget).trigger(jQueryEvent);                }            })());            google.maps.event.addListener( marker, 'mouseover', (function() {                return function(event) {                    var jQueryEvent = $.Event('markerMouseover', {                        e: event,                        marker: marker,                        entity : e.element._private.currentEntity                    });                    $(widget).trigger(jQueryEvent);                }            })());            return marker;        },        /**         * @param {int} entityKey:         * @param {int} lower:         * @param {int} upper:         * @param {function} clearOverLayFlag:         */        _setOverLay: function _setOverLay(lower, upper, entityKey, clearOverLayFlag) {            var            widget,            geocoder,            errorDiv,            addressSource;            widget          = this;            geocoder        = new google.maps.Geocoder();            addressSource   = this.config['data-address'];            if(addressSource.indexOf('.') != -1) {                addressSource = addressSource.substr(addressSource.indexOf('.') +1);            }            errorDiv = this.getErrorDiv();            if (errorDiv) {                errorDiv.hide();            }            for (var i = lower; i < upper; i++) {                widget.source.getElement(i, {                    onSuccess: function(e) {                        if (e.element == null) {                            return;                        }                        var address = e.element[addressSource];                        if (address && address !== '') {                            if (address.match(/\b-?\d+\.\d+,\s?-?\d+\.\d+\b/)) {                                if (clearOverLayFlag) {                                    widget._deleteOverlays();                                    clearOverLayFlag = false;                                }                                var coord,                                lnglat,                                marker,                                infoWindow;                                coord = address.split(',');                                lnglat = new google.maps.LatLng(parseFloat(coord[0]), parseFloat(coord[1]));                                marker = widget._setMarker(e, lnglat);                                infoWindow = widget._setInfoWindow(e, marker);                                var selectedEntity = {                                    marker: marker,                                    infoWindow: infoWindow,                                    address: lnglat,                                    entityKey: e.element._private.currentEntity.getKey()                                };                                widget._gmap.overlay.push(selectedEntity);                                if (entityKey === e.element._private.currentEntity.getKey()) {                                    widget._updateSelected(selectedEntity);                                }                            } else {                                geocoder.geocode({                                    'address': address                                }, function(results, status) {                                    var                                    marker,                                    infoWindow,                                    selectedEntity;                                    if (status == google.maps.GeocoderStatus.OK) {                                        if (clearOverLayFlag) {                                            widget._deleteOverlays();                                            clearOverLayFlag = false;                                        }                                        marker      = widget._setMarker(e, results[0].geometry.location);                                        infoWindow  = widget._setInfoWindow(e, marker);                                        selectedEntity = {                                            marker      : marker,                                            address     : results[0].geometry.location,                                            entityKey   : e.element._private.currentEntity.getKey(),                                            infoWindow  : infoWindow                                        };                                        widget._gmap.overlay.push(selectedEntity);                                        if (entityKey === e.element._private.currentEntity.getKey()) {                                            widget._updateSelected(selectedEntity);                                        }                                    } else {                                        var                                        errorDiv = widget.getErrorDiv();                                        if(errorDiv) {                                            // geocode faild to return coordinates (i.e. invalide address)                                            widget.setErrorMessage({                                                message: address+" is an invalid address"                                            });                                            widget.getErrorDiv().show();                                        }                                        // rest icon and infoWindow of the old selected marker                                        widget._updateSelected(null);                                    }                                });                            }                        }                    }                });            }        }    }    );/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/widget/googleMaps/widget-googleMaps-conf.js*//** This file is part of Wakanda software, licensed by 4D under*  (i) the GNU General Public License version 3 (GNU GPL v3), or*  (ii) the Affero General Public License version 3 (AGPL v3) or*  (iii) a commercial license.* This file remains the exclusive property of 4D and/or its licensors* and is protected by national and international legislations.* In any event, Licensee's compliance with the terms and conditions* of the applicable license constitutes a prerequisite to any use of this file.* Except as otherwise expressly stated in the applicable license,* such license does not include any other license or rights on this file,* 4D's and/or its licensors' trademarks and/or other proprietary rights.* Consequently, no title, copyright or other proprietary rights* other than those specified in the applicable license is granted.*/WAF.addWidget({    /**    *  Widget Descriptor    */    /* PROPERTIES */    // {String} internal name of the widget    type        : 'googleMaps',    // {String} library used ('waf', 'jquery', 'extjs', 'yui') (optional)    lib         : 'WAF',    // {String} display name of the widget in the GUI Designer    description : 'Google Maps V3',    // {String} category in which the widget is displayed in the GUI Designer    category    : 'External',    // {Array} css file needed by widget (optional)    css         : [],    // {Array} script files needed by widget (optional)    include     : [],    // {String} type of the html tag ('div' by default)    tag         : 'div',    // {Array} attributes of the widget. By default, we have 3 attributes: 'data-type', 'data-lib', and 'id', so it is unnecessary to add them    //    // @property {String} name, name of the attribute (mandatory)    // @property {String} description, description of the attribute (optional)    // @property {String} defaultValue, default value of the attribute (optional)    // @property {'string'|'radio'|'checkbox'|'textarea'|'dropdown'|'integer'} type, type of the field to show in the GUI Designer (optional)    // @property {Array} options, list of values to choose for the field shown in the GUI Designer (optional)    attributes  : [    {        name         : 'data-binding',        description  : 'Source',        type         : 'string',        visibility  : 'hidden'    },    {        name         : 'data-address',        autocomplete : true,        defaultValue : '',        description  : 'Source',        type         : 'string',        onchange     : function (e) {            var            value,            source;            value = this.getValue();            if(value.indexOf(".") !== -1 ){                value       = value.split('.');                source      = value[0];                this.data.tag.getAttribute('data-binding').setValue(source);                this.data.tag.domUpdate();            }        }    },    {        name        : 'data-label',        description : 'Label',        defaultValue: 'Label'    },    {               name        : 'data-label-position',               description : 'Label position',               defaultValue: 'top'       },    {        name        : 'data-infowindow',        value       : '',        visibility  : 'hidden',        type         : 'string'    },    {        name        : 'data-mapType',        type        : 'dropdown',        options     : [        {            key     : 'hybrid',            value   : 'Hybrid'        },        {            key     : 'roadmap',            value   : 'Roadmap'        },        {            key     : 'satellite',            value   : 'Satellite'        },        {            key     : 'terrain',            value   : 'Terrain'        }],        defaultValue: 'hybrid',        description  : 'Type'    },    {        name         : 'data-key',        defaultValue : '',        description  : 'Google key'    },    {        name         : 'data-zoom',        defaultValue : '1',        description  : 'Zoom',        typeValue    : 'integer',        slider       : {            min : 1,            max : 20        },        reloadTag   : true    },    {        name         : 'data-language',        description  : 'Language',        type         : 'dropdown',        options      : ['default','en', 'zh-CH', 'nl', 'fr', 'de', 'it', 'pl', 'ja', 'es'],        defaultValue : 'English'    },    {        name         : 'data-infowindow-display',        defaultValue : 'true',        description  : 'Auto display bubble',        type         : 'checkbox'    },    {        name         : 'data-streetView',        description  : 'Display street view',        type         : 'checkbox',        defaultValue : 'true',        category     : 'Controls'    },    {        name         : 'data-zoomControl',        description  : 'Display zoom',        type         : 'checkbox',        defaultValue : 'true',        category     : 'Controls'    },    {        name         : 'data-scaleControl',        description  : 'Display scale',        type         : 'checkbox',        defaultValue : 'true',        category     : 'Controls'    },    {        name         : 'data-binding-tooltip',        description  : 'Tooltip',        category     : 'Marker'    },    {        name         : 'data-panControl',        defaultValue : 'false',        description  : 'Display pan',        type         : 'checkbox',        category     : 'Controls'    },    {        name         : 'data-marker-icon-selected',        description  : 'Selected icon',        type         : 'file',        accept       : 'image/*',        category     : 'Marker'    },    {        name         : 'data-marker-icon',        description  : 'Icon',        type         : 'file',        accept       : 'image/*',        category     : 'Marker'    },    {        name         : 'data-marker-number',        description  : 'Number of markers',        defaultValue : '1',        typeValue    : 'integer',        category     : 'Marker'    },    {        name: 'data-errorDiv',        description: 'Placeholder for error description',        category: 'Error Handling'    }    ],    // {Array} default height and width of the container for the widget in the GUI Designer    //    // @property {String} name, name of the attribute    // @property {String} defaultValue, default value of the attribute    style: [    {        name        : 'width',        defaultValue: '656px'    },    {        name        : 'height',        defaultValue: '324px'    }],    // {Array} events ot the widget    //    // @property {String} name, internal name of the event (mandatory)    // @property {String} description, display name of the event in the GUI Designer    // @property {String} category, category in which the event is displayed in the GUI Designer (optional)    events: [    {        name       : 'click',        description: 'On Click',        category   : 'Map Events'    },    {        name       : 'dblclick',        description: 'On Double Click',        category   : 'Map Events'    },    {        name       : 'mouseover',        description: 'On Mouse Over',        category   : 'Map Events'    },    {        name       : 'markerClick',        description: 'On Marker Click',        category   : 'Marker Events'    },    {        name       : 'markerDblclick',        description: 'On Marker Double Click',        category   : 'Marker Events'    },    {        name       : 'markerMouseover',        description: 'On Marker Mouse Over',        category   : 'Marker Events'    }],    // {JSON} panel properties widget    //    // @property {Object} enable style settings in the Styles panel in the Properties area in the GUI Designer    properties: {        style: {            theme       : false,            fClass      : true,                 // true to display the "Class" option in the "Theme & Class" section            text        : false,                 // true to display the "Text" section            background  : false,                 // true to display widget "Background" section            dropShadow  : true,            border      : true,                 // true to display widget "Border" section            sizePosition: true,                 // true to display widget "Size and Position" section            label       : true,                 // true to display widget "Label Text" and "Label Size and Position" sections            // For these two sections, you must also define the "data-label" in the Attributes array            disabled     : ['border-radius']     // list of styles settings to disable for this widget        }    },    /* METHODS */    /*    * function to call when the widget is loaded by WAF during runtime    *    * @param {Object} config contains all the attributes of the widget    * @result {WAF.widget.Template} the widget    */    onInit: function (config) {        var widget = new WAF.widget.GoogleMaps(config);        return widget;    },    /**    * function to call when the widget is displayed in the GUI Designer    *    * @param {Object} config contains all the attributes for the widget    * @param {Designer.api} set of functions used to be managed by the GUI Designer    * @param {Designer.tag.Tag} container of the widget in the GUI Designer    * @param {Object} catalog of dataClasses defined for the widget    * @param {Boolean} isResize is a resize call for the widget (not currently available for custom widgets)    */    onDesign: function (config, designer, tag, catalog, isResize) {        //document.getElementById(tag.getAttribute('id').getValue()).style.backgroundImage = '../walib/WAF/widget/googleMaps/images/googleMaps.jpg';        var        img,        htmlObject;        htmlObject  = tag.getHtmlObject().empty();        img         = $('<img>').css({            width       : '100%',            height      : '100%',            top         : 0,            left        : 0,            position    : 'absolute'        });        switch (tag.getAttribute('data-mapType').getValue()) {            case "roadmap":                img.prop({                    src : '/walib/WAF/widget/googleMaps/images/roadmap.png'                });                break;            case "hybrid":                img.prop({                    src : '/walib/WAF/widget/googleMaps/images/hybrid.png'                });                break;            case "satellite":                img.prop({                    src : '/walib/WAF/widget/googleMaps/images/satellite.png'                });                break;            case "terrain":                img.prop({                    src : '/walib/WAF/widget/googleMaps/images/terrain.png'                });                break;            default:                img.prop({                    src : '/walib/WAF/widget/googleMaps/images/hybrid.png'                });                break;        }        htmlObject.append(img);    },    onCreate: function (tag, param) {        $('body').on('keyup','#string-data-address', {tag:tag}, function(e){                if($(this).val() === '' ) {                    e.data.tag.getAttribute('data-binding').setValue("");                    e.data.tag.domUpdate();                }            });    }});/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/mobile/iscroll/iscroll-lite.js*//*! * iScroll Lite base on iScroll v4.1.6 ~ Copyright (c) 2011 Matteo Spinelli, http://cubiq.org * Released under MIT license, http://cubiq.org/license */(function(){var m = Math,	mround = function (r) { return r >> 0; },	vendor = (/webkit/i).test(navigator.appVersion) ? 'webkit' :		(/firefox/i).test(navigator.userAgent) ? 'Moz' :		'opera' in window ? 'O' : '',    // Browser capabilities    isAndroid = (/android/gi).test(navigator.appVersion),    isIDevice = (/iphone|ipad/gi).test(navigator.appVersion),    isPlaybook = (/playbook/gi).test(navigator.appVersion),    isTouchPad = (/hp-tablet/gi).test(navigator.appVersion),    has3d = 'WebKitCSSMatrix' in window && 'm11' in new WebKitCSSMatrix(),    hasTouch = 'ontouchstart' in window && !isTouchPad,    hasTransform = vendor + 'Transform' in document.documentElement.style,    hasTransitionEnd = isIDevice || isPlaybook,	nextFrame = (function() {	    return window.requestAnimationFrame			|| window.webkitRequestAnimationFrame			|| window.mozRequestAnimationFrame			|| window.oRequestAnimationFrame			|| window.msRequestAnimationFrame			|| function(callback) { return setTimeout(callback, 17); }	})(),	cancelFrame = (function () {	    return window.cancelRequestAnimationFrame			|| window.webkitCancelAnimationFrame			|| window.webkitCancelRequestAnimationFrame			|| window.mozCancelRequestAnimationFrame			|| window.oCancelRequestAnimationFrame			|| window.msCancelRequestAnimationFrame			|| clearTimeout	})(),	// Events	RESIZE_EV = 'onorientationchange' in window ? 'orientationchange' : 'resize',	START_EV = hasTouch ? 'touchstart' : 'mousedown',	MOVE_EV = hasTouch ? 'touchmove' : 'mousemove',	END_EV = hasTouch ? 'touchend' : 'mouseup',	CANCEL_EV = hasTouch ? 'touchcancel' : 'mouseup',	// Helpers	trnOpen = 'translate' + (has3d ? '3d(' : '('),	trnClose = has3d ? ',0)' : ')',	// Constructor	iScroll = function (el, options) {		var that = this,			doc = document,			i;		that.wrapper = typeof el == 'object' ? el : doc.getElementById(el);		that.wrapper.style.overflow = 'hidden';		that.scroller = that.wrapper.children[0];// Default options		that.options = {			hScroll: true,			vScroll: true,			x: 0,			y: 0,			bounce: true,			bounceLock: false,			momentum: true,			lockDirection: true,			useTransform: true,			useTransition: false,			// Events			onRefresh: null,			onBeforeScrollStart: function (e) {				/*				* MOD WAKANDA *************************				*				*/				this.elemToFocus = e.srcElement;				/*				* END MOD WAKANDA *************************				*				*/				e.preventDefault();			},			onScrollStart:  null,			onBeforeScrollMove: null,			onScrollMove: function (e) {				/*				* MOD WAKANDA *************************				*				*/				this.hasMove = true;				/*				* END MOD WAKANDA *************************				*				*/			},			onBeforeScrollEnd: null,			onScrollEnd: null,			onTouchEnd: function(){				/*				* MOD WAKANDA *************************				*				*/				var elem = $(this.elemToFocus),					pos,					dspos,					getMatrix = elem.closest(".waf-matrix"),					matrix,					container,					edit = null;				if (getMatrix.length != 0) {					matrix = $$(elem.closest(".waf-matrix").get()[0].id);					if (!this.hasMove && this.elemToFocus) {						if (this.elemToFocus.nodeName === "INPUT" || this.elemToFocus.nodeName === "BUTTON") {							edit = this.elemToFocus;						}					}				}				if (!this.hasMove && matrix && matrix.length != 0) {					if (elem.hasClass("waf-container")) {						container = elem;					} else {						container = elem.closest(".waf-container");					}					pos = parseInt(container.attr("data-pos"));					dspos = parseInt(container.attr("data-dspos"));					//matrix.goTo(pos);					matrix.sourceRef.select(dspos);				}				this.hasMove = false;				if (edit != null) {					edit.focus();				}				/*				* END MOD WAKANDA *************************				*				*/			},			onDestroy: null		};		// User defined options		for (i in options) that.options[i] = options[i];		// Set starting position		that.x = that.options.x;		that.y = that.options.y;		// Normalize options		that.options.useTransform = hasTransform ? that.options.useTransform : false;		that.options.hScrollbar = that.options.hScroll && that.options.hScrollbar;		that.options.vScrollbar = that.options.vScroll && that.options.vScrollbar;		that.options.useTransition = hasTransitionEnd && that.options.useTransition;		// Set some default styles		that.scroller.style[vendor + 'TransitionProperty'] = that.options.useTransform ? '-' + vendor.toLowerCase() + '-transform' : 'top left';		that.scroller.style[vendor + 'TransitionDuration'] = '0';		that.scroller.style[vendor + 'TransformOrigin'] = '0 0';		if (that.options.useTransition) that.scroller.style[vendor + 'TransitionTimingFunction'] = 'cubic-bezier(0.33,0.66,0.66,1)';		if (that.options.useTransform) that.scroller.style[vendor + 'Transform'] = trnOpen + that.x + 'px,' + that.y + 'px' + trnClose;		else that.scroller.style.cssText += ';position:absolute;top:' + that.y + 'px;left:' + that.x + 'px';		that.refresh();		that._bind(RESIZE_EV, window);		that._bind(START_EV);		if (!hasTouch) that._bind('mouseout', that.wrapper);	};// PrototypeiScroll.prototype = {	enabled: true,	x: 0,	y: 0,	steps: [],	scale: 1,	handleEvent: function (e) {		var that = this;		switch(e.type) {			case START_EV:				if (!hasTouch && e.button !== 0) return;				that._start(e);				break;			case MOVE_EV: that._move(e); break;			case END_EV:			case CANCEL_EV: that._end(e); break;			case RESIZE_EV: that._resize(); break;			case 'mouseout': that._mouseout(e); break;			case 'webkitTransitionEnd': that._transitionEnd(e); break;		}	},	_resize: function () {		this.refresh();	},	_pos: function (x, y) {		x = this.hScroll ? x : 0;		y = this.vScroll ? y : 0;		if (this.options.useTransform) {			this.scroller.style[vendor + 'Transform'] = trnOpen + x + 'px,' + y + 'px' + trnClose + ' scale(' + this.scale + ')';		} else {			x = mround(x);			y = mround(y);			this.scroller.style.left = x + 'px';			this.scroller.style.top = y + 'px';		}		this.x = x;		this.y = y;	},	_start: function (e) {		var that = this,			point = hasTouch ? e.touches[0] : e,			matrix, x, y;		if (!that.enabled) return;		if (that.options.onBeforeScrollStart) that.options.onBeforeScrollStart.call(that, e);		if (that.options.useTransition) that._transitionTime(0);		that.moved = false;		that.animating = false;		that.zoomed = false;		that.distX = 0;		that.distY = 0;		that.absDistX = 0;		that.absDistY = 0;		that.dirX = 0;		that.dirY = 0;		if (that.options.momentum) {			if (that.options.useTransform) {				// Very lame general purpose alternative to CSSMatrix				matrix = getComputedStyle(that.scroller, null)[vendor + 'Transform'].replace(/[^0-9-.,]/g, '').split(',');				x = matrix[4] * 1;				y = matrix[5] * 1;			} else {				x = getComputedStyle(that.scroller, null).left.replace(/[^0-9-]/g, '') * 1;				y = getComputedStyle(that.scroller, null).top.replace(/[^0-9-]/g, '') * 1;			}			if (x != that.x || y != that.y) {				if (that.options.useTransition) that._unbind('webkitTransitionEnd');				else cancelFrame(that.aniTime);				that.steps = [];				that._pos(x, y);			}		}		that.startX = that.x;		that.startY = that.y;		that.pointX = point.pageX;		that.pointY = point.pageY;		that.startTime = e.timeStamp || Date.now();		if (that.options.onScrollStart) that.options.onScrollStart.call(that, e);		that._bind(MOVE_EV);		that._bind(END_EV);		that._bind(CANCEL_EV);	},	_move: function (e) {		var that = this,			point = hasTouch ? e.touches[0] : e,			deltaX = point.pageX - that.pointX,			deltaY = point.pageY - that.pointY,			newX = that.x + deltaX,			newY = that.y + deltaY,			timestamp = e.timeStamp || Date.now();		if (that.options.onBeforeScrollMove) that.options.onBeforeScrollMove.call(that, e);		that.pointX = point.pageX;		that.pointY = point.pageY;		// Slow down if outside of the boundaries		if (newX > 0 || newX < that.maxScrollX) {			newX = that.options.bounce ? that.x + (deltaX / 2) : newX >= 0 || that.maxScrollX >= 0 ? 0 : that.maxScrollX;		}		if (newY > 0 || newY < that.maxScrollY) {			newY = that.options.bounce ? that.y + (deltaY / 2) : newY >= 0 || that.maxScrollY >= 0 ? 0 : that.maxScrollY;		}		that.distX += deltaX;		that.distY += deltaY;		that.absDistX = m.abs(that.distX);		that.absDistY = m.abs(that.distY);		if (that.absDistX < 6 && that.absDistY < 6) {			return;		}		// Lock direction		if (that.options.lockDirection) {			if (that.absDistX > that.absDistY + 5) {				newY = that.y;				deltaY = 0;			} else if (that.absDistY > that.absDistX + 5) {				newX = that.x;				deltaX = 0;			}		}		that.moved = true;		that._pos(newX, newY);		that.dirX = deltaX > 0 ? -1 : deltaX < 0 ? 1 : 0;		that.dirY = deltaY > 0 ? -1 : deltaY < 0 ? 1 : 0;		if (timestamp - that.startTime > 300) {			that.startTime = timestamp;			that.startX = that.x;			that.startY = that.y;		}		if (that.options.onScrollMove) that.options.onScrollMove.call(that, e);	},	_end: function (e) {		if (hasTouch && e.touches.length != 0) return;		var that = this,			point = hasTouch ? e.changedTouches[0] : e,			target, ev,			momentumX = { dist:0, time:0 },			momentumY = { dist:0, time:0 },			duration = (e.timeStamp || Date.now()) - that.startTime,			newPosX = that.x,			newPosY = that.y,			newDuration;		that._unbind(MOVE_EV);		that._unbind(END_EV);		that._unbind(CANCEL_EV);		if (that.options.onBeforeScrollEnd) that.options.onBeforeScrollEnd.call(that, e);		if (!that.moved) {			if (hasTouch) {				// Find the last touched element				target = point.target;				while (target.nodeType != 1) target = target.parentNode;				if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA') {					ev = document.createEvent('MouseEvents');					ev.initMouseEvent('click', true, true, e.view, 1,						point.screenX, point.screenY, point.clientX, point.clientY,						e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,						0, null);					ev._fake = true;					target.dispatchEvent(ev);				}			}			that._resetPos(200);			if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);			return;		}		if (duration < 300 && that.options.momentum) {			momentumX = newPosX ? that._momentum(newPosX - that.startX, duration, -that.x, that.scrollerW - that.wrapperW + that.x, that.options.bounce ? that.wrapperW : 0) : momentumX;			momentumY = newPosY ? that._momentum(newPosY - that.startY, duration, -that.y, (that.maxScrollY < 0 ? that.scrollerH - that.wrapperH + that.y : 0), that.options.bounce ? that.wrapperH : 0) : momentumY;			newPosX = that.x + momentumX.dist;			newPosY = that.y + momentumY.dist; 			if ((that.x > 0 && newPosX > 0) || (that.x < that.maxScrollX && newPosX < that.maxScrollX)) momentumX = { dist:0, time:0 }; 			if ((that.y > 0 && newPosY > 0) || (that.y < that.maxScrollY && newPosY < that.maxScrollY)) momentumY = { dist:0, time:0 };		}		if (momentumX.dist || momentumY.dist) {			newDuration = m.max(m.max(momentumX.time, momentumY.time), 10);			that.scrollTo(mround(newPosX), mround(newPosY), newDuration);			if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);			return;		}		that._resetPos(200);		if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);	},	_resetPos: function (time) {		var that = this,			resetX = that.x >= 0 ? 0 : that.x < that.maxScrollX ? that.maxScrollX : that.x,			resetY = that.y >= 0 || that.maxScrollY > 0 ? 0 : that.y < that.maxScrollY ? that.maxScrollY : that.y;		if (resetX == that.x && resetY == that.y) {			if (that.moved) {				if (that.options.onScrollEnd) that.options.onScrollEnd.call(that);		// Execute custom code on scroll end				that.moved = false;			}			return;		}		that.scrollTo(resetX, resetY, time || 0);	},	_mouseout: function (e) {		var t = e.relatedTarget;		if (!t) {			this._end(e);			return;		}		while (t = t.parentNode) if (t == this.wrapper) return;		this._end(e);	},	_transitionEnd: function (e) {		var that = this;		if (e.target != that.scroller) return;		that._unbind('webkitTransitionEnd');		that._startAni();	},	/**	 *	 * Utilities	 *	 */	_startAni: function () {		var that = this,			startX = that.x, startY = that.y,			startTime = Date.now(),			step, easeOut,			animate;		if (that.animating) return;		if (!that.steps.length) {			that._resetPos(400);			return;		}		step = that.steps.shift();		if (step.x == startX && step.y == startY) step.time = 0;		that.animating = true;		that.moved = true;		if (that.options.useTransition) {			that._transitionTime(step.time);			that._pos(step.x, step.y);			that.animating = false;			if (step.time) that._bind('webkitTransitionEnd');			else that._resetPos(0);			return;		}		animate = function () {			var now = Date.now(),				newX, newY;			if (now >= startTime + step.time) {				that._pos(step.x, step.y);				that.animating = false;				if (that.options.onAnimationEnd) that.options.onAnimationEnd.call(that);			// Execute custom code on animation end				that._startAni();				return;			}			now = (now - startTime) / step.time - 1;			easeOut = m.sqrt(1 - now * now);			newX = (step.x - startX) * easeOut + startX;			newY = (step.y - startY) * easeOut + startY;			that._pos(newX, newY);			if (that.animating) that.aniTime = nextFrame(animate);		};		animate();	},	_transitionTime: function (time) {		this.scroller.style[vendor + 'TransitionDuration'] = time + 'ms';	},	_momentum: function (dist, time, maxDistUpper, maxDistLower, size) {		var deceleration = 0.0006,			speed = m.abs(dist) / time,			newDist = (speed * speed) / (2 * deceleration),			newTime = 0, outsideDist = 0;		// Proportinally reduce speed if we are outside of the boundaries		if (dist > 0 && newDist > maxDistUpper) {			outsideDist = size / (6 / (newDist / speed * deceleration));			maxDistUpper = maxDistUpper + outsideDist;			speed = speed * maxDistUpper / newDist;			newDist = maxDistUpper;		} else if (dist < 0 && newDist > maxDistLower) {			outsideDist = size / (6 / (newDist / speed * deceleration));			maxDistLower = maxDistLower + outsideDist;			speed = speed * maxDistLower / newDist;			newDist = maxDistLower;		}		newDist = newDist * (dist < 0 ? -1 : 1);		newTime = speed / deceleration;		return { dist: newDist, time: mround(newTime) };	},	_offset: function (el) {		var left = -el.offsetLeft,			top = -el.offsetTop;		while (el = el.offsetParent) {			left -= el.offsetLeft;			top -= el.offsetTop;		}		return { left: left, top: top };	},	_bind: function (type, el, bubble) {		(el || this.scroller).addEventListener(type, this, !!bubble);	},	_unbind: function (type, el, bubble) {		(el || this.scroller).removeEventListener(type, this, !!bubble);	},	/**	 *	 * Public methods	 *	 */	destroy: function () {		var that = this;		that.scroller.style[vendor + 'Transform'] = '';		// Remove the event listeners		that._unbind(RESIZE_EV, window);		that._unbind(START_EV);		that._unbind(MOVE_EV);		that._unbind(END_EV);		that._unbind(CANCEL_EV);		that._unbind('mouseout', that.wrapper);		if (that.options.useTransition) that._unbind('webkitTransitionEnd');		if (that.options.onDestroy) that.options.onDestroy.call(that);	},	refresh: function () {		var that = this,			offset;		that.wrapperW = that.wrapper.clientWidth;		that.wrapperH = that.wrapper.clientHeight;		that.scrollerW = that.scroller.offsetWidth;		that.scrollerH = that.scroller.offsetHeight;		that.maxScrollX = that.wrapperW - that.scrollerW;		that.maxScrollY = that.wrapperH - that.scrollerH;		that.dirX = 0;		that.dirY = 0;		that.hScroll = that.options.hScroll && that.maxScrollX < 0;		that.vScroll = that.options.vScroll && (!that.options.bounceLock && !that.hScroll || that.scrollerH > that.wrapperH);		offset = that._offset(that.wrapper);		that.wrapperOffsetLeft = -offset.left;		that.wrapperOffsetTop = -offset.top;		that.scroller.style[vendor + 'TransitionDuration'] = '0';		that._resetPos(200);	},	scrollTo: function (x, y, time, relative) {		var that = this,			step = x,			i, l;		that.stop();		if (!step.length) step = [{ x: x, y: y, time: time, relative: relative }];		for (i=0, l=step.length; i<l; i++) {			if (step[i].relative) { step[i].x = that.x - step[i].x; step[i].y = that.y - step[i].y; }			that.steps.push({ x: step[i].x, y: step[i].y, time: step[i].time || 0 });		}		that._startAni();	},	scrollToElement: function (el, time) {		var that = this, pos;		el = el.nodeType ? el : that.scroller.querySelector(el);		if (!el) return;		pos = that._offset(el);		pos.left += that.wrapperOffsetLeft;		pos.top += that.wrapperOffsetTop;		pos.left = pos.left > 0 ? 0 : pos.left < that.maxScrollX ? that.maxScrollX : pos.left;		pos.top = pos.top > 0 ? 0 : pos.top < that.maxScrollY ? that.maxScrollY : pos.top;		time = time === undefined ? m.max(m.abs(pos.left)*2, m.abs(pos.top)*2) : time;		that.scrollTo(pos.left, pos.top, time);	},	disable: function () {		this.stop();		this._resetPos(0);		this.enabled = false;		// If disabled after touchstart we make sure that there are no left over events		this._unbind(MOVE_EV);		this._unbind(END_EV);		this._unbind(CANCEL_EV);	},	enable: function () {		this.enabled = true;	},	stop: function () {		cancelFrame(this.aniTime);		this.steps = [];		this.moved = false;		this.animating = false;	}};if (typeof exports !== 'undefined') exports.iScroll = iScroll;else window.iScroll = iScroll;})();/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/mobile/jquery.ui.ipad.altfix.js*//*** jQuery.UI.iPad plugin* Copyright (c) 2010 Stephen von Takach* licensed under MIT.* Date: 27/8/2010** Project Home:* http://code.google.com/p/jquery-ui-for-ipad-and-iphone/*/$(function() {	//	// Extend jQuery feature detection	//	$.extend($.support, {		touch: "ontouchend" in document	});	//	// Hook up touch events	//	$.fn.addTouch = function() {		if ($.support.touch) {			this.each(function(i, el) {				el.addEventListener("touchstart", iPadTouchHandler, false);				el.addEventListener("touchmove", iPadTouchHandler, false);				el.addEventListener("touchend", iPadTouchHandler, false);				el.addEventListener("touchcancel", iPadTouchHandler, false);			});		}		return this;	}});var lastTap = null;			// Holds last tapped element (so we can compare for double tap)var tapValid = false;			// Are we still in the .6 second window where a double tap can occurvar tapTimeout = null;			// The timeout referencefunction cancelTap() {	tapValid = false;}var rightClickPending = false;	// Is a right click still feasiblevar rightClickEvent = null;		// the original eventvar holdTimeout = null;			// timeout referencevar cancelMouseUp = false;		// prevents a click from occuring as we want the context menufunction cancelHold() {	if (rightClickPending) {		window.clearTimeout(holdTimeout);		rightClickPending = false;		rightClickEvent = null;	}}function startHold(event) {	if (rightClickPending)		return;	rightClickPending = true; // We could be performing a right click	rightClickEvent = (event.changedTouches)[0];	holdTimeout = window.setTimeout("doRightClick();", 800);}function doRightClick() {	rightClickPending = false;	//	// We need to mouse up (as we were down)	//	var first = rightClickEvent,		simulatedEvent = document.createEvent("MouseEvent");	simulatedEvent.initMouseEvent("mouseup", true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,			false, false, false, false, 0, null);	first.target.dispatchEvent(simulatedEvent);	//	// emulate a right click	//	simulatedEvent = document.createEvent("MouseEvent");	simulatedEvent.initMouseEvent("mousedown", true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,			false, false, false, false, 2, null);	first.target.dispatchEvent(simulatedEvent);	//	// Show a context menu	//	simulatedEvent = document.createEvent("MouseEvent");	simulatedEvent.initMouseEvent("contextmenu", true, true, window, 1, first.screenX + 50, first.screenY + 5, first.clientX + 50, first.clientY + 5,                                  false, false, false, false, 2, null);	first.target.dispatchEvent(simulatedEvent);	//	// Note:: I don't mouse up the right click here however feel free to add if required	//	cancelMouseUp = true;	rightClickEvent = null; // Release memory}//// mouse over event then mouse down//function iPadTouchStart(event) {	var touches = event.changedTouches,		first = touches[0],		type = "mouseover",		simulatedEvent = document.createEvent("MouseEvent");	//	// Mouse over first - I have live events attached on mouse over	//	simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                            false, false, false, false, 0, null);	first.target.dispatchEvent(simulatedEvent);	type = "mousedown";	simulatedEvent = document.createEvent("MouseEvent");	simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                            false, false, false, false, 0, null);	first.target.dispatchEvent(simulatedEvent);	if (!tapValid) {		lastTap = first.target;		tapValid = true;		tapTimeout = window.setTimeout("cancelTap();", 600);		startHold(event);	}	else {		window.clearTimeout(tapTimeout);		//		// If a double tap is still a possibility and the elements are the same		//	Then perform a double click		//		if (first.target == lastTap) {			lastTap = null;			tapValid = false;			type = "click";			simulatedEvent = document.createEvent("MouseEvent");			simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                         	false, false, false, false, 0/*left*/, null);			first.target.dispatchEvent(simulatedEvent);			type = "dblclick";			simulatedEvent = document.createEvent("MouseEvent");			simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                         	false, false, false, false, 0/*left*/, null);			first.target.dispatchEvent(simulatedEvent);		}		else {			lastTap = first.target;			tapValid = true;			tapTimeout = window.setTimeout("cancelTap();", 600);			startHold(event);		}	}}function iPadTouchHandler(event) {	var type = "",		button = 0; /*left*/	if (event.touches.length > 1)		return;	switch (event.type) {		case "touchstart":			if ($(event.changedTouches[0].target).is("select")) {				return;			}			iPadTouchStart(event); /*We need to trigger two events here to support one touch drag and drop*/			event.preventDefault();			return false;			break;		case "touchmove":			cancelHold();			type = "mousemove";			event.preventDefault();			break;		case "touchend":			if (cancelMouseUp) {				cancelMouseUp = false;				event.preventDefault();				return false;			}			cancelHold();			type = "mouseup";			break;		default:			return;	}	var touches = event.changedTouches,		first = touches[0],		simulatedEvent = document.createEvent("MouseEvent");	simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                            false, false, false, false, button, null);	first.target.dispatchEvent(simulatedEvent);	if (type == "mouseup" && tapValid && first.target == lastTap) {	// This actually emulates the ipads default behaviour (which we prevented)		simulatedEvent = document.createEvent("MouseEvent");		// This check avoids click being emulated on a double tap		simulatedEvent.initMouseEvent("click", true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,                            false, false, false, false, button, null);		first.target.dispatchEvent(simulatedEvent);	}}/*C:/Wakanda/Tools/V3/V3 production/Wakanda Server/walib/WAF/lib/mobile/mobiscroll/js/mobiscroll-1.5.3.min.js*/(function(d){function z(K,h,G){var I=this,M=G,J,L,l,H={},m=false;this.settings=M;this.values=null;this.val=null;this.temp=null;this.setDefaults=function(N){d.extend(i,N)};this.enable=function(){M.disabled=false;if(d(K).is(":input")){d(K).prop("disabled",false)}};this.scroll=function(P,S,R,T,N){P.attr("style",(R?(w+"-transition:all "+R.toFixed(1)+"s ease-out;"):"")+(k?(w+"-transform:translate3d(0,"+(S*y)+"px,0);"):("top:"+(S*y)+"px;")));function Q(V,U,X,W){return X*Math.sin(V/W*(Math.PI/2))+U}if(R){var O=0;clearInterval(H[N]);H[N]=setInterval(function(){O+=0.1;P.data("pos",Math.round(Q(O,T,S-T,R)));if(O>=R){clearInterval(H[N]);P.data("pos",S)}},100)}else{P.data("pos",S)}};this.disable=function(){M.disabled=true;if(d(K).is(":input")){d(K).prop("disabled",true)}};this.formatDate=function(W,O,P){if(!O){return null}var X=d.extend({},this.settings,P),U=function(Y){var Z=0;while(S+1<W.length&&W.charAt(S+1)==Y){Z++;S++}return Z},R=function(Z,aa,Y){var ab=""+aa;if(U(Z)){while(ab.length<Y){ab="0"+ab}}return ab},Q=function(Y,ab,aa,Z){return(U(Y)?Z[ab]:aa[ab])},N="",V=false;for(var S=0;S<W.length;S++){if(V){if(W.charAt(S)=="'"&&!U("'")){V=false}else{N+=W.charAt(S)}}else{switch(W.charAt(S)){case"d":N+=R("d",O.getDate(),2);break;case"D":N+=Q("D",O.getDay(),X.dayNamesShort,X.dayNames);break;case"o":N+=R("o",(O.getTime()-new Date(O.getFullYear(),0,0).getTime())/86400000,3);break;case"m":N+=R("m",O.getMonth()+1,2);break;case"M":N+=Q("M",O.getMonth(),X.monthNamesShort,X.monthNames);break;case"y":N+=(U("y")?O.getFullYear():(O.getYear()%100<10?"0":"")+O.getYear()%100);break;case"h":var T=O.getHours();N+=R("h",(T>12?(T-12):(T==0?12:T)),2);break;case"H":N+=R("H",O.getHours(),2);break;case"i":N+=R("i",O.getMinutes(),2);break;case"s":N+=R("s",O.getSeconds(),2);break;case"a":N+=O.getHours()>11?"pm":"am";break;case"A":N+=O.getHours()>11?"PM":"AM";break;case"'":if(U("'")){N+="'"}else{V=true}break;default:N+=W.charAt(S)}}}return N};this.parseDate=function(ad,W,af){var R=new Date();if(!ad||!W){return R}W=(typeof W=="object"?W.toString():W+"");var T=d.extend({},this.settings,af),O=R.getFullYear(),ah=R.getMonth()+1,ab=R.getDate(),Q=-1,ae=R.getHours(),X=R.getMinutes(),P=R.getSeconds(),U=-1,aa=false,V=function(aj){var ak=(N+1<ad.length&&ad.charAt(N+1)==aj);if(ak){N++}return ak},ai=function(ak){V(ak);var al=(ak=="@"?14:(ak=="!"?20:(ak=="y"?4:(ak=="o"?3:2))));var am=new RegExp("^\\d{1,"+al+"}");var aj=W.substr(ac).match(am);if(!aj){throw"Missing number at position "+ac}ac+=aj[0].length;return parseInt(aj[0],10)},S=function(ak,am,aj){var an=(V(ak)?aj:am);for(var al=0;al<an.length;al++){if(W.substr(ac,an[al].length).toLowerCase()==an[al].toLowerCase()){ac+=an[al].length;return al+1}}throw"Unknown name at position "+ac},Z=function(){if(W.charAt(ac)!=ad.charAt(N)){throw"Unexpected literal at position "+ac}ac++},ac=0;for(var N=0;N<ad.length;N++){if(aa){if(ad.charAt(N)=="'"&&!V("'")){aa=false}else{Z()}}else{switch(ad.charAt(N)){case"d":ab=ai("d");break;case"D":S("D",T.dayNamesShort,T.dayNames);break;case"o":Q=ai("o");break;case"m":ah=ai("m");break;case"M":ah=S("M",T.monthNamesShort,T.monthNames);break;case"y":O=ai("y");break;case"H":ae=ai("H");break;case"h":ae=ai("h");break;case"i":X=ai("i");break;case"s":P=ai("s");break;case"a":U=S("a",["am","pm"],["am","pm"])-1;break;case"A":U=S("A",["am","pm"],["am","pm"])-1;break;case"'":if(V("'")){Z()}else{aa=true}break;default:Z()}}}if(O<100){O+=new Date().getFullYear()-new Date().getFullYear()%100+(O<=T.shortYearCutoff?0:-100)}if(Q>-1){ah=1;ab=Q;do{var Y=32-new Date(O,ah-1,32).getDate();if(ab<=Y){break}ah++;ab-=Y}while(true)}ae=(U==-1)?ae:((U&&ae<12)?(ae+12):(!U&&ae==12?0:ae));var ag=new Date(O,ah-1,ab,ae,X,P);if(ag.getFullYear()!=O||ag.getMonth()+1!=ah||ag.getDate()!=ab){throw"Invalid date"}return ag};this.setValue=function(O){if(O==undefined){O=true}var N=this.formatResult();this.val=N;this.values=this.temp.slice(0);if(O&&d(K).is(":input")){d(K).val(N).change()}};this.getDate=function(){var O=this.values;if(M.preset=="date"){return new Date(O[J],O[L],O[l])}if(M.preset=="time"){var N=(M.ampm)?((O[M.seconds?3:2]=="PM"&&(O[0]-0)<12)?(O[0]-0+12):(O[M.seconds?3:2]=="AM"&&(O[0]==12)?0:O[0])):O[0];return new Date(1970,0,1,N,O[1],M.seconds?O[2]:null)}if(M.preset=="datetime"){var N=(M.ampm)?((O[M.seconds?6:5]=="PM"&&(O[3]-0)<12)?(O[3]-0+12):(O[M.seconds?6:5]=="AM"&&(O[3]==12)?0:O[3])):O[3];return new Date(O[J],O[L],O[l],N,O[4],M.seconds?O[5]:null)}};this.setDate=function(P,O){if(M.preset.match(/date/i)){this.temp[J]=P.getFullYear();this.temp[L]=P.getMonth();this.temp[l]=P.getDate()}if(M.preset=="time"){var N=P.getHours();this.temp[0]=(M.ampm)?(N>12?(N-12):(N==0?12:N)):N;this.temp[1]=P.getMinutes();if(M.seconds){this.temp[2]=P.getSeconds()}if(M.ampm){this.temp[M.seconds?3:2]=N>11?"PM":"AM"}}if(M.preset=="datetime"){var N=P.getHours();this.temp[3]=(M.ampm)?(N>12?(N-12):(N==0?12:N)):N;this.temp[4]=P.getMinutes();if(M.seconds){this.temp[5]=P.getSeconds()}if(M.ampm){this.temp[M.seconds?6:5]=N>11?"PM":"AM"}}this.setValue(O)};this.parseValue=function(R){if(this.preset){var N=[];if(M.preset=="date"){try{var Q=this.parseDate(M.dateFormat,R,M)}catch(P){var Q=new Date()}N[J]=Q.getFullYear();N[L]=Q.getMonth();N[l]=Q.getDate()}else{if(M.preset=="time"){try{var Q=this.parseDate(M.timeFormat,R,M)}catch(P){var Q=new Date()}var O=Q.getHours();N[0]=(M.ampm)?(O>12?(O-12):(O==0?12:O)):O;N[1]=Q.getMinutes();if(M.seconds){N[2]=Q.getSeconds()}if(M.ampm){N[M.seconds?3:2]=O>11?"PM":"AM"}}else{if(M.preset=="datetime"){try{var Q=this.parseDate(M.dateFormat+" "+M.timeFormat,R,M)}catch(P){var Q=new Date()}var O=Q.getHours();N[J]=Q.getFullYear();N[L]=Q.getMonth();N[l]=Q.getDate();N[3]=(M.ampm)?(O>12?(O-12):(O==0?12:O)):O;N[4]=Q.getMinutes();if(M.seconds){N[5]=Q.getSeconds()}if(M.ampm){N[M.seconds?6:5]=O>11?"PM":"AM"}}}}return N}return M.parseValue(R,this)};this.formatResult=function(){var O=this.temp;if(this.preset){if(M.preset=="date"){return this.formatDate(M.dateFormat,new Date(O[J],O[L],O[l]),M)}else{if(M.preset=="datetime"){var N=(M.ampm)?((O[M.seconds?6:5]=="PM"&&(O[3]-0)<12)?(O[3]-0+12):(O[M.seconds?6:5]=="AM"&&(O[3]==12)?0:O[3])):O[3];return this.formatDate(M.dateFormat+" "+M.timeFormat,new Date(O[J],O[L],O[l],N,O[4],M.seconds?O[5]:null),M)}else{if(M.preset=="time"){var N=(M.ampm)?((O[M.seconds?3:2]=="PM"&&(O[0]-0)<12)?(O[0]-0+12):(O[M.seconds?3:2]=="AM"&&(O[0]==12)?0:O[0])):O[0];return this.formatDate(M.timeFormat,new Date(1970,0,1,N,O[1],M.seconds?O[2]:null),M)}}}}return M.formatResult(O)};this.validate=function(O){if(this.preset&&M.preset.match(/date/i)&&((O==J)||(O==L)||(O==-1))){var P=32-new Date(this.temp[J],this.temp[L],32).getDate()-1;var N=d("ul:eq("+l+")",h);d("li",N).show();d("li:gt("+P+")",N).hide();if(this.temp[l]>P){this.scroll(N,s-P-1);this.temp[l]=d("li:eq("+P+")",N).data("val")}}else{M.validate(O)}};this.hide=function(){if(M.onClose(this.val,this)===false){return false}d(".dwtd").prop("disabled",false).removeClass("dwtd");d(K).blur();h.hide();n.hide();m=false;if(this.preset){M.wheels=null}d(window).unbind("resize.dw")};this.show=function(){if(M.disabled||m){return false}M.beforeShow(K,this);y=M.height;s=Math.round(M.rows/2);a=this;this.init();if(this.preset){M.wheels=new Array();if(M.preset.match(/date/i)){var N={};for(var P=0;P<3;P++){if(P==J){N[M.yearText]={};for(var S=M.startYear;S<=M.endYear;S++){N[M.yearText][S]=M.dateOrder.search(/yy/i)<0?S.toString().substr(2,2):S.toString()}}else{if(P==L){N[M.monthText]={};for(var S=0;S<12;S++){N[M.monthText][S]=(M.dateOrder.search(/MM/)<0?(M.dateOrder.search(/M/)<0?(M.dateOrder.search(/mm/)<0?(S+1):(S<9)?("0"+(S+1)):(S+1)):M.monthNamesShort[S]):M.monthNames[S])}}else{if(P==l){N[M.dayText]={};for(var S=1;S<32;S++){N[M.dayText][S]=M.dateOrder.search(/dd/i)<0?S:(S<10)?("0"+S):S}}}}}M.wheels.push(N)}if(M.preset.match(/time/i)){M.stepHour=(M.stepHour<1)?1:parseInt(M.stepHour);M.stepMinute=(M.stepMinute<1)?1:parseInt(M.stepMinute);M.stepSecond=(M.stepSecond<1)?1:parseInt(M.stepSecond);var N={};N[M.hourText]={};for(var S=(M.ampm?1:0);S<(M.ampm?13:24);S+=M.stepHour){N[M.hourText][S]=(S<10)?("0"+S):S}N[M.minuteText]={};for(var S=0;S<60;S+=M.stepMinute){N[M.minuteText][S]=(S<10)?("0"+S):S}if(M.seconds){N[M.secText]={};for(var S=0;S<60;S+=M.stepSecond){N[M.secText][S]=(S<10)?("0"+S):S}}if(M.ampm){N[M.ampmText]={};N[M.ampmText]["AM"]="AM";N[M.ampmText]["PM"]="PM"}M.wheels.push(N)}}d(".dwc",h).remove();for(var S=0;S<M.wheels.length;S++){var O=d('<div class="dwc'+(M.mode=="clickpick"?" dwpm":"")+'"><div class="dwwc dwrc"><div class="clear" style="clear:both;"></div></div>').insertBefore(d(".dwbc",h));for(var R in M.wheels[S]){var T=d(".dwwc .clear",O);var N=d('<div class="dwwl dwrc">'+(M.mode=="clickpick"?'<div class="dwwb dwwbp">+</div><div class="dwwb dwwbm">&ndash;</div>':"")+'<div class="dwl">'+R+'</div><div class="dww dwrc"><ul></ul><div class="dwwo"></div></div><div class="dwwol"></div></div>').insertBefore(T);for(var Q in M.wheels[S][R]){d('<li class="val_'+Q+'">'+M.wheels[S][R][Q]+"</li>").data("val",Q).appendTo(d("ul",N))}}}d(".dww ul",h).each(function(V){var U=d("li",this).index(d("li.val_"+I.temp[V],this));while((U<0)&&(--I.temp[V]>=0)){U=d("li",this).index(d("li.val_"+I.temp[V],this))}I.scroll(d(this),s-(U<0?0:U)-1)});d(".dwv",h).html(this.formatResult());I.validate(-1);d("#dw_set",h).text(M.setText).unbind().bind("click",function(U){I.setValue();M.onSelect(I.val,a);I.hide();return false});d("#dw_cancel",h).text(M.cancelText).unbind().bind("click",function(U){M.onCancel(I.val,a);I.hide();return false});d(":input:not(:disabled)").addClass("dwtd");d(":input").prop("disabled",true);n.show();h.attr("class","dw "+M.theme).show();m=true;d(".dww, .dwwl",h).height(M.rows*y);d(".dww",h).each(function(){d(this).width(d(this).parent().width()<M.width?M.width:d(this).parent().width())});d(".dwbc a",h).attr("class",M.btnClass);d(".dww li, .dwwb",h).css({height:y,lineHeight:y+"px"});d(".dwwc",h).each(function(){var U=0;d(".dwwl",this).each(function(){U+=d(this).outerWidth(true)});d(this).width(U)});d(".dwc",h).each(function(){d(this).width(d(".dwwc",this).outerWidth(true))});this.pos();d(window).bind("resize.dw",function(){I.pos()})};this.pos=function(){var N=0,Q=0,T=d(window).width(),P=d(window).height(),R=d(window).scrollTop(),O,S;d(".dwc",h).each(function(){O=d(this).outerWidth(true);N+=O;Q=(O>Q)?O:Q});O=N>T?Q:N;h.width(O);O=h.outerWidth();S=h.outerHeight();h.css({left:(T-O)/2,top:R+(P-S)/2});n.height(0);n.height(d(document).height())};this.init=function(){var N=M.dateOrder.search(/y/i),O=M.dateOrder.search(/m/i),P=M.dateOrder.search(/d/i);J=N<O?(N<P?0:1):(N<P?1:2);L=O<N?(O<P?0:1):(O<P?1:2);l=P<N?(P<O?0:1):(P<O?1:2);this.preset=(M.wheels===null);this.temp=((d(K).is("input")&&this.val!==null&&this.val!=d(K).val())||this.values===null)?this.parseValue(d(K).val()?d(K).val():""):this.values.slice(0);this.setValue(false)};this.init();if(d(K).is(":input")&&M.showOnFocus){d(K).data("dwro",d(K).prop("readonly")).prop("readonly",true)}d(K).addClass("scroller").unbind("focus.dw").bind("focus.dw",function(N){if(M.showOnFocus){I.show()}})}function F(l){for(var h in l){if(D[l[h]]!==undefined){return true}}return false}function b(){var h=["Webkit","Moz","O","ms"];for(var l in h){if(F([h[l]+"Transform"])){return"-"+h[l].toLowerCase()}}return""}var o,n,y,s,u,a,j={},C=new Date(),x=C.getTime(),r=false,E=null,e,t,p,c,f,D=document.createElement(D).style,k=F(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&"webkitPerspective" in document.documentElement.style,w=b(),g=("ontouchstart" in window),v=g?"touchstart":"mousedown",B=g?"touchmove":"mousemove",q=g?"touchend":"mouseup",i={width:80,height:40,rows:3,disabled:false,showOnFocus:true,wheels:null,theme:"",mode:"scroller",preset:"date",dateFormat:"mm/dd/yy",dateOrder:"mmddy",ampm:true,seconds:false,timeFormat:"hh:ii A",startYear:C.getFullYear()-100,endYear:C.getFullYear()+1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",setText:"Set",cancelText:"Cancel",btnClass:"dwb",stepHour:1,stepMinute:1,stepSecond:1,beforeShow:function(){},onClose:function(){},onSelect:function(){},onCancel:function(){},formatResult:function(m){var h="";for(var l=0;l<m.length;l++){h+=(l>0?" ":"")+m[l]}return h},parseValue:function(m,I){var L=I.settings.wheels,J=m.split(" "),h=[],K=0;for(var H=0;H<L.length;H++){for(var G in L[H]){K++;for(var M in L[H][G]){h.push(M);break}}}return J.length==K?J:h},validate:function(){return true}},A={init:function(L){if(L===undefined){L={}}var H={};if(L.theme=="ios"){H.dateOrder="MMdyy";H.rows=5;H.height=30;H.width=55}if(L.mode=="clickpick"){H.height=50;H.rows=3}var l=d.extend({},i,H,L),h=false,J=false;if(d(".dw").length){n=d(".dwo");o=d(".dw")}else{n=d('<div class="dwo"></div>').hide().appendTo("body");o=d('<div class="dw"><div class="dwv">&nbsp;</div><div class="dwbc" style="clear:both;"><span class="dwbw dwb-s"><a id="dw_set" href="#"></a></span><span class="dwbw dwb-c"><a id="dw_cancel" href="#"></a></span></div></div>');o.hide().appendTo("body");function K(M){return g?M.originalEvent.changedTouches[0].pageY:M.pageY}function G(N,P,O,Q){var M=d("ul",o).index(N);P=P>(s-1)?(s-1):P;P=P<(s-u)?(s-u):P;a.scroll(N,P,O?(P==Q?0.1:Math.abs((P-Q)*0.1)):0,Q,M);a.temp[M]=d("li:eq("+(s-1-P)+")",N).data("val");a.validate(M);d(".dwv",o).html(a.formatResult())}function I(M){if(h){var N=M.data("pos"),O=N-1;O=O<(s-u)?(s-1):O;G(M,O)}else{clearInterval(h)}}function m(M){if(J){var N=M.data("pos"),O=N+1;O=O>(s-1)?(s-u):O;G(M,O)}else{clearInterval(J)}}d(document).bind(B,function(M){if(r){M.preventDefault();t=K(M);var N=f+(t-e)/y;N=N>(s-1+1)?(s-1+1):N;N=N<(s-u-1)?(s-u-1):N;a.scroll(E,N)}});d(document).bind(q,function(O){if(r){O.preventDefault();var N=new Date()-p;var Q=f+(t-e)/y;Q=Q>(s-1+1)?(s-1+1):Q;Q=Q<(s-u-1)?(s-u-1):Q;if(N<300){var M=(t-e)/N;var P=(M*M)/(2*0.0006);if(t-e<0){P=-P}}else{var P=t-e}G(E,Math.round(f+P/y),true,Math.round(Q));r=false;E=null}clearInterval(h);clearInterval(J);h=false;J=false;d(".dwb-a").removeClass("dwb-a")});o.delegate(".dwwl","DOMMouseScroll mousewheel",function(O){O.preventDefault();O=O.originalEvent;var Q=O.wheelDelta?(O.wheelDelta/120):(O.detail?(-O.detail/3):0),M=d("ul",this),N=M.data("pos"),P=Math.round(N+Q);u=d("li:visible",M).length;G(M,P)}).delegate(".dwb, .dwwb",v,function(M){d(this).addClass("dwb-a")}).delegate(".dwwbp",v,function(N){N.preventDefault();var M=d(this).closest(".dwwl").find("ul");u=d("li:visible",M).length;clearInterval(h);h=setInterval(function(){I(M)},200);I(M)}).delegate(".dwwbm",v,function(N){N.preventDefault();var M=d(this).closest(".dwwl").find("ul");u=d("li:visible",M).length;clearInterval(J);J=setInterval(function(){m(M)},200);m(M)}).delegate(".dwwl",v,function(M){if(!r&&a.settings.mode=="scroller"){M.preventDefault();r=true;E=d("ul",this);f=E.data("pos");u=d("li:visible",E).length;e=K(M);p=new Date();t=e;a.scroll(E,f)}})}return this.each(function(){if(!this.id){x+=1;this.id="scoller"+x}j[this.id]=new z(this,o,l)})},enable:function(){return this.each(function(){if(j[this.id]){j[this.id].enable()}})},disable:function(){return this.each(function(){if(j[this.id]){j[this.id].disable()}})},isDisabled:function(){if(j[this[0].id]){return j[this[0].id].settings.disabled}},option:function(h,l){return this.each(function(){if(j[this.id]){if(typeof h==="object"){d.extend(j[this.id].settings,h)}else{j[this.id].settings[h]=l}j[this.id].init()}})},setValue:function(l,h){if(h==undefined){h=false}return this.each(function(){if(j[this.id]){j[this.id].temp=l;j[this.id].setValue(l,h)}})},getValue:function(){if(j[this[0].id]){return j[this[0].id].values}},setDate:function(l,h){if(h==undefined){h=false}return this.each(function(){if(j[this.id]){j[this.id].setDate(l,h)}})},getDate:function(){if(j[this[0].id]){return j[this[0].id].getDate()}},show:function(){if(j[this[0].id]){return j[this[0].id].show()}},hide:function(){return this.each(function(){if(j[this.id]){j[this.id].hide()}})},destroy:function(){return this.each(function(){if(j[this.id]){d(this).unbind("focus.dw").removeClass("scroller");if(d(this).is(":input")){d(this).prop("readonly",d(this).data("dwro"))}delete j[this.id]}})}};d.fn.scroller=function(h){if(A[h]){return A[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return A.init.apply(this,arguments)}else{d.error("Unknown method")}}};d.scroller=new z(null,null,i)})(jQuery);